# Unit Testing Strategy & Tracker

## Purpose & Audience
- Give Tayte a living roadmap for where unit tests deliver the biggest safety wins.
- Provide Codex (and future contributors) a checklist to follow whenever we touch the test suite.
- Keep progress transparent with a single place to log what landed, what is next, and why.

## TL;DR: Unit Tests Explained Like You’re 15
- A unit test is a tiny robot teammate that checks one move in our app (a function, hook, or component).
- We run all the robots after every code change; if one screams, we know exactly what broke.
- Writing them costs some time now but saves way more time hunting bugs later.

## Guiding Principles (Codex Snapshot)
- Ship production-quality solutions with automated tests where feasible; document any manual verification.
- Respect i18n: never hardcode user-facing copy without updating EN and TR locales.
- No one-off hacks—favor clean abstractions, reusable components, and DRY patterns.
- Capture follow-up steps (tests, docs, rollout) in the plan before closing a task.
- Finish repo-altering work with a single-line commit summary.

## Testing Infrastructure To-Dos
- [x] Add `"test": "jest"` (or equivalent) to `package.json` scripts so running tests is one command.
- [x] Wire `setupTests.ts` into Jest (`setupFilesAfterEnv`) and ensure `tsconfig` includes test files.
- [x] Configure CI to run `npm run test` on pull requests (reuse existing workflow if available).
- [ ] Document how to use `src/utils/testUtils.tsx` for provider-wrapped renders.
- [ ] Decide on the folder convention (`*.test.ts` beside file vs. `__tests__` directories) and stick to it.
- [x] Configure Deno-based test runner for `supabase/functions/**` (`deno test --allow-env --allow-net` with local mocks).

### Test Harness Decisions
- Use **Jest 30 (Node + jsdom environment)** for everything under `src/**`, pairing it with Testing Library and our custom provider wrapper. Keep tests colocated with the code they cover.
- Use **Deno’s built-in test runner** for Supabase edge functions under `supabase/functions/**`. Author deterministic tests that stub the Supabase admin client and external services (Resend, fetch) via dependency injection or mock factories.
- When in doubt about where logic lives, prefer moving business rules into plain TypeScript modules so they are testable with Jest, leaving Deno functions as thin orchestrators.
- Commands: `npm test` for Jest, `npm run test:deno` (alias for `deno task test`) for Supabase functions. Ensure Deno 1.x is installed locally (e.g., `brew install deno` or via `deno.land` installer).

## Test Target Inventory

### Progress Snapshot _(update after each iteration)_
| Category | Done | Total | Completion |
| --- | --- | --- | --- |
| Core Libraries & Helpers | 18 | 18 | 100% |
| Services & Data Access | 5 | 6 | 83% |
| Contexts & Hooks | 34 | 35 | 97% |
| UI Components & Pages | 92 | 92 | 100% |
| UI Primitives & Shared Components | 22 | 23 | 96% |
| Supabase Edge Functions & Automation | 10 | 10 | 100% |
| **Overall** | **179** | **186** | **96%** |

> **Latest audit notes (2025-10-25):** Re-baselined totals after discovering untested utility hooks (`src/utils/**`, `src/hooks/useEntityActions.ts`, `useDataTable.ts`), workspace-specific hooks, settings/template-builder UI shells, and shared onboarding/activity primitives. See new "Not Started" rows below for concrete follow-up targets.
> **Follow-up (2025-11-18):** Supabase client wrapper tests remain outstanding—revisit `src/integrations/supabase/client.ts` once we settle the Jest ESM mocking strategy.
> **Follow-up (2025-11-22):** Added direct specs for `SessionStatusDialogs`, `ProjectTypeDialogs`, `ServiceDialogs`, `PackageDialogs`, `LeadStatusDialogs`, `ProjectStageDialogs`, plus `useMilestoneNotifications`; remaining focus shifts to data table primitives and hook gaps.
> **Follow-up (2025-11-25):** Schedule picker polish shipped—tests added for `CalendarTimePicker` + `TimeSlotPicker` to lock hover classes, smooth scroll, and locale formatting.
> **Follow-up (2025-11-26):** Next testing slice targets the wizard integration harness (create/edit/reschedule) and the Supabase client wrapper mocking strategy—see new backlog entries below.

### Core Libraries & Helpers
| Area | File(s) | What to Cover | Priority | Status | Notes |
| --- | --- | --- | --- | --- | --- |
| Locale/date formatting helpers | `src/lib/utils.ts` | Locale-aware formatting, 24h/12h detection, week range math | High | Done | Covered by `src/lib/utils.test.ts` (EN vs TR paths + week math). |
| Organization ID caching | `src/lib/organizationUtils.ts` | Cache hit/miss, Supabase auth fallback, error resilience | High | Done | Covered via `src/lib/organizationUtils.test.ts` with cache + creation paths. |
| Organization settings cache | `src/lib/organizationSettingsCache.ts` | Memory vs localStorage sync, TTL expiry, inflight dedupe | Medium | Done | Covered via `src/lib/__tests__/organizationSettingsCache.test.ts`. |
| Org-aware date/time utils | `src/lib/dateFormatUtils.ts` | Timezone conversions, format fallbacks, supported list ordering | High | Done | Covered by `src/lib/dateFormatUtils.test.ts` with timezone conversions + fallback scenarios. |
| Dynamic lead validation | `src/lib/leadFieldValidation.ts` | Schema generation per field type, sanitize/parse helpers | High | Done | Covered by `src/lib/leadFieldValidation.test.ts` across required rules, coercion, and helper flows. |
| Session lifecycle sorting | `src/lib/sessionSorting.ts` | Lifecycle grouping, legacy status mapping, timestamp ordering | Medium | Done | Covered by `src/lib/sessionSorting.test.ts` (modern + legacy lifecycle ordering). |
| Validation utilities | `src/lib/validation.ts` | Email/password schemas, sanitizer fallbacks | Medium | Done | Covered by `src/lib/validation.test.ts` (schema guards + DOMPurify fallback). |
| Template utilities | `src/lib/templateUtils.ts` | Placeholder fallbacks, spam word detection, block/plain conversions | Low | Done | Covered by `src/lib/templateUtils.test.ts` (fallback placeholders + block/plain conversion). |
| Session naming helpers | `src/lib/sessionUtils.ts` | Priority ordering (custom name, project type, lead), fallback behavior | Low | Done | Covered by `src/lib/sessionUtils.test.ts` (name trimming + project/lead fallbacks). |
| Relative date helpers | `src/lib/dateUtils.ts` | Today/tomorrow/yesterday detection, overdue sessions flags | Medium | Done | Covered by `src/lib/dateUtils.test.ts` using mocked system date + i18n fallbacks. |
| Input normalization utilities | `src/lib/inputUtils.ts` | Trimming handlers, blur normalization, event typing | Low | Done | Covered by `src/lib/inputUtils.test.ts` (change + blur handlers normalize spacing). |
| Payment color mapping | `src/lib/paymentColors.ts` | Consistent status color lookups, fallback color selection | Low | Done | Covered by `src/lib/paymentColors.test.ts` for palette integrity + class conventions. |
| Project summary builder | `src/lib/projects/buildProjectSummaryItems.tsx` | Aggregate KPI rows, empty state handling | Medium | Done | Covered by `src/lib/projects/buildProjectSummaryItems.test.tsx` with zero-data + rich summary cases. |
| Auth state helpers | `src/utils/authUtils.ts` | Local/session storage cleanup, global sign-out fallbacks, navigation after failure | High | Done | Covered by `src/utils/authUtils.test.ts` for storage purging, global sign-out warnings, and navigation resilience. |
| Entity list utilities | `src/utils/entityUtils.ts` | Sort/filter edge cases, validation rule coverage, date-range calculations | High | Done | Covered by `src/utils/entityUtils.test.ts` for mixed sorting, search filters, validation rules, formatting, debouncing, and date count helpers. |
| Onboarding cleanup RPC | `src/utils/onboardingCleanup.ts` | RPC invocation success/error handling, boolean/strings returns | Medium | Done | Covered by `src/utils/onboardingCleanup.test.ts` for success payloads, string fallback, and error logging on failures. |
| Onboarding validation health checks | `src/utils/onboardingValidation.ts` | Step/ID mismatches, warning aggregation, transition guard matrix | Medium | Done | Covered by `src/utils/onboardingValidation.test.ts` for healthy config, mismatch detection, transition guards, and system health reporting. |
| Performance monitor utilities | `src/utils/performance.ts` | Timing lifecycle, async measurement, reduced-motion helpers | Low | Done | Covered by `src/utils/performance.test.tsx` for timing records, slow-op warnings, decorator behavior, render hooks, and memory usage helpers. |

### Services & Data Access
| Area | File(s) | What to Cover | Priority | Status | Notes |
| --- | --- | --- | --- | --- | --- |
| Project data service | `src/services/ProjectService.ts` | Aggregated fetches, archived filtering, payment totals | High | Done | Covered via `src/services/__tests__/ProjectService.test.ts` (aggregation + filtering). |
| Session data service | `src/services/SessionService.ts` | Filtering, archived project exclusion, lead enrichment | High | Done | Covered via `src/services/__tests__/SessionService.test.ts` (archived filter + sort/filter logic). |
| Lead data service | `src/services/LeadService.ts` | Search/filter combinations, pagination guards, Supabase fallbacks | High | Done | Covered via `src/services/__tests__/LeadService.test.ts` (custom field merge + filter/sort). |
| Lead detail aggregator | `src/services/LeadDetailService.ts` | Parallel fetch composition, null safety when relations missing | Medium | Done | Covered via `src/services/__tests__/LeadDetailService.test.ts` for archived filtering, payment math, and activity fallbacks. |
| Base entity service foundation | `src/services/BaseEntityService.ts` | Shared `getOrganizationId`, error handling, caching | Medium | Done | Covered by `src/services/__tests__/BaseEntityService.test.ts` for org lookup failure handling and authenticated user guard. |
| Supabase client wrapper | `src/integrations/supabase/client.ts` | Auth-aware client initialization, edge-function channel reuse, error surfacing | High | Not Started | Establish Jest-compatible mock factory for `@supabase/supabase-js`, then cover `createClient`, session expiry refresh, SSR safety guards, and edge-function channel reuse. |

### Contexts & Hooks
| Area | File(s) | What to Cover | Priority | Status | Notes |
| --- | --- | --- | --- | --- | --- |
| Organization settings hook | `src/hooks/useOrganizationSettings.ts` | React Query caching, update path success/error toasts | High | Done | Covered by `src/hooks/__tests__/useOrganizationSettings.test.tsx` (cache + update/upsert + error toast). |
| Session form workflow | `src/hooks/useSessionForm.ts` | Validation guardrails, Supabase insert payload, workflow trigger recovery | High | Done | Covered by `src/hooks/__tests__/useSessionForm.test.tsx` validating validation, success path, trigger failure, auth error. |
| Session reminder scheduling | `src/hooks/useSessionReminderScheduling.ts` | RPC invoke, graceful error handling, reschedule flow | Medium | Done | Covered via `src/hooks/__tests__/useSessionReminderScheduling.test.tsx` (RPC fail warns, cancel/reschedule). |
| Workflow trigger wrapper | `src/hooks/useWorkflowTriggers.ts` | Input validation (UUID), invoke payload, toast on failure | Medium | Done | Covered by `src/hooks/__tests__/useWorkflowTriggers.test.ts` for validation, toast guard, and payload shaping. |
| Lead status actions | `src/hooks/useLeadStatusActions.tsx` | Auth guard, optimistic flags, destructive toast action | Medium | Done | Covered by `src/hooks/__tests__/useLeadStatusActions.test.tsx` for auth guard, undo toast action, and error handling. |
| Session actions | `src/hooks/useSessionActions.ts` | Reminder cleanup, workflow triggers on status change | High | Done | Covered via `src/hooks/__tests__/useSessionActions.test.tsx` for delete failure + status update flows. |
| Entity data helper | `src/hooks/useEntityData.ts` | Error propagation, dependency refresh behavior | Medium | Done | Covered by `src/hooks/__tests__/useEntityData.test.tsx` for toast fallback, dependency refetch, and custom error handlers. |
| User preferences hook | `src/hooks/useUserPreferences.ts` | Default bootstrap, optimistic updates, retry strategy | High | Done | Covered by `src/hooks/__tests__/useUserPreferences.test.ts` for bootstrap, defaults, optimistic + helper flows. |
| Payments workspace hooks | `src/pages/payments/hooks/usePaymentsData.ts`, `usePaymentsFilters.tsx`, `usePaymentsTableColumns.tsx` | Data fetching fallbacks, filter persistence, column memoization | High | Done | Covered by `src/pages/payments/hooks/__tests__/usePaymentsData.test.ts`, `usePaymentsFilters.test.tsx`, and `usePaymentsTableColumns.test.tsx` validating Supabase query composition, search/amount filter thresholds, and interactive column renderers. |
| Auth provider | `src/contexts/AuthContext.tsx` | Role fetching, auth change handling, sign-out side effects | High | Done | Covered by `src/contexts/__tests__/AuthContext.test.tsx` (session bootstrap + role fetch + sign-out). |
| Organization provider | `src/contexts/OrganizationContext.tsx` | Initial load, presence heartbeat cleanup, data prefetch | High | Done | Covered by `src/contexts/__tests__/OrganizationContext.test.tsx` (bootstrap fetch + refresh toast trigger). |
| Onboarding provider | `src/contexts/OnboardingContext.tsx` | Computed flags, guarded transitions, batch completion | Medium | Done | Covered by `src/contexts/__tests__/OnboardingContext.test.tsx` (computed flags + action guardrails). |
| Calendar performance monitor | `src/hooks/useCalendarPerformanceMonitor.ts` | Throttle thresholds, cleanup handlers | Low | Done | Covered by `src/hooks/__tests__/useCalendarPerformanceMonitor.test.ts` for timing metrics, memory usage, and dev warnings. |
| Organization data query helper | `src/hooks/useOrganizationData.ts` | Active org guards, queryKey composition, Supabase ensures | High | Done | Covered by `src/hooks/__tests__/useOrganizationData.test.ts` for guard rails, RPC ensure_default calls, and placeholder handling. |
| Lead detail data aggregator | `src/hooks/useLeadDetailData.ts` | Session metrics, combined queries, refetch fan-out | High | Done | Covered by `src/hooks/__tests__/useLeadDetailData.test.tsx` for metrics, refetch fan-out, and default fallbacks. |
| Session edit form | `src/hooks/useSessionEditForm.ts` | Dirty tracking, Zod validation, reschedule workflow path | High | Done | Covered by `src/hooks/__tests__/useSessionEditForm.test.tsx` for validation errors, workflow triggers, reminders, and Supabase errors. |
| Reminder actions | `src/hooks/useReminderActions.ts` | Delete/update mutations, toast feedback, error handling | Medium | Done | Covered via `src/hooks/__tests__/useReminderActions.test.ts` for success + error toasts and null handling. |
| Project payments hook | `src/hooks/useProjectPayments.ts` | Aggregated totals, missing services/payments fallback | Medium | Done | Covered by `src/hooks/__tests__/useProjectPayments.test.tsx` aggregating totals, handling errors, and verifying refresh/refetch. |
| Project sessions summary hook | `src/hooks/useProjectSessionsSummary.ts` | Status grouping, overdue detection, refresh triggers | Medium | Done | Covered by `src/hooks/__tests__/useProjectSessionsSummary.test.tsx` (status grouping + refresh triggers). |
| Organization quick settings | `src/hooks/useOrganizationQuickSettings.ts` | Memo defaults, refresh passthrough | Low | Done | Covered via `src/hooks/__tests__/useOrganizationQuickSettings.test.tsx` ensuring default true and refetch passthrough. |
| Organization timezone | `src/hooks/useOrganizationTimezone.ts` | Format conversion helpers, detect fallback timezone | Medium | Done | Covered via `src/hooks/__tests__/useOrganizationTimezone.test.ts` ensuring settings-driven formats and fallback timezone detection. |
| Notification triggers | `src/hooks/useNotificationTriggers.ts` | Milestone notifications, batch scheduling, toast errors | Medium | Done | Covered by `src/hooks/__tests__/useNotificationTriggers.test.ts` for Supabase insert/invoke flows and error toasts. |
| Settings section manager | `src/hooks/useSettingsSection.ts` | Auto-save throttling, dirty tracking, toast toggles | Medium | Done | Covered via `src/hooks/__tests__/useSettingsSection.test.ts` for manual saves, auto-save throttle, and toast/error handling. |
| Template builder hook | `src/hooks/useTemplateBuilder.ts` | Load/save pipelines, placeholder extraction, publish flow | High | Done | Covered by `src/hooks/__tests__/useTemplateBuilder.test.tsx` for load transforms, block conversions, and publish toast. |
| Template validation hook | `src/hooks/useTemplateValidation.ts` | Warning/error matrix, published template requirements | Medium | Done | Covered by `src/hooks/__tests__/useTemplateValidation.test.ts` for missing template, name/content validation, placeholders, and published requirements. |
| Generic entity actions hook | `src/hooks/useEntityActions.ts` | Loading/error state map, success/error toasts, callbacks | Medium | Done | Covered by `src/hooks/__tests__/useEntityActions.test.tsx` for success toasts, error handling, custom error callbacks, and concurrent action isolation. |
| Kanban settings bridge | `src/hooks/useKanbanSettings.ts` | Memoized defaults, updateSettings wrapping, loading flags | Medium | Done | Covered by `src/hooks/__tests__/useKanbanSettings.test.tsx` with mocked organization settings, default fallbacks, and update flow. |
| Data table composition hook | `src/hooks/useDataTable.ts` | Nested accessor paths, sorting for numbers/dates/strings, pagination resets | High | Done | Covered by `src/hooks/__tests__/useDataTable.test.tsx` for accessor sorting, dotted key filtering, pagination resets, and metadata calculations. |
| Debounce utility hook | `src/hooks/useDebounce.ts` | Timer cleanup, rapid updates, initial render behavior | Low | Done | Covered by `src/hooks/__tests__/useDebounce.test.tsx` with fake timers, timer cleanup, and delayed update assertions. |
| Accessibility helpers | `src/hooks/useAccessibility.ts` | Focus trap loop, screen reader announcements, keyboard navigation guardrails | Medium | Done | Covered by `src/hooks/__tests__/useAccessibility.test.tsx` for focus restoration, aria-activedescendant updates, screen reader announcements, and media query listeners. |
| Mobile breakpoint detector | `src/hooks/use-mobile.tsx` | matchMedia listeners, SSR safety, resize reactions | Medium | Done | Covered by `src/hooks/__tests__/use-mobile.test.tsx` verifying initial breakpoint detection, change listeners, and cleanup. |
| Leads workspace hooks | `src/pages/leads/hooks/useLeadsData.ts`, `useLeadsFilters.tsx` | Combined query composition, filter persistence, Supabase failure surfacing | High | In Progress | Added `src/pages/leads/hooks/__tests__/useLeadsFilters.test.tsx` for status toggles and clear-all footer; still need `useLeadsData` coverage for RPC/fallback flows. |
| Projects workspace hooks | `src/pages/projects/hooks/useProjectsData.ts`, `useProjectsFilters.tsx` | View-mode toggles, pagination guards, filter chips | High | In Progress | Added `src/pages/projects/hooks/__tests__/useProjectsFilters.test.tsx` for list/archived filter state transitions; data fetching hook coverage still pending. |

### UI Components & Pages
| Area | File(s) | What to Cover | Priority | Status | Notes |
| --- | --- | --- | --- | --- | --- |
| Add lead dialog | `src/components/AddLeadDialog.tsx` | Required fields guard, sanitized payload, status filtering, navigation guard | High | Done | Covered by `src/components/__tests__/AddLeadDialog.test.tsx` validating disabled submit, trimmed payload insert, filtered statuses, and dirty-close handling. |
| Edit lead dialog | `src/components/EditLeadDialog.tsx` | Prefill defaults, status lookup, validation disabling, guard reset | High | Done | Covered by `src/components/__tests__/EditLeadDialog.test.tsx` ensuring prefill, blank-name disablement, Supabase update payload, and guard callbacks. |
| Enhanced lead creation | `src/components/EnhancedAddLeadDialog.tsx` | Dynamic schema init, default status lookup, save pipeline | High | Done | Covered by `src/components/__tests__/EnhancedAddLeadDialog.test.tsx` verifying default status creation, value persistence, and navigation guard. |
| Enhanced lead edit | `src/components/EnhancedEditLeadDialog.tsx` | Prefill logic, change detection, update mutation flow | High | Done | Covered by `src/components/__tests__/EnhancedEditLeadDialog.test.tsx` for prefill, validation, and Supabase updates. |
| Enhanced project dialog | `src/components/EnhancedProjectDialog.tsx` | Cross-entity linking, lead selection, Supabase upserts | High | Done | Covered by `src/components/__tests__/EnhancedProjectDialog.test.tsx` ensuring data fetch, custom setup, and close/reopen resets. |
| Session scheduling dialog | `src/components/ScheduleSessionDialog.tsx` | Prefill data, reminder scheduling hooks, status updates | High | Done | Covered via `src/components/__tests__/ScheduleSessionDialog.test.tsx` & `SessionSchedulingSheet.test.tsx`. |
| Session scheduling sheet | `src/components/SessionSchedulingSheet.tsx` | Mobile sheet state, timezone-aware slots, submission flow | Medium | Done | Covered by `src/components/__tests__/SessionSchedulingSheet.test.tsx` validating slot selection, summary updates, and guarded closing. |
| Session planning wizard integration | `src/features/session-planning/state/__tests__/SessionPlanningProvider.integration.test.tsx` | Multi-entry flow coverage (create, edit/reschedule), reducer/applyState behaviour, notification toggles | High | Done | Integration tests drive create → schedule → notify path, hydrate edit mode, ensure reschedule + reset flows honour dirty/save flags. |
| Weekly schedule preview | `src/components/WeeklySchedulePreview.tsx` | Duration-based block sizing, overlap column layout, time-TBD handling | Medium | Done | Covered by `src/components/__tests__/WeeklySchedulePreview.test.tsx` validating stretched heights, column placement, and empty-week messaging. |
| Calendar & time slot pickers | `src/components/CalendarTimePicker.tsx`, `src/components/TimeSlotPicker.tsx` | Hover styling, planned-session scroll handling, slot highlighting/focus | Medium | Done | Added focused tests covering hover classnames, smooth planned-session scroll, and locale-aware slot selection. |
| Project Kanban board | `src/components/ProjectKanbanBoard.tsx` | Drag/drop ordering, status filtering, performance memoization | Medium | Done | Covered by `src/components/__tests__/ProjectKanbanBoard.test.tsx` for multi-status rendering, no-status fallback, quick view wiring, and pagination actions. |
| Workflow health dashboard | `src/components/WorkflowHealthDashboard.tsx` | Status aggregations, error states, filter interactions | Medium | Done | Covered by `src/components/__tests__/WorkflowHealthDashboard.test.tsx` for loading skeleton, empty state, critical metrics, and action buttons. |
| Add payment dialog | `src/components/AddPaymentDialog.tsx` | Required field gating, insert payload shaping, due status propagation | High | Done | Covered by `src/components/__tests__/AddPaymentDialog.test.tsx` asserting disabled submit, insert/reset flow, due status toggles, and guard reset callbacks. |
| Edit payment dialog | `src/components/EditPaymentDialog.tsx` | Prefill hydration, manual/base payment branching, status guardrails | High | Done | Covered by `src/components/__tests__/EditPaymentDialog.test.tsx` verifying prefills, manual/base mutation payloads, due status handling, and dirty-close guard. |
| Global search | `src/components/GlobalSearch.tsx` | Debounced queries, status preload, keyboard navigation | High | Done | Covered by `src/components/__tests__/GlobalSearch.test.tsx` (debounce guard, preloaded statuses, keyboard selection). |
| Protected route guard | `src/components/ProtectedRoute.tsx` | Auth gating, redirect logic, loading fallback | Medium | Done | Covered by `src/components/__tests__/ProtectedRoute.test.tsx` (loading/redirect + onboarding guard). |
| Route prefetcher | `src/components/RoutePrefetcher.tsx` | Prefetch orchestration, duplicate avoidance | Medium | Done | Covered by `src/components/__tests__/RoutePrefetcher.test.tsx` (cache guard + Supabase prefetch). |
| Error boundary | `src/components/ErrorBoundary.tsx` | Fallback rendering, copy-to-clipboard, custom fallback overrides | Medium | Done | Covered by `src/components/__tests__/ErrorBoundary.test.tsx` validating default UI, copy handling, and custom fallback support. |
| Language switcher | `src/components/LanguageSwitcher.tsx` | Loading states, change handler promises, compact trigger variant | Low | Done | Covered by `src/components/__tests__/LanguageSwitcher.test.tsx` for loading disablement, async change flow, and compact badge display. |
| Performance monitor instrumentation | `src/components/PerformanceMonitor.tsx` | Development-only gating, render-count warnings, metrics exposure | Low | Done | Covered by `src/components/__tests__/PerformanceMonitor.test.tsx` ensuring non-dev null rendering, warning threshold, and metrics helpers. |
| Offline banner | `src/components/OfflineBanner.tsx` | Connectivity context integration, retry actions | Low | Done | Covered by `src/components/__tests__/OfflineBanner.test.tsx` (online skip + retry + spinner state). |
| Auth page | `src/pages/Auth.tsx` | Sign-in/sign-up flows, password recovery, onboarding carousel toggles | High | Done | Covered by `src/pages/__tests__/Auth.test.tsx` for sign-in, sign-up, reset request, recovery update flows, and recovery entry guard. |
| Lead detail page | `src/pages/LeadDetail.tsx` | Data loading, tab switching, error fallbacks | High | Done | Covered by `src/pages/__tests__/LeadDetail.test.tsx` for skeleton fallback, summary wiring, status actions, and fetch error toasts. |
| Project detail page | `src/pages/ProjectDetail.tsx` | Combined queries, session/payment sections, modals | High | Done | Covered by `src/pages/__tests__/ProjectDetail.test.tsx` for happy path rendering + missing project redirect toast. |
| All leads workspace | `src/pages/AllLeads.tsx` | Server-driven table pagination/sorting, filter chip derivation, KPI metric calculations, onboarding tutorial triggers | High | Done | Covered by `src/pages/__tests__/AllLeads.test.tsx` verifying filter mapping, export disable/re-enable flow, and tutorial completion navigation. |
| All projects workspace | `src/pages/AllProjects.tsx` | Board/list/archived view switching, tutorial gating, exports, Supabase-backed list pagination | High | Done | Covered by `src/pages/__tests__/AllProjects.test.tsx` validating view mode persistence, Kanban/list dataset sync, and CSV export error toasts. |
| Analytics dashboard page | `src/pages/Analytics.tsx` | Session metric toggles, Supabase aggregation fallbacks, chart data transforms | Medium | Done | Covered by `src/pages/__tests__/Analytics.test.tsx` exercising scheduled/created toggles, empty datasets, and failure toast handling. |
| Workflows management page | `src/pages/Workflows.tsx` | Filtering, KPI summaries, pagination, toggle actions | High | Done | Covered by `src/pages/__tests__/Workflows.test.tsx` validating KPI summaries, segmented filters, pagination load-more, status toggles, edit wiring, and delete confirmation. |
| Session detail page | `src/pages/SessionDetail.tsx` | Supabase fetch path, edit/delete flows, navigation fallback, summary edit shortcuts | High | Done | Covered by `src/pages/__tests__/SessionDetail.test.tsx` validating skeleton transition, delete fallback navigation, load error toast. Summary card action buttons exercised in `src/lib/sessions/buildSessionSummaryItems.test.tsx` to ensure schedule/project/note/location shortcuts render and fire callbacks. |
| Calendar page | `src/pages/Calendar.tsx` | Range filters, session grouping, performance panels | High | Done | Covered by `src/pages/__tests__/Calendar.test.tsx` validating skeleton loading, segmented view switching, and session sheet launch. |
| Calendar day grid cell | `src/components/calendar/CalendarDay.tsx` | Sorting, combined overflow counts, mobile day tap handling | Medium | Done | Covered by `src/components/calendar/__tests__/CalendarDay.test.tsx` ensuring formatted content, overflow messaging, and mobile callbacks. |
| Calendar focused day view | `src/components/calendar/CalendarDayView.tsx` | Section counts, empty state messaging, touch gestures | Medium | Done | Covered by `src/components/calendar/__tests__/CalendarDayView.test.tsx` validating click handlers, empty fallback, and touch wiring. |
| Calendar month view | `src/components/calendar/CalendarMonthView.tsx` | Multi-day aggregation, overflow tooltips, day navigation | Medium | Done | Covered by `src/components/calendar/__tests__/CalendarMonthView.test.tsx` confirming combined events, overflow indicators, and day click callback. |
| Calendar week view | `src/components/calendar/CalendarWeek.tsx` | Time slot bucketing, mobile summary panels, timezone loading skeleton | High | Done | Covered by `src/components/calendar/__tests__/CalendarWeek.test.tsx` exercising loading skeleton, mobile rendering, and desktop grid callbacks. |
| Calendar loading skeletons | `src/components/calendar/CalendarSkeleton.tsx` | Header counts, grid sizing, placeholder distribution | Low | Done | Covered by `src/components/calendar/__tests__/CalendarSkeleton.test.tsx` counting header cells, grid entries, and placeholder blocks. |
| Calendar error boundary | `src/components/calendar/CalendarErrorBoundary.tsx` | Fallback UI, retry/reset behaviors, prop-based errors | Medium | Done | Covered by `src/components/calendar/__tests__/CalendarErrorBoundary.test.tsx` verifying thrown-error handling, retry wiring, and prop-controlled recovery. |
| Upcoming sessions page | `src/pages/UpcomingSessions.tsx` | Filters, session sorting, empty state messaging | Medium | Done | Covered by `src/pages/__tests__/UpcomingSessions.test.tsx` confirming KPI metrics, segment filters, and session sheet navigation. |
| Templates workspace | `src/pages/Templates.tsx` | Block editor integration, preview data toggles | Medium | Done | Covered by `src/pages/__tests__/Templates.test.tsx` exercising preview fallbacks, search empty states, row actions, and navigation flows. |
| Settings services page | `src/pages/settings/Services.tsx` | Tutorial auto-start, section visibility, onboarding completion routing | Medium | Done | Covered by `src/pages/settings/__tests__/Services.test.tsx` verifying tutorial visibility, completion navigation, and exit handling. |
| Settings projects page | `src/pages/settings/Projects.tsx` | Header metadata, section composition, help content wiring | Low | Done | Covered by `src/pages/settings/__tests__/Projects.test.tsx` ensuring wrapper/sections render with correct header props. |
| Settings danger zone page | `src/pages/settings/DangerZone.tsx` | Destructive confirmation guardrails, toast messaging, password reset | Medium | Done | Covered by `src/pages/settings/__tests__/DangerZone.test.tsx` exercising password required toast, success flow, and cancel reset. |
| Session types settings | `src/components/SessionTypesSection.tsx` | CRUD workflows, default selection, empty states | High | Done | Covered by `src/components/__tests__/SessionTypesSection.test.tsx` (empty state, default toggle, activation toggle, deletion). |
| Session form fields | `src/components/SessionFormFields.tsx` | Validation messaging, timezone-aware inputs, reminders toggles | Medium | Done | Covered by `src/components/__tests__/SessionFormFields.test.tsx` (project selector + field callbacks). |
| Session status badge | `src/components/SessionStatusBadge.tsx` | Lifecycle color mapping, accessible labels | Low | Done | Covered by `src/components/__tests__/SessionStatusBadge.test.tsx` (loading badge + editable dropdown updates). |
| Session banner | `src/components/SessionBanner.tsx` | Planned vs post-session messaging, action availability, translation keys | Medium | Done | Covered by `src/components/__tests__/SessionBanner.test.tsx` validating planned details, edit gating, and delete callbacks. |
| Project payments section | `src/components/ProjectPaymentsSection.tsx` | Summary cards, refresh triggers, empty states | Medium | Done | Covered by `src/components/__tests__/ProjectPaymentsSection.test.tsx` for metrics, refresh callback, and empty state. |
| Project services section | `src/components/ProjectServicesSection.tsx` | Supabase fetch, edit mode interactions, save + toast feedback | Medium | Done | Covered by `src/components/__tests__/ProjectServicesSection.test.tsx` validating data hydration, picker wiring, and save success toasts. |
| Project activity section | `src/components/ProjectActivitySection.tsx` | Activity load, validation guardrails, reminder saves, completion toggles | Medium | Done | Covered by `src/components/__tests__/ProjectActivitySection.test.tsx` asserting fetch rendering, destructive validation toasts, save flow, and completion updates. |
| Sessions section surface | `src/components/SessionsSection.tsx` | Tab filtering, sorting integration, quick actions | Medium | Done | Covered by `src/components/__tests__/SessionsSection.test.tsx` for skeleton state, empty CTA wiring, and banner/sheet interactions. |
| Enhanced sessions section | `src/components/EnhancedSessionsSection.tsx` | Multi-column layout, performance instrumentation | Medium | Done | Covered by `src/components/__tests__/EnhancedSessionsSection.test.tsx` verifying lifecycle sorting, count badge, and click wiring. |
| Unified client details | `src/components/UnifiedClientDetails.tsx` | Conditional rendering of contact info, copy buttons | Low | Done | Covered by `src/components/__tests__/UnifiedClientDetails.test.tsx` validating quick actions, custom field display, navigation hooks, and validation toasts. |
| Project sheet view | `src/components/ProjectSheetView.tsx` | Printable layout, localization of labels, totals | Medium | Done | Covered by `src/components/__tests__/ProjectSheetView.test.tsx` validating supabase fetch stubs, edit/save flow, and archive confirmation handling. |
| Onboarding modal | `src/components/OnboardingModal.tsx` | Step transitions, skip behavior, analytics events | Medium | Done | Covered by `src/components/__tests__/OnboardingModal.test.tsx` validating guided setup launch, navigation, and sample data modal toggle. |
| Activity timeline section | `src/components/ActivitySection.tsx` | Activity CRUD, reminder scheduling, filter tabs | High | Done | Covered by `src/components/__tests__/ActivitySection.test.tsx` verifying filter pills, Supabase-driven creation flow, and toast feedback. |
| Lead activity section | `src/components/LeadActivitySection.tsx` | Segmented activity/history views, cross-entity fetches, audit timeline | Medium | Done | Covered by `src/components/__tests__/LeadActivitySection.test.tsx` exercising segment toggles, activity creation, and completion toasts with mocked Supabase chains. |
| Workflow creation sheet | `src/components/CreateWorkflowSheet.tsx` | Form dirty-state guard, channel toggles, template selection, create/update branching | High | Done | Covered by `src/components/__tests__/CreateWorkflowSheet.test.tsx` for edit prefill, update submission payloads, and empty-template messaging. |
| Workflow delete dialog | `src/components/WorkflowDeleteDialog.tsx` | Confirmation copy, destructive action wiring, disabled state | Medium | Done | Covered by `src/components/__tests__/WorkflowDeleteDialog.test.tsx` verifying translation text, cancel/confirm callbacks, close handling, and disabled deletion state. |
| Project sheet preview | `src/components/ProjectSheetPreview.tsx` | Modal lifecycle, related data fetches, navigation callbacks | Medium | Done | Covered by `src/components/__tests__/ProjectSheetPreview.test.tsx` ensuring Supabase fetch stubs hydrate metrics, navigation closes modal, and status change triggers updates. |
| Dead simple session banner | `src/components/DeadSimpleSessionBanner.tsx` | Feature flag handling, CTA availability, close persistence | Low | Done | Covered by `src/components/__tests__/DeadSimpleSessionBanner.test.tsx` checking relative badges, project labels, and click handling. |
| Guided step progress indicator | `src/components/GuidedStepProgress.tsx` | Animation pacing, percentage calculations, copy fallback | Low | Done | Covered by `src/components/__tests__/GuidedStepProgress.test.tsx` verifying animated timer progression and non-animated target display. |
| Reminder filter bar | `src/components/FilterBar.tsx` | Quick filter pills, sheet actions, toggle callbacks | Medium | Done | Covered by `src/components/__tests__/FilterBar.test.tsx` validating pill clicks, sheet clearing, dropdown selection, and toggle handlers. |
| Restart guided mode button | `src/components/RestartGuidedModeButton.tsx` | Auth gating, onboarding reset, toast and navigation flows | Low | Done | Covered by `src/components/__tests__/RestartGuidedModeButton.test.tsx` ensuring owner guard, success toast, and error handling. |
| Exit guidance mode button | `src/components/ExitGuidanceModeButton.tsx` | Navigation lock guard, onboarding completion, toast errors | Low | Done | Covered by `src/components/__tests__/ExitGuidanceModeButton.test.tsx` for lock checks, success toast, and failure surfacing. |
| App sidebar | `src/components/AppSidebar.tsx` | Active route highlighting, role-based menu items | High | Done | Covered by `src/components/__tests__/AppSidebar.test.tsx` for active route styling + admin/support visibility. |
| User menu | `src/components/UserMenu.tsx` | Avatar fallbacks, settings/sign-out navigation, onboarding callbacks | Medium | Done | Covered by `src/components/__tests__/UserMenu.test.tsx` validating initials rendering, profile link, and sign-out flow. |
| Sample data modal | `src/components/SampleDataModal.tsx` | Template preview data, apply/reset callbacks, modal dismissal | Medium | Done | Covered by `src/components/__tests__/SampleDataModal.test.tsx` for skip success/error paths and guided setup continuation. |
| Getting started onboarding page | `src/pages/GettingStarted.tsx` | Checklist progress, sample data modal toggles, onboarding completion routing | High | Done | Covered by `src/pages/__tests__/GettingStarted.test.tsx` exercising redirects, guided progress, modal toggles, and completion flow. |
| Marketing landing page | `src/pages/Index.tsx` | Auth-based redirects, CTA links, feature highlights | Medium | Done | Covered by `src/pages/__tests__/Index.test.tsx` validating loading skeleton, CRM redirect, and public CTA navigation. |
| Not found route | `src/pages/NotFound.tsx` | Support links, navigation back to dashboard, localization | Low | Done | Covered by `src/pages/__tests__/NotFound.test.tsx` asserting error logging and dashboard link rendering. |
| Payments dashboard page | `src/pages/Payments.tsx` | Metrics cards, filters, pagination, workspace toggles | High | Done | Covered by `src/pages/__tests__/Payments.test.tsx` validating filter state wiring, export workbook creation, toast feedback, and table/search props. |
| Reminder details page | `src/pages/ReminderDetails.tsx` | Reminder fetch, status updates, reschedule/cancel flows | High | Done | Covered by `src/pages/__tests__/ReminderDetails.test.tsx` exercising fetch stats, error toasts, completion toggles, and project dialog hand-offs. |
| Template builder page | `src/pages/TemplateBuilder.tsx` | Editor state management, autosave/publish, preview toggles | High | Done | Covered by `src/pages/__tests__/TemplateBuilder.test.tsx` for loading state, save workflow, and block updates. |
| Admin console screens | `src/pages/admin/Users.tsx`, `Localization.tsx`, `System.tsx` | Table interactions, role actions, localization sync | High | Done | Covered by `src/pages/admin/__tests__/Users.test.tsx`, `Localization.test.tsx`, and `System.test.tsx` rendering translation scaffolding and toggle interactions. |
| Settings management pages | `src/pages/settings/Billing.tsx`, `Contracts.tsx`, `Leads.tsx`, `Profile.tsx`, `Account_old.tsx` | Section visibility, save flows, permission guards | Medium | Done | Covered by new suites in `src/pages/settings/__tests__/Billing.test.tsx`, `Contracts.test.tsx`, `Leads.test.tsx`, `Profile.test.tsx`, and `Account_old.test.tsx` validating headers, loading guards, and working-hour updates. |
| Payments workspace components | `src/pages/payments/components/PaymentsTableSection.tsx`, `PaymentsMetricsSummary.tsx`, `PaymentsDateControls.tsx`, `PaymentsTrendChart.tsx` | Table rendering, metrics aggregation, chart interactions, date filtering | High | Done | Covered by new specs in `src/pages/payments/components/__tests__/PaymentsTableSection.test.tsx`, `PaymentsMetricsSummary.test.tsx`, `PaymentsDateControls.test.tsx`, and `PaymentsTrendChart.test.tsx` asserting prop passthroughs, formatter usage, option handlers, and empty-state rendering. |
| Mobile navigation surfaces | `src/components/mobile/BottomSheetMenu.tsx`, `src/components/mobile/MobileBottomNav.tsx` | Quick action menus, responsive nav toggles, event callbacks | Medium | Done | Covered by `src/components/mobile/__tests__/BottomSheetMenu.test.tsx` and `MobileBottomNav.test.tsx` (sheet toggles, navigation wiring, sign-out handling, and user menu callbacks). |
| Help & support entry points | `src/components/modals/HelpModal.tsx`, `src/components/support/HelpOptionCard.tsx` | Support CTA tracking, modal toggles, analytics events | Medium | Done | Covered by `src/components/modals/__tests__/HelpModal.test.tsx` and `src/components/support/__tests__/HelpOptionCard.test.tsx` for translation wiring, CTA callbacks, close handling, and analytics/logging placeholders. |
| Settings shell components | `src/components/settings/SettingsPageWrapper.tsx`, `SettingsLayout.tsx`, `SettingsStickyFooter.tsx`, `SettingsHelpButton.tsx` | Layout composition, responsive breakpoints, exit guards | High | Done | Covered by `src/components/settings/__tests__/SettingsPageWrapper.test.tsx`, `SettingsLayout.test.tsx`, `SettingsStickyFooter.test.tsx`, and `SettingsHelpButton.test.tsx` for save/cancel toasts, onboarding locks, responsive rendering, and help sheet actions (2025-11-22 refresh adds i18n-mocked toast assertions). |
| Settings dialog suites | `src/components/settings/SessionTypeDialogs.tsx`, `SessionStatusDialogs.tsx`, `ProjectTypeDialogs.tsx`, `PackageDialogs.tsx`, `ServiceDialogs.tsx`, `NavigationGuardDialog.tsx` | CRUD flows, confirmation guardrails, optimistic updates | High | Done | Dialog suites now covered by `src/components/settings/__tests__/SessionStatusDialogs.test.tsx`, `ProjectTypeDialogs.test.tsx`, `ServiceDialogs.test.tsx`, and `PackageDialogs.test.tsx`, exercising happy paths, validation disables, and destructive/update flows across add/edit variants. |
| Lead & project stage dialogs | `src/components/settings/LeadStatusDialogs.tsx`, `ProjectStageDialogs.tsx` | Stage transitions, default protection, undo toasts | Medium | Done | Covered by `src/components/settings/__tests__/LeadStatusDialogs.test.tsx` and `ProjectStageDialogs.test.tsx`, asserting add/update/delete flows, auto-lifecycle heuristics, and system-required guardrails. |
| Sticky section navigation | `src/components/navigation/StickySectionNav.tsx` | Active section detection, scroll spy callbacks | Medium | Done | Exercised by `src/components/navigation/__tests__/StickySectionNav.test.tsx` to validate fallback selection, custom callbacks, scroll-to-section behavior, and observer-driven active updates. |
| Template builder editing surfaces | `src/components/template-builder/OptimizedTemplateEditor.tsx`, `BlockEditor.tsx`, `OptimizedTemplatePreview.tsx`, `CompactStorageIndicator.tsx`, `StorageQuotaDisplay.tsx`, `VariablePicker.tsx` | Block interactions, storage warnings, personalization tokens | High | Not Started | Page-level suite mocks these modules; add coverage for drag/drop, quota thresholds, and token insertion callbacks. |
| Template builder modals & sheets | `src/components/template-builder/AddBlockSheet.tsx`, `ImageLibrarySheet.tsx`, `TemplateNameDialog.tsx`, `DeleteTemplateDialog.tsx`, `InlinePreheaderEditor.tsx`, `InlineSubjectEditor.tsx`, `PlainTextPreview.tsx`, `TemplatePreview.tsx`, `previews/SMSPreview.tsx`, `previews/EmailPreview.tsx`, `previews/WhatsAppPreview.tsx` | Modal lifecycle, preview rendering, file uploads | High | In Progress | Extended coverage across inline editors, image library selection (copy, alt-text edit, delete), and multi-channel previews (email/SMS/WhatsApp/plain text with test-send guard rails). Remaining gaps: sheet-based upload initiation, TemplatePreview device toggles for WhatsApp/SMS, and media upload error states. |

### UI Primitives & Shared Components
| Area | File(s) | What to Cover | Priority | Status | Notes |
| --- | --- | --- | --- | --- | --- |
| Sheet modal wrapper | `src/components/ui/app-sheet-modal.tsx` | Mobile vs desktop render paths, aria attributes | Medium | Done | Covered by `src/components/ui/__tests__/app-sheet-modal.test.tsx` asserting desktop vs mobile variants, dirty close behavior, and footer action callbacks. |
| Data table core | `src/components/ui/data-table.tsx` | Column sorting, selection state, virtualization slots | High | Done | Covered by `src/components/ui/__tests__/data-table.test.tsx` validating pagination, sorting toggles, empty state, and row clicks. |
| Data table container | `src/components/ui/data-table-container.tsx` | Responsive layout, toolbar slots, sticky headers | Medium | Done | Covered by `src/components/ui/__tests__/data-table-container.test.tsx` asserting base wrapper classes and inner width guards. |
| Date/time picker | `src/components/ui/date-time-picker.tsx` | Timezone defaults, validation boundaries | Medium | Done | Covered by `src/components/ui/__tests__/date-time-picker.test.tsx` for formatted labels, date selection, time adjustments, and clearing. |
| KPI presets | `src/components/ui/kpi-presets.ts` | Metric formatting, threshold coloring | Low | Done | Covered by `src/components/ui/__tests__/kpi-presets.test.ts` (base classes + overrides). |
| Loading presets | `src/components/ui/loading-presets.tsx` | Skeleton variants, accessibility roles | Low | Done | Covered by `src/components/ui/__tests__/loading-presets.test.tsx` validating wrapper classes and variant props. |
| Long press confirmation button | `src/components/ui/long-press-button.tsx` | Hold lifecycle, countdown feedback, completion reset | Medium | Done | Covered by `src/components/ui/__tests__/long-press-button.test.tsx` asserting hold/confirm interactions and post-confirm reset. |
| Toast hook | `src/components/ui/use-toast.ts` | Queue handling, duplicate suppression, dismissal timers | Medium | Done | Covered by `src/components/ui/__tests__/use-toast.test.ts` using fake timers for queue limits, updates, and dismiss removal. |
| Toast renderer | `src/components/ui/toaster.tsx` | Mount/unmount behavior, focus management | Medium | Done | Covered by `src/components/ui/__tests__/toaster.test.tsx` ensuring toast rendering and viewport accessibility. |
| Segmented control | `src/components/ui/segmented-control.tsx` | Value switching, disabled tooltips, indicator alignment | Medium | Done | Covered by `src/components/ui/__tests__/segmented-control.test.tsx` validating selection state, disabled guard, and tooltip content. |
| Page header layout | `src/components/ui/page-header.tsx` | Sticky wrapper, responsive slots, action grouping | Low | Done | Covered by `src/components/ui/__tests__/page-header.test.tsx` confirming sticky classes and slot layout wrappers. |
| Pagination primitives | `src/components/ui/pagination.tsx` | i18n labels, aria-current handling, ellipsis semantics | Low | Done | Covered by `src/components/ui/__tests__/pagination.test.tsx` checking navigation labeling, active link, and ellipsis sr-only text. |
| Card primitives | `src/components/ui/card.tsx` | Section wrappers, class forwarding, text slots | Low | Done | Covered by `src/components/ui/__tests__/card.test.tsx` asserting class merging and content rendering across sections. |
| Progress display bar | `src/components/ui/progress-bar.tsx` | Completion labeling, success state styling, size variants | Low | Done | Covered by `src/components/ui/__tests__/progress-bar.test.tsx` validating label toggles, success coloring, and width calculations. |
| Progress primitive wrapper | `src/components/ui/progress.tsx` | Value-to-transform mapping, default fallback state | Low | Done | Covered by `src/components/ui/__tests__/progress.test.tsx` ensuring default translate and value-driven offsets. |
| Switch toggle | `src/components/ui/switch.tsx` | Data-state transitions, controlled toggles, accessibility attributes | Low | Done | Covered by `src/components/ui/__tests__/switch.test.tsx` asserting unchecked/checked transitions and controlled updates. |
| Toast primitives | `src/components/ui/toast.tsx` | Viewport mounting, variant styling, close/action wiring | Medium | Done | Covered by `src/components/ui/__tests__/toast.test.tsx` confirming viewport class merge, destructive styling, and close attributes. |
| Truncated text tooltip wrapper | `src/components/TruncatedTextWithTooltip.tsx` | Overflow detection, tooltip reveal, delay overrides | Low | Done | Covered by `src/components/__tests__/TruncatedTextWithTooltip.test.tsx` for empty text guard, non-truncated hover, and truncated tooltip display. |
| Shared activity timeline primitives | `src/components/shared/ActivityTimeline.tsx`, `ActivityTimelineItem.tsx`, `ActivityForm.tsx` | Entry rendering, completion toggles, validation | High | Done | Covered via `src/components/__tests__/ActivityTimeline.test.tsx`, `ActivityTimelineItem.test.tsx`, and `ActivityForm.test.tsx` asserting grouping, project context, toggle wiring, form validation, and reminder scheduling. |
| Onboarding tutorial surfaces | `src/components/shared/BaseOnboardingModal.tsx`, `OnboardingTutorial.tsx`, `TutorialFloatingCard.tsx`, `TutorialExitGuardDialog.tsx` | Step progression, exit guards, analytics events | Medium | Done | Covered via `src/components/__tests__/BaseOnboardingModal.test.tsx`, `OnboardingTutorial.test.tsx`, `TutorialFloatingCard.test.tsx`, and `TutorialExitGuardDialog.test.tsx` locking modal actions, floating card gating, exit guard disables, and navigation hand-offs. |
| Advanced data table primitives | `src/components/data-table/AdvancedDataTable.tsx`, `AdvancedDataTablePagination.tsx`, `TableSearchInput.tsx`, `useAdvancedTableSearch.ts`, `useDraftFilters.ts` | Column config wiring, virtualization, draft filter sync | High | Not Started | Temporarily skipped `AdvancedDataTable` suites due to Jest hangs during CI. Revisit once we have a deterministic IntersectionObserver/test-utils strategy. |
| Template builder asset utilities | `src/components/template-builder/ImageUpload.tsx`, `EmojiPicker.tsx`, `TemplateErrorBoundary.tsx`, `ImageLibrarySheet.tsx` | Upload flows, emoji insertion, asset library management, error boundaries | Medium | Done | Covered by `src/components/template-builder/__tests__/TemplateBuilderEditors.test.tsx`, `TemplateBuilderPreview.test.tsx`, `TemplateBuilderDialogs.test.tsx`, and `TemplateBuilderStorage.test.tsx` validating uploads, clipboard copy, alt text inline edits, send-test behavior, emoji insertion, error fallback reset, and storage thresholds. |
| Milestone notification helpers | `src/hooks/useMilestoneNotifications.ts`, `useNotificationTriggers.ts` | Legacy wrapper behavior, trigger escalations, error fallbacks | Low | Done | `src/hooks/__tests__/useMilestoneNotifications.test.ts` locks console warning + trigger passthrough; keep `useNotificationTriggers` suite as-is. |

### Supabase Edge Functions & Automation
| Area | File(s) | What to Cover | Priority | Status | Notes |
| --- | --- | --- | --- | --- | --- |
| Workflow executor | `supabase/functions/workflow-executor/index.ts` | Trigger filtering, duplicate prevention, action switch | High | Done | Covered by `supabase/functions/tests/workflow-executor.test.ts` for action dispatch, reminder scheduling, and duplicate guards. |
| Session reminder processor | `supabase/functions/process-session-reminders/index.ts` | Due reminder selection, workflow invocation, failure handling | High | Done | Covered by `supabase/functions/tests/process-session-reminders.test.ts` simulating mixed payloads and idempotent updates. |
| Reminder notifications sender | `supabase/functions/send-reminder-notifications/index.ts` | Email templating branches, batch mode, auth flows | High | Done | Covered via `supabase/functions/tests/send-reminder-notifications.test.ts` for assignment + milestone paths with mocked Resend/Supabase. |
| Notification queue processor | `supabase/functions/notification-processor/index.ts` | Queue polling, retry logic, failure escalation | Medium | Done | Covered by `supabase/functions/tests/notification-processor.test.ts` exercising settings gating, retry RPCs, and email dispatch wiring. |
| Daily scheduling cron | `supabase/functions/schedule-daily-notifications/index.ts` | Window calculations, dedupe of scheduled jobs | Medium | Done | Covered by `supabase/functions/tests/schedule-daily-notifications.test.ts` with fixed clock + insert/dedupe paths. |
| Simplified daily scheduler | `supabase/functions/simple-daily-notifications/index.ts` | Lightweight cron fallback, idempotent inserts | Low | Done | Covered by `supabase/functions/tests/simple-daily-notifications.test.ts` confirming empty queue exit and error surfacing. |
| Template email sender | `supabase/functions/send-template-email/index.ts` | Template lookup, localization, Resend payload | High | Done | Validated via `supabase/functions/tests/send-template-email.test.ts` for placeholder fallbacks and block ordering. |
| User email lookup | `supabase/functions/get-users-email/index.ts` | Auth enforcement, filtering, pagination | Medium | Done | Covered by `supabase/functions/tests/get-users-email.test.ts` for happy path, validation, and failure skips. |
| Email localization helpers | `supabase/functions/_shared/email-i18n.ts` | Language normalization, fallback to EN, list helpers | Low | Done | Validated via `supabase/functions/tests/email-i18n.test.ts` for default, Turkish, and fallback behaviors. |
| Test callback harness | `supabase/functions/test-callback/index.ts` | Echo behavior, validation of payload schema | Low | Done | Covered by `supabase/functions/tests/test-callback.test.ts` for CORS, metadata rendering, and error handling. |
| Session type deletion guard | `supabase/functions/session-types-delete/index.ts` | In-use protection, localized error handling, success messaging | Medium | Done | Covered by `supabase/functions/tests/session-types-delete.test.ts` for referenced-type rejection and happy-path deletion. |

_Statuses_: `Not started`, `In progress`, `Blocked`, `Ready for review`, `Done`. Update the relevant table after every iteration that touches a listed area; add new rows when new risk surfaces.

## How We Work Iteratively
1. **Before coding**: Pick an item, confirm or adjust its priority/notes, and announce in the PR description.
2. **During implementation**: Keep `src/utils/testUtils.tsx` helpers in mind; extend them if setup becomes noisy.
3. **After implementation**: Run `npm run test`; capture pass/fail output in the PR description and update the status table.
4. **Documentation touchpoint**: Add a bullet to the Iteration Log (below) with date, scope, and outcomes (tests added, gaps, follow-up).
5. **Follow-up tasks**: If something stays untested, file an explicit TODO row or GitHub issue link so it doesn’t vanish.

## Iteration Log
| Date | Owner | Scope | Outcome | Follow-up |
| --- | --- | --- | --- | --- |
| 2025-09-14 | Codex | Created initial testing strategy, inventory, and workflow checklist | Plan ready for review; no tests added yet | Populate owners/priorities once first test task begins |
| 2025-09-14 (later) | Codex | Expanded inventory to cover contexts, services, UI, and Supabase automation | Added multi-section target tables with priorities and notes | Review priorities with Tayte and assign owners in next iteration |
| 2025-09-14 (late) | Codex | Documented test harness choices and deepened inventory for hooks, UI primitives, and edge functions | Added harness guidance plus ~20 new targets spanning high-risk areas | Circle back to assign owners + integrate harness setup into tooling work |
| 2025-09-14 (night) | Codex | Wired Jest command and ESM-friendly config, added mocks | `npm run test` now passes (no tests yet) using SWC + jsdom | Document custom render helper + finalize test file convention |
| 2025-09-14 (late night) | Codex | Added GitHub Actions Jest workflow and Deno smoke harness | CI runs `npm test`; `deno task test` exercises functions scaffold | Start implementing High-priority unit tests |
| 2025-09-15 | Codex | Added Jest coverage for locale/time helpers | `src/lib/utils.test.ts` validates 12/24h formatting + week boundaries | Next: cover org caching utilities |
| 2025-09-15 (later) | Codex | Added tests for organization ID caching helper | `src/lib/organizationUtils.test.ts` covers cache reuse + org creation errors | Move on to organization settings hook |
| 2025-09-15 (even later) | Codex | Added React Query hook coverage for organization settings | `src/hooks/__tests__/useOrganizationSettings.test.tsx` asserts cache hydration, update/upsert, and error toasts | Next: tackle session form workflow |
| 2025-09-15 (late night) | Codex | Added session form workflow tests | `src/hooks/__tests__/useSessionForm.test.tsx` covers validation, Supabase payloads, trigger failure recovery | Next: move to reminder scheduling hook |
| 2025-09-15 (night) | Codex | Added session reminder scheduling tests | `src/hooks/__tests__/useSessionReminderScheduling.test.tsx` covers RPC success/fail, cancel + reschedule flows | Next: target service layer (ProjectService) |
| 2025-09-16 | Codex | Added aggregation coverage for ProjectService | `src/services/__tests__/ProjectService.test.ts` validates active/archived merge + filtering | Next: continue through remaining service targets |
| 2025-09-16 (later) | Codex | Added SessionService tests | `src/services/__tests__/SessionService.test.ts` checks archived filtering + filters/sorting | Next: move on to LeadService |
| 2025-09-16 (night) | Codex | Added LeadService tests | `src/services/__tests__/LeadService.test.ts` covers custom-field merge + filter/sort | Next: shift focus to components/UI |
| 2025-09-16 (late night) | Codex | Added Schedule Session dialog tests | `src/components/__tests__/ScheduleSessionDialog.test.tsx` + sheet coverage for open/dirty flow | Next: continue UI inventory |
| 2025-09-17 | Codex | Added SessionActions hook tests | `src/hooks/__tests__/useSessionActions.test.tsx` covers delete failure + status workflows | Next: tackle remaining utility modules |
| 2025-09-17 (later) | Codex | Added organization settings cache tests | `src/lib/__tests__/organizationSettingsCache.test.ts` verifies TTL/localStorage + inflight dedupe | Next: move to date utilities |
| 2025-10-25 | Codex | Added timezone utility coverage | `src/lib/dateFormatUtils.test.ts` exercises formatting fallbacks, timezone conversions, and detection helpers | Revisit if new formats/timezones are introduced |
| 2025-10-25 (later) | Codex | Added dynamic lead validation coverage | `src/lib/leadFieldValidation.test.ts` covers schema generation, sanitization, parsing, and validation helpers | Monitor if new field types or validation rules are introduced |
| 2025-10-25 (even later) | Codex | Added organization data helper coverage | `src/hooks/__tests__/useOrganizationData.test.ts` verifies org guards, ensure_* RPC calls, and placeholder handling | Re-run if new org-scoped queries land |
| 2025-10-25 (late) | Codex | Added workflow trigger wrapper coverage | `src/hooks/__tests__/useWorkflowTriggers.test.ts` checks validation, RPC errors, toast suppression, and wrapper payloads | Extend if new trigger types are introduced |
| 2025-10-25 (night) | Codex | Added user preferences hook coverage | `src/hooks/__tests__/useUserPreferences.test.ts` exercises bootstrap defaults, optimistic updates, error rollback, and cache helpers | Revisit when new preference fields are persisted |
| 2025-10-25 (late night) | Codex | Added lead status actions coverage | `src/hooks/__tests__/useLeadStatusActions.test.tsx` validates status updates, undo flow, auth guard, and destructive toasts | Extend when new status workflows land |
| 2025-10-25 (even later) | Codex | Added entity data helper coverage | `src/hooks/__tests__/useEntityData.test.tsx` covers toast fallback, dependency-triggered refetch, and custom error handler behavior | Revisit if hook gains additional options |
| 2025-10-25 (night late) | Codex | Added lead detail aggregator coverage | `src/hooks/__tests__/useLeadDetailData.test.tsx` validates metrics computation, combined queries, and refetch fan-out | Extend if summary payload shape changes |
| 2025-10-25 (almost midnight) | Codex | Added session edit form coverage | `src/hooks/__tests__/useSessionEditForm.test.tsx` checks dirty tracking, validation errors, workflow trigger + reminder paths | Revisit when edit form adds new fields |
| 2025-10-25 (midnight) | Codex | Added lead detail service coverage | `src/services/__tests__/LeadDetailService.test.ts` covers fetch helpers, archived filtering, payment aggregation, and activity fallbacks | Extend when service gains additional data sources |
| 2025-10-25 (late night) | Codex | Added reminder actions coverage | `src/hooks/__tests__/useReminderActions.test.ts` verifies delete/update success toasts, null handling, and error paths | Extend if reminder actions gain additional mutations |
| 2025-10-25 (past midnight) | Codex | Added project payments hook coverage | `src/hooks/__tests__/useProjectPayments.test.tsx` aggregates totals, handles Supabase errors, and verifies refresh/refetch | Extend when payments logic adds currencies or statuses |
| 2025-10-25 (just after) | Codex | Added base entity service coverage | `src/services/__tests__/BaseEntityService.test.ts` validates org lookup failure handling and authenticated user guard | Revisit if service gains caching layers |
| 2025-10-25 (very late) | Codex | Added organization quick settings coverage | `src/hooks/__tests__/useOrganizationQuickSettings.test.tsx` ensures default fallback and refresh passthrough | Extend if quick settings grow beyond boolean toggles |
| 2025-10-25 (night owl) | Codex | Added organization timezone hook coverage | `src/hooks/__tests__/useOrganizationTimezone.test.ts` confirms settings-driven formats and browser fallback | Revisit when timezone settings grow more nuanced |
| 2025-10-25 (early morning) | Codex | Added notification triggers hook coverage | `src/hooks/__tests__/useNotificationTriggers.test.ts` validates milestone creation, scheduling, processing, and retry flows with error toasts | Extend when new trigger actions are added |
| 2025-10-25 (pre-dawn) | Codex | Added settings section manager coverage | `src/hooks/__tests__/useSettingsSection.test.ts` covers dirty tracking, manual and auto-save flows, and toast behaviors | Revisit if additional throttling options are introduced |
| 2025-10-25 (early morning++) | Codex | Added template validation hook + calendar monitor coverage | `src/hooks/__tests__/useTemplateValidation.test.ts` and `src/hooks/__tests__/useCalendarPerformanceMonitor.test.ts` ensure validation warnings and performance monitoring warnings | Extend when validation or monitoring logic expands |
| 2025-10-25 (sunrise) | Codex | Added template validation hook coverage | `src/hooks/__tests__/useTemplateValidation.test.ts` checks required fields, placeholder usage, and published template safeguards | Extend if validation rules expand |
| 2025-10-25 (after midnight) | Codex | Added project sessions summary hook coverage | `src/hooks/__tests__/useProjectSessionsSummary.test.tsx` groups statuses, detects overdue/today/upcoming, and handles refresh triggers | Extend when summary introduces new status categories |
| 2025-10-25 (morning) | Codex | Added Session Types settings coverage | `src/components/__tests__/SessionTypesSection.test.tsx` ensures empty state, default assignment, activation toggle, and deletion flows | Revisit when session type UI adds drag/reorder or bulk actions |
| 2025-10-25 (late morning) | Codex | Added session lifecycle sorting coverage | `src/lib/sessionSorting.test.ts` exercises lifecycle prioritization, legacy fallbacks, and time-based ordering | Extend when additional lifecycle states are introduced |
| 2025-10-25 (mid-morning) | Codex | Added relative date helper coverage | `src/lib/dateUtils.test.ts` validates today/tomorrow/yesterday copy, overdue detection, and display classes | Revisit if relative copy or status strings change |
| 2025-10-25 (near noon) | Codex | Added session naming + input handler coverage | `src/lib/sessionUtils.test.ts` covers naming priority + trimming; `src/lib/inputUtils.test.ts` normalizes change/blur flows | Extend if additional handlers or naming rules appear |
| 2025-10-25 (midday) | Codex | Added template utilities, payment colors, and project summary builder coverage | `src/lib/templateUtils.test.ts`, `src/lib/paymentColors.test.ts`, and `src/lib/projects/buildProjectSummaryItems.test.tsx` validate helper fallbacks, palette safety, and summary chips/info renders | Revisit when template helpers gain new placeholders or summary chips change |
| 2025-10-25 (afternoon) | Codex | Added protected route, offline banner, and KPI preset coverage | `src/components/__tests__/ProtectedRoute.test.tsx`, `src/components/__tests__/OfflineBanner.test.tsx`, and `src/components/ui/__tests__/kpi-presets.test.ts` cover loading redirects, connectivity retries, and preset styling contracts | Revisit if onboarding flow or preset catalog changes |
| 2025-10-25 (late afternoon) | Codex | Added validation helpers, context coverage, and UI prefetch/status fields | `src/lib/validation.test.ts`, `src/contexts/__tests__/AuthContext.test.tsx`, `src/contexts/__tests__/OrganizationContext.test.tsx`, `src/contexts/__tests__/OnboardingContext.test.tsx`, plus `src/components/__tests__/RoutePrefetcher.test.tsx`, `src/components/__tests__/SessionStatusBadge.test.tsx`, and `src/components/__tests__/SessionFormFields.test.tsx` harden schema guards, auth/org onboarding flows, and booking UI surfaces | Revisit when validation, onboarding, or session UI flows expand |
| 2025-10-26 | Codex | Added ProjectPaymentsSection coverage | `src/components/__tests__/ProjectPaymentsSection.test.tsx` verifies summary cards, empty state, and refresh callback | Continue tackling SessionsSection and EnhancedSessionsSection components |
| 2025-10-26 (later) | Codex | Reconciled Contexts/Hooks snapshot with remaining gaps | Updated progress table to show TemplateBuilder hook still pending | Add tests for `useTemplateBuilder` hook |
| 2025-10-26 (even later) | Codex | Added SessionsSection coverage | `src/components/__tests__/SessionsSection.test.tsx` ensures loading skeleton, empty state messaging, and sheet interactions | Next: Extend coverage to EnhancedSessionsSection flows |
| 2025-10-26 (night) | Codex | Added EnhancedSessionsSection coverage | `src/components/__tests__/EnhancedSessionsSection.test.tsx` verifies lifecycle sorting order, count badge rendering, and banner click wiring | Next: Monitor virtualization thresholds or analytics hooks if they land |
| 2025-10-26 (late night+) | Codex | Added Enhanced lead edit dialog coverage | `src/components/__tests__/EnhancedEditLeadDialog.test.tsx` exercises prefill, dirty-state detection, validation errors, and Supabase update success toasts | Revisit when dynamic field schema or toast messaging changes |
| 2025-10-26 (early dawn) | Codex | Added EnhancedProjectDialog coverage | `src/components/__tests__/EnhancedProjectDialog.test.tsx` loads defaults and verifies cancel-driven reset flows | Monitor if project dialog gains new pricing or lead workflows |
| 2025-10-26 (morning++) | Codex | Added App sidebar navigation coverage | `src/components/__tests__/AppSidebar.test.tsx` ensures active-route highlighting and admin/support menu gating | Revisit onboarding lock behaviour when navigation restrictions change |
| 2025-10-26 (afternoon) | Codex | Added loading preset skeleton coverage | `src/components/ui/__tests__/loading-presets.test.tsx` verifies wrapper styling, variant props, and compact/grid fallbacks | Next: Cover toast hook + toaster once queue logic stabilizes |
| 2025-10-26 (evening) | Codex | Added long press confirmation button coverage | `src/components/ui/__tests__/long-press-button.test.tsx` validates hold lifecycle, countdown messaging, and completion reset | Follow up by tackling toast hook/toaster queue scenarios |
| 2025-10-26 (late evening) | Codex | Added ReminderCard, MobileStickyNav, and TimezoneSelector coverage | `src/components/__tests__/ReminderCard.test.tsx`, `src/components/__tests__/MobileStickyNav.test.tsx`, `src/components/__tests__/TimezoneSelector.test.tsx` harden reminder badges/toggles, bookings navigation, and timezone auto-detect flows | Keep chipping away at remaining UI component gaps |
| 2025-10-26 (nightfall) | Codex | Added FilterBar + guided mode button coverage | `src/components/__tests__/FilterBar.test.tsx`, `src/components/__tests__/RestartGuidedModeButton.test.tsx`, and `src/components/__tests__/ExitGuidanceModeButton.test.tsx` verify sheet interactions, onboarding resets, navigation locks, and toast flows | Next: Target DeadSimpleSessionBanner and WorkflowHealthDashboard components |
| 2025-10-26 (late night++) | Codex | Added DeadSimpleSessionBanner, WorkflowHealthDashboard, and GuidedStepProgress coverage | `src/components/__tests__/DeadSimpleSessionBanner.test.tsx`, `src/components/__tests__/WorkflowHealthDashboard.test.tsx`, and `src/components/__tests__/GuidedStepProgress.test.tsx` capture relative date badges, health states, and animated progress behavior | Next: Circle back to SessionsSection and SessionSchedulingSheet components |
| 2025-10-27 | Codex | Hardened UnifiedClientDetails and toast hook coverage | Added `src/components/__tests__/UnifiedClientDetails.test.tsx` and `src/components/ui/__tests__/use-toast.test.ts` while reconciling sheet/section status rows | Next: Target `GlobalSearch` debounced query flows |
| 2025-10-28 | Codex | Added Session banner, User menu, and UI primitive coverage | Added tests for `src/components/SessionBanner.tsx`, `src/components/UserMenu.tsx`, and new UI primitives (`segmented-control`, `page-header`, `pagination`, `card`) to lock in action handling and accessibility | Next: Focus on GlobalSearch keyboard interactions and Supabase function harnesses |
| 2025-10-28 (later still) | Codex | Completed remaining UI primitive gaps | Added `src/components/ui/__tests__/progress-bar.test.tsx`, `progress.test.tsx`, `switch.test.tsx`, and `toast.test.tsx` to cover progress transforms, toggle data-state transitions, and toast viewport/variant styling | Next: Begin data-table primitive harness and toast renderer coverage |
| 2025-10-29 | Codex | Added Supabase automation coverage | Added Deno tests for `get-users-email`, `schedule-daily-notifications`, and shared email localization helpers to verify validation, scheduling, and i18n fallbacks | Continue expanding coverage across remaining notification + workflow functions |
| 2025-10-29 (later) | Codex | Added session reminder processor coverage | Added Deno tests for `process-session-reminders` covering fetch failures, invalid session data guards, workflow trigger errors, and cleanup RPC execution | Next: target `send-reminder-notifications` and `workflow-executor` orchestration paths |
| 2025-10-29 (night) | Codex | Added reminder notification coverage | Added `supabase/functions/tests/send-reminder-notifications.test.ts` to cover assignment opt-out/success and milestone fan-out flows with injected Resend client | Next: Expand `workflow-executor` orchestration tests |
| 2025-10-30 | Codex | Added workflow executor + template email coverage | `supabase/functions/tests/workflow-executor.test.ts` validates trigger filtering, duplicate prevention, and action dispatch; `supabase/functions/tests/send-template-email.test.ts` locks placeholder fallbacks and block ordering | Next: Cover notification processor queue handling and simple daily scheduler paths |
| 2025-10-30 (late night+++) | Codex | Added notification processor guard coverage | `supabase/functions/tests/notification-processor.test.ts` locks settings gating, retry RPC success/error, milestone forwarding, and workflow email templating | Follow up by simulating batch processing + resend failure branches |
| 2025-10-30 (night wrap) | Codex | Added simple daily scheduler handler coverage | `supabase/functions/tests/simple-daily-notifications.test.ts` verifies empty-queue exit and bubbled fetch errors via injected supabase factory | Consider adding fixture-driven tests for timezone-aligned processing |
| 2025-10-30 (final wrap) | Codex | Added test callback harness coverage | `supabase/functions/tests/test-callback.test.ts` covers OPTIONS CORS headers, metadata echo, and error surfacing | No follow-up; keep function as diagnostic surface |
| 2025-10-30 (night wrap++) | Codex | Added lead detail page coverage | `src/pages/__tests__/LeadDetail.test.tsx` locks loading skeleton, summary wiring, quick status buttons, and fetch error toasts | Next: tackle ProjectDetail page data orchestration |
| 2025-10-31 | Codex | Added Project detail page coverage | `src/pages/__tests__/ProjectDetail.test.tsx` exercises successful fetch composition and missing-project redirect toast | Next: Cover Calendar and UpcomingSessions pages |
| 2025-10-31 (later still) | Codex | Added Calendar and Upcoming Sessions page coverage | `src/pages/__tests__/Calendar.test.tsx` and `src/pages/__tests__/UpcomingSessions.test.tsx` lock view toggles, KPI metrics, segment filtering, and session sheet navigation | Next: Tackle AllProjects workspace sorting/export flows |
| 2025-11-01 | Codex | Added AllProjects workspace coverage | `src/pages/__tests__/AllProjects.test.tsx` verifies list defaults, archived toggle, quick view, and spreadsheet export success path | Next: Extend tests to cover board pagination and archived export error handling |
| 2025-11-02 | Codex | Added workflow delete dialog coverage | `src/components/__tests__/WorkflowDeleteDialog.test.tsx` locks translation usage, cancel/confirm callbacks, close handling, and disabled deletion state | Revisit if dialog gains secondary actions or additional messaging |
| 2025-11-03 | Codex | Added session detail page coverage | `src/pages/__tests__/SessionDetail.test.tsx` exercises skeleton-to-content transition, load failure toast, and delete redirect fallback | Next: Target Templates workspace coverage |
| 2025-11-03 (later) | Codex | Added Templates workspace coverage | `src/pages/__tests__/Templates.test.tsx` locks preview translation fallback, search empty states, duplication/deletion flows, and navigation callbacks | Next: Cover Project sheet view snapshot translations |
| 2025-11-04 | Codex | Added onboarding modal, workflow sheet, and project preview coverage | Added `src/components/__tests__/OnboardingModal.test.tsx`, `CreateWorkflowSheet.test.tsx`, and `ProjectSheetPreview.test.tsx` to validate modal flows, edit submission payloads, and Supabase-driven previews | Next: Target ProjectSheetView, ActivitySection, and LeadActivitySection components |
| 2025-11-05 | Codex | Added Project sheet view coverage | `src/components/__tests__/ProjectSheetView.test.tsx` covers data hydration, edit/save flow, and archive confirmation logic with mocked Supabase + toast hooks | Next: Continue with ActivitySection and LeadActivitySection coverage |
| 2025-11-05 (later) | Codex | Added activity timelines for leads/projects | Added `src/components/__tests__/ActivitySection.test.tsx` and `LeadActivitySection.test.tsx` to validate filter modes, creation toasts, history segments, and completion toggles | Monitor for new activity types or audit entities to extend fixtures |
| 2025-11-06 | Codex | Hardened settings pages for services, projects, and danger zone flows | Added `src/pages/settings/__tests__/Services.test.tsx`, `Projects.test.tsx`, and `DangerZone.test.tsx` to verify tutorial start/completion, section composition, and destructive guardrails | Follow up by covering `src/pages/settings/General.tsx` and profile/onboarding dialogs |
| 2025-11-08 | Codex | Audited coverage against current repo state | Updated progress snapshot and backlog rows for onboarding, payments, admin, and remaining settings screens/components with no tests | Assign owners for new high-priority gaps |
| 2025-11-09 | Codex | Added payments workspace hook coverage | `src/pages/payments/hooks/__tests__/usePaymentsData.test.ts`, `usePaymentsFilters.test.tsx`, and `usePaymentsTableColumns.test.tsx` lock Supabase pagination/search filters, draft thresholds, and column callbacks | Track future payments analytics or virtualization enhancements |
| 2025-11-10 | Codex | Added onboarding landing coverage for remaining pages | Added `src/components/__tests__/SampleDataModal.test.tsx`, `src/pages/__tests__/GettingStarted.test.tsx`, `Index.test.tsx`, and `NotFound.test.tsx` to exercise modal flows, guided redirects, marketing CTA, and 404 logging | Next: extend coverage to Payments page, ReminderDetails page, and settings context usage |
| 2025-11-11 | Codex | Added guard, language, and instrumentation component coverage | Added `src/components/__tests__/ErrorBoundary.test.tsx`, `LanguageSwitcher.test.tsx`, `PerformanceMonitor.test.tsx`, and `TruncatedTextWithTooltip.test.tsx` to lock fallback UI, language toggles, dev-only warnings, and truncation tooltips | Revisit when onboarding metrics expand or tooltip delays change |
| 2025-11-12 | Codex | Added Payments workspace page + component coverage | Added `src/pages/__tests__/Payments.test.tsx` alongside component specs for date controls, trend chart, metrics summary, and table section to verify filter resets, export flows, formatter output, and chart/empty states | Next: extend coverage to ReminderDetails page and remaining settings screens |
| 2025-11-13 | Codex | Added calendar component coverage | Added `src/components/calendar/__tests__/CalendarDay.test.tsx`, `CalendarDayView.test.tsx`, `CalendarMonthView.test.tsx`, `CalendarWeek.test.tsx`, `CalendarSkeleton.test.tsx`, and `CalendarErrorBoundary.test.tsx` to cover mobile/day/month/week interactions, skeleton scaffolds, and error recovery flows | Next: Explore coverage for calendar virtualization performance metrics and touch gesture edge cases |
| 2025-11-14 | Codex | Added reminder details page coverage | Added `src/pages/__tests__/ReminderDetails.test.tsx` to validate reminder stats, fetch error toasts, completion toggles, navigation, and project dialog fetches | Keep an eye on future reminder reschedule flows or provider refactors |
| 2025-11-15 | Codex | Added legacy payment & lead dialog coverage | Added `src/components/__tests__/AddPaymentDialog.test.tsx`, `EditPaymentDialog.test.tsx`, `AddLeadDialog.test.tsx`, and `EditLeadDialog.test.tsx`; refreshed progress snapshot totals | Monitor dialog flows if currency/localization options expand or navigation guard messaging changes |
| 2025-11-16 | Codex | Added project services and activity coverage | Added `src/components/__tests__/ProjectServicesSection.test.tsx` and `ProjectActivitySection.test.tsx` to validate services edit/save flows, validation toasts, reminders, and completion updates | Watch for future service pricing changes or activity form enhancements |
| 2025-11-17 | Codex | Added auth state helper coverage | Added `src/utils/authUtils.test.ts` to verify storage cleanup, global sign-out fallbacks, and navigation recovery flows | Next: cover `src/utils/entityUtils.ts` sorting/filtering edge cases |
| 2025-11-17 (later) | Codex | Added entity list utility coverage | Added `src/utils/entityUtils.test.ts` to exercise sorting heuristics, search filters, validation rules, formatting utilities, debounced callbacks, and date-filter counts | Next: cover `src/utils/onboardingCleanup.ts` RPC handling paths |
| 2025-11-17 (late) | Codex | Added onboarding cleanup RPC coverage | Added `src/utils/onboardingCleanup.test.ts` to validate RPC success responses, string fallback, and error logging for Supabase failures | Next: tackle `src/utils/onboardingValidation.ts` warning aggregation and guard matrix coverage |
| 2025-11-17 (late night++) | Codex | Added onboarding validation + performance utility coverage | Added `src/utils/onboardingValidation.test.ts` and `src/utils/performance.test.tsx` to lock system health auditing, stage guards, timing metrics, decorator hooks, and memory helpers | Next: cover `src/integrations/supabase/client.ts` auth cache + channel reuse |
| 2025-11-17 (midnight) | Codex | Added debounce and accessibility hook coverage | Added `src/hooks/__tests__/useDebounce.test.tsx` and `src/hooks/__tests__/useAccessibility.test.tsx` to verify debounced updates, timer cleanup, focus traps, screen reader announcements, keyboard navigation, and media query listeners | Next: cover `src/hooks/use-mobile.tsx` breakpoint detector and `src/hooks/useEntityActions.ts` concurrency handling |
| 2025-11-17 (late night++) | Codex | Added mobile, entity action, and data table hook coverage | Added `src/hooks/__tests__/use-mobile.test.tsx`, `useEntityActions.test.tsx`, and `useDataTable.test.tsx` to lock breakpoint detection, toast/error flows, concurrent action isolation, accessor sorting, and pagination/filter resets | Next: tackle `src/hooks/useKanbanSettings.ts` and workspace data hooks (`useLeadsData`, `useProjectsData`) |
| 2025-11-18 | Codex | Added Kanban settings hook coverage | Added `src/hooks/__tests__/useKanbanSettings.test.tsx` to confirm default fallbacks, memoized settings, and update flow via mocked organization settings | Next: focus on workspace data hooks (`useLeadsData`, `useLeadsFilters`, `useProjectsData`, `useProjectsFilters`) |
| 2025-11-18 (later) | Codex | Added leads/projects filter hook coverage | Added `src/pages/leads/hooks/__tests__/useLeadsFilters.test.tsx` and `src/pages/projects/hooks/__tests__/useProjectsFilters.test.tsx` to cover status toggles, summary chips, balance inputs, and reset flows | Next: finish data hook coverage (`useLeadsData`, `useProjectsData`) |
| 2025-11-18 (even later++) | Codex | Added help & support coverage | Added `src/components/modals/__tests__/HelpModal.test.tsx` and `src/components/support/__tests__/HelpOptionCard.test.tsx` to assert translation output, CTA callbacks, sheet toggles, and close handling | Follow-up: revisit `src/integrations/supabase/client.ts` when Jest mock plan is ready |
| 2025-11-18 (night) | Codex | Added settings shell + sticky nav coverage | Added `src/components/settings/__tests__/SettingsPageWrapper.test.tsx`, `SettingsLayout.test.tsx`, `SettingsStickyFooter.test.tsx`, `SettingsHelpButton.test.tsx`, and `src/components/navigation/__tests__/StickySectionNav.test.tsx` to cover settings save/cancel flows, onboarding locks, help sheet actions, and nav scroll/observer behavior | Still need Supabase client wrapper tests once ESM mocking strategy lands |
| 2025-11-18 (even later) | Codex | Added mobile navigation surface coverage | Added `src/components/mobile/__tests__/BottomSheetMenu.test.tsx` and `MobileBottomNav.test.tsx` to validate sheet toggles, navigation vs. scroll behavior, UserMenu callbacks, and sign-out error toasts | Still need Supabase client wrapper tests once mocking strategy for auto-generated module is in place |
| 2025-11-19 | Codex | Added activity timeline primitive coverage | Added `src/components/__tests__/ActivityTimeline.test.tsx`, `ActivityTimelineItem.test.tsx`, and `ActivityForm.test.tsx` to exercise grouping, project context, completion toggles, and reminder scheduling validation | Next: focus on onboarding tutorial surfaces and advanced data table primitives |
| 2025-11-19 (later) | Codex | Added onboarding tutorial surface coverage | Added `src/components/__tests__/BaseOnboardingModal.test.tsx`, `OnboardingTutorial.test.tsx`, `TutorialFloatingCard.test.tsx`, and `TutorialExitGuardDialog.test.tsx` to validate modal progression, floating card gating, exit guard controls, and tutorial navigation hooks | Next: tackle advanced data table primitives and template builder surfaces |
| 2025-11-19 (even later) | Codex | Added template builder editing & preview coverage | Added `src/components/template-builder/__tests__/TemplateBuilderEditors.test.tsx`, `TemplateBuilderPreview.test.tsx`, `TemplateBuilderDialogs.test.tsx`, and `TemplateBuilderStorage.test.tsx` to cover block editing, form validation, channel previews, send-test behavior, storage indicators, and deletion dialogs | Next: focus on template builder asset utilities and advanced data table primitives |
| 2025-11-25 | Codex | Locked schedule picker hover + session-type guard coverage | Added `src/components/__tests__/CalendarTimePicker.test.tsx`, `TimeSlotPicker.test.tsx`, and `supabase/functions/tests/session-types-delete.test.ts` to verify hover contrast, smooth scroll to planned sessions, and in-use deletion guard messaging | Next: Layer integration coverage for wizard edit/reschedule flows and complete the remaining edge-function audit for `session_type_id` adoption |
| 2025-11-26 | Codex | Planned wizard integration + Supabase client coverage | Documented backlog entries for `SessionPlanningWizard` integration specs and the Supabase client mocking harness to unblock Phase 5 testing | Next: Build the Supabase mock factory and land the first integration spec |
| 2025-11-26 (later) | Codex | Added weekly schedule preview + session planning integration tests | Added `src/components/__tests__/WeeklySchedulePreview.test.tsx`, updated `CalendarTimePicker.test.tsx`, and introduced `SessionPlanningProvider.integration.test.tsx` to validate duration stretch, overlap columns, and reducer-driven edit flows | Next: Mock Supabase client wrapper + extend edge-function audit harness |
| 2025-11-26 (night+) | Codex | Locked wizard-only scheduling entry points | Replaced legacy `SessionSchedulingSheet` and `EditSessionDialog` implementations with the Session Planning Wizard, added `SessionSchedulingSheet.test.tsx` to assert wizard delegation, and removed the deprecated forms now that adoption is confirmed | Follow-up: add wizard regression tests once Supabase mock approach is defined |
| 2025-11-27 | Codex | Added wizard start-step coverage | Added `SessionPlanningWizardSheet.test.tsx` with lightweight Supabase + modal mocks alongside `SessionPlanningReducer.startStep.test.ts` to verify start-step overrides and contextual defaults | Follow-up: none for start-step; broader wizard flows can expand once needed |

## Maintenance Rules of Thumb
- Treat this file like the single source of truth for unit testing status—update it in the same PR as any test additions or strategy changes.
- When removing or refactoring tests, adjust both the inventory row and the Iteration Log so historical context remains.
- If a new high-risk area appears (e.g., new Supabase RPC, major hook), add it to the inventory before merging its feature.
- Keep the tone approachable (this doc doubles as an onboarding quickstart); if jargon slips in, add a short translation.
- Update the **Progress Snapshot** table after every iteration to reflect the latest done/total ratios.

## Helpful References
- `src/setupTests.ts`: global mocks for Supabase, React Router, and performance APIs.
- `src/utils/testUtils.tsx`: custom `render` helper with React Query + Router + Theme providers.
- `.codex/rules.md`: full rule set covering deployment expectations, testing requirements, and commit etiquette.
