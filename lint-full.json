[{"filePath":"/Users/taytemiz/Desktop/Lumiso/eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/jest.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/__mocks__/fileMock.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/__mocks__/styleMock.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ActivitySection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/AddLeadDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/AddPaymentDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/AppSidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/CalendarTimePicker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ClientDetailsCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ClientDetailsList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/CreateWorkflowSheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/CrmDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/DateRangePicker.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2019,2022],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2019,2022],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\nimport { format } from \"date-fns\";\nimport { CalendarIcon } from \"lucide-react\";\nimport type { DateRange } from \"react-day-picker\";\nimport { cn, getUserLocale } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport ReactCalendar from \"react-calendar\";\nimport \"react-calendar/dist/Calendar.css\";\nimport \"@/components/react-calendar.css\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface DateRangePickerProps {\n  dateRange?: DateRange;\n  onDateRangeChange: (range: DateRange | undefined) => void;\n  className?: string;\n}\n\nexport const DateRangePicker = ({ dateRange, onDateRangeChange, className }: DateRangePickerProps) => {\n  const { t } = useTranslation('forms');\n  const [isOpen, setIsOpen] = useState(false);\n\n  const browserLocale = getUserLocale();\n\n  const formatDateRange = (range: DateRange | undefined) => {\n    if (!range?.from) {\n      return t('dateRangePicker.placeholder');\n    }\n    if (!range.to) {\n      return format(range.from, \"MMM dd, yyyy\");\n    }\n    return `${format(range.from, \"MMM dd, yyyy\")} - ${format(range.to, \"MMM dd, yyyy\")}`;\n  };\n\n  return (\n    <Popover open={isOpen} onOpenChange={setIsOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          className={cn(\n            \"justify-start text-left font-normal whitespace-nowrap max-w-xs\",\n            !dateRange && \"text-muted-foreground\",\n            className\n          )}\n        >\n          <CalendarIcon className=\"mr-2 h-4 w-4\" />\n          {formatDateRange(dateRange)}\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-auto p-0 border shadow-lg\" align=\"start\">\n        <ReactCalendar\n          className=\"react-calendar w-full p-2 pointer-events-auto\"\n          locale={browserLocale}\n          selectRange\n          next2Label={null}\n          prev2Label={null}\n          onChange={(value: any) => {\n            if (Array.isArray(value)) {\n              const [from, to] = value as [Date | null, Date | null];\n              const range: DateRange | undefined = from\n                ? { from: from as Date, to: (to as Date) || undefined }\n                : undefined;\n              onDateRangeChange(range);\n              if (from && to) setIsOpen(false);\n            }\n          }}\n          value={dateRange?.from ? [dateRange.from, dateRange.to || dateRange.from] : null}\n          formatShortWeekday={(_, date) => new Intl.DateTimeFormat(browserLocale, { weekday: 'short' }).format(date)}\n        />\n      </PopoverContent>\n    </Popover>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/DeadSimpleSessionBanner.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5572,5575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5572,5575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { AlertTriangle, Clock, ChevronRight } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { formatTime, cn, getUserLocale, formatLongDate } from \"@/lib/utils\";\nimport { getRelativeDate, isOverdueSession } from \"@/lib/dateUtils\";\nimport { SessionStatusBadge } from \"@/components/SessionStatusBadge\";\nimport { useOrganizationSettings } from \"@/hooks/useOrganizationSettings\";\nimport { getDisplaySessionName } from \"@/lib/sessionUtils\";\nimport { useFormsTranslation } from '@/hooks/useTypedTranslation';\nimport { TruncatedTextWithTooltip } from \"@/components/TruncatedTextWithTooltip\";\n\ntype SessionStatus = \"planned\" | \"completed\" | \"cancelled\" | \"no_show\" | \"rescheduled\" | \"in_post_processing\" | \"delivered\";\n\ninterface Session {\n  id: string;\n  session_name?: string | null;\n  session_date: string;\n  session_time?: string;\n  notes?: string;\n  status: SessionStatus;\n  project_id?: string;\n  lead_id: string;\n  projects?: {\n    name: string;\n    project_types?: {\n      name: string;\n    };\n  };\n  leads?: {\n    name?: string;\n  };\n}\n\ninterface DeadSimpleSessionBannerProps {\n  session: Session;\n  onClick: (sessionId: string) => void;\n}\n\nconst DeadSimpleSessionBanner = ({ session, onClick }: DeadSimpleSessionBannerProps) => {\n  const { settings: orgSettings } = useOrganizationSettings();\n  const userLocale = getUserLocale();\n  const { t } = useFormsTranslation();\n\n  const formatSessionTime = (timeString: string): string => {\n    return formatTime(timeString, userLocale, orgSettings?.time_format || undefined);\n  };\n\n  const formatSessionDate = (dateString: string): string => {\n    const relativeDate = getRelativeDate(dateString, t);\n    const todayText = t('relativeDates.today');\n    const tomorrowText = t('relativeDates.tomorrow');\n    const yesterdayText = t('relativeDates.yesterday');\n    \n    if (relativeDate === todayText || relativeDate === tomorrowText || relativeDate === yesterdayText) {\n      return relativeDate;\n    }\n    // Use browser locale for long date format (e.g., \"22 AÄŸu 2025 Cum\")\n    return formatLongDate(dateString, userLocale);\n  };\n\n  const getTimeIndicator = (session: Session) => {\n    const relativeDate = getRelativeDate(session.session_date, t);\n    const isOverdue = isOverdueSession(session.session_date, session.status);\n    \n    if (isOverdue) {\n      return {\n        label: t('relativeDates.past_due'),\n        leftBorder: \"border-l-4 border-l-orange-500\",\n        labelBg: \"bg-orange-100 text-orange-800\"\n      };\n    }\n    \n    if (relativeDate === t('relativeDates.today')) {\n      return {\n        label: t('relativeDates.today'),\n        leftBorder: \"border-l-4 border-l-blue-500\",\n        labelBg: \"bg-blue-100 text-blue-800\"\n      };\n    }\n    \n    if (relativeDate === t('relativeDates.tomorrow')) {\n      return {\n        label: t('relativeDates.tomorrow'),\n        leftBorder: \"border-l-4 border-l-green-500\",\n        labelBg: \"bg-green-100 text-green-800\"\n      };\n    }\n    \n    return {\n      label: null,\n      leftBorder: \"border-l-4 border-l-gray-200\",\n      labelBg: null\n    };\n  };\n\n  const timeIndicator = getTimeIndicator(session);\n  const isOverdue = isOverdueSession(session.session_date, session.status);\n\n  return (\n    <div\n      className={cn(\n        \"w-full bg-white border border-gray-200 rounded-lg p-4 cursor-pointer hover:bg-gray-50 transition-colors\",\n        timeIndicator.leftBorder\n      )}\n      onClick={() => onClick(session.id)}\n    >\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between w-full gap-3 sm:gap-4\">\n        {/* Left: Date and Time (2 lines) */}\n        <div className=\"flex-shrink-0\">\n          <div className=\"text-sm font-medium text-gray-900\">\n            {formatSessionDate(session.session_date)}\n          </div>\n          {session.session_time && (\n            <div className=\"text-xs text-gray-500 flex items-center gap-1 mt-0.5\">\n              <Clock className=\"h-3 w-3\" />\n              {formatSessionTime(session.session_time)}\n            </div>\n          )}\n        </div>\n\n        {/* Divider - only on desktop */}\n        <div className=\"hidden sm:block w-px h-8 bg-gray-200\"></div>\n\n        {/* Middle: Session details */}\n        <div className=\"flex-1 min-w-0 space-y-1\">\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <span className=\"text-sm font-semibold text-gray-900\">\n              {getDisplaySessionName(session)}\n            </span>\n            {timeIndicator.label && (\n              <Badge variant=\"secondary\" className={cn(\"text-xs px-2 py-1\", timeIndicator.labelBg)}>\n                {timeIndicator.label}\n              </Badge>\n            )}\n            {isOverdue && (\n              <AlertTriangle className=\"h-4 w-4 text-orange-500 flex-shrink-0\" />\n            )}\n          </div>\n          \n          {session.projects?.name && (\n            <div className=\"text-xs text-gray-500\">\n              {t('sessionLabels.project')}: {session.projects.name}\n            </div>\n          )}\n          \n          {session.notes && (\n            <TruncatedTextWithTooltip\n              text={session.notes}\n              lines={2}\n              className=\"text-xs text-gray-600\"\n              as=\"div\"\n              tooltipSide=\"bottom\"\n              tooltipAlign=\"start\"\n            />\n          )}\n        </div>\n\n        {/* Right: Status and arrow */}\n        <div className=\"flex items-center gap-3 flex-shrink-0 self-start sm:self-center\">\n          <SessionStatusBadge\n            sessionId={session.id}\n            currentStatus={session.status as any}\n            editable={false}\n            onStatusChange={() => {}}\n            size=\"sm\"\n          />\n          <ChevronRight className=\"h-4 w-4 text-gray-400\" />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default DeadSimpleSessionBanner;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/DynamicLeadFormFields.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/EditLeadDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/EditPaymentDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/EditSessionDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/EnhancedAddLeadDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/EnhancedEditLeadDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/EnhancedSessionsSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1957,1960],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1957,1960],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport DeadSimpleSessionBanner from \"@/components/DeadSimpleSessionBanner\";\nimport { sortSessionsByLifecycle, SessionWithStatus } from \"@/lib/sessionSorting\";\nimport { useFormsTranslation } from '@/hooks/useTypedTranslation';\n\ntype SessionStatus = \"planned\" | \"completed\" | \"cancelled\" | \"no_show\" | \"rescheduled\" | \"in_post_processing\" | \"delivered\";\n\ninterface Session extends SessionWithStatus {\n  session_time?: string;\n  notes?: string;\n}\n\ninterface EnhancedSessionsSectionProps {\n  sessions: Session[];\n  loading?: boolean;\n  onSessionClick: (sessionId: string) => void;\n}\n\nconst EnhancedSessionsSection = ({ sessions, loading, onSessionClick }: EnhancedSessionsSectionProps) => {\n  const { t } = useFormsTranslation();\n  \n  if (loading) {\n    return (\n      <div className=\"w-full bg-blue-50/50 border border-blue-100 rounded-lg p-6\">\n        <div className=\"animate-pulse space-y-3\">\n          <div className=\"h-4 bg-muted rounded w-1/4\"></div>\n          <div className=\"space-y-3\">\n            {[1, 2, 3, 4].map((i) => (\n              <div key={i} className=\"h-16 bg-muted rounded-lg\"></div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (sessions.length === 0) {\n    return null;\n  }\n\n  // Sort sessions by lifecycle priority (active -> completed -> cancelled)\n  const sortedSessions = sortSessionsByLifecycle(sessions);\n\n  return (\n    <div className=\"w-full bg-blue-50/50 border border-blue-100 rounded-lg p-6 mb-6\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold\">{t('sessions_form.title')}</h3>\n        <Badge variant=\"secondary\">\n          {sessions.length}\n        </Badge>\n      </div>\n      \n      <div className=\"space-y-3\">\n        {sortedSessions.map((session) => (\n          <DeadSimpleSessionBanner\n            key={session.id}\n            session={session as any}\n            onClick={onSessionClick}\n          />\n        ))}\n      </div>\n    </div>\n  );\n};\n\nexport default EnhancedSessionsSection;","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/EntityHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ExitGuidanceModeButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/FilterBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/GlobalSearch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/GuidedStepProgress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/KanbanSettingsSheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/LanguageSwitcher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/Layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/LeadActivitySection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/LeadFieldDialog.tsx","messages":[{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":132,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":132,"endColumn":73,"suggestions":[{"messageId":"addBrackets","fix":{"range":[3500,3610],"text":"{ const fieldOptions = field.options?.options?.join(\", \") || \"\";\n          return currentValue !== fieldOptions; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":153,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4319,4322],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4319,4322],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useEffect, useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { AppSheetModal } from \"@/components/ui/app-sheet-modal\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useLeadFieldDefinitions } from \"@/hooks/useLeadFieldDefinitions\";\nimport {\n  LeadFieldDefinition,\n  LeadFieldType,\n  FIELD_TYPE_CONFIG,\n  CreateLeadFieldDefinition,\n} from \"@/types/leadFields\";\nimport { useTranslation } from \"react-i18next\";\nimport { toast } from \"sonner\";\nimport { NavigationGuardDialog } from \"@/components/settings/NavigationGuardDialog\";\nimport { useModalNavigation } from \"@/hooks/useModalNavigation\";\n\n// System-reserved field keys that cannot be used for custom fields\nconst RESERVED_FIELD_KEYS = new Set([\n  \"name\",\n  \"email\",\n  \"phone\",\n  \"status\",\n  \"updated_at\",\n  \"created_at\",\n  \"status_id\",\n  \"due_date\",\n  \"notes\",\n]);\n\nconst fieldSchema = z.object({\n  label: z\n    .string()\n    .min(1, \"Field label is required\")\n    .max(100, \"Label is too long\"),\n  field_type: z.enum([\n    \"text\",\n    \"textarea\",\n    \"email\",\n    \"phone\",\n    \"date\",\n    \"select\",\n    \"checkbox\",\n    \"number\",\n  ]),\n  is_required: z.boolean().default(false),\n  is_visible_in_form: z.boolean().default(true),\n  options: z.string().optional(),\n  allow_multiple: z.boolean().default(false),\n  validation_rules: z\n    .object({\n      min_length: z.number().optional(),\n      max_length: z.number().optional(),\n      pattern: z.string().optional(),\n    })\n    .optional()\n    .nullable(),\n});\n\ntype FieldFormData = z.infer<typeof fieldSchema>;\n\ninterface LeadFieldDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  field?: LeadFieldDefinition | null;\n  onClose: () => void;\n}\n\nexport function LeadFieldDialog({\n  open,\n  onOpenChange,\n  field,\n  onClose,\n}: LeadFieldDialogProps) {\n  const { createFieldDefinition, updateFieldDefinition } =\n    useLeadFieldDefinitions();\n  const [loading, setLoading] = useState(false);\n  const [isDirty, setIsDirty] = useState(false);\n  const { t } = useTranslation([\"forms\", \"common\"]);\n\n  const isEdit = !!field;\n  const isSystemField = field?.is_system || false;\n\n  const form = useForm<FieldFormData>({\n    resolver: zodResolver(fieldSchema),\n    defaultValues: {\n      label: \"\",\n      field_type: \"text\",\n      is_required: false,\n      is_visible_in_form: true,\n      options: \"\",\n    },\n  });\n\n  // Track form dirty state\n  const formValues = form.watch();\n  useEffect(() => {\n    const hasChanges = Object.keys(formValues).some((key) => {\n      const currentValue = formValues[key as keyof typeof formValues];\n      if (!field) return !!currentValue;\n\n      switch (key) {\n        case \"label\":\n          return currentValue !== field.label;\n        case \"field_type\":\n          return currentValue !== field.field_type;\n        case \"is_required\":\n          return currentValue !== field.is_required;\n        case \"is_visible_in_form\":\n          return currentValue !== field.is_visible_in_form;\n        case \"options\":\n          const fieldOptions = field.options?.options?.join(\", \") || \"\";\n          return currentValue !== fieldOptions;\n        default:\n          return false;\n      }\n    });\n    setIsDirty(hasChanges);\n  }, [formValues, field]);\n\n  const selectedFieldType = form.watch(\"field_type\") as LeadFieldType;\n  const fieldTypeConfig = FIELD_TYPE_CONFIG[selectedFieldType];\n\n  const getInitialValues = useCallback((): FieldFormData => {\n    if (field) {\n      return {\n        label: field.label,\n        field_type: field.field_type as LeadFieldType,\n        is_required: field.is_required,\n        is_visible_in_form: field.is_visible_in_form,\n        options: field.options?.options ? field.options.options.join(\", \") : \"\",\n        allow_multiple: field.allow_multiple || false,\n        validation_rules: field.validation_rules as any,\n      };\n    }\n\n    return {\n      label: \"\",\n      field_type: \"text\",\n      is_required: false,\n      is_visible_in_form: true,\n      options: \"\",\n      allow_multiple: false,\n      validation_rules: undefined,\n    };\n  }, [field]);\n\n  useEffect(() => {\n    if (open) {\n      form.reset(getInitialValues());\n      setIsDirty(false);\n    }\n  }, [open, form, getInitialValues]);\n\n  const onSubmit = async (data: FieldFormData) => {\n    try {\n      setLoading(true);\n\n      const fieldKey = isEdit\n        ? field.field_key\n        : data.label.toLowerCase().replace(/[^a-z0-9]/g, \"_\");\n\n      // Prevent collision with system-reserved keys\n      if (!isEdit && RESERVED_FIELD_KEYS.has(fieldKey)) {\n        toast.error(t(\"lead_field.reserved_key_error\"), {\n          description: t(\"lead_field.reserved_key_description\", {\n            key: fieldKey,\n          }),\n        });\n        setLoading(false);\n        return;\n      }\n\n      const fieldData: CreateLeadFieldDefinition = {\n        field_key: fieldKey,\n        label: data.label,\n        field_type: data.field_type,\n        is_required: data.is_required,\n        is_visible_in_form: data.is_visible_in_form,\n        options:\n          fieldTypeConfig.supportsOptions && data.options\n            ? {\n                options: data.options\n                  .split(\",\")\n                  .map((opt) => opt.trim())\n                  .filter(Boolean),\n              }\n            : undefined,\n        validation_rules:\n          fieldTypeConfig.supportsValidation && data.validation_rules\n            ? data.validation_rules\n            : undefined,\n        allow_multiple:\n          data.field_type === \"select\" ? data.allow_multiple : undefined,\n      };\n\n      if (isEdit) {\n        await updateFieldDefinition(field.id, fieldData);\n      } else {\n        await createFieldDefinition(fieldData);\n      }\n\n      onClose();\n    } catch (error) {\n      console.error(\"Failed to save field:\", error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSave = form.handleSubmit(onSubmit);\n\n  const navigation = useModalNavigation({\n    isDirty,\n    onDiscard: () => {\n      form.reset(getInitialValues());\n      setIsDirty(false);\n      onClose();\n    },\n    onSaveAndExit: async () => {\n      await handleSave();\n    },\n    message: t(\"lead_field.unsaved_changes\"),\n  });\n\n  const handleDirtyClose = () => {\n    const canClose = navigation.handleModalClose();\n    if (canClose) {\n      form.reset(getInitialValues());\n      setIsDirty(false);\n      onClose();\n    }\n  };\n\n  const footerActions = [\n    {\n      label: t(\"buttons.cancel\", { ns: \"common\" }),\n      onClick: handleDirtyClose,\n      variant: \"outline\" as const,\n    },\n    {\n      label: loading\n        ? t(\"lead_field.saving\")\n        : isEdit\n        ? t(\"lead_field.update_field\")\n        : t(\"lead_field.create_field\"),\n      onClick: handleSave,\n      loading,\n      disabled: loading,\n    },\n  ];\n\n  return (\n    <AppSheetModal\n      title={\n        isEdit ? t(\"lead_field.edit_field\") : t(\"lead_field.add_custom_field\")\n      }\n      isOpen={open}\n      onOpenChange={onOpenChange}\n      size=\"lg\"\n      dirty={isDirty}\n      onDirtyClose={handleDirtyClose}\n      footerActions={footerActions}\n    >\n      <div className=\"space-y-1 mb-6\">\n        <p className=\"text-sm text-muted-foreground\">\n          {isEdit\n            ? t(\"lead_field.edit_description\")\n            : t(\"lead_field.create_description\")}\n        </p>\n      </div>\n\n      <Form {...form}>\n        <div className=\"space-y-6\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <FormField\n              control={form.control}\n              name=\"label\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>{t(\"lead_field.field_label\")} *</FormLabel>\n                  <FormControl>\n                    <Input\n                      placeholder={t(\"lead_field.field_label_placeholder\")}\n                      {...field}\n                      disabled={isSystemField}\n                    />\n                  </FormControl>\n                  <FormDescription>\n                    {t(\"lead_field.field_label_description\")}\n                  </FormDescription>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"field_type\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>{t(\"lead_field.field_type\")} *</FormLabel>\n                  <Select\n                    onValueChange={field.onChange}\n                    defaultValue={field.value}\n                    disabled={isSystemField}\n                  >\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue\n                          placeholder={t(\"lead_field.select_field_type\")}\n                        />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      {Object.entries(FIELD_TYPE_CONFIG).map(([key]) => (\n                        <SelectItem key={key} value={key}>\n                          {t(`lead_field.field_types.${key}`)}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormDescription>\n                    {t(\"lead_field.field_type_description\")}\n                  </FormDescription>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n\n          {fieldTypeConfig.supportsOptions && (\n            <>\n              <FormField\n                control={form.control}\n                name=\"options\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"lead_field.options\")}</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder={t(\"lead_field.options_placeholder\")}\n                        {...field}\n                        disabled={isSystemField}\n                      />\n                    </FormControl>\n                    <FormDescription>\n                      {t(\"lead_field.options_description\")}\n                    </FormDescription>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {selectedFieldType === \"select\" && (\n                <FormField\n                  control={form.control}\n                  name=\"allow_multiple\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex items-center justify-between p-4 border rounded-lg\">\n                      <div className=\"space-y-1\">\n                        <FormLabel className=\"text-sm font-medium\">\n                          {t(\"lead_field.allow_multiple_selections\")}\n                        </FormLabel>\n                        <FormDescription className=\"text-sm text-muted-foreground\">\n                          {t(\"lead_field.allow_multiple_description\")}\n                        </FormDescription>\n                      </div>\n                      <FormControl>\n                        <Switch\n                          checked={field.value}\n                          onCheckedChange={field.onChange}\n                          disabled={isSystemField}\n                        />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n              )}\n            </>\n          )}\n\n          <div className=\"flex items-center justify-between p-4 border rounded-lg\">\n            <div className=\"space-y-1\">\n              <h4 className=\"text-sm font-medium\">\n                {t(\"lead_field.field_settings\")}\n              </h4>\n              <p className=\"text-sm text-muted-foreground\">\n                {t(\"lead_field.field_settings_description\")}\n              </p>\n            </div>\n            <div className=\"flex items-center gap-6\">\n              <FormField\n                control={form.control}\n                name=\"is_required\"\n                render={({ field }) => (\n                  <FormItem className=\"flex items-center gap-2 space-y-0\">\n                    <FormControl>\n                      <Switch\n                        checked={field.value}\n                        onCheckedChange={field.onChange}\n                        disabled={isSystemField}\n                      />\n                    </FormControl>\n                    <FormLabel className=\"text-sm font-normal\">\n                      {t(\"lead_field.required\")}\n                    </FormLabel>\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"is_visible_in_form\"\n                render={({ field }) => (\n                  <FormItem className=\"flex items-center gap-2 space-y-0\">\n                    <FormControl>\n                      <Switch\n                        checked={field.value}\n                        onCheckedChange={field.onChange}\n                      />\n                    </FormControl>\n                    <FormLabel className=\"text-sm font-normal\">\n                      {t(\"lead_field.visible_in_form\")}\n                    </FormLabel>\n                  </FormItem>\n                )}\n              />\n            </div>\n          </div>\n\n          {isSystemField && (\n            <div className=\"flex items-center gap-2 p-3 bg-muted rounded-lg\">\n              <Badge variant=\"secondary\">{t(\"lead_field.system_field\")}</Badge>\n              <p className=\"text-sm text-muted-foreground\">\n                {t(\"lead_field.system_field_description\")}\n              </p>\n            </div>\n          )}\n        </div>\n      </Form>\n      <NavigationGuardDialog\n        open={navigation.showGuard}\n        onDiscard={navigation.handleDiscardChanges}\n        onStay={navigation.handleStayOnModal}\n        onSaveAndExit={navigation.handleSaveAndExit}\n        message={navigation.message}\n      />\n    </AppSheetModal>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/LeadFieldValuesDisplay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/LeadFieldsList.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1530,1533],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1530,1533],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { DragDropContext, Droppable, Draggable } from \"@hello-pangea/dnd\";\nimport {\n  Edit,\n  Trash2,\n  GripVertical,\n  Eye,\n  EyeOff,\n  AlertCircle,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { LeadFieldDefinition, FIELD_TYPE_CONFIG } from \"@/types/leadFields\";\nimport { useTranslation } from \"react-i18next\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { cn } from \"@/lib/utils\";\nimport { IconActionButton } from \"@/components/ui/icon-action-button\";\nimport { IconActionButtonGroup } from \"@/components/ui/icon-action-button-group\";\n\ninterface LeadFieldsListProps {\n  fields: LeadFieldDefinition[];\n  onEdit: (field: LeadFieldDefinition) => void;\n  onDelete: (id: string) => Promise<void>;\n  onReorder: (fields: LeadFieldDefinition[]) => Promise<void>;\n}\n\nexport function LeadFieldsList({\n  fields,\n  onEdit,\n  onDelete,\n  onReorder,\n}: LeadFieldsListProps) {\n  const [deleteField, setDeleteField] = useState<LeadFieldDefinition | null>(\n    null\n  );\n  const { t } = useTranslation(\"forms\");\n  const isMobile = useIsMobile();\n\n  const handleDragEnd = async (result: any) => {\n    if (!result.destination) return;\n\n    const items = Array.from(fields);\n    const [reorderedItem] = items.splice(result.source.index, 1);\n    items.splice(result.destination.index, 0, reorderedItem);\n\n    try {\n      await onReorder(items);\n    } catch (error) {\n      console.error(\"Failed to reorder fields:\", error);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!deleteField) return;\n\n    try {\n      await onDelete(deleteField.id);\n      setDeleteField(null);\n    } catch (error) {\n      console.error(\"Failed to delete field:\", error);\n    }\n  };\n\n  const getFieldTypeLabel = (fieldType: string) => {\n    return (\n      FIELD_TYPE_CONFIG[fieldType as keyof typeof FIELD_TYPE_CONFIG]?.label ||\n      fieldType\n    );\n  };\n\n  if (fields.length === 0) {\n    return (\n      <div className=\"text-center py-12\">\n        <p className=\"text-muted-foreground\">{t(\"lead_fields.no_fields\")}</p>\n        <p className=\"text-sm text-muted-foreground mt-1\">\n          {t(\"lead_fields.no_fields_description\")}\n        </p>\n      </div>\n    );\n  }\n\n  const mobileContent = (\n    <DragDropContext onDragEnd={handleDragEnd}>\n      <Droppable droppableId=\"fields-mobile\">\n        {(provided) => (\n          <div\n            ref={provided.innerRef}\n            {...provided.droppableProps}\n            className=\"space-y-3\"\n          >\n            {fields.map((field, index) => (\n              <Draggable\n                key={field.id}\n                draggableId={field.id}\n                index={index}\n                isDragDisabled={field.is_system}\n              >\n                {(provided, snapshot) => {\n                  const dragHandleProps: Record<string, unknown> = !field.is_system\n                    ? (provided.dragHandleProps ?? {})\n                    : {};\n                  return (\n                    <div\n                      ref={provided.innerRef}\n                      {...provided.draggableProps}\n                      className={cn(\n                        \"rounded-lg border border-border/60 bg-card p-4 shadow-sm transition-shadow\",\n                        snapshot.isDragging && \"shadow-lg ring-2 ring-primary/30\"\n                      )}\n                    >\n                      <div className=\"flex items-start justify-between gap-3\">\n                        <div className=\"min-w-0 space-y-2\">\n                          <p className=\"text-base font-semibold leading-tight text-foreground break-words\">\n                            {field.label}\n                          </p>\n                          <div className=\"flex flex-wrap items-center gap-2 text-xs uppercase tracking-wide text-muted-foreground\">\n                            <span>{getFieldTypeLabel(field.field_type)}</span>\n                            <Badge variant=\"secondary\">\n                              {field.is_system\n                                ? t(\"lead_fields.table.system_value\")\n                                : t(\"lead_fields.table.custom_value\")}\n                            </Badge>\n                          </div>\n                        </div>\n                        <button\n                          type=\"button\"\n                          className={cn(\n                            \"rounded-md p-2 text-muted-foreground/70 transition-colors\",\n                            field.is_system\n                              ? \"cursor-not-allowed opacity-30\"\n                              : \"cursor-grab active:cursor-grabbing hover:text-foreground\"\n                          )}\n                          aria-label=\"Reorder field\"\n                          disabled={field.is_system}\n                          {...dragHandleProps}\n                        >\n                          <GripVertical className=\"h-4 w-4\" />\n                        </button>\n                      </div>\n\n                      <div className=\"mt-3 grid grid-cols-1 gap-2 text-sm text-muted-foreground\">\n                        <div>\n                          <span className=\"font-medium text-foreground\">\n                            {t(\"lead_fields.table.required\")}:\n                          </span>{\" \"}\n                          {field.is_required\n                            ? t(\"lead_fields.table.required_value\")\n                            : t(\"lead_fields.table.optional_value\")}\n                        </div>\n                        <div className=\"flex flex-wrap items-center gap-2\">\n                          <span className=\"font-medium text-foreground\">\n                            {t(\"lead_fields.table.visible_in_form\")}:\n                          </span>\n                          <span className=\"inline-flex items-center gap-1\">\n                            {field.is_visible_in_form ? (\n                              <Eye className=\"h-4 w-4\" />\n                            ) : (\n                              <EyeOff className=\"h-4 w-4\" />\n                            )}\n                            {field.is_visible_in_form\n                              ? t(\"lead_fields.table.visible_value\")\n                              : t(\"lead_fields.table.hidden_value\")}\n                          </span>\n                        </div>\n                      </div>\n\n                      <IconActionButtonGroup className=\"mt-4\">\n                        <IconActionButton onClick={() => onEdit(field)}>\n                          <Edit className=\"h-4 w-4\" />\n                          <span className=\"sr-only\">Edit</span>\n                        </IconActionButton>\n                        {!field.is_system && (\n                          <IconActionButton\n                            onClick={() => setDeleteField(field)}\n                            variant=\"danger\"\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                            <span className=\"sr-only\">Delete</span>\n                          </IconActionButton>\n                        )}\n                      </IconActionButtonGroup>\n                    </div>\n                  );\n                }}\n              </Draggable>\n            ))}\n            {provided.placeholder}\n          </div>\n        )}\n      </Droppable>\n    </DragDropContext>\n  );\n\n  const desktopContent = (\n    <DragDropContext onDragEnd={handleDragEnd}>\n      <Droppable droppableId=\"fields\">\n        {(provided) => (\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead className=\"w-12\"></TableHead>\n                <TableHead>{t(\"lead_fields.table.field_name\")}</TableHead>\n                <TableHead>{t(\"lead_fields.table.type\")}</TableHead>\n                <TableHead>{t(\"lead_fields.table.required\")}</TableHead>\n                <TableHead>\n                  {t(\"lead_fields.table.visible_in_form\")}\n                </TableHead>\n                <TableHead>{t(\"lead_fields.table.status\")}</TableHead>\n                <TableHead className=\"w-24\">\n                  {t(\"lead_fields.table.actions\")}\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody {...provided.droppableProps} ref={provided.innerRef}>\n              {fields.map((field, index) => (\n                <Draggable\n                  key={field.id}\n                  draggableId={field.id}\n                  index={index}\n                  isDragDisabled={field.is_system}\n                >\n                  {(provided, snapshot) => (\n                    <TableRow\n                      ref={provided.innerRef}\n                      {...provided.draggableProps}\n                      className={snapshot.isDragging ? \"bg-muted/50\" : \"\"}\n                    >\n                      <TableCell>\n                        <div\n                          {...provided.dragHandleProps}\n                          className={`flex items-center justify-center ${\n                            field.is_system\n                              ? \"opacity-30 cursor-not-allowed\"\n                              : \"cursor-grab\"\n                          }`}\n                        >\n                          <GripVertical className=\"h-4 w-4\" />\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <span className=\"font-medium\">{field.label}</span>\n                      </TableCell>\n                      <TableCell>\n                        <span className=\"text-sm text-muted-foreground\">\n                          {getFieldTypeLabel(field.field_type)}\n                        </span>\n                      </TableCell>\n                      <TableCell>\n                        <span className=\"text-sm text-muted-foreground\">\n                          {field.is_required\n                            ? t(\"lead_fields.table.required_value\")\n                            : t(\"lead_fields.table.optional_value\")}\n                        </span>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-1\">\n                          {field.is_visible_in_form ? (\n                            <Eye className=\"h-4 w-4 text-muted-foreground\" />\n                          ) : (\n                            <EyeOff className=\"h-4 w-4 text-muted-foreground\" />\n                          )}\n                          <span className=\"text-sm text-muted-foreground\">\n                            {field.is_visible_in_form\n                              ? t(\"lead_fields.table.visible_value\")\n                              : t(\"lead_fields.table.hidden_value\")}\n                          </span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <span className=\"text-sm text-muted-foreground\">\n                          {field.is_system\n                            ? t(\"lead_fields.table.system_value\")\n                            : t(\"lead_fields.table.custom_value\")}\n                        </span>\n                      </TableCell>\n                      <TableCell>\n                        <IconActionButtonGroup>\n                          <IconActionButton onClick={() => onEdit(field)}>\n                            <Edit className=\"h-4 w-4\" />\n                          </IconActionButton>\n                          {!field.is_system && (\n                            <IconActionButton\n                              onClick={() => setDeleteField(field)}\n                              variant=\"danger\"\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </IconActionButton>\n                          )}\n                        </IconActionButtonGroup>\n                      </TableCell>\n                    </TableRow>\n                  )}\n                </Draggable>\n              ))}\n              {provided.placeholder}\n            </TableBody>\n          </Table>\n        )}\n      </Droppable>\n    </DragDropContext>\n  );\n\n  return (\n    <>\n      {isMobile ? mobileContent : desktopContent}\n\n      <AlertDialog\n        open={!!deleteField}\n        onOpenChange={() => setDeleteField(null)}\n      >\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"flex items-center gap-2\">\n              <AlertCircle className=\"h-5 w-5 text-destructive\" />\n              {t(\"lead_fields.delete_dialog.title\")}\n            </AlertDialogTitle>\n            <AlertDialogDescription>\n              {t(\"lead_fields.delete_dialog.description\", {\n                fieldName: deleteField?.label,\n              })}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>\n              {t(\"lead_fields.delete_dialog.cancel\")}\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleDelete}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {t(\"lead_fields.delete_dialog.confirm\")}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/LeadFieldsSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/LeadInitials.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":33,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":33,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo } from \"react\";\n\nconst CONNECTOR_WORDS = new Set([\n  \"and\",\n  \"ve\",\n  \"ile\",\n  \"with\",\n  \"und\",\n  \"the\",\n  \"of\",\n  \"for\",\n  \"da\",\n  \"de\",\n  \"del\",\n  \"della\",\n  \"van\",\n  \"von\",\n  \"bin\",\n  \"al\",\n  \"el\",\n  \"&\"\n]);\n\nconst DEFAULT_MAX_INITIALS = 3;\nconst DEFAULT_FALLBACK = \"??\";\n\nexport interface LeadInitialsProps {\n  name?: string | null;\n  fallback?: string;\n  maxInitials?: number;\n}\n\nexport const computeLeadInitials = (\n  name?: string | null,\n  fallback: string = DEFAULT_FALLBACK,\n  maxInitials: number = DEFAULT_MAX_INITIALS\n) => {\n  if (maxInitials <= 0) {\n    return fallback;\n  }\n\n  const trimmed = (name ?? \"\").trim();\n  if (!trimmed) {\n    return fallback;\n  }\n\n  const tokens = trimmed.match(/\\p{L}+/gu) ?? [];\n  const meaningfulTokens = tokens.filter(\n    (token) => !CONNECTOR_WORDS.has(token.toLowerCase())\n  );\n  const candidates =\n    meaningfulTokens.length > 0 ? meaningfulTokens : tokens;\n\n  if (candidates.length === 0) {\n    return fallback;\n  }\n\n  const initials: string[] = [];\n  for (const token of candidates) {\n    const chars = Array.from(token);\n    const initial = chars[0]?.toUpperCase();\n    if (initial) {\n      initials.push(initial);\n    }\n    if (initials.length >= maxInitials) {\n      break;\n    }\n  }\n\n  if (initials.length === 0) {\n    const fallbackToken = candidates[0];\n    const fallbackChars = Array.from(fallbackToken)\n      .slice(0, maxInitials)\n      .join(\"\")\n      .toUpperCase();\n    return fallbackChars || fallback;\n  }\n\n  const combined = initials.join(\"\");\n  return combined || fallback;\n};\n\nexport function LeadInitials({\n  name,\n  fallback = DEFAULT_FALLBACK,\n  maxInitials = DEFAULT_MAX_INITIALS\n}: LeadInitialsProps) {\n  const initials = useMemo(\n    () => computeLeadInitials(name, fallback, maxInitials),\n    [name, fallback, maxInitials]\n  );\n\n  return <>{initials}</>;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/LeadStatusBadge.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":132,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4183,4186],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4183,4186],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":216,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7075,7078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7075,7078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { ChevronDown } from \"lucide-react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { cn } from \"@/lib/utils\";\nimport { getBadgeStyleProperties } from \"@/lib/statusBadgeStyles\";\nimport { useOrganizationQuickSettings } from \"@/hooks/useOrganizationQuickSettings\";\nimport { useWorkflowTriggers } from \"@/hooks/useWorkflowTriggers\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\nimport { useFormsTranslation } from \"@/hooks/useTypedTranslation\";\n\ninterface LeadStatus {\n  id: string;\n  name: string;\n  color: string;\n  is_system_final?: boolean;\n}\n\ninterface LeadStatusBadgeProps {\n  leadId: string;\n  currentStatusId?: string;\n  currentStatus?: string; // Keep for backward compatibility\n  onStatusChange?: () => void;\n  editable?: boolean;\n  className?: string;\n  size?: 'sm' | 'default';\n  statuses?: LeadStatus[];\n  statusesLoading?: boolean;\n}\n\nexport function LeadStatusBadge({ \n  leadId, \n  currentStatusId,\n  currentStatus, \n  onStatusChange, \n  editable = false,\n  className,\n  size = 'default',\n  statuses: passedStatuses,\n  statusesLoading\n}: LeadStatusBadgeProps) {\n  const [statuses, setStatuses] = useState<LeadStatus[]>([]);\n  const [currentStatusData, setCurrentStatusData] = useState<LeadStatus | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [isUpdating, setIsUpdating] = useState(false);\n  const [dropdownOpen, setDropdownOpen] = useState(false);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n  const { toast } = useToast();\n  const { settings: userSettings } = useOrganizationQuickSettings();\n  const { triggerLeadStatusChange } = useWorkflowTriggers();\n  const { activeOrganization } = useOrganization();\n  const { t: tForms } = useFormsTranslation();\n\n  useEffect(() => {\n    if (passedStatuses === undefined) {\n      fetchLeadStatuses();\n      return;\n    }\n\n    setStatuses(passedStatuses);\n    if (typeof statusesLoading === 'boolean') {\n      setLoading(statusesLoading);\n    } else {\n      setLoading(false);\n    }\n  }, [passedStatuses, statusesLoading]);\n\n  useEffect(() => {\n    if (statuses.length > 0) {\n      let status: LeadStatus | undefined;\n      \n      // First try to find by status ID (preferred method)\n      if (currentStatusId) {\n        status = statuses.find(s => s.id === currentStatusId);\n      }\n      \n      // Fallback to name-based lookup for backward compatibility\n      if (!status && currentStatus) {\n        status = statuses.find(s => s.name.toLowerCase() === currentStatus.toLowerCase());\n      }\n      \n      // If not found by name, create a temporary status object for legacy statuses\n      if (!status && currentStatus) {\n        status = {\n          id: currentStatus,\n          name: currentStatus,\n          color: getDefaultStatusColor(currentStatus)\n        };\n      }\n      \n      setCurrentStatusData(status || null);\n    }\n  }, [currentStatusId, currentStatus, statuses]);\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setDropdownOpen(false);\n      }\n    };\n\n    if (dropdownOpen) {\n      document.addEventListener('mousedown', handleClickOutside);\n      return () => document.removeEventListener('mousedown', handleClickOutside);\n    }\n  }, [dropdownOpen]);\n\n  const getDefaultStatusColor = (status: string): string => {\n    const colorMap: Record<string, string> = {\n      'new': '#A0AEC0',\n      'contacted': '#4299E1',\n      'qualified': '#48BB78',\n      'proposal_sent': '#ECC94B',\n      'booked': '#9F7AEA',\n      'completed': '#9AE6B4',\n      'lost': '#F56565'\n    };\n    return colorMap[status.toLowerCase()] || '#A0AEC0';\n  };\n\n  const fetchLeadStatuses = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('lead_statuses')\n        .select('*')\n        .order('sort_order', { ascending: true });\n\n      if (error) throw error;\n      setStatuses(data || []);\n    } catch (error: any) {\n      console.error('Error fetching lead statuses:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleStatusChange = async (newStatusId: string) => {\n    if (currentStatusData && newStatusId === currentStatusData.id) return;\n\n    setIsUpdating(true);\n    try {\n      const { data: userData } = await supabase.auth.getUser();\n      if (!userData.user) throw new Error('User not authenticated');\n\n      const newStatus = statuses.find(s => s.id === newStatusId);\n      if (!newStatus) throw new Error(tForms('status.statusNotFound'));\n      const organizationId = activeOrganization?.id ?? null;\n\n      // Update lead status using status_id\n      const { error: updateError } = await supabase\n        .from('leads')\n        .update({ \n          status_id: newStatusId,\n          status: newStatus.name // Keep text field updated for backward compatibility\n        })\n        .eq('id', leadId);\n\n      if (updateError) throw updateError;\n\n      // Log the status change as an activity\n      if (organizationId && currentStatusData) {\n        const { error: activityError } = await supabase\n          .from('activities')\n          .insert({\n            content: `Status changed from \"${currentStatusData.name}\" to \"${newStatus.name}\"`,\n            type: 'status_change',\n            lead_id: leadId,\n            user_id: userData.user.id,\n            organization_id: organizationId\n          });\n\n        if (activityError) {\n          console.error('Error logging activity:', activityError);\n        }\n      } else if (organizationId) {\n        // Log initial status assignment\n        const { error: activityError } = await supabase\n          .from('activities')\n          .insert({\n            content: `Status set to \"${newStatus.name}\"`,\n            type: 'status_change',\n            lead_id: leadId,\n            user_id: userData.user.id,\n            organization_id: organizationId\n          });\n\n        if (activityError) {\n          console.error('Error logging activity:', activityError);\n        }\n      }\n\n      setCurrentStatusData(newStatus);\n      setDropdownOpen(false);\n      onStatusChange?.();\n\n      toast({\n        title: tForms('status.statusUpdated'),\n        description: `Lead status ${currentStatusData ? 'changed' : 'set'} to \"${newStatus.name}\"`\n      });\n\n      // Trigger workflow for lead status change\n      if (activeOrganization?.id && currentStatusData) {\n        try {\n          await triggerLeadStatusChange(leadId, activeOrganization.id, currentStatusData.name, newStatus.name, {\n            old_status_id: currentStatusData.id,\n            new_status_id: newStatusId,\n            lead_id: leadId\n          });\n        } catch (workflowError) {\n          console.error('Error triggering lead status workflow:', workflowError);\n          // Don't block status change if workflow fails\n        }\n      }\n    } catch (error: any) {\n      toast({\n        title: tForms('status.errorUpdatingStatus'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsUpdating(false);\n    }\n  };\n\n  const isSmall = size === 'sm';\n  const dotSize = isSmall ? 'w-2 h-2' : 'w-2.5 h-2.5';\n  const textSize = isSmall ? 'text-xs' : 'text-sm';\n  const padding = isSmall ? 'px-2 py-1' : 'px-4 py-2';\n\n  if (loading) {\n    return (\n      <div className={cn(\"inline-flex items-center gap-2 bg-muted text-muted-foreground rounded-full\", padding, className)}>\n        <div className={cn(\"bg-muted-foreground/30 rounded-full animate-pulse\", dotSize)} />\n        <span className={textSize}>{tForms('status.loading')}</span>\n      </div>\n    );\n  }\n\n  // Handle case where no status is assigned yet\n  if (!currentStatusData && statuses.length > 0 && editable) {\n    const defaultColor = \"#A0AEC0\";\n    const { tokens, style: styleProps } = getBadgeStyleProperties(defaultColor);\n    \n    return (\n      <div className=\"relative\" ref={dropdownRef}>\n        <Button\n          variant=\"chip\"\n          className={cn(\n            \"inline-flex items-center gap-2 h-auto rounded-full font-medium transition-all\",\n            \"border cursor-pointer shadow-sm hover:shadow-md\",\n            \"hover:!bg-[var(--badge-hover-bg)] hover:!text-[var(--badge-color)] active:!bg-[var(--badge-active-bg)]\",\n            \"focus-visible:ring-[var(--badge-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-background\",\n            padding,\n            isUpdating && \"cursor-not-allowed opacity-60\",\n            className\n          )}\n          style={styleProps}\n          disabled={isUpdating}\n          onClick={(e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            setDropdownOpen(!dropdownOpen);\n          }}\n        >\n          <div \n            className={cn(\"rounded-full border-2\", dotSize)}\n            style={{ borderColor: tokens.color }}\n          />\n          <span className={cn(\"uppercase tracking-wide font-semibold\", textSize)}>{tForms('status.selectStatus')}</span>\n          <ChevronDown className={cn(\"ml-1 transition-transform\", isSmall ? \"w-3 h-3\" : \"w-4 h-4\", dropdownOpen && \"rotate-180\")} />\n        </Button>\n\n        {/* Dropdown for status selection */}\n        {dropdownOpen && (\n          <div className=\"absolute top-full left-0 mt-2 w-auto min-w-[200px] bg-background bg-opacity-100 border rounded-lg shadow-lg z-50 p-2\">\n            <div className=\"space-y-1\">\n              {statuses\n                .filter(status => userSettings.show_quick_status_buttons || !status.is_system_final)\n                .map((status) => (\n                <Button\n                  key={status.id}\n                  variant=\"ghost\"\n                  className={cn(\n                    \"w-full justify-start h-auto py-2 px-3 font-medium rounded-md transition-colors\",\n                    \"text-foreground hover:bg-muted hover:!text-foreground\",\n                    \"focus-visible:ring-1 focus-visible:ring-muted-foreground/30 focus-visible:ring-offset-2 focus-visible:ring-offset-background\"\n                  )}\n                  onClick={(e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    handleStatusChange(status.id);\n                  }}\n                  disabled={isUpdating}\n                >\n                  <div className=\"flex items-center gap-3 w-full\">\n                    <div \n                      className={cn(\"rounded-full flex-shrink-0\", dotSize)}\n                      style={{ backgroundColor: status.color }}\n                    />\n                    <span className={cn(\"uppercase tracking-wide font-semibold\", textSize)}>{status.name}</span>\n                  </div>\n                </Button>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  if (!currentStatusData) {\n    return (\n      <div className={cn(\"inline-flex items-center gap-2 bg-muted text-muted-foreground rounded-full\", padding, className)}>\n        <div className={cn(\"bg-muted-foreground/30 rounded-full\", dotSize)} />\n        <span className={textSize}>{tForms('status.noStatusAvailable')}</span>\n      </div>\n    );\n  }\n\n  const { tokens: activeTokens, style: activeStyle } = getBadgeStyleProperties(currentStatusData.color);\n\n  if (!editable) {\n    return (\n      <div \n        className={cn(\"inline-flex items-center gap-2 rounded-full font-medium border\", padding, className)}\n        style={activeStyle}\n      >\n        <div \n          className={cn(\"rounded-full\", dotSize)}\n          style={{ backgroundColor: activeTokens.color }}\n        />\n        <span className={cn(\"uppercase tracking-wide font-semibold\", textSize)}>{currentStatusData.name}</span>\n      </div>\n    );\n  }\n\n  // Editable status badge with current status\n  return (\n    <div className=\"relative\" ref={dropdownRef}>\n      <Button\n        variant=\"chip\"\n        className={cn(\n          \"inline-flex items-center gap-2 h-auto rounded-full font-medium transition-all\",\n          \"border cursor-pointer shadow-sm hover:shadow-md\",\n          \"hover:!bg-[var(--badge-hover-bg)] hover:!text-[var(--badge-color)] active:!bg-[var(--badge-active-bg)]\",\n          \"focus-visible:ring-[var(--badge-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-background\",\n          padding,\n          isUpdating && \"cursor-not-allowed opacity-60\",\n          className\n        )}\n        style={activeStyle}\n        disabled={isUpdating}\n        onClick={(e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          setDropdownOpen(!dropdownOpen);\n        }}\n      >\n        <div \n          className={cn(\"rounded-full\", dotSize)}\n          style={{ backgroundColor: activeTokens.color }}\n        />\n        <span className={cn(\"uppercase tracking-wide font-semibold\", textSize)}>{currentStatusData.name}</span>\n        <ChevronDown className={cn(\"ml-1 transition-transform\", isSmall ? \"w-3 h-3\" : \"w-4 h-4\", dropdownOpen && \"rotate-180\")} />\n      </Button>\n\n      {/* Dropdown for changing status */}\n      {dropdownOpen && (\n        <div className=\"absolute top-full left-0 mt-2 w-auto min-w-[200px] bg-background bg-opacity-100 border rounded-lg shadow-lg z-50 p-2\">\n          <div className=\"space-y-1\">\n            {statuses\n              .filter(status => userSettings.show_quick_status_buttons || !status.is_system_final)\n              .map((status) => (\n              <Button\n                key={status.id}\n                variant=\"ghost\"\n                className={cn(\n                  \"w-full justify-start h-auto py-2 px-3 font-medium rounded-md transition-colors\",\n                  \"text-foreground hover:bg-muted hover:!text-foreground\",\n                  \"focus-visible:ring-1 focus-visible:ring-muted-foreground/30 focus-visible:ring-offset-2 focus-visible:ring-offset-background\",\n                  currentStatusData.name === status.name && \"bg-muted\"\n                )}\n                onClick={(e) => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  handleStatusChange(status.id);\n                }}\n                disabled={isUpdating}\n              >\n                <div className=\"flex items-center gap-3 w-full\">\n                  <div \n                    className={cn(\"rounded-full flex-shrink-0\", dotSize)}\n                    style={{ backgroundColor: status.color }}\n                  />\n                  <span className={cn(\"uppercase tracking-wide font-semibold\", textSize)}>{status.name}</span>\n                </div>\n              </Button>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/LeadStatusesSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4100,4103],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4100,4103],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":175,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6197,6200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6197,6200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport { DragDropContext, Draggable, Droppable } from \"@hello-pangea/dnd\";\nimport { Button } from \"@/components/ui/button\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Loader2, Plus, Edit, Trash2, GripVertical, Settings } from \"lucide-react\";\nimport { useI18nToast } from \"@/lib/toastHelpers\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { AddLeadStatusDialog, EditLeadStatusDialog } from \"./settings/LeadStatusDialogs\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport SettingsSection from \"./SettingsSection\";\nimport { useLeadStatuses, useOrganizationSettings } from \"@/hooks/useOrganizationData\";\nimport { useQueryClient } from \"@tanstack/react-query\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\nimport { cn } from \"@/lib/utils\";\nimport { useTranslation } from \"react-i18next\";\n\nconst leadStatusSchema = z.object({\n  name: z.string().min(1, \"Status name is required\").max(50, \"Status name must be less than 50 characters\"),\n  color: z.string().regex(/^#[0-9A-F]{6}$/i, \"Color must be a valid hex code\"),\n});\n\ntype LeadStatusForm = z.infer<typeof leadStatusSchema>;\n\ninterface LeadStatus {\n  id: string;\n  name: string;\n  color: string;\n  created_at: string;\n  updated_at: string;\n  sort_order: number;\n  is_default: boolean;\n  is_system_final?: boolean;\n  lifecycle?: string;\n}\n\n// Predefined color palette\nconst PREDEFINED_COLORS = [\n  '#F56565', // Red\n  '#ED8936', // Orange  \n  '#ECC94B', // Yellow\n  '#9AE6B4', // Light Green\n  '#48BB78', // Green\n  '#38B2AC', // Teal\n  '#63B3ED', // Light Blue\n  '#4299E1', // Blue\n  '#667EEA', // Indigo\n  '#9F7AEA', // Purple\n  '#ED64A6', // Pink\n  '#A0AEC0', // Gray\n];\n\nconst LeadStatusesSection = () => {\n  const [submitting, setSubmitting] = useState(false);\n  const [editingStatus, setEditingStatus] = useState<LeadStatus | null>(null);\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [selectedColor, setSelectedColor] = useState<string>(PREDEFINED_COLORS[0]);\n  const [saving, setSaving] = useState(false);\n\n  const toast = useI18nToast();\n  const { activeOrganizationId } = useOrganization();\n  const queryClient = useQueryClient();\n  const { t } = useTranslation('forms');\n  \n  // Use cached data\n  const { data: statuses = [], isLoading } = useLeadStatuses();\n  const {\n    settings: organizationSettings,\n    loading: settingsLoading,\n    updateSettings: updateOrganizationSettings,\n  } = useOrganizationSettings();\n\n  // Check for lifecycle completeness and show warnings\n  useEffect(() => {\n    if (statuses.length > 0 && !isLoading) {\n      const hasCompleted = statuses.some(s => s.lifecycle === 'completed');\n      const hasCancelled = statuses.some(s => s.lifecycle === 'cancelled');\n      \n      if (!hasCompleted || !hasCancelled) {\n        const timeoutId = setTimeout(() => {\n          toast.info(\"Add at least one Completed and one Cancelled state to unlock full automations.\");\n        }, 1000);\n        \n        return () => clearTimeout(timeoutId);\n      }\n    }\n  }, [statuses, isLoading, toast]);\n\n  const form = useForm<LeadStatusForm>({\n    resolver: zodResolver(leadStatusSchema),\n    defaultValues: {\n      name: \"\",\n      color: PREDEFINED_COLORS[0],\n    },\n  });\n\n  const updatePreference = async (key: string, value: boolean) => {\n    setSaving(true);\n    try {\n      const result = await updateOrganizationSettings({ [key]: value });\n      if (result.success) {\n        toast.success(t('lead_statuses.preferences_updated'));\n      }\n    } catch (error: any) {\n      console.error('Error updating setting:', error);\n      if (error?.message) {\n        toast.error(error.message);\n      } else {\n        toast.error(\"Failed to update preferences\");\n      }\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleEdit = (status: LeadStatus) => {\n    setEditingStatus(status);\n    setSelectedColor(status.color);\n    form.reset({ name: status.name, color: status.color });\n    setIsEditDialogOpen(true);\n  };\n\n  const handleAdd = () => {\n    setEditingStatus(null);\n    form.reset({ name: \"\", color: PREDEFINED_COLORS[0] });\n    setSelectedColor(PREDEFINED_COLORS[0]);\n    setIsAddDialogOpen(true);\n  };\n\n  const handleDelete = async (statusId: string) => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Not authenticated');\n\n      // Check if this is a system final status\n      const statusToDelete = statuses.find(s => s.id === statusId);\n      if (statusToDelete?.is_system_final) {\n        throw new Error('Cannot delete system statuses (Completed/Lost). These are required for lead management.');\n      }\n\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) throw new Error('No organization found');\n\n      const { error } = await supabase\n        .from('lead_statuses')\n        .delete()\n        .eq('id', statusId)\n        .eq('organization_id', organizationId);\n\n      if (error) {\n        if (error.code === '23503') {\n          throw new Error('Cannot delete this status because it is being used by existing leads. Please change those leads to a different status first.');\n        }\n        throw error;\n      }\n\n      // Invalidate cache to refresh data\n      queryClient.invalidateQueries({ queryKey: ['lead_statuses', activeOrganizationId] });\n\n      toast.success(\"Lead status deleted successfully\");\n    } catch (error) {\n      console.error('Error deleting lead status:', error);\n      toast.error(error instanceof Error ? error.message : \"Failed to delete lead status\");\n    }\n  };\n\n  const handleCustomDragEnd = async (result: any) => {\n    if (!result.destination) return;\n\n    const customStatuses = statuses.filter(status => !status.is_system_final);\n    const systemStatuses = statuses.filter(status => status.is_system_final);\n    \n    const items = Array.from(customStatuses);\n    const [reorderedItem] = items.splice(result.source.index, 1);\n    items.splice(result.destination.index, 0, reorderedItem);\n\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Not authenticated');\n\n      // Update sort_order for custom statuses only\n      const updates = items.map((status, index) => ({\n        id: status.id,\n        sort_order: systemStatuses.length + index + 1,\n      }));\n\n      // Execute all updates\n      for (const update of updates) {\n        const { error } = await supabase\n          .from('lead_statuses')\n          .update({ sort_order: update.sort_order })\n          .eq('id', update.id);\n\n        if (error) throw error;\n      }\n\n      // Invalidate cache to refresh data\n      queryClient.invalidateQueries({ queryKey: ['lead_statuses', activeOrganizationId] });\n\n      toast.success(\"Status order updated successfully\");\n    } catch (error) {\n      console.error('Error updating status order:', error);\n      toast.error(\"Failed to update status order\");\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <SettingsSection \n        title={t('lead_statuses.title')}\n        description={t('lead_statuses.description')}\n      >\n        <div className=\"space-y-4\">\n          <div className=\"h-8 bg-muted rounded animate-pulse\" />\n          <div className=\"flex flex-wrap gap-3\">\n            {[1, 2, 3].map((i) => (\n              <div key={i} className=\"h-8 w-24 bg-muted rounded-full animate-pulse\" />\n            ))}\n          </div>\n        </div>\n      </SettingsSection>\n    );\n  }\n\n  // Get system statuses for dynamic description\n  const systemStatuses = statuses.filter(status => status.is_system_final);\n  const customStatuses = statuses.filter(status => !status.is_system_final);\n  const systemStatusNames = systemStatuses.map(s => s.name).join(' and ');\n  const dynamicDescription = systemStatusNames \n    ? t('lead_statuses.show_quick_buttons_help', { systemStatuses: systemStatusNames.toLowerCase() })\n    : t('lead_statuses.show_quick_buttons_help_default');\n\n  const showQuickButtons = organizationSettings?.show_quick_status_buttons ?? true;\n\n  return (\n    <>\n      <SettingsSection \n        title={t('lead_statuses.title')}\n        description={t('lead_statuses.description')}\n      >\n        {/* Settings Toggle Section */}\n        <div className=\"space-y-6\">\n          <div className=\"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between\">\n            <div className=\"space-y-0.5\">\n              <Label htmlFor=\"quick-status-buttons\" className=\"text-base\">\n                {t('lead_statuses.show_quick_buttons')}\n              </Label>\n              <p className=\"text-sm text-muted-foreground\">\n                {dynamicDescription}\n              </p>\n            </div>\n            <Switch\n              id=\"quick-status-buttons\"\n              checked={showQuickButtons}\n              onCheckedChange={(checked) => updatePreference('show_quick_status_buttons', checked)}\n              disabled={saving || settingsLoading}\n              className=\"self-end sm:self-auto\"\n            />\n          </div>\n\n          {/* System Statuses Section */}\n          {showQuickButtons && (\n            <div className=\"space-y-3\">\n              <h4 className=\"text-sm font-medium\">{t('lead_statuses.system_statuses')}</h4>\n              \n              <div className=\"flex flex-wrap gap-3\">\n                {systemStatuses.map((status) => (\n                  <div\n                    key={status.id}\n                    className=\"inline-flex min-w-0 max-w-full flex-wrap items-center gap-2 rounded-full px-3 py-1.5 text-sm font-medium transition-all hover:opacity-80 cursor-pointer\"\n                    style={{ \n                      backgroundColor: status.color + '20',\n                      color: status.color,\n                      border: `1px solid ${status.color}40`\n                    }}\n                    onClick={() => handleEdit(status)}\n                  >\n                    <div \n                      className=\"h-2 w-2 flex-shrink-0 rounded-full\" \n                      style={{ backgroundColor: status.color }}\n                    />\n                    <span className=\"text-left text-sm font-semibold uppercase tracking-wide break-words\">\n                      {status.name}\n                    </span>\n                    {status.lifecycle && status.lifecycle !== 'active' && (\n                      <span className=\"text-left text-xs font-normal capitalize opacity-60 break-words\">\n                        Â· {t(`lead_status.lifecycle.${status.lifecycle}`)}\n                      </span>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Custom Statuses Section */}\n          <div className=\"space-y-3\">\n            <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n              <h4 className=\"text-sm font-medium\">{t('lead_statuses.custom_statuses')}</h4>\n              <Button onClick={handleAdd} size=\"sm\" className=\"flex w-full items-center justify-center gap-2 sm:w-auto\">\n                <Plus className=\"h-4 w-4\" />\n                {t('lead_statuses.add_status')}\n              </Button>\n            </div>\n            \n            <div className=\"p-3 bg-muted/30 rounded-lg border border-dashed border-muted-foreground/20\">\n              <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                {t('lead_statuses.drag_instructions')}\n              </p>\n            </div>\n\n            <DragDropContext onDragEnd={handleCustomDragEnd}>\n              <Droppable droppableId=\"custom-statuses\" direction=\"horizontal\">\n                {(provided, snapshot) => (\n                  <div\n                    {...provided.droppableProps}\n                    ref={provided.innerRef}\n                    className={cn(\n                      \"flex flex-wrap gap-3 min-h-[48px] transition-colors rounded-lg p-2\",\n                      snapshot.isDraggingOver && \"bg-accent/20\"\n                    )}\n                  >\n                    {customStatuses.map((status, index) => (\n                      <Draggable key={status.id} draggableId={status.id} index={index}>\n                        {(provided, snapshot) => (\n                          <div\n                            ref={provided.innerRef}\n                            {...provided.draggableProps}\n                            className={cn(\n                              \"inline-flex min-w-0 max-w-full flex-wrap items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium transition-all select-none\",\n                              snapshot.isDragging ? \"opacity-80 shadow-xl scale-105 z-50\" : \"hover:opacity-80 cursor-pointer\",\n                              !snapshot.isDragging && \"hover:scale-[1.02]\"\n                            )}\n                            style={{ \n                              backgroundColor: status.color + '20',\n                              color: status.color,\n                              border: `1px solid ${status.color}40`,\n                              ...provided.draggableProps.style\n                            }}\n                          >\n                            <div \n                              {...provided.dragHandleProps}\n                              className=\"flex items-center cursor-grab active:cursor-grabbing hover:opacity-70 transition-opacity\"\n                              onClick={(e) => e.stopPropagation()}\n                            >\n                              <GripVertical className=\"w-3 h-3 text-current opacity-60\" />\n                            </div>\n                            <div \n                              className=\"w-2 h-2 rounded-full flex-shrink-0\" \n                              style={{ backgroundColor: status.color }}\n                            />\n                            <span \n                              className=\"break-words text-left text-sm font-semibold uppercase tracking-wide cursor-pointer\"\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                handleEdit(status);\n                              }}\n                            >\n                              {status.name}\n                            </span>\n                            {status.lifecycle && status.lifecycle !== 'active' && (\n                              <span className=\"break-words text-left text-xs font-normal capitalize opacity-60\">\n                                Â· {status.lifecycle}\n                              </span>\n                            )}\n                          </div>\n                        )}\n                      </Draggable>\n                    ))}\n                    {provided.placeholder}\n                  </div>\n                )}\n              </Droppable>\n            </DragDropContext>\n          </div>\n        </div>\n\n        {/* Add Dialog */}\n        <AddLeadStatusDialog\n          open={isAddDialogOpen}\n          onOpenChange={setIsAddDialogOpen}\n          onStatusAdded={() => {\n            queryClient.invalidateQueries({ queryKey: ['lead_statuses', activeOrganizationId] });\n          }}\n        />\n\n        {/* Edit Dialog */}\n        <EditLeadStatusDialog\n          status={editingStatus}\n          open={isEditDialogOpen}\n          onOpenChange={setIsEditDialogOpen}\n          onStatusUpdated={() => {\n            queryClient.invalidateQueries({ queryKey: ['lead_statuses', activeOrganizationId] });\n          }}\n        />\n      </SettingsSection>\n    </>\n  );\n};\n\nexport default LeadStatusesSection;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/MobileStickyNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/NewServiceDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/NewSessionDialog.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchLeads'. Either include it or remove the dependency array.","line":107,"column":6,"nodeType":"ArrayExpression","endLine":107,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [fetchLeads, open]","fix":{"range":[3811,3817],"text":"[fetchLeads, open]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5534,5537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5534,5537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6284,6287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6284,6287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":319,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10348,10351],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10348,10351],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { AppSheetModal } from \"@/components/ui/app-sheet-modal\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Plus, Calendar, Search, ChevronDown, Check } from \"lucide-react\";\nimport { getLeadStatusStyles, formatStatusText } from \"@/lib/leadStatusColors\";\nimport { useI18nToast } from \"@/lib/toastHelpers\";\nimport { cn } from \"@/lib/utils\";\nimport { useWorkflowTriggers } from \"@/hooks/useWorkflowTriggers\";\nimport { useSessionReminderScheduling } from \"@/hooks/useSessionReminderScheduling\";\nimport { useFormsTranslation, useCommonTranslation } from \"@/hooks/useTypedTranslation\";\nimport { SessionPlanningWizardSheet } from \"@/features/session-planning\";\nimport { FEATURE_FLAGS, isFeatureEnabled } from \"@/lib/featureFlags\";\n\ninterface Lead {\n  id: string;\n  name: string;\n  email: string;\n  phone: string;\n  sessionStatus: 'none' | 'planned' | 'completed';\n  hasScheduledSession: boolean;\n}\n\ninterface NewSessionDialogProps {\n  onSessionScheduled?: () => void;\n  children?: React.ReactNode;\n}\n\nconst NewSessionDialog = (props: NewSessionDialogProps) => {\n  const sessionWizardEnabled = isFeatureEnabled(FEATURE_FLAGS.sessionWizardV1, true);\n  if (sessionWizardEnabled) {\n    return <WizardNewSessionDialog {...props} />;\n  }\n  return <LegacyNewSessionDialog {...props} />;\n};\n\nconst WizardNewSessionDialog = ({ onSessionScheduled, children }: NewSessionDialogProps) => {\n  const [open, setOpen] = useState(false);\n  const { t: tForms } = useFormsTranslation();\n\n  return (\n    <>\n      {children ? (\n        <div onClick={() => setOpen(true)}>{children}</div>\n      ) : (\n        <Button size=\"sm\" className=\"gap-2\" onClick={() => setOpen(true)}>\n          <Plus className=\"h-4 w-4\" />\n          {tForms(\"sessions.schedule_new\")}\n        </Button>\n      )}\n      <SessionPlanningWizardSheet\n        isOpen={open}\n        onOpenChange={setOpen}\n        entrySource=\"sessionsPage\"\n        onSessionScheduled={() => {\n          onSessionScheduled?.();\n          setOpen(false);\n        }}\n      />\n    </>\n  );\n};\n\nconst LegacyNewSessionDialog = ({ onSessionScheduled, children }: NewSessionDialogProps) => {\n  const [open, setOpen] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [leads, setLeads] = useState<Lead[]>([]);\n  const [loadingLeads, setLoadingLeads] = useState(false);\n  const [isNewLead, setIsNewLead] = useState(false);\n  const { triggerSessionScheduled } = useWorkflowTriggers();\n  const { scheduleSessionReminders } = useSessionReminderScheduling();\n  const { t: tForms } = useFormsTranslation();\n  const { t: tCommon } = useCommonTranslation();\n  const toast = useI18nToast();\n  \n  const [sessionData, setSessionData] = useState({\n    session_date: \"\",\n    session_time: \"\",\n    notes: \"\",\n    location: \"\"\n  });\n\n  const [newLeadData, setNewLeadData] = useState({\n    name: \"\",\n    email: \"\",\n    phone: \"\",\n    notes: \"\"\n  });\n\n  const [selectedLeadId, setSelectedLeadId] = useState(\"\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [dropdownOpen, setDropdownOpen] = useState(false);\n  const [selectedProjectId, setSelectedProjectId] = useState(\"\");\n  const [projects, setProjects] = useState<{id: string, name: string}[]>([]);\n\n  useEffect(() => {\n    if (open) {\n      fetchLeads();\n    }\n  }, [open]);\n\n  // Fetch projects when a lead is selected\n  useEffect(() => {\n    if (selectedLeadId && !isNewLead) {\n      fetchProjects(selectedLeadId);\n    } else {\n      setProjects([]);\n      setSelectedProjectId(\"\");\n    }\n  }, [selectedLeadId, isNewLead]);\n\n  const fetchLeads = async () => {\n    setLoadingLeads(true);\n    try {\n      // First get all leads\n      const { data: leadsData, error: leadsError } = await supabase\n        .from('leads')\n        .select('id, name, email, phone')\n        .order('name', { ascending: true });\n\n      if (leadsError) throw leadsError;\n\n      // Then get sessions for these leads\n      const { data: sessionsData, error: sessionsError } = await supabase\n        .from('sessions')\n        .select('lead_id, status');\n\n      if (sessionsError) throw sessionsError;\n\n      // Process leads to determine session status\n      const processedLeads = (leadsData || []).map(lead => {\n        const leadSessions = sessionsData?.filter(session => session.lead_id === lead.id) || [];\n        const hasScheduledSession = leadSessions.some(session => session.status === 'planned');\n        const hasCompletedSession = leadSessions.some(session => session.status === 'completed');\n        \n        let sessionStatus: 'none' | 'planned' | 'completed' = 'none';\n        if (hasScheduledSession) {\n          sessionStatus = 'planned';\n        } else if (hasCompletedSession) {\n          sessionStatus = 'completed';\n        }\n        \n        return {\n          id: lead.id,\n          name: lead.name,\n          email: lead.email,\n          phone: lead.phone,\n          sessionStatus,\n          hasScheduledSession\n        };\n      });\n      \n      setLeads(processedLeads);\n    } catch (error: any) {\n      toast.error(error.message);\n    } finally {\n      setLoadingLeads(false);\n    }\n  };\n\n  const fetchProjects = async (leadId: string) => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n\n      // Get user's active organization ID\n      const { data: organizationId } = await supabase.rpc('get_user_active_organization_id');\n      if (!organizationId) return;\n\n      const { data: projectsData, error } = await supabase\n        .from('projects')\n        .select('id, name')\n        .eq('lead_id', leadId)\n        .eq('organization_id', organizationId)\n        .order('name', { ascending: true });\n\n      if (error) throw error;\n      setProjects(projectsData || []);\n    } catch (error: any) {\n      console.error('Error fetching projects:', error);\n      setProjects([]);\n    }\n  };\n\n  const handleSubmit = async () => {\n    if (!sessionData.session_date || !sessionData.session_time) {\n      toast.error(tForms('validation.session_date_time_required'));\n      return;\n    }\n\n    if (!isNewLead && !selectedLeadId) {\n      toast.error(tForms('validation.lead_required'));\n      return;\n    }\n\n    if (isNewLead && !newLeadData.name.trim()) {\n      toast.error(tForms('validation.lead_name_required'));\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error(\"User not authenticated\");\n\n      // Get user's active organization ID\n      const { data: organizationId } = await supabase.rpc('get_user_active_organization_id');\n\n      if (!organizationId) {\n        throw new Error(\"Organization required\");\n      }\n\n      let leadId = selectedLeadId;\n\n      // Create new lead if needed\n      if (isNewLead) {\n        const { data: newLead, error: leadError } = await supabase\n          .from('leads')\n          .insert({\n            user_id: user.id,\n            organization_id: organizationId,\n            name: newLeadData.name.trim(),\n            email: newLeadData.email.trim() || null,\n            phone: newLeadData.phone.trim() || null,\n            notes: newLeadData.notes.trim() || null,\n            status: 'booked'\n          })\n          .select('id')\n          .single();\n\n        if (leadError) throw leadError;\n        leadId = newLead.id;\n      } else {\n        // Update existing lead status to booked\n        const { error: updateError } = await supabase\n          .from('leads')\n          .update({ status: 'booked' })\n          .eq('id', selectedLeadId);\n\n        if (updateError) throw updateError;\n      }\n\n      // Create session\n      const { data: newSession, error: sessionError } = await supabase\n        .from('sessions')\n        .insert({\n          user_id: user.id,\n          organization_id: organizationId,\n          lead_id: leadId,\n          session_date: sessionData.session_date,\n          session_time: sessionData.session_time,\n          notes: sessionData.notes.trim() || null,\n          location: sessionData.location.trim() || null,\n          project_id: selectedProjectId || null\n        })\n        .select('id')\n        .single();\n\n      if (sessionError) throw sessionError;\n\n      // Get lead name for workflow\n      const leadName = isNewLead ? newLeadData.name : leads.find(l => l.id === leadId)?.name || 'Unknown Client';\n\n      // Trigger workflow for session scheduled\n      try {\n        const workflowResult = await triggerSessionScheduled(newSession.id, organizationId, {\n          session_date: sessionData.session_date,\n          session_time: sessionData.session_time,\n          location: sessionData.location,\n          client_name: leadName,\n          lead_id: leadId,\n          project_id: selectedProjectId,\n          status: 'planned'\n        });\n      } catch (workflowError) {\n        console.error('âŒ Error triggering session_scheduled workflow:', workflowError);\n        toast.warning(tForms('sessions.sessionCreatedWarning'));\n      }\n\n      // Schedule session reminders\n      try {\n        await scheduleSessionReminders(newSession.id);\n      } catch (reminderError) {\n        console.error('âŒ Error scheduling session reminders:', reminderError);\n        // Don't block session creation if reminder scheduling fails\n      }\n\n      toast.success(tCommon('messages.success.save'));\n\n      // Reset form and close dialog\n      setSessionData({\n        session_date: \"\",\n        session_time: \"\",\n        notes: \"\",\n        location: \"\"\n      });\n      setNewLeadData({\n        name: \"\",\n        email: \"\",\n        phone: \"\",\n        notes: \"\"\n      });\n      setSelectedLeadId(\"\");\n      setSelectedProjectId(\"\");\n      setIsNewLead(false);\n      setOpen(false);\n      \n      // Notify parent component\n      if (onSessionScheduled) {\n        onSessionScheduled();\n      }\n    } catch (error: any) {\n      console.error('âŒ CRITICAL ERROR in session creation:', error);\n      console.error('Error details:', {\n        message: error.message,\n        code: error.code,\n        details: error.details,\n        hint: error.hint,\n        stack: error.stack?.substring(0, 500)\n      });\n      \n      toast.error(error.message);\n    } finally{\n      setLoading(false);\n    }\n  };\n\n  const handleSessionDataChange = (field: keyof typeof sessionData, value: string) => {\n    setSessionData(prev => ({\n      ...prev,\n      [field]: value\n    }));\n  };\n\n  const handleNewLeadDataChange = (field: keyof typeof newLeadData, value: string) => {\n    setNewLeadData(prev => ({\n      ...prev,\n      [field]: value\n    }));\n  };\n\n  // Filter leads based on search term\n  const filteredLeads = leads.filter(lead =>\n    lead.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    (lead.email && lead.email.toLowerCase().includes(searchTerm.toLowerCase()))\n  );\n\n  const isDirty = Boolean(\n    sessionData.session_date.trim() ||\n    sessionData.session_time.trim() ||\n    sessionData.notes.trim() ||\n    sessionData.location.trim() ||\n    (isNewLead && (newLeadData.name.trim() || newLeadData.email.trim() || newLeadData.phone.trim() || newLeadData.notes.trim())) ||\n    (!isNewLead && selectedLeadId)\n  );\n\n  const handleDirtyClose = () => {\n    if (window.confirm(tCommon('messages.confirm.unsaved_changes'))) {\n      setSessionData({\n        session_date: \"\",\n        session_time: \"\",\n        notes: \"\",\n        location: \"\"\n      });\n      setNewLeadData({\n        name: \"\",\n        email: \"\",\n        phone: \"\",\n        notes: \"\"\n      });\n      setSelectedLeadId(\"\");\n      setSelectedProjectId(\"\");\n      setIsNewLead(false);\n      setOpen(false);\n    }\n  };\n\n  const footerActions = [\n    {\n      label: tCommon('buttons.cancel'),\n      onClick: () => setOpen(false),\n      variant: \"outline\" as const,\n      disabled: loading\n    },\n    {\n      label: loading ? tCommon('actions.saving') : tCommon('buttons.save'),\n      onClick: handleSubmit,\n      disabled: loading || !sessionData.session_date || !sessionData.session_time || (!selectedLeadId && !newLeadData.name.trim()),\n      loading: loading\n    }\n  ];\n\n  return (\n    <>\n      {children ? (\n        <div onClick={() => setOpen(true)}>\n          {children}\n        </div>\n      ) : (\n        <Button size=\"sm\" className=\"gap-2\" onClick={() => setOpen(true)}>\n          <Plus className=\"h-4 w-4\" />\n          {tCommon('buttons.add')}\n        </Button>\n      )}\n\n      <AppSheetModal\n        title={tForms('sessions.schedule_new')}\n        isOpen={open}\n        onOpenChange={setOpen}\n        size=\"lg\"\n        dirty={isDirty}\n        onDirtyClose={handleDirtyClose}\n        footerActions={footerActions}\n      >\n        <div className=\"grid gap-4\">\n          {/* Lead Selection */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center space-x-2\">\n              <input\n                type=\"radio\"\n                id=\"existing-lead\"\n                name=\"lead-type\"\n                checked={!isNewLead}\n                onChange={() => setIsNewLead(false)}\n                className=\"h-4 w-4\"\n              />\n              <Label htmlFor=\"existing-lead\">{tForms('sessions.select_existing_client')}</Label>\n            </div>\n            \n            {!isNewLead && (\n            <div className=\"space-y-2\">\n                <Label htmlFor=\"lead-search\">{tForms('sessionScheduling.client')}</Label>\n                <Popover open={dropdownOpen} onOpenChange={setDropdownOpen}>\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant=\"outline\"\n                      role=\"combobox\"\n                      aria-expanded={dropdownOpen}\n                      className=\"w-full justify-between text-left h-auto min-h-[40px]\"\n                      disabled={loadingLeads}\n                    >\n                      {selectedLeadId ? (\n                        <div className=\"flex items-center justify-between w-full\">\n                          <div className=\"flex flex-col\">\n                            <span className=\"font-medium\">{leads.find(lead => lead.id === selectedLeadId)?.name}</span>\n                            {leads.find(lead => lead.id === selectedLeadId)?.email && (\n                              <span className=\"text-xs text-muted-foreground\">{leads.find(lead => lead.id === selectedLeadId)?.email}</span>\n                            )}\n                          </div>\n                          {leads.find(lead => lead.id === selectedLeadId) && (\n                            <Badge\n                              variant={\n                                leads.find(lead => lead.id === selectedLeadId)?.sessionStatus === 'planned' ? 'destructive' :\n                                leads.find(lead => lead.id === selectedLeadId)?.sessionStatus === 'completed' ? 'secondary' : 'outline'\n                              }\n                              className=\"text-xs\"\n                            >\n                             {leads.find(lead => lead.id === selectedLeadId)?.sessionStatus === 'none' ? tForms('sessions.available') : \n                              leads.find(lead => lead.id === selectedLeadId)?.sessionStatus === 'planned' ? tForms('sessions.scheduled') :\n                              leads.find(lead => lead.id === selectedLeadId)?.sessionStatus === 'completed' ? tForms('sessions.completed') :\n                              leads.find(lead => lead.id === selectedLeadId)?.sessionStatus}\n                            </Badge>\n                          )}\n                        </div>\n                      ) : loadingLeads ? (\n                        tForms('sessions.loading_clients')\n                      ) : (\n                        tForms('placeholders.select_client_placeholder')\n                      )}\n                      <ChevronDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-full p-0 z-50 bg-popover\" align=\"start\">\n                    <div className=\"p-3 border-b\">\n                      <div className=\"relative\">\n                        <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\n                        <Input\n                          placeholder={tForms('placeholders.search_by_name_or_email')}\n                          value={searchTerm}\n                          onChange={(e) => setSearchTerm(e.target.value)}\n                          className=\"pl-10\"\n                          autoFocus\n                        />\n                      </div>\n                    </div>\n                    <div className=\"max-h-64 overflow-y-auto\">\n                      {loadingLeads ? (\n                        <div className=\"p-4 text-center text-sm text-muted-foreground\">\n                          {tForms('sessions.loading_clients')}\n                        </div>\n                      ) : filteredLeads.length === 0 ? (\n                        <div className=\"p-4 text-center text-sm text-muted-foreground\">\n                          {searchTerm ? tForms('sessions.no_clients_match') : tForms('sessions.no_clients_found')}\n                        </div>\n                      ) : (\n                        filteredLeads.map((lead) => (\n                          <div\n                            key={lead.id}\n                            onClick={() => {\n                              if (!lead.hasScheduledSession) {\n                                setSelectedLeadId(lead.id);\n                                setDropdownOpen(false);\n                                setSearchTerm(\"\");\n                              }\n                            }}\n                            className={cn(\n                              \"flex items-center justify-between p-3 hover:bg-muted/50 cursor-pointer border-b last:border-b-0\",\n                              lead.hasScheduledSession && \"opacity-50 cursor-not-allowed hover:bg-transparent\",\n                              selectedLeadId === lead.id && \"bg-muted\"\n                            )}\n                          >\n                            <div className=\"flex items-center space-x-3\">\n                              <Check\n                                className={cn(\n                                  \"h-4 w-4\",\n                                  selectedLeadId === lead.id ? \"opacity-100\" : \"opacity-0\"\n                                )}\n                              />\n                              <div className=\"flex flex-col\">\n                                <span className=\"font-medium\">{lead.name}</span>\n                                {lead.email && (\n                                  <span className=\"text-xs text-muted-foreground\">{lead.email}</span>\n                                )}\n                              </div>\n                            </div>\n                            <div className=\"flex items-center space-x-2\">\n                               <Badge\n                                 variant={\n                                   lead.sessionStatus === 'planned' ? 'destructive' :\n                                   lead.sessionStatus === 'completed' ? 'secondary' : 'outline'\n                                 }\n                                 className=\"text-xs\"\n                               >\n                                 {lead.sessionStatus === 'none' ? tForms('sessions.available') : \n                                  lead.sessionStatus === 'planned' ? tForms('sessions.scheduled') :\n                                  lead.sessionStatus === 'completed' ? tForms('sessions.completed') :\n                                  lead.sessionStatus}\n                               </Badge>\n                            </div>\n                          </div>\n                        ))\n                      )}\n                    </div>\n                  </PopoverContent>\n                </Popover>\n              </div>\n            )}\n\n            <div className=\"flex items-center space-x-2\">\n              <input\n                type=\"radio\"\n                id=\"new-lead\"\n                name=\"lead-type\"\n                checked={isNewLead}\n                onChange={() => setIsNewLead(true)}\n                className=\"h-4 w-4\"\n              />\n              <Label htmlFor=\"new-lead\">{tForms('sessions.create_new_client')}</Label>\n            </div>\n\n            {isNewLead && (\n              <div className=\"space-y-3 pl-6 border-l-2 border-muted\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"new-name\">{tForms('labels.name')} *</Label>\n                  <Input\n                    id=\"new-name\"\n                    value={newLeadData.name}\n                    onChange={(e) => handleNewLeadDataChange(\"name\", e.target.value)}\n                    placeholder={tForms('placeholders.enterName')}\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"new-email\">{tForms('labels.email')}</Label>\n                  <Input\n                    id=\"new-email\"\n                    type=\"email\"\n                    value={newLeadData.email}\n                    onChange={(e) => handleNewLeadDataChange(\"email\", e.target.value)}\n                    placeholder={tForms('placeholders.enterEmail')}\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"new-phone\">{tForms('labels.phone')}</Label>\n                  <Input\n                    id=\"new-phone\"\n                    value={newLeadData.phone}\n                    onChange={(e) => handleNewLeadDataChange(\"phone\", e.target.value)}\n                    placeholder={tForms('placeholders.enterPhone')}\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"new-notes\">{tForms('labels.notes')}</Label>\n                  <Textarea\n                    id=\"new-notes\"\n                    value={newLeadData.notes}\n                    onChange={(e) => handleNewLeadDataChange(\"notes\", e.target.value)}\n                    placeholder={tForms('placeholders.additionalNotes')}\n                    rows={2}\n                  />\n                </div>\n              </div>\n            )}\n          </div>\n\n          <Separator />\n\n          {/* Session Details */}\n          <div className=\"space-y-4\">\n            <h4 className=\"text-sm font-medium\">{tForms('labels.session_date')} & {tForms('labels.session_time')}</h4>\n            \n            <div className=\"space-y-2\">\n              <Label htmlFor=\"session_date\">{tForms('labels.session_date')} *</Label>\n              <Input\n                id=\"session_date\"\n                type=\"date\"\n                value={sessionData.session_date}\n                onChange={(e) => handleSessionDataChange(\"session_date\", e.target.value)}\n                min={new Date().toISOString().split('T')[0]}\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"session_time\">{tForms('labels.session_time')} *</Label>\n              <Input\n                id=\"session_time\"\n                type=\"time\"\n                value={sessionData.session_time}\n                onChange={(e) => handleSessionDataChange(\"session_time\", e.target.value)}\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"session_location\">{tForms('labels.location')}</Label>\n              <Textarea\n                id=\"session_location\"\n                value={sessionData.location}\n                onChange={(e) => handleSessionDataChange(\"location\", e.target.value)}\n                placeholder={tForms('placeholders.enter_location')}\n                rows={2}\n              />\n            </div>\n\n            {/* Project selection - only show for existing leads */}\n            {!isNewLead && selectedLeadId && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"project\">{tForms('sessions.select_project')}</Label>\n                <Select value={selectedProjectId} onValueChange={setSelectedProjectId} disabled={projects.length === 0}>\n                  <SelectTrigger>\n                    <SelectValue placeholder={projects.length === 0 ? tForms('sessions.no_projects') : tForms('sessions.select_project')} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {projects.map((project) => (\n                      <SelectItem key={project.id} value={project.id}>\n                        {project.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"session_notes\">{tForms('labels.notes')}</Label>\n              <Textarea\n                id=\"session_notes\"\n                value={sessionData.notes}\n                onChange={(e) => handleSessionDataChange(\"notes\", e.target.value)}\n                placeholder={tForms('placeholders.enterNotes')}\n                rows={3}\n              />\n            </div>\n          </div>\n        </div>\n      </AppSheetModal>\n    </>\n  );\n};\n\nexport default NewSessionDialog;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/NewSessionDialogForProject.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/OfflineBanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/OnboardingModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/PackagesSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/PerformanceMonitor.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":13,"column":3,"nodeType":"Identifier","endLine":13,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1184,1187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1184,1187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useRef } from 'react';\nimport { useOnboarding } from '@/contexts/OnboardingContext';\n\nexport function PerformanceMonitor() {\n  const renderCountRef = useRef(0);\n  const { stage, currentStep, loading } = useOnboarding();\n  \n  // Only run in development\n  if (process.env.NODE_ENV !== 'development') {\n    return null;\n  }\n\n  useEffect(() => {\n    renderCountRef.current++;\n    \n    // Monitor for excessive re-renders with higher threshold for production readiness\n    if (renderCountRef.current > 100) {\n      console.warn('PerformanceMonitor: High onboarding re-render count detected:', {\n        renderCount: renderCountRef.current,\n        stage,\n        currentStep,\n        loading,\n        timestamp: new Date().toISOString()\n      });\n    }\n    \n    // Reset counter every 15 seconds for continuous monitoring\n    const resetTimer = setTimeout(() => {\n      renderCountRef.current = 0;\n    }, 15000);\n    \n    return () => clearTimeout(resetTimer);\n  }, [stage, currentStep, loading]);\n\n  return null;\n}\n\n// Production performance metrics (development only)\nif (typeof window !== 'undefined' && process.env.NODE_ENV === 'development') {\n  (window as any).onboardingMetrics = {\n    getRenderCount: () => {\n      const element = document.querySelector('[data-onboarding-monitor]') as HTMLElement;\n      return element?.dataset?.renderCount || '0';\n    },\n    getPerformanceStats: async () => {\n      // Database performance stats available via Supabase dashboard\n      return { \n        message: 'V3 Onboarding System - Production Ready',\n        databaseClean: true,\n        cacheOptimized: true,\n        consoleSpamRemoved: true\n      };\n    }\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProfessionalKanbanCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProjectActivitySection.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'isRelevantLog'. Either include it or remove the dependency array.","line":285,"column":6,"nodeType":"ArrayExpression","endLine":285,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [isRelevantLog, projectId]","fix":{"range":[9184,9195],"text":"[isRelevantLog, projectId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { ActivityForm } from \"@/components/shared/ActivityForm\";\nimport { ActivityTimeline } from \"@/components/shared/ActivityTimeline\";\nimport { SegmentedControl } from \"@/components/ui/segmented-control\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useState, useEffect, useCallback } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { useFormsTranslation } from \"@/hooks/useTypedTranslation\";\nimport { formatLongDate, formatTime } from \"@/lib/utils\";\nimport type { Database, Json } from \"@/integrations/supabase/types\";\nimport type { PostgrestError } from \"@supabase/supabase-js\";\n\ntype ActivityRow = Database[\"public\"][\"Tables\"][\"activities\"][\"Row\"];\ntype AuditLogRow = Database[\"public\"][\"Tables\"][\"audit_log\"][\"Row\"];\ntype ProjectStatusRow = Database[\"public\"][\"Tables\"][\"project_statuses\"][\"Row\"];\ntype ServiceRow = Database[\"public\"][\"Tables\"][\"services\"][\"Row\"];\n\ntype ProjectActivity = {\n  id: string;\n  type: ActivityRow[\"type\"];\n  content: string;\n  reminder_date: string | null;\n  reminder_time: string | null;\n  created_at: string;\n  completed: boolean;\n  lead_id: string;\n  user_id: string;\n  project_id?: string;\n};\n\nconst mapActivityRow = (row: ActivityRow): ProjectActivity => ({\n  id: row.id,\n  type: row.type,\n  content: row.content ?? \"\",\n  reminder_date: row.reminder_date,\n  reminder_time: row.reminder_time,\n  created_at: row.created_at,\n  completed: Boolean(row.completed),\n  lead_id: row.lead_id,\n  user_id: row.user_id,\n  project_id: row.project_id ?? undefined,\n});\n\ntype AuditLogValues = Record<string, unknown> | null;\n\ninterface AuditLogEntry {\n  id: string;\n  user_id: string;\n  entity_type: string;\n  entity_id: string;\n  action: string;\n  old_values: AuditLogValues;\n  new_values: AuditLogValues;\n  created_at: string;\n}\n\nconst jsonToRecord = (value: Json | null): AuditLogValues => {\n  if (value && typeof value === \"object\" && !Array.isArray(value)) {\n    return value as Record<string, unknown>;\n  }\n  return null;\n};\n\nconst mapAuditLogRow = (row: AuditLogRow): AuditLogEntry => ({\n  id: row.id,\n  user_id: row.user_id,\n  entity_type: row.entity_type,\n  entity_id: row.entity_id,\n  action: row.action,\n  old_values: jsonToRecord(row.old_values),\n  new_values: jsonToRecord(row.new_values),\n  created_at: row.created_at,\n});\n\nconst getErrorMessage = (error: unknown): string => {\n  if (error instanceof Error) {\n    return error.message;\n  }\n  if (typeof error === \"string\") {\n    return error;\n  }\n  return \"An unexpected error occurred\";\n};\n\nconst getRecordValue = <T,>(\n  record: AuditLogValues,\n  key: string,\n  predicate: (value: unknown) => value is T\n): T | undefined => {\n  const value = record?.[key];\n  return predicate(value) ? value : undefined;\n};\n\nconst getStringValue = (record: AuditLogValues, key: string): string | undefined =>\n  getRecordValue(record, key, (value): value is string => typeof value === \"string\");\n\nconst getNumberValue = (record: AuditLogValues, key: string): number | undefined =>\n  getRecordValue(record, key, (value): value is number => typeof value === \"number\");\n\nconst getBooleanValue = (record: AuditLogValues, key: string): boolean | undefined =>\n  getRecordValue(record, key, (value): value is boolean => typeof value === \"boolean\");\n\ninterface ProjectActivitySectionProps {\n  projectId: string;\n  leadId: string;\n  leadName: string;\n  projectName: string;\n  onActivityUpdated?: () => void;\n}\n\nexport function ProjectActivitySection({\n  projectId,\n  leadId,\n  leadName,\n  projectName,\n  onActivityUpdated\n}: ProjectActivitySectionProps) {\n  const { t } = useFormsTranslation();\n  const [activities, setActivities] = useState<ProjectActivity[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [auditLogs, setAuditLogs] = useState<AuditLogEntry[]>([]);\n  const [statusLookup, setStatusLookup] = useState<Record<string, string>>({});\n  const [serviceLookup, setServiceLookup] = useState<Record<string, string>>({});\n  const [selectedSegment, setSelectedSegment] = useState<\"activity\" | \"history\">(\"activity\");\n\n  const fetchProjectActivities = useCallback(async () => {\n    try {\n      const { data, error } = await supabase\n        .from<ActivityRow>(\"activities\")\n        .select(\"*\")\n        .eq(\"lead_id\", leadId)\n        .eq(\"project_id\", projectId)\n        .order(\"created_at\", { ascending: false });\n\n      if (error) {\n        throw error;\n      }\n\n      setActivities((data ?? []).map(mapActivityRow));\n    } catch (error) {\n      console.error(\"Error fetching project activities:\", error);\n      setActivities([]);\n    }\n  }, [leadId, projectId]);\n\n  const fetchHistoryData = useCallback(async () => {\n    try {\n      const logMap = new Map<string, AuditLogEntry>();\n      const statusIds = new Set<string>();\n      const serviceIds = new Set<string>();\n\n      const collect = (rows: AuditLogRow[] | null | undefined) => {\n        (rows ?? []).forEach((row) => {\n          if (!isRelevantLog(row)) {\n            return;\n          }\n          const mapped = mapAuditLogRow(row);\n          logMap.set(mapped.id, mapped);\n\n          if (mapped.entity_type === \"project\") {\n            const oldStatus = getStringValue(mapped.old_values, \"status_id\");\n            const newStatus = getStringValue(mapped.new_values, \"status_id\");\n            if (oldStatus) statusIds.add(oldStatus);\n            if (newStatus) statusIds.add(newStatus);\n          }\n\n          if (mapped.entity_type === \"project_service\" || mapped.entity_type === \"project_package\") {\n            const oldService = getStringValue(mapped.old_values, \"service_id\") ?? getStringValue(mapped.old_values, \"package_id\");\n            const newService = getStringValue(mapped.new_values, \"service_id\") ?? getStringValue(mapped.new_values, \"package_id\");\n            if (oldService) serviceIds.add(oldService);\n            if (newService) serviceIds.add(newService);\n          }\n        });\n      };\n\n      const runQuery = async (\n        query: Promise<{ data: AuditLogRow[] | null; error: PostgrestError | null }>\n      ) => {\n        const { data, error } = await query;\n        if (error) {\n          console.error(\"Error fetching project history logs:\", error);\n          return;\n        }\n        collect(data);\n      };\n\n      await runQuery(\n        supabase\n          .from<AuditLogRow>(\"audit_log\")\n          .select(\"*\")\n          .eq(\"entity_type\", \"project\")\n          .eq(\"entity_id\", projectId)\n          .order(\"created_at\", { ascending: false })\n          .limit(200)\n      );\n\n      const entityTypes: Array<AuditLogRow[\"entity_type\"]> = [\n        \"session\",\n        \"payment\",\n        \"todo\",\n        \"activity\",\n        \"project_service\",\n        \"project_package\",\n      ];\n\n      for (const type of entityTypes) {\n        await runQuery(\n          supabase\n            .from<AuditLogRow>(\"audit_log\")\n            .select(\"*\")\n            .eq(\"entity_type\", type)\n            .order(\"created_at\", { ascending: false })\n            .limit(200)\n        );\n      }\n\n      const logs = Array.from(logMap.values()).sort(\n        (a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime()\n      );\n\n      const lookupPromises: Promise<void>[] = [];\n\n      if (statusIds.size > 0) {\n        lookupPromises.push(\n          supabase\n            .from<ProjectStatusRow>(\"project_statuses\")\n            .select(\"id, name\")\n            .in(\"id\", Array.from(statusIds))\n            .then(({ data, error }) => {\n              if (error || !data) {\n                console.error(\"Error fetching project statuses for history:\", error);\n                setStatusLookup({});\n                return;\n              }\n              setStatusLookup(\n                data.reduce<Record<string, string>>((acc, row) => {\n                  acc[row.id] = row.name;\n                  return acc;\n                }, {})\n              );\n            })\n        );\n      } else {\n        setStatusLookup({});\n      }\n\n      if (serviceIds.size > 0) {\n        lookupPromises.push(\n          supabase\n            .from<ServiceRow>(\"services\")\n            .select(\"id, name\")\n            .in(\"id\", Array.from(serviceIds))\n            .then(({ data, error }) => {\n              if (error || !data) {\n                console.error(\"Error fetching services for history:\", error);\n                setServiceLookup({});\n                return;\n              }\n              setServiceLookup(\n                data.reduce<Record<string, string>>((acc, row) => {\n                  acc[row.id] = row.name ?? row.id;\n                  return acc;\n                }, {})\n              );\n            })\n        );\n      } else {\n        setServiceLookup({});\n      }\n\n      if (lookupPromises.length > 0) {\n        await Promise.all(lookupPromises);\n      }\n\n      setAuditLogs(logs);\n    } catch (error) {\n      console.error(\"Error fetching project history:\", error);\n      setAuditLogs([]);\n      setStatusLookup({});\n      setServiceLookup({});\n    }\n  }, [projectId]);\n\n  const logReferencesProject = useCallback(\n    (values: Json | null): boolean => {\n      const record = jsonToRecord(values);\n      if (!record) return false;\n      const candidateKeys = [\"project_id\", \"projectId\", \"project\"];\n\n      return candidateKeys.some((key) => {\n        const value = record[key];\n        if (typeof value === \"string\") {\n          return value === projectId;\n        }\n        if (\n          value &&\n          typeof value === \"object\" &&\n          \"id\" in (value as Record<string, unknown>)\n        ) {\n          const maybeId = (value as Record<string, unknown>).id;\n          return typeof maybeId === \"string\" && maybeId === projectId;\n        }\n        return false;\n      });\n    },\n    [projectId]\n  );\n\n  const isRelevantLog = useCallback(\n    (row: AuditLogRow) =>\n      (row.entity_type === \"project\" && row.entity_id === projectId) ||\n      logReferencesProject(row.new_values) ||\n      logReferencesProject(row.old_values),\n    [projectId, logReferencesProject]\n  );\n\n  useEffect(() => {\n    let cancelled = false;\n\n    const load = async () => {\n      setLoading(true);\n      try {\n        await Promise.all([fetchProjectActivities(), fetchHistoryData()]);\n      } finally {\n        if (!cancelled) {\n          setLoading(false);\n        }\n      }\n    };\n\n    void load();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [fetchProjectActivities, fetchHistoryData]);\n\n  useEffect(() => {\n    const channel = supabase\n      .channel(`project-history-${projectId}`)\n      .on(\n        \"postgres_changes\",\n        {\n          event: \"INSERT\",\n          schema: \"public\",\n          table: \"audit_log\",\n        },\n        (payload) => {\n          const row = payload.new as AuditLogRow | null;\n          if (row && isRelevantLog(row)) {\n            void fetchHistoryData();\n          }\n        }\n      )\n      .subscribe();\n\n    return () => {\n      void supabase.removeChannel(channel);\n    };\n  }, [projectId, fetchHistoryData, isRelevantLog]);\n\n  const handleSaveActivity = async (\n    content: string,\n    isReminderMode: boolean,\n    reminderDateTime?: string\n  ) => {\n    if (!content.trim()) {\n      toast({\n        title: t(\"validation.required_field\"),\n        description: t(\"validation.content_required\"),\n        variant: \"destructive\",\n      });\n      return;\n    }\n    if (isReminderMode && !reminderDateTime) {\n      toast({\n        title: t(\"validation.required_field\"),\n        description: t(\"validation.datetime_required_for_reminders\"),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setSaving(true);\n    try {\n      const { data: userData } = await supabase.auth.getUser();\n      if (!userData.user) throw new Error('Not authenticated');\n\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) {\n        throw new Error(\"Organization required\");\n      }\n\n      const activityData: Partial<ActivityRow> & {\n        user_id: string;\n        lead_id: string;\n        project_id: string;\n        type: ActivityRow[\"type\"];\n        content: string;\n        organization_id: string;\n        reminder_date: string | null;\n        reminder_time: string | null;\n      } = {\n        user_id: userData.user.id,\n        lead_id,\n        project_id: projectId,\n        type: isReminderMode ? \"reminder\" : \"note\",\n        content: content.trim(),\n        reminder_date:\n          isReminderMode && reminderDateTime ? reminderDateTime.split(\"T\")[0] : null,\n        reminder_time:\n          isReminderMode && reminderDateTime ? reminderDateTime.split(\"T\")[1] : null,\n        organization_id: organizationId,\n      };\n\n      const { error } = await supabase\n        .from('activities')\n        .insert(activityData)\n        .select('id')\n        .single();\n\n      if (error) throw error;\n\n      toast({\n        title: t(\"success.saved\"),\n        description: `${isReminderMode ? t(\"activity.reminder\") : t(\"activity.note\")} ${t(\"activity.added_to_project\")}.`\n      });\n\n      // Refresh data\n      await Promise.all([fetchProjectActivities(), fetchHistoryData()]);\n      onActivityUpdated?.();\n    } catch (error) {\n      toast({\n        title: t(\"error.generic\"),\n        description: getErrorMessage(error),\n        variant: \"destructive\",\n      });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const toggleCompletion = async (activityId: string, completed: boolean) => {\n    try {\n      const { error } = await supabase\n        .from('activities')\n        .update({ completed })\n        .eq('id', activityId);\n      if (error) throw error;\n      \n      setActivities(prev => prev.map(activity => \n        activity.id === activityId ? { ...activity, completed } : activity\n      ));\n      \n      toast({\n        title: completed ? t(\"activity.task_completed\") : t(\"activity.task_incomplete\"),\n        description: t(\"activity.task_status_updated\")\n      });\n\n      await fetchHistoryData();\n      onActivityUpdated?.();\n    } catch (error) {\n      toast({\n        title: t(\"activity.error_updating_task\"),\n        description: getErrorMessage(error),\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const formatAmount = (value?: number) => {\n    if (value === undefined || Number.isNaN(value)) {\n      return undefined;\n    }\n    return new Intl.NumberFormat(undefined, {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(value);\n  };\n\n  const toSentenceCase = (value?: string) => {\n    if (!value) return undefined;\n    return value\n      .replace(/_/g, \" \")\n      .replace(/\\b\\w/g, (char) => char.toUpperCase());\n  };\n\n  const getStatusName = (statusId?: string) => {\n    if (!statusId) return undefined;\n    return statusLookup[statusId] ?? statusId;\n  };\n\n  const getServiceName = (serviceId?: string) => {\n    if (!serviceId) return undefined;\n    return serviceLookup[serviceId] ?? serviceId;\n  };\n\n  const getHistoryDescription = (log: AuditLogEntry): string => {\n    const notSet = t(\"activitiesHistory.historyMessages.notSet\");\n\n    const formatChange = (\n      label: string,\n      oldValue?: string | null,\n      newValue?: string | null\n    ) => {\n      const safeOld =\n        oldValue && oldValue.length > 0 ? oldValue : notSet;\n      const safeNew =\n        newValue && newValue.length > 0 ? newValue : notSet;\n      return t(\"activitiesHistory.historyMessages.changeTemplate\", {\n        label,\n        oldValue: safeOld,\n        newValue: safeNew,\n      });\n    };\n\n    const joinChanges = (changes: string[]) => changes.join(\"; \");\n\n    const formatSessionTimeValue = (value?: string | null) => {\n      if (!value) return undefined;\n      const timePart = value.slice(0, 5);\n      try {\n        return formatTime(timePart);\n      } catch {\n        return value;\n      }\n    };\n\n    const formatSessionDateValue = (value?: string | null) =>\n      value ? formatLongDate(value) : undefined;\n\n    if (log.entity_type === \"project\") {\n      const name =\n        getStringValue(log.new_values, \"name\") ??\n        getStringValue(log.old_values, \"name\") ??\n        projectName ??\n        t(\"activitiesHistory.historyMessages.projectUnnamed\");\n\n      if (log.action === \"created\") {\n        return name\n          ? t(\"activitiesHistory.historyMessages.projectCreated\", { name })\n          : t(\"activitiesHistory.historyMessages.projectCreatedUnnamed\");\n      }\n      if (log.action === \"archived\") {\n        return name\n          ? t(\"activitiesHistory.historyMessages.projectArchived\", { name })\n          : t(\"activitiesHistory.historyMessages.projectArchivedUnnamed\");\n      }\n      if (log.action === \"restored\") {\n        return name\n          ? t(\"activitiesHistory.historyMessages.projectRestored\", { name })\n          : t(\"activitiesHistory.historyMessages.projectRestoredUnnamed\");\n      }\n      if (log.action === \"updated\") {\n        const changes: string[] = [];\n        const oldStatusId = getStringValue(log.old_values, \"status_id\");\n        const newStatusId = getStringValue(log.new_values, \"status_id\");\n\n        if (oldStatusId !== newStatusId) {\n          const oldStatus = getStatusName(oldStatusId) ?? notSet;\n          const newStatus = getStatusName(newStatusId) ?? notSet;\n          changes.push(\n            t(\"activitiesHistory.historyMessages.projectStageChanged\", {\n              oldStatus,\n              newStatus,\n            })\n          );\n        }\n\n        const oldName = getStringValue(log.old_values, \"name\");\n        const newName = getStringValue(log.new_values, \"name\");\n        if (oldName && newName && oldName !== newName) {\n          changes.push(\n            t(\"activitiesHistory.historyMessages.projectRenamed\", {\n              oldName,\n              newName,\n            })\n          );\n        }\n\n        const oldPrice = getNumberValue(log.old_values, \"base_price\");\n        const newPrice = getNumberValue(log.new_values, \"base_price\");\n        if (\n          oldPrice !== undefined &&\n          newPrice !== undefined &&\n          oldPrice !== newPrice\n        ) {\n          const formattedOld = formatAmount(oldPrice) ?? oldPrice.toString();\n          const formattedNew = formatAmount(newPrice) ?? newPrice.toString();\n          changes.push(\n            t(\"activitiesHistory.historyMessages.projectBasePriceChanged\", {\n              oldPrice: formattedOld,\n              newPrice: formattedNew,\n            })\n          );\n        }\n\n        const oldDescription = getStringValue(log.old_values, \"description\");\n        const newDescription = getStringValue(log.new_values, \"description\");\n        if (oldDescription !== newDescription) {\n          changes.push(\n            t(\"activitiesHistory.historyMessages.projectDescriptionUpdated\")\n          );\n        }\n\n        const oldProjectType = getStringValue(log.old_values, \"project_type_id\");\n        const newProjectType = getStringValue(log.new_values, \"project_type_id\");\n        if (oldProjectType !== newProjectType) {\n          changes.push(\n            t(\"activitiesHistory.historyMessages.projectTypeChanged\")\n          );\n        }\n\n        if (changes.length > 0) {\n          return t(\n            \"activitiesHistory.historyMessages.projectUpdatedWithChanges\",\n            {\n              changes: joinChanges(changes),\n            }\n          );\n        }\n        return t(\"activitiesHistory.historyMessages.projectUpdated\");\n      }\n    }\n\n    if (log.entity_type === \"session\") {\n      const sessionName =\n        getStringValue(log.new_values, \"session_name\") ??\n        getStringValue(log.old_values, \"session_name\") ??\n        t(\"activitiesHistory.historyMessages.sessionUntitled\");\n\n      if (log.action === \"created\") {\n        return t(\"activitiesHistory.historyMessages.sessionCreated\", {\n          name: sessionName,\n        });\n      }\n      if (log.action === \"deleted\") {\n        return t(\"activitiesHistory.historyMessages.sessionDeleted\", {\n          name: sessionName,\n        });\n      }\n      if (log.action === \"updated\") {\n        const sessionChanges: string[] = [];\n        const sessionFieldLabels: Record<string, string> = {\n          session_date: t(\n            \"activitiesHistory.historyMessages.sessionFieldLabels.session_date\"\n          ),\n          session_time: t(\n            \"activitiesHistory.historyMessages.sessionFieldLabels.session_time\"\n          ),\n          session_name: t(\n            \"activitiesHistory.historyMessages.sessionFieldLabels.session_name\"\n          ),\n          location: t(\n            \"activitiesHistory.historyMessages.sessionFieldLabels.location\"\n          ),\n          status: t(\n            \"activitiesHistory.historyMessages.sessionFieldLabels.status\"\n          ),\n          notes: t(\n            \"activitiesHistory.historyMessages.sessionFieldLabels.notes\"\n          ),\n        };\n\n        const oldDate = getStringValue(log.old_values, \"session_date\");\n        const newDate = getStringValue(log.new_values, \"session_date\");\n        if (oldDate !== newDate) {\n          sessionChanges.push(\n            formatChange(\n              sessionFieldLabels.session_date,\n              formatSessionDateValue(oldDate),\n              formatSessionDateValue(newDate)\n            )\n          );\n        }\n\n        const oldTime = getStringValue(log.old_values, \"session_time\");\n        const newTime = getStringValue(log.new_values, \"session_time\");\n        if (oldTime !== newTime) {\n          sessionChanges.push(\n            formatChange(\n              sessionFieldLabels.session_time,\n              formatSessionTimeValue(oldTime),\n              formatSessionTimeValue(newTime)\n            )\n          );\n        }\n\n        const oldLocation = getStringValue(log.old_values, \"location\");\n        const newLocation = getStringValue(log.new_values, \"location\");\n        if (oldLocation !== newLocation) {\n          sessionChanges.push(\n            formatChange(\n              sessionFieldLabels.location,\n              oldLocation,\n              newLocation\n            )\n          );\n        }\n\n        const oldStatus = getStringValue(log.old_values, \"status\");\n        const newStatus = getStringValue(log.new_values, \"status\");\n        if (oldStatus !== newStatus) {\n          sessionChanges.push(\n            formatChange(\n              sessionFieldLabels.status,\n              toSentenceCase(oldStatus),\n              toSentenceCase(newStatus)\n            )\n          );\n        }\n\n        const oldSessionName = getStringValue(log.old_values, \"session_name\");\n        const newSessionName = getStringValue(log.new_values, \"session_name\");\n        if (oldSessionName && newSessionName && oldSessionName !== newSessionName) {\n          sessionChanges.push(\n            formatChange(\n              sessionFieldLabels.session_name,\n              oldSessionName,\n              newSessionName\n            )\n          );\n        }\n\n        const oldNotes = getStringValue(log.old_values, \"notes\");\n        const newNotes = getStringValue(log.new_values, \"notes\");\n        if (oldNotes !== newNotes) {\n          sessionChanges.push(\n            t(\"activitiesHistory.historyMessages.sessionNotesUpdated\")\n          );\n        }\n\n        if (sessionChanges.length > 0) {\n          return t(\"activitiesHistory.historyMessages.sessionUpdated\", {\n            name: sessionName,\n            changes: joinChanges(sessionChanges),\n          });\n        }\n        return t(\"activitiesHistory.historyMessages.sessionUpdatedSimple\", {\n          name: sessionName,\n        });\n      }\n    }\n\n    if (log.entity_type === \"payment\") {\n      const amount =\n        getNumberValue(log.new_values, \"amount\") ??\n        getNumberValue(log.old_values, \"amount\");\n      const status =\n        getStringValue(log.new_values, \"status\") ??\n        getStringValue(log.old_values, \"status\");\n      const description =\n        getStringValue(log.new_values, \"description\") ??\n        getStringValue(log.old_values, \"description\");\n\n      const amountText =\n        amount !== undefined\n          ? formatAmount(amount) ?? `${amount}`\n          : t(\"activitiesHistory.historyMessages.paymentUnknownAmount\");\n\n      const statusSuffix = status\n        ? t(\"activitiesHistory.historyMessages.paymentStatusSuffix\", {\n            status: toSentenceCase(status) ?? status,\n          })\n        : \"\";\n\n      const detailsSuffix = description\n        ? t(\"activitiesHistory.historyMessages.paymentDetailsSuffix\", {\n            details: description,\n          })\n        : \"\";\n\n      if (log.action === \"created\") {\n        return t(\"activitiesHistory.historyMessages.paymentRecorded\", {\n          amount: amountText,\n          detailsSuffix,\n        });\n      }\n      if (log.action === \"updated\") {\n        return t(\"activitiesHistory.historyMessages.paymentUpdated\", {\n          amount: amountText,\n          statusSuffix,\n          detailsSuffix,\n        });\n      }\n      if (log.action === \"deleted\") {\n        return t(\"activitiesHistory.historyMessages.paymentRemoved\", {\n          amount: amountText,\n          detailsSuffix,\n        });\n      }\n    }\n\n    if (log.entity_type === \"todo\") {\n      const content =\n        getStringValue(log.new_values, \"content\") ??\n        getStringValue(log.old_values, \"content\") ??\n        t(\"activitiesHistory.historyMessages.todoUnnamed\");\n\n      if (log.action === \"created\") {\n        return t(\"activitiesHistory.historyMessages.todoAdded\", { content });\n      }\n      if (log.action === \"deleted\") {\n        return t(\"activitiesHistory.historyMessages.todoRemoved\", { content });\n      }\n      if (log.action === \"updated\") {\n        const oldCompleted = getBooleanValue(log.old_values, \"is_completed\");\n        const newCompleted = getBooleanValue(log.new_values, \"is_completed\");\n        if (\n          oldCompleted !== undefined &&\n          newCompleted !== undefined &&\n          oldCompleted !== newCompleted\n        ) {\n          return t(\"activitiesHistory.historyMessages.todoToggled\", {\n            content,\n            state: t(\n              newCompleted\n                ? \"activitiesHistory.historyMessages.todoStateCompleted\"\n                : \"activitiesHistory.historyMessages.todoStateIncomplete\"\n            ),\n          });\n        }\n\n        const oldTodoContent = getStringValue(log.old_values, \"content\");\n        const newTodoContent = getStringValue(log.new_values, \"content\");\n        if (\n          oldTodoContent &&\n          newTodoContent &&\n          oldTodoContent !== newTodoContent\n        ) {\n          return t(\"activitiesHistory.historyMessages.todoContentUpdated\", {\n            oldContent: oldTodoContent,\n            newContent: newTodoContent,\n          });\n        }\n\n        return t(\"activitiesHistory.historyMessages.todoUpdated\", { content });\n      }\n    }\n\n    if (log.entity_type === \"activity\") {\n      const activityType =\n        getStringValue(log.new_values, \"type\") ??\n        getStringValue(log.old_values, \"type\") ??\n        \"activity\";\n      const defaultLabel =\n        toSentenceCase(activityType) ??\n        t(\"activitiesHistory.historyMessages.activityLabels.activity\");\n      const label = t(\n        `activitiesHistory.historyMessages.activityLabels.${activityType}`,\n        { defaultValue: defaultLabel }\n      );\n      const content =\n        getStringValue(log.new_values, \"content\") ??\n        getStringValue(log.old_values, \"content\") ??\n        \"\";\n      const contentSuffix = content\n        ? t(\"activitiesHistory.historyMessages.activityContentSuffix\", {\n            content,\n          })\n        : \"\";\n\n      if (log.action === \"created\") {\n        return t(\"activitiesHistory.historyMessages.activityAdded\", {\n          label,\n          content: contentSuffix,\n        });\n      }\n      if (log.action === \"updated\") {\n        return t(\"activitiesHistory.historyMessages.activityUpdated\", {\n          label,\n          content: contentSuffix,\n        });\n      }\n      if (log.action === \"deleted\") {\n        return t(\"activitiesHistory.historyMessages.activityRemoved\", {\n          label,\n          content: contentSuffix,\n        });\n      }\n    }\n\n    if (\n      log.entity_type === \"project_service\" ||\n      log.entity_type === \"project_package\"\n    ) {\n      const identifier =\n        getStringValue(log.new_values, \"service_id\") ??\n        getStringValue(log.new_values, \"package_id\") ??\n        getStringValue(log.old_values, \"service_id\") ??\n        getStringValue(log.old_values, \"package_id\");\n      const label =\n        getServiceName(identifier) ??\n        t(\"activitiesHistory.historyMessages.serviceFallbackLabel\");\n\n      if (log.action === \"created\") {\n        return t(\"activitiesHistory.historyMessages.serviceAdded\", { label });\n      }\n      if (log.action === \"updated\") {\n        return t(\"activitiesHistory.historyMessages.serviceUpdated\", { label });\n      }\n      if (log.action === \"deleted\") {\n        return t(\"activitiesHistory.historyMessages.serviceRemoved\", { label });\n      }\n    }\n\n    return t(\"activitiesHistory.historyMessages.genericChange\", {\n      entity: toSentenceCase(log.entity_type) ?? log.entity_type,\n      action: log.action,\n    });\n  };\n\n  if (loading) {\n    return (\n      <Card>\n        <CardHeader>\n          <Skeleton className=\"h-6 w-48\" />\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <Skeleton className=\"h-24 w-full\" />\n          <Skeleton className=\"h-12 w-full\" />\n          <Skeleton className=\"h-12 w-full\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"text-lg font-semibold\">\n            {t(\"activitiesHistory.title\")}\n          </h3>\n          <SegmentedControl\n            size=\"sm\"\n            value={selectedSegment}\n            onValueChange={(value) =>\n              setSelectedSegment(value as typeof selectedSegment)\n            }\n            options={[\n              { value: \"activity\", label: t(\"activitiesHistory.activity\") },\n              { value: \"history\", label: t(\"activitiesHistory.history\") },\n            ]}\n          />\n        </div>\n      </CardHeader>\n      <CardContent>\n        {selectedSegment === \"activity\" ? (\n          <div className=\"space-y-6\">\n            <ActivityForm\n              onSubmit={handleSaveActivity}\n              loading={saving}\n              placeholder={t(\"projectDetails.activities.placeholder\")}\n            />\n\n            <div className=\"space-y-4\">\n              {activities.length > 0 ? (\n                <ActivityTimeline\n                  activities={activities}\n                  leadName={leadName}\n                  onToggleCompletion={toggleCompletion}\n                />\n              ) : (\n                <div className=\"text-sm text-muted-foreground text-center py-8\">\n                  {t(\"activitiesHistory.noActivitiesYet\")}\n                </div>\n              )}\n            </div>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {auditLogs.length > 0 ? (\n              <div className=\"space-y-1\">\n                {auditLogs.map((log) => (\n                  <div\n                    key={log.id}\n                    className=\"flex justify-between items-start p-2 text-sm hover:bg-muted/30 rounded\"\n                  >\n                    <p className=\"text-foreground break-words flex-1\">\n                      {getHistoryDescription(log)}\n                    </p>\n                    <div className=\"text-xs text-muted-foreground whitespace-nowrap ml-4\">\n                      {formatLongDate(log.created_at)}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-sm text-muted-foreground text-center py-8\">\n                {t(\"activitiesHistory.noHistoryAvailable\")}\n              </div>\n            )}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProjectCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProjectDepositDialogs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProjectKanbanBoard.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchStatuses'. Either include it or remove the dependency array.","line":120,"column":6,"nodeType":"ArrayExpression","endLine":120,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [fetchStatuses, projectStatuses]","fix":{"range":[4550,4567],"text":"[fetchStatuses, projectStatuses]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":155,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5824,5827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5824,5827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\n// Import namespace form to avoid ESM/CJS interop edge cases that can surface as\n// \"Component is not a function\" inside DragDropContext's ErrorBoundary.\nimport * as DnD from \"@hello-pangea/dnd\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Loader2, Plus } from \"lucide-react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useI18nToast } from \"@/lib/toastHelpers\";\nimport { ViewProjectDialog } from \"@/components/ViewProjectDialog\";\nimport { ProfessionalKanbanCard } from \"@/components/ProfessionalKanbanCard\";\nimport { KanbanLoadingSkeleton } from \"@/components/ui/loading-presets\";\nimport { useNotificationTriggers } from \"@/hooks/useNotificationTriggers\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\nimport { useKanbanSettings } from \"@/hooks/useKanbanSettings\";\nimport { useTranslation } from 'react-i18next';\nimport { LIFECYCLE_STATES, PROJECT_STATUS } from \"@/constants/entityConstants\";\nimport type { ProjectListItem, ProjectStatusSummary } from \"@/pages/projects/types\";\nimport { ProjectCreationWizardSheet } from \"@/features/project-creation\";\nimport { cn } from \"@/lib/utils\";\nimport { promoteProjectToTop, PROJECT_SORT_GAP } from \"@/lib/projects/sortOrder\";\n\ninterface ProjectKanbanBoardProps {\n  projects: ProjectListItem[];\n  projectStatuses?: ProjectStatusSummary[];\n  onProjectsChange: () => void;\n  onProjectUpdate?: (project: ProjectListItem) => void;\n  onQuickView?: (project: ProjectListItem) => void;\n  isLoading?: boolean;\n  onLoadMore?: () => void;\n  hasMore?: boolean;\n  isLoadingMore?: boolean;\n}\n\nconst GAP = PROJECT_SORT_GAP;\n\nconst orderProjects = (list: ProjectListItem[]) =>\n  [...list].sort((a, b) => {\n    const ao = a.sort_order ?? Number.MAX_SAFE_INTEGER;\n    const bo = b.sort_order ?? Number.MAX_SAFE_INTEGER;\n    if (ao !== bo) return ao - bo;\n    const ad = a.created_at ? new Date(a.created_at).getTime() : 0;\n    const bd = b.created_at ? new Date(b.created_at).getTime() : 0;\n    return ad - bd;\n  });\n\nfunction computeSortForInsert(\n  withMoving: ProjectListItem[],\n  index: number\n): { value: number | null; needReindex: boolean } {\n  const prev = index > 0 ? withMoving[index - 1] : undefined;\n  const next = index < withMoving.length - 1 ? withMoving[index + 1] : undefined;\n\n  if (!prev && !next) return { value: GAP, needReindex: false };\n  if (!prev && next) {\n    const nextOrder = next.sort_order ?? GAP;\n    return { value: nextOrder - GAP, needReindex: false };\n  }\n  if (prev && !next) {\n    const prevOrder = prev.sort_order ?? 0;\n    return { value: prevOrder + GAP, needReindex: false };\n  }\n\n  const prevOrder = prev?.sort_order ?? 0;\n  const nextOrder = next?.sort_order ?? prevOrder + 2;\n\n  if (nextOrder - prevOrder >= 2) {\n    return { value: Math.floor((prevOrder + nextOrder) / 2), needReindex: false };\n  }\n  return { value: null, needReindex: true };\n}\n\nasync function reindexColumn(\n  statusId: string | null,\n  ordered: Array<Pick<ProjectListItem, \"id\">>\n) {\n  await Promise.all(\n    ordered.map((p, i) =>\n      supabase\n        .from(\"projects\")\n        .update({ status_id: statusId, sort_order: (i + 1) * GAP })\n        .eq(\"id\", p.id)\n    )\n  );\n}\n\nconst ProjectKanbanBoard = ({\n  projects,\n  projectStatuses,\n  onProjectsChange,\n  onProjectUpdate,\n  onQuickView,\n  isLoading,\n  onLoadMore,\n  hasMore = false,\n  isLoadingMore = false,\n}: ProjectKanbanBoardProps) => {\n  const { t } = useTranslation('forms');\n  const toast = useI18nToast();\n  const [statuses, setStatuses] = useState<ProjectStatusSummary[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedStatusId, setSelectedStatusId] = useState<string | null>(null);\n  const [viewingProject, setViewingProject] = useState<ProjectListItem | null>(null);\n  const [showViewDialog, setShowViewDialog] = useState(false);\n  const [isProjectWizardOpen, setProjectWizardOpen] = useState(false);\n\n  const { triggerProjectMilestone } = useNotificationTriggers();\n  const { activeOrganization } = useOrganization();\n  const { settings: kanbanSettings } = useKanbanSettings();\n\n  useEffect(() => {\n    // Only self-fetch if no statuses were provided at all\n    if (typeof projectStatuses === 'undefined') {\n      fetchStatuses();\n      return;\n    }\n    // When provided (even empty initially), use them and avoid duplicate fetches\n    setStatuses((projectStatuses || []).filter(s => s.name?.toLowerCase?.() !== PROJECT_STATUS.ARCHIVED));\n    setLoading(false);\n  }, [projectStatuses]);\n\n  const fetchStatuses = async () => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n\n      // Use shared org util instead of RPC to avoid flaky errors\n      const { getUserOrganizationId } = await import('@/lib/organizationUtils');\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) return;\n\n      const { data, error } = await supabase\n        .from(\"project_statuses\")\n        .select(\"*\")\n        .eq(\"organization_id\", organizationId)\n        .order(\"sort_order\", { ascending: true });\n\n      if (error) throw error;\n      setStatuses(((data || []) as ProjectStatusSummary[]).filter(s => s.name?.toLowerCase?.() !== PROJECT_STATUS.ARCHIVED));\n    } catch (error) {\n      console.error(\"Error fetching project statuses:\", error);\n      // Avoid noisy toasts when board is not visible\n      toast.error(t('forms:projects.toasts.statuses_load_failed'));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getProjectsByStatus = (statusId: string) =>\n    orderProjects(projects.filter(p => p.status_id === statusId));\n\n  const getProjectsWithoutStatus = () =>\n    orderProjects(projects.filter(p => !p.status_id));\n\n  const handleDragEnd = async (result: any) => {\n    const { destination, source, draggableId } = result;\n    if (!destination) return;\n    if (destination.droppableId === source.droppableId && destination.index === source.index) return;\n\n    const projectId = draggableId;\n    const srcStatusId = source.droppableId === \"no-status\" ? null : source.droppableId;\n    const dstStatusId = destination.droppableId === \"no-status\" ? null : destination.droppableId;\n\n    const moving = projects.find(p => p.id === projectId);\n    if (!moving) return;\n\n    const organizationId = activeOrganization?.id ?? null;\n    const shouldForceRefresh = !onProjectUpdate;\n\n    const dstBase = orderProjects(projects.filter(p => p.status_id === dstStatusId && p.id !== moving.id));\n    const insertIndex = Math.min(Math.max(destination.index, 0), dstBase.length);\n\n    const dstWithMoving: ProjectListItem[] = [...dstBase];\n    const projectForInsertion: ProjectListItem = { ...moving, status_id: dstStatusId };\n    dstWithMoving.splice(insertIndex, 0, projectForInsertion);\n\n    const { value, needReindex } = computeSortForInsert(dstWithMoving, insertIndex);\n    const requiresReindex = needReindex || value === null;\n\n    const srcAfterMove =\n      srcStatusId !== dstStatusId\n        ? orderProjects(projects.filter(p => p.status_id === srcStatusId && p.id !== moving.id))\n        : [];\n\n    if (onProjectUpdate) {\n      if (!requiresReindex && value !== null) {\n        onProjectUpdate({\n          ...moving,\n          status_id: dstStatusId,\n          sort_order: value,\n        });\n      } else {\n        const updatedDest = dstWithMoving.map((project, idx) => ({\n          ...project,\n          status_id: dstStatusId,\n          sort_order: (idx + 1) * GAP,\n        }));\n        updatedDest.forEach(project => onProjectUpdate(project));\n\n        if (srcStatusId !== dstStatusId && srcAfterMove.length > 0) {\n          const updatedSrc = srcAfterMove.map((project, idx) => ({\n            ...project,\n            status_id: srcStatusId,\n            sort_order: (idx + 1) * GAP,\n          }));\n          updatedSrc.forEach(project => onProjectUpdate(project));\n        }\n      }\n    }\n\n    // Show immediate feedback\n    if (srcStatusId !== dstStatusId) {\n      const oldStatus = statuses.find(s => s.id === moving.status_id);\n      const newStatus = statuses.find(s => s.id === (dstStatusId || \"\"));\n      toast.success(t('forms:projects.toasts.moved_to', { status: newStatus?.name || t('pages:projects.noStatus') }));\n    } else {\n      toast.success(t('forms:projects.toasts.position_updated'));\n    }\n\n    // BACKGROUND OPERATIONS: Handle all database operations async\n    (async () => {\n      try {\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) throw new Error(t('forms:user_not_authenticated'));\n\n        // Update project position in database\n        if (!requiresReindex && value !== null) {\n          const { error } = await supabase\n            .from(\"projects\")\n            .update({ status_id: dstStatusId, sort_order: value })\n            .eq(\"id\", projectId);\n          if (error) throw error;\n        } else {\n          await reindexColumn(dstStatusId, dstWithMoving);\n          if (srcStatusId !== dstStatusId) {\n            await reindexColumn(srcStatusId, srcAfterMove);\n          }\n        }\n\n        // Handle status change activities and notifications\n        if (srcStatusId !== dstStatusId) {\n          const oldStatus = statuses.find(s => s.id === moving.status_id);\n          const newStatus = statuses.find(s => s.id === (dstStatusId || \"\"));\n          \n          // Insert activity log\n          const activityPromise = organizationId\n            ? supabase.from(\"activities\").insert({\n                type: \"status_change\",\n                content: `Status changed from '${oldStatus?.name || \"No Status\"}' to '${newStatus?.name || \"No Status\"}'`,\n                project_id: projectId,\n                lead_id: moving.lead_id,\n                user_id: user.id,\n                organization_id: organizationId,\n              })\n            : Promise.resolve();\n\n          // TEMPORARILY SKIP milestone notifications for completed/cancelled to test performance\n          const shouldSkipNotification =\n            newStatus?.lifecycle === LIFECYCLE_STATES.COMPLETED || newStatus?.lifecycle === LIFECYCLE_STATES.CANCELLED;\n          \n          const notificationPromise =\n            !shouldSkipNotification && organizationId && triggerProjectMilestone \n            ? triggerProjectMilestone(\n                projectId,\n                srcStatusId || \"\",\n                dstStatusId || \"\",\n                organizationId\n              ).catch(error => console.error(\"Failed to trigger milestone notification:\", error))\n            : Promise.resolve();\n\n          if (shouldSkipNotification) {\n            // Milestone notification triggered for status change\n          }\n\n          // Wait for both operations in parallel\n          await Promise.all([activityPromise, notificationPromise]);\n        }\n\n        // Background database operations completed; fall back to full refresh only when local state wasn't updated\n        if (shouldForceRefresh && onProjectsChange) {\n          onProjectsChange();\n        }\n      } catch (error) {\n        console.error(\"Error in background database operations:\", error);\n        // Sync with server to reflect actual state\n        if (onProjectsChange) {\n          onProjectsChange();\n        }\n        toast.error(t('forms:projects.toasts.move_sync_failed'));\n      }\n    })();\n  };\n\n  const handleAddProject = (statusId: string | null) => {\n    setSelectedStatusId(statusId);\n    setProjectWizardOpen(true);\n  };\n\n  const handleProjectClick = (project: ProjectListItem) => {\n    if (onQuickView) onQuickView(project);\n    else {\n      setViewingProject(project);\n      setShowViewDialog(true);\n    }\n  };\n\n  const renderProjectCard = (project: ProjectListItem, index: number) => (\n    <DnD.Draggable key={project.id} draggableId={project.id} index={index}>\n      {(provided) => (\n        <div\n          ref={provided.innerRef}\n          {...provided.draggableProps}\n          {...provided.dragHandleProps}\n          className=\"mb-2 last:mb-0\"\n        >\n          <ProfessionalKanbanCard\n            project={project}\n            kanbanSettings={kanbanSettings}\n            onClick={() => handleProjectClick(project)}\n          />\n        </div>\n      )}\n    </DnD.Draggable>\n  );\n\n  const renderColumn = (status: ProjectStatusSummary | null, columnProjects: ProjectListItem[]) => {\n    const statusId = status?.id || \"no-status\";\n    const statusName = status?.name || t('pages:projects.noStatus');\n    const statusColor = status?.color || \"#6B7280\";\n\n    const ordered = orderProjects(columnProjects);\n\n    return (\n      <div\n        key={statusId}\n        className=\"flex w-72 flex-shrink-0 flex-col rounded-2xl border border-border/40 bg-muted/30\"\n      >\n        <div className=\"flex items-center justify-between gap-1.5 px-2.5 pt-3 pb-2\">\n          <div className=\"flex items-center gap-1.5\">\n            <button\n              className=\"inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-full text-sm font-medium transition-all hover:opacity-80\"\n              style={{\n                backgroundColor: statusColor + \"20\",\n                color: statusColor,\n                border: `1px solid ${statusColor}40`\n              }}\n            >\n              <div className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: statusColor }} />\n              <span className=\"uppercase tracking-wide font-semibold\">{statusName}</span>\n            </button>\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              {ordered.length}\n            </Badge>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => handleAddProject(status?.id || null)}\n            className=\"h-6 w-6 text-muted-foreground hover:text-foreground\"\n          >\n            <Plus className=\"h-4 w-4\" />\n          </Button>\n        </div>\n\n        <DnD.Droppable droppableId={statusId}>\n          {(provided, snapshot) => (\n            <div\n              ref={provided.innerRef}\n              {...provided.droppableProps}\n              className={cn(\n                \"relative flex flex-col gap-2.5 px-2.5 pb-3 pt-1\",\n                snapshot.isDraggingOver && \"bg-accent/10\"\n              )}\n            >\n              <div className=\"flex flex-col\">\n                {ordered.map((project, index) => renderProjectCard(project, index))}\n              </div>\n\n              <div>\n                {ordered.length === 0 ? (\n                  <div className=\"flex flex-col items-center justify-center gap-2.5 rounded-xl border-2 border-dashed border-muted-foreground/30 bg-background/60 px-3 py-7 text-center\">\n                    <Button\n                      variant=\"outline\"\n                      onClick={() => handleAddProject(status?.id || null)}\n                      className=\"flex items-center gap-1.5 border-dashed\"\n                    >\n                      <Plus className=\"h-4 w-4\" />\n                      {t('common:buttons.add_project')}\n                    </Button>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {t('forms:projects.drop_here')}\n                    </p>\n                  </div>\n                ) : (\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => handleAddProject(status?.id || null)}\n                    className=\"w-full flex items-center gap-1.5 border-dashed\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                    {t('common:buttons.add_project')}\n                  </Button>\n                )}\n              </div>\n\n              <div className=\"flex-1 min-h-10\" />\n              {provided.placeholder}\n\n              {snapshot.isDraggingOver && (\n                <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center rounded-2xl border-2 border-accent/40\">\n                  <span className=\"text-sm font-medium text-accent\">\n                    {t('forms:projects.drop_here')}\n                  </span>\n                </div>\n              )}\n            </div>\n          )}\n        </DnD.Droppable>\n      </div>\n    );\n  };\n\n  if (loading || isLoading) return <KanbanLoadingSkeleton />;\n\n  const showLoadMore = Boolean(hasMore && onLoadMore);\n  const loadMoreLabel = t('common:buttons.load_more', { defaultValue: 'Load more' });\n\n  return (\n    <>\n      <div\n        className=\"w-full max-w-full overflow-x-auto\"\n        style={{ WebkitOverflowScrolling: \"touch\", scrollbarWidth: \"thin\", touchAction: \"pan-x pan-y\" }}\n      >\n        <div className=\"px-3 py-3 sm:px-5 sm:py-4\">\n          <DnD.DragDropContext onDragEnd={handleDragEnd}>\n            <div className=\"flex items-start gap-2.5 sm:gap-3 pb-3\" style={{ width: \"max-content\", minWidth: \"100%\" }}>\n              {statuses.map(status => renderColumn(status, getProjectsByStatus(status.id)))}\n              {getProjectsWithoutStatus().length > 0 && renderColumn(null, getProjectsWithoutStatus())}\n            </div>\n          </DnD.DragDropContext>\n        </div>\n      </div>\n\n      <ProjectCreationWizardSheet\n        isOpen={isProjectWizardOpen}\n        onOpenChange={(open) => {\n          setProjectWizardOpen(open);\n          if (!open) {\n            setSelectedStatusId(null);\n          }\n        }}\n        defaultStatusId={selectedStatusId}\n        entrySource=\"kanban\"\n        onProjectCreated={async (createdProject) => {\n          if (createdProject?.id) {\n            await promoteProjectToTop(createdProject.id);\n          }\n          onProjectsChange();\n          setSelectedStatusId(null);\n        }}\n      />\n\n      <ViewProjectDialog\n        project={viewingProject}\n        open={showViewDialog}\n        onOpenChange={setShowViewDialog}\n        onProjectUpdated={onProjectsChange}\n        onActivityUpdated={() => {}}\n        leadName={viewingProject?.lead?.name || \"\"}\n      />\n      {showLoadMore ? (\n        <div className=\"px-4 pb-6 flex justify-center\">\n          <Button\n            variant=\"outline\"\n            onClick={onLoadMore}\n            disabled={isLoadingMore}\n            className=\"gap-2\"\n          >\n            {isLoadingMore && <Loader2 className=\"h-4 w-4 animate-spin\" />}\n            {loadMoreLabel}\n          </Button>\n        </div>\n      ) : null}\n    </>\n  );\n};\n\nexport default ProjectKanbanBoard;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProjectPaymentsSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProjectServicesSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1970,1973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1970,1973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2915,2918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2915,2918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchProjectServices'. Either include it or remove the dependency array.","line":96,"column":6,"nodeType":"ArrayExpression","endLine":96,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [fetchProjectServices, projectId]","fix":{"range":[3197,3208],"text":"[fetchProjectServices, projectId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":141,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4715,4718],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4715,4718],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Card, CardHeader, CardTitle, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Edit2, Save, X, Plus } from \"lucide-react\";\nimport { useI18nToast } from \"@/lib/toastHelpers\";\nimport { ServicePicker, type PickerService } from \"./ServicePicker\";\nimport { useFormsTranslation } from '@/hooks/useTypedTranslation';\ninterface Service {\n  id: string;\n  name: string;\n  category: string | null;\n  cost_price?: number;\n  selling_price?: number;\n  price?: number;\n}\ninterface ProjectServicesSectionProps {\n  projectId: string;\n  onServicesUpdated?: () => void;\n}\nexport function ProjectServicesSection({\n  projectId,\n  onServicesUpdated\n}: ProjectServicesSectionProps) {\n  const [services, setServices] = useState<Service[]>([]);\n  const [isEditing, setIsEditing] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [availableServices, setAvailableServices] = useState<Service[]>([]);\n  const [loadingAvailable, setLoadingAvailable] = useState(true);\n  const [errorAvailable, setErrorAvailable] = useState<string | null>(null);\n  const toast = useI18nToast();\n  const { t } = useFormsTranslation();\n  const sectionRef = useRef<HTMLDivElement>(null);\n  const fetchProjectServices = async () => {\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('project_services').select(`\n          services!inner (\n            id,\n            name,\n            category,\n            cost_price,\n            selling_price,\n            price\n          )\n        `).eq('project_id', projectId);\n      if (error) throw error;\n      const fetchedServices = data?.map(ps => ps.services).filter(Boolean) as Service[] || [];\n      setServices(fetchedServices);\n    } catch (error: any) {\n      console.error('Error fetching project services:', error);\n      toast.error(error.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n  const fetchAvailableServices = async () => {\n    setLoadingAvailable(true);\n    setErrorAvailable(null);\n    try {\n      const {\n        data: {\n          user\n        }\n      } = await supabase.auth.getUser();\n      if (!user) return;\n\n      // Get user's active organization ID\n      const { data: organizationId } = await supabase.rpc('get_user_active_organization_id');\n      if (!organizationId) return;\n\n      const {\n        data,\n        error\n      } = await supabase.from(\"services\").select(\"id, name, category, cost_price, selling_price, price\").eq(\"organization_id\", organizationId).order(\"category\", {\n        ascending: true\n      }).order(\"name\", {\n        ascending: true\n      });\n      if (error) throw error;\n      setAvailableServices(data || []);\n    } catch (err: any) {\n      console.error(\"Error fetching available services:\", err);\n      setErrorAvailable(err.message || \"Failed to load services\");\n    } finally {\n      setLoadingAvailable(false);\n    }\n  };\n  useEffect(() => {\n    fetchProjectServices();\n    fetchAvailableServices();\n  }, [projectId]);\n  const handleServicePickerChange = (serviceIds: string[]) => {\n    const selectedServices = availableServices.filter(service => serviceIds.includes(service.id));\n    setServices(selectedServices);\n  };\n  const handleSaveServices = async (selectedServices: Service[]) => {\n    setSaving(true);\n    try {\n      const {\n        data: {\n          user\n        }\n      } = await supabase.auth.getUser();\n      if (!user) throw new Error('User not authenticated');\n\n      // First, delete existing project services\n      const {\n        error: deleteError\n      } = await supabase.from('project_services').delete().eq('project_id', projectId);\n      if (deleteError) throw deleteError;\n\n      // Then, insert new project services\n      if (selectedServices.length > 0) {\n        const serviceInserts = selectedServices.map(service => ({\n          project_id: projectId,\n          service_id: service.id,\n          user_id: user.id\n        }));\n        const {\n          error: insertError\n        } = await supabase.from('project_services').insert(serviceInserts);\n        if (insertError) throw insertError;\n      }\n      setServices(selectedServices);\n      setIsEditing(false);\n      onServicesUpdated?.();\n\n      // Smoothly scroll back to the top of Services section after saving\n      setTimeout(() => {\n        sectionRef.current?.scrollIntoView({\n          behavior: 'smooth',\n          block: 'start'\n        });\n      }, 50);\n      toast.success(t('services.services_updated'));\n    } catch (error: any) {\n      toast.error(error.message);\n    } finally {\n      setSaving(false);\n    }\n  };\n  if (loading) {\n    return <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center justify-between text-lg font-medium\">\n            <div className=\"flex items-center gap-2\">\n              <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z\" />\n              </svg>\n              {t('services.title')}\n            </div>\n            <div className=\"w-6 h-6 bg-muted animate-pulse rounded\" />\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-2\">\n            <div className=\"w-full h-4 bg-muted animate-pulse rounded\" />\n            <div className=\"w-3/4 h-4 bg-muted animate-pulse rounded\" />\n          </div>\n        </CardContent>\n      </Card>;\n  }\n  return <div ref={sectionRef}>\n      <Card>\n        <CardHeader>\n        <CardTitle className=\"flex items-center justify-between text-xl font-semibold\">\n          <div className=\"flex items-center gap-2\">\n            <svg className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z\" />\n            </svg>\n            {t('services.title')}\n          </div>\n          {!isEditing && (services.length === 0 ? <Button size=\"sm\" onClick={() => setIsEditing(true)} className=\"gap-2\">\n                <Plus className=\"h-4 w-4\" />\n                {t('services.add')}\n              </Button> : <Button size=\"sm\" onClick={() => setIsEditing(true)} className=\"gap-2\">\n                <Edit2 className=\"h-4 w-4\" />\n                {t('services.edit')}\n              </Button>)}\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        {isEditing ? <div className=\"space-y-4\">\n            <ServicePicker services={availableServices.map(s => ({\n            ...s,\n            cost_price: s.cost_price,\n            selling_price: s.selling_price,\n            price: s.price,\n            active: true\n          }))} value={services.map(s => s.id)} onChange={handleServicePickerChange} disabled={saving} isLoading={loadingAvailable} error={errorAvailable} onRetry={fetchAvailableServices} />\n            \n            {/* Selected services display in edit mode */}\n            {services.length > 0 && (\n              <div className=\"rounded-md border p-3\">\n                <div className=\"mb-2 flex items-center justify-between\">\n                  <span className=\"text-sm font-medium\">{t('services.selected_services')} ({services.length})</span>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setServices([])}\n                    disabled={saving}\n                    className=\"h-8\"\n                  >\n                    {t('buttons.clearAll')}\n                  </Button>\n                </div>\n                <div className=\"flex flex-wrap gap-2\">\n                  {services.map((service) => {\n                    const costPrice = service.cost_price ?? 0;\n                    const sellingPrice = service.selling_price ?? service.price ?? 0;\n                    const hasPrices = costPrice > 0 || sellingPrice > 0;\n                    return (\n                      <Badge\n                        key={service.id}\n                        variant=\"secondary\"\n                        className=\"h-7 rounded-full px-3 text-xs\"\n                      >\n                        <span>\n                          {service.name}\n                          {hasPrices && (\n                            <>\n                              <span className=\"mx-1\">Â·</span>\n                              <span className=\"text-foreground/70\">â‚º{costPrice}/â‚º{sellingPrice}</span>\n                            </>\n                          )}\n                        </span>\n                        <button\n                          className=\"ml-2 inline-flex rounded-full p-0.5 hover:text-foreground\"\n                          onClick={(e) => {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            const newServices = services.filter(s => s.id !== service.id);\n                            setServices(newServices);\n                          }}\n                          aria-label={`Remove ${service.name}`}\n                        >\n                          <X className=\"h-3.5 w-3.5\" />\n                        </button>\n                      </Badge>\n                    );\n                  })}\n                </div>\n              </div>\n            )}\n\n            <div className=\"flex gap-2\">\n              <Button size=\"sm\" onClick={() => handleSaveServices(services)} disabled={saving}>\n                <Save className=\"h-4 w-4 mr-1\" />\n                {saving ? t('common:actions.saving') : t('common:buttons.save')}\n              </Button>\n              <Button size=\"sm\" variant=\"outline\" onClick={() => {\n              setIsEditing(false);\n              fetchProjectServices(); // Reset to original services\n            }} disabled={saving}>\n                <X className=\"h-4 w-4 mr-1\" />\n                {t('common:buttons.cancel')}\n              </Button>\n            </div>\n          </div> : <div>\n            {services.length > 0 ? <div className=\"flex flex-wrap gap-2\">\n                {services.map(service => {\n              // Service data rendered\n              const costPrice = service.cost_price ?? 0;\n              const sellingPrice = service.selling_price ?? service.price ?? 0;\n              const hasPrices = costPrice > 0 || sellingPrice > 0;\n              // Price information processed\n              return <Badge \n                      key={service.id} \n                      variant=\"secondary\" \n                      className=\"h-auto min-h-7 rounded-lg px-3 py-1.5 text-xs whitespace-normal break-words max-w-full\"\n                      title={`${service.name}${hasPrices ? ` - Cost: â‚º${costPrice}, Selling: â‚º${sellingPrice}` : ''}`}\n                    >\n                       <div className=\"flex flex-col gap-0.5 w-full\">\n                         <span className=\"font-medium leading-tight\">{service.name}</span>\n                         {hasPrices && (\n                            <span className=\"text-xs text-foreground/60 leading-tight\">\n                              {t('services.cost')}: â‚º{costPrice} Â· {t('services.selling')}: â‚º{sellingPrice}\n                            </span>\n                         )}\n                       </div>\n                     </Badge>;\n            })}\n              </div> : <div className=\"text-center py-6\">\n                <svg className=\"h-8 w-8 text-muted-foreground mx-auto mb-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z\" />\n                </svg>\n                 <p className=\"text-muted-foreground text-sm\">{t('projectDetails.services.emptyState')}</p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    {t('projectDetails.services.addHint')}\n                  </p>\n              </div>}\n          </div>}\n      </CardContent>\n    </Card>\n    </div>;\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProjectSheetPreview.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2446,2449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2446,2449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2861,2864],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2861,2864],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'checkArchiveStatus', 'fetchLead', and 'fetchProjectType'. Either include them or remove the dependency array.","line":128,"column":6,"nodeType":"ArrayExpression","endLine":128,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [project, open, fetchLead, fetchProjectType, checkArchiveStatus]","fix":{"range":[3486,3501],"text":"[project, open, fetchLead, fetchProjectType, checkArchiveStatus]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { ExternalLink, Calendar, CreditCard, CheckCircle2, Users } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { AppSheetModal } from \"@/components/ui/app-sheet-modal\";\nimport { ProjectStatusBadge } from \"@/components/ProjectStatusBadge\";\nimport { useProjectProgress } from \"@/hooks/useProjectProgress\";\nimport { useProjectPayments } from \"@/hooks/useProjectPayments\";\nimport ClientDetailsCard from \"@/components/ClientDetailsCard\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface Project {\n  id: string;\n  name: string;\n  description: string | null;\n  lead_id: string;\n  user_id: string;\n  status_id: string | null;\n  created_at: string;\n  updated_at: string;\n  project_type_id?: string | null;\n  lead?: {\n    name: string;\n    email?: string;\n  };\n}\n\ninterface Lead {\n  id: string;\n  name: string;\n  email: string | null;\n  phone: string | null;\n  status: string;\n  notes: string | null;\n}\n\ninterface ProjectType {\n  id: string;\n  name: string;\n}\n\ninterface ProjectSheetPreviewProps {\n  project: Project | null;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onProjectUpdated?: () => void;\n}\n\nexport default function ProjectSheetPreview({ \n  project, \n  open, \n  onOpenChange, \n  onProjectUpdated \n}: ProjectSheetPreviewProps) {\n  const navigate = useNavigate();\n  const [lead, setLead] = useState<Lead | null>(null);\n  const [projectType, setProjectType] = useState<ProjectType | null>(null);\n  const [isArchived, setIsArchived] = useState(false);\n  const [refreshTrigger, setRefreshTrigger] = useState(0);\n  const { t } = useTranslation();\n  \n  const { progress, loading: progressLoading } = useProjectProgress(project?.id || \"\", refreshTrigger);\n  const { paymentSummary, loading: paymentsLoading } = useProjectPayments(project?.id || \"\", refreshTrigger);\n\n  const fetchLead = async () => {\n    if (!project?.lead_id) return;\n    \n    try {\n      const { data, error } = await supabase\n        .from('leads')\n        .select('id, name, email, phone, status, notes')\n        .eq('id', project.lead_id)\n        .single();\n\n      if (error) throw error;\n      setLead(data);\n    } catch (error: any) {\n      console.error('Error fetching lead:', error);\n    }\n  };\n\n  const fetchProjectType = async () => {\n    if (!project?.project_type_id) return;\n    \n    try {\n      const { data, error } = await supabase\n        .from('project_types')\n        .select('id, name')\n        .eq('id', project.project_type_id)\n        .single();\n\n      if (error) throw error;\n      setProjectType(data);\n    } catch (error: any) {\n      console.error('Error fetching project type:', error);\n    }\n  };\n\n  const checkArchiveStatus = async () => {\n    if (!project?.status_id) {\n      setIsArchived(false);\n      return;\n    }\n\n    try {\n      const { data } = await supabase\n        .from('project_statuses')\n        .select('name')\n        .eq('id', project.status_id)\n        .maybeSingle();\n\n      setIsArchived((data?.name || '').toLowerCase() === 'archived');\n    } catch {\n      setIsArchived(false);\n    }\n  };\n\n  useEffect(() => {\n    if (project && open) {\n      fetchLead();\n      fetchProjectType();\n      checkArchiveStatus();\n    }\n  }, [project, open]);\n\n  const handleStatusChange = () => {\n    checkArchiveStatus();\n    setRefreshTrigger(prev => prev + 1);\n    onProjectUpdated?.();\n  };\n\n  const handleViewFullDetails = () => {\n    if (project) {\n      navigate(`/projects/${project.id}`);\n      onOpenChange(false);\n    }\n  };\n\n  const handleScheduleSession = () => {\n    // Implementation for scheduling session\n    console.log('Schedule session for project:', project?.id);\n  };\n\n  const handleAddPayment = () => {\n    // Implementation for adding payment\n    console.log('Add payment for project:', project?.id);\n  };\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat(\"tr-TR\", {\n      style: \"currency\",\n      currency: \"TRY\",\n      minimumFractionDigits: 0,\n    }).format(amount);\n  };\n\n  if (!project) return null;\n\n  const footerActions = [\n    {\n      label: t(\"forms.project_preview.view_full_details\"),\n      onClick: handleViewFullDetails,\n      variant: \"default\" as const\n    }\n  ];\n\n  return (\n    <AppSheetModal\n      isOpen={open}\n      onOpenChange={onOpenChange}\n      title={project.name}\n      footerActions={footerActions}\n    >\n      <div className=\"space-y-6\">\n        {/* Project Overview */}\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-start justify-between gap-4\">\n              <div className=\"flex-1 space-y-3\">\n                <div className=\"flex items-center gap-2 flex-wrap\">\n                  <h2 className=\"text-lg font-semibold\">{project.name}</h2>\n                  {isArchived && (\n                    <Badge variant=\"secondary\" className=\"text-xs\">\n                      {t(\"forms.project_preview.archived\")}\n                    </Badge>\n                  )}\n                  {projectType && (\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      {projectType.name.toUpperCase()}\n                    </Badge>\n                  )}\n                </div>\n                \n                {project.description && (\n                  <p className=\"text-sm text-muted-foreground\">\n                    {project.description}\n                  </p>\n                )}\n\n                <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n                  <span>{t(\"forms.project_preview.created\")} {format(new Date(project.created_at), \"MMM d, yyyy\")}</span>\n                  {project.updated_at !== project.created_at && (\n                    <span>{t(\"forms.project_preview.updated\")} {format(new Date(project.updated_at), \"MMM d, yyyy\")}</span>\n                  )}\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Status and Progress */}\n        <div className=\"grid grid-cols-2 gap-4\">\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center gap-2 text-sm font-medium\">\n                  <CheckCircle2 className=\"h-4 w-4\" />\n                  {t(\"forms.project_preview.progress\")}\n                </div>\n                {!progressLoading && progress.total > 0 ? (\n                  <div className=\"space-y-1\">\n                    <div className=\"flex justify-between text-sm\">\n                      <span>{progress.completed}/{progress.total} {t(\"forms.project_preview.tasks\")}</span>\n                      <span className=\"font-medium\">{progress.percentage}%</span>\n                    </div>\n                    <div className=\"w-full bg-muted rounded-full h-2\">\n                      <div \n                        className=\"bg-primary h-2 rounded-full transition-all\"\n                        style={{ width: `${progress.percentage}%` }}\n                      />\n                    </div>\n                  </div>\n                ) : (\n                  <p className=\"text-sm text-muted-foreground\">{t(\"forms.project_preview.no_tasks_yet\")}</p>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center gap-2 text-sm font-medium\">\n                  <Users className=\"h-4 w-4\" />\n                  {t(\"forms.project_preview.status\")}\n                </div>\n                {!isArchived && (\n                  <ProjectStatusBadge \n                    projectId={project.id}\n                    currentStatusId={project.status_id}\n                    onStatusChange={handleStatusChange}\n                    editable={true}\n                    size=\"sm\"\n                  />\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Payments Summary */}\n        {!paymentsLoading && paymentSummary.totalProject > 0 && (\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center gap-2 text-sm font-medium\">\n                  <CreditCard className=\"h-4 w-4\" />\n                  {t(\"forms.project_preview.payments\")}\n                </div>\n                <div className=\"space-y-1\">\n                  <div className=\"flex justify-between text-sm\">\n                    <span>{t(\"forms.project_preview.paid\")}</span>\n                    <span className=\"font-medium text-green-600\">\n                      {formatCurrency(paymentSummary.totalPaid)}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span>{t(\"forms.project_preview.total\")}</span>\n                    <span className=\"font-medium\">\n                      {formatCurrency(paymentSummary.totalProject)}\n                    </span>\n                  </div>\n                  {paymentSummary.remaining > 0 && (\n                    <div className=\"flex justify-between text-sm\">\n                      <span>{t(\"forms.project_preview.remaining\")}</span>\n                      <span className=\"font-medium text-orange-600\">\n                        {formatCurrency(paymentSummary.remaining)}\n                      </span>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Client Details */}\n        {lead && (\n          <ClientDetailsCard\n            title={t(\"forms.project_preview.client_information\")}\n            name={lead.name}\n            email={lead.email}\n            phone={lead.phone}\n            notes={lead.notes}\n            showQuickActions={false}\n            clampNotes={true}\n            onNameClick={() => navigate(`/leads/${lead.id}`)}\n          />\n        )}\n\n        {/* Quick Actions */}\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"space-y-3\">\n              <h3 className=\"text-sm font-medium\">{t(\"forms.project_preview.quick_actions\")}</h3>\n              <div className=\"grid grid-cols-2 gap-2\">\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\"\n                  onClick={handleScheduleSession}\n                  className=\"justify-start\"\n                >\n                  <Calendar className=\"h-4 w-4 mr-2\" />\n                  {t(\"forms.project_preview.schedule_session\")}\n                </Button>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\"\n                  onClick={handleAddPayment}\n                  className=\"justify-start\"\n                >\n                  <CreditCard className=\"h-4 w-4 mr-2\" />\n                  {t(\"forms.project_preview.add_payment\")}\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </AppSheetModal>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProjectSheetView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProjectStagePipeline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProjectStatusBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProjectStatusesSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":193,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7147,7150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7147,7150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":244,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":244,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8919,8922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8919,8922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { DragDropContext, Droppable, Draggable } from \"@hello-pangea/dnd\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Plus, Trash2, Loader2, GripVertical } from \"lucide-react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useI18nToast } from \"@/lib/toastHelpers\";\nimport { AddProjectStageDialog, EditProjectStageDialog } from \"./settings/ProjectStageDialogs\";\nimport { useProjectStatuses } from \"@/hooks/useOrganizationData\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\nimport { cn } from \"@/lib/utils\";\nimport SettingsSection from \"./SettingsSection\";\nimport { FormLoadingSkeleton } from \"@/components/ui/loading-presets\";\nimport { useTranslation } from \"react-i18next\";\nimport { useMessagesTranslation } from \"@/hooks/useTypedTranslation\";\n// Permissions removed for single photographer mode\n\nconst projectStatusSchema = z.object({\n  name: z.string().min(1, \"Status name is required\").max(50, \"Status name must be less than 50 characters\"),\n  color: z.string().regex(/^#[0-9A-F]{6}$/i, \"Color must be a valid hex code\"),\n});\n\ntype ProjectStatusForm = z.infer<typeof projectStatusSchema>;\n\ninterface ProjectStatus {\n  id: string;\n  name: string;\n  color: string;\n  created_at: string;\n  updated_at: string;\n  sort_order: number;\n  lifecycle?: 'active' | 'completed' | 'cancelled';\n  is_system_required?: boolean;\n}\n\n// Predefined color palette (similar to Pixieset)\nconst PREDEFINED_COLORS = [\n  '#F56565', // Red\n  '#ED8936', // Orange  \n  '#ECC94B', // Yellow\n  '#9AE6B4', // Light Green\n  '#48BB78', // Green\n  '#38B2AC', // Teal\n  '#63B3ED', // Light Blue\n  '#4299E1', // Blue\n  '#667EEA', // Indigo\n  '#9F7AEA', // Purple\n  '#ED64A6', // Pink\n  '#A0AEC0', // Gray\n];\n\nconst ProjectStatusesSection = () => {\n  const [editingStatus, setEditingStatus] = useState<ProjectStatus | null>(null);\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [submitting, setSubmitting] = useState(false);\n  const toast = useI18nToast();\n  const { t } = useTranslation(\"forms\");\n  const { t: tMessages } = useMessagesTranslation();\n  const { activeOrganizationId } = useOrganization();\n\n  const { data: statuses = [], isLoading, refetch } = useProjectStatuses();\n  // Permissions removed for single photographer mode - always allow\n\n  // Check for lifecycle completeness and show warnings\n  useEffect(() => {\n    if (statuses.length > 0 && !isLoading) {\n      const hasCompleted = statuses.some(s => s.lifecycle === 'completed');\n      const hasCancelled = statuses.some(s => s.lifecycle === 'cancelled');\n      \n      if (!hasCompleted || !hasCancelled) {\n        const timeoutId = setTimeout(() => {\n          toast.info(\"Add at least one Completed and one Cancelled stage to unlock full automations.\");\n        }, 1000);\n        \n        return () => clearTimeout(timeoutId);\n      }\n    }\n  }, [statuses, isLoading, toast]);\n\n  const form = useForm<ProjectStatusForm>({\n    resolver: zodResolver(projectStatusSchema),\n    defaultValues: {\n      name: \"\",\n      color: PREDEFINED_COLORS[0],\n    },\n  });\n\n  const selectedColor = form.watch(\"color\");\n\n  const isProtectedName = (name: string) => {\n    const n = name?.trim().toLowerCase();\n    return n === 'planned' || n === 'new' || n === 'archived';\n  };\n\n  const createDefaultStatuses = async () => {\n    if (!activeOrganizationId) return;\n    \n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n\n      // Updated default statuses as requested\n      const defaultStatuses = [\n        { name: 'Planned', color: '#A0AEC0', sort_order: 1 },\n        { name: 'Booked', color: '#ECC94B', sort_order: 2 },\n        { name: 'Post Production', color: '#9F7AEA', sort_order: 3 },\n        { name: 'Completed', color: '#48BB78', sort_order: 4 },\n        { name: 'Cancelled', color: '#F56565', sort_order: 5 }\n      ];\n\n      const { error } = await supabase\n        .from('project_statuses')\n        .insert(defaultStatuses.map(status => ({ ...status, user_id: user.id, organization_id: activeOrganizationId })));\n\n      if (error) throw error;\n      await refetch();\n    } catch (error) {\n      console.error('Error creating default statuses:', error);\n      toast.error(\"Failed to create default statuses\");\n    }\n  };\n\n  const onSubmit = async (data: ProjectStatusForm) => {\n    setSubmitting(true);\n    try {\n      const lowerName = data.name.trim().toLowerCase();\n      if (lowerName === 'archived') {\n        toast.error('The \"Archived\" stage is managed automatically and cannot be created or renamed.');\n        return;\n      }\n\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Not authenticated');\n\n      if (editingStatus) {\n        // Update existing status\n        if (!activeOrganizationId) throw new Error('No organization found');\n\n        const { error } = await supabase\n          .from('project_statuses')\n          .update({ name: data.name, color: data.color })\n          .eq('id', editingStatus.id)\n          .eq('organization_id', activeOrganizationId);\n\n        if (error) throw error;\n\n        toast.success(\"Project status updated successfully\");\n        setIsEditDialogOpen(false);\n      } else {\n        // Create new status with the next sort order\n        const maxSortOrder = Math.max(...statuses.map(s => s.sort_order), 0);\n        if (!activeOrganizationId) throw new Error('No organization found');\n        \n        const { error } = await supabase\n          .from('project_statuses')\n          .insert({\n            name: data.name,\n            color: data.color,\n            user_id: user.id,\n            organization_id: activeOrganizationId,\n            sort_order: maxSortOrder + 1,\n          });\n\n        if (error) {\n          if (error.code === '23505') { // Unique constraint violation\n            throw new Error('A status with this name already exists');\n          }\n          throw error;\n        }\n\n        toast.success(\"Project status created successfully\");\n        setIsAddDialogOpen(false);\n      }\n\n      form.reset({ name: \"\", color: PREDEFINED_COLORS[0] });\n      setEditingStatus(null);\n      await refetch();\n    } catch (error) {\n      console.error('Error saving project status:', error);\n      toast.error(error instanceof Error ? error.message : \"Failed to save project status\");\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleEdit = (status: any) => {\n    // Cast to proper type for dialog\n    const typedStatus: ProjectStatus = {\n      ...status,\n      lifecycle: (status.lifecycle as 'active' | 'completed' | 'cancelled') || 'active'\n    };\n    setEditingStatus(typedStatus);\n    form.reset({ name: status.name, color: status.color });\n    setIsEditDialogOpen(true);\n  };\n\n  const handleAdd = () => {\n    setEditingStatus(null);\n    form.reset({ name: \"\", color: PREDEFINED_COLORS[0] });\n    setIsAddDialogOpen(true);\n  };\n\n  const handleDelete = async (statusId: string) => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Not authenticated');\n\n      if (!activeOrganizationId) throw new Error('No organization found');\n\n      const status = statuses.find(s => s.id === statusId);\n      if (status && isProtectedName(status.name)) {\n        toast.error(`The \"${status.name}\" stage cannot be deleted as it's the default stage for new projects.`);\n        return;\n      }\n\n      const { error } = await supabase\n        .from('project_statuses')\n        .delete()\n        .eq('id', statusId)\n        .eq('organization_id', activeOrganizationId);\n\n      if (error) {\n        if (error.code === '23503') { // Foreign key constraint violation\n          throw new Error('Cannot delete this stage because it is being used by existing projects. Please change those projects to a different stage first.');\n        }\n        throw error;\n      }\n\n      toast.success(\"Project status deleted successfully\");\n      await refetch();\n    } catch (error) {\n      console.error('Error deleting project status:', error);\n      toast.error(error instanceof Error ? error.message : \"Failed to delete project status\");\n    }\n  };\n\n  const handleDragEnd = async (result: any) => {\n    if (!result.destination) return;\n\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Not authenticated');\n      if (!activeOrganizationId) throw new Error('No organization found');\n\n      // Filter out archived statuses for reordering\n      const filteredStatuses = statuses.filter(status => status.lifecycle !== 'archived' && status.name.toLowerCase() !== 'archived');\n      const items = Array.from(filteredStatuses);\n      const [reorderedItem] = items.splice(result.source.index, 1);\n      items.splice(result.destination.index, 0, reorderedItem);\n\n      // Update sort_order for filtered items only\n      const updates = items.map((status, index) => ({\n        id: status.id,\n        sort_order: index + 1,\n      }));\n\n      // Execute all updates\n      for (const update of updates) {\n        const { error } = await supabase\n          .from('project_statuses')\n          .update({ sort_order: update.sort_order })\n          .eq('id', update.id)\n          .eq('organization_id', activeOrganizationId);\n\n        if (error) throw error;\n      }\n\n      toast.success(\"Status order updated successfully\");\n      await refetch();\n    } catch (error) {\n      console.error('Error updating status order:', error);\n      toast.error(\"Failed to update status order\");\n    }\n  };\n\n  const renderColorSwatches = (onColorSelect: (color: string) => void) => (\n    <div className=\"grid grid-cols-6 gap-2\">\n      {PREDEFINED_COLORS.map((color) => (\n        <button\n          key={color}\n          type=\"button\"\n          className={cn(\n            \"w-8 h-8 rounded-full border-2 transition-all hover:scale-110\",\n            selectedColor === color ? \"border-foreground ring-2 ring-offset-2 ring-foreground\" : \"border-muted\"\n          )}\n          style={{ backgroundColor: color }}\n          onClick={() => onColorSelect(color)}\n          title={color}\n        />\n      ))}\n    </div>\n  );\n\n  const renderStatusDialog = (isEdit: boolean) => (\n    <DialogContent className=\"sm:max-w-md\">\n      <DialogHeader>\n        <DialogTitle className=\"text-lg font-medium\">\n          {isEdit ? 'EDIT STAGE' : 'ADD STAGE'}\n        </DialogTitle>\n      </DialogHeader>\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n          <FormField\n            control={form.control}\n            name=\"name\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel className=\"text-sm font-medium\">Name</FormLabel>\n                <FormControl>\n                  <Input \n                    placeholder={isEdit ? \"\" : \"e.g. Inquiry, Post Production, Completed\"} \n                    {...field} \n                    className=\"mt-1\"\n                  />\n                </FormControl>\n                <FormMessage />\n                {!isEdit && (\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    Organise your workflow in stages.\n                  </p>\n                )}\n              </FormItem>\n            )}\n          />\n          \n          <FormField\n            control={form.control}\n            name=\"color\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel className=\"text-sm font-medium\">Stage Color</FormLabel>\n                <FormControl>\n                  <div className=\"mt-2\">\n                    {renderColorSwatches(field.onChange)}\n                  </div>\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n          \n          <div className=\"flex justify-between items-center pt-4\">\n            {isEdit && editingStatus && !isProtectedName(editingStatus.name) && (\n              <AlertDialog>\n                <AlertDialogTrigger asChild>\n                  <Button type=\"button\" variant=\"destructive\">\n                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                    Delete\n                  </Button>\n                </AlertDialogTrigger>\n                <AlertDialogContent>\n                  <AlertDialogHeader>\n                    <AlertDialogTitle>Delete Project Status</AlertDialogTitle>\n                    <AlertDialogDescription>\n                      {tMessages('confirm.deleteWithName', { name: editingStatus?.name })} {tMessages('confirm.cannotUndo')}\n                    </AlertDialogDescription>\n                  </AlertDialogHeader>\n                  <AlertDialogFooter>\n                    <AlertDialogCancel>Cancel</AlertDialogCancel>\n                    <AlertDialogAction\n                      onClick={() => {\n                        if (editingStatus) {\n                          handleDelete(editingStatus.id);\n                          setIsEditDialogOpen(false);\n                        }\n                      }}\n                      className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                    >\n                      Delete\n                    </AlertDialogAction>\n                  </AlertDialogFooter>\n                </AlertDialogContent>\n              </AlertDialog>\n            )}\n            \n            {isEdit && editingStatus && isProtectedName(editingStatus.name) && (\n              <p className=\"text-sm text-muted-foreground\">\n                The \"{editingStatus.name}\" stage cannot be deleted as it's the default stage for new projects.\n              </p>\n            )}\n            \n            <div className=\"flex gap-2 ml-auto\">\n              <Button \n                type=\"button\" \n                variant=\"outline\" \n                onClick={() => isEdit ? setIsEditDialogOpen(false) : setIsAddDialogOpen(false)}\n              >\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={submitting}>\n                {submitting ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                    {isEdit ? 'Saving...' : 'Adding...'}\n                  </>\n                ) : (\n                  isEdit ? 'Save' : 'Add'\n                )}\n              </Button>\n            </div>\n          </div>\n        </form>\n      </Form>\n    </DialogContent>\n  );\n\n  // Create default statuses if none exist\n  if (!isLoading && activeOrganizationId && statuses.length === 0) {\n    createDefaultStatuses();\n  }\n\n  if (isLoading) {\n    return (\n      <SettingsSection \n        title={t('project_stages.title')}\n        description={t('project_stages.description')}\n      >\n        <FormLoadingSkeleton rows={3} />\n      </SettingsSection>\n    );\n  }\n\n  // Always show project statuses in single photographer mode\n  // if (!hasPermission('view_project_statuses')) {\n  //   return null;\n  // }\n\n  const canManageProjectStatuses = true; // Always allow in single photographer mode\n\n  return (\n    <>\n    <SettingsSection \n      title={t('project_stages.title')}\n      description={t('project_stages.description')}\n      action={canManageProjectStatuses ? {\n        label: t('project_stages.add_stage'),\n        onClick: handleAdd,\n        icon: <Plus className=\"h-4 w-4\" />\n      } : undefined}\n    >\n      <div className=\"mb-4 p-3 bg-muted/30 rounded-lg border border-dashed border-muted-foreground/20\">\n        <p className=\"text-sm text-muted-foreground leading-relaxed\">\n          {t('project_stages.drag_instructions')}\n        </p>\n      </div>\n\n        <DragDropContext onDragEnd={handleDragEnd}>\n          <Droppable droppableId=\"statuses\" direction=\"horizontal\">\n            {(provided, snapshot) => (\n              <div\n                {...provided.droppableProps}\n                ref={provided.innerRef}\n                className={cn(\n                  \"flex flex-wrap gap-3 min-h-[48px] transition-colors rounded-lg p-2\",\n                  snapshot.isDraggingOver && \"bg-accent/20\"\n                )}\n              >\n                {statuses.filter(status => status.lifecycle !== 'archived' && status.name.toLowerCase() !== 'archived').map((status, index) => (\n                  <Draggable key={status.id} draggableId={status.id} index={index}>\n                    {(provided, snapshot) => (\n                      <div\n                        ref={provided.innerRef}\n                        {...provided.draggableProps}\n                        className={cn(\n                          \"inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium transition-all select-none\",\n                          snapshot.isDragging ? \"opacity-80 shadow-xl scale-105 z-50\" : \"hover:opacity-80 cursor-pointer\",\n                          !snapshot.isDragging && \"hover:scale-[1.02]\"\n                        )}\n                        style={{ \n                          backgroundColor: status.color + '20',\n                          color: status.color,\n                          border: `1px solid ${status.color}40`,\n                          ...provided.draggableProps.style\n                        }}\n                      >\n                        <div \n                          {...provided.dragHandleProps}\n                          className=\"flex items-center cursor-grab active:cursor-grabbing hover:opacity-70 transition-opacity\"\n                          onClick={(e) => e.stopPropagation()}\n                        >\n                          <GripVertical className=\"w-3 h-3 text-current opacity-60\" />\n                        </div>\n                        <div \n                          className=\"w-2 h-2 rounded-full flex-shrink-0\" \n                          style={{ backgroundColor: status.color }}\n                        />\n                         <span \n                           className={`uppercase tracking-wide font-semibold ${canManageProjectStatuses ? 'cursor-pointer' : 'cursor-default'}`}\n                           onClick={canManageProjectStatuses ? (e) => {\n                             e.stopPropagation();\n                             handleEdit(status);\n                           } : undefined}\n                         >\n                           {status.name}\n                         </span>\n                         {status.lifecycle && status.lifecycle !== 'active' && (\n                           <span className=\"text-xs opacity-60 font-normal capitalize\">\n                             Â· {t(`project_stage.lifecycle.${status.lifecycle}`)}\n                           </span>\n                         )}\n                      </div>\n                    )}\n                  </Draggable>\n                ))}\n                {provided.placeholder}\n              </div>\n            )}\n          </Droppable>\n        </DragDropContext>\n\n        {/* Add Dialog */}\n        {canManageProjectStatuses && (\n          <>\n            <AddProjectStageDialog\n              open={isAddDialogOpen}\n              onOpenChange={setIsAddDialogOpen}\n              onStageAdded={refetch}\n            />\n\n            {/* Edit Dialog */}\n            <EditProjectStageDialog\n              stage={editingStatus}\n              open={isEditDialogOpen}\n              onOpenChange={setIsEditDialogOpen}\n              onStageUpdated={refetch}\n            />\n          </>\n        )}\n      </SettingsSection>\n    </>\n  );\n};\n\nexport default ProjectStatusesSection;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProjectTodoList.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTodos'. Either include it or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTodos, projectId]","fix":{"range":[1269,1280],"text":"[fetchTodos, projectId]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { ProgressBar } from '@/components/ui/progress-bar';\nimport { Trash2, Plus, Check } from 'lucide-react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { useFormsTranslation } from '@/hooks/useTypedTranslation';\n\ninterface Todo {\n  id: string;\n  content: string;\n  is_completed: boolean;\n  created_at: string;\n}\n\ninterface ProjectTodoListProps {\n  projectId: string;\n}\n\nexport const ProjectTodoList: React.FC<ProjectTodoListProps> = ({ projectId }) => {\n  const [todos, setTodos] = useState<Todo[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [isAddingTodo, setIsAddingTodo] = useState(false);\n  const [newTodoContent, setNewTodoContent] = useState('');\n  const [editingTodoId, setEditingTodoId] = useState<string | null>(null);\n  const [editContent, setEditContent] = useState('');\n  const { toast } = useToast();\n  const { t } = useFormsTranslation();\n\n  useEffect(() => {\n    fetchTodos();\n  }, [projectId]);\n\n  const fetchTodos = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('todos')\n        .select('*')\n        .eq('project_id', projectId)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setTodos(data || []);\n    } catch (error) {\n      console.error('Error fetching todos:', error);\n      toast({\n        title: \"Error\",\n        description: t(\"todos.error_load\"),\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const addTodo = async () => {\n    if (!newTodoContent.trim()) return;\n\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('User not authenticated');\n\n      const { data, error } = await supabase\n        .from('todos')\n        .insert({\n          project_id: projectId,\n          user_id: user.id,\n          content: newTodoContent.trim(),\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n      \n      setTodos(prev => [data, ...prev]);\n      setNewTodoContent('');\n      setIsAddingTodo(false);\n      \n      toast({\n        title: \"Success\",\n        description: t(\"todos.todo_added\"),\n      });\n    } catch (error) {\n      console.error('Error adding todo:', error);\n      toast({\n        title: \"Error\",\n        description: t(\"todos.error_add\"),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const toggleTodo = async (id: string, isCompleted: boolean) => {\n    try {\n      const { error } = await supabase\n        .from('todos')\n        .update({ is_completed: !isCompleted })\n        .eq('id', id);\n\n      if (error) throw error;\n      \n      setTodos(prev => prev.map(todo => \n        todo.id === id ? { ...todo, is_completed: !isCompleted } : todo\n      ));\n    } catch (error) {\n      console.error('Error updating todo:', error);\n      toast({\n        title: \"Error\",\n        description: t(\"todos.error_update\"),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const deleteTodo = async (id: string) => {\n    try {\n      const { error } = await supabase\n        .from('todos')\n        .delete()\n        .eq('id', id);\n\n      if (error) throw error;\n      \n      setTodos(prev => prev.filter(todo => todo.id !== id));\n      \n      toast({\n        title: \"Success\",\n        description: t(\"todos.todo_deleted\"),\n      });\n    } catch (error) {\n      console.error('Error deleting todo:', error);\n      toast({\n        title: \"Error\",\n        description: t(\"todos.error_delete\"),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const startEditing = (todo: Todo) => {\n    setEditingTodoId(todo.id);\n    setEditContent(todo.content);\n  };\n\n  const saveEdit = async () => {\n    if (!editContent.trim() || !editingTodoId) return;\n\n    try {\n      const { error } = await supabase\n        .from('todos')\n        .update({ content: editContent.trim() })\n        .eq('id', editingTodoId);\n\n      if (error) throw error;\n      \n      setTodos(prev => prev.map(todo => \n        todo.id === editingTodoId ? { ...todo, content: editContent.trim() } : todo\n      ));\n      \n      setEditingTodoId(null);\n      setEditContent('');\n      \n      toast({\n        title: \"Success\",\n        description: t(\"todos.todo_updated\"),\n      });\n    } catch (error) {\n      console.error('Error updating todo:', error);\n      toast({\n        title: \"Error\",\n        description: t(\"todos.error_update\"),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const cancelEdit = () => {\n    setEditingTodoId(null);\n    setEditContent('');\n  };\n\n  const completedCount = todos.filter(todo => todo.is_completed).length;\n  const totalCount = todos.length;\n  const progressPercentage = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;\n\n  if (loading) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-lg\">{t(\"todos.title\")}</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"text-sm text-muted-foreground\">{t(\"todos.loading\")}</div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"text-lg\">\n          {t(\"todos.title\")} {totalCount > 0 && `(${completedCount}/${totalCount})`}\n        </CardTitle>\n        {totalCount > 0 && (\n          <div className=\"mt-3\">\n            <ProgressBar\n              value={progressPercentage}\n              total={totalCount}\n              completed={completedCount}\n              className=\"w-full\"\n              size=\"sm\"\n            />\n          </div>\n        )}\n      </CardHeader>\n      <CardContent className=\"space-y-2\">\n        {/* Add Todo Input */}\n        {isAddingTodo ? (\n          <div className=\"flex items-center gap-2 p-3 border rounded-lg bg-muted/50\">\n            <Input\n              value={newTodoContent}\n              onChange={(e) => setNewTodoContent(e.target.value)}\n              placeholder={t(\"todos.enter_todo\")}\n              className=\"flex-1\"\n              autoFocus\n              onKeyDown={(e) => {\n                if (e.key === 'Enter') {\n                  addTodo();\n                } else if (e.key === 'Escape') {\n                  setIsAddingTodo(false);\n                  setNewTodoContent('');\n                }\n              }}\n              onBlur={() => {\n                if (!newTodoContent.trim()) {\n                  setIsAddingTodo(false);\n                  setNewTodoContent('');\n                }\n              }}\n            />\n            <Button\n              size=\"sm\"\n              onClick={addTodo}\n              disabled={!newTodoContent.trim()}\n            >\n              <Check className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        ) : (\n          <button\n            onClick={() => setIsAddingTodo(true)}\n            className=\"flex items-center gap-2 w-full p-3 text-left text-muted-foreground hover:bg-muted/50 rounded-lg border border-dashed transition-colors\"\n          >\n            <Plus className=\"h-4 w-4\" />\n            <span>{t(\"todos.add_todo\")}</span>\n          </button>\n        )}\n\n        {/* Todo List */}\n        {todos.length === 0 ? (\n          <div className=\"text-sm text-muted-foreground text-center py-4\">\n            {t(\"todos.no_todos\")}\n          </div>\n        ) : (\n          <div className=\"space-y-1\">\n            {todos.map((todo) => (\n              <div\n                key={todo.id}\n                className={`flex items-center gap-3 p-3 rounded-lg border transition-colors hover:bg-muted/30 ${\n                  todo.is_completed ? 'bg-green-50' : ''\n                }`}\n              >\n                <Checkbox\n                  checked={todo.is_completed}\n                  onCheckedChange={() => toggleTodo(todo.id, todo.is_completed)}\n                />\n                \n                {editingTodoId === todo.id ? (\n                  <div className=\"flex items-center gap-2 flex-1\">\n                    <Input\n                      value={editContent}\n                      onChange={(e) => setEditContent(e.target.value)}\n                      className=\"flex-1\"\n                      autoFocus\n                      onKeyDown={(e) => {\n                        if (e.key === 'Enter') {\n                          saveEdit();\n                        } else if (e.key === 'Escape') {\n                          cancelEdit();\n                        }\n                      }}\n                      onBlur={saveEdit}\n                    />\n                    <Button\n                      size=\"sm\"\n                      onClick={saveEdit}\n                      disabled={!editContent.trim()}\n                    >\n                      <Check className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                ) : (\n                  <span\n                    className={`flex-1 cursor-pointer ${\n                      todo.is_completed\n                        ? 'line-through text-muted-foreground'\n                        : ''\n                    }`}\n                    onClick={() => startEditing(todo)}\n                  >\n                    {todo.content}\n                  </span>\n                )}\n\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => deleteTodo(todo.id)}\n                  className=\"h-8 w-8 p-0 text-destructive hover:text-destructive\"\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            ))}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProjectTodoListEnhanced.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTodos'. Either include it or remove the dependency array.","line":44,"column":6,"nodeType":"ArrayExpression","endLine":44,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTodos, projectId]","fix":{"range":[1522,1533],"text":"[fetchTodos, projectId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1863,1866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1863,1866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3067,3070],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3067,3070],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":132,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4115,4118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4115,4118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":172,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5291,5294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5291,5294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":209,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":209,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6316,6319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6316,6319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { CheckSquare, Trash2, Plus, Edit, Check, X } from \"lucide-react\";\nimport { ProgressBar } from \"@/components/ui/progress-bar\";\nimport { useFormsTranslation, useCommonTranslation } from '@/hooks/useTypedTranslation';\nimport { logAuditEvent } from \"@/lib/auditLog\";\nimport type { Json } from \"@/integrations/supabase/types\";\n\ninterface Todo {\n  id: string;\n  content: string;\n  is_completed: boolean;\n  created_at: string;\n}\n\ninterface ProjectTodoListEnhancedProps {\n  projectId: string;\n  onTodosUpdated?: () => void;\n}\n\nexport function ProjectTodoListEnhanced({\n  projectId,\n  onTodosUpdated\n}: ProjectTodoListEnhancedProps) {\n  const [todos, setTodos] = useState<Todo[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [newTodoContent, setNewTodoContent] = useState(\"\");\n  const [isAdding, setIsAdding] = useState(false);\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [editContent, setEditContent] = useState(\"\");\n  const {\n    toast\n  } = useToast();\n  const { t: tForms } = useFormsTranslation();\n  const { t: tCommon } = useCommonTranslation();\n\n  useEffect(() => {\n    fetchTodos();\n  }, [projectId]);\n  const fetchTodos = async () => {\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('todos').select('*').eq('project_id', projectId).order('created_at', {\n        ascending: false\n      });\n      if (error) throw error;\n      setTodos(data || []);\n      onTodosUpdated?.();\n    } catch (error: any) {\n      console.error('Error fetching todos:', error);\n      toast({\n        title: tForms('todos.error_loading'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n  const handleToggleComplete = async (todoId: string, isCompleted: boolean) => {\n    try {\n      const existing = todos.find(todo => todo.id === todoId);\n      const { error } = await supabase.from('todos').update({\n        is_completed: !isCompleted\n      }).eq('id', todoId);\n      if (error) throw error;\n      setTodos(todos.map(todo => todo.id === todoId ? {\n        ...todo,\n        is_completed: !isCompleted\n      } : todo));\n      if (existing) {\n        void logAuditEvent({\n          entityType: \"todo\",\n          entityId: existing.id,\n          action: \"updated\",\n          oldValues: existing as unknown as Json,\n          newValues: { ...existing, is_completed: !isCompleted } as unknown as Json\n        });\n      }\n      onTodosUpdated?.();\n      toast({\n        title: tCommon('success'),\n        description: `${tForms('todos.todo')} ${!isCompleted ? tForms('todos.completed') : tForms('todos.reopened')}.`\n      });\n    } catch (error: any) {\n      toast({\n        title: tForms('todos.error_updating'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    }\n  };\n  const handleAddTodo = async () => {\n    if (!newTodoContent.trim()) return;\n    setIsAdding(true);\n    try {\n      const {\n        data: {\n          user\n        }\n      } = await supabase.auth.getUser();\n      if (!user) throw new Error('User not authenticated');\n      const {\n        data,\n        error\n      } = await supabase.from('todos').insert({\n        user_id: user.id,\n        project_id: projectId,\n        content: newTodoContent.trim()\n      }).select('*').single();\n      if (error) throw error;\n      setTodos([data, ...todos]);\n      setNewTodoContent(\"\");\n      void logAuditEvent({\n        entityType: \"todo\",\n        entityId: data.id,\n        action: \"created\",\n        newValues: data as unknown as Json\n      });\n      onTodosUpdated?.();\n      toast({\n        title: tCommon('success'),\n        description: tForms('todos.todo_added')\n      });\n    } catch (error: any) {\n      toast({\n        title: tForms('todos.error_adding'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsAdding(false);\n    }\n  };\n  const handleEditTodo = async (todoId: string, newContent: string) => {\n    if (!newContent.trim()) return;\n    try {\n      const existing = todos.find(todo => todo.id === todoId);\n      const {\n        error\n      } = await supabase.from('todos').update({\n        content: newContent.trim()\n      }).eq('id', todoId);\n      if (error) throw error;\n      setTodos(todos.map(todo => todo.id === todoId ? {\n        ...todo,\n        content: newContent.trim()\n      } : todo));\n      setEditingId(null);\n      setEditContent(\"\");\n      if (existing) {\n        void logAuditEvent({\n          entityType: \"todo\",\n          entityId: existing.id,\n          action: \"updated\",\n          oldValues: existing as unknown as Json,\n          newValues: { ...existing, content: newContent.trim() } as unknown as Json\n        });\n      }\n      onTodosUpdated?.();\n      toast({\n        title: tCommon('success'),\n        description: tForms('todos.todo_updated')\n      });\n    } catch (error: any) {\n      toast({\n        title: tForms('todos.error_updating'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    }\n  };\n  const startEditing = (todo: Todo) => {\n    setEditingId(todo.id);\n    setEditContent(todo.content);\n  };\n  const cancelEditing = () => {\n    setEditingId(null);\n    setEditContent(\"\");\n  };\n  const handleDeleteTodo = async (todoId: string) => {\n    try {\n      const existing = todos.find(todo => todo.id === todoId);\n      const {\n        error\n      } = await supabase.from('todos').delete().eq('id', todoId);\n      if (error) throw error;\n      setTodos(todos.filter(todo => todo.id !== todoId));\n      if (existing) {\n        void logAuditEvent({\n          entityType: \"todo\",\n          entityId: existing.id,\n          action: \"deleted\",\n          oldValues: existing as unknown as Json\n        });\n      }\n      onTodosUpdated?.();\n      toast({\n        title: tCommon('success'),\n        description: tForms('todos.todo_deleted')\n      });\n    } catch (error: any) {\n      toast({\n        title: tForms('todos.error_deleting'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    }\n  };\n  if (loading) {\n    return <Card>\n      <CardHeader className=\"pb-3\">\n         <CardTitle className=\"flex items-center gap-2 text-lg font-medium\">\n           <CheckSquare className=\"h-4 w-4\" />\n           {tForms('todos.title')}\n         </CardTitle>\n      </CardHeader>\n        <CardContent>\n          <div className=\"space-y-3\">\n            <div className=\"w-full h-4 bg-muted animate-pulse rounded\" />\n            <div className=\"w-3/4 h-4 bg-muted animate-pulse rounded\" />\n            <div className=\"w-1/2 h-4 bg-muted animate-pulse rounded\" />\n          </div>\n        </CardContent>\n      </Card>;\n  }\n  const completedCount = todos.filter(todo => todo.is_completed).length;\n  const totalCount = todos.length;\n  const progressPercentage = totalCount > 0 ? Math.round(completedCount / totalCount * 100) : 0;\n  return <Card>\n      <CardHeader className=\"pb-3\">\n         <CardTitle className=\"flex items-center gap-2 text-xl font-semibold\">\n           <CheckSquare className=\"h-4 w-4\" />\n           {tForms('todos.title')}\n         </CardTitle>\n        {todos.length > 0 && <div className=\"pt-2\">\n            <ProgressBar value={progressPercentage} total={totalCount} completed={completedCount} size=\"md\" />\n          </div>}\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {/* Add Todo Input */}\n        <div className=\"flex gap-2\">\n          <Input placeholder={tForms('todos.add_placeholder')} value={newTodoContent} onChange={e => setNewTodoContent(e.target.value)} onKeyDown={e => {\n          if (e.key === 'Enter' && !e.shiftKey) {\n            e.preventDefault();\n            handleAddTodo();\n          }\n        }} className=\"flex-1\" />\n          <Button onClick={handleAddTodo} disabled={!newTodoContent.trim() || isAdding} className=\"h-11 w-11 p-0\" aria-label={tForms('todos.add_todo')}>\n            <Plus className=\"h-5 w-5\" />\n          </Button>\n        </div>\n\n        {todos.length > 0 ? <>\n            <div className=\"space-y-3\">\n              {todos.map(todo => <div key={todo.id} className=\"flex items-center gap-2 p-2 bg-muted/30 rounded-md border\">\n                  <Checkbox checked={todo.is_completed} onCheckedChange={() => handleToggleComplete(todo.id, todo.is_completed)} />\n                  <div className=\"flex-1 min-w-0\">\n                    {editingId === todo.id ? <div className=\"flex items-center gap-2\">\n                        <Input value={editContent} onChange={e => setEditContent(e.target.value)} onKeyDown={e => {\n                  if (e.key === 'Enter') {\n                    handleEditTodo(todo.id, editContent);\n                  } else if (e.key === 'Escape') {\n                    cancelEditing();\n                  }\n                }} className=\"flex-1\" autoFocus />\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => handleEditTodo(todo.id, editContent)} className=\"h-8 w-8 p-0 text-green-600 hover:text-green-700\">\n                          <Check className=\"h-4 w-4\" />\n                        </Button>\n                        <Button variant=\"ghost\" size=\"sm\" onClick={cancelEditing} className=\"h-8 w-8 p-0 text-muted-foreground hover:text-foreground\">\n                          <X className=\"h-4 w-4\" />\n                        </Button>\n                      </div> : <p className={`text-sm ${todo.is_completed ? 'line-through text-muted-foreground' : ''}`}>\n                        {todo.content}\n                      </p>}\n                  </div>\n                  {editingId !== todo.id && <div className=\"flex items-center gap-1\">\n                      <Button variant=\"ghost\" size=\"sm\" onClick={() => startEditing(todo)} className=\"h-8 w-8 p-0 text-muted-foreground hover:text-foreground\">\n                        <Edit className=\"h-4 w-4\" />\n                      </Button>\n                      <Button variant=\"ghost\" size=\"sm\" onClick={() => handleDeleteTodo(todo.id)} className=\"h-8 w-8 p-0 text-muted-foreground hover:text-destructive\">\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>}\n                </div>)}\n            </div>\n          </> : <div className=\"text-center py-6\">\n            <CheckSquare className=\"h-8 w-8 text-muted-foreground mx-auto mb-2\" />\n            <p className=\"text-muted-foreground text-sm\">{tForms('todos.no_todos')}</p>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {tForms('todos.add_first_todo')}\n            </p>\n          </div>}\n      </CardContent>\n    </Card>;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProjectTypeSelector.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2167,2170],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2167,2170],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchProjectTypes'. Either include it or remove the dependency array.","line":77,"column":6,"nodeType":"ArrayExpression","endLine":77,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchProjectTypes]","fix":{"range":[2311,2313],"text":"[fetchProjectTypes]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Check, ChevronDown, Search } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useI18nToast } from \"@/lib/toastHelpers\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\n\ninterface ProjectType {\n  id: string;\n  name: string;\n  is_default: boolean;\n}\n\ninterface ProjectTypeSelectorProps {\n  value?: string;\n  onValueChange: (value: string, meta?: { isAutomatic?: boolean }) => void;\n  placeholder?: string;\n  disabled?: boolean;\n  className?: string;\n  required?: boolean;\n}\n\nexport function ProjectTypeSelector({ \n  value, \n  onValueChange, \n  placeholder = \"Select project type...\", \n  disabled = false,\n  className,\n  required = false\n}: ProjectTypeSelectorProps) {\n  const [types, setTypes] = useState<ProjectType[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [open, setOpen] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const toast = useI18nToast();\n\n  const fetchProjectTypes = async () => {\n    setLoading(true);\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) return;\n\n      const { data, error } = await supabase\n        .from('project_types')\n        .select('id, name, is_default')\n        .eq('organization_id', organizationId)\n        .order('is_default', { ascending: false }) // Default types first\n        .order('name', { ascending: true });\n\n      if (error) throw error;\n\n      setTypes(data || []);\n\n      // Auto-select default type if no value is set\n      if (!value && data && data.length > 0) {\n        const defaultType = data.find(type => type.is_default);\n        if (defaultType) {\n          onValueChange(defaultType.id, { isAutomatic: true });\n        }\n      }\n    } catch (error: any) {\n      toast.error(error.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchProjectTypes();\n  }, []);\n\n  const filteredTypes = types.filter(type =>\n    type.name.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const selectedType = types.find(type => type.id === value);\n\n  // Check if user has no project types\n  if (!loading && types.length === 0) {\n    return (\n      <div className=\"text-sm text-muted-foreground p-2 border rounded\">\n        No project types configured. Please add project types in Settings first.\n      </div>\n    );\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"outline\"\n          role=\"combobox\"\n          aria-expanded={open}\n          className={cn(\n            \"w-full justify-between text-left h-auto min-h-[40px]\",\n            !selectedType && \"text-muted-foreground\",\n            className\n          )}\n          disabled={disabled || loading}\n        >\n          {loading ? (\n            \"Loading types...\"\n          ) : selectedType ? (\n            <div className=\"flex items-center gap-2\">\n              <Badge \n                variant={selectedType.is_default ? \"default\" : \"secondary\"}\n                className=\"text-xs\"\n              >\n                {selectedType.name.toUpperCase()}\n              </Badge>\n              {selectedType.is_default && (\n                <span className=\"text-xs text-muted-foreground\">(Default)</span>\n              )}\n            </div>\n          ) : (\n            placeholder\n          )}\n          <ChevronDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-full p-0 z-50 bg-popover\" align=\"start\">\n        <div className=\"p-3 border-b\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4\" />\n            <Input\n              placeholder=\"Search project types...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-10\"\n              autoFocus\n            />\n          </div>\n        </div>\n        <div className=\"max-h-64 overflow-y-auto\">\n          <div className=\"py-1\">\n            {loading ? (\n              <div className=\"p-4 text-center text-sm text-muted-foreground\">\n                Loading project types...\n              </div>\n            ) : filteredTypes.length === 0 ? (\n              <div className=\"p-4 text-center text-sm text-muted-foreground\">\n                {searchTerm ? 'No types match your search' : 'No project types found'}\n              </div>\n            ) : (\n              filteredTypes.map((type) => (\n                <div\n                  key={type.id}\n                  onClick={() => {\n                    onValueChange(type.id);\n                    setOpen(false);\n                    setSearchTerm(\"\");\n                  }}\n                  className={cn(\n                    \"flex items-center justify-between p-3 hover:bg-muted/50 cursor-pointer border-b last:border-b-0\",\n                    value === type.id && \"bg-muted\"\n                  )}\n                >\n                  <div className=\"flex items-center space-x-3\">\n                    <Check\n                      className={cn(\n                        \"h-4 w-4\",\n                        value === type.id ? \"opacity-100\" : \"opacity-0\"\n                      )}\n                    />\n                    <div className=\"flex items-center gap-2\">\n                      <Badge \n                        variant={type.is_default ? \"default\" : \"secondary\"}\n                        className=\"text-xs\"\n                      >\n                        {type.name.toUpperCase()}\n                      </Badge>\n                      {type.is_default && (\n                        <span className=\"text-xs text-muted-foreground\">(Default)</span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              ))\n            )}\n          </div>\n        </div>\n      </PopoverContent>\n    </Popover>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProjectTypesSection.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'createDefaultTypes'. Either include it or remove the dependency array.","line":82,"column":6,"nodeType":"ArrayExpression","endLine":82,"endColumn":65,"suggestions":[{"desc":"Update the dependencies array to be: [isLoading, orgLoading, activeOrganizationId, types.length, createDefaultTypes]","fix":{"range":[3235,3294],"text":"[isLoading, orgLoading, activeOrganizationId, types.length, createDefaultTypes]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Plus, Trash2, Loader2, Check } from \"lucide-react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useI18nToast } from \"@/lib/toastHelpers\";\nimport { AddProjectTypeDialog, EditProjectTypeDialog } from \"./settings/ProjectTypeDialogs\";\nimport { cn } from \"@/lib/utils\";\nimport SettingsSection from \"./SettingsSection\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\nimport { useProjectTypes } from \"@/hooks/useOrganizationData\";\nimport { FormLoadingSkeleton } from \"@/components/ui/loading-presets\";\nimport { useTranslation } from \"react-i18next\";\nimport { useMessagesTranslation } from \"@/hooks/useTypedTranslation\";\n\nconst projectTypeSchema = z.object({\n  name: z.string().min(1, \"Type name is required\").max(50, \"Type name must be less than 50 characters\"),\n  is_default: z.boolean().default(false),\n});\n\ntype ProjectTypeForm = z.infer<typeof projectTypeSchema>;\n\ninterface ProjectType {\n  id: string;\n  name: string;\n  is_default: boolean;\n  created_at: string;\n  updated_at: string;\n}\n\nconst ProjectTypesSection = () => {\n  const [editingType, setEditingType] = useState<ProjectType | null>(null);\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [submitting, setSubmitting] = useState(false);\n  const toast = useI18nToast();\n  const { activeOrganizationId, loading: orgLoading } = useOrganization();\n  const { data: types = [], isLoading, refetch } = useProjectTypes();\n  const { t } = useTranslation('forms');\n  const { t: tMessages } = useMessagesTranslation();\n\n  const form = useForm<ProjectTypeForm>({\n    resolver: zodResolver(projectTypeSchema),\n    defaultValues: {\n      name: \"\",\n      is_default: false,\n    },\n  });\n\n  const createDefaultTypes = async () => {\n    try {\n      if (!activeOrganizationId) return;\n      \n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n\n      await supabase.rpc('ensure_default_project_types_for_org', {\n        user_uuid: user.id,\n        org_id: activeOrganizationId\n      });\n\n      // Refetch data after creating defaults\n      await refetch();\n    } catch (error) {\n      console.error('Error creating default types:', error);\n      toast.error(\"Failed to create default types\");\n    }\n  };\n\n  // Create default types if none exist\n  useEffect(() => {\n    if (!isLoading && !orgLoading && activeOrganizationId && types.length === 0) {\n      createDefaultTypes();\n    }\n  }, [isLoading, orgLoading, activeOrganizationId, types.length]);\n\n  const onSubmit = async (data: ProjectTypeForm) => {\n    if (!activeOrganizationId) {\n      toast.error(\"No active organization found\");\n      return;\n    }\n\n    setSubmitting(true);\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Not authenticated');\n\n      if (editingType) {\n        // Update existing type\n        const { error } = await supabase\n          .from('project_types')\n          .update({ name: data.name, is_default: data.is_default })\n          .eq('id', editingType.id)\n          .eq('organization_id', activeOrganizationId);\n\n        if (error) {\n          console.error('Error updating type:', error);\n          throw error;\n        }\n\n        // Show appropriate message based on what changed\n        if (data.is_default && !editingType.is_default) {\n          toast.success(`\"${data.name}\" is now the default project type`);\n        } else {\n          toast.success(\"Project type updated successfully\");\n        }\n        setIsEditDialogOpen(false);\n      } else {\n        // Create new type\n        const { error } = await supabase\n          .from('project_types')\n          .insert({\n            name: data.name,\n            is_default: data.is_default,\n            user_id: user.id,\n            organization_id: activeOrganizationId,\n          });\n\n        if (error) {\n          if (error.code === '23505') { // Unique constraint violation\n            throw new Error('A type with this name already exists');\n          }\n          throw error;\n        }\n\n        toast.success(data.is_default ? `\"${data.name}\" created and set as default` : \"Project type created successfully\");\n        setIsAddDialogOpen(false);\n      }\n\n      form.reset({ name: \"\", is_default: false });\n      setEditingType(null);\n      await refetch(); // Refetch data after changes\n    } catch (error) {\n      console.error('Error saving project type:', error);\n      toast.error(error instanceof Error ? error.message : \"Failed to save project type\");\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleEdit = (type: ProjectType) => {\n    setEditingType(type);\n    form.reset({ name: type.name, is_default: type.is_default });\n    setIsEditDialogOpen(true);\n  };\n\n  const handleAdd = () => {\n    setEditingType(null);\n    form.reset({ name: \"\", is_default: false });\n    setIsAddDialogOpen(true);\n  };\n\n  const handleDelete = async (typeId: string) => {\n    if (!activeOrganizationId) return;\n    \n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Not authenticated');\n\n      const { error } = await supabase\n        .from('project_types')\n        .delete()\n        .eq('id', typeId)\n        .eq('organization_id', activeOrganizationId);\n\n      if (error) {\n        if (error.code === '23503') { // Foreign key constraint violation\n          throw new Error('Cannot delete this type because it is being used by existing projects. Please change those projects to a different type first.');\n        }\n        throw error;\n      }\n\n      toast.success(\"Project type deleted successfully\");\n      await refetch(); // Refetch data after deletion\n    } catch (error) {\n      console.error('Error deleting project type:', error);\n      toast.error(error instanceof Error ? error.message : \"Failed to delete project type\");\n    }\n  };\n\n  const renderTypeDialog = (isEdit: boolean) => (\n    <DialogContent className=\"sm:max-w-md\">\n      <DialogHeader>\n        <DialogTitle className=\"text-lg font-medium\">\n          {isEdit ? 'EDIT TYPE' : 'ADD TYPE'}\n        </DialogTitle>\n      </DialogHeader>\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n          <FormField\n            control={form.control}\n            name=\"name\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel className=\"text-sm font-medium\">Name</FormLabel>\n                <FormControl>\n                  <Input \n                    placeholder={isEdit ? \"\" : \"e.g. Corporate, Wedding, Portrait\"} \n                    {...field} \n                    className=\"mt-1\"\n                  />\n                </FormControl>\n                <FormMessage />\n                {!isEdit && (\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    Customize your project types to reflect the type of work you offer.\n                  </p>\n                )}\n              </FormItem>\n            )}\n          />\n          \n          <FormField\n            control={form.control}\n            name=\"is_default\"\n            render={({ field }) => (\n              <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                <FormControl>\n                  <Checkbox\n                    checked={field.value}\n                    onCheckedChange={field.onChange}\n                  />\n                </FormControl>\n                <div className=\"space-y-1 leading-none\">\n                  <FormLabel className=\"text-sm font-medium\">\n                    Set as default\n                  </FormLabel>\n                  <p className=\"text-xs text-muted-foreground\">\n                    This type will be pre-selected when creating new projects.\n                  </p>\n                </div>\n              </FormItem>\n            )}\n          />\n          \n          <div className=\"flex justify-between items-center pt-4\">\n            {isEdit && editingType && !editingType.is_default && (\n              <AlertDialog>\n                <AlertDialogTrigger asChild>\n                  <Button type=\"button\" variant=\"destructive\">\n                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                    Delete\n                  </Button>\n                </AlertDialogTrigger>\n                <AlertDialogContent>\n                  <AlertDialogHeader>\n                    <AlertDialogTitle>Delete Project Type</AlertDialogTitle>\n                    <AlertDialogDescription>\n                      {tMessages('confirm.deleteWithName', { name: editingType?.name })} {tMessages('confirm.cannotUndo')}\n                    </AlertDialogDescription>\n                  </AlertDialogHeader>\n                  <AlertDialogFooter>\n                    <AlertDialogCancel>Cancel</AlertDialogCancel>\n                    <AlertDialogAction\n                      onClick={() => {\n                        if (editingType) {\n                          handleDelete(editingType.id);\n                          setIsEditDialogOpen(false);\n                        }\n                      }}\n                      className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                    >\n                      Delete\n                    </AlertDialogAction>\n                  </AlertDialogFooter>\n                </AlertDialogContent>\n              </AlertDialog>\n            )}\n            \n            {isEdit && editingType && editingType.is_default && (\n              <p className=\"text-sm text-muted-foreground\">\n                The default type cannot be deleted. Set another type as default first.\n              </p>\n            )}\n            \n            <div className=\"flex gap-2 ml-auto\">\n              <Button \n                type=\"button\" \n                variant=\"outline\" \n                onClick={() => isEdit ? setIsEditDialogOpen(false) : setIsAddDialogOpen(false)}\n              >\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={submitting}>\n                {submitting ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                    {isEdit ? 'Saving...' : 'Adding...'}\n                  </>\n                ) : (\n                  isEdit ? 'Save' : 'Add'\n                )}\n              </Button>\n            </div>\n          </div>\n        </form>\n      </Form>\n    </DialogContent>\n  );\n\n  const handleRefetch = async () => {\n    await refetch();\n  };\n\n  if (orgLoading || isLoading) {\n    return (\n      <SettingsSection \n        title={t('project_types.title')}\n        description={t('project_types.description')}\n      >\n        <FormLoadingSkeleton rows={3} />\n      </SettingsSection>\n    );\n  }\n\n  return (\n    <>\n      <SettingsSection \n        title={t('project_types.title')}\n        description={t('project_types.description')}\n        action={{\n          label: t('project_types.add_type'),\n          onClick: handleAdd,\n          icon: <Plus className=\"h-4 w-4\" />\n        }}\n      >\n        <div className=\"flex flex-wrap gap-3 p-2\">\n          {types.map((type) => (\n            <div\n              key={type.id}\n              className={cn(\n                \"inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium transition-all select-none border cursor-pointer hover:opacity-80\",\n                type.is_default \n                  ? \"bg-primary/10 border-primary/20 text-primary\" \n                  : \"bg-muted/50 border-muted text-muted-foreground hover:bg-muted/70\"\n              )}\n              onClick={() => handleEdit(type)}\n            >\n              <span className=\"uppercase tracking-wide font-semibold\">\n                {type.name}\n              </span>\n              {type.is_default && (\n                <Check className=\"w-3 h-3 text-primary\" />\n              )}\n            </div>\n          ))}\n        </div>\n\n        {/* Add Dialog */}\n        <AddProjectTypeDialog\n          open={isAddDialogOpen}\n          onOpenChange={setIsAddDialogOpen}\n          onTypeAdded={handleRefetch}\n        />\n\n        {/* Edit Dialog */}\n        <EditProjectTypeDialog\n          type={editingType}\n          open={isEditDialogOpen}\n          onOpenChange={setIsEditDialogOpen}\n          onTypeUpdated={handleRefetch}\n        />\n      </SettingsSection>\n    </>\n  );\n};\n\nexport default ProjectTypesSection;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProjectsSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3494,3497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3494,3497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchProjects'. Either include it or remove the dependency array.","line":111,"column":6,"nodeType":"ArrayExpression","endLine":111,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchProjects, leadId]","fix":{"range":[3933,3941],"text":"[fetchProjects, leadId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":178,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5721,5724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5721,5724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Plus } from \"lucide-react\";\nimport { ProjectCard } from \"./ProjectCard\";\nimport { ProjectSheetView } from \"./ProjectSheetView\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\nimport { ProjectCreationWizardSheet } from \"@/features/project-creation\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\n\ninterface Project {\n  id: string;\n  name: string;\n  description: string | null;\n  lead_id: string;\n  user_id: string;\n  created_at: string;\n  updated_at: string;\n  status_id?: string | null;\n}\n\ninterface ProjectsSectionProps {\n  leadId: string;\n  leadName?: string;\n  onProjectUpdated?: () => void;\n  onActivityUpdated?: () => void;\n  onProjectClicked?: () => void;\n}\n\nexport function ProjectsSection({ leadId, leadName = \"\", onProjectUpdated, onActivityUpdated, onProjectClicked }: ProjectsSectionProps) {\n  const { t } = useTranslation(['pages', 'common']);\n  const isMobile = useIsMobile();\n  const [projects, setProjects] = useState<Project[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n  const [projectToDelete, setProjectToDelete] = useState<Project | null>(null);\n  const [isDeleting, setIsDeleting] = useState(false);\n  const [showViewDialog, setShowViewDialog] = useState(false);\n  const [viewingProject, setViewingProject] = useState<Project | null>(null);\n  const [refreshTrigger, setRefreshTrigger] = useState(0);\n  const navigate = useNavigate();\n  \n  const [showArchived, setShowArchived] = useState(false);\n  const [hasArchived, setHasArchived] = useState(false);\n  const [archivedStatusId, setArchivedStatusId] = useState<string | null>(null);\n  const [userId, setUserId] = useState<string | null>(null);\n  const [isProjectWizardOpen, setProjectWizardOpen] = useState(false);\n  const { toast } = useToast();\n\n  const fetchProjects = async () => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n      setUserId(user.id);\n\n      // Get user's active organization ID\n      const { data: organizationId } = await supabase.rpc('get_user_active_organization_id');\n      if (!organizationId) return;\n\n      // Find archived status id (if any)\n      const { data: archived, error: archErr } = await supabase\n        .from('project_statuses')\n        .select('id')\n        .eq('organization_id', organizationId)\n        .ilike('name', 'archived')\n        .maybeSingle();\n      if (archErr) throw archErr;\n      const archivedId = archived?.id as string | undefined;\n      setArchivedStatusId(archivedId ?? null);\n\n      const { data, error } = await supabase\n        .from(\"projects\")\n        .select(\"*\")\n        .eq(\"lead_id\", leadId)\n        .eq(\"organization_id\", organizationId)\n        .order(\"created_at\", { ascending: false });\n\n      if (error) throw error;\n      const all = data || [];\n      const hasArch = archivedId ? all.some((p: any) => p.status_id === archivedId) : false;\n      setHasArchived(hasArch);\n      setProjects(all);\n    } catch (error) {\n      console.error(\"Error fetching projects:\", error);\n      toast({\n        variant: \"destructive\",\n        title: t('common:labels.error'),\n        description: t('pages:projects.failedToLoadProjects'),\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchProjects();\n  }, [leadId]);\n\n  // Persist \"Show archived\" preference per user\n  useEffect(() => {\n    (async () => {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n      const saved = localStorage.getItem(`crm:showArchivedProjects:${user.id}`);\n      if (saved !== null) setShowArchived(saved === 'true');\n    })();\n  }, []);\n\n  useEffect(() => {\n    if (!userId) return;\n    localStorage.setItem(`crm:showArchivedProjects:${userId}`, String(showArchived));\n  }, [showArchived, userId]);\n\n\n  const handleViewProject = (project: Project) => {\n    // Navigate to full project page instead of opening dialog\n    navigate(`/projects/${project.id}`);\n  };\n\n  const handleQuickViewProject = (project: Project) => {\n    if (isMobile) {\n      navigate(`/projects/${project.id}`);\n      return;\n    }\n    setViewingProject(project);\n    setShowViewDialog(true);\n    // Call tutorial callback immediately when project is clicked\n    if (onProjectClicked) {\n      // Project clicked, handling tutorial interaction\n      onProjectClicked();\n    }\n  };\n\n  const handleViewFullDetails = () => {\n    if (viewingProject) {\n      navigate(`/projects/${viewingProject.id}`);\n      setShowViewDialog(false);\n    }\n  };\n\n  const handleDeleteProject = (project: Project) => {\n    setProjectToDelete(project);\n    setShowDeleteDialog(true);\n  };\n\n  const confirmDelete = async () => {\n    if (!projectToDelete) return;\n\n    setIsDeleting(true);\n    try {\n      const { error } = await supabase\n        .from(\"projects\")\n        .delete()\n        .eq(\"id\", projectToDelete.id);\n\n      if (error) throw error;\n\n      toast({\n        title: t('messages:success.saved'),\n        description: t('pages:projects.projectDeletedSuccess'),\n      });\n\n      fetchProjects();\n    } catch (error: any) {\n      toast({\n        title: t('pages:projects.errorDeletingProject'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsDeleting(false);\n      setShowDeleteDialog(false);\n      setProjectToDelete(null);\n    }\n  };\n\n  const handleWizardProjectCreated = () => {\n    fetchProjects();\n    setRefreshTrigger((prev) => prev + 1);\n    onProjectUpdated?.();\n  };\n\n  const archivedId = archivedStatusId;\n  const activeProjects = archivedId ? projects.filter((p) => p.status_id !== archivedId) : projects;\n  const archivedProjects = archivedId ? projects.filter((p) => p.status_id === archivedId) : [];\n\n  return (\n    <>\n      <ProjectCreationWizardSheet\n        isOpen={isProjectWizardOpen}\n        onOpenChange={setProjectWizardOpen}\n        leadId={leadId}\n        leadName={leadName}\n        entrySource=\"dashboard_projects\"\n        onProjectCreated={handleWizardProjectCreated}\n      />\n\n      <Card className=\"w-full\">\n      <CardHeader className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between space-y-0 pb-4\">\n        <CardTitle className=\"text-xl font-semibold\">{t('pages:projects.title')}</CardTitle>\n        <div className=\"flex flex-col gap-3 w-full md:w-auto md:flex-row md:items-center\">\n          {hasArchived && (\n            <div className=\"flex items-center justify-between md:justify-start gap-2 text-sm text-muted-foreground\">\n              <span className=\"flex-shrink-0\">{t('pages:projects.showArchived')}</span>\n              <Switch checked={showArchived} onCheckedChange={(v) => setShowArchived(v)} />\n            </div>\n          )}\n          {projects.length > 0 && (\n            <Button\n              size=\"sm\"\n              className=\"w-full md:w-auto\"\n              onClick={() => setProjectWizardOpen(true)}\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              {t('pages:projects.addProject')}\n            </Button>\n          )}\n        </div>\n      </CardHeader>\n      <CardContent>\n        {isLoading ? (\n          <div className=\"space-y-4\">\n            {[1, 2].map((i) => (\n              <div key={i} className=\"animate-pulse border rounded-lg p-4 space-y-3\">\n                <div className=\"h-4 bg-muted rounded w-3/4\"></div>\n                <div className=\"h-3 bg-muted rounded w-1/2\"></div>\n                <div className=\"h-3 bg-muted rounded w-2/3\"></div>\n              </div>\n            ))}\n          </div>\n        ) : projects.length === 0 ? (\n          <div className=\"text-center text-muted-foreground py-8\">\n            <p className=\"mb-4\">{t('pages:projects.noProjectsYet')}</p>\n            <Button\n              variant=\"outline\"\n              onClick={() => setProjectWizardOpen(true)}\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              {t('pages:projects.addProject')}\n            </Button>\n          </div>\n        ) : (\n          <div className=\"space-y-6\">\n            <div className=\"space-y-4\">\n              {activeProjects.map((project) => (\n                <ProjectCard\n                  key={project.id}\n                  project={project}\n                  onView={handleViewProject}\n                  onQuickView={handleQuickViewProject}\n                  refreshTrigger={refreshTrigger}\n                />\n              ))}\n            </div>\n            {hasArchived && showArchived && archivedProjects.length > 0 && (\n              <div className=\"space-y-3\">\n                <h3 className=\"text-sm font-medium text-muted-foreground\">{t('pages:projects.archivedProjects')}</h3>\n                <div className=\"space-y-4\">\n                  {archivedProjects.map((project) => (\n                    <ProjectCard\n                      key={project.id}\n                      project={project}\n                      onView={handleViewProject}\n                      onQuickView={handleQuickViewProject}\n                      refreshTrigger={refreshTrigger}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n      </CardContent>\n\n\n\n      <ProjectSheetView\n        project={viewingProject}\n        open={showViewDialog}\n        onOpenChange={(open) => {\n          setShowViewDialog(open);\n        }}\n        onProjectUpdated={() => {\n          fetchProjects();\n          setRefreshTrigger(prev => prev + 1); // Force refresh progress bars\n          onProjectUpdated?.(); // Notify parent component about project update\n        }}\n        onActivityUpdated={onActivityUpdated}\n        leadName={leadName}\n        mode=\"sheet\"\n        onViewFullDetails={handleViewFullDetails}\n      />\n\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{t('pages:projects.deleteProject')}</AlertDialogTitle>\n            <AlertDialogDescription>\n              {t('pages:projects.deleteProjectConfirm')}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel disabled={isDeleting}>{t('common:buttons.cancel')}</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={confirmDelete}\n              disabled={isDeleting}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {isDeleting ? t('pages:projects.deleting') : t('common:buttons.delete')}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </Card>\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ProtectedRoute.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ReminderCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/RestartGuidedModeButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/RoutePrefetcher.tsx","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":15,"column":11,"nodeType":"BlockStatement","messageId":"unexpected","endLine":15,"endColumn":13,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[615,615],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2012,2015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2012,2015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":61,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":61,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2127,2127],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2748,2751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2748,2751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":85,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":85,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2863,2863],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":106,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":106,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3590,3590],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useEffect, useRef } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useOrganization } from '@/contexts/OrganizationContext';\n\n// Lightweight route-aware prefetcher for first pages of common lists\n// Stores results in localStorage for hooks to bootstrap from.\nconst TTL_MS = 60 * 1000; // 1 minute\n\nfunction setLS(key: string, value: unknown) {\n  if (typeof window === 'undefined') return;\n  try {\n    const payload = { ts: Date.now(), value };\n    localStorage.setItem(key, JSON.stringify(payload));\n  } catch {}\n}\n\nexport default function RoutePrefetcher() {\n  const { pathname } = useLocation();\n  const { activeOrganizationId } = useOrganization();\n  const inFlightRef = useRef<Set<string>>(new Set());\n\n  const hasFreshCache = useCallback((key: string) => {\n    if (typeof window === 'undefined') return false;\n    try {\n      const raw = localStorage.getItem(key);\n      if (!raw) return false;\n      const parsed = JSON.parse(raw) as { ts?: number; value?: { ttl?: number } };\n      const ts = parsed?.ts ?? 0;\n      const ttl = parsed?.value?.ttl ?? TTL_MS;\n      return ts > 0 && Date.now() - ts < ttl;\n    } catch {\n      return false;\n    }\n  }, []);\n\n  useEffect(() => {\n    const orgId = activeOrganizationId;\n    if (!orgId) return;\n\n    const doProjects = async () => {\n      const k = `prefetch:projects:first:${orgId}:active`;\n      if (inFlightRef.current.has(k)) return;\n      // Skip network prefetch if cached value is still fresh\n      if (hasFreshCache(k)) return;\n      inFlightRef.current.add(k);\n      try {\n        const { data, error } = await supabase.rpc('projects_filter_page', {\n          org: orgId,\n          p_page: 1,\n          p_size: 25,\n          p_sort_field: 'created_at',\n          p_sort_dir: 'desc',\n          p_scope: 'active',\n          p_filters: {},\n        });\n        if (!error && Array.isArray(data)) {\n          const total = data.length ? Number((data as any[])[0].total_count ?? 0) : 0;\n          setLS(k, { items: data, total, ttl: TTL_MS });\n        }\n      } catch {}\n      finally {\n        inFlightRef.current.delete(k);\n      }\n    };\n\n    const doLeads = async () => {\n      const k = `prefetch:leads:first:${orgId}`;\n      if (inFlightRef.current.has(k)) return;\n      inFlightRef.current.add(k);\n      try {\n        const { data, error } = await supabase.rpc('leads_filter_page', {\n          org: orgId,\n          p_page: 1,\n          p_size: 25,\n          p_sort_field: 'updated_at',\n          p_sort_dir: 'desc',\n          p_status_ids: null,\n          p_filters: {},\n        });\n        if (!error && Array.isArray(data)) {\n          const total = data.length ? Number((data as any[])[0].total_count ?? 0) : 0;\n          setLS(k, { items: data, total, ttl: TTL_MS });\n        }\n      } catch {}\n      finally {\n        inFlightRef.current.delete(k);\n      }\n    };\n\n    const doLeadsMetrics = async () => {\n      const k = `prefetch:leads:metrics:${orgId}`;\n      if (inFlightRef.current.has(k)) return;\n      inFlightRef.current.add(k);\n      try {\n        const since = new Date();\n        since.setDate(since.getDate() - 60);\n        const { data, error } = await supabase\n          .from('leads')\n          .select(`id, created_at, updated_at, status, lead_statuses ( id, name, color, is_system_final )`)\n          .eq('organization_id', orgId)\n          .gte('created_at', since.toISOString());\n        if (!error && Array.isArray(data)) {\n          setLS(k, { items: data, ttl: TTL_MS });\n        }\n      } catch {}\n      finally {\n        inFlightRef.current.delete(k);\n      }\n    };\n\n    if (pathname.startsWith('/projects')) doProjects();\n    if (pathname.startsWith('/leads')) { doLeads(); doLeadsMetrics(); }\n  }, [pathname, activeOrganizationId, hasFreshCache]);\n\n  return null;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/SampleDataModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ScheduleSessionDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ServiceInventorySelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ServicePicker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ServiceSelector.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchServices'. Either include it or remove the dependency array.","line":66,"column":6,"nodeType":"ArrayExpression","endLine":66,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchServices]","fix":{"range":[2075,2077],"text":"[fetchServices]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Check, ChevronDown, X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Label } from \"@/components/ui/label\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useI18nToast } from \"@/lib/toastHelpers\";\n\ninterface Service {\n  id: string;\n  name: string;\n  category: string | null;\n  cost_price?: number;\n  selling_price?: number;\n}\n\ninterface ServiceSelectorProps {\n  projectId?: string;\n  selectedServices: Service[];\n  onServicesChange: (services: Service[]) => void;\n  disabled?: boolean;\n}\n\nexport function ServiceSelector({ \n  projectId, \n  selectedServices, \n  onServicesChange, \n  disabled = false \n}: ServiceSelectorProps) {\n  const [availableServices, setAvailableServices] = useState<Service[]>([]);\n  const [isOpen, setIsOpen] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const toast = useI18nToast();\n\n  const fetchServices = async () => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n\n      // Get user's active organization ID\n      const { data: organizationId } = await supabase.rpc('get_user_active_organization_id');\n      if (!organizationId) return;\n\n      const { data, error } = await supabase\n        .from(\"services\")\n        .select(\"id, name, category, cost_price, selling_price\")\n        .eq(\"organization_id\", organizationId)\n        .order(\"category\", { ascending: true })\n        .order(\"name\", { ascending: true });\n\n      if (error) throw error;\n      setAvailableServices(data || []);\n    } catch (error) {\n      console.error(\"Error fetching services:\", error);\n      toast.error(\"Failed to load available services.\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchServices();\n  }, []);\n\n  const groupedServices = availableServices.reduce((groups, service) => {\n    const category = service.category || \"Uncategorized\";\n    if (!groups[category]) {\n      groups[category] = [];\n    }\n    groups[category].push(service);\n    return groups;\n  }, {} as Record<string, Service[]>);\n\n  const handleServiceToggle = (service: Service) => {\n    const isSelected = selectedServices.some(s => s.id === service.id);\n    \n    if (isSelected) {\n      onServicesChange(selectedServices.filter(s => s.id !== service.id));\n    } else {\n      onServicesChange([...selectedServices, service]);\n    }\n  };\n\n  const removeService = (serviceId: string) => {\n    onServicesChange(selectedServices.filter(s => s.id !== serviceId));\n  };\n\n  if (loading) {\n    return (\n      <div className=\"space-y-2\">\n        <Label>Services</Label>\n        <div className=\"w-full h-10 bg-muted animate-pulse rounded-md\" />\n      </div>\n    );\n  }\n\n  if (availableServices.length === 0) {\n    return (\n      <div className=\"space-y-2\">\n        <p className=\"text-sm text-muted-foreground\">\n          No services defined yet. Go to Settings â†’ Services to add your offerings.\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      <Label>Services</Label>\n      <Popover open={isOpen} onOpenChange={setIsOpen}>\n        <PopoverTrigger asChild>\n          <Button\n            variant=\"outline\"\n            role=\"combobox\"\n            aria-expanded={isOpen}\n            className=\"w-full justify-between h-auto min-h-10 p-2\"\n            disabled={disabled}\n          >\n            <div className=\"flex flex-wrap gap-1 flex-1\">\n              {selectedServices.length === 0 ? (\n                <span className=\"text-muted-foreground\">Select services provided</span>\n              ) : (\n                selectedServices.map((service) => (\n                  <Badge\n                    key={service.id}\n                    variant=\"secondary\"\n                    className=\"text-xs\"\n                  >\n                    {service.name}\n                    <button\n                      className=\"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\"\n                      onKeyDown={(e) => {\n                        if (e.key === \"Enter\") {\n                          removeService(service.id);\n                        }\n                      }}\n                      onMouseDown={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                      }}\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        removeService(service.id);\n                      }}\n                    >\n                      <X className=\"h-3 w-3 text-muted-foreground hover:text-foreground\" />\n                    </button>\n                  </Badge>\n                ))\n              )}\n            </div>\n            <ChevronDown className=\"h-4 w-4 shrink-0 opacity-50\" />\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-[400px] p-0\" align=\"start\">\n          <ScrollArea className=\"max-h-60\">\n            <div className=\"p-4 space-y-3\">\n              {Object.entries(groupedServices).map(([category, services], categoryIndex) => (\n                <div key={category}>\n                  {categoryIndex > 0 && <Separator className=\"my-2\" />}\n                  <div className=\"space-y-2\">\n                    <h4 className=\"text-sm font-medium text-muted-foreground px-2\">\n                      {category}\n                    </h4>\n                    <div className=\"space-y-1\">\n                      {services.map((service) => {\n                        const isSelected = selectedServices.some(s => s.id === service.id);\n                        return (\n                          <div\n                            key={service.id}\n                            className=\"flex items-center space-x-2 p-2 rounded-md hover:bg-accent cursor-pointer\"\n                            onClick={() => handleServiceToggle(service)}\n                          >\n                            <div className=\"flex items-center space-x-2 flex-1\">\n                              <div className=\"w-4 h-4 border border-primary rounded-sm flex items-center justify-center\">\n                                {isSelected && <Check className=\"h-3 w-3\" />}\n                              </div>\n                              <div className=\"flex-1\">\n                                <span className=\"text-sm\">{service.name}</span>\n                                {((service.cost_price || 0) > 0 || (service.selling_price || 0) > 0) && (\n                                  <div className=\"flex gap-3 mt-1\">\n                                    {(service.cost_price || 0) > 0 && (\n                                      <span className=\"text-xs text-muted-foreground\">\n                                        Cost: TRY {service.cost_price}\n                                      </span>\n                                    )}\n                                    {(service.selling_price || 0) > 0 && (\n                                      <span className=\"text-xs text-muted-foreground\">\n                                        Selling: TRY {service.selling_price}\n                                      </span>\n                                    )}\n                                  </div>\n                                )}\n                              </div>\n                            </div>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </ScrollArea>\n        </PopoverContent>\n      </Popover>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ServicesSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/SessionBanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/SessionFormFields.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/SessionGallery.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/SessionSchedulingSheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/SessionSheetView.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":109,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3756,3759],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3756,3759],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSession'. Either include it or remove the dependency array.","line":124,"column":6,"nodeType":"ArrayExpression","endLine":124,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSession, isOpen, sessionId]","fix":{"range":[4088,4107],"text":"[fetchSession, isOpen, sessionId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":232,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8204,8207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8204,8207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo, useCallback } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { ExternalLink, AlertTriangle, Calendar as CalendarIcon, ChevronDown, Pencil, Trash2 } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { DropdownMenu, DropdownMenuTrigger, DropdownMenuContent, DropdownMenuItem } from '@/components/ui/dropdown-menu';\nimport { Sheet, SheetContent } from '@/components/ui/sheet';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '@/components/ui/alert-dialog';\nimport SessionStatusBadge from '@/components/SessionStatusBadge';\nimport { isOverdueSession } from '@/lib/dateUtils';\nimport EditSessionDialog from '@/components/EditSessionDialog';\nimport type { SessionPlanningStepId } from '@/features/session-planning';\nimport { useSessionActions } from '@/hooks/useSessionActions';\nimport { UnifiedClientDetails } from '@/components/UnifiedClientDetails';\nimport SessionGallery from '@/components/SessionGallery';\nimport { getDisplaySessionName } from '@/lib/sessionUtils';\nimport { useFormsTranslation, useMessagesTranslation } from '@/hooks/useTypedTranslation';\nimport { EntityHeader } from '@/components/EntityHeader';\nimport { buildSessionSummaryItems } from '@/lib/sessions/buildSessionSummaryItems';\nimport { useIsMobile } from \"@/hooks/use-mobile\";\ninterface SessionData {\n  id: string;\n  session_name?: string | null;\n  session_date: string;\n  session_time: string;\n  notes: string | null;\n  location: string | null;\n  status: string;\n  lead_id: string;\n  project_id: string | null;\n  user_id: string;\n  google_event_id?: string | null; // Make optional since it's not always returned\n  leads?: {\n    id: string;\n    name: string;\n    email?: string | null;\n    phone?: string | null;\n    notes?: string | null;\n  };\n  projects?: {\n    id: string;\n    name: string;\n    project_types?: {\n      name: string;\n    };\n  };\n}\ninterface SessionSheetViewProps {\n  sessionId: string;\n  isOpen: boolean;\n  onOpenChange: (open: boolean) => void;\n  onViewFullDetails: () => void;\n  onNavigateToLead?: (leadId: string) => void;\n  onNavigateToProject?: (projectId: string) => void;\n  onSessionUpdated?: () => void; // Added callback for session updates\n}\nexport default function SessionSheetView({\n  sessionId,\n  isOpen,\n  onOpenChange,\n  onViewFullDetails,\n  onNavigateToLead,\n  onNavigateToProject,\n  onSessionUpdated\n}: SessionSheetViewProps) {\n  const {\n    toast\n  } = useToast();\n  const {\n    deleteSession\n  } = useSessionActions();\n  const {\n    t: tForms\n  } = useFormsTranslation();\n  const {\n    t: tMessages\n  } = useMessagesTranslation();\n  const isMobile = useIsMobile();\n  const [session, setSession] = useState<SessionData | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [editStartStep, setEditStartStep] = useState<SessionPlanningStepId | undefined>(undefined);\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\n  const fetchSession = async () => {\n    if (!sessionId) return;\n    try {\n      const {\n        data,\n        error\n      } = await supabase.from('sessions').select(`\n          *,\n          leads:lead_id (\n            id,\n            name,\n            email,\n            phone,\n            notes\n          ),\n          projects:project_id (\n            id,\n            name,\n            project_types (\n              name\n            )\n          )\n        `).eq('id', sessionId).single();\n      if (error) throw error;\n      setSession(data);\n    } catch (error: any) {\n      console.error('Error fetching session:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to load session details\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n  useEffect(() => {\n    if (isOpen && sessionId) {\n      fetchSession();\n    }\n  }, [isOpen, sessionId]);\n  const handleEdit = () => {\n    setEditStartStep(undefined);\n    setIsEditDialogOpen(true);\n  };\n  const handleDelete = async () => {\n    if (!session) return;\n    const success = await deleteSession(session.id);\n    if (success) {\n      onSessionUpdated?.(); // Notify parent to refresh\n      onOpenChange(false);\n    }\n  };\n  const handleSessionUpdated = () => {\n    fetchSession();\n    setIsEditDialogOpen(false);\n    setEditStartStep(undefined);\n    onSessionUpdated?.(); // Notify parent components\n  };\n  const handleStatusChange = () => {\n    fetchSession();\n    onSessionUpdated?.(); // Notify parent components\n  };\n  const handleLeadClick = useCallback(() => {\n    if (session?.lead_id && onNavigateToLead) {\n      onNavigateToLead(session.lead_id);\n      onOpenChange(false);\n    }\n  }, [onNavigateToLead, onOpenChange, session?.lead_id]);\n  const handleProjectClick = useCallback(() => {\n    if (session?.project_id && onNavigateToProject) {\n      onNavigateToProject(session.project_id);\n      onOpenChange(false);\n    }\n  }, [onNavigateToProject, onOpenChange, session?.project_id]);\n  const sessionTypeLabel = session?.projects?.project_types?.name || tForms('sessionBanner.session');\n  const sessionNameDisplay = session ? getDisplaySessionName(session) : '';\n\n  const openEditStep = useCallback(\n    (step: SessionPlanningStepId) => {\n      setEditStartStep(step);\n      setIsEditDialogOpen(true);\n    },\n    [setEditStartStep, setIsEditDialogOpen]\n  );\n\n  const summaryItems = useMemo(\n    () =>\n      session\n        ? buildSessionSummaryItems({\n            session,\n            labels: {\n              dateTime: tForms('sessionSheet.dateTime'),\n              project: tForms('sessionSheet.project'),\n              notes: tForms('sessionSheet.notes'),\n              location: tForms('sessionSheet.location'),\n            },\n            placeholders: {\n              project: tForms('sessionSheet.placeholders.project'),\n              notes: tForms('sessionSheet.placeholders.notes'),\n              location: tForms('sessionSheet.placeholders.location'),\n            },\n            actions: {\n              editSchedule: tForms('sessionSheet.actions.editSchedule'),\n              connectProject: tForms('sessionSheet.actions.connectProject'),\n              addNotes: tForms('sessionSheet.actions.addNotes'),\n              addLocation: tForms('sessionSheet.actions.addLocation'),\n            },\n            onProjectClick: session.project_id ? handleProjectClick : undefined,\n            onEditSchedule: () => openEditStep('schedule'),\n            onConnectProject: () => openEditStep('project'),\n            onAddNotes: () => openEditStep('notes'),\n            onAddLocation: () => openEditStep('location'),\n          })\n        : [],\n    [session, tForms, handleProjectClick, openEditStep]\n  );\n\n  const overdueBanner =\n    session && isOverdueSession(session.session_date, session.status) ? (\n      <div className=\"space-y-3 rounded-xl border border-orange-200 bg-orange-50 px-4 py-3 text-sm leading-relaxed text-orange-800\">\n        <div className=\"flex items-start gap-3\">\n          <AlertTriangle className=\"mt-0.5 h-4 w-4 text-orange-600\" aria-hidden=\"true\" />\n          <div className=\"space-y-1\">\n            <p className=\"font-semibold text-orange-900\">{tForms('sessionSheet.overdueWarning')}</p>\n            <p>{tForms('sessionSheet.overdueDescription')}</p>\n          </div>\n        </div>\n        <div className=\"pl-7\">\n          <Button\n            size=\"sm\"\n            variant=\"outline\"\n            className=\"border-orange-300 text-orange-700 hover:bg-orange-100 hover:text-orange-700\"\n            onClick={() => {\n              setEditStartStep('schedule');\n              setIsEditDialogOpen(true);\n            }}\n          >\n            {tForms('sessionSheet.overdueReschedule')}\n          </Button>\n        </div>\n      </div>\n    ) : undefined;\n\n  const renderSessionStatusBadge = (className?: string, size: \"sm\" | \"default\" = \"default\") =>\n    session ? (\n      <SessionStatusBadge\n        sessionId={session.id}\n        currentStatus={session.status as any}\n        editable={true}\n        onStatusChange={handleStatusChange}\n        size={size}\n        className={className}\n      />\n    ) : null;\n\n  const moreActionsButton = (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"min-w-[120px] justify-center gap-2 text-sm text-muted-foreground hover:bg-accent hover:text-accent-foreground sm:px-3\"\n        >\n          <span>{tForms('sessionSheet.more')}</span>\n          <ChevronDown className=\"h-4 w-4\" />\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\" side=\"bottom\" className=\"z-50 bg-background\">\n        <DropdownMenuItem role=\"menuitem\" onSelect={handleEdit}>\n          <Pencil className=\"mr-2 h-4 w-4\" />\n          <span>{tForms('sessionSheet.edit')}</span>\n        </DropdownMenuItem>\n        <DropdownMenuItem\n          role=\"menuitem\"\n          onSelect={() => setIsDeleteDialogOpen(true)}\n          className=\"hover:text-destructive focus:text-destructive\"\n        >\n          <Trash2 className=\"mr-2 h-4 w-4 text-destructive\" />\n          <span className=\"text-destructive\">{tForms('sessionSheet.deleteSession')}</span>\n        </DropdownMenuItem>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n\n  const headerActions = session ? (\n    <>\n      <Button\n        variant=\"outline\"\n        size=\"sm\"\n        onClick={onViewFullDetails}\n        className=\"w-full justify-center gap-2 text-sm font-medium hover:bg-accent sm:w-auto sm:px-4\"\n      >\n        <ExternalLink className=\"h-4 w-4\" />\n        <span className=\"text-sm\">{tForms('sessionSheet.fullDetails')}</span>\n      </Button>\n      {isMobile ? (\n        <div className=\"flex w-full flex-wrap items-center gap-2\">\n          <div className=\"flex-1 min-w-[160px]\">\n            {renderSessionStatusBadge(\"w-full h-9 justify-center\", \"sm\")}\n          </div>\n          {moreActionsButton}\n        </div>\n      ) : (\n        moreActionsButton\n      )}\n      <Button\n        variant=\"ghost\"\n        size=\"sm\"\n        onClick={() => onOpenChange(false)}\n        className=\"hidden justify-center text-sm text-muted-foreground hover:bg-accent hover:text-accent-foreground sm:inline-flex sm:w-auto sm:px-3\"\n      >\n        <span>{tForms('sessionSheet.close')}</span>\n      </Button>\n    </>\n  ) : undefined;\n\n  const headerTitle = session ? (\n    <span className=\"flex flex-col\">\n      <span className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\">\n        {sessionTypeLabel}\n      </span>\n      <span className=\"flex flex-wrap items-center gap-2 text-foreground\">\n        <span className=\"break-words text-pretty leading-tight\">{sessionNameDisplay}</span>\n        {!isMobile && renderSessionStatusBadge(\"text-xs sm:text-sm\")}\n      </span>\n    </span>\n  ) : undefined;\n  return <>\n      <Sheet open={isOpen} onOpenChange={onOpenChange}>\n        <SheetContent className=\"w-full h-[100vh] overflow-y-auto overscroll-contain pr-2 pt-8 sm:pt-6 sm:max-w-6xl lg:max-w-7xl\">\n          {loading ? <div className=\"p-6\">\n              <div className=\"animate-pulse space-y-4\">\n                <div className=\"h-6 bg-muted rounded w-1/3\"></div>\n                <div className=\"h-4 bg-muted rounded w-1/2\"></div>\n                <div className=\"h-32 bg-muted rounded\"></div>\n              </div>\n            </div> : session ? <>\n              <div className=\"space-y-6 pb-6\">\n                <EntityHeader\n                  name={sessionNameDisplay}\n                  title={headerTitle}\n                  summaryItems={summaryItems}\n                  banner={overdueBanner}\n                  actions={headerActions}\n                  avatarClassName=\"bg-gradient-to-br from-amber-300 via-orange-400 to-orange-500 text-white ring-0\"\n                  avatarContent={<CalendarIcon className=\"h-5 w-5 text-white\" aria-hidden=\"true\" />}\n                  fallbackInitials=\"SE\"\n                />\n\n                {/* Main Content Grid */}\n                <div className=\"grid grid-cols-12 gap-4 md:gap-6 w-full max-w-full overflow-hidden\">\n                  {/* Left summary column */}\n                  <aside className=\"col-span-12 lg:col-span-4 min-w-0\">\n                    <div className=\"h-fit space-y-4 w-full max-w-full\">\n                      {session.leads && (\n                        <UnifiedClientDetails\n                          lead={{\n                            id: session.leads.id,\n                            name: session.leads.name,\n                            email: session.leads.email,\n                            phone: session.leads.phone,\n                            notes: session.leads.notes,\n                          }}\n                          title={tForms('sessionSheet.clientDetails')}\n                          showQuickActions={true}\n                          showClickableNames={true}\n                          defaultExpanded={false}\n                          onNavigateToLead={handleLeadClick}\n                        />\n                      )}\n                    </div>\n                  </aside>\n\n                  {/* Right detail column */}\n                  <main className=\"col-span-12 lg:col-span-8 min-w-0\">\n                    <div className=\"space-y-6 md:space-y-8 w-full max-w-full\">\n                      <section className=\"scroll-mt-[88px] w-full max-w-full overflow-hidden\">\n                        <div className=\"w-full max-w-full\">\n                          <SessionGallery sessionId={session.id} />\n                        </div>\n                      </section>\n\n                      {/* Danger Zone */}\n                      <section className=\"scroll-mt-[88px] w-full max-w-full overflow-hidden\">\n                        <div className=\"rounded-lg border border-destructive/20 bg-destructive/5 p-6\">\n                          <div className=\"space-y-4\">\n                            <Button\n                              variant=\"outline\"\n                              onClick={() => setIsDeleteDialogOpen(true)}\n                              className=\"w-full border-destructive text-destructive hover:bg-destructive hover:text-destructive-foreground\"\n                              size=\"lg\"\n                            >\n                              {tForms('sessionSheet.deleteSession')}\n                            </Button>\n                            <p className=\"text-sm text-muted-foreground text-center\">\n                              {tForms('sessionSheet.deleteWarning')}\n                            </p>\n                          </div>\n                        </div>\n                      </section>\n                    </div>\n                  </main>\n                </div>\n              </div>\n            </> : <div className=\"p-6 text-center\">\n              <h3 className=\"text-lg font-semibold mb-2\">{tForms('sessions.sessionNotFound')}</h3>\n              <p className=\"text-muted-foreground\">{tForms('sessions.unableToLoadDetails')}</p>\n            </div>}\n        </SheetContent>\n      </Sheet>\n\n      {/* Edit Dialog */}\n      {session && isEditDialogOpen && (\n        <EditSessionDialog\n          open={isEditDialogOpen}\n          onOpenChange={(open) => {\n            if (!open) {\n              setEditStartStep(undefined);\n            }\n            setIsEditDialogOpen(open);\n          }}\n          sessionId={session.id}\n          leadId={session.lead_id}\n          currentDate={session.session_date}\n          currentTime={session.session_time}\n          currentNotes={session.notes || ''}\n          currentLocation={session.location || ''}\n          currentProjectId={session.project_id}\n          currentSessionName={session.session_name}\n          leadName={session.leads?.name || ''}\n          onSessionUpdated={handleSessionUpdated}\n          startStep={editStartStep}\n        />\n      )}\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{tForms('sessionSheet.deleteSession')}</AlertDialogTitle>\n            <AlertDialogDescription>\n              {tMessages('confirm.deleteSession')} {tMessages('confirm.cannotUndo')}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>{tForms('buttons.cancel')}</AlertDialogCancel>\n            <AlertDialogAction onClick={handleDelete} className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\">\n              {tForms('buttons.delete')}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/SessionStatusBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/SessionStatusesSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":160,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5925,5928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5925,5928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":198,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":198,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7133,7136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7133,7136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":204,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7324,7327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7324,7327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { DragDropContext, Droppable, Draggable } from \"@hello-pangea/dnd\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { GripVertical, Loader2, Plus, Trash2 } from \"lucide-react\";\nimport { useForm } from \"react-hook-form\";\nimport { z } from \"zod\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useI18nToast } from \"@/lib/toastHelpers\";\nimport { toast as toastFn } from \"@/hooks/use-toast\";\nimport { AddSessionStatusDialog, EditSessionStatusDialog } from \"./settings/SessionStatusDialogs\";\nimport { useSessionStatuses } from \"@/hooks/useOrganizationData\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\nimport { cn } from \"@/lib/utils\";\nimport SettingsSection from \"./SettingsSection\";\nimport { FormLoadingSkeleton } from \"@/components/ui/loading-presets\";\nimport { useTranslation } from \"react-i18next\";\nimport { useMessagesTranslation } from \"@/hooks/useTypedTranslation\";\n\nconst sessionStatusSchema = z.object({\n  name: z.string().min(1, \"Status name is required\").max(50, \"Status name must be less than 50 characters\"),\n  color: z.string().regex(/^#[0-9A-F]{6}$/i, \"Color must be a valid hex code\"),\n});\n\ntype SessionStatusForm = z.infer<typeof sessionStatusSchema>;\n\ninterface SessionStatus {\n  id: string;\n  user_id: string;\n  name: string;\n  color: string;\n  sort_order: number;\n  is_system_initial: boolean;\n  created_at: string;\n  updated_at: string;\n  lifecycle?: string;\n}\n\nconst PREDEFINED_COLORS = [\n  '#F56565', // Red\n  '#ED8936', // Orange\n  '#ECC94B', // Yellow\n  '#9AE6B4', // Light Green\n  '#48BB78', // Green\n  '#38B2AC', // Teal\n  '#63B3ED', // Light Blue\n  '#4299E1', // Blue\n  '#667EEA', // Indigo\n  '#9F7AEA', // Purple\n  '#ED64A6', // Pink\n  '#A0AEC0', // Gray\n];\n\nconst SessionStatusesSection = () => {\n  const [editingStatus, setEditingStatus] = useState<SessionStatus | null>(null);\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [submitting, setSubmitting] = useState(false);\n  const toast = useI18nToast();\n  const { activeOrganizationId } = useOrganization();\n  const { data: statuses = [], isLoading, refetch } = useSessionStatuses();\n  const { t } = useTranslation('forms');\n  const { t: tMessages } = useMessagesTranslation();\n\n  // Check for lifecycle completeness and show warnings\n  useEffect(() => {\n    if (statuses.length > 0 && !isLoading) {\n      const hasCompleted = statuses.some(s => s.lifecycle === 'completed');\n      const hasCancelled = statuses.some(s => s.lifecycle === 'cancelled');\n      \n      if (!hasCompleted || !hasCancelled) {\n        const timeoutId = setTimeout(() => {\n          toastFn({\n            title: \"Tip\",\n            description: \"Add at least one Completed and one Cancelled stage to unlock full automations.\",\n            variant: \"default\",\n            duration: 8000,\n          });\n        }, 1000);\n        \n        return () => clearTimeout(timeoutId);\n      }\n    }\n  }, [statuses, isLoading]);\n\n  const form = useForm<SessionStatusForm>({\n    resolver: zodResolver(sessionStatusSchema),\n    defaultValues: { name: \"\", color: PREDEFINED_COLORS[0] },\n  });\n\n  const selectedColor = form.watch(\"color\");\n\n  const isProtectedStatus = (status: SessionStatus | null) => {\n    if (!status) return false;\n    const n = status.name?.trim().toLowerCase();\n    return status.is_system_initial || n === 'completed' || n === 'cancelled';\n  };\n\n  const createDefaultStatuses = async () => {\n    if (!activeOrganizationId) return;\n    \n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n\n      await supabase.rpc('ensure_default_session_statuses', {\n        user_uuid: user.id\n      });\n\n      await refetch();\n    } catch (error) {\n      console.error('Error creating default session statuses:', error);\n      toast.error(\"Failed to create default session statuses\");\n    }\n  };\n\n  const onSubmit = async (data: SessionStatusForm) => {\n    setSubmitting(true);\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Not authenticated');\n\n      if (editingStatus) {\n        if (!activeOrganizationId) throw new Error('No organization found');\n\n        const { error } = await supabase\n          .from('session_statuses')\n          .update({ name: data.name, color: data.color })\n          .eq('id', editingStatus.id)\n          .eq('organization_id', activeOrganizationId);\n        if (error) throw error;\n        toast.success(\"Session stage updated\");\n        setIsEditDialogOpen(false);\n      } else {\n        const maxSortOrder = Math.max(...statuses.map(s => s.sort_order), 0);\n        if (!activeOrganizationId) throw new Error('No organization found');\n\n        const { error } = await supabase\n          .from('session_statuses')\n          .insert({ \n            name: data.name, \n            color: data.color, \n            user_id: user.id, \n            organization_id: activeOrganizationId,\n            sort_order: maxSortOrder + 1, \n            is_system_initial: false \n          });\n        if (error) throw error;\n        toast.success(\"Session stage created\");\n        setIsAddDialogOpen(false);\n      }\n\n      form.reset({ name: \"\", color: PREDEFINED_COLORS[0] });\n      setEditingStatus(null);\n      await refetch();\n    } catch (error: any) {\n      console.error('Error saving session status:', error);\n      toast.error(error?.message || 'Failed to save session stage');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleEdit = (status: SessionStatus) => {\n    setEditingStatus(status);\n    form.reset({ name: status.name, color: status.color });\n    setIsEditDialogOpen(true);\n  };\n\n  const handleAdd = () => {\n    setEditingStatus(null);\n    form.reset({ name: \"\", color: PREDEFINED_COLORS[0] });\n    setIsAddDialogOpen(true);\n  };\n\n  const handleDelete = async (status: SessionStatus) => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Not authenticated');\n      if (isProtectedStatus(status)) {\n        toast.error(`The \"${status.name}\" stage cannot be deleted`);\n        return;\n      }\n      if (!activeOrganizationId) throw new Error('No organization found');\n\n      const { error } = await supabase\n        .from('session_statuses')\n        .delete()\n        .eq('id', status.id)\n        .eq('organization_id', activeOrganizationId);\n      if (error) throw error;\n      toast.success(\"Session stage deleted\");\n      await refetch();\n    } catch (error: any) {\n      console.error('Error deleting session status:', error);\n      toast.error(error?.message || 'Failed to delete session stage');\n    }\n  };\n\n  const handleDragEnd = async (result: any) => {\n    if (!result.destination) return;\n    // For drag and drop with cached data, we need to update the server directly\n    // The refetch will update the local state\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Not authenticated');\n      if (!activeOrganizationId) throw new Error('No organization found');\n\n      const items = Array.from(statuses);\n      const [reordered] = items.splice(result.source.index, 1);\n      items.splice(result.destination.index, 0, reordered);\n\n      for (let i = 0; i < items.length; i++) {\n        const s = items[i];\n        const { error } = await supabase\n          .from('session_statuses')\n          .update({ sort_order: i + 1 })\n          .eq('id', s.id)\n          .eq('organization_id', activeOrganizationId);\n        if (error) throw error;\n      }\n      toast.success(\"Stage order updated\");\n      await refetch();\n    } catch (error) {\n      console.error('Error updating order:', error);\n      toast.error('Failed to update order');\n    }\n  };\n\n  const renderColorSwatches = (onSelect: (color: string) => void) => (\n    <div className=\"grid grid-cols-6 gap-2\">\n      {PREDEFINED_COLORS.map((color) => (\n        <button\n          key={color}\n          type=\"button\"\n          className={cn(\n            \"w-8 h-8 rounded-full border-2 transition-all hover:scale-110\",\n            selectedColor === color ? \"border-foreground ring-2 ring-offset-2 ring-foreground\" : \"border-muted\"\n          )}\n          style={{ backgroundColor: color }}\n          onClick={() => onSelect(color)}\n          title={color}\n        />\n      ))}\n    </div>\n  );\n\n  const renderStatusDialog = (isEdit: boolean) => (\n    <DialogContent className=\"sm:max-w-md\">\n      <DialogHeader>\n        <DialogTitle className=\"text-lg font-medium\">{isEdit ? 'EDIT STAGE' : 'ADD STAGE'}</DialogTitle>\n      </DialogHeader>\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n          <FormField\n            control={form.control}\n            name=\"name\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel className=\"text-sm font-medium\">Name</FormLabel>\n                <FormControl>\n                  <Input placeholder={isEdit ? \"\" : \"e.g. Confirmed, Completed, Delivered\"} {...field} className=\"mt-1\" />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"color\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel className=\"text-sm font-medium\">Stage Color</FormLabel>\n                <FormControl>\n                  <div className=\"mt-2\">{renderColorSwatches(field.onChange)}</div>\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <div className=\"flex justify-between items-center pt-4\">\n            {isEdit && editingStatus && isProtectedStatus(editingStatus) && (\n              <p className=\"text-sm text-muted-foreground\">The \"{editingStatus.name}\" stage cannot be deleted.</p>\n            )}\n\n            {isEdit && editingStatus && !isProtectedStatus(editingStatus) && (\n              <AlertDialog>\n                <AlertDialogTrigger asChild>\n                  <Button type=\"button\" variant=\"destructive\">\n                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                    Delete\n                  </Button>\n                </AlertDialogTrigger>\n                <AlertDialogContent>\n                  <AlertDialogHeader>\n                    <AlertDialogTitle>Delete Session Stage</AlertDialogTitle>\n                    <AlertDialogDescription>\n                      {tMessages('confirm.deleteWithName', { name: editingStatus?.name })} {tMessages('confirm.cannotUndo')}\n                    </AlertDialogDescription>\n                  </AlertDialogHeader>\n                  <AlertDialogFooter>\n                    <AlertDialogCancel>Cancel</AlertDialogCancel>\n                    <AlertDialogAction\n                      onClick={() => {\n                        if (editingStatus) {\n                          handleDelete(editingStatus);\n                          setIsEditDialogOpen(false);\n                        }\n                      }}\n                      className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                    >\n                      Delete\n                    </AlertDialogAction>\n                  </AlertDialogFooter>\n                </AlertDialogContent>\n              </AlertDialog>\n            )}\n\n            <div className=\"flex gap-2 ml-auto\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => (isEdit ? setIsEditDialogOpen(false) : setIsAddDialogOpen(false))}>\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={submitting}>\n                {submitting ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                    {isEdit ? 'Saving...' : 'Adding...'}\n                  </>\n                ) : (\n                  isEdit ? 'Save' : 'Add'\n                )}\n              </Button>\n            </div>\n          </div>\n        </form>\n      </Form>\n    </DialogContent>\n  );\n\n  // Create default statuses if none exist\n  if (!isLoading && activeOrganizationId && statuses.length === 0) {\n    createDefaultStatuses();\n  }\n\n  if (isLoading) {\n    return (\n      <SettingsSection title={t('session_stages.title')} description={t('session_stages.description')}>\n        <FormLoadingSkeleton rows={3} />\n      </SettingsSection>\n    );\n  }\n\n  return (\n    <SettingsSection\n      title={t('session_stages.title')}\n      description={t('session_stages.description')}\n      action={{ label: t('session_stages.add_stage'), onClick: handleAdd, icon: <Plus className=\"h-4 w-4\" /> }}\n    >\n      <div className=\"mb-4 p-3 bg-muted/30 rounded-lg border border-dashed border-muted-foreground/20\">\n        <p className=\"text-sm text-muted-foreground leading-relaxed\">{t('session_stages.drag_instructions')}</p>\n      </div>\n\n      <DragDropContext onDragEnd={handleDragEnd}>\n        <Droppable droppableId=\"session-statuses\" direction=\"horizontal\">\n          {(provided, snapshot) => (\n            <div\n              {...provided.droppableProps}\n              ref={provided.innerRef}\n              className={cn(\n                \"flex flex-wrap gap-3 min-h-[48px] transition-colors rounded-lg p-2\",\n                snapshot.isDraggingOver && \"bg-accent/20\"\n              )}\n            >\n              {statuses.map((status, index) => (\n                <Draggable key={status.id} draggableId={status.id} index={index}>\n                  {(provided, snapshot) => (\n                    <div\n                      ref={provided.innerRef}\n                      {...provided.draggableProps}\n                      className={cn(\n                        \"inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium transition-all select-none\",\n                        snapshot.isDragging ? \"opacity-80 shadow-xl scale-105 z-50\" : \"hover:opacity-80 cursor-pointer\",\n                        !snapshot.isDragging && \"hover:scale-[1.02]\"\n                      )}\n                      style={{\n                        backgroundColor: status.color + '20',\n                        color: status.color,\n                        border: `1px solid ${status.color}40`,\n                        ...provided.draggableProps.style,\n                      }}\n                    >\n                      <div\n                        {...provided.dragHandleProps}\n                        className=\"flex items-center cursor-grab active:cursor-grabbing hover:opacity-70 transition-opacity\"\n                        onClick={(e) => e.stopPropagation()}\n                      >\n                        <GripVertical className=\"w-3 h-3 text-current opacity-60\" />\n                      </div>\n                      <div className=\"w-2 h-2 rounded-full flex-shrink-0\" style={{ backgroundColor: status.color }} />\n                      <span\n                        className=\"uppercase tracking-wide font-semibold cursor-pointer\"\n                        onClick={(e) => { e.stopPropagation(); handleEdit(status); }}\n                      >\n                        {status.name}\n                      </span>\n                      {status.lifecycle && status.lifecycle !== 'active' && (\n                        <span className=\"text-xs opacity-60 font-normal capitalize\">\n                          Â· {t(`session_status.lifecycle.${status.lifecycle}`)}\n                        </span>\n                      )}\n                    </div>\n                  )}\n                </Draggable>\n              ))}\n              {provided.placeholder}\n            </div>\n          )}\n        </Droppable>\n      </DragDropContext>\n\n      {/* Add Dialog */}\n      <AddSessionStatusDialog\n        open={isAddDialogOpen}\n        onOpenChange={setIsAddDialogOpen}\n        onStatusAdded={refetch}\n      />\n\n      {/* Edit Dialog */}\n      <EditSessionStatusDialog\n        status={editingStatus}\n        open={isEditDialogOpen}\n        onOpenChange={setIsEditDialogOpen}\n        onStatusUpdated={refetch}\n      />\n    </SettingsSection>\n  );\n};\n\nexport default SessionStatusesSection;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/SessionTypesSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/SessionsSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4404,4407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4404,4407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { Card, CardHeader, CardTitle, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Plus, Calendar } from \"lucide-react\";\nimport DeadSimpleSessionBanner from \"./DeadSimpleSessionBanner\";\nimport EditSessionDialog from \"./EditSessionDialog\";\nimport SessionSheetView from \"./SessionSheetView\";\nimport { NewSessionDialogForProject } from \"./NewSessionDialogForProject\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\nimport { sortSessionsByLifecycle, SessionWithStatus } from \"@/lib/sessionSorting\";\nimport { useFormsTranslation } from \"@/hooks/useTypedTranslation\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\ninterface Session extends SessionWithStatus {\n  session_name?: string | null;\n  session_time: string;\n  notes: string;\n}\ninterface SessionsSectionProps {\n  sessions: Session[];\n  loading: boolean;\n  leadId: string;\n  projectId: string;\n  leadName: string;\n  projectName: string;\n  onSessionUpdated: () => void;\n  onDeleteSession: (sessionId: string) => void;\n}\nexport function SessionsSection({\n  sessions,\n  loading,\n  leadId,\n  projectId,\n  leadName,\n  projectName,\n  onSessionUpdated,\n  onDeleteSession\n}: SessionsSectionProps) {\n  const [editingSessionId, setEditingSessionId] = useState<string | null>(null);\n  const [selectedSessionId, setSelectedSessionId] = useState<string | null>(null);\n  const [isSessionSheetOpen, setIsSessionSheetOpen] = useState(false);\n  const navigate = useNavigate();\n  const location = useLocation();\n  const { t } = useFormsTranslation();\n  const isMobile = useIsMobile();\n  const handleSessionUpdated = () => {\n    onSessionUpdated();\n    setEditingSessionId(null);\n  };\n\n  const handleSessionSheetUpdated = () => {\n    onSessionUpdated(); // Propagate updates from session sheet to parent\n  };\n\n  const handleSessionSheetOpenChange = (open: boolean) => {\n    setIsSessionSheetOpen(open);\n    if (!open) {\n      // When sheet closes, refresh the sessions to reflect any updates\n      onSessionUpdated();\n    }\n  };\n\n  const handleSessionClick = (sessionId: string) => {\n    if (isMobile) {\n      navigate(`/sessions/${sessionId}`);\n      return;\n    }\n    setSelectedSessionId(sessionId);\n    setIsSessionSheetOpen(true);\n  };\n\n  const handleViewFullSessionDetails = () => {\n    if (selectedSessionId) {\n      const currentPath = `${location.pathname}${location.search}${location.hash}`;\n      navigate(`/sessions/${selectedSessionId}`, { state: { from: currentPath } });\n    }\n  };\n\n  const handleNavigateToLead = (leadId: string) => {\n    navigate(`/leads/${leadId}`);\n  };\n\n  const handleNavigateToProject = (projectId: string) => {\n    navigate(`/projects/${projectId}`);\n  };\n  if (loading) {\n    return <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center justify-between\">\n            {t('sessions_form.title')}\n            <div className=\"w-6 h-6 bg-muted animate-pulse rounded\" />\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-2\">\n            <div className=\"w-full h-4 bg-muted animate-pulse rounded\" />\n            <div className=\"w-3/4 h-4 bg-muted animate-pulse rounded\" />\n          </div>\n        </CardContent>\n      </Card>;\n  }\n  return <>\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center justify-between text-xl font-semibold\">\n            <div className=\"flex items-center gap-2\">\n              <Calendar className=\"h-4 w-4\" />\n              {t('sessions_form.title')}\n            </div>\n            <NewSessionDialogForProject leadId={leadId} leadName={leadName} projectName={projectName} projectId={projectId} onSessionScheduled={onSessionUpdated} />\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {sessions.length > 0 ? <div className=\"space-y-3\">\n              {!loading && <p className=\"text-sm text-muted-foreground mb-3\">\n                  {sessions.length === 1 \n                    ? t('sessions_form.project_sessions_count', { count: sessions.length })\n                    : t('sessions_form.project_sessions_count_plural', { count: sessions.length })\n                  }\n                </p>}\n              {sortSessionsByLifecycle(sessions).map(session => (\n                <DeadSimpleSessionBanner \n                  key={session.id} \n                  session={session as any}\n                  onClick={() => handleSessionClick(session.id)}\n                />\n              ))}\n            </div> : <div className=\"text-center py-4\">\n              <Calendar className=\"h-8 w-8 text-muted-foreground mx-auto mb-2\" />\n              <p className=\"text-muted-foreground text-sm\">{t('sessions_form.no_sessions')}</p>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                {t('sessions_form.add_sessions_hint')}\n              </p>\n            </div>}\n        </CardContent>\n      </Card>\n\n      {/* Edit Session Dialog */}\n      {editingSessionId && (() => {\n        const session = sessions.find(s => s.id === editingSessionId);\n        return session ? (\n           <EditSessionDialog \n             sessionId={session.id} \n             leadId={session.lead_id} \n             currentDate={session.session_date} \n             currentTime={session.session_time} \n             currentNotes={session.notes} \n             currentProjectId={session.project_id} \n             currentSessionName={session.session_name}\n             leadName={leadName} \n             open={!!editingSessionId} \n             onOpenChange={open => {\n               if (!open) {\n                 setEditingSessionId(null);\n               }\n             }} \n             onSessionUpdated={handleSessionUpdated} \n           />\n        ) : null;\n      })()}\n\n      {/* Session Sheet View */}\n      <SessionSheetView\n        sessionId={selectedSessionId || ''}\n        isOpen={isSessionSheetOpen}\n        onOpenChange={handleSessionSheetOpenChange}\n        onViewFullDetails={handleViewFullSessionDetails}\n        onNavigateToLead={handleNavigateToLead}\n        onNavigateToProject={handleNavigateToProject}\n        onSessionUpdated={handleSessionSheetUpdated}\n      />\n    </>;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/SettingsSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/SimpleProjectTypeSelect.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1807,1810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1807,1810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchProjectTypes'. Either include it or remove the dependency array.","line":74,"column":6,"nodeType":"ArrayExpression","endLine":74,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchProjectTypes]","fix":{"range":[2054,2056],"text":"[fetchProjectTypes]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\n\ninterface ProjectType {\n  id: string;\n  name: string;\n  is_default: boolean;\n}\n\ninterface SimpleProjectTypeSelectProps {\n  value?: string;\n  onValueChange: (value: string) => void;\n  placeholder?: string;\n  disabled?: boolean;\n  className?: string;\n  required?: boolean;\n}\n\nexport function SimpleProjectTypeSelect({ \n  value, \n  onValueChange, \n  placeholder = \"Select project type...\", \n  disabled = false,\n  className,\n  required = false\n}: SimpleProjectTypeSelectProps) {\n  const [types, setTypes] = useState<ProjectType[]>([]);\n  const [loading, setLoading] = useState(false);\n  const { toast } = useToast();\n\n  const fetchProjectTypes = async () => {\n    setLoading(true);\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) return;\n\n      const { data, error } = await supabase\n        .from('project_types')\n        .select('id, name, is_default')\n        .eq('organization_id', organizationId)\n        .order('is_default', { ascending: false }) // Default types first\n        .order('name', { ascending: true });\n\n      if (error) throw error;\n\n      setTypes(data || []);\n\n      // Auto-select default type if no value is set\n      if (!value && data && data.length > 0) {\n        const defaultType = data.find(type => type.is_default);\n        if (defaultType) {\n          onValueChange(defaultType.id);\n        }\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error loading project types\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchProjectTypes();\n  }, []);\n\n  // Check if user has no project types\n  if (!loading && types.length === 0) {\n    return (\n      <div className=\"text-sm text-muted-foreground p-2 border rounded\">\n        No project types configured. Please add project types in Settings first.\n      </div>\n    );\n  }\n\n  return (\n    <Select\n      value={value}\n      onValueChange={onValueChange}\n      disabled={disabled || loading}\n    >\n      <SelectTrigger className={className}>\n        <SelectValue placeholder={loading ? \"Loading types...\" : placeholder} />\n      </SelectTrigger>\n      <SelectContent className=\"z-50 bg-popover\">\n        {types.map((type) => (\n          <SelectItem key={type.id} value={type.id}>\n            <div className=\"flex items-center gap-2\">\n              <span>{type.name}</span>\n              {type.is_default && (\n                <span className=\"text-xs text-muted-foreground\">(Default)</span>\n              )}\n            </div>\n          </SelectItem>\n        ))}\n      </SelectContent>\n    </Select>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/TimeSlotPicker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/TimezoneSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/TruncatedTextWithTooltip.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2631,2634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2631,2634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useRef, useState } from \"react\";\nimport type { ComponentPropsWithoutRef, ElementType } from \"react\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { cn } from \"@/lib/utils\";\n\ntype SupportedElement = \"span\" | \"div\" | \"p\";\n\nconst LINE_CLAMP_CLASSES: Record<number, string> = {\n  1: \"line-clamp-1\",\n  2: \"line-clamp-2\",\n  3: \"line-clamp-3\",\n  4: \"line-clamp-4\",\n  5: \"line-clamp-5\",\n  6: \"line-clamp-6\",\n};\n\ninterface TruncatedTextWithTooltipProps<T extends SupportedElement = \"span\">\n  extends ComponentPropsWithoutRef<T> {\n  text: string;\n  lines?: number;\n  as?: T;\n  tooltipSide?: ComponentPropsWithoutRef<typeof TooltipContent>[\"side\"];\n  tooltipAlign?: ComponentPropsWithoutRef<typeof TooltipContent>[\"align\"];\n  tooltipClassName?: string;\n  delayDuration?: number;\n}\n\nexport function TruncatedTextWithTooltip<T extends SupportedElement = \"span\">({\n  text,\n  lines = 2,\n  as,\n  className,\n  tooltipSide = \"top\",\n  tooltipAlign = \"center\",\n  tooltipClassName,\n  delayDuration = 150,\n  ...rest\n}: TruncatedTextWithTooltipProps<T>) {\n  const Component = (as ?? \"span\") as ElementType;\n  const textRef = useRef<HTMLElement | null>(null);\n  const [isTruncated, setIsTruncated] = useState(false);\n\n  const clampClass = useMemo(() => {\n    return LINE_CLAMP_CLASSES[lines] || LINE_CLAMP_CLASSES[2];\n  }, [lines]);\n\n  useEffect(() => {\n    if (!text) {\n      setIsTruncated(false);\n      return;\n    }\n\n    if (typeof window === \"undefined\") {\n      setIsTruncated(false);\n      return;\n    }\n\n    const el = textRef.current;\n    if (!el) {\n      setIsTruncated(false);\n      return;\n    }\n\n    const checkTruncation = () => {\n      const isOverflowingVertically = el.scrollHeight > el.clientHeight + 1;\n      const isOverflowingHorizontally = el.scrollWidth > el.clientWidth + 1;\n      setIsTruncated(isOverflowingVertically || isOverflowingHorizontally);\n    };\n\n    const frame = window.requestAnimationFrame(checkTruncation);\n\n    let resizeObserver: ResizeObserver | null = null;\n    if (\"ResizeObserver\" in window) {\n      resizeObserver = new window.ResizeObserver(checkTruncation);\n      resizeObserver.observe(el);\n    } else {\n      window.addEventListener(\"resize\", checkTruncation);\n    }\n\n    return () => {\n      window.cancelAnimationFrame(frame);\n      if (resizeObserver) {\n        resizeObserver.disconnect();\n      } else {\n        window.removeEventListener(\"resize\", checkTruncation);\n      }\n    };\n  }, [text, lines]);\n\n  if (!text) {\n    return null;\n  }\n\n  const content = (\n    <Component\n      ref={textRef as any}\n      className={cn(\n        \"break-words\",\n        clampClass,\n        isTruncated && \"cursor-help\",\n        className\n      )}\n      {...(rest as ComponentPropsWithoutRef<typeof Component>)}\n    >\n      {text}\n    </Component>\n  );\n\n  return (\n    <TooltipProvider delayDuration={delayDuration}>\n      <Tooltip>\n        <TooltipTrigger asChild>{content}</TooltipTrigger>\n        {isTruncated && (\n          <TooltipContent\n            side={tooltipSide}\n            align={tooltipAlign}\n            className={cn(\n              \"max-w-xs whitespace-pre-wrap break-words text-left\",\n              tooltipClassName\n            )}\n          >\n            {text}\n          </TooltipContent>\n        )}\n      </Tooltip>\n    </TooltipProvider>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/UnifiedActivityArea.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2529,2532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2529,2532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3696,3699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3696,3699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":154,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4590,4593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4590,4593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":249,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8269,8272],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8269,8272],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { CalendarIcon, Plus, FileText, Bell, CheckSquare } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { cn } from \"@/lib/utils\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface UnifiedActivityAreaProps {\n  projectId: string;\n  leadId: string;\n  leadName: string;\n  projectName: string;\n  onActivityUpdated?: () => void;\n}\n\nexport function UnifiedActivityArea({ \n  projectId, \n  leadId, \n  leadName, \n  projectName, \n  onActivityUpdated \n}: UnifiedActivityAreaProps) {\n  const [activeTab, setActiveTab] = useState(\"note\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const { toast } = useToast();\n  const { t } = useTranslation();\n\n  // Note form state\n  const [noteContent, setNoteContent] = useState(\"\");\n\n  // Reminder form state\n  const [reminderContent, setReminderContent] = useState(\"\");\n  const [reminderDate, setReminderDate] = useState<Date>();\n  const [reminderTime, setReminderTime] = useState(\"\");\n  const [reminderType, setReminderType] = useState<\"call\" | \"email\" | \"task\" | \"follow_up\">(\"call\");\n\n  // Todo form state\n  const [todoContent, setTodoContent] = useState(\"\");\n\n  const handleSubmitNote = async () => {\n    if (!noteContent.trim()) return;\n\n    setIsSubmitting(true);\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('User not authenticated');\n\n      const { error } = await supabase\n        .from('activities')\n        .insert({\n          user_id: user.id,\n          lead_id: leadId,\n          project_id: projectId,\n          type: 'note',\n          content: noteContent.trim()\n        });\n\n      if (error) throw error;\n\n      toast({\n        title: t(\"messages.success.created\"),\n        description: t(\"forms.unified_activity.note_added\")\n      });\n\n      setNoteContent(\"\");\n      onActivityUpdated?.();\n    } catch (error: any) {\n      toast({\n        title: t(\"forms.unified_activity.error_adding_note\"),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleSubmitReminder = async () => {\n    if (!reminderContent.trim() || !reminderDate || !reminderTime) return;\n\n    setIsSubmitting(true);\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('User not authenticated');\n\n      const { error } = await supabase\n        .from('activities')\n        .insert({\n          user_id: user.id,\n          lead_id: leadId,\n          project_id: projectId,\n          type: reminderType,\n          content: reminderContent.trim(),\n          reminder_date: format(reminderDate, 'yyyy-MM-dd'),\n          reminder_time: reminderTime\n        });\n\n      if (error) throw error;\n\n      toast({\n        title: t(\"messages.success.created\"),\n        description: t(\"forms.unified_activity.reminder_created\")\n      });\n\n      setReminderContent(\"\");\n      setReminderDate(undefined);\n      setReminderTime(\"\");\n      onActivityUpdated?.();\n    } catch (error: any) {\n      toast({\n        title: t(\"forms.unified_activity.error_creating_reminder\"),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleSubmitTodo = async () => {\n    if (!todoContent.trim()) return;\n\n    setIsSubmitting(true);\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('User not authenticated');\n\n      const { error } = await supabase\n        .from('todos')\n        .insert({\n          user_id: user.id,\n          project_id: projectId,\n          content: todoContent.trim()\n        });\n\n      if (error) throw error;\n\n      toast({\n        title: t(\"messages.success.created\"),\n        description: t(\"forms.unified_activity.todo_added\")\n      });\n\n      setTodoContent(\"\");\n      onActivityUpdated?.();\n    } catch (error: any) {\n      toast({\n        title: t(\"forms.unified_activity.error_adding_todo\"),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <Card>\n      <CardContent className=\"p-6\">\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-3\">\n            <TabsTrigger value=\"note\" className=\"flex items-center gap-2\">\n              <FileText className=\"h-4 w-4\" />\n              {t(\"forms.unified_activity.note\")}\n            </TabsTrigger>\n            <TabsTrigger value=\"reminder\" className=\"flex items-center gap-2\">\n              <Bell className=\"h-4 w-4\" />\n              {t(\"forms.unified_activity.reminder\")}\n            </TabsTrigger>\n            <TabsTrigger value=\"todo\" className=\"flex items-center gap-2\">\n              <CheckSquare className=\"h-4 w-4\" />\n              {t(\"forms.unified_activity.todo\")}\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"note\" className=\"space-y-4 mt-4\">\n            <div className=\"space-y-3\">\n              <Input\n                placeholder={t(\"forms.unified_activity.add_note_placeholder\")}\n                value={noteContent}\n                onChange={(e) => setNoteContent(e.target.value)}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter' && !e.shiftKey) {\n                    e.preventDefault();\n                    handleSubmitNote();\n                  }\n                }}\n              />\n              <Button \n                onClick={handleSubmitNote}\n                disabled={!noteContent.trim() || isSubmitting}\n                size=\"sm\"\n                className=\"w-full\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                {isSubmitting ? t(\"forms.unified_activity.adding\") : t(\"forms.unified_activity.add_note\")}\n              </Button>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"reminder\" className=\"space-y-4 mt-4\">\n            <div className=\"space-y-3\">\n              <Input\n                placeholder={t(\"forms.unified_activity.reminder_placeholder\")}\n                value={reminderContent}\n                onChange={(e) => setReminderContent(e.target.value)}\n              />\n              \n              <div className=\"grid grid-cols-2 gap-3\">\n                <Popover>\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant=\"outline\"\n                      className={cn(\n                        \"justify-start text-left font-normal\",\n                        !reminderDate && \"text-muted-foreground\"\n                      )}\n                    >\n                      <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                      {reminderDate ? format(reminderDate, \"MMM d, yyyy\") : t(\"forms.unified_activity.pick_date\")}\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                    <Calendar\n                      mode=\"single\"\n                      selected={reminderDate}\n                      onSelect={setReminderDate}\n                      initialFocus\n                      className=\"pointer-events-auto\"\n                    />\n                  </PopoverContent>\n                </Popover>\n\n                <Input\n                  type=\"time\"\n                  value={reminderTime}\n                  onChange={(e) => setReminderTime(e.target.value)}\n                />\n              </div>\n\n              <Select value={reminderType} onValueChange={(value: any) => setReminderType(value)}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"call\">{t(\"forms.activity.types.call\")}</SelectItem>\n                  <SelectItem value=\"email\">{t(\"forms.activity.types.email\")}</SelectItem>\n                  <SelectItem value=\"task\">{t(\"forms.activity.types.task\")}</SelectItem>\n                  <SelectItem value=\"follow_up\">{t(\"forms.activity.types.follow_up\")}</SelectItem>\n                </SelectContent>\n              </Select>\n\n              <Button \n                onClick={handleSubmitReminder}\n                disabled={!reminderContent.trim() || !reminderDate || !reminderTime || isSubmitting}\n                size=\"sm\"\n                className=\"w-full\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                {isSubmitting ? t(\"forms.unified_activity.creating\") : t(\"forms.unified_activity.create_reminder\")}\n              </Button>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"todo\" className=\"space-y-4 mt-4\">\n            <div className=\"space-y-3\">\n              <Input\n                placeholder={t(\"forms.unified_activity.add_todo_placeholder\")}\n                value={todoContent}\n                onChange={(e) => setTodoContent(e.target.value)}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter' && !e.shiftKey) {\n                    e.preventDefault();\n                    handleSubmitTodo();\n                  }\n                }}\n              />\n              <Button \n                onClick={handleSubmitTodo}\n                disabled={!todoContent.trim() || isSubmitting}\n                size=\"sm\"\n                className=\"w-full\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                {isSubmitting ? t(\"forms.unified_activity.adding\") : t(\"forms.unified_activity.add_todo\")}\n              </Button>\n            </div>\n          </TabsContent>\n        </Tabs>\n      </CardContent>\n    </Card>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/UnifiedClientDetails.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2153,2156],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2153,2156],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":169,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5789,5792],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5789,5792],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":260,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8386,8389],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8386,8389],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useRef, useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Mail,\n  MessageCircle,\n  MessageSquare,\n  ChevronDown,\n  Pencil,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLeadFieldDefinitions } from \"@/hooks/useLeadFieldDefinitions\";\nimport { useLeadFieldValues } from \"@/hooks/useLeadFieldValues\";\nimport { useLeadUpdate } from \"@/hooks/useLeadUpdate\";\nimport { CustomFieldDisplay } from \"@/components/fields/CustomFieldDisplay\";\nimport { CustomFieldDisplayWithEmpty } from \"@/components/fields/CustomFieldDisplayWithEmpty\";\nimport { FieldTextareaDisplay } from \"@/components/fields/FieldTextareaDisplay\";\nimport { InlineEditField } from \"@/components/fields/InlineEditField\";\nimport { InlineTextEditor } from \"@/components/fields/inline-editors/InlineTextEditor\";\nimport { InlineTextareaEditor } from \"@/components/fields/inline-editors/InlineTextareaEditor\";\nimport { InlineEmailEditor } from \"@/components/fields/inline-editors/InlineEmailEditor\";\nimport { InlinePhoneEditor } from \"@/components/fields/inline-editors/InlinePhoneEditor\";\nimport { InlineSelectEditor } from \"@/components/fields/inline-editors/InlineSelectEditor\";\nimport { InlineMultiSelectEditor } from \"@/components/fields/inline-editors/InlineMultiSelectEditor\";\nimport { InlineNumberEditor } from \"@/components/fields/inline-editors/InlineNumberEditor\";\nimport { InlineDateEditor } from \"@/components/fields/inline-editors/InlineDateEditor\";\nimport { InlineCheckboxEditor } from \"@/components/fields/inline-editors/InlineCheckboxEditor\";\nimport { EnhancedEditLeadDialog } from \"./EnhancedEditLeadDialog\";\n// Permissions removed for single photographer mode\nimport { validateFieldValue } from \"@/lib/leadFieldValidation\";\nimport { useFormsTranslation } from \"@/hooks/useTypedTranslation\";\nimport { cn } from \"@/lib/utils\";\n\ninterface Lead {\n  id: string;\n  name: string;\n  email?: string | null;\n  phone?: string | null;\n  notes?: string | null;\n  [key: string]: any;\n}\n\ninterface UnifiedClientDetailsProps {\n  lead: Lead;\n  title?: string;\n  showQuickActions?: boolean;\n  onLeadUpdated?: () => void;\n  className?: string;\n  showClickableNames?: boolean;\n  createdAt?: string | null; // creation date\n  onNavigateToLead?: (leadId: string) => void;\n  defaultExpanded?: boolean;\n  showLeadNameInHeader?: boolean;\n}\n\n// Helper functions for validation and phone normalization\nconst isValidEmail = (email?: string | null) =>\n  !!email && /[^\\s@]+@[^\\s@]+\\.[^\\s@]+/.test(email);\n\nfunction normalizeTRPhone(\n  phone?: string | null\n): null | { e164: string; e164NoPlus: string } {\n  if (!phone) return null;\n  const digits = phone.replace(/\\D/g, \"\");\n  let e164 = \"\";\n\n  if (phone.trim().startsWith(\"+\")) {\n    if (digits.startsWith(\"90\") && digits.length === 12) {\n      e164 = \"+\" + digits;\n    } else {\n      return null;\n    }\n  } else if (digits.startsWith(\"90\") && digits.length === 12) {\n    e164 = \"+\" + digits;\n  } else if (digits.startsWith(\"0\") && digits.length === 11) {\n    e164 = \"+90\" + digits.slice(1);\n  } else if (digits.length === 10) {\n    e164 = \"+90\" + digits;\n  } else {\n    return null;\n  }\n\n  return {\n    e164,\n    e164NoPlus: e164.slice(1),\n  };\n}\n\nexport function UnifiedClientDetails({\n  lead,\n  title,\n  showQuickActions = true,\n  onLeadUpdated,\n  className,\n  showClickableNames = false,\n  createdAt,\n  onNavigateToLead,\n  defaultExpanded = true,\n  showLeadNameInHeader = true,\n}: UnifiedClientDetailsProps) {\n  const { toast } = useToast();\n  const { fieldDefinitions, loading: fieldsLoading } =\n    useLeadFieldDefinitions();\n  const {\n    fieldValues,\n    loading: valuesLoading,\n    refetch: refetchFieldValues,\n  } = useLeadFieldValues(lead.id);\n  const [localLead, setLocalLead] = useState(lead);\n  const pendingCoreUpdatesRef = useRef<Record<string, string | null>>({});\n  // Permissions removed for single photographer mode - always allow\n  const [editOpen, setEditOpen] = useState(false);\n  const [editingField, setEditingField] = useState<string | null>(null);\n  const navigate = useNavigate();\n  const { t: tForms } = useFormsTranslation();\n\n  const { updateCoreField, updateCustomField } = useLeadUpdate({\n    leadId: lead.id,\n    onSuccess: () => {\n      refetchFieldValues?.();\n      onLeadUpdated?.();\n    },\n  });\n\n  const loading = fieldsLoading || valuesLoading;\n  const [isExpanded, setIsExpanded] = useState(defaultExpanded);\n\n  useEffect(() => {\n    setLocalLead((prev) => {\n      if (!prev || lead.id !== prev.id) {\n        pendingCoreUpdatesRef.current = {};\n        return lead;\n      }\n\n      const coreKeys: Array<keyof Lead> = [\"name\", \"email\", \"phone\", \"notes\"];\n      const updatedFields: Partial<Lead> = {};\n      let shouldUpdate = false;\n\n      for (const key of coreKeys) {\n        const parentValue = (lead[key] ?? null) as string | null;\n        const prevValue = (prev[key] ?? null) as string | null;\n        const pendingValue = pendingCoreUpdatesRef.current[key as string];\n\n        if (pendingValue !== undefined && pendingValue !== parentValue) {\n          continue;\n        }\n\n        if (pendingValue !== undefined && pendingValue === parentValue) {\n          delete pendingCoreUpdatesRef.current[key as string];\n        }\n\n        if (parentValue !== prevValue) {\n          updatedFields[key] = parentValue;\n          shouldUpdate = true;\n        }\n      }\n\n      return shouldUpdate ? { ...prev, ...updatedFields } : prev;\n    });\n  }, [lead]);\n\n  // Combine core fields with custom fields\n  const allFields: Array<{\n    key: string;\n    label: string;\n    value: string | null;\n    type: \"core\" | \"custom\";\n    fieldDefinition?: any;\n  }> = [\n    {\n      key: \"name\",\n      label: tForms(\"clientDetails.fullName\"),\n      value: localLead.name,\n      type: \"core\",\n    },\n    {\n      key: \"email\",\n      label: tForms(\"clientDetails.email\"),\n      value: localLead.email ?? null,\n      type: \"core\",\n    },\n    {\n      key: \"phone\",\n      label: tForms(\"clientDetails.phone\"),\n      value: localLead.phone ?? null,\n      type: \"core\",\n    },\n    {\n      key: \"notes\",\n      label: tForms(\"clientDetails.notes\"),\n      value: localLead.notes ?? null,\n      type: \"core\",\n    },\n    ...fieldDefinitions\n      .filter(\n        (field) =>\n          ![\"name\", \"email\", \"phone\", \"notes\", \"status\"].includes(\n            field.field_key\n          )\n      )\n      .sort((a, b) => a.sort_order - b.sort_order)\n      .map((field) => ({\n        key: field.field_key,\n        label: field.label,\n        value:\n          fieldValues.find((fv) => fv.field_key === field.field_key)?.value ||\n          null,\n        type: \"custom\" as const,\n        fieldDefinition: field,\n      })),\n  ];\n\n  // Show all fields regardless of whether they have values\n  const coreFields = allFields.filter((field) => field.type === \"core\");\n  const customFields = allFields.filter((field) => field.type === \"custom\");\n\n  // Handle inline editing - Single photographer has full edit access\n  const canEdit = true;\n\n  const handleFieldSave = async (\n    fieldKey: string,\n    value: string,\n    isCustom: boolean\n  ) => {\n    const trimmedValue = value.trim();\n    const normalizedValue = trimmedValue === \"\" ? null : trimmedValue;\n\n    // Validate custom fields before saving\n    if (isCustom) {\n      const fieldDef = fieldDefinitions.find((f) => f.field_key === fieldKey);\n      if (fieldDef) {\n        const validation = validateFieldValue(normalizedValue, fieldDef);\n        if (!validation.isValid) {\n          toast({\n            title: \"Validation Error\",\n            description: validation.error || \"Invalid field value\",\n            variant: \"destructive\",\n          });\n          setEditingField(null);\n          return;\n        }\n      }\n\n      console.log(`Saving custom field \"${fieldKey}\":`, normalizedValue);\n      await updateCustomField(fieldKey, normalizedValue);\n    } else {\n      console.log(`Saving core field \"${fieldKey}\":`, normalizedValue);\n      await updateCoreField(fieldKey, normalizedValue);\n      setLocalLead((prev) => ({\n        ...prev,\n        [fieldKey]: normalizedValue,\n      }));\n      pendingCoreUpdatesRef.current[fieldKey] = normalizedValue;\n    }\n\n    setEditingField(null);\n  };\n\n  const getInlineEditor = (field: any) => {\n    const fieldType =\n      field.type === \"custom\" ? field.fieldDefinition?.field_type : field.key;\n    const options = field.fieldDefinition?.options?.options || [];\n    const allowMultiple = field.fieldDefinition?.allow_multiple || false;\n\n    const commonProps = {\n      value: field.value,\n      onSave: (value: string) =>\n        handleFieldSave(field.key, value, field.type === \"custom\"),\n      onCancel: () => setEditingField(null),\n    };\n\n    switch (fieldType) {\n      case \"email\":\n        return <InlineEmailEditor {...commonProps} showButtons={true} />;\n      case \"phone\":\n        return <InlinePhoneEditor {...commonProps} showButtons={true} />;\n      case \"textarea\":\n      case \"notes\":\n        return (\n          <InlineTextareaEditor\n            {...commonProps}\n            maxLength={\n              field.fieldDefinition?.validation_rules?.maxLength || 1000\n            }\n            showButtons={true}\n          />\n        );\n      case \"select\":\n        if (allowMultiple) {\n          return (\n            <InlineMultiSelectEditor\n              {...commonProps}\n              options={options}\n              showButtons={true}\n            />\n          );\n        } else {\n          return (\n            <InlineSelectEditor\n              {...commonProps}\n              options={options}\n              showButtons={true}\n              keepOpenOnSelect={false}\n            />\n          );\n        }\n      case \"number\":\n        return (\n          <InlineNumberEditor\n            {...commonProps}\n            min={field.fieldDefinition?.validation_rules?.min}\n            max={field.fieldDefinition?.validation_rules?.max}\n            showButtons={true}\n          />\n        );\n      case \"date\":\n        return <InlineDateEditor {...commonProps} showButtons={true} />;\n      case \"checkbox\":\n        return <InlineCheckboxEditor {...commonProps} showButtons={false} />;\n      default:\n        return (\n          <InlineTextEditor\n            {...commonProps}\n            maxLength={\n              field.fieldDefinition?.validation_rules?.maxLength || 255\n            }\n            showButtons={true}\n          />\n        );\n    }\n  };\n\n  // Get phone and email for quick actions (from any field)\n  const phoneField = allFields.find(\n    (field) =>\n      (field.key === \"phone\" ||\n        field.fieldDefinition?.field_type === \"phone\") &&\n      field.value\n  );\n  const emailField = allFields.find(\n    (field) =>\n      (field.key === \"email\" ||\n        field.fieldDefinition?.field_type === \"email\") &&\n      field.value\n  );\n\n  const normalizedPhone = phoneField\n    ? normalizeTRPhone(phoneField.value)\n    : null;\n  const validEmail = emailField ? isValidEmail(emailField.value) : false;\n  const quickActions = [\n    normalizedPhone\n      ? {\n          key: \"whatsapp\",\n          label: tForms(\"clientDetails.whatsApp\"),\n          icon: MessageCircle,\n          href: `https://wa.me/${normalizedPhone.e164NoPlus}`,\n          target: \"_blank\" as const,\n        }\n      : null,\n    normalizedPhone\n      ? {\n          key: \"sms\",\n          label: tForms(\"clientDetails.sms\"),\n          icon: MessageSquare,\n          href: `sms:${normalizedPhone.e164}`,\n        }\n      : null,\n    validEmail && emailField\n      ? {\n          key: \"email\",\n          label: tForms(\"clientDetails.email\"),\n          icon: Mail,\n          href: `mailto:${emailField.value}`,\n        }\n      : null,\n  ].filter(Boolean) as Array<{\n    key: string;\n    label: string;\n    icon: typeof Mail;\n    href: string;\n    target?: \"_blank\";\n  }>;\n\n  const hasQuickActions = showQuickActions && quickActions.length > 0;\n  const shouldShowHeaderLeadName = showLeadNameInHeader && !isExpanded;\n\n  const renderQuickActionButtons = (options?: { compact?: boolean }) => {\n    const compact = options?.compact;\n\n    return quickActions.map(({ key, label, icon: Icon, href, target }) => (\n      <Button\n        key={key}\n        variant=\"outline\"\n        size=\"sm\"\n        asChild\n        className={cn(\"h-7 text-xs px-2\", compact ? \"px-2\" : \"px-3\")}\n      >\n        <a\n          href={href}\n          target={target}\n          rel={target ? \"noopener noreferrer\" : undefined}\n        >\n          <Icon className=\"mr-1 h-3 w-3\" />\n          {label}\n        </a>\n      </Button>\n    ));\n  };\n\n  const leadNameDisplay = showClickableNames ? (\n    <button\n      type=\"button\"\n      onClick={() => {\n        if (onNavigateToLead) {\n          onNavigateToLead(lead.id);\n        } else {\n          navigate(`/leads/${lead.id}`);\n        }\n      }}\n      className=\"block truncate text-sm font-medium text-accent underline-offset-2 hover:underline text-left\"\n    >\n      {localLead.name || \" - \"}\n    </button>\n  ) : (\n    <span className=\"block truncate text-sm font-medium text-accent\">\n      {localLead.name || \" - \"}\n    </span>\n  );\n\n  if (loading) {\n    return (\n      <Card className={className}>\n        <CardHeader>\n          <h3 className=\"text-lg font-semibold\">\n            {title || tForms(\"clientDetails.title\")}\n          </h3>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-3\">\n            {Array.from({ length: 4 }).map((_, index) => (\n              <div key={index} className=\"grid grid-cols-3 gap-3\">\n                <div className=\"h-4 bg-muted rounded animate-pulse\" />\n                <div className=\"col-span-2 h-4 bg-muted rounded animate-pulse\" />\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <>\n      <Card className={className}>\n        <CardHeader\n          className={cn(\n            isExpanded ? \"pb-3\" : \"pb-2\",\n            \"pl-2 pr-4 md:pl-4 md:pr-6\"\n          )}\n        >\n          <div className=\"flex items-start gap-1.5\">\n            <button\n              type=\"button\"\n              onClick={() => setIsExpanded((prev) => !prev)}\n              className={cn(\n                \"flex items-center justify-center rounded-md text-muted-foreground transition-colors hover:bg-muted flex-shrink-0\",\n                \"h-9 w-7 md:w-8\"\n              )}\n              aria-expanded={isExpanded}\n              aria-label=\"Toggle client details\"\n            >\n              <ChevronDown\n                className={cn(\n                  \"h-4 w-4 transition-transform\",\n                  isExpanded ? \"\" : \"-rotate-90\"\n                )}\n              />\n            </button>\n            <div className=\"flex flex-1 flex-col gap-1 min-w-0\">\n              <div className=\"flex items-center gap-2\">\n                <button\n                  type=\"button\"\n                  onClick={() => setIsExpanded((prev) => !prev)}\n                  className=\"text-left leading-none\"\n                  aria-expanded={isExpanded}\n                >\n                  <span className=\"text-lg font-semibold\">\n                    {isExpanded\n                      ? \"KiÅŸi DetaylarÄ±\"\n                      : title || tForms(\"clientDetails.title\")}\n                  </span>\n                </button>\n                <Button\n                  variant=\"ghost\"\n                  size={isExpanded ? \"sm\" : \"icon\"}\n                  onClick={() => setEditOpen(true)}\n                  className={cn(\n                    \"ml-auto bg-accent/10 text-accent transition-colors hover:bg-accent/20 flex-shrink-0\",\n                    isExpanded ? \"h-9 px-3 text-sm font-medium\" : \"h-9 w-9 rounded-lg\"\n                  )}\n                >\n                  {isExpanded ? (\n                    tForms(\"clientDetails.edit\")\n                  ) : (\n                    <>\n                      <Pencil className=\"h-4 w-4\" aria-hidden=\"true\" />\n                      <span className=\"sr-only\">\n                        {tForms(\"clientDetails.edit\")}\n                      </span>\n                    </>\n                  )}\n                </Button>\n              </div>\n              {shouldShowHeaderLeadName && (\n                <div className=\"min-w-0 text-left\">{leadNameDisplay}</div>\n              )}\n              {hasQuickActions && (\n                <div\n                  className={cn(\n                    \"flex flex-wrap items-center gap-1.5\",\n                    isExpanded ? \"pt-2\" : \"pt-1\"\n                  )}\n                >\n                  {isExpanded\n                    ? renderQuickActionButtons()\n                    : renderQuickActionButtons({ compact: true })}\n                </div>\n              )}\n            </div>\n          </div>\n        </CardHeader>\n        <div\n          className={cn(\n            \"overflow-hidden transition-[max-height,opacity] duration-300 ease-in-out\",\n            isExpanded ? \"max-h-[2000px] opacity-100\" : \"max-h-0 opacity-0\"\n          )}\n          aria-hidden={!isExpanded}\n        >\n          <CardContent\n            className={cn(\n              \"space-y-3 transition-[opacity,padding] duration-300 ease-in-out\",\n              isExpanded ? \"opacity-100\" : \"opacity-0 py-0 md:py-0 pointer-events-none\"\n            )}\n          >\n            {coreFields.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground\">\n                {tForms(\"clientDetails.noInfoAvailable\")}\n              </p>\n            ) : (\n              <div className=\"space-y-3\">\n                {coreFields.map((field) => (\n                  <div\n                    key={field.key}\n                    className=\"grid grid-cols-3 gap-3 items-start\"\n                  >\n                    <label className=\"text-sm font-medium text-muted-foreground\">\n                      {field.label}\n                    </label>\n                    <div className=\"col-span-2 text-sm\">\n                      <InlineEditField\n                        value={field.value}\n                        isEditing={editingField === field.key}\n                        onStartEdit={() => setEditingField(field.key)}\n                        onSave={(value) =>\n                          handleFieldSave(field.key, value, false)\n                        }\n                        onCancel={() => setEditingField(null)}\n                        disabled={!canEdit}\n                        editComponent={getInlineEditor(field)}\n                      >\n                        {field.key === \"name\" && showClickableNames ? (\n                          <button\n                            onClick={() => {\n                              if (onNavigateToLead) {\n                                onNavigateToLead(lead.id);\n                              } else {\n                                navigate(`/leads/${lead.id}`);\n                              }\n                            }}\n                            className=\"text-accent hover:underline font-medium break-words text-left\"\n                          >\n                            {field.value || \" - \"}\n                          </button>\n                        ) : field.key === \"notes\" ? (\n                          field.value ? (\n                            <FieldTextareaDisplay\n                              value={field.value}\n                              maxLines={2}\n                            />\n                          ) : (\n                            <span className=\"break-words text-muted-foreground\">\n                              {\" \"}\n                              -{\" \"}\n                            </span>\n                          )\n                        ) : (\n                          <span className=\"break-words\">\n                            {field.value || \" - \"}\n                          </span>\n                        )}\n                      </InlineEditField>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {/* Custom Fields Section */}\n            {customFields.length > 0 && (\n              <div className=\"pt-3 border-t\">\n                <div className=\"space-y-3\">\n                  {customFields.map((field) => (\n                    <div\n                      key={field.key}\n                      className=\"grid grid-cols-3 gap-3 items-start\"\n                    >\n                      <label className=\"text-sm font-medium text-muted-foreground\">\n                        {field.label}\n                      </label>\n                      <div className=\"col-span-2 text-sm\">\n                        <InlineEditField\n                          value={field.value}\n                          isEditing={editingField === field.key}\n                          onStartEdit={() => setEditingField(field.key)}\n                          onSave={(value) =>\n                            handleFieldSave(field.key, value, true)\n                          }\n                          onCancel={() => setEditingField(null)}\n                          disabled={!canEdit}\n                          disableOutsideCancel={\n                            field.fieldDefinition?.field_type === \"select\"\n                          }\n                          editComponent={getInlineEditor(field)}\n                        >\n                          <CustomFieldDisplayWithEmpty\n                            fieldDefinition={field.fieldDefinition!}\n                            value={field.value}\n                            showCopyButtons={false}\n                            allowTruncation={true}\n                            maxLines={2}\n                          />\n                        </InlineEditField>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* Creation date - subtle and compact */}\n            {createdAt && (\n              <div className=\"mt-3 text-center\">\n                <span className=\"text-[10px] text-muted-foreground/60 font-normal\">\n                  {tForms(\"clientDetails.createdOn\")}{\" \"}\n                  {new Date(createdAt).toLocaleDateString(\"tr-TR\", {\n                    year: \"numeric\",\n                    month: \"short\",\n                    day: \"numeric\",\n                  })}\n                </span>\n              </div>\n            )}\n          </CardContent>\n        </div>\n      </Card>\n\n      {/* Edit Dialog */}\n      <EnhancedEditLeadDialog\n        lead={lead}\n        open={editOpen}\n        onOpenChange={setEditOpen}\n        onClose={() => setEditOpen(false)}\n        onSuccess={() => {\n          // First refresh our own field values\n          refetchFieldValues?.();\n          // Then call parent's onLeadUpdated callback\n          onLeadUpdated?.();\n          setEditOpen(false);\n        }}\n      />\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/UserMenu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ViewProjectDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/WeeklySchedulePreview.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":592,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":592,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo } from \"react\";\nimport {\n  addDays,\n  differenceInCalendarDays,\n  format,\n  parseISO,\n  startOfWeek,\n} from \"date-fns\";\nimport { useFormsTranslation } from \"@/hooks/useTypedTranslation\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\n\nconst MINUTES_IN_DAY = 24 * 60;\nconst PIXELS_PER_MINUTE = 0.9;\nconst MIN_BLOCK_HEIGHT = 36;\nconst MIN_VIEW_RANGE = 6 * 60;\nconst DEFAULT_DRAFT_DURATION = 60;\n\nexport interface WeeklyScheduleSession {\n  id: string;\n  session_date?: string | null;\n  session_time?: string | null;\n  duration_minutes?: number | null;\n  session_type_name?: string | null;\n  lead_name?: string | null;\n  project_name?: string | null;\n}\n\ninterface WeeklySchedulePreviewProps {\n  sessions: WeeklyScheduleSession[];\n  referenceDate: Date;\n  selectedDate?: Date;\n  selectedTime?: string;\n  selectedDurationMinutes?: number | null;\n  locale?: string;\n  showDraftSelection?: boolean;\n}\n\ninterface PositionedSession extends WeeklyScheduleSession {\n  startMinutes: number;\n  endMinutes: number;\n  columnIndex: number;\n  columnCount: number;\n  dayIndex: number;\n}\n\nconst formatTimeLabel = (minutes: number, locale: string) => {\n  const hours = Math.floor(minutes / 60);\n  const mins = minutes % 60;\n  const reference = new Date();\n  reference.setHours(hours, mins, 0, 0);\n  return new Intl.DateTimeFormat(locale, {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n  }).format(reference);\n};\n\nconst formatDurationLabel = (\n  minutes: number,\n  translate: (key: string, options?: Record<string, unknown>) => string\n) => {\n  const roundedMinutes = Math.max(Math.round(minutes), 0);\n  const hours = Math.floor(roundedMinutes / 60);\n  const remainingMinutes = roundedMinutes % 60;\n  const parts: string[] = [];\n\n  if (hours > 0) {\n    const unitKey =\n      hours === 1 ? \"sessionTypes.units.hour\" : \"sessionTypes.units.hours\";\n    parts.push(`${hours} ${translate(unitKey)}`);\n  }\n\n  if (remainingMinutes > 0 || parts.length === 0) {\n    const unitKey =\n      remainingMinutes === 1\n        ? \"sessionTypes.units.minute\"\n        : \"sessionTypes.units.minutes\";\n    parts.push(`${remainingMinutes} ${translate(unitKey)}`);\n  }\n\n  return parts.join(\" \");\n};\n\nconst parseTimeToMinutes = (time?: string | null): number | null => {\n  if (!time) return null;\n  const [hours, minutes] = time.split(\":\").map((part) => Number(part) || 0);\n  if (Number.isNaN(hours) || Number.isNaN(minutes)) return null;\n  return hours * 60 + minutes;\n};\n\nconst buildDayLayout = (\n  sessions: Array<WeeklyScheduleSession & { startMinutes: number; endMinutes: number }>\n): PositionedSession[] => {\n  const sorted = [...sessions].sort(\n    (a, b) => a.startMinutes - b.startMinutes || a.endMinutes - b.endMinutes\n  );\n\n  const active: Array<{\n    columnIndex: number;\n    endMinutes: number;\n    positioned: PositionedSession;\n  }> = [];\n  const positioned: PositionedSession[] = [];\n\n  sorted.forEach((session) => {\n    const { startMinutes, endMinutes } = session;\n\n    for (let i = active.length - 1; i >= 0; i -= 1) {\n      if (active[i].endMinutes <= startMinutes) {\n        active.splice(i, 1);\n      }\n    }\n\n    const usedColumns = new Set(active.map((item) => item.columnIndex));\n    let columnIndex = 0;\n    while (usedColumns.has(columnIndex)) {\n      columnIndex += 1;\n    }\n\n    const positionedSession: PositionedSession = {\n      ...session,\n      columnIndex,\n      columnCount: 1,\n      id: session.id,\n      dayIndex: 0,\n    };\n\n    active.push({ columnIndex, endMinutes, positioned: positionedSession });\n    active.sort((a, b) => a.endMinutes - b.endMinutes);\n\n    const overlapColumns = active.length;\n    active.forEach((item) => {\n      item.positioned.columnCount = Math.max(item.positioned.columnCount, overlapColumns);\n    });\n\n    positioned.push(positionedSession);\n  });\n\n  return positioned;\n};\n\nconst clampRange = (start: number, end: number): { start: number; end: number } => {\n  let rangeStart = Math.max(0, start);\n  let rangeEnd = Math.min(MINUTES_IN_DAY, end);\n  if (rangeEnd <= rangeStart) {\n    rangeStart = 9 * 60;\n    rangeEnd = rangeStart + MIN_VIEW_RANGE;\n  }\n  if (rangeEnd - rangeStart < MIN_VIEW_RANGE) {\n    const deficit = MIN_VIEW_RANGE - (rangeEnd - rangeStart);\n    const adjustStart = Math.max(0, rangeStart - deficit / 2);\n    const adjustEnd = Math.min(MINUTES_IN_DAY, adjustStart + MIN_VIEW_RANGE);\n    rangeStart = Math.max(0, adjustEnd - MIN_VIEW_RANGE);\n    rangeEnd = adjustEnd;\n  }\n  return { start: rangeStart, end: rangeEnd };\n};\n\nexport const WeeklySchedulePreview = ({\n  sessions,\n  referenceDate,\n  selectedDate,\n  selectedTime,\n  selectedDurationMinutes,\n  showDraftSelection = true,\n  locale = typeof navigator !== \"undefined\" ? navigator.language : \"en-US\",\n}: WeeklySchedulePreviewProps) => {\n  const { t } = useFormsTranslation();\n\n  const weekStart = useMemo(\n    () => startOfWeek(referenceDate, { weekStartsOn: 1 }),\n    [referenceDate]\n  );\n\n  const selectedDayIndex = useMemo(() => {\n    if (!selectedDate) return null;\n    return differenceInCalendarDays(selectedDate, weekStart);\n  }, [selectedDate, weekStart]);\n\n  const draftStartMinutes = useMemo(\n    () => parseTimeToMinutes(selectedTime),\n    [selectedTime]\n  );\n\n  const draftDurationMinutes = useMemo(() => {\n    if (typeof selectedDurationMinutes === \"number\" && selectedDurationMinutes > 0) {\n      return Math.min(selectedDurationMinutes, MINUTES_IN_DAY);\n    }\n    return DEFAULT_DRAFT_DURATION;\n  }, [selectedDurationMinutes]);\n\n  const isDraftWithinWeek =\n    selectedDayIndex !== null &&\n    selectedDayIndex >= 0 &&\n    selectedDayIndex <= 6 &&\n    draftStartMinutes !== null;\n\n  const draftEndMinutes = isDraftWithinWeek\n    ? Math.min(draftStartMinutes! + draftDurationMinutes, MINUTES_IN_DAY - 1)\n    : null;\n\n  const days = useMemo(\n    () =>\n      Array.from({ length: 7 }, (_, index) => ({\n        date: addDays(weekStart, index),\n        index,\n      })),\n    [weekStart]\n  );\n\n  const { dayLayouts, daySessionsMap, noTimeSessions, viewWindow } = useMemo(() => {\n    const dayMap = new Map<number, Array<WeeklyScheduleSession & { startMinutes: number; endMinutes: number }>>();\n    const noTimeMap = new Map<number, WeeklyScheduleSession[]>();\n    const startCandidates: number[] = [];\n    const endCandidates: number[] = [];\n\n    sessions.forEach((session) => {\n      if (!session.session_date) return;\n      const parsedDate = parseISO(session.session_date);\n      if (Number.isNaN(parsedDate.getTime())) return;\n      const dayIndex = differenceInCalendarDays(parsedDate, weekStart);\n      if (dayIndex < 0 || dayIndex > 6) return;\n\n    const startMinutes = parseTimeToMinutes(session.session_time);\n    const durationMinutes =\n      typeof session.duration_minutes === \"number\" && session.duration_minutes > 0\n        ? session.duration_minutes\n        : 60;\n    const safeEnd = startMinutes !== null ? startMinutes + durationMinutes : null;\n\n      if (startMinutes === null || safeEnd === null) {\n        const existing = noTimeMap.get(dayIndex) ?? [];\n        noTimeMap.set(dayIndex, [...existing, session]);\n        return;\n      }\n\n      const normalized = {\n        ...session,\n        startMinutes,\n        endMinutes: safeEnd,\n        duration_minutes: durationMinutes,\n      };\n\n      const daySessions = dayMap.get(dayIndex) ?? [];\n      dayMap.set(dayIndex, [...daySessions, normalized]);\n      startCandidates.push(startMinutes);\n      endCandidates.push(safeEnd);\n    });\n\n    if (isDraftWithinWeek && draftStartMinutes !== null && draftEndMinutes !== null) {\n      startCandidates.push(draftStartMinutes);\n      endCandidates.push(draftEndMinutes);\n    }\n\n    const rawStart = startCandidates.length ? Math.min(...startCandidates) : 9 * 60;\n    const rawEnd = endCandidates.length ? Math.max(...endCandidates) : 17 * 60;\n    const viewWindow = clampRange(rawStart, rawEnd);\n\n    const layoutsByDay = new Map<number, PositionedSession[]>();\n    dayMap.forEach((daySessions, dayIndex) => {\n      const layouts = buildDayLayout(daySessions).map((session) => ({\n        ...session,\n        dayIndex,\n      }));\n      layoutsByDay.set(dayIndex, layouts);\n    });\n\n    return {\n      dayLayouts: layoutsByDay,\n      daySessionsMap: dayMap,\n      noTimeSessions: noTimeMap,\n      viewWindow,\n    };\n  }, [\n    draftEndMinutes,\n    draftStartMinutes,\n    isDraftWithinWeek,\n    sessions,\n    weekStart,\n  ]);\n\n  const containerHeight = (viewWindow.end - viewWindow.start) * PIXELS_PER_MINUTE;\n  const hourMarkers = useMemo(() => {\n    const markers: Array<{ label: string; minute: number }> = [];\n    if (viewWindow.end <= viewWindow.start) {\n      return markers;\n    }\n    const firstMarker = Math.ceil(viewWindow.start / 60) * 60;\n    if (firstMarker > viewWindow.end) {\n      return markers;\n    }\n    for (let minute = firstMarker; minute <= viewWindow.end; minute += 60) {\n      markers.push({\n        label: formatTimeLabel(minute, locale),\n        minute,\n      });\n    }\n    return markers;\n  }, [viewWindow.end, viewWindow.start, locale]);\n\n  const hasDraftSelection = Boolean(isDraftWithinWeek);\n\n  if (!sessions.length && !hasDraftSelection) {\n    return (\n      <div className=\"rounded-xl border border-dashed border-primary/30 bg-primary/5 p-6 text-sm text-muted-foreground\">\n        {t(\"sessionScheduling.weekly_preview_empty\")}\n      </div>\n    );\n  }\n\n  return (\n    <TooltipProvider delayDuration={120}>\n    <div className=\"space-y-4\">\n      <div className=\"flex flex-wrap items-center justify-between gap-2\">\n        <h3 className=\"text-sm font-semibold tracking-tight text-slate-900\">\n          {t(\"sessionScheduling.weekly_preview_heading\")}\n        </h3>\n        <span className=\"text-xs font-medium uppercase tracking-wide text-muted-foreground\">\n          {format(weekStart, \"MMM d\")} â€“ {format(addDays(weekStart, 6), \"MMM d\")}\n        </span>\n      </div>\n      <div className=\"overflow-hidden rounded-xl border bg-white shadow-sm\">\n        <div className=\"grid grid-cols-[72px_repeat(7,minmax(0,1fr))] border-b bg-slate-50/70 text-xs font-medium uppercase tracking-wide text-muted-foreground\">\n          <div className=\"px-3 py-2\">{t(\"sessionScheduling.weekly_preview_time_column\")}</div>\n          {days.map(({ date, index }) => (\n            <div\n              key={index}\n              className={cn(\n                \"border-l px-3 py-2 text-center first:border-l-0\",\n                selectedDayIndex === index && \"bg-primary/10 text-primary\"\n              )}\n            >\n              <div>{new Intl.DateTimeFormat(locale, { weekday: \"short\" }).format(date)}</div>\n              <div className=\"text-[11px] font-semibold text-slate-600\">\n                {new Intl.DateTimeFormat(locale, {\n                  day: \"2-digit\",\n                  month: \"2-digit\",\n                }).format(date)}\n              </div>\n            </div>\n          ))}\n        </div>\n        <div className=\"grid grid-cols-[72px_repeat(7,minmax(0,1fr))]\">\n          <div className=\"relative border-r bg-slate-50/40\">\n            <div\n              className=\"relative\"\n              style={{ height: `${containerHeight}px` }}\n            >\n              {hourMarkers.map((marker) => {\n                const offset = (marker.minute - viewWindow.start) * PIXELS_PER_MINUTE;\n                return (\n                  <div\n                    key={marker.minute}\n                    data-testid=\"weekly-hour-marker\"\n                    className=\"absolute left-0 right-0 flex items-center justify-end pr-2 text-[11px] text-muted-foreground\"\n                    style={{ top: `${offset}px` }}\n                  >\n                    {marker.label}\n                  </div>\n                );\n              })}\n          </div>\n        </div>\n          {days.map(({ index }) => {\n            const baseDaySessions = dayLayouts.get(index) ?? [];\n            const rawDaySessions = daySessionsMap.get(index) ?? [];\n            const dayNoTime = noTimeSessions.get(index) ?? [];\n            const draftStart = draftStartMinutes ?? 0;\n            const draftEnd = draftEndMinutes ?? draftStart;\n            const shouldRenderDraft =\n              showDraftSelection &&\n              hasDraftSelection &&\n              selectedDayIndex === index &&\n              draftStartMinutes !== null &&\n              draftEndMinutes !== null;\n\n            let renderedSessions = baseDaySessions;\n            let draftLayout: PositionedSession | null = null;\n\n            if (showDraftSelection) {\n              const draftSession: WeeklyScheduleSession & {\n                startMinutes: number;\n                endMinutes: number;\n              } = {\n                id: \"__draft__\",\n                session_time: selectedTime ?? null,\n                duration_minutes: draftDurationMinutes,\n                startMinutes: draftStart,\n                endMinutes: draftEnd,\n              };\n\n              const layoutWithDraft = buildDayLayout([\n                ...rawDaySessions,\n                draftSession,\n              ]).map((session) => ({\n                ...session,\n                dayIndex: index,\n              }));\n\n              draftLayout =\n                layoutWithDraft.find((session) => session.id === draftSession.id) ??\n                null;\n\n              renderedSessions = layoutWithDraft.filter(\n                (session) => session.id !== draftSession.id\n              );\n            }\n\n            const draftBlockMetrics = showDraftSelection\n              ? (() => {\n                  const top =\n                    (draftStart - viewWindow.start) * PIXELS_PER_MINUTE;\n                  const height = Math.max(\n                    (draftEnd - draftStart) * PIXELS_PER_MINUTE,\n                    MIN_BLOCK_HEIGHT\n                  );\n                  const columnCount =\n                    draftLayout?.columnCount && draftLayout.columnCount > 0\n                      ? draftLayout.columnCount\n                      : 1;\n                  const columnIndex =\n                    draftLayout?.columnIndex && draftLayout.columnIndex >= 0\n                      ? draftLayout.columnIndex\n                      : 0;\n                  const widthPercent = 100 / columnCount;\n                  const leftPercent = (columnIndex * widthPercent).toFixed(3);\n                  const widthValue = widthPercent.toFixed(3);\n                  const gutter = columnCount > 1 ? 1 : 0;\n\n                  return {\n                    top,\n                    height,\n                    left: `calc(${leftPercent}% + ${gutter}px)`,\n                    width: `calc(${widthValue}% - ${gutter * 2}px)`,\n                    startLabel: formatTimeLabel(draftStart, locale),\n                    endLabel: formatTimeLabel(draftEnd, locale),\n                  };\n                })()\n              : null;\n\n            return (\n              <div\n                key={index}\n                className={cn(\n                  \"relative border-l first:border-l-0\",\n                  selectedDayIndex === index && \"bg-primary/5\"\n                )}\n              >\n                <div\n                  className=\"relative\"\n                  style={{ height: `${containerHeight}px` }}\n                >\n                  {hourMarkers.map((marker) => {\n                    const offset = (marker.minute - viewWindow.start) * PIXELS_PER_MINUTE;\n                    return (\n                      <div\n                        key={marker.minute}\n                        className=\"absolute left-0 right-0 border-t border-dashed border-slate-200/70\"\n                        style={{ top: `${offset}px` }}\n                        aria-hidden=\"true\"\n                      />\n                    );\n                  })}\n                  {draftBlockMetrics && shouldRenderDraft ? (\n                    <div\n                      data-testid=\"weekly-draft-selection\"\n                      aria-hidden=\"true\"\n                      className=\"pointer-events-none absolute flex flex-col items-stretch text-center\"\n                      style={{\n                        top: `${draftBlockMetrics.top}px`,\n                        left: draftBlockMetrics.left,\n                        width: draftBlockMetrics.width,\n                      }}\n                    >\n                      <div\n                        className=\"rounded-xl border border-dashed border-amber-400/80 bg-amber-50/90 px-1.5 py-1 text-[10px] font-medium uppercase tracking-wide text-amber-900 shadow-none\"\n                        style={{ height: `${draftBlockMetrics.height}px` }}\n                      >\n                        <div className=\"text-[11px] capitalize tracking-normal\">\n                          {draftBlockMetrics.startLabel} â€“ {draftBlockMetrics.endLabel}\n                        </div>\n                      </div>\n                      <div className=\"mt-1 text-[10px] font-semibold uppercase tracking-wide text-amber-700\">\n                        {t(\"sessionScheduling.weekly_preview_draft_label\")}\n                      </div>\n                    </div>\n                  ) : null}\n                  {renderedSessions.map((session) => {\n                    const topOffset =\n                      (session.startMinutes - viewWindow.start) * PIXELS_PER_MINUTE;\n                    const blockHeight = Math.max(\n                      (session.endMinutes - session.startMinutes) * PIXELS_PER_MINUTE,\n                      MIN_BLOCK_HEIGHT\n                    );\n                    const widthPercent = 100 / session.columnCount;\n                    const leftOffset = (session.columnIndex * widthPercent).toFixed(3);\n                    const widthValue = widthPercent.toFixed(3);\n                    const startLabel = formatTimeLabel(session.startMinutes, locale);\n                    const endLabel = formatTimeLabel(session.endMinutes, locale);\n                    const durationMinutes =\n                      typeof session.duration_minutes === \"number\"\n                        ? Math.max(session.duration_minutes, 0)\n                        : undefined;\n                    const formattedDuration =\n                      durationMinutes !== undefined\n                        ? formatDurationLabel(durationMinutes, t)\n                        : undefined;\n                    const gutter = session.columnCount > 1 ? 1 : 0;\n                    const tooltipDetails = [\n                      session.lead_name || t(\"sessionScheduling.unknown_client\"),\n                      session.project_name,\n                      session.session_type_name && formattedDuration\n                        ? `${session.session_type_name} â€¢ ${formattedDuration}`\n                        : formattedDuration,\n                      `${startLabel} â€“ ${endLabel}`,\n                    ].filter(Boolean);\n                    const ariaLabel = tooltipDetails.join(\" â€¢ \");\n\n                    return (\n                      <Tooltip key={session.id}>\n                        <TooltipTrigger asChild>\n                          <div\n                            data-testid={`weekly-session-${session.id}`}\n                            aria-label={ariaLabel}\n                            className={cn(\n                              \"absolute overflow-hidden rounded-xl border border-emerald-300/80 bg-emerald-50 px-1.5 py-1.5 text-left shadow-[0_16px_28px_rgba(15,118,110,0.08)] transition-all\",\n                              \"hover:border-emerald-400 hover:bg-emerald-100/90 hover:shadow-[0_20px_34px_rgba(15,118,110,0.15)]\"\n                            )}\n                            style={{\n                              top: `${topOffset}px`,\n                              height: `${blockHeight}px`,\n                              left: `calc(${leftOffset}% + ${gutter}px)`,\n                              width: `calc(${widthValue}% - ${gutter * 2}px)`,\n                            }}\n                          >\n                            <p className=\"flex-1 break-all text-[11px] font-light leading-snug text-slate-800 line-clamp-6\">\n                              {session.lead_name || t(\"sessionScheduling.unknown_client\")}\n                            </p>\n                          </div>\n                        </TooltipTrigger>\n                        <TooltipContent className=\"max-w-xs space-y-1 text-left text-sm leading-snug\">\n                          <div className=\"font-medium text-emerald-900\">\n                            {session.lead_name || t(\"sessionScheduling.unknown_client\")}\n                          </div>\n                          {session.project_name ? (\n                            <div className=\"text-emerald-800\">{session.project_name}</div>\n                          ) : null}\n                          {formattedDuration ? (\n                            <div className=\"text-muted-foreground\">\n                              {session.session_type_name\n                                ? `${session.session_type_name} â€¢ ${formattedDuration}`\n                                : formattedDuration}\n                            </div>\n                          ) : null}\n                          <div className=\"text-xs font-medium uppercase tracking-wide text-slate-500\">\n                            {startLabel} â€“ {endLabel}\n                          </div>\n                        </TooltipContent>\n                      </Tooltip>\n                    );\n                  })}\n                </div>\n                {dayNoTime.length > 0 && (\n                  <div className=\"border-t border-dashed border-slate-200 bg-slate-50/80 px-2 py-2 text-[11px] text-muted-foreground\">\n                    <div className=\"font-semibold uppercase tracking-wide\">\n                      {t(\"sessionScheduling.weekly_preview_time_tbd\")}\n                    </div>\n                    <ul className=\"mt-1 space-y-1\">\n                      {dayNoTime.map((session) => (\n                        <li key={session.id}>\n                          {session.lead_name || t(\"sessionScheduling.unknown_client\")}\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    </div>\n    </TooltipProvider>\n  );\n};\n\nexport const __testUtils = {\n  PIXELS_PER_MINUTE,\n  MIN_BLOCK_HEIGHT,\n  clampRange,\n  parseTimeToMinutes,\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/WorkflowDeleteDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/WorkflowHealthDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/ActivityForm.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[418,421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[418,421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[743,746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[743,746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen, fireEvent } from \"@/utils/testUtils\";\nimport userEvent from \"@testing-library/user-event\";\nimport { ActivityForm } from \"../shared/ActivityForm\";\nimport { useFormsTranslation } from \"@/hooks/useTypedTranslation\";\nimport React from \"react\";\n\njest.mock(\"@/hooks/useTypedTranslation\", () => ({\n  useFormsTranslation: jest.fn(),\n}));\n\nconst DateTimePickerMock = ({ value, onChange, placeholder }: any) => (\n  <div>\n    <label htmlFor=\"mock-date\">{placeholder}</label>\n    <input\n      id=\"mock-date\"\n      data-testid=\"date-input\"\n      value={value}\n      onChange={(event) => onChange(event.target.value)}\n    />\n  </div>\n);\n\njest.mock(\"@/components/ui/date-time-picker\", () => ({\n  __esModule: true,\n  default: (props: any) => <DateTimePickerMock {...props} />,\n}));\n\njest.mock(\"@/components/ui/switch\", () => ({\n  Switch: ({\n    checked,\n    onCheckedChange,\n    ...rest\n  }: {\n    checked: boolean;\n    onCheckedChange: (checked: boolean) => void;\n  }) => (\n    <button\n      type=\"button\"\n      role=\"switch\"\n      aria-checked={checked}\n      onClick={() => onCheckedChange(!checked)}\n      {...rest}\n    >\n      toggle\n    </button>\n  ),\n}));\n\ndescribe(\"ActivityForm\", () => {\n  const useFormsTranslationMock =\n    useFormsTranslation as jest.MockedFunction<typeof useFormsTranslation>;\n\n  beforeEach(() => {\n    useFormsTranslationMock.mockReturnValue({\n      t: (key: string, { ns }: { ns?: string } = {}) => {\n        const translations: Record<string, string> = {\n          \"activities.note_label\": \"Note\",\n          \"activities.set_reminder_label\": \"Set reminder\",\n          \"activities.enter_note_placeholder\": \"Write a note\",\n          \"activities.date_time_label\": \"Date & time\",\n          \"activities.add_note\": \"Add note\",\n          \"activities.add_reminder\": \"Add reminder\",\n          \"activities.saving\": \"Savingâ€¦\",\n          \"dateTimePicker.placeholder\": \"Pick date & time\",\n          \"dateTimePicker.time\": \"Time\",\n          \"dateTimePicker.today\": \"Today\",\n          \"dateTimePicker.clear\": \"Clear\",\n          \"dateTimePicker.done\": \"Done\",\n        };\n        const keyWithNamespace = ns ? `${ns}:${key}` : key;\n        return translations[keyWithNamespace] ?? translations[key] ?? key;\n      },\n    });\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it(\"submits notes and resets the form state\", async () => {\n    const user = userEvent.setup();\n    const onSubmit = jest.fn().mockResolvedValue(undefined);\n\n    render(<ActivityForm loading={false} onSubmit={onSubmit} />);\n\n    const textarea = screen.getByPlaceholderText(\"Write a note\");\n    const submitButton = screen.getByRole(\"button\", { name: \"Add note\" });\n    expect(submitButton).toBeDisabled();\n\n    await user.type(textarea, \"Meeting summary\");\n    expect(submitButton).not.toBeDisabled();\n\n    await user.click(submitButton);\n\n    expect(onSubmit).toHaveBeenCalledWith(\"Meeting summary\", false, \"\");\n    expect(textarea).toHaveValue(\"\");\n    expect(submitButton).toBeDisabled();\n  });\n\n  it(\"requires a reminder date before submission when reminder mode is active\", async () => {\n    const user = userEvent.setup();\n    const onSubmit = jest.fn().mockResolvedValue(undefined);\n\n    render(<ActivityForm loading={false} onSubmit={onSubmit} />);\n\n    const textarea = screen.getByPlaceholderText(\"Write a note\");\n    await user.type(textarea, \"Reminder to follow up\");\n\n    await user.click(screen.getByRole(\"switch\"));\n\n    expect(screen.getByText(\"Date & time\")).toBeInTheDocument();\n\n    const submitButton = screen.getByRole(\"button\", { name: \"Add reminder\" });\n    expect(submitButton).toBeDisabled();\n\n    const dateInput = screen.getByTestId(\"date-input\");\n    fireEvent.change(dateInput, {\n      target: { value: \"2025-01-05T09:00\" },\n    });\n\n    expect(submitButton).not.toBeDisabled();\n\n    await user.click(submitButton);\n\n    expect(onSubmit).toHaveBeenCalledWith(\n      \"Reminder to follow up\",\n      true,\n      \"2025-01-05T09:00\"\n    );\n    expect(screen.queryByTestId(\"date-input\")).not.toBeInTheDocument();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/ActivitySection.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/ActivityTimeline.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[437,440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[437,440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[961,964],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[961,964],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1469,1472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1469,1472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1623,1626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1623,1626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3210,3213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3210,3213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen } from \"@/utils/testUtils\";\nimport userEvent from \"@testing-library/user-event\";\nimport { ActivityTimeline } from \"../shared/ActivityTimeline\";\nimport { useFormsTranslation } from \"@/hooks/useTypedTranslation\";\nimport React from \"react\";\n\njest.mock(\"@/hooks/useTypedTranslation\", () => ({\n  useFormsTranslation: jest.fn(),\n}));\n\nconst mockReminderCard = jest.fn(\n  ({ activity, projectName, onToggleCompletion }: any) => (\n    <div data-testid={`reminder-${activity.id}`}>\n      <span>{activity.content}</span>\n      {projectName && (\n        <span data-testid={`reminder-project-${activity.id}`}>{projectName}</span>\n      )}\n      <button\n        data-testid={`reminder-toggle-${activity.id}`}\n        onClick={() => onToggleCompletion(activity.id, !activity.completed)}\n      >\n        toggle\n      </button>\n    </div>\n  )\n);\n\nconst mockActivityTimelineItem = jest.fn(\n  ({ id, content, projectName, onToggleCompletion, completed }: any) => (\n    <div data-testid={`timeline-item-${id}`}>\n      <span>{content}</span>\n      {projectName && (\n        <span data-testid={`timeline-project-${id}`}>{projectName}</span>\n      )}\n      {onToggleCompletion && (\n        <button\n          data-testid={`timeline-toggle-${id}`}\n          onClick={() => onToggleCompletion(id, !completed)}\n        >\n          toggle\n        </button>\n      )}\n    </div>\n  )\n);\n\njest.mock(\"@/components/ReminderCard\", () => ({\n  __esModule: true,\n  default: (props: any) => mockReminderCard(props),\n}));\n\njest.mock(\"@/components/shared/ActivityTimelineItem\", () => ({\n  __esModule: true,\n  ActivityTimelineItem: (props: any) => mockActivityTimelineItem(props),\n}));\n\ndescribe(\"ActivityTimeline\", () => {\n  const useFormsTranslationMock =\n    useFormsTranslation as jest.MockedFunction<typeof useFormsTranslation>;\n\n  beforeEach(() => {\n    useFormsTranslationMock.mockReturnValue({\n      t: (key: string) => key,\n    });\n    mockReminderCard.mockClear();\n    mockActivityTimelineItem.mockClear();\n  });\n\n  it(\"shows an empty state when there are no activities\", () => {\n    render(\n      <ActivityTimeline\n        activities={[]}\n        leadName=\"Lead Name\"\n        onToggleCompletion={jest.fn()}\n      />\n    );\n\n    expect(screen.getByText(\"activities.no_activities\")).toBeInTheDocument();\n  });\n\n  it(\"renders reminders and notes with project context and forwards completion toggles\", async () => {\n    const user = userEvent.setup();\n    const toggleCompletion = jest.fn();\n    const activities = [\n      {\n        id: \"reminder-1\",\n        type: \"reminder\",\n        content: \"Follow up with client\",\n        reminder_date: \"2025-01-10T12:00:00.000Z\",\n        reminder_time: \"12:00\",\n        created_at: \"2025-01-09T04:00:00.000Z\",\n        completed: false,\n        lead_id: \"lead-1\",\n        user_id: \"user-1\",\n        project_id: \"project-1\",\n      },\n      {\n        id: \"note-1\",\n        type: \"note\",\n        content: \"Client prefers morning calls\",\n        created_at: \"2025-01-08T12:00:00.000Z\",\n        completed: true,\n        lead_id: \"lead-1\",\n        user_id: \"user-1\",\n        project_id: \"project-2\",\n      },\n    ];\n\n    render(\n      <ActivityTimeline\n        activities={activities as any}\n        projects={[\n          { id: \"project-1\", name: \"Project Phoenix\" },\n          { id: \"project-2\", name: \"Project Atlas\" },\n        ]}\n        leadName=\"Lead Name\"\n        onToggleCompletion={toggleCompletion}\n      />\n    );\n\n    expect(mockReminderCard).toHaveBeenCalledWith(\n      expect.objectContaining({\n        activity: expect.objectContaining({ id: \"reminder-1\" }),\n        leadName: \"Lead Name\",\n        projectName: \"Project Phoenix\",\n        onToggleCompletion: expect.any(Function),\n        hideStatusBadge: expect.any(Boolean),\n      })\n    );\n\n    expect(\n      screen.getByTestId(\"reminder-project-reminder-1\")\n    ).toHaveTextContent(\"Project Phoenix\");\n\n    expect(mockActivityTimelineItem).toHaveBeenCalledWith(\n      expect.objectContaining({\n        id: \"note-1\",\n        content: \"Client prefers morning calls\",\n        projectName: \"Project Atlas\",\n        onToggleCompletion: undefined,\n      })\n    );\n\n    expect(\n      screen.queryByTestId(\"timeline-toggle-note-1\")\n    ).not.toBeInTheDocument();\n\n    await user.click(screen.getByTestId(\"reminder-toggle-reminder-1\"));\n\n    expect(toggleCompletion).toHaveBeenCalledWith(\"reminder-1\", true);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/ActivityTimelineItem.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/AddLeadDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/AddPaymentDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/AppSidebar.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[308,311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[308,311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[588,591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[588,591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1602,1605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1602,1605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1727,1730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1727,1730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { render, screen } from \"@testing-library/react\";\nimport { MemoryRouter } from \"react-router-dom\";\n\nconst sanitizeTestId = (title: string) =>\n  title.toLowerCase().replace(/[^a-z0-9]+/g, \"-\");\n\nconst sidebarNavItemMock = jest.fn(\n  ({ title, children, isActive, isLocked }: any) => (\n    <div\n      data-testid={`nav-${sanitizeTestId(String(title))}`}\n      data-active={isActive ?? false}\n      data-locked={isLocked ?? false}\n    >\n      {title}\n      {children}\n    </div>\n  )\n);\n\nconst sidebarSubItemMock = jest.fn(\n  ({ title, isActive, isLocked }: any) => (\n    <div\n      data-testid={`sub-${sanitizeTestId(String(title))}`}\n      data-active={isActive ?? false}\n      data-locked={isLocked ?? false}\n    >\n      {title}\n    </div>\n  )\n);\n\njest.mock(\"@/components/ui/sidebar\", () => ({\n  Sidebar: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n  SidebarHeader: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n  SidebarContent: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n  SidebarFooter: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n  SidebarMenu: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n  SidebarProvider: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n}));\n\njest.mock(\"@/components/sidebar/SidebarCategory\", () => ({\n  SidebarCategory: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n}));\n\njest.mock(\"@/components/sidebar/SidebarNavItem\", () => ({\n  SidebarNavItem: (props: any) => sidebarNavItemMock(props),\n}));\n\njest.mock(\"@/components/sidebar/SidebarSubItem\", () => ({\n  SidebarSubItem: (props: any) => sidebarSubItemMock(props),\n}));\n\njest.mock(\"@/components/modals/HelpModal\", () => ({\n  HelpModal: () => <div data-testid=\"help-modal\" />, \n}));\n\njest.mock(\"@/components/UserMenu\", () => ({\n  UserMenu: () => <div data-testid=\"user-menu\" />, \n}));\n\njest.mock(\"@/components/ui/sheet\", () => ({\n  Sheet: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n  SheetContent: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n  SheetHeader: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n  SheetTitle: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n}));\n\njest.mock(\"@/hooks/useTypedTranslation\", () => ({\n  useNavigationTranslation: jest.fn(),\n}));\n\njest.mock(\"@/contexts/OnboardingContext\", () => ({\n  useOnboarding: jest.fn(),\n}));\n\njest.mock(\"@/hooks/useUserRole\", () => ({\n  useUserRole: jest.fn(),\n}));\n\njest.mock(\"@/hooks/use-mobile\", () => ({\n  useIsMobile: jest.fn(),\n}));\n\njest.mock(\"@/assets/Logo.png\", () => \"logo-mock.png\", { virtual: true });\n\nimport { AppSidebar } from \"../AppSidebar\";\nimport { useNavigationTranslation } from \"@/hooks/useTypedTranslation\";\nimport { useOnboarding } from \"@/contexts/OnboardingContext\";\nimport { useUserRole } from \"@/hooks/useUserRole\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\n\ndescribe(\"AppSidebar\", () => {\n  const renderSidebar = (initialPath: string = \"/\") =>\n    render(\n      <MemoryRouter initialEntries={[initialPath]}>\n        <AppSidebar />\n      </MemoryRouter>\n    );\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n\n    (useNavigationTranslation as jest.Mock).mockReturnValue({\n      t: (key: string) => key,\n    });\n\n    (useOnboarding as jest.Mock).mockReturnValue({\n      shouldLockNavigation: false,\n      loading: false,\n    });\n\n    (useIsMobile as jest.Mock).mockReturnValue(false);\n\n    (useUserRole as jest.Mock).mockReturnValue({\n      isAdminOrSupport: jest.fn(() => false),\n    });\n  });\n\n  it(\"marks the current route as active\", () => {\n    renderSidebar(\"/projects\");\n\n    expect(screen.getByTestId(\"nav-menu-projects\")).toHaveAttribute(\"data-active\", \"true\");\n    expect(screen.getByTestId(\"nav-menu-dashboard\")).toHaveAttribute(\"data-active\", \"false\");\n  });\n\n  it(\"renders administration link only for admin or support roles\", () => {\n    const initialRender = renderSidebar(\"/\");\n    expect(screen.queryByTestId(\"nav-menu-administration\")).toBeNull();\n\n    initialRender.unmount();\n\n    (useUserRole as jest.Mock).mockReturnValue({\n      isAdminOrSupport: jest.fn(() => true),\n    });\n\n    renderSidebar(\"/\");\n    expect(screen.getByTestId(\"nav-menu-administration\")).toBeInTheDocument();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/BaseOnboardingModal.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/CalendarTimePicker.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":96,"column":22,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":96,"endColumn":63}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen, waitFor } from \"@/utils/testUtils\";\nimport { CalendarTimePicker } from \"../CalendarTimePicker\";\n\njest.mock(\"@/components/TimeSlotPicker\", () => ({\n  TimeSlotPicker: () => <div data-testid=\"time-slot-picker\" />,\n}));\njest.mock(\"react-calendar/dist/Calendar.css\", () => ({}));\njest.mock(\"@/components/react-calendar.css\", () => ({}));\njest.mock(\"@/lib/organizationUtils\", () => ({\n  getUserOrganizationId: jest.fn(() => Promise.resolve(\"org-1\")),\n}));\njest.mock(\"@/hooks/useTypedTranslation\", () => ({\n  useFormsTranslation: () => ({ t: (key: string) => key }),\n  useCommonTranslation: () => ({ t: (key: string) => key }),\n  useMessagesTranslation: () => ({ t: (key: string) => key }),\n}));\n\nconst scrollIntoViewMock = jest.fn();\n\nbeforeAll(() => {\n  Object.defineProperty(HTMLElement.prototype, \"scrollIntoView\", {\n    configurable: true,\n    value: scrollIntoViewMock,\n  });\n\n  Object.defineProperty(window, \"matchMedia\", {\n    writable: true,\n    value: jest.fn().mockImplementation(() => ({\n      matches: false,\n      addListener: jest.fn(),\n      removeListener: jest.fn(),\n      addEventListener: jest.fn(),\n      removeEventListener: jest.fn(),\n      dispatchEvent: jest.fn(),\n    })),\n  });\n});\n\nconst eqCalls: Array<{ field: string; value: unknown }> = [];\nconst gteCalls: Array<{ field: string; value: unknown }> = [];\nconst lteCalls: Array<{ field: string; value: unknown }> = [];\n\njest.mock(\"@/integrations/supabase/client\", () => {\n  const authGetUserMock = jest.fn(() =>\n    Promise.resolve({ data: { user: { id: \"user-1\" } }, error: null })\n  );\n\nconst queryChain = {\n  eq(field: string, value: unknown) {\n    eqCalls.push({ field, value });\n    return queryChain;\n  },\n    gte(field: string, value: unknown) {\n      gteCalls.push({ field, value });\n      return queryChain;\n    },\n    lte(field: string, value: unknown) {\n      lteCalls.push({ field, value });\n      return Promise.resolve({\n        data: [\n          {\n            id: \"session-1\",\n            session_date: \"2024-05-21\",\n            session_time: \"10:00\",\n            session_type_id: \"type-1\",\n            leads: { name: \"Alex\" },\n            projects: { name: \"Wedding\" },\n            status: \"planned\",\n            session_types: { duration_minutes: 90 },\n          },\n        ],\n        error: null,\n      });\n    },\n  };\n\n  return {\n    supabase: {\n      auth: {\n        getUser: authGetUserMock,\n      },\n      from(table: string) {\n        if (table === \"sessions\") {\n          return {\n            select: () => queryChain,\n          };\n        }\n        return {\n          select: () => ({ eq: () => ({ maybeSingle: jest.fn() }) }),\n        };\n      },\n    },\n  };\n});\n\nconst { supabase } = require(\"@/integrations/supabase/client\");\nconst authGetUserMock = supabase.auth.getUser as jest.Mock;\n\nafterEach(() => {\n  jest.clearAllMocks();\n  scrollIntoViewMock.mockReset();\n  eqCalls.length = 0;\n  gteCalls.length = 0;\n  lteCalls.length = 0;\n});\n\ndescribe(\"CalendarTimePicker\", () => {\n  it(\"invokes smooth scroll when planned sessions load\", async () => {\n    const { rerender } = render(\n      <CalendarTimePicker\n        selectedDate={undefined}\n        selectedTime=\"\"\n        onDateChange={jest.fn()}\n        onTimeChange={jest.fn()}\n        onDateStringChange={jest.fn()}\n      />\n    );\n\n    await waitFor(() => expect(eqCalls.length).toBeGreaterThanOrEqual(2));\n\n    rerender(\n      <CalendarTimePicker\n        selectedDate={new Date(\"2024-05-21T00:00:00\")}\n        selectedTime=\"10:00\"\n        onDateChange={jest.fn()}\n        onTimeChange={jest.fn()}\n        onDateStringChange={jest.fn()}\n      />\n    );\n\n    await screen.findByText(/sessionScheduling.planned_sessions_on/i);\n    await screen.findByText(\"sessionScheduling.weekly_preview_heading\");\n    await waitFor(() => expect(scrollIntoViewMock).toHaveBeenCalled());\n\n    expect(authGetUserMock).toHaveBeenCalled();\n    expect(eqCalls).toEqual(\n      expect.arrayContaining([\n        { field: \"organization_id\", value: \"org-1\" },\n        { field: \"status\", value: \"planned\" },\n      ])\n    );\n    expect(gteCalls[0]?.field).toBe(\"session_date\");\n    expect(lteCalls[0]?.field).toBe(\"session_date\");\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/CreateWorkflowSheet.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/DeadSimpleSessionBanner.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1491,1494],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1491,1494],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1580,1583],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1580,1583],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1684,1687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1684,1687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1795,1798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1795,1798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":116,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":119,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1915,1918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1915,1918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { fireEvent, render, screen } from \"@/utils/testUtils\";\nimport DeadSimpleSessionBanner from \"../DeadSimpleSessionBanner\";\nimport { useOrganizationSettings } from \"@/hooks/useOrganizationSettings\";\nimport { getRelativeDate, isOverdueSession } from \"@/lib/dateUtils\";\nimport { getDisplaySessionName } from \"@/lib/sessionUtils\";\nimport { useFormsTranslation, useMessagesTranslation } from \"@/hooks/useTypedTranslation\";\n\ntype Mocked<T> = T extends (...args: infer P) => infer R ? jest.Mock<R, P> : never;\n\njest.mock(\"@/hooks/useOrganizationSettings\", () => ({\n  useOrganizationSettings: jest.fn(),\n}));\n\njest.mock(\"@/lib/dateUtils\", () => ({\n  getRelativeDate: jest.fn(),\n  isOverdueSession: jest.fn(),\n}));\n\njest.mock(\"@/lib/sessionUtils\", () => ({\n  getDisplaySessionName: jest.fn(),\n}));\n\njest.mock(\"@/components/SessionStatusBadge\", () => ({\n  __esModule: true,\n  SessionStatusBadge: ({ currentStatus }: { currentStatus: string }) => (\n    <div data-testid=\"session-status-badge\">{currentStatus}</div>\n  ),\n  default: ({ currentStatus }: { currentStatus: string }) => (\n    <div data-testid=\"session-status-badge\">{currentStatus}</div>\n  ),\n}));\n\njest.mock(\"@/hooks/useTypedTranslation\", () => ({\n  useFormsTranslation: jest.fn(),\n  useMessagesTranslation: jest.fn(),\n}));\n\ndescribe(\"DeadSimpleSessionBanner\", () => {\n  const organizationSettingsMock = useOrganizationSettings as unknown as jest.Mock;\n  const getRelativeDateMock: Mocked<typeof getRelativeDate> = getRelativeDate as any;\n  const isOverdueSessionMock: Mocked<typeof isOverdueSession> = isOverdueSession as any;\n  const getDisplaySessionNameMock: Mocked<typeof getDisplaySessionName> = getDisplaySessionName as any;\n  const useFormsTranslationMock: jest.MockedFunction<typeof useFormsTranslation> = useFormsTranslation as any;\n  const useMessagesTranslationMock: jest.MockedFunction<typeof useMessagesTranslation> = useMessagesTranslation as any;\n\n  const translations = {\n    \"relativeDates.today\": \"Today\",\n    \"relativeDates.tomorrow\": \"Tomorrow\",\n    \"relativeDates.yesterday\": \"Yesterday\",\n    \"relativeDates.past_due\": \"Past due\",\n    \"sessionLabels.project\": \"Project\",\n  } as const;\n\n  const baseSession = {\n    id: \"session-1\",\n    session_name: \"Strategy Session\",\n    session_date: \"2024-10-20\",\n    session_time: \"09:30\",\n    status: \"planned\" as const,\n    lead_id: \"lead-1\",\n  };\n\n  beforeEach(() => {\n    organizationSettingsMock.mockReturnValue({ settings: { time_format: \"12h\" } });\n    getDisplaySessionNameMock.mockReturnValue(\"Strategy Session\");\n    const translator = {\n      t: (key: string) => translations[key as keyof typeof translations] ?? key,\n    };\n\n    useFormsTranslationMock.mockReturnValue(translator);\n    useMessagesTranslationMock.mockReturnValue(translator);\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it(\"shows today's indicator and triggers click handler\", () => {\n    getRelativeDateMock.mockReturnValue(\"Today\");\n    isOverdueSessionMock.mockReturnValue(false);\n\n    const onClick = jest.fn();\n\n    render(\n      <DeadSimpleSessionBanner\n        session={{ ...baseSession, notes: \"Discuss roadmap\" }}\n        onClick={onClick}\n      />\n    );\n\n    const todayLabels = screen.getAllByText(\"Today\");\n    expect(todayLabels.length).toBeGreaterThanOrEqual(1);\n    expect(screen.getByText(\"Strategy Session\")).toBeInTheDocument();\n    expect(screen.getByText(\"Discuss roadmap\")).toBeInTheDocument();\n    expect(screen.getByText(\"09:30 AM\")).toBeInTheDocument();\n    expect(screen.getByTestId(\"session-status-badge\").textContent).toBe(\"planned\");\n\n    fireEvent.click(screen.getByText(\"Strategy Session\"));\n\n    expect(onClick).toHaveBeenCalledWith(\"session-1\");\n  });\n\n  it(\"renders overdue state with project name and badge\", () => {\n    getRelativeDateMock.mockReturnValue(\"Next Week\");\n    isOverdueSessionMock.mockReturnValue(true);\n    getDisplaySessionNameMock.mockReturnValue(\"Planning Call\");\n\n    const onClick = jest.fn();\n\n    render(\n      <DeadSimpleSessionBanner\n        session={{\n          ...baseSession,\n          id: \"session-2\",\n          session_name: \"Planning Call\",\n          session_date: \"2024-10-01\",\n          session_time: undefined,\n          status: \"no_show\",\n          projects: { name: \"Q4 Launch\" },\n        }}\n        onClick={onClick}\n      />\n    );\n\n    expect(screen.getByText(\"Past due\")).toBeInTheDocument();\n    expect(screen.getByText(\"Project: Q4 Launch\")).toBeInTheDocument();\n\n    fireEvent.click(screen.getByText(\"Planning Call\"));\n\n    expect(onClick).toHaveBeenCalledWith(\"session-2\");\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/EditLeadDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/EditPaymentDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/EnhancedAddLeadDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/EnhancedEditLeadDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/EnhancedSessionsSection.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/ErrorBoundary.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[248,251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[248,251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { render, screen, fireEvent, waitFor } from \"@testing-library/react\";\nimport ErrorBoundary from \"../ErrorBoundary\";\n\njest.mock(\"react-i18next\", () => ({\n  withTranslation: () =>\n    (Component: React.ComponentType<any>) =>\n      function WithTranslationWrapper(props: Record<string, unknown>) {\n        return (\n          <Component\n            {...props}\n            t={(key: string, options?: Record<string, string>) =>\n              options?.reference ? `${key}:${options.reference}` : key\n            }\n          />\n        );\n      },\n}));\n\ndescribe(\"ErrorBoundary\", () => {\n  let consoleErrorSpy: jest.SpyInstance;\n  let originalClipboard: typeof navigator.clipboard;\n\n  beforeEach(() => {\n    consoleErrorSpy = jest\n      .spyOn(console, \"error\")\n      .mockImplementation(() => undefined);\n    originalClipboard = navigator.clipboard;\n    Object.assign(navigator, {\n      clipboard: {\n        writeText: jest.fn().mockResolvedValue(undefined),\n      },\n    });\n  });\n\n  afterEach(() => {\n    consoleErrorSpy.mockRestore();\n    Object.assign(navigator, { clipboard: originalClipboard });\n  });\n\n  it(\"renders children when no error occurs\", () => {\n    render(\n      <ErrorBoundary>\n        <div data-testid=\"safe-child\">Content</div>\n      </ErrorBoundary>\n    );\n\n    expect(screen.getByTestId(\"safe-child\")).toBeInTheDocument();\n    expect(consoleErrorSpy).not.toHaveBeenCalled();\n  });\n\n  it(\"renders default fallback UI when an error is thrown\", async () => {\n    const onError = jest.fn();\n\n    const ProblemChild = () => {\n      throw new Error(\"Boom\");\n    };\n\n    render(\n      <ErrorBoundary onError={onError}>\n        <ProblemChild />\n      </ErrorBoundary>\n    );\n\n    expect(await screen.findByText(\"errorBoundary.title\")).toBeInTheDocument();\n    expect(screen.getByText(\"Boom\")).toBeInTheDocument();\n    expect(screen.getByRole(\"button\", { name: \"buttons.tryAgain\" })).toBeInTheDocument();\n    expect(screen.getByRole(\"button\", { name: \"buttons.reload\" })).toBeInTheDocument();\n    expect(onError).toHaveBeenCalled();\n  });\n\n  it(\"supports providing a custom fallback component\", () => {\n    const ProblemChild = () => {\n      throw new Error(\"Boom\");\n    };\n\n    render(\n      <ErrorBoundary fallback={<div data-testid=\"custom-fallback\" />}> \n        <ProblemChild />\n      </ErrorBoundary>\n    );\n\n    expect(screen.getByTestId(\"custom-fallback\")).toBeInTheDocument();\n    expect(screen.queryByText(\"errorBoundary.title\")).not.toBeInTheDocument();\n  });\n\n  it(\"copies error details to clipboard when requested\", async () => {\n    const ProblemChild = () => {\n      throw new Error(\"Boom\");\n    };\n\n    render(\n      <ErrorBoundary>\n        <ProblemChild />\n      </ErrorBoundary>\n    );\n\n    const copyButton = await screen.findByRole(\"button\", { name: \"buttons.copy\" });\n    fireEvent.click(copyButton);\n\n    await waitFor(() => {\n      expect(navigator.clipboard.writeText).toHaveBeenCalledWith(\n        expect.stringContaining(\"Boom\")\n      );\n    });\n  });\n\n  it(\"provides contextual summary for reference errors\", async () => {\n    const ProblemChild = () => {\n      throw new ReferenceError(\"foo is not defined\");\n    };\n\n    render(\n      <ErrorBoundary>\n        <ProblemChild />\n      </ErrorBoundary>\n    );\n\n    expect(\n      await screen.findByText(\"errorBoundary.missingReference:foo\")\n    ).toBeInTheDocument();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/ExitGuidanceModeButton.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/FilterBar.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/GlobalSearch.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/GuidedStepProgress.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[449,452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[449,452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { act, render, screen } from \"@/utils/testUtils\";\nimport { GuidedStepProgress } from \"../GuidedStepProgress\";\nimport { useFormsTranslation } from \"@/hooks/useTypedTranslation\";\n\ntype Mocked<T> = jest.MockedFunction<T>;\n\njest.mock(\"@/hooks/useTypedTranslation\", () => ({\n  useFormsTranslation: jest.fn(),\n}));\n\ndescribe(\"GuidedStepProgress\", () => {\n  const useFormsTranslationMock: Mocked<typeof useFormsTranslation> = useFormsTranslation as any;\n  const translations = {\n    \"progress.tasks_complete\": \"tasks complete\",\n  } as const;\n\n  beforeEach(() => {\n    useFormsTranslationMock.mockReturnValue({\n      t: (key: string) => translations[key as keyof typeof translations] ?? key,\n    });\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n    jest.useRealTimers();\n  });\n\n  it(\"renders the target value immediately when animation is disabled\", () => {\n    render(\n      <GuidedStepProgress\n        currentValue={2}\n        targetValue={8}\n        totalSteps={10}\n        animate={false}\n      />\n    );\n\n    const fraction = screen.getByText((content, element) =>\n      element?.classList.contains(\"tabular-nums\") && content.replace(/\\s+/g, \"\") === \"8/10\"\n    );\n    expect(fraction).toBeInTheDocument();\n\n    const indicator = screen.getByRole(\"progressbar\").querySelector('[style*=\"translateX\"]');\n    expect(indicator).toHaveStyle({ transform: \"translateX(-20%)\" });\n  });\n\n  it(\"animates towards the target value when enabled\", () => {\n    jest.useFakeTimers({ doNotFake: [\"performance\"] });\n\n    render(\n      <GuidedStepProgress\n        currentValue={1}\n        targetValue={6}\n        totalSteps={10}\n      />\n    );\n\n    act(() => {\n      jest.runAllTimers();\n    });\n\n    const fraction = screen.getByText((content, element) =>\n      element?.classList.contains(\"tabular-nums\") && content.replace(/\\s+/g, \"\") === \"6/10\"\n    );\n    expect(fraction).toBeInTheDocument();\n\n    const indicator = screen.getByRole(\"progressbar\").querySelector('[style*=\"translateX\"]');\n    expect(indicator).toHaveStyle({ transform: \"translateX(-40%)\" });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/LanguageSwitcher.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/LeadActivitySection.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[750,753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[750,753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1056,1059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1056,1059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1109,1112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1109,1112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1649,1652],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1649,1652],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1697,1700],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1697,1700],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { fireEvent, render, screen, waitFor } from \"@/utils/testUtils\";\nimport { LeadActivitySection } from \"../LeadActivitySection\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\nimport { useFormsTranslation } from \"@/hooks/useTypedTranslation\";\nimport { toast } from \"@/hooks/use-toast\";\n\njest.mock(\"@/hooks/use-toast\", () => ({\n  useToast: jest.fn(() => ({ toast: jest.fn() })),\n  toast: jest.fn(),\n}));\n\njest.mock(\"@/hooks/useTypedTranslation\", () => ({\n  useFormsTranslation: jest.fn(),\n}));\n\njest.mock(\"@/lib/organizationUtils\", () => ({\n  getUserOrganizationId: jest.fn(),\n}));\n\njest.mock(\"@/components/shared/ActivityForm\", () => ({\n  ActivityForm: ({ onSubmit }: any) => (\n    <div>\n      <button type=\"button\" data-testid=\"submit-activity\" onClick={() => onSubmit(\"Mock activity\", false)}>\n        submit-activity\n      </button>\n    </div>\n  ),\n}));\n\njest.mock(\"@/components/shared/ActivityTimeline\", () => ({\n  ActivityTimeline: ({ activities, onToggleCompletion }: any) => (\n    <div>\n      {activities.map((activity: any) => (\n        <div key={activity.id}>\n          <span>{activity.content}</span>\n          {onToggleCompletion && (\n            <button\n              type=\"button\"\n              data-testid={`toggle-activity-${activity.id}`}\n              onClick={() => onToggleCompletion(activity.id, !activity.completed)}\n            >\n              toggle\n            </button>\n          )}\n        </div>\n      ))}\n    </div>\n  ),\n}));\n\njest.mock(\"@/components/ui/segmented-control\", () => ({\n  SegmentedControl: ({ value, onValueChange, options }: any) => (\n    <div>\n      {options.map((option: any) => (\n        <button\n          key={option.value}\n          type=\"button\"\n          data-testid={`segment-${option.value}`}\n          onClick={() => onValueChange(option.value)}\n        >\n          {option.label}\n        </button>\n      ))}\n      <span data-testid=\"current-segment\">{value}</span>\n    </div>\n  ),\n}));\n\njest.mock(\"@/integrations/supabase/client\", () => ({\n  supabase: {\n    from: jest.fn(),\n    auth: {\n      getUser: jest.fn(),\n    },\n  },\n}));\n\ndescribe(\"LeadActivitySection\", () => {\n  const mockUseFormsTranslation = useFormsTranslation as jest.Mock;\n  const mockGetUserOrganizationId = getUserOrganizationId as jest.Mock;\n  const supabaseFromMock = supabase.from as jest.Mock;\n  const supabaseAuthGetUserMock = supabase.auth.getUser as jest.Mock;\n  const toastMock = toast as jest.Mock;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    toastMock.mockReset();\n\n    mockUseFormsTranslation.mockReturnValue({\n      t: (key: string) => key,\n    });\n    mockGetUserOrganizationId.mockResolvedValue(\"org-123\");\n    supabaseAuthGetUserMock.mockResolvedValue({ data: { user: { id: \"user-1\" } }, error: null });\n  });\n\n  const setupSupabase = () => {\n    const leadActivities = [\n      {\n        id: \"lead-activity-1\",\n        type: \"note\",\n        content: \"Lead note\",\n        reminder_date: null,\n        reminder_time: null,\n        created_at: \"2025-02-01T10:00:00.000Z\",\n        completed: false,\n        lead_id: \"lead-1\",\n        user_id: \"user-1\",\n      },\n    ];\n\n    const projectActivities = [\n      {\n        id: \"project-activity-1\",\n        type: \"reminder\",\n        content: \"Project reminder\",\n        reminder_date: \"2025-02-05\",\n        reminder_time: \"09:00\",\n        created_at: \"2025-02-01T10:00:00.000Z\",\n        completed: true,\n        lead_id: \"lead-1\",\n        user_id: \"user-1\",\n        project_id: \"project-1\",\n      },\n    ];\n\n    const projects = [{ id: \"project-1\", name: \"Project A\" }];\n    const projectIds = [{ id: \"project-1\" }];\n    const sessions = [{ id: \"session-1\" }];\n\n    const leadAuditLogs = [\n      {\n        id: \"audit-1\",\n        user_id: \"user-1\",\n        entity_type: \"lead\",\n        entity_id: \"lead-1\",\n        action: \"created\",\n        created_at: \"2025-02-01T10:00:00.000Z\",\n      },\n    ];\n\n    const projectAuditLogs = [\n      {\n        id: \"audit-2\",\n        user_id: \"user-1\",\n        entity_type: \"project\",\n        entity_id: \"project-1\",\n        action: \"created\",\n        new_values: { name: \"Project A\" },\n        created_at: \"2025-02-02T10:00:00.000Z\",\n      },\n    ];\n\n    const sessionAuditLogs = [\n      {\n        id: \"audit-3\",\n        user_id: \"user-1\",\n        entity_type: \"session\",\n        entity_id: \"session-1\",\n        action: \"created\",\n        new_values: { session_name: \"Kickoff\" },\n        created_at: \"2025-02-03T10:00:00.000Z\",\n      },\n    ];\n\n    let activitiesSelectCall = 0;\n    const activitiesSelectMock = jest.fn(() => {\n      activitiesSelectCall += 1;\n      if (activitiesSelectCall === 1 || activitiesSelectCall >= 3) {\n        return {\n          eq: jest.fn(() => ({\n            is: jest.fn(() => ({\n              order: jest.fn(() => Promise.resolve({ data: leadActivities, error: null })),\n            })),\n          })),\n        };\n      }\n      return {\n        eq: jest.fn(() => ({\n          not: jest.fn(() => ({\n            order: jest.fn(() => Promise.resolve({ data: projectActivities, error: null })),\n          })),\n        })),\n      };\n    });\n\n    const projectsSelectMock = jest.fn((fields: string) => {\n      if (fields.includes(\"name\")) {\n        return {\n          eq: jest.fn(() => Promise.resolve({ data: projects, error: null })),\n        };\n      }\n      return {\n        eq: jest.fn(() => Promise.resolve({ data: projectIds, error: null })),\n      };\n    });\n\n    const sessionsSelectMock = jest.fn(() => ({\n      eq: jest.fn(() => Promise.resolve({ data: sessions, error: null })),\n    }));\n\n    let auditSelectCall = 0;\n    const auditSelectMock = jest.fn(() => {\n      auditSelectCall += 1;\n      if (auditSelectCall === 1) {\n        return {\n          eq: jest.fn(() => ({\n            order: jest.fn(() => Promise.resolve({ data: leadAuditLogs, error: null })),\n          })),\n        };\n      }\n      if (auditSelectCall === 2) {\n        return {\n          in: jest.fn(() => ({\n            order: jest.fn(() => Promise.resolve({ data: projectAuditLogs, error: null })),\n          })),\n        };\n      }\n      return {\n        in: jest.fn(() => ({\n          order: jest.fn(() => Promise.resolve({ data: sessionAuditLogs, error: null })),\n        })),\n      };\n    });\n\n    const insertSingleMock = jest.fn(() => Promise.resolve({ data: { id: \"new-activity\" }, error: null }));\n    const insertSelectMock = jest.fn(() => ({ single: insertSingleMock }));\n    const insertMock = jest.fn(() => ({ select: insertSelectMock }));\n    const updateEqMock = jest.fn(() => Promise.resolve({ error: null }));\n    const updateMock = jest.fn(() => ({ eq: updateEqMock }));\n\n    supabaseFromMock.mockImplementation((table: string) => {\n      if (table === \"activities\") {\n        return {\n          select: activitiesSelectMock,\n          insert: insertMock,\n          update: updateMock,\n        };\n      }\n      if (table === \"projects\") {\n        return {\n          select: projectsSelectMock,\n        };\n      }\n      if (table === \"sessions\") {\n        return {\n          select: sessionsSelectMock,\n        };\n      }\n      if (table === \"audit_log\") {\n        return {\n          select: auditSelectMock,\n        };\n      }\n      return {};\n    });\n\n    return {\n      insertMock,\n      insertSelectMock,\n      insertSingleMock,\n      updateMock,\n      updateEqMock,\n      activitiesSelectMock,\n    };\n  };\n\n  it(\"renders lead and project activities and toggles to history\", async () => {\n    setupSupabase();\n\n    render(<LeadActivitySection leadId=\"lead-1\" leadName=\"Jane Doe\" />);\n\n    await waitFor(() => {\n      expect(screen.getByText(\"Lead note\")).toBeInTheDocument();\n      expect(screen.getByText(\"Project reminder\")).toBeInTheDocument();\n    });\n\n    fireEvent.click(screen.getByTestId(\"segment-history\"));\n\n    await waitFor(() => {\n      expect(screen.getByText(\"activityLogs.lead_created\")).toBeInTheDocument();\n      expect(screen.getByText('Project \"Project A\" created')).toBeInTheDocument();\n      expect(screen.getByText('Session \"Kickoff\" created')).toBeInTheDocument();\n    });\n  });\n\n  it(\"submits a new activity and toggles completion\", async () => {\n    const { insertMock, updateMock, updateEqMock, activitiesSelectMock } = setupSupabase();\n    const onActivityUpdated = jest.fn();\n\n    render(<LeadActivitySection leadId=\"lead-1\" leadName=\"Jane Doe\" onActivityUpdated={onActivityUpdated} />);\n\n    await waitFor(() => {\n      expect(screen.getByText(\"Lead note\")).toBeInTheDocument();\n    });\n\n    fireEvent.click(screen.getByTestId(\"submit-activity\"));\n\n    await waitFor(() => {\n      expect(insertMock).toHaveBeenCalledWith(expect.objectContaining({\n        user_id: \"user-1\",\n        lead_id: \"lead-1\",\n        type: \"note\",\n        content: \"Mock activity\",\n        organization_id: \"org-123\",\n      }));\n    });\n\n    expect(toastMock).toHaveBeenNthCalledWith(1, {\n      title: \"Success\",\n      description: \"Note added successfully.\",\n    });\n\n    expect(onActivityUpdated).toHaveBeenCalledTimes(1);\n    expect(activitiesSelectMock).toHaveBeenCalledTimes(3);\n\n    fireEvent.click(screen.getByTestId(\"toggle-activity-lead-activity-1\"));\n\n    await waitFor(() => {\n      expect(updateMock).toHaveBeenCalledWith({ completed: true });\n      expect(updateEqMock).toHaveBeenCalledWith(\"id\", \"lead-activity-1\");\n    });\n\n    expect(toastMock).toHaveBeenNthCalledWith(2, {\n      title: \"Task marked as completed\",\n      description: \"Task status updated successfully.\",\n    });\n\n    expect(onActivityUpdated).toHaveBeenCalledTimes(2);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/MobileStickyNav.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/OfflineBanner.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/OnboardingModal.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[904,907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[904,907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1220,1223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1220,1223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1450,1453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1450,1453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1881,1884],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1881,1884],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1992,1995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1992,1995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2315,2318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2315,2318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { fireEvent, render, screen, waitFor } from \"@/utils/testUtils\";\nimport { OnboardingModal } from \"../OnboardingModal\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useOnboarding } from \"@/contexts/OnboardingContext\";\nimport { useI18nToast } from \"@/lib/toastHelpers\";\nimport { toast } from \"@/hooks/use-toast\";\n\njest.mock(\"react-router-dom\", () => ({\n  ...jest.requireActual(\"react-router-dom\"),\n  useNavigate: jest.fn(),\n}));\n\njest.mock(\"@/contexts/AuthContext\", () => ({\n  useAuth: jest.fn(),\n}));\n\njest.mock(\"@/contexts/OnboardingContext\", () => ({\n  useOnboarding: jest.fn(),\n}));\n\njest.mock(\"@/lib/toastHelpers\", () => ({\n  useI18nToast: jest.fn(),\n}));\n\njest.mock(\"@/hooks/use-toast\", () => ({\n  toast: jest.fn(),\n}));\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string, options?: Record<string, any>) => {\n      if (options?.channel) {\n        return `${key}:${options.channel}`;\n      }\n      if (options?.count !== undefined) {\n        return `${key}:${options.count}`;\n      }\n      return key;\n    },\n  }),\n}));\n\nconst baseModalRender = jest.fn(\n  ({ open, title, description, actions, onClose, children }: any) => {\n    if (!open) return null;\n    return (\n      <div data-testid=\"base-onboarding-modal\">\n        <h1>{title}</h1>\n        <p>{description}</p>\n        <div>{children}</div>\n        <div>\n          {actions?.map((action: any, index: number) => (\n            <button\n              key={index}\n              disabled={action.disabled}\n              onClick={() => action.onClick?.()}\n            >\n              {action.label}\n            </button>\n          ))}\n        </div>\n        <button onClick={() => onClose?.()}>modal-close</button>\n      </div>\n    );\n  }\n);\n\njest.mock(\"../shared/BaseOnboardingModal\", () => ({\n  BaseOnboardingModal: (props: any) => baseModalRender(props),\n}));\n\nconst sampleDataModalRender = jest.fn(\n  ({ open, onClose, onCloseAll }: any) => {\n    if (!open) return null;\n    return (\n      <div data-testid=\"sample-data-modal\">\n        <button onClick={() => onClose?.()}>close-sample</button>\n        <button onClick={() => onCloseAll?.()}>close-all</button>\n      </div>\n    );\n  }\n);\n\njest.mock(\"../SampleDataModal\", () => ({\n  SampleDataModal: (props: any) => sampleDataModalRender(props),\n}));\n\ndescribe(\"OnboardingModal\", () => {\n  const navigateMock = jest.fn();\n  const onCloseMock = jest.fn();\n  const startGuidedSetupMock = jest.fn();\n  const toastHelperMock = { error: jest.fn() };\n  const toastFnMock = jest.fn();\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    (useNavigate as jest.Mock).mockReturnValue(navigateMock);\n    (useAuth as jest.Mock).mockReturnValue({ user: { id: \"user-1\" } });\n    (useOnboarding as jest.Mock).mockReturnValue({\n      startGuidedSetup: startGuidedSetupMock,\n    });\n    (useI18nToast as jest.Mock).mockReturnValue(toastHelperMock);\n    (toast as jest.Mock).mockImplementation(toastFnMock);\n  });\n\n  it(\"renders onboarding steps and action buttons when open\", () => {\n    render(<OnboardingModal open onClose={onCloseMock} />);\n\n    expect(screen.getByTestId(\"base-onboarding-modal\")).toBeInTheDocument();\n    expect(screen.getByText(\"onboarding.modal.welcome_title\")).toBeInTheDocument();\n    expect(screen.getByText(\"onboarding.modal.welcome_subtitle\")).toBeInTheDocument();\n\n    // Ensure the guided steps list is rendered\n    expect(screen.getByText(\"onboarding.steps.step_1.title\")).toBeInTheDocument();\n    expect(screen.getByText(\"onboarding.steps.step_2.title\")).toBeInTheDocument();\n\n    // Action buttons should use translated labels\n    expect(\n      screen.getByRole(\"button\", { name: \"onboarding.modal.skip_sample_data\" })\n    ).toBeInTheDocument();\n    expect(\n      screen.getByRole(\"button\", { name: \"onboarding.modal.start_learning\" })\n    ).toBeInTheDocument();\n  });\n\n  it(\"starts guided setup and navigates to getting started\", async () => {\n    startGuidedSetupMock.mockResolvedValueOnce(undefined);\n\n    render(<OnboardingModal open onClose={onCloseMock} />);\n\n    fireEvent.click(\n      screen.getByRole(\"button\", { name: \"onboarding.modal.start_learning\" })\n    );\n\n    await waitFor(() => {\n      expect(startGuidedSetupMock).toHaveBeenCalled();\n    });\n\n    expect(onCloseMock).toHaveBeenCalled();\n    expect(navigateMock).toHaveBeenCalledWith(\"/getting-started\");\n    expect(toastFnMock).toHaveBeenCalledWith({\n      title: \"onboarding.modal.welcome_title\",\n      description: \"onboarding.modal.toast.setup_started\",\n    });\n  });\n\n  it(\"shows sample data modal when skip action is selected\", () => {\n    render(<OnboardingModal open onClose={onCloseMock} />);\n\n    fireEvent.click(\n      screen.getByRole(\"button\", { name: \"onboarding.modal.skip_sample_data\" })\n    );\n\n    expect(screen.getByTestId(\"sample-data-modal\")).toBeInTheDocument();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/OnboardingTutorial.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[622,625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[622,625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[730,733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[730,733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[867,870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[867,870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1212,1215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1212,1215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1322,1325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1322,1325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen, fireEvent, waitFor } from \"@/utils/testUtils\";\nimport { OnboardingTutorial, TutorialStep } from \"../shared/OnboardingTutorial\";\nimport { useTutorialExit } from \"@/hooks/useTutorialExit\";\nimport { useTranslation } from \"react-i18next\";\nimport React from \"react\";\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: jest.fn(),\n}));\n\njest.mock(\"react-router-dom\", () => {\n  const actual = jest.requireActual(\"react-router-dom\");\n  return {\n    ...actual,\n    useNavigate: jest.fn(),\n  };\n});\n\njest.mock(\"@/hooks/useTutorialExit\", () => ({\n  useTutorialExit: jest.fn(),\n}));\n\nlet latestModalProps: any;\njest.mock(\"../shared/BaseOnboardingModal\", () => ({\n  __esModule: true,\n  BaseOnboardingModal: (props: any) => {\n    latestModalProps = props;\n    return (\n      <div data-testid=\"base-onboarding-modal\">\n        {props.actions.map((action: any, index: number) => (\n          <button\n            key={index}\n            data-testid={`modal-action-${index}`}\n            onClick={action.onClick}\n            disabled={action.disabled}\n          >\n            {action.label}\n          </button>\n        ))}\n        {props.children}\n      </div>\n    );\n  },\n}));\n\nlet latestFloatingProps: any;\njest.mock(\"../shared/TutorialFloatingCard\", () => ({\n  __esModule: true,\n  TutorialFloatingCard: (props: any) => {\n    latestFloatingProps = props;\n    return (\n      <div data-testid=\"floating-card\">\n        <button onClick={props.onNext}>Next</button>\n        <button onClick={props.onExit}>Exit</button>\n      </div>\n    );\n  },\n}));\n\ndescribe(\"OnboardingTutorial\", () => {\n  const navigateMock = jest.fn();\n  const handleExitNow = jest.fn();\n\n  const modalSteps: TutorialStep[] = [\n    {\n      id: 1,\n      title: \"Welcome\",\n      description: \"Intro content\",\n      content: <p>Step 1</p>,\n      canProceed: true,\n      mode: \"modal\",\n    },\n    {\n      id: 2,\n      title: \"Next Steps\",\n      description: \"More instructions\",\n      content: <p>Step 2</p>,\n      canProceed: true,\n      mode: \"modal\",\n      route: \"/dashboard\",\n    },\n  ];\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    latestModalProps = undefined;\n    latestFloatingProps = undefined;\n\n    (useTranslation as jest.Mock).mockReturnValue({\n      t: (key: string, options?: Record<string, unknown>) => {\n        const dictionary: Record<string, string> = {\n          \"onboarding.tutorial.exit_tutorial\": \"Exit Tutorial\",\n          \"onboarding.tutorial.hold_to_exit\": \"Hold to exit\",\n          \"onboarding.tutorial.exiting\": \"Exitingâ€¦\",\n          \"onboarding.tutorial.next\": \"Next\",\n          \"onboarding.tutorial.continue_setup\": \"Continue setup\",\n          \"onboarding.tutorial.step_title\": `Step ${options?.current} of ${options?.total} â€“ ${options?.title}`,\n        };\n        return dictionary[key] ?? key;\n      },\n    });\n\n    (useTutorialExit as jest.Mock).mockReturnValue({\n      isExiting: false,\n      handleExitNow,\n    });\n\n    const { useNavigate } = jest.requireMock(\"react-router-dom\");\n    useNavigate.mockReturnValue(navigateMock);\n  });\n\n  it(\"returns null when tutorial is not visible\", () => {\n    render(\n      <OnboardingTutorial\n        steps={modalSteps}\n        onComplete={jest.fn()}\n        onExit={jest.fn()}\n        isVisible={false}\n      />\n    );\n\n    expect(screen.queryByTestId(\"base-onboarding-modal\")).not.toBeInTheDocument();\n    expect(screen.queryByTestId(\"floating-card\")).not.toBeInTheDocument();\n  });\n\n  it(\"renders modal flow, handles exit, navigation, and completion\", async () => {\n    const onComplete = jest.fn();\n    const onExit = jest.fn();\n\n    render(\n      <OnboardingTutorial\n        steps={modalSteps}\n        onComplete={onComplete}\n        onExit={onExit}\n        isVisible\n      />\n    );\n\n    expect(useTutorialExit).toHaveBeenCalledWith(\n      expect.objectContaining({\n        currentStepTitle: \"Welcome\",\n        onExitComplete: onExit,\n      })\n    );\n\n    expect(latestModalProps.title).toBe(\"Step 1 of 2 â€“ Welcome\");\n    expect(screen.getByText(\"Step 1\")).toBeInTheDocument();\n\n    fireEvent.click(screen.getByTestId(\"modal-action-0\"));\n    expect(handleExitNow).toHaveBeenCalledTimes(1);\n\n    fireEvent.click(screen.getByTestId(\"modal-action-1\"));\n\n    await waitFor(() => {\n      expect(latestModalProps.title).toBe(\"Step 2 of 2 â€“ Next Steps\");\n    });\n\n    expect(navigateMock).toHaveBeenCalledWith(\n      \"/dashboard?tutorial=true&step=2\"\n    );\n\n    expect(screen.getByText(\"Step 2\")).toBeInTheDocument();\n\n    fireEvent.click(screen.getByTestId(\"modal-action-0\"));\n    expect(onComplete).toHaveBeenCalledTimes(1);\n  });\n\n  it(\"renders floating card when step mode is floating\", () => {\n    const floatingSteps: TutorialStep[] = [\n      {\n        id: 1,\n        title: \"Floating Step\",\n        description: \"Do this inline\",\n        content: <p>Inline content</p>,\n        canProceed: false,\n        mode: \"floating\",\n        requiresAction: true,\n        disabledTooltip: \"Finish prerequisite\",\n      },\n    ];\n\n    render(\n      <OnboardingTutorial\n        steps={floatingSteps}\n        onComplete={jest.fn()}\n        onExit={jest.fn()}\n        isVisible\n      />\n    );\n\n    expect(screen.getByTestId(\"floating-card\")).toBeInTheDocument();\n    expect(latestFloatingProps.requiresAction).toBe(true);\n    expect(latestFloatingProps.canProceed).toBe(false);\n  });\n\n  it(\"resets to provided initial step index\", () => {\n    render(\n      <OnboardingTutorial\n        steps={modalSteps}\n        onComplete={jest.fn()}\n        onExit={jest.fn()}\n        isVisible\n        initialStepIndex={1}\n      />\n    );\n\n    expect(latestModalProps.title).toBe(\"Step 2 of 2 â€“ Next Steps\");\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/PerformanceMonitor.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[589,592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[589,592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-var-requires').","line":20,"column":5,"severity":1,"nodeType":null,"fix":{"range":[707,769],"text":" "}},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":21,"column":20,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":21,"endColumn":52},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[910,913],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[910,913],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import React from \"react\";\nimport { act, render } from \"@testing-library/react\";\nimport { useOnboarding } from \"@/contexts/OnboardingContext\";\n\njest.mock(\"@/contexts/OnboardingContext\", () => ({\n  useOnboarding: jest.fn(),\n}));\n\ndescribe(\"PerformanceMonitor\", () => {\n  const mockUseOnboarding = useOnboarding as jest.MockedFunction<typeof useOnboarding>;\n  const originalEnv = process.env.NODE_ENV;\n  let originalRAF: typeof window.requestAnimationFrame;\n  let originalCancelRAF: typeof window.cancelAnimationFrame;\n  let PerformanceMonitor: React.ComponentType;\n  let onboardingMetrics: any;\n\n  beforeAll(() => {\n    const previousEnv = process.env.NODE_ENV;\n    process.env.NODE_ENV = \"development\";\n    // eslint-disable-next-line @typescript-eslint/no-var-requires\n    const module = require(\"../PerformanceMonitor\");\n    PerformanceMonitor = module.PerformanceMonitor;\n    onboardingMetrics = (window as any).onboardingMetrics;\n    process.env.NODE_ENV = previousEnv;\n  });\n\n  beforeEach(() => {\n    mockUseOnboarding.mockReset();\n    originalRAF = window.requestAnimationFrame;\n    originalCancelRAF = window.cancelAnimationFrame;\n  });\n\n  afterEach(() => {\n    window.requestAnimationFrame = originalRAF;\n    window.cancelAnimationFrame = originalCancelRAF;\n    process.env.NODE_ENV = originalEnv;\n  });\n\n  it(\"returns null outside development mode\", () => {\n    process.env.NODE_ENV = \"test\";\n    mockUseOnboarding.mockReturnValue({\n      stage: \"intro\",\n      currentStep: 0,\n      loading: false,\n    });\n\n    const { container } = render(<PerformanceMonitor />);\n    expect(container.firstChild).toBeNull();\n  });\n\n  it(\"warns when rerender threshold exceeded in development\", async () => {\n    process.env.NODE_ENV = \"development\";\n    const warnSpy = jest.spyOn(console, \"warn\").mockImplementation(() => undefined);\n\n    let callIndex = 0;\n    mockUseOnboarding.mockImplementation(() => ({\n      stage: \"setup\",\n      currentStep: callIndex++,\n      loading: false,\n    }));\n\n    window.requestAnimationFrame = (callback: FrameRequestCallback) => {\n      callback(performance.now());\n      return 1 as unknown as number;\n    };\n    window.cancelAnimationFrame = jest.fn();\n\n    const { rerender } = render(<PerformanceMonitor />);\n\n    for (let i = 0; i < 105; i += 1) {\n      await act(async () => {\n        rerender(<PerformanceMonitor />);\n      });\n    }\n\n    expect(warnSpy).toHaveBeenCalledWith(\n      \"PerformanceMonitor: High onboarding re-render count detected:\",\n      expect.objectContaining({\n        renderCount: expect.any(Number),\n        stage: \"setup\",\n        currentStep: expect.any(Number),\n        loading: false,\n        timestamp: expect.any(String),\n      })\n    );\n\n    expect(onboardingMetrics).toBeDefined();\n    await expect(onboardingMetrics?.getPerformanceStats()).resolves.toEqual({\n      message: \"V3 Onboarding System - Production Ready\",\n      databaseClean: true,\n      cacheOptimized: true,\n      consoleSpamRemoved: true,\n    });\n\n    warnSpy.mockRestore();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/ProjectActivitySection.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/ProjectKanbanBoard.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[469,472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[469,472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[573,576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[573,576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[908,911],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[908,911],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1165,1168],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1165,1168],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1375,1378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1375,1378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { fireEvent, render, screen } from \"@/utils/testUtils\";\nimport ProjectKanbanBoard from \"../ProjectKanbanBoard\";\nimport type { ProjectListItem, ProjectStatusSummary } from \"@/pages/projects/types\";\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string, options?: Record<string, string>) => options?.defaultValue ?? key,\n  }),\n}));\n\njest.mock(\"@hello-pangea/dnd\", () => ({\n  DragDropContext: ({ children }: any) => <div data-testid=\"drag-drop-context\">{children}</div>,\n  Droppable: ({ droppableId, children }: any) => (\n    <div data-testid={`droppable-${droppableId}`}>\n      {children(\n        {\n          innerRef: jest.fn(),\n          droppableProps: {},\n          placeholder: <div data-testid={`placeholder-${droppableId}`} />,\n        },\n        { isDraggingOver: false }\n      )}\n    </div>\n  ),\n  Draggable: ({ draggableId, children }: any) => (\n    <div data-testid={`draggable-${draggableId}`}>\n      {children({\n        innerRef: jest.fn(),\n        draggableProps: {},\n        dragHandleProps: {},\n      })}\n    </div>\n  ),\n}));\n\nconst professionalCardMock = jest.fn(({ project, onClick }: any) => (\n  <button data-testid={`project-card-${project.id}`} onClick={onClick}>\n    {project.name}\n  </button>\n));\n\njest.mock(\"@/components/ProfessionalKanbanCard\", () => ({\n  ProfessionalKanbanCard: (props: any) => professionalCardMock(props),\n}));\n\njest.mock(\"@/features/project-creation\", () => ({\n  ProjectCreationWizardSheet: ({ isOpen, onOpenChange }: { isOpen: boolean; onOpenChange: (open: boolean) => void }) => (\n    <button\n      type=\"button\"\n      data-testid=\"project-wizard-sheet\"\n      data-open={String(isOpen)}\n      onClick={() => onOpenChange(false)}\n    >\n      Wizard\n    </button>\n  ),\n}));\n\njest.mock(\"@/components/ViewProjectDialog\", () => ({\n  ViewProjectDialog: () => <div data-testid=\"view-project-dialog\" />,\n}));\n\njest.mock(\"@/hooks/useNotificationTriggers\", () => ({\n  useNotificationTriggers: () => ({ triggerProjectMilestone: jest.fn() }),\n}));\n\njest.mock(\"@/contexts/OrganizationContext\", () => ({\n  useOrganization: () => ({ activeOrganization: { id: \"org-1\" } }),\n}));\n\njest.mock(\"@/hooks/useKanbanSettings\", () => ({\n  useKanbanSettings: () => ({ settings: {} }),\n}));\n\njest.mock(\"@/lib/toastHelpers\", () => ({\n  useI18nToast: () => ({ success: jest.fn(), error: jest.fn() }),\n}));\n\njest.mock(\"@/components/ui/loading-presets\", () => ({\n  KanbanLoadingSkeleton: () => <div data-testid=\"kanban-loading\" />,\n}));\n\ndescribe(\"ProjectKanbanBoard\", () => {\n  const onProjectsChange = jest.fn();\n  const onQuickView = jest.fn();\n  const onLoadMore = jest.fn();\n\n  const createProject = (overrides: Partial<ProjectListItem>): ProjectListItem => ({\n    id: \"project-1\",\n    name: \"Project Alpha\",\n    description: null,\n    lead_id: \"lead-1\",\n    user_id: \"user-1\",\n    created_at: new Date(\"2024-01-01\").toISOString(),\n    updated_at: new Date(\"2024-01-02\").toISOString(),\n    status_id: \"status-1\",\n    project_type_id: null,\n    base_price: null,\n    sort_order: null,\n    lead: null,\n    project_status: null,\n    project_type: null,\n    session_count: 0,\n    upcoming_session_count: 0,\n    planned_session_count: 0,\n    next_session_date: null,\n    todo_count: 0,\n    completed_todo_count: 0,\n    open_todos: [],\n    paid_amount: null,\n    remaining_amount: null,\n    services: [],\n    ...overrides,\n  });\n\n  const statuses: ProjectStatusSummary[] = [\n    { id: \"status-1\", name: \"In Progress\", color: \"#00FF00\", lifecycle: \"active\" },\n    { id: \"status-2\", name: \"Completed\", color: \"#0000FF\", lifecycle: \"completed\" },\n  ];\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  const renderBoard = (props: Partial<React.ComponentProps<typeof ProjectKanbanBoard>> = {}) =>\n    render(\n      <ProjectKanbanBoard\n        projects={[\n          createProject({ id: \"project-1\", status_id: \"status-1\", name: \"Project Alpha\" }),\n          createProject({ id: \"project-2\", status_id: \"status-2\", name: \"Project Beta\" }),\n          createProject({ id: \"project-3\", status_id: null, name: \"Unsorted\" }),\n        ]}\n        projectStatuses={statuses}\n        onProjectsChange={onProjectsChange}\n        onQuickView={onQuickView}\n        onLoadMore={onLoadMore}\n        hasMore\n        {...props}\n      />\n    );\n\n  it(\"renders provided project statuses with their project counts\", () => {\n    renderBoard();\n\n    expect(screen.getByText(\"In Progress\")).toBeInTheDocument();\n    expect(screen.getByText(\"Completed\")).toBeInTheDocument();\n\n    const droppable = screen.getByTestId(\"droppable-status-1\");\n    expect(droppable).toBeInTheDocument();\n\n    expect(screen.getAllByText(/add_project/i).length).toBeGreaterThan(0);\n  });\n\n  it(\"exposes a column for projects without status\", () => {\n    renderBoard();\n\n    expect(screen.getByTestId(\"droppable-no-status\")).toBeInTheDocument();\n    // Uses translation fallback when no explicit status is supplied\n    expect(screen.getAllByText(\"pages:projects.noStatus\").length).toBeGreaterThan(0);\n  });\n\n  it(\"invokes quick view callback when a project card is clicked\", () => {\n    renderBoard();\n\n    fireEvent.click(screen.getByTestId(\"project-card-project-1\"));\n    expect(onQuickView).toHaveBeenCalledWith(expect.objectContaining({ id: \"project-1\" }));\n  });\n\n  it(\"shows a load more button when additional projects are available\", () => {\n    renderBoard();\n\n    fireEvent.click(screen.getByRole(\"button\", { name: /load more/i }));\n    expect(onLoadMore).toHaveBeenCalledTimes(1);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/ProjectPaymentsSection.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/ProjectServicesSection.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1371,1374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1371,1374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen, waitFor, fireEvent } from \"@/utils/testUtils\";\nimport { ProjectServicesSection } from \"@/components/ProjectServicesSection\";\nimport { supabase } from \"@/integrations/supabase/client\";\n\njest.mock(\"@/integrations/supabase/client\", () => ({\n  supabase: {\n    from: jest.fn(),\n    auth: {\n      getUser: jest.fn()\n    },\n    rpc: jest.fn()\n  }\n}));\n\nconst toastSuccess = jest.fn();\n\njest.mock(\"@/lib/toastHelpers\", () => ({\n  useI18nToast: () => ({\n    success: toastSuccess,\n    error: jest.fn()\n  })\n}));\n\nconst translations: Record<string, string> = {\n  \"services.title\": \"Services\",\n  \"services.add\": \"Add services\",\n  \"services.edit\": \"Edit services\",\n  \"services.selected_services\": \"Selected services\",\n  \"services.services_updated\": \"Services updated\",\n  \"services.cost\": \"Cost\",\n  \"services.selling\": \"Selling\",\n  \"projectDetails.services.emptyState\": \"No services yet\",\n  \"projectDetails.services.addHint\": \"Add services to get started\",\n  \"buttons.clearAll\": \"Clear All\",\n  \"common:actions.saving\": \"Saving\",\n  \"common:buttons.save\": \"Save\",\n  \"common:buttons.cancel\": \"Cancel\"\n};\n\njest.mock(\"@/hooks/useTypedTranslation\", () => ({\n  useFormsTranslation: () => ({\n    t: (key: string) => translations[key] ?? key\n  })\n}));\n\njest.mock(\"@/components/ServicePicker\", () => ({\n  ServicePicker: ({ value, onChange, isLoading, error, onRetry }: any) => (\n    <div data-testid=\"service-picker\">\n      <div data-testid=\"service-picker-value\">{value.join(\",\")}</div>\n      {isLoading && <span>Loading servicesâ€¦</span>}\n      {error && (\n        <>\n          <span>{error}</span>\n          <button onClick={onRetry}>Retry</button>\n        </>\n      )}\n      <button onClick={() => onChange([\"svc-2\"]) }>Choose second</button>\n    </div>\n  )\n}));\n\nconst mockProjectServices = [\n  {\n    services: {\n      id: \"svc-1\",\n      name: \"Portrait Session\",\n      category: \"Photography\",\n      cost_price: 50,\n      selling_price: 150\n    }\n  }\n];\n\nconst availableServices = [\n  {\n    id: \"svc-1\",\n    name: \"Portrait Session\",\n    category: \"Photography\",\n    cost_price: 50,\n    selling_price: 150\n  },\n  {\n    id: \"svc-2\",\n    name: \"Wedding Package\",\n    category: \"Photography\",\n    cost_price: 200,\n    selling_price: 450\n  }\n];\n\nconst insertSpy = jest.fn();\n\nbeforeEach(() => {\n  jest.clearAllMocks();\n\n  (supabase.auth.getUser as jest.Mock).mockResolvedValue({\n    data: { user: { id: \"user-1\" } }\n  });\n\n  (supabase.rpc as jest.Mock).mockResolvedValue({ data: \"org-1\" });\n\n  insertSpy.mockResolvedValue({ error: null });\n\n  (supabase.from as jest.Mock).mockImplementation((table: string) => {\n    if (table === \"project_services\") {\n      return {\n        select: jest.fn(() => ({\n          eq: jest.fn().mockResolvedValue({ data: mockProjectServices, error: null })\n        })),\n        delete: jest.fn(() => ({\n          eq: jest.fn().mockResolvedValue({ error: null })\n        })),\n        insert: insertSpy\n      };\n    }\n\n    if (table === \"services\") {\n      return {\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            order: jest.fn(() => ({\n              order: jest.fn().mockResolvedValue({ data: availableServices, error: null })\n            }))\n          }))\n        }))\n      };\n    }\n\n    return {};\n  });\n});\n\nafterEach(() => {\n  jest.useRealTimers();\n});\n\nfunction renderComponent(onServicesUpdated?: jest.Mock) {\n  return render(\n    <ProjectServicesSection projectId=\"project-1\" onServicesUpdated={onServicesUpdated} />\n  );\n}\n\ntest(\"renders fetched services and toggles edit mode\", async () => {\n  renderComponent();\n\n  expect(await screen.findByText(\"Portrait Session\")).toBeInTheDocument();\n  expect(screen.getByRole(\"button\", { name: \"Edit services\" })).toBeInTheDocument();\n\n  fireEvent.click(screen.getByRole(\"button\", { name: \"Edit services\" }));\n\n  expect(await screen.findByTestId(\"service-picker\")).toBeInTheDocument();\n  expect(screen.getByTestId(\"service-picker-value\").textContent).toBe(\"svc-1\");\n\n  fireEvent.click(screen.getByRole(\"button\", { name: \"Cancel\" }));\n\n  await waitFor(() => expect(screen.queryByTestId(\"service-picker\")).not.toBeInTheDocument());\n  expect(screen.getByRole(\"button\", { name: \"Edit services\" })).toBeInTheDocument();\n});\n\ntest(\"saves updated services and shows success toast\", async () => {\n  const updatedCallback = jest.fn();\n\n  renderComponent(updatedCallback);\n\n  await screen.findByText(\"Portrait Session\");\n\n  fireEvent.click(screen.getByRole(\"button\", { name: \"Edit services\" }));\n  const saveButton = await screen.findByRole(\"button\", { name: \"Save\" });\n\n  fireEvent.click(screen.getByText(\"Choose second\"));\n\n  fireEvent.click(saveButton);\n\n  await waitFor(() => {\n    expect(insertSpy).toHaveBeenCalledWith([\n      {\n        project_id: \"project-1\",\n        service_id: \"svc-2\",\n        user_id: \"user-1\"\n      }\n    ]);\n  });\n\n  await waitFor(() => expect(toastSuccess).toHaveBeenCalledWith(\"Services updated\"));\n  expect(updatedCallback).toHaveBeenCalled();\n\n  await waitFor(() => expect(screen.queryByTestId(\"service-picker\")).not.toBeInTheDocument());\n  expect(screen.getByRole(\"button\", { name: \"Edit services\" })).toBeInTheDocument();\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/ProjectSheetPreview.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[769,772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[769,772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1107,1110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1107,1110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1316,1319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1316,1319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1637,1640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1637,1640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1869,1872],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1869,1872],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2322,2325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2322,2325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { fireEvent, render, screen, waitFor } from \"@/utils/testUtils\";\nimport ProjectSheetPreview from \"../ProjectSheetPreview\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useProjectProgress } from \"@/hooks/useProjectProgress\";\nimport { useProjectPayments } from \"@/hooks/useProjectPayments\";\nimport { supabase } from \"@/integrations/supabase/client\";\n\njest.mock(\"react-router-dom\", () => ({\n  ...jest.requireActual(\"react-router-dom\"),\n  useNavigate: jest.fn(),\n}));\n\njest.mock(\"@/hooks/useProjectProgress\", () => ({\n  useProjectProgress: jest.fn(),\n}));\n\njest.mock(\"@/hooks/useProjectPayments\", () => ({\n  useProjectPayments: jest.fn(),\n}));\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string, options?: Record<string, any>) => {\n      if (options?.channel) {\n        return `${key}:${options.channel}`;\n      }\n      if (options?.count !== undefined) {\n        return `${key}:${options.count}`;\n      }\n      return key;\n    },\n  }),\n}));\n\njest.mock(\"@/components/ui/app-sheet-modal\", () => ({\n  AppSheetModal: ({ isOpen, title, footerActions, children }: any) => {\n    if (!isOpen) return null;\n    return (\n      <div data-testid=\"project-sheet-preview\">\n        <h2>{title}</h2>\n        <div>{children}</div>\n        <div>\n          {footerActions?.map((action: any, index: number) => (\n            <button key={index} onClick={() => action.onClick?.()}>\n              {action.label}\n            </button>\n          ))}\n        </div>\n      </div>\n    );\n  },\n}));\n\njest.mock(\"@/components/ProjectStatusBadge\", () => ({\n  __esModule: true,\n  ProjectStatusBadge: ({ onStatusChange }: any) => (\n    <button data-testid=\"project-status-badge\" onClick={() => onStatusChange?.()}>\n      status-badge\n    </button>\n  ),\n}));\n\njest.mock(\"@/components/ClientDetailsCard\", () => ({\n  __esModule: true,\n  default: ({ name }: any) => <div data-testid=\"client-details\">{name}</div>,\n}));\n\nconst leadsSingleMock = jest.fn();\nconst projectTypeSingleMock = jest.fn();\nconst projectStatusMaybeSingleMock = jest\n  .fn()\n  .mockResolvedValueOnce({ data: { name: \"archived\" }, error: null })\n  .mockResolvedValue({ data: { name: \"active\" }, error: null });\n\nconst createBuilder = ({\n  single,\n  maybeSingle,\n}: {\n  single?: jest.Mock;\n  maybeSingle?: jest.Mock;\n}) => {\n  const builder: any = {\n    select: jest.fn(() => builder),\n    eq: jest.fn(() => builder),\n    single: single ?? jest.fn(),\n    maybeSingle: maybeSingle ?? jest.fn(),\n  };\n  return builder;\n};\n\njest.mock(\"@/integrations/supabase/client\", () => ({\n  supabase: {\n    from: jest.fn(),\n  },\n}));\n\ndescribe(\"ProjectSheetPreview\", () => {\n  const navigateMock = jest.fn();\n  const onOpenChangeMock = jest.fn();\n  const onProjectUpdatedMock = jest.fn();\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n\n    leadsSingleMock.mockReset();\n    projectTypeSingleMock.mockReset();\n    projectStatusMaybeSingleMock\n      .mockReset()\n      .mockResolvedValueOnce({ data: { name: \"archived\" }, error: null })\n      .mockResolvedValue({ data: { name: \"active\" }, error: null });\n\n    (useNavigate as jest.Mock).mockReturnValue(navigateMock);\n\n    (useProjectProgress as jest.Mock).mockReturnValue({\n      progress: { total: 3, completed: 2, percentage: 67 },\n      loading: false,\n    });\n    (useProjectPayments as jest.Mock).mockReturnValue({\n      paymentSummary: {\n        totalProject: 1000,\n        totalPaid: 600,\n        remaining: 400,\n      },\n      loading: false,\n    });\n\n    leadsSingleMock.mockResolvedValue({\n      data: {\n        id: \"lead-1\",\n        name: \"Lead Name\",\n        email: \"lead@example.com\",\n        phone: \"+123\",\n        status: \"active\",\n        notes: \"Important client\",\n      },\n      error: null,\n    });\n\n    projectTypeSingleMock.mockResolvedValue({\n      data: { id: \"type-1\", name: \"Wedding\" },\n      error: null,\n    });\n\n    (supabase.from as jest.Mock).mockImplementation((table: string) => {\n      if (table === \"leads\") {\n        return createBuilder({ single: leadsSingleMock });\n      }\n\n      if (table === \"project_types\") {\n        return createBuilder({ single: projectTypeSingleMock });\n      }\n\n      if (table === \"project_statuses\") {\n        return createBuilder({ maybeSingle: projectStatusMaybeSingleMock });\n      }\n\n      return createBuilder({});\n    });\n  });\n\n  const project = {\n    id: \"project-1\",\n    name: \"Main Project\",\n    description: \"Important project\",\n    lead_id: \"lead-1\",\n    user_id: \"user-1\",\n    status_id: \"status-1\",\n    created_at: \"2025-01-01T00:00:00.000Z\",\n    updated_at: \"2025-01-05T00:00:00.000Z\",\n    project_type_id: \"type-1\",\n  };\n\n  it(\"renders project overview, metrics, and client details\", async () => {\n    render(\n      <ProjectSheetPreview\n        project={project}\n        open\n        onOpenChange={onOpenChangeMock}\n        onProjectUpdated={onProjectUpdatedMock}\n      />\n    );\n\n    await waitFor(() => {\n      expect(screen.getByTestId(\"client-details\")).toBeInTheDocument();\n    });\n\n    expect(screen.getByTestId(\"project-sheet-preview\")).toBeInTheDocument();\n    expect(screen.getAllByText(\"Main Project\").length).toBeGreaterThan(0);\n    expect(screen.getByText(\"forms.project_preview.archived\")).toBeInTheDocument();\n    expect(projectTypeSingleMock).toHaveBeenCalled();\n    expect(screen.getByText(\"forms.project_preview.progress\")).toBeInTheDocument();\n    expect(screen.getByText(\"forms.project_preview.payments\")).toBeInTheDocument();\n    expect(screen.getByText(\"Lead Name\")).toBeInTheDocument();\n  });\n\n  it(\"navigates to full details and propagates status updates\", async () => {\n    render(\n      <ProjectSheetPreview\n        project={project}\n        open\n        onOpenChange={onOpenChangeMock}\n        onProjectUpdated={onProjectUpdatedMock}\n      />\n    );\n\n    fireEvent.click(\n      screen.getByRole(\"button\", { name: \"forms.project_preview.view_full_details\" })\n    );\n\n    expect(navigateMock).toHaveBeenCalledWith(\"/projects/project-1\");\n    expect(onOpenChangeMock).toHaveBeenCalledWith(false);\n\n    fireEvent.click(screen.getByTestId(\"project-status-badge\"));\n\n    await waitFor(() => {\n      expect(onProjectUpdatedMock).toHaveBeenCalled();\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/ProjectSheetView.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/ProtectedRoute.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/ReminderCard.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/RestartGuidedModeButton.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/RoutePrefetcher.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/SampleDataModal.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[901,904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[901,904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1127,1130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1127,1130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1483,1486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1483,1486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import userEvent from \"@testing-library/user-event\";\nimport { render, screen, waitFor } from \"@/utils/testUtils\";\nimport { SampleDataModal } from \"../SampleDataModal\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useOnboarding } from \"@/contexts/OnboardingContext\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { useNavigate } from \"react-router-dom\";\n\njest.mock(\"react-router-dom\", () => ({\n  ...jest.requireActual(\"react-router-dom\"),\n  useNavigate: jest.fn(),\n}));\n\njest.mock(\"@/contexts/AuthContext\", () => ({\n  useAuth: jest.fn(),\n}));\n\njest.mock(\"@/contexts/OnboardingContext\", () => ({\n  useOnboarding: jest.fn(),\n}));\n\njest.mock(\"@/hooks/use-toast\", () => ({\n  toast: jest.fn(),\n}));\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string) => key,\n  }),\n}));\n\nconst baseModalRender = jest.fn(\n  ({ open, title, description, actions, children }: any) => {\n    if (!open) return null;\n    return (\n      <div data-testid=\"sample-modal-root\">\n        <h1>{title}</h1>\n        <p>{description}</p>\n        <div>{children}</div>\n        <div>\n          {actions?.map((action: any, index: number) => (\n            <button\n              key={index}\n              disabled={action.disabled}\n              onClick={action.onClick}\n            >\n              {action.label}\n            </button>\n          ))}\n        </div>\n      </div>\n    );\n  }\n);\n\njest.mock(\"../shared/BaseOnboardingModal\", () => ({\n  BaseOnboardingModal: (props: any) => baseModalRender(props),\n}));\n\nconst mockUseAuth = useAuth as jest.Mock;\nconst mockUseOnboarding = useOnboarding as jest.Mock;\nconst mockToast = toast as jest.Mock;\nconst mockUseNavigate = useNavigate as jest.Mock;\n\ndescribe(\"SampleDataModal\", () => {\n  const skipOnboarding = jest.fn();\n  const startGuidedSetup = jest.fn();\n  const navigate = jest.fn();\n  const onClose = jest.fn();\n  const onCloseAll = jest.fn();\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    skipOnboarding.mockResolvedValue(undefined);\n    startGuidedSetup.mockResolvedValue(undefined);\n    mockUseAuth.mockReturnValue({ user: { id: \"user-1\" } });\n    mockUseOnboarding.mockReturnValue({ skipOnboarding, startGuidedSetup });\n    mockToast.mockReturnValue(undefined);\n    mockUseNavigate.mockReturnValue(navigate);\n  });\n\n  it(\"renders sample data information when open\", () => {\n    render(<SampleDataModal open onClose={onClose} />);\n\n    expect(baseModalRender).toHaveBeenCalled();\n    expect(\n      screen.getByText(\"onboarding.sample_data.items.sample_leads.title\")\n    ).toBeInTheDocument();\n    expect(\n      screen.getByText(\"onboarding.sample_data.items.example_projects.title\")\n    ).toBeInTheDocument();\n    expect(\n      screen.getByText(\"onboarding.sample_data.items.scheduled_sessions.title\")\n    ).toBeInTheDocument();\n  });\n\n  it(\"skips onboarding with sample data and shows success feedback\", async () => {\n    const user = userEvent.setup();\n    render(<SampleDataModal open onClose={onClose} />);\n\n    const skipButton = screen.getByRole(\"button\", {\n      name: \"onboarding.sample_data.start_with_sample_data\",\n    });\n\n    await user.click(skipButton);\n\n    await waitFor(() => expect(skipOnboarding).toHaveBeenCalledTimes(1));\n    expect(skipOnboarding).toHaveBeenCalledWith();\n\n    await waitFor(() =>\n      expect(mockToast).toHaveBeenCalledWith({\n        title: \"onboarding.sample_data.toast.success_title\",\n        description: \"onboarding.sample_data.toast.success_description\",\n      })\n    );\n\n    expect(onClose).toHaveBeenCalledTimes(1);\n    expect(navigate).toHaveBeenCalledWith(\"/leads\");\n  });\n\n  it(\"continues guided setup when requested\", async () => {\n    const user = userEvent.setup();\n    render(<SampleDataModal open onClose={onClose} onCloseAll={onCloseAll} />);\n\n    const continueButton = screen.getByRole(\"button\", {\n      name: \"onboarding.sample_data.continue_guided_setup\",\n    });\n\n    await user.click(continueButton);\n\n    await waitFor(() => expect(startGuidedSetup).toHaveBeenCalledTimes(1));\n    expect(onCloseAll).toHaveBeenCalledTimes(1);\n    expect(navigate).toHaveBeenCalledWith(\"/getting-started\");\n  });\n\n  it(\"surfaces toast errors when skipping fails\", async () => {\n    const user = userEvent.setup();\n    const error = new Error(\"boom\");\n    skipOnboarding.mockRejectedValueOnce(error);\n\n    render(<SampleDataModal open onClose={onClose} />);\n\n    const skipButton = screen.getByRole(\"button\", {\n      name: \"onboarding.sample_data.start_with_sample_data\",\n    });\n\n    await user.click(skipButton);\n\n    await waitFor(() => expect(skipOnboarding).toHaveBeenCalledTimes(1));\n    await waitFor(() =>\n      expect(mockToast).toHaveBeenCalledWith({\n        title: \"onboarding.sample_data.toast.error_title\",\n        description: \"onboarding.sample_data.toast.error_description\",\n        variant: \"destructive\",\n      })\n    );\n    expect(onClose).not.toHaveBeenCalled();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/ScheduleSessionDialog.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[674,677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[674,677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[731,734],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[731,734],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[795,798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[795,798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[859,862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[859,862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1026,1029],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1026,1029],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { fireEvent, render, screen, waitFor } from \"@testing-library/react\";\nimport ScheduleSessionDialog from \"../ScheduleSessionDialog\";\nimport { useSessionForm } from \"@/hooks/useSessionForm\";\nimport { useSessionReminderScheduling } from \"@/hooks/useSessionReminderScheduling\";\nimport { useWorkflowTriggers } from \"@/hooks/useWorkflowTriggers\";\n\njest.mock(\"@/hooks/useSessionForm\");\njest.mock(\"@/hooks/useSessionReminderScheduling\");\njest.mock(\"@/hooks/useWorkflowTriggers\");\njest.mock(\"@/hooks/useTypedTranslation\", () => ({\n  useFormsTranslation: () => ({ t: (key: string) => key }),\n}));\njest.mock(\"@/components/ui/tooltip\", () => ({\n  TooltipProvider: ({ children }: any) => <div>{children}</div>,\n  Tooltip: ({ children }: any) => <div>{children}</div>,\n  TooltipTrigger: ({ children }: any) => <div>{children}</div>,\n  TooltipContent: ({ children }: any) => <div>{children}</div>,\n}));\njest.mock(\"@/components/SessionSchedulingSheet\", () => ({\n  SessionSchedulingSheet: ({ isOpen, onOpenChange, onSessionScheduled }: any) => (\n    <div data-testid=\"sheet\">\n      <span>{isOpen ? \"sheet-open\" : \"sheet-closed\"}</span>\n      <button onClick={() => onOpenChange(false)}>close</button>\n      <button onClick={() => onSessionScheduled?.()}>scheduled</button>\n    </div>\n  ),\n}));\n\nconst scheduleSessionRemindersMock = jest.fn();\nconst triggerSessionScheduledMock = jest.fn();\nconst submitFormMock = jest.fn();\n\nbeforeEach(() => {\n  (useSessionForm as jest.Mock).mockReturnValue({\n    formData: {\n      session_name: \"\",\n      session_date: \"\",\n      session_time: \"\",\n      notes: \"\",\n      location: \"\",\n      project_id: \"\",\n    },\n    loading: false,\n    isDirty: false,\n    isValid: false,\n    handleInputChange: jest.fn(),\n    resetForm: jest.fn(),\n    submitForm: submitFormMock,\n  });\n  (useSessionReminderScheduling as jest.Mock).mockReturnValue({\n    scheduleSessionReminders: scheduleSessionRemindersMock,\n  });\n  (useWorkflowTriggers as jest.Mock).mockReturnValue({\n    triggerSessionScheduled: triggerSessionScheduledMock,\n  });\n});\n\nafterEach(() => {\n  jest.clearAllMocks();\n});\n\ndescribe(\"ScheduleSessionDialog\", () => {\n  it(\"opens sheet when enabled button clicked\", () => {\n    render(<ScheduleSessionDialog leadId=\"lead-1\" leadName=\"Alice\" />);\n\n    fireEvent.click(screen.getByRole(\"button\", { name: \"sessions_form.add_session\" }));\n    expect(screen.getByText(\"sheet-open\")).toBeInTheDocument();\n  });\n\n  it(\"renders disabled tooltip when disabled\", () => {\n    render(\n      <ScheduleSessionDialog\n        leadId=\"lead-1\"\n        leadName=\"Alice\"\n        disabled\n        disabledTooltip=\"Disabled\"\n      />\n    );\n\n    const button = screen.getByRole(\"button\", { name: \"sessions_form.add_session\" });\n    expect(button).toBeDisabled();\n    fireEvent.mouseOver(button);\n    expect(screen.getByText(\"Disabled\")).toBeInTheDocument();\n  });\n\n  it(\"calls onSessionScheduled callback when sheet reports success\", async () => {\n    const onSessionScheduled = jest.fn();\n    render(\n      <ScheduleSessionDialog\n        leadId=\"lead-1\"\n        leadName=\"Alice\"\n        onSessionScheduled={onSessionScheduled}\n      />\n    );\n\n    fireEvent.click(screen.getByRole(\"button\", { name: \"sessions_form.add_session\" }));\n    fireEvent.click(screen.getByText(\"scheduled\"));\n\n    await waitFor(() => expect(onSessionScheduled).toHaveBeenCalled());\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/ServiceInventorySelector.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/SessionBanner.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[537,540],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[537,540],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { fireEvent, render, screen } from \"@/utils/testUtils\";\nimport SessionBanner from \"../SessionBanner\";\nimport { useFormsTranslation } from \"@/hooks/useTypedTranslation\";\nimport { useSessionActions } from \"@/hooks/useSessionActions\";\n\njest.mock(\"@/hooks/useTypedTranslation\", () => ({\n  useFormsTranslation: jest.fn(),\n}));\n\njest.mock(\"@/hooks/useSessionActions\", () => ({\n  useSessionActions: jest.fn(),\n}));\n\njest.mock(\"@/components/SessionStatusBadge\", () => ({\n  __esModule: true,\n  default: ({ currentStatus, onStatusChange }: any) => (\n    <button\n      data-testid=\"session-status-badge\"\n      onClick={() => onStatusChange?.(\"completed\")}\n    >\n      Status: {currentStatus}\n    </button>\n  ),\n}));\n\ndescribe(\"SessionBanner\", () => {\n  const mockUpdateSessionStatus = jest.fn();\n\n  beforeAll(() => {\n    Object.defineProperty(window.navigator, \"language\", {\n      configurable: true,\n      value: \"en-US\",\n    });\n  });\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    (useFormsTranslation as jest.Mock).mockReturnValue({\n      t: (key: string) => key,\n    });\n    (useSessionActions as jest.Mock).mockReturnValue({\n      updateSessionStatus: mockUpdateSessionStatus,\n    });\n  });\n\n  it(\"renders planned session details and triggers callbacks\", () => {\n    const onStatusUpdate = jest.fn();\n    const onEdit = jest.fn();\n    const onDelete = jest.fn();\n\n    render(\n      <SessionBanner\n        session={{\n          id: \"session-1\",\n          session_date: \"2024-05-15\",\n          session_time: \"14:30\",\n          notes: \"Bring props\",\n          status: \"planned\",\n        }}\n        leadName=\"Jamie Doe\"\n        projectName=\"Project Phoenix\"\n        onStatusUpdate={onStatusUpdate}\n        onEdit={onEdit}\n        onDelete={onDelete}\n      />\n    );\n\n    expect(screen.getByText(\"sessions.photoSession\")).toBeInTheDocument();\n    expect(\n      screen.getByText(/sessions\\.projectLabel: Project Phoenix/)\n    ).toBeInTheDocument();\n    expect(screen.getByText(\"Wed, May 15, 2024\")).toBeInTheDocument();\n    expect(\n      screen.getByText((content) => content.trim() === \"02:30 PM\")\n    ).toBeInTheDocument();\n    expect(screen.getByText(/\"Bring props\"/)).toBeInTheDocument();\n\n    fireEvent.click(screen.getByTestId(\"session-status-badge\"));\n    expect(onStatusUpdate).toHaveBeenCalledWith(\"completed\");\n\n    const editButton = screen\n      .getAllByRole(\"button\")\n      .find((button) => button.querySelector('.lucide-square-pen'));\n    expect(editButton).toBeDefined();\n    fireEvent.click(editButton!);\n    expect(onEdit).toHaveBeenCalled();\n\n    const deleteButton = screen\n      .getAllByRole(\"button\")\n      .find((button) => button.querySelector('.lucide-trash2'));\n    expect(deleteButton).toBeDefined();\n    fireEvent.click(deleteButton!);\n    expect(onDelete).toHaveBeenCalled();\n  });\n\n  it(\"disables edit when session is not planned\", () => {\n    const onEdit = jest.fn();\n\n    render(\n      <SessionBanner\n        session={{\n          id: \"session-2\",\n          session_date: \"2024-06-01\",\n          session_time: \"09:00\",\n          notes: \"\",\n          status: \"completed\",\n        }}\n        leadName=\"Jamie Doe\"\n        onEdit={onEdit}\n        showActions\n      />\n    );\n\n    expect(\n      screen.getByText(\"This session has been marked as completed\")\n    ).toBeInTheDocument();\n\n    const editButton = screen\n      .getAllByRole(\"button\")\n      .find((button) => button.querySelector('.lucide-square-pen'));\n    expect(editButton).toBeDefined();\n    expect(editButton).toBeDisabled();\n    fireEvent.click(editButton!);\n    expect(onEdit).not.toHaveBeenCalled();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/SessionFormFields.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":5,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":5,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[265,268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[265,268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[496,499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[496,499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[556,559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[556,559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[653,656],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[653,656],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[716,719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[716,719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen, fireEvent } from \"@testing-library/react\";\nimport { SessionFormFields } from \"../SessionFormFields\";\n\njest.mock(\"@/components/ui/select\", () => {\n  const React = require(\"react\");\n  return {\n    Select: ({ value, onValueChange, children }: any) => (\n      <select\n        data-testid=\"session-select\"\n        value={value}\n        onChange={(event) => onValueChange(event.target.value)}\n      >\n        {children}\n      </select>\n    ),\n    SelectTrigger: ({ children }: any) => <>{children}</>,\n    SelectValue: ({ placeholder }: any) => (\n      <option value=\"\">{placeholder}</option>\n    ),\n    SelectContent: ({ children }: any) => <>{children}</>,\n    SelectItem: ({ value, children }: any) => (\n      <option value={value}>{children}</option>\n    ),\n  };\n});\n\njest.mock(\"@/hooks/useTypedTranslation\", () => ({\n  useFormsTranslation: () => ({\n    t: (key: string) => key,\n  }),\n}));\n\ndescribe(\"SessionFormFields\", () => {\n  it(\"renders project information when selector disabled\", () => {\n    render(\n      <SessionFormFields\n        leadName=\"Alice\"\n        projectName=\"Wedding\"\n        sessionName=\"Morning Session\"\n        location=\"Studio\"\n        notes=\"Bring props\"\n        onSessionNameChange={jest.fn()}\n        onLocationChange={jest.fn()}\n        onNotesChange={jest.fn()}\n      />\n    );\n\n    expect(screen.getByDisplayValue(\"Alice\")).toBeDisabled();\n    expect(screen.getByDisplayValue(\"Wedding\")).toBeDisabled();\n    expect(screen.getByDisplayValue(\"Morning Session\")).toBeEnabled();\n  });\n\n  it(\"allows selecting a project when selector shown\", async () => {\n    const onProjectChange = jest.fn();\n\n    render(\n      <SessionFormFields\n        leadName=\"Alice\"\n        projectName=\"\"\n        sessionName=\"\"\n        location=\"\"\n        notes=\"\"\n        projectId=\"\"\n        showProjectSelector\n        availableProjects={[\n          { id: \"proj-1\", name: \"Engagement\" },\n          { id: \"proj-2\", name: \"Portrait\" },\n        ]}\n        onSessionNameChange={jest.fn()}\n        onLocationChange={jest.fn()}\n        onNotesChange={jest.fn()}\n        onProjectChange={onProjectChange}\n      />\n    );\n\n    fireEvent.change(screen.getByTestId(\"session-select\"), {\n      target: { value: \"proj-2\" },\n    });\n\n    expect(onProjectChange).toHaveBeenCalledWith(\"proj-2\");\n  });\n\n  it(\"invokes change handlers for text inputs\", () => {\n    const onSessionNameChange = jest.fn();\n    const onLocationChange = jest.fn();\n    const onNotesChange = jest.fn();\n\n    render(\n      <SessionFormFields\n        leadName=\"\"\n        sessionName=\"\"\n        location=\"\"\n        notes=\"\"\n        onSessionNameChange={onSessionNameChange}\n        onLocationChange={onLocationChange}\n        onNotesChange={onNotesChange}\n      />\n    );\n\n    fireEvent.change(screen.getByLabelText(\"sessionScheduling.session_name *\"), {\n      target: { value: \"New Session\" },\n    });\n    fireEvent.change(screen.getByLabelText(\"sessionScheduling.location_address\"), {\n      target: { value: \"New Location\" },\n    });\n    fireEvent.change(\n      screen.getByLabelText(\"sessionScheduling.session_notes_optional\"),\n      { target: { value: \"Extra notes\" } }\n    );\n\n    expect(onSessionNameChange).toHaveBeenCalledWith(\"New Session\");\n    expect(onLocationChange).toHaveBeenCalledWith(\"New Location\");\n    expect(onNotesChange).toHaveBeenCalledWith(\"Extra notes\");\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/SessionSchedulingSheet.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":11,"column":20,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":11,"endColumn":58}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render } from \"@testing-library/react\";\nimport { SessionSchedulingSheet } from \"../SessionSchedulingSheet\";\n\njest.mock(\"@/features/session-planning\", () => {\n  const mock = jest.fn(() => <div data-testid=\"session-planning-wizard\" />);\n  return {\n    SessionPlanningWizardSheet: mock,\n  };\n});\n\nconst WizardMock = require(\"@/features/session-planning\").SessionPlanningWizardSheet as jest.Mock;\n\ndescribe(\"SessionSchedulingSheet\", () => {\n  beforeEach(() => {\n    WizardMock.mockClear();\n  });\n\n  it(\"renders the session planning wizard with derived entry source\", () => {\n    render(\n      <SessionSchedulingSheet\n        leadId=\"lead-1\"\n        leadName=\"Taylor\"\n        projectId=\"proj-1\"\n        projectName=\"Project\"\n        isOpen\n        onOpenChange={jest.fn()}\n        onSessionScheduled={jest.fn()}\n      />\n    );\n\n    expect(WizardMock).toHaveBeenCalledWith(\n      expect.objectContaining({\n        leadId: \"lead-1\",\n        leadName: \"Taylor\",\n        projectId: \"proj-1\",\n        projectName: \"Project\",\n        entrySource: \"project\",\n        isOpen: true,\n      }),\n      {}\n    );\n  });\n\n  it(\"falls back to lead entry source when no project is provided\", () => {\n    render(\n      <SessionSchedulingSheet\n        leadId=\"lead-2\"\n        leadName=\"Alex\"\n        isOpen={false}\n        onOpenChange={jest.fn()}\n      />\n    );\n\n    expect(WizardMock).toHaveBeenCalledWith(\n      expect.objectContaining({\n        entrySource: \"lead\",\n        isOpen: false,\n      }),\n      {}\n    );\n  });\n\n  it(\"forwards a start step override to the wizard\", () => {\n    render(\n      <SessionSchedulingSheet\n        leadId=\"lead-3\"\n        leadName=\"Casey\"\n        isOpen\n        onOpenChange={jest.fn()}\n        startStep=\"schedule\"\n      />\n    );\n\n    expect(WizardMock).toHaveBeenCalledWith(\n      expect.objectContaining({\n        startStepOverride: \"schedule\",\n      }),\n      {}\n    );\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/SessionStatusBadge.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/SessionTypesSection.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/SessionsSection.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/TimeSlotPicker.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":14,"column":29,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":14,"endColumn":63}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { fireEvent, render, screen } from \"@/utils/testUtils\";\nimport { TimeSlotPicker } from \"../TimeSlotPicker\";\n\njest.mock(\"@/hooks/useWorkingHours\", () => ({\n  useWorkingHours: jest.fn(),\n}));\n\njest.mock(\"@/hooks/useTypedTranslation\", () => ({\n  useFormsTranslation: () => ({ t: (key: string) => key }),\n  useCommonTranslation: () => ({ t: (key: string) => key }),\n  useMessagesTranslation: () => ({ t: (key: string) => key }),\n}));\n\nconst mockUseWorkingHours = require(\"@/hooks/useWorkingHours\").useWorkingHours as jest.Mock;\n\nbeforeAll(() => {\n  Object.defineProperty(window.navigator, \"language\", {\n    value: \"en-US\",\n    configurable: true,\n  });\n});\n\nbeforeEach(() => {\n  mockUseWorkingHours.mockReturnValue({\n    loading: false,\n    workingHours: [\n      {\n        day_of_week: 2,\n        enabled: true,\n        start_time: \"09:00\",\n        end_time: \"11:00\",\n      },\n    ],\n  });\n});\n\nafterEach(() => {\n  jest.clearAllMocks();\n});\n\ndescribe(\"TimeSlotPicker\", () => {\n  it(\"renders available time slots centered with soft hover\", () => {\n    const handleSelect = jest.fn();\n    const selectedDate = new Date(\"2024-05-21T00:00:00\"); // Tuesday (day_of_week = 2)\n\n    render(\n      <TimeSlotPicker\n        selectedDate={selectedDate}\n        selectedTime=\"09:00\"\n        onTimeSelect={handleSelect}\n      />\n    );\n\n    const buttons = screen.getAllByRole(\"button\");\n    expect(buttons.length).toBeGreaterThan(1);\n    const selectedButton = buttons[0];\n    const hoverButton = buttons[1];\n    expect(selectedButton.className).toContain(\"justify-center\");\n    expect(selectedButton.className).toContain(\"text-center\");\n    expect(hoverButton.className).toContain(\"hover:bg-primary/10\");\n\n    fireEvent.click(hoverButton);\n    expect(handleSelect).toHaveBeenCalledWith(expect.any(String));\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/TimezoneSelector.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/TruncatedTextWithTooltip.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[688,691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[688,691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { act, render, screen, waitFor } from \"@testing-library/react\";\nimport userEvent from \"@testing-library/user-event\";\nimport { TruncatedTextWithTooltip } from \"../TruncatedTextWithTooltip\";\n\ndescribe(\"TruncatedTextWithTooltip\", () => {\n  let originalRAF: typeof window.requestAnimationFrame;\n  let originalCancelRAF: typeof window.cancelAnimationFrame;\n  let resizeObserverMock: jest.Mock;\n\n  beforeEach(() => {\n    originalRAF = window.requestAnimationFrame;\n    originalCancelRAF = window.cancelAnimationFrame;\n    resizeObserverMock = jest.fn().mockImplementation(() => ({\n      observe: jest.fn(),\n      disconnect: jest.fn(),\n    }));\n    (window as any).ResizeObserver = resizeObserverMock;\n  });\n\n  afterEach(() => {\n    window.requestAnimationFrame = originalRAF;\n    window.cancelAnimationFrame = originalCancelRAF;\n  });\n\n  it(\"returns null when no text provided\", () => {\n    const { container } = render(<TruncatedTextWithTooltip text=\"\" />);\n    expect(container.firstChild).toBeNull();\n  });\n\n  it(\"does not render tooltip content when text fits\", async () => {\n    let frameCallback: FrameRequestCallback | null = null;\n    window.requestAnimationFrame = (callback: FrameRequestCallback) => {\n      frameCallback = callback;\n      return 1 as unknown as number;\n    };\n    window.cancelAnimationFrame = jest.fn();\n\n    const user = userEvent.setup();\n    render(<TruncatedTextWithTooltip text=\"Visible\" delayDuration={0} />);\n\n    const textElement = screen.getByText(\"Visible\");\n    Object.defineProperty(textElement, \"scrollHeight\", { value: 20, configurable: true });\n    Object.defineProperty(textElement, \"clientHeight\", { value: 20, configurable: true });\n    Object.defineProperty(textElement, \"scrollWidth\", { value: 20, configurable: true });\n    Object.defineProperty(textElement, \"clientWidth\", { value: 20, configurable: true });\n\n    await act(async () => {\n      frameCallback?.(performance.now());\n    });\n\n    await user.hover(textElement);\n\n    await waitFor(() => {\n      expect(screen.getAllByText(\"Visible\")).toHaveLength(1);\n    });\n  });\n\n  it(\"renders tooltip content when text is truncated\", async () => {\n    let frameCallback: FrameRequestCallback | null = null;\n    window.requestAnimationFrame = (callback: FrameRequestCallback) => {\n      frameCallback = callback;\n      return 1 as unknown as number;\n    };\n    window.cancelAnimationFrame = jest.fn();\n\n    const user = userEvent.setup();\n    render(\n      <TruncatedTextWithTooltip\n        text=\"This is a very long piece of text\"\n        lines={1}\n        delayDuration={0}\n      />\n    );\n\n    const textElement = screen.getByText(\"This is a very long piece of text\");\n    Object.defineProperty(textElement, \"scrollHeight\", { value: 120, configurable: true });\n    Object.defineProperty(textElement, \"clientHeight\", { value: 20, configurable: true });\n    Object.defineProperty(textElement, \"scrollWidth\", { value: 200, configurable: true });\n    Object.defineProperty(textElement, \"clientWidth\", { value: 100, configurable: true });\n\n    await act(async () => {\n      frameCallback?.(performance.now());\n    });\n\n    await user.hover(textElement);\n\n    const occurrences = await screen.findAllByText(\"This is a very long piece of text\");\n    expect(occurrences.length).toBeGreaterThan(1);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/TutorialExitGuardDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/TutorialFloatingCard.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/UnifiedClientDetails.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/UserMenu.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/WeeklySchedulePreview.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/WorkflowDeleteDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/__tests__/WorkflowHealthDashboard.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[392,395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[392,395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { fireEvent, render, screen } from \"@/utils/testUtils\";\nimport { WorkflowHealthDashboard } from \"../WorkflowHealthDashboard\";\nimport { useWorkflowHealth } from \"@/hooks/useWorkflowHealth\";\n\njest.mock(\"@/hooks/useWorkflowHealth\", () => ({\n  useWorkflowHealth: jest.fn(),\n}));\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string, options?: Record<string, any>, defaultValue?: string) => {\n      const translations: Record<string, string> = {\n        \"workflows.health.unableToLoad\": \"Unable to load\",\n        \"workflows.health.status.title\": \"Workflow health\",\n        \"workflows.health.status.description\": \"Monitor your automations\",\n        \"workflows.health.status.labels.healthy\": \"Healthy\",\n        \"workflows.health.status.labels.warning\": \"Warning\",\n        \"workflows.health.status.labels.critical\": \"Critical\",\n        \"workflows.health.critical.title\": \"Critical issues detected\",\n        \"workflows.health.warning.title\": \"Needs attention\",\n        \"workflows.health.actions.cleanup\": \"Clean up stuck runs\",\n        \"workflows.health.actions.refresh\": \"Refresh\",\n        \"workflows.health.actions.systemTitle\": \"System actions\",\n        \"workflows.health.actions.systemDescription\": \"Keep workflows humming\",\n        \"workflows.health.metrics.totalWorkflows\": \"Total workflows\",\n        \"workflows.health.metrics.successRate\": \"Success rate\",\n        \"workflows.health.metrics.recentExecutions\": \"Recent executions\",\n        \"workflows.health.metrics.averageExecutionTime\": \"Avg execution time\",\n        \"workflows.health.metrics.dailyTitle\": \"Daily performance\",\n        \"workflows.health.metrics.dailyDescription\": \"Per-day stats\",\n        \"workflows.health.metrics.successRateSubtitle\": \"Success over last 7 days\",\n        \"workflows.health.metrics.recentExecutionsSubtitle\": \"Runs in the last 24h\",\n        \"workflows.health.metrics.averageExecutionTimeSubtitle\": \"Average time per workflow\",\n      };\n\n      switch (key) {\n        case \"workflows.health.metrics.totalSubtitle\":\n          return `Active ${options?.active} Â· Paused ${options?.paused}`;\n        case \"workflows.health.metrics.dailyTotal\":\n          return `Total ${options?.count}`;\n        case \"workflows.health.metrics.dailySuccess\":\n          return `Success ${options?.rate}%`;\n        case \"workflows.health.metrics.dailyAverage\":\n          return `Avg ${options?.time}`;\n        case \"workflows.health.critical.stuckExecutions\":\n          return `Stuck ${options?.count}`;\n        case \"workflows.health.critical.lowSuccessRate\":\n          return `Low success ${options?.rate}%`;\n        case \"common:abbreviations.notAvailable\":\n          return defaultValue ?? \"N/A\";\n        default:\n          return translations[key] ?? key;\n      }\n    },\n  }),\n}));\n\ndescribe(\"WorkflowHealthDashboard\", () => {\n  const useWorkflowHealthMock = useWorkflowHealth as jest.Mock;\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it(\"renders loading skeleton while data is fetching\", () => {\n    useWorkflowHealthMock.mockReturnValue({\n      loading: true,\n      health: null,\n    });\n\n    const { container } = render(<WorkflowHealthDashboard />);\n\n    expect(container.querySelectorAll(\".animate-pulse\")).toHaveLength(4);\n  });\n\n  it(\"shows empty state when health is unavailable\", () => {\n    useWorkflowHealthMock.mockReturnValue({\n      loading: false,\n      health: null,\n    });\n\n    render(<WorkflowHealthDashboard />);\n\n    expect(screen.getByText(\"Unable to load\")).toBeInTheDocument();\n  });\n\n  it(\"displays critical health details and triggers actions\", () => {\n    const cleanupStuckExecutions = jest.fn();\n    const refetch = jest.fn();\n\n    useWorkflowHealthMock.mockReturnValue({\n      loading: false,\n      health: {\n        totalWorkflows: 12,\n        activeWorkflows: 6,\n        pausedWorkflows: 6,\n        successRate: 72.3,\n        recentExecutions: 45,\n        averageExecutionTime: 185,\n        stuckExecutions: 3,\n        metrics: [\n          {\n            id: \"metric-1\",\n            date: \"2024-10-24T00:00:00Z\",\n            total_executions: 20,\n            successful_executions: 14,\n            average_execution_time_ms: 210,\n          },\n        ],\n      },\n      cleanupStuckExecutions,\n      getHealthIcon: () => <span data-testid=\"health-icon\">!</span>,\n      getHealthStatus: () => \"critical\",\n      refetch,\n    });\n\n    render(<WorkflowHealthDashboard />);\n\n    expect(screen.getByText(\"Critical\")).toBeInTheDocument();\n    expect(screen.getByText(\"Stuck 3\")).toBeInTheDocument();\n    expect(screen.getByText(\"Low success 72.3%\"))\n      .toBeInTheDocument();\n    expect(screen.getByText(\"Active 6 Â· Paused 6\")).toBeInTheDocument();\n    expect(screen.getByText(\"Success 70.0%\"))\n      .toBeInTheDocument();\n    expect(screen.getByText(\"Avg 210\"))\n      .toBeInTheDocument();\n\n    const cleanupButtons = screen.getAllByText(\"Clean up stuck runs\");\n    cleanupButtons.forEach((button) => fireEvent.click(button));\n    fireEvent.click(screen.getByText(\"Refresh\"));\n\n    expect(cleanupStuckExecutions).toHaveBeenCalledTimes(2);\n    expect(refetch).toHaveBeenCalledTimes(1);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/admin/AdminLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/calendar/CalendarDay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/calendar/CalendarDayView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/calendar/CalendarErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/calendar/CalendarMonthView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/calendar/CalendarSkeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/calendar/CalendarWeek.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/calendar/__tests__/CalendarDay.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/calendar/__tests__/CalendarDayView.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/calendar/__tests__/CalendarErrorBoundary.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/calendar/__tests__/CalendarMonthView.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/calendar/__tests__/CalendarSkeleton.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/calendar/__tests__/CalendarWeek.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/common/ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/data-table/AdvancedDataTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/data-table/AdvancedDataTablePagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/data-table/TableSearchInput.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/data-table/__tests__/AdvancedDataTable.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/data-table/__tests__/TableSearchInput.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/data-table/__tests__/useAdvancedTableSearch.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/data-table/__tests__/useDraftFilters.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/data-table/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/data-table/useAdvancedTableSearch.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/data-table/useDraftFilters.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/CustomFieldDisplay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/CustomFieldDisplayWithEmpty.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/FieldCheckboxDisplay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/FieldDateDisplay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/FieldEmailDisplay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/FieldMultiSelectDisplay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/FieldNumberDisplay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/FieldPhoneDisplay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/FieldSelectDisplay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/FieldTextDisplay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/FieldTextTableDisplay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/FieldTextareaDisplay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/FieldTextareaTableDisplay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/InlineEditField.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/inline-editors/InlineCheckboxEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/inline-editors/InlineDateEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/inline-editors/InlineEmailEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/inline-editors/InlineMultiSelectEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/inline-editors/InlineNumberEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/inline-editors/InlinePhoneEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/inline-editors/InlineSelectEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/inline-editors/InlineTextEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/fields/inline-editors/InlineTextareaEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/layout-primitives/Surface.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[740,743],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[740,743],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[795,798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[795,798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { forwardRef } from \"react\";\nimport type { HTMLAttributes } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ntype SurfacePadding = \"none\" | \"sm\" | \"md\";\ntype SurfaceRadius = \"lg\" | \"xl\";\n\nconst paddingClasses: Record<SurfacePadding, string> = {\n  none: \"\",\n  sm: \"p-4\",\n  md: \"p-5\",\n};\n\nconst radiusClasses: Record<SurfaceRadius, string> = {\n  lg: \"rounded-xl\",\n  xl: \"rounded-2xl\",\n};\n\nexport interface SurfaceProps extends HTMLAttributes<HTMLElement> {\n  as?: keyof JSX.IntrinsicElements;\n  padding?: SurfacePadding;\n  radius?: SurfaceRadius;\n}\n\nexport const Surface = forwardRef<HTMLElement, SurfaceProps>(\n  ({ as = \"section\", padding = \"md\", radius = \"xl\", className, children, ...props }, ref) => {\n    const Component = as as any;\n    return (\n      <Component\n        ref={ref as any}\n        className={cn(\n          radiusClasses[radius],\n          \"border border-border/70 bg-white/80 shadow-sm\",\n          paddingClasses[padding],\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </Component>\n    );\n  }\n);\n\nSurface.displayName = \"Surface\";\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/layout-primitives/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/mobile/BottomSheetMenu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/mobile/MobileBottomNav.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2763,2766],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2763,2766],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { NavLink, useLocation, useNavigate } from 'react-router-dom';\nimport { \n  LayoutDashboard, \n  Users, \n  FolderOpen, \n  CalendarRange, \n  MoreHorizontal,\n  Calendar,\n  CalendarDays,\n  Bell,\n  BarChart3,\n  CreditCard,\n  Settings,\n  LogOut,\n  User,\n  HelpCircle,\n  Zap,\n  FileText\n} from 'lucide-react';\nimport { BottomSheetMenu } from './BottomSheetMenu';\nimport { cn } from '@/lib/utils';\nimport { supabase } from '@/integrations/supabase/client';\nimport { toast } from '@/hooks/use-toast';\nimport { useProfile } from '@/contexts/ProfileContext';\nimport { HelpModal } from '@/components/modals/HelpModal';\nimport { UserMenu } from '@/components/UserMenu';\n\ninterface NavTab {\n  title: string;\n  icon: React.ComponentType<{ className?: string }>;\n  path?: string;\n  action?: () => void;\n  badge?: number;\n}\n\nexport function MobileBottomNav({ hideForOnboarding = false }: { hideForOnboarding?: boolean }) {\n  const [bookingsOpen, setBookingsOpen] = useState(false);\n  const [automationOpen, setAutomationOpen] = useState(false);\n  const [moreOpen, setMoreOpen] = useState(false);\n  const [helpOpen, setHelpOpen] = useState(false);\n  const [isVisible, setIsVisible] = useState(true);\n  const [userEmail, setUserEmail] = useState<string>(\"\");\n  const location = useLocation();\n  const navigate = useNavigate();\n  const { profile } = useProfile();\n\n  // Get user email from auth\n  useEffect(() => {\n    const getUser = async () => {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (user?.email) {\n        setUserEmail(user.email);\n      }\n    };\n    getUser();\n  }, []);\n\n  // Hide on auth routes, keyboard open, and during onboarding\n  useEffect(() => {\n    const isAuthRoute = location.pathname === '/auth';\n    \n    const handleResize = () => {\n      // Hide when keyboard is likely open (viewport height reduced significantly)\n      const isKeyboardOpen = window.visualViewport \n        ? window.visualViewport.height < window.innerHeight * 0.75\n        : false;\n      \n      setIsVisible(!isAuthRoute && !isKeyboardOpen && !hideForOnboarding);\n    };\n\n    handleResize();\n    window.addEventListener('resize', handleResize);\n    if (window.visualViewport) {\n      window.visualViewport.addEventListener('resize', handleResize);\n    }\n\n    return () => {\n      window.removeEventListener('resize', handleResize);\n      if (window.visualViewport) {\n        window.visualViewport.removeEventListener('resize', handleResize);\n      }\n    };\n  }, [location.pathname, hideForOnboarding]);\n\n  const handleSignOut = async () => {\n    if (window.confirm('Are you sure you want to sign out?')) {\n      try {\n        await supabase.auth.signOut();\n        navigate('/auth');\n      } catch (error: any) {\n        toast({\n          title: \"Error signing out\",\n          description: error.message,\n          variant: \"destructive\"\n        });\n      }\n    }\n  };\n\n  const scrollToTop = () => {\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n  };\n\n  const tabs: NavTab[] = [\n    { title: 'Dashboard', icon: LayoutDashboard, path: '/' },\n    { title: 'Leads', icon: Users, path: '/leads' },\n    { title: 'Projects', icon: FolderOpen, path: '/projects' },\n    { title: 'Bookings', icon: CalendarRange, action: () => setBookingsOpen(true) },\n    { title: 'More', icon: MoreHorizontal, action: () => setMoreOpen(true) }\n  ];\n\n  const bookingItems = [\n    {\n      title: 'Calendar',\n      icon: CalendarDays,\n      onClick: () => navigate('/calendar')\n    },\n    {\n      title: 'Sessions',\n      icon: Calendar,\n      onClick: () => navigate('/sessions')\n    },\n    {\n      title: 'Reminders',\n      icon: Bell,\n      onClick: () => navigate('/reminders')\n    }\n  ];\n\n  const automationItems = [\n    {\n      title: 'Workflows',\n      icon: BarChart3,\n      onClick: () => navigate('/workflows')\n    },\n    {\n      title: 'Templates',\n      icon: FileText,\n      onClick: () => navigate('/templates')\n    }\n  ];\n\n  const moreItems = [\n    {\n      title: 'Analytics',\n      icon: BarChart3,\n      onClick: () => navigate('/analytics')\n    },\n    {\n      title: 'Automation',\n      icon: Zap,\n      onClick: () => setAutomationOpen(true)\n    },\n    {\n      title: 'Payments',\n      icon: CreditCard,\n      onClick: () => navigate('/payments')\n    },\n    {\n      title: 'Settings',\n      icon: Settings,\n      onClick: () => navigate('/settings'),\n      testId: 'mobile-settings'\n    },\n    {\n      title: 'Help & Support',\n      icon: HelpCircle,\n      onClick: () => setHelpOpen(true)\n    },\n    {\n      title: 'Sign Out',\n      icon: LogOut,\n      onClick: handleSignOut,\n      variant: 'destructive' as const\n    }\n  ];\n\n  const isActive = (path: string) => {\n    if (path === '/') {\n      return location.pathname === '/';\n    }\n    return location.pathname.startsWith(path);\n  };\n\n  const isBookingsActive = ['/calendar', '/sessions', '/reminders'].some(path =>\n    location.pathname.startsWith(path)\n  );\n\n  const isAutomationActive = ['/workflows', '/templates'].some(path =>\n    location.pathname.startsWith(path)\n  );\n\n  const isMoreActive = ['/analytics', '/payments', '/settings'].some(path =>\n    location.pathname.startsWith(path)\n  ) || isAutomationActive;\n\n  if (!isVisible) return null;\n\n  return (\n    <>\n      <nav \n        className=\"md:hidden fixed bottom-0 left-0 right-0 z-50 bg-background/90 backdrop-blur-md border-t supports-[backdrop-filter]:bg-background/50 mobile-bottom-nav\"\n        style={{ \n          paddingBottom: 'max(env(safe-area-inset-bottom), 8px)',\n          position: 'fixed',\n          bottom: 0,\n        }}\n      >\n        <div className=\"flex items-center justify-around px-2 py-2\">\n          {tabs.map((tab, index) => {\n            const Icon = tab.icon;\n            let active = false;\n            \n            if (tab.path) {\n              active = isActive(tab.path);\n            } else if (tab.title === 'Bookings') {\n              active = isBookingsActive;\n            } else if (tab.title === 'More') {\n              active = isMoreActive;\n            }\n\n            const handleTabPress = () => {\n              if (tab.path) {\n                if (active) {\n                  scrollToTop();\n                } else {\n                  navigate(tab.path);\n                }\n              } else if (tab.action) {\n                tab.action();\n              }\n            };\n\n            return (\n              <button\n                key={index}\n                onClick={handleTabPress}\n                data-walkthrough={tab.title === 'More' ? 'mobile-more-tab' : undefined}\n                className={cn(\n                  \"flex flex-col items-center justify-center min-h-[44px] px-2 py-1 rounded-lg transition-colors relative\",\n                  \"hover:bg-muted/50 active:bg-muted\"\n                )}\n              >\n                <Icon \n                  className={cn(\n                    \"h-5 w-5 mb-1\",\n                    active ? \"text-primary\" : \"text-muted-foreground\"\n                  )} \n                />\n                <span \n                  className={cn(\n                    \"text-[10px] font-medium leading-tight\",\n                    active ? \"text-primary\" : \"text-muted-foreground\"\n                  )}\n                >\n                  {tab.title}\n                </span>\n                \n                {tab.badge && tab.badge > 0 && (\n                  <div className=\"absolute -top-1 -right-1 bg-destructive text-destructive-foreground text-[10px] font-bold rounded-full h-4 w-4 flex items-center justify-center\">\n                    {tab.badge > 9 ? '9+' : tab.badge}\n                  </div>\n                )}\n              </button>\n            );\n          })}\n        </div>\n      </nav>\n\n      <BottomSheetMenu\n        title=\"Bookings\"\n        isOpen={bookingsOpen}\n        onOpenChange={setBookingsOpen}\n        items={bookingItems}\n      />\n\n      <BottomSheetMenu\n        title=\"Automation\"\n        isOpen={automationOpen}\n        onOpenChange={setAutomationOpen}\n        items={automationItems}\n      />\n\n      <BottomSheetMenu\n        title=\"More\"\n        isOpen={moreOpen}\n        onOpenChange={setMoreOpen}\n        items={moreItems}\n        customContent={\n          <div className=\"mt-4 border-t pt-4\">\n            <UserMenu \n              variant=\"mobile\" \n              onNavigate={() => setMoreOpen(false)} \n            />\n          </div>\n        }\n      />\n\n      <HelpModal \n        isOpen={helpOpen} \n        onOpenChange={setHelpOpen} \n      />\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/mobile/__tests__/BottomSheetMenu.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[241,244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[241,244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[467,470],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[467,470],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[601,604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[601,604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[688,691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[688,691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { fireEvent, render, screen } from \"@/utils/testUtils\";\nimport { BottomSheetMenu } from \"../BottomSheetMenu\";\n\nconst sheetRenderSpy = jest.fn();\n\njest.mock(\"@/components/ui/sheet\", () => ({\n  Sheet: ({ children, open, onOpenChange }: any) => {\n    sheetRenderSpy({ open, onOpenChange });\n    return (\n      <div data-testid=\"sheet-root\" data-open={open ? \"true\" : \"false\"}>\n        {children}\n      </div>\n    );\n  },\n  SheetContent: ({ children, className }: any) => (\n    <div data-testid=\"sheet-content\" data-class={className}>\n      {children}\n    </div>\n  ),\n  SheetHeader: ({ children }: any) => <div data-testid=\"sheet-header\">{children}</div>,\n  SheetTitle: ({ children }: any) => <h2>{children}</h2>,\n}));\n\ndescribe(\"BottomSheetMenu\", () => {\n  const createIcon = (testId: string) =>\n    ({ className }: { className?: string }) =>\n      <svg data-testid={`icon-${testId}`} className={className} />;\n\n  const baseItems = [\n    {\n      title: \"Edit item\",\n      icon: createIcon(\"edit\"),\n      onClick: jest.fn(),\n    },\n    {\n      title: \"Delete item\",\n      icon: createIcon(\"delete\"),\n      onClick: jest.fn(),\n      variant: \"destructive\" as const,\n      testId: \"delete-button\",\n    },\n  ];\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    baseItems.forEach((item) => item.onClick.mockReset());\n  });\n\n  it(\"renders the menu title and provided actions\", () => {\n    render(\n      <BottomSheetMenu\n        title=\"Quick actions\"\n        isOpen\n        onOpenChange={jest.fn()}\n        items={baseItems}\n        customContent={<div data-testid=\"custom-content\">Custom</div>}\n      />\n    );\n\n    expect(screen.getByTestId(\"sheet-root\")).toHaveAttribute(\"data-open\", \"true\");\n    expect(screen.getByRole(\"heading\", { name: \"Quick actions\" })).toBeInTheDocument();\n    expect(screen.getByRole(\"button\", { name: \"Edit item\" })).toBeInTheDocument();\n    expect(screen.getByRole(\"button\", { name: \"Delete item\" })).toBeInTheDocument();\n    expect(screen.getByTestId(\"icon-edit\")).toBeInTheDocument();\n    expect(screen.getByTestId(\"icon-delete\")).toBeInTheDocument();\n    expect(screen.getByTestId(\"custom-content\")).toBeInTheDocument();\n  });\n\n  it(\"invokes the item callback and closes the sheet when an action is clicked\", () => {\n    const onOpenChange = jest.fn();\n    render(\n      <BottomSheetMenu\n        title=\"Quick actions\"\n        isOpen\n        onOpenChange={onOpenChange}\n        items={baseItems}\n      />\n    );\n\n    fireEvent.click(screen.getByRole(\"button\", { name: \"Edit item\" }));\n\n    expect(baseItems[0].onClick).toHaveBeenCalledTimes(1);\n    expect(onOpenChange).toHaveBeenCalledWith(false);\n  });\n\n  it(\"applies destructive styling to destructive variants\", () => {\n    render(\n      <BottomSheetMenu\n        title=\"Quick actions\"\n        isOpen\n        onOpenChange={jest.fn()}\n        items={baseItems}\n      />\n    );\n\n    const destructiveButton = screen.getByRole(\"button\", { name: \"Delete item\" });\n    expect(destructiveButton.className).toContain(\"text-destructive\");\n    expect(destructiveButton).toHaveAttribute(\"data-walkthrough\", \"delete-button\");\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/mobile/__tests__/MobileBottomNav.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/modals/HelpModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/modals/__tests__/HelpModal.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":10,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":10,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[365,368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[365,368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[705,708],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[705,708],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[862,865],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[862,865],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1006,1009],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1006,1009],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1073,1076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1073,1076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { fireEvent, render, screen } from \"@/utils/testUtils\";\nimport { HelpModal } from \"../HelpModal\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\n\njest.mock(\"@/hooks/use-mobile\", () => ({\n  useIsMobile: jest.fn(),\n}));\n\njest.mock(\"@/components/ui/dialog\", () => {\n  const React = require(\"react\");\n  return {\n    Dialog: ({ open, onOpenChange, children }: any) => (\n      <div\n        data-testid=\"dialog-root\"\n        data-open={open ? \"true\" : \"false\"}\n        data-has-handler={typeof onOpenChange === \"function\" ? \"true\" : \"false\"}\n      >\n        {typeof children === \"function\" ? children({ open, onOpenChange }) : children}\n      </div>\n    ),\n    DialogContent: ({ children, className }: any) => (\n      <div data-testid=\"dialog-content\" data-class={className}>\n        {children}\n      </div>\n    ),\n    DialogHeader: ({ children, className }: any) => (\n      <div data-testid=\"dialog-header\" data-class={className}>\n        {children}\n      </div>\n    ),\n    DialogTitle: ({ children }: any) => <h2>{children}</h2>,\n    DialogDescription: ({ children }: any) => <p>{children}</p>,\n  };\n});\n\nconst translations: Record<string, string> = {\n  \"help.title\": \"Need a hand?\",\n  \"help.description\": \"Choose how you want to reach us.\",\n  \"help.options.documentation.title\": \"Documentation\",\n  \"help.options.documentation.description\": \"Read the Lumiso handbook.\",\n  \"help.options.support.title\": \"Email Support\",\n  \"help.options.support.description\": \"Drop a note to our support inbox.\",\n  \"help.options.chat.title\": \"Live Chat\",\n  \"help.options.chat.description\": \"Ping the team in real time.\",\n  \"help.close\": \"Close\",\n};\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string) => translations[key] ?? key,\n  }),\n}));\n\nconst useIsMobileMock = useIsMobile as jest.Mock;\n\ndescribe(\"HelpModal\", () => {\nlet consoleSpy: jest.SpyInstance;\nlet windowOpenSpy: jest.SpyInstance;\nlet initialHref: string;\n\n\n  beforeEach(() => {\n    useIsMobileMock.mockReturnValue(false);\n    consoleSpy = jest.spyOn(console, \"log\").mockImplementation(() => {});\n    windowOpenSpy = jest.spyOn(window, \"open\").mockImplementation(() => null);\n    initialHref = window.location.href;\n  });\n\n  afterEach(() => {\n    consoleSpy.mockRestore();\n    windowOpenSpy.mockRestore();\n    window.location.href = initialHref;\n    jest.clearAllMocks();\n  });\n\n  it(\"renders support options and triggers their actions while closing the modal\", () => {\n    const onOpenChange = jest.fn();\n\n    render(<HelpModal isOpen onOpenChange={onOpenChange} />);\n\n    expect(screen.getByTestId(\"dialog-root\")).toHaveAttribute(\"data-open\", \"true\");\n    expect(screen.getByRole(\"heading\", { name: \"Need a hand?\" })).toBeInTheDocument();\n    expect(\n      screen.getByText(\"Choose how you want to reach us.\")\n    ).toBeInTheDocument();\n\n    // Documentation option\n    fireEvent.click(\n      screen.getByText(\"Documentation\").closest(\"button\") as HTMLButtonElement\n    );\n    expect(windowOpenSpy).toHaveBeenCalledWith(\n      \"https://docs.lumiso.com\",\n      \"_blank\"\n    );\n    expect(onOpenChange).toHaveBeenCalledWith(false);\n\n    // Email support option\n    fireEvent.click(\n      screen.getByText(\"Email Support\").closest(\"button\") as HTMLButtonElement\n    );\n    expect(onOpenChange).toHaveBeenCalledWith(false);\n\n    // Live chat option\n    fireEvent.click(\n      screen.getByText(\"Live Chat\").closest(\"button\") as HTMLButtonElement\n    );\n    expect(consoleSpy).toHaveBeenCalledWith(\"Opening live chat...\");\n    expect(onOpenChange).toHaveBeenCalledWith(false);\n  });\n\n  it(\"applies mobile layout tweaks and closes when pressing the footer button\", () => {\n    useIsMobileMock.mockReturnValue(true);\n    const onOpenChange = jest.fn();\n\n    render(<HelpModal isOpen onOpenChange={onOpenChange} />);\n\n    expect(screen.getByTestId(\"dialog-content\").dataset.class).toContain(\n      \"w-[calc(100vw-2rem)]\"\n    );\n    expect(screen.getByTestId(\"dialog-header\").dataset.class).toBe(\"px-2\");\n\n    fireEvent.click(screen.getByRole(\"button\", { name: \"Close\" }));\n    expect(onOpenChange).toHaveBeenCalledWith(false);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/navigation/StickySectionNav.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":50,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":50,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useRef, useState } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface StickySectionNavItem {\n  id: string;\n  title: string;\n  onSelect?: () => void;\n}\n\nexport interface StickySectionNavProps {\n  items: StickySectionNavItem[];\n  stickyTopOffset?: number;\n  align?: \"start\" | \"center\" | \"end\";\n  ariaLabel?: string;\n  className?: string;\n  navClassName?: string;\n  observeIds?: string[];\n  onActiveChange?: (id: string) => void;\n  fallbackActiveId?: string;\n  scrollBehavior?: ScrollBehavior;\n  disableSticky?: boolean;\n}\n\nconst ALIGN_CLASSNAMES: Record<NonNullable<StickySectionNavProps[\"align\"]>, string> = {\n  start: \"justify-start\",\n  center: \"justify-center\",\n  end: \"justify-end\"\n};\n\nconst BASE_NAV_BUTTON_CLASSES = [\n  \"flex-shrink-0\",\n  \"whitespace-nowrap\",\n  \"rounded-full\",\n  \"border\",\n  \"px-3\",\n  \"py-1.5\",\n  \"text-sm\",\n  \"font-medium\",\n  \"transition-colors\",\n  \"focus-visible:outline-none\",\n  \"focus-visible:ring-2\",\n  \"focus-visible:ring-offset-2\",\n  \"focus-visible:ring-primary\"\n].join(\" \");\n\nconst ACTIVE_NAV_CLASSES = \"border-primary/50 bg-primary/10 text-primary shadow-sm\";\nconst INACTIVE_NAV_CLASSES =\n  \"border-transparent bg-muted/20 text-muted-foreground hover:bg-muted/30 hover:text-foreground\";\n\nexport const STICKY_NAV_CLASSES = {\n  baseButton: BASE_NAV_BUTTON_CLASSES,\n  active: ACTIVE_NAV_CLASSES,\n  inactive: INACTIVE_NAV_CLASSES\n};\n\nexport function StickySectionNav({\n  items,\n  stickyTopOffset = 0,\n  align = \"end\",\n  ariaLabel = \"Section navigation\",\n  className,\n  navClassName,\n  observeIds,\n  onActiveChange,\n  fallbackActiveId,\n  scrollBehavior = \"smooth\",\n  disableSticky = false\n}: StickySectionNavProps) {\n  const [activeId, setActiveId] = useState<string>(() => fallbackActiveId ?? items[0]?.id ?? \"\");\n  const observer = useRef<IntersectionObserver | null>(null);\n\n  const idsToObserve = useMemo(() => {\n    const ids = observeIds && observeIds.length > 0 ? observeIds : items.map((item) => item.id);\n    return Array.from(new Set(ids)).filter(Boolean);\n  }, [observeIds, items]);\n\n  useEffect(() => {\n    if (idsToObserve.length === 0 || typeof window === \"undefined\") {\n      return undefined;\n    }\n\n    const headings = idsToObserve\n      .map((id) => document.getElementById(id))\n      .filter((el): el is HTMLElement => Boolean(el));\n\n    observer.current?.disconnect();\n    observer.current = new IntersectionObserver(\n      (entries) => {\n        const visible = entries\n          .filter((entry) => entry.isIntersecting)\n          .sort((a, b) => b.intersectionRatio - a.intersectionRatio);\n\n        if (visible[0]?.target?.id) {\n          setActiveId(visible[0].target.id);\n        }\n      },\n      { rootMargin: \"-100px 0px -60% 0px\", threshold: [0, 0.5, 1] }\n    );\n\n    headings.forEach((el) => observer.current?.observe(el));\n\n    return () => observer.current?.disconnect();\n  }, [idsToObserve]);\n\n  useEffect(() => {\n    if (idsToObserve.length === 0) {\n      setActiveId(\"\");\n      return;\n    }\n\n    setActiveId((prev) => {\n      if (prev && idsToObserve.includes(prev)) {\n        return prev;\n      }\n      const preferred =\n        fallbackActiveId && idsToObserve.includes(fallbackActiveId)\n          ? fallbackActiveId\n          : idsToObserve[0];\n      return preferred ?? \"\";\n    });\n  }, [idsToObserve, fallbackActiveId]);\n\n  useEffect(() => {\n    if (activeId && onActiveChange) {\n      onActiveChange(activeId);\n    }\n  }, [activeId, onActiveChange]);\n\n  const handleSelect = (item: StickySectionNavItem) => {\n    setActiveId(item.id);\n\n    if (item.onSelect) {\n      item.onSelect();\n      return;\n    }\n\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    const target = document.getElementById(item.id);\n    if (target) {\n      target.scrollIntoView({ behavior: scrollBehavior, block: \"start\" });\n    }\n  };\n\n  if (items.length === 0) {\n    return null;\n  }\n\n  const containerClasses = disableSticky\n    ? \"border-b border-border/20 bg-background/70 px-2 py-3 backdrop-blur supports-[backdrop-filter]:bg-background/50\"\n    : \"sticky z-30 -mx-2 mb-6 border-b border-border/20 bg-background/70 px-2 py-3 backdrop-blur supports-[backdrop-filter]:bg-background/50\";\n\n  const containerStyle = disableSticky ? undefined : { top: stickyTopOffset };\n\n  return (\n    <div\n      className={cn(containerClasses, className)}\n      style={containerStyle}\n    >\n      <nav\n        className={cn(\n          \"flex w-full max-w-full items-center gap-2 overflow-x-auto\",\n          ALIGN_CLASSNAMES[align],\n          navClassName\n        )}\n        aria-label={ariaLabel}\n      >\n        {items.map((item) => {\n          const buttonClasses = [\n            BASE_NAV_BUTTON_CLASSES,\n            item.id === activeId ? ACTIVE_NAV_CLASSES : INACTIVE_NAV_CLASSES\n          ].join(\" \");\n\n          return (\n            <button\n              key={item.id}\n              type=\"button\"\n              className={buttonClasses}\n              onClick={() => handleSelect(item)}\n              aria-current={item.id === activeId ? \"page\" : undefined}\n            >\n              {item.title}\n            </button>\n          );\n        })}\n      </nav>\n    </div>\n  );\n}\n\nexport default StickySectionNav;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/navigation/__tests__/StickySectionNav.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/project-details/ProjectDetailsLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/project-details/Section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/project-details/StickySectionNav.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":3,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":3,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export {\n  StickySectionNav as default,\n  STICKY_NAV_CLASSES\n} from \"@/components/navigation/StickySectionNav\";\n\nexport type {\n  StickySectionNavProps,\n  StickySectionNavItem\n} from \"@/components/navigation/StickySectionNav\";\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/project-details/Summary/ClientCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/project-details/Summary/CompactProjectBanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/project-details/Summary/CompactSessionBanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/project-details/Summary/FinancialSummaryCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/project-details/Summary/ProjectSummaryCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/project-details/Summary/QuickActionsCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/project-details/Summary/SessionsSummaryCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/projectArchiveToggle.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/services/ServicesTableCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/services/SummaryTotalsCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/services/__tests__/ServicesTableCard.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/services/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/AutoSaveToggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/CategoryFloatingActionBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/CategorySettingsSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/EnhancedSettingsSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/LeadStatusDialogs.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'formData.lifecycle'. Either include it or remove the dependency array.","line":44,"column":6,"nodeType":"ArrayExpression","endLine":44,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [formData.lifecycle, formData.name]","fix":{"range":[1842,1857],"text":"[formData.lifecycle, formData.name]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3428,3431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3428,3431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":230,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7826,7829],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7826,7829],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":290,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":290,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9492,9495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9492,9495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":361,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":361,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11219,11222],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11219,11222],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { AppSheetModal } from \"@/components/ui/app-sheet-modal\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\nimport { useTranslation } from \"react-i18next\";\nimport { useModalNavigation } from \"@/hooks/useModalNavigation\";\nimport { SegmentedControl } from \"@/components/ui/segmented-control\";\nimport { NavigationGuardDialog } from \"./NavigationGuardDialog\";\n\ninterface AddLeadStatusDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onStatusAdded: () => void;\n}\n\nexport function AddLeadStatusDialog({ open, onOpenChange, onStatusAdded }: AddLeadStatusDialogProps) {\n  const { t } = useTranslation(['forms', 'common']);\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    color: \"#3B82F6\",\n    lifecycle: \"active\" as \"active\" | \"completed\" | \"cancelled\", // No \"archived\" for leads\n  });\n\n  // Smart default based on name (no \"archived\" for leads)\n  const getSmartLifecycleDefault = (name: string): \"active\" | \"completed\" | \"cancelled\" => {\n    const lowerName = name.toLowerCase();\n    if (lowerName.includes(\"cancel\")) return \"cancelled\";\n    if (lowerName.includes(\"complete\") || lowerName.includes(\"deliver\") || lowerName.includes(\"done\")) return \"completed\";\n    return \"active\";\n  };\n\n  // Update lifecycle when name changes\n  useEffect(() => {\n    if (formData.name) {\n      const suggestedLifecycle = getSmartLifecycleDefault(formData.name);\n      if (suggestedLifecycle !== formData.lifecycle) {\n        setFormData(prev => ({ ...prev, lifecycle: suggestedLifecycle }));\n      }\n    }\n  }, [formData.name]);\n\n  const handleSubmit = async () => {\n    if (!formData.name.trim()) {\n      toast({\n        title: t('errors.title', { defaultValue: 'Error' }),\n        description: t('lead_status.errors.name_required'),\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('User not authenticated');\n\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) throw new Error('No organization found');\n\n      // Get the next sort order\n      const { data: existingStatuses } = await supabase\n        .from('lead_statuses')\n        .select('sort_order')\n        .eq('organization_id', organizationId)\n        .order('sort_order', { ascending: false })\n        .limit(1);\n\n      const nextSortOrder = (existingStatuses?.[0]?.sort_order || 0) + 1;\n\n      const { error } = await supabase\n        .from('lead_statuses')\n        .insert({\n          user_id: user.id,\n          organization_id: organizationId,\n          name: formData.name.trim(),\n          color: formData.color,\n          lifecycle: formData.lifecycle,\n          sort_order: nextSortOrder,\n          is_system_final: false,\n          is_default: false\n        });\n\n      if (error) throw error;\n\n      toast({\n        title: t('success.created'),\n        description: t('lead_status.success.added')\n      });\n\n      setFormData({ name: \"\", color: \"#3B82F6\", lifecycle: \"active\" });\n      onOpenChange(false);\n      onStatusAdded();\n    } catch (error: any) {\n      toast({\n        title: t('lead_status.errors.add_failed'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isDirty = Boolean(formData.name.trim() || formData.color !== \"#3B82F6\" || formData.lifecycle !== \"active\");\n\n  const navigation = useModalNavigation({\n    isDirty,\n    onDiscard: () => {\n      setFormData({ name: \"\", color: \"#3B82F6\", lifecycle: \"active\" });\n      onOpenChange(false);\n    },\n    onSaveAndExit: async () => {\n      await handleSubmit();\n    }\n  });\n\n  const handleDirtyClose = () => {\n    const canClose = navigation.handleModalClose();\n    if (canClose) {\n      setFormData({ name: \"\", color: \"#3B82F6\", lifecycle: \"active\" });\n      onOpenChange(false);\n    }\n  };\n\n  const footerActions = [\n    {\n      label: t('buttons.cancel', { ns: 'common' }),\n      onClick: handleDirtyClose,\n      variant: \"outline\" as const,\n      disabled: loading\n    },\n    {\n      label: loading ? t('lead_status.buttons.adding') : t('buttons.add', { ns: 'common' }),\n      onClick: handleSubmit,\n      disabled: loading || !formData.name.trim(),\n      loading: loading\n    }\n  ];\n\n  const colorOptions = [\n    \"#EF4444\", \"#F97316\", \"#EAB308\", \"#84CC16\", \"#22C55E\", \"#06B6D4\",\n    \"#3B82F6\", \"#6366F1\", \"#8B5CF6\", \"#A855F7\", \"#EC4899\", \"#64748B\"\n  ];\n\n  return (\n    <AppSheetModal\n      title={t('lead_status.add_title')}\n      isOpen={open}\n      onOpenChange={onOpenChange}\n      size=\"content\"\n      dirty={isDirty}\n      onDirtyClose={handleDirtyClose}\n      footerActions={footerActions}\n    >\n      <div className=\"space-y-6\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"name\">{t('lead_status.name_label')}</Label>\n          <Input\n            id=\"name\"\n            value={formData.name}\n            onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n            placeholder={t('lead_status.name_placeholder')}\n            maxLength={50}\n            className=\"rounded-xl\"\n          />\n          <p className=\"text-sm text-muted-foreground\">{t('lead_status.name_help')}</p>\n        </div>\n\n      <div className=\"space-y-3\">\n        <Label>{t('lead_status.color_label')}</Label>\n        <div className=\"grid grid-cols-6 gap-3 p-2\">\n          {colorOptions.map((color) => (\n            <button\n              key={color}\n              type=\"button\"\n              onClick={() => setFormData(prev => ({ ...prev, color }))}\n              className={`w-10 h-10 rounded-full border-4 transition-all ${\n                formData.color === color \n                  ? 'border-gray-900 scale-110' \n                  : 'border-transparent hover:scale-105'\n              }`}\n              style={{ backgroundColor: color }}\n            />\n          ))}\n        </div>\n      </div>\n\n      <div className=\"space-y-3\">\n        <Label>{t('lead_status.lifecycle.label')}</Label>\n        <SegmentedControl\n          size=\"md\"\n          value={formData.lifecycle}\n          onValueChange={(value) =>\n            setFormData(prev => ({ ...prev, lifecycle: value as typeof prev.lifecycle }))\n          }\n          options={[\n            { value: \"active\", label: t('lead_status.lifecycle.active') },\n            { value: \"completed\", label: t('lead_status.lifecycle.completed') },\n            { value: \"cancelled\", label: t('lead_status.lifecycle.cancelled') },\n          ]}\n          className=\"mt-2 w-full justify-between\"\n        />\n        <div className=\"space-y-1 text-sm text-muted-foreground\">\n          <p>{t('lead_status.lifecycle.help.title')}</p>\n          <ul className=\"space-y-1 ml-4\">\n            <li>â€¢ <strong>{t('lead_status.lifecycle.active')}</strong>: {t('lead_status.lifecycle.help.active')}</li>\n            <li>â€¢ <strong>{t('lead_status.lifecycle.completed')}</strong>: {t('lead_status.lifecycle.help.completed')}</li>\n            <li>â€¢ <strong>{t('lead_status.lifecycle.cancelled')}</strong>: {t('lead_status.lifecycle.help.cancelled')}</li>\n          </ul>\n        </div>\n      </div>\n      </div>\n\n      <NavigationGuardDialog\n        open={navigation.showGuard}\n        onDiscard={navigation.handleDiscardChanges}\n        onStay={navigation.handleStayOnModal}\n        onSaveAndExit={navigation.handleSaveAndExit}\n        message={navigation.message}\n      />\n    </AppSheetModal>\n  );\n}\n\ninterface EditLeadStatusDialogProps {\n  status: any;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onStatusUpdated: () => void;\n}\n\nexport function EditLeadStatusDialog({ status, open, onOpenChange, onStatusUpdated }: EditLeadStatusDialogProps) {\n  const { t } = useTranslation(['forms', 'common']);\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    color: \"#3B82F6\",\n    lifecycle: \"active\" as \"active\" | \"completed\" | \"cancelled\", // No \"archived\" for leads\n  });\n\n  useEffect(() => {\n    if (status && open) {\n      setFormData({\n        name: status.name,\n        color: status.color,\n        lifecycle: status.lifecycle || \"active\",\n      });\n    }\n  }, [status, open]);\n\n  const handleSubmit = async () => {\n    if (!status) return;\n    if (!formData.name.trim()) {\n      toast({\n        title: t('errors.title', { defaultValue: 'Error' }),\n        description: t('lead_status.errors.name_required'),\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) throw new Error('No organization found');\n\n      const { error } = await supabase\n        .from('lead_statuses')\n        .update({\n          name: formData.name.trim(),\n          color: formData.color,\n          lifecycle: formData.lifecycle,\n        })\n        .eq('id', status.id)\n        .eq('organization_id', organizationId);\n\n      if (error) throw error;\n\n      toast({\n        title: t('success.updated'),\n        description: t('lead_status.success.updated')\n      });\n\n      onOpenChange(false);\n      onStatusUpdated();\n    } catch (error: any) {\n      toast({\n        title: t('lead_status.errors.update_failed'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isDirty = status ? Boolean(\n    formData.name !== status.name ||\n    formData.color !== status.color ||\n    formData.lifecycle !== (status.lifecycle || \"active\")\n  ) : false;\n\n  const navigation = useModalNavigation({\n    isDirty,\n    onDiscard: () => {\n      onOpenChange(false);\n    },\n    onSaveAndExit: async () => {\n      await handleSubmit();\n    }\n  });\n\n  if (!status) return null;\n\n  const handleDirtyClose = () => {\n    const canClose = navigation.handleModalClose();\n    if (canClose) {\n      onOpenChange(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!status) return;\n    \n    // Check if it's a system required status\n    if (status.is_system_required) {\n      toast({\n        title: t('errors.title', { defaultValue: 'Cannot Delete' }),\n        description: t('lead_status.errors.cannot_delete'),\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    if (!window.confirm(t('lead_status.confirm.delete'))) return;\n    \n    setLoading(true);\n    try {\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) throw new Error('No organization found');\n\n      const { error } = await supabase\n        .from('lead_statuses')\n        .delete()\n        .eq('id', status.id)\n        .eq('organization_id', organizationId);\n\n      if (error) throw error;\n\n      toast({\n        title: t('success.deleted'),\n        description: t('lead_status.success.deleted')\n      });\n\n      onOpenChange(false);\n      onStatusUpdated();\n    } catch (error: any) {\n      toast({\n        title: t('lead_status.errors.delete_failed'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isSystemRequired = Boolean(status.is_system_required);\n\n  const footerActions = [\n    // Only show delete for non-system-required statuses  \n    ...(!isSystemRequired ? [{\n      label: t('buttons.delete', { ns: 'common' }),\n      onClick: handleDelete,\n      variant: \"destructive\" as const,\n      disabled: loading\n    }] : []),\n    {\n      label: t('buttons.cancel', { ns: 'common' }),\n      onClick: handleDirtyClose,\n      variant: \"outline\" as const,\n      disabled: loading\n    },\n    {\n      label: loading ? t('actions.saving', { ns: 'common' }) : t('buttons.save', { ns: 'common' }),\n      onClick: handleSubmit,\n      disabled: loading || !formData.name.trim(),\n      loading: loading\n    }\n  ];\n\n  const colorOptions = [\n    \"#EF4444\", \"#F97316\", \"#EAB308\", \"#84CC16\", \"#22C55E\", \"#06B6D4\",\n    \"#3B82F6\", \"#6366F1\", \"#8B5CF6\", \"#A855F7\", \"#EC4899\", \"#64748B\"\n  ];\n\n  return (\n    <AppSheetModal\n      title={t('lead_status.edit_title')}\n      isOpen={open}\n      onOpenChange={onOpenChange}\n      size=\"content\"\n      dirty={isDirty}\n      onDirtyClose={handleDirtyClose}\n      footerActions={footerActions}\n    >\n      <div className=\"space-y-6\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"name\">{t('lead_status.name_label')}</Label>\n          <Input\n            id=\"name\"\n            value={formData.name}\n            onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n            placeholder={t('lead_status.name_placeholder')}\n            maxLength={50}\n            className=\"rounded-xl\"\n          />\n          {isSystemRequired && (\n            <p className=\"text-sm text-muted-foreground\">\n              {t('lead_status.system_required_note')}\n            </p>\n          )}\n        </div>\n\n        <div className=\"space-y-3\">\n          <Label>{t('lead_status.color_label')}</Label>\n          <div className=\"grid grid-cols-6 gap-3 p-2\">\n            {colorOptions.map((color) => (\n              <button\n                key={color}\n                type=\"button\"\n                onClick={() => setFormData(prev => ({ ...prev, color }))}\n                className={`w-10 h-10 rounded-full border-4 transition-all ${\n                  formData.color === color \n                    ? 'border-gray-900 scale-110' \n                    : 'border-transparent hover:scale-105'\n                }`}\n                style={{ backgroundColor: color }}\n              />\n            ))}\n          </div>\n        </div>\n\n        {/* Only show lifecycle selector for non-system-required statuses */}\n        {!isSystemRequired && (\n          <div className=\"space-y-3\">\n            <Label>{t('lead_status.lifecycle.label')}</Label>\n            <SegmentedControl\n              size=\"md\"\n              value={formData.lifecycle}\n              onValueChange={(value) =>\n                setFormData(prev => ({ ...prev, lifecycle: value as typeof prev.lifecycle }))\n              }\n              options={[\n                { value: \"active\", label: t('lead_status.lifecycle.active') },\n                { value: \"completed\", label: t('lead_status.lifecycle.completed') },\n                { value: \"cancelled\", label: t('lead_status.lifecycle.cancelled') },\n              ]}\n              className=\"mt-2 w-full justify-between\"\n            />\n            <div className=\"space-y-1 text-sm text-muted-foreground\">\n              <p>{t('lead_status.lifecycle.help.title')}</p>\n              <ul className=\"space-y-1 ml-4\">\n                <li>â€¢ <strong>{t('lead_status.lifecycle.active')}</strong>: {t('lead_status.lifecycle.help.active')}</li>\n                <li>â€¢ <strong>{t('lead_status.lifecycle.completed')}</strong>: {t('lead_status.lifecycle.help.completed')}</li>\n                <li>â€¢ <strong>{t('lead_status.lifecycle.cancelled')}</strong>: {t('lead_status.lifecycle.help.cancelled')}</li>\n              </ul>\n            </div>\n          </div>\n        )}\n\n        {/* Show info for system required statuses */}\n        {isSystemRequired && (\n          <div className=\"p-3 bg-blue-50 border border-blue-200 rounded-lg\">\n            <p className=\"text-sm text-blue-800\">\n              {t('lead_status.system_required_info')}\n            </p>\n          </div>\n        )}\n      </div>\n\n      <NavigationGuardDialog\n        open={navigation.showGuard}\n        onDiscard={navigation.handleDiscardChanges}\n        onStay={navigation.handleStayOnModal}\n        onSaveAndExit={navigation.handleSaveAndExit}\n        message={navigation.message}\n      />\n    </AppSheetModal>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/NavigationGuardDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/PackageDialogs.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1389,1392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1389,1392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1872,1875],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1872,1875],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2267,2270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2267,2270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2712,2715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2712,2715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":624,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":624,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20948,20951],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20948,20951],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1019,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1019,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33874,33877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33874,33877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo } from \"react\";\nimport { AppSheetModal } from \"@/components/ui/app-sheet-modal\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from \"@/components/ui/accordion\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { X, Check } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useNavigate } from \"react-router-dom\";\nimport { cn } from \"@/lib/utils\";\nimport { useTranslation } from \"react-i18next\";\nimport { useModalNavigation } from \"@/hooks/useModalNavigation\";\nimport { NavigationGuardDialog } from \"./NavigationGuardDialog\";\nimport { createLineItem } from \"@/types/serviceLineItems\";\n\ninterface Package {\n  id: string;\n  name: string;\n  description?: string;\n  price: number;\n  applicable_types: string[];\n  default_add_ons: string[];\n  is_active: boolean;\n  line_items?: any;\n}\n\ninterface AddPackageDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onPackageAdded: () => void;\n}\n\ninterface EditPackageDialogProps {\n  package: Package | null;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onPackageUpdated: () => void;\n}\n\nconst extractAddonIds = (pkg?: Partial<Package> & { line_items?: unknown }): string[] =>\n  Array.isArray(pkg?.default_add_ons) ? pkg!.default_add_ons : [];\n\nconst getServiceUnitPrice = (service: any): number =>\n  service?.selling_price ?? service?.price ?? 0;\n\nconst formatCurrency = (value: number) =>\n  new Intl.NumberFormat(\"tr-TR\", {\n    style: \"currency\",\n    currency: \"TRY\",\n    minimumFractionDigits: 0,\n  }).format(value);\n\n// Service picker component for default add-ons\nconst ServiceAddOnsPicker = ({ services, value, onChange, navigate, disabledServiceIds = [] }: {\n  services: any[];\n  value: string[];\n  onChange: (addons: string[]) => void;\n  navigate: (path: string) => void;\n  disabledServiceIds?: string[];\n}) => {\n  const { t } = useTranslation(['forms', 'common']);\n  const [isEditing, setIsEditing] = useState(false);\n  const [tempValue, setTempValue] = useState<string[]>([]);\n  const [openItems, setOpenItems] = useState<string[]>([]);\n\n  const groupedServices = useMemo(() => {\n    const groups: Record<string, any[]> = {};\n    services.forEach((service) => {\n      const key = service.category || \"Uncategorized\";\n      if (!groups[key]) groups[key] = [];\n      groups[key].push(service);\n    });\n    // Sort services by name inside each group\n    Object.keys(groups).forEach((k) => groups[k].sort((a, b) => a.name.localeCompare(b.name)));\n    return groups;\n  }, [services]);\n\n  const categories = useMemo(() => Object.keys(groupedServices).sort(), [groupedServices]);\n\n  const selectedServices = useMemo(\n    () => services.filter((s) => value.includes(s.id)),\n    [services, value]\n  );\n\n  const handleEdit = () => {\n    setTempValue([...value]);\n    setIsEditing(true);\n  };\n\n  const handleSave = () => {\n    onChange(tempValue);\n    setIsEditing(false);\n  };\n\n  const handleCancel = () => {\n    setTempValue([]);\n    setIsEditing(false);\n  };\n\n  const toggleService = (serviceId: string) => {\n    if (disabledServiceIds.includes(serviceId)) return;\n    if (tempValue.includes(serviceId)) {\n      setTempValue(prev => prev.filter(v => v !== serviceId));\n    } else {\n      setTempValue(prev => [...prev, serviceId]);\n    }\n  };\n\n  if (services.length === 0) {\n    return (\n      <div className=\"text-center py-4 text-muted-foreground\">\n        <p className=\"text-sm\">{t('package.no_services_yet', { ns: 'forms' })}</p>\n        <button\n          type=\"button\"\n          onClick={() => navigate(\"/settings/services\")}\n          className=\"text-sm text-primary hover:underline mt-1\"\n        >\n          {t('package.create_service', { ns: 'forms' })}\n        </button>\n      </div>\n    );\n  }\n\n  // Edit mode - show accordion\n  if (isEditing) {\n    return (\n      <div className=\"space-y-3\">\n        <Accordion\n          type=\"multiple\"\n          value={openItems}\n          onValueChange={(v) => setOpenItems(v as string[])}\n          className=\"w-full\"\n        >\n          {categories.map((category) => {\n            const items = groupedServices[category] || [];\n            const selectedCount = items.filter((s) => tempValue.includes(s.id)).length;\n            return (\n              <AccordionItem key={category} value={category} className=\"border rounded-md mb-3\">\n                <AccordionTrigger className=\"px-3 py-2 text-sm\">\n                  <div className=\"flex w-full items-center justify-between\">\n                    <span className=\"font-medium\">{category}</span>\n                    <span className=\"text-xs text-muted-foreground\">\n                      {selectedCount}/{items.length}\n                    </span>\n                  </div>\n                </AccordionTrigger>\n                <AccordionContent>\n                  <div className=\"px-3 pb-3\">\n                    <div className=\"flex flex-wrap gap-2\">\n                      {items.map((service) => {\n                        const selected = tempValue.includes(service.id);\n                        const costPrice = service.cost_price ?? 0;\n                        const sellingPrice = service.selling_price ?? service.price ?? 0;\n                        const hasPrices = costPrice > 0 || sellingPrice > 0;\n                        return (\n                          <Button\n                            key={service.id}\n                            type=\"button\"\n                            variant={selected ? \"default\" : \"secondary\"}\n                            onClick={() => toggleService(service.id)}\n                            className={cn(\n                              \"h-8 rounded-full px-3 text-xs justify-start whitespace-nowrap\",\n                              \"overflow-hidden text-ellipsis\",\n                              selected ? \"\" : \"border\",\n                            )}\n                            disabled={disabledServiceIds.includes(service.id)}\n                            title={`${service.name}${hasPrices ? ` Â· Cost: â‚º${costPrice} Â· Selling: â‚º${sellingPrice}` : ''}`}\n                          >\n                            <div className=\"flex items-center gap-2\">\n                              {selected && <Check className=\"h-3 w-3\" aria-hidden />}\n                              <span>\n                                {service.name}\n                                {hasPrices && (\n                                  <>\n                                    <span className=\"mx-1\">Â·</span>\n                                    <span className={selected ? \"text-primary-foreground/80\" : \"text-muted-foreground\"}>\n                                      â‚º{costPrice}/â‚º{sellingPrice}\n                                    </span>\n                                  </>\n                                )}\n                              </span>\n                            </div>\n                          </Button>\n                        );\n                      })}\n                    </div>\n                  </div>\n                </AccordionContent>\n              </AccordionItem>\n            );\n          })}\n        </Accordion>\n\n        {/* Save/Cancel buttons */}\n        <div className=\"flex gap-2 justify-end\">\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={handleCancel}\n            className=\"h-8\"\n          >\n            {t('buttons.cancel', { ns: 'common' })}\n          </Button>\n          <Button\n            type=\"button\"\n            onClick={handleSave}\n            className=\"h-8\"\n          >\n            {t('buttons.save', { ns: 'common' })}\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  // View mode - show selected services or empty state\n  return (\n    <div className=\"space-y-3\">\n      {selectedServices.length === 0 ? (\n        <div className=\"rounded-md border border-dashed p-4 text-center\">\n          <p className=\"text-sm text-muted-foreground mb-2\">{t('package.no_addons_selected', { ns: 'forms' })}</p>\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={handleEdit}\n            className=\"h-8\"\n          >\n            {t('package.add_services', { ns: 'forms' })}\n          </Button>\n        </div>\n      ) : (\n        <div className=\"rounded-md border p-3\">\n          <div className=\"mb-2 flex items-center justify-between\">\n            <span className=\"text-sm font-medium\">{t('package.selected_addons', { ns: 'forms', count: selectedServices.length })}</span>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={handleEdit}\n              className=\"h-8\"\n            >\n              {t('package.edit_addons', { ns: 'forms' })}\n            </Button>\n          </div>\n          <div className=\"flex flex-wrap gap-2\">\n            {selectedServices.map((service) => {\n              const costPrice = service.cost_price ?? 0;\n              const sellingPrice = service.selling_price ?? service.price ?? 0;\n              const hasPrices = costPrice > 0 || sellingPrice > 0;\n              return (\n                <Badge\n                  key={service.id}\n                  variant=\"secondary\"\n                  className=\"h-7 rounded-full px-3 text-xs\"\n                >\n                  <span>\n                    {service.name}\n                    {hasPrices && (\n                      <>\n                        <span className=\"mx-1\">Â·</span>\n                        <span className=\"text-foreground/70\">â‚º{costPrice}/â‚º{sellingPrice}</span>\n                      </>\n                    )}\n                  </span>\n                </Badge>\n              );\n            })}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\n// Duration options - now provided by translation function\n\nexport function AddPackageDialog({ open, onOpenChange, onPackageAdded }: AddPackageDialogProps) {\n  const { t } = useTranslation(['forms', 'common']);\n  \n  const [packageData, setPackageData] = useState({\n    name: \"\",\n    description: \"\",\n    price: \"\",\n    applicable_types: [] as string[],\n    default_add_ons: [] as string[],\n    is_active: true\n  });\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [loading, setLoading] = useState(false);\n  const { toast } = useToast();\n  const navigate = useNavigate();\n\n  // Fetch project types\n  const { data: projectTypes = [] } = useQuery({\n    queryKey: ['project_types'],\n    queryFn: async () => {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return [];\n\n      // Get user's active organization  \n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) {\n        return [];\n      }\n\n      const { data, error } = await supabase\n        .from('project_types')\n        .select('*')\n        .eq('organization_id', organizationId)\n        .order('name', { ascending: true });\n      \n      if (error) throw error;\n      return data || [];\n    },\n  });\n  // Fetch services\n  const { data: services = [] } = useQuery({\n    queryKey: ['services'],\n    queryFn: async () => {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return [];\n\n      // Get user's active organization  \n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) {\n        return [];\n      }\n\n      const { data, error } = await supabase\n        .from('services')\n        .select('*')\n        .eq('organization_id', organizationId)\n        .order('name', { ascending: true });\n      \n      if (error) throw error;\n      return data || [];\n    },\n  });\n\n  const addonServices = useMemo(\n    () => services.filter((service) => packageData.default_add_ons.includes(service.id)),\n    [services, packageData.default_add_ons]\n  );\n\n  const addonServicesTotal = useMemo(\n    () => addonServices.reduce((sum, service) => sum + getServiceUnitPrice(service), 0),\n    [addonServices]\n  );\n\n  const resetForm = () => {\n    setPackageData({\n      name: \"\",\n      description: \"\",\n      price: \"\",\n      applicable_types: [],\n      default_add_ons: [],\n      is_active: true\n    });\n    setErrors({});\n  };\n\n  const isDirty = Boolean(\n    packageData.name.trim() ||\n    packageData.description.trim() ||\n    packageData.price.trim() ||\n    packageData.applicable_types.length > 0 ||\n    packageData.default_add_ons.length > 0\n  );\n\n  const navigation = useModalNavigation({\n    isDirty,\n    onDiscard: () => {\n      resetForm();\n      onOpenChange(false);\n    },\n    onSaveAndExit: async () => {\n      await handleSubmit();\n    },\n    message: t('package.delete_confirmation.description')\n  });\n\n  useEffect(() => {\n    if (!open) {\n      resetForm();\n    }\n  }, [open]);\n\n  const validateForm = () => {\n    const newErrors: Record<string, string> = {};\n\n    if (!packageData.name.trim()) {\n      newErrors.name = t('package.errors.name_required');\n    }\n\n    if (!packageData.price || isNaN(Number(packageData.price)) || Number(packageData.price) <= 0) {\n      newErrors.price = t('common.errors.price_required');\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = async () => {\n    if (!validateForm()) return;\n\n    try {\n      setLoading(true);\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('Not authenticated');\n\n      // Get user's active organization\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) {\n        throw new Error(\"Organization required\");\n      }\n\n      const addonLineItems = packageData.default_add_ons.map((serviceId) =>\n        createLineItem(serviceId, \"addon\")\n      );\n      const lineItems = addonLineItems;\n\n      const { error } = await supabase\n        .from('packages')\n        .insert({\n          user_id: user.id,\n          organization_id: organizationId,\n          name: packageData.name.trim(),\n          description: packageData.description.trim() || null,\n          price: Number(packageData.price),\n          duration: null,\n          applicable_types: packageData.applicable_types,\n          default_add_ons: packageData.default_add_ons,\n          line_items: lineItems,\n          is_active: packageData.is_active\n        });\n\n      if (error) throw error;\n\n      toast({\n        title: t('common.toast.success'),\n        description: t('package.success.added'),\n      });\n\n      onPackageAdded();\n    } catch (error) {\n      console.error('Error creating package:', error);\n      toast({\n        title: t('common.toast.error'),\n        description: t('package.errors.add_failed'),\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDirtyClose = () => {\n    const canClose = navigation.handleModalClose();\n    if (canClose) {\n      resetForm();\n      onOpenChange(false);\n    }\n  };\n\n  const footerActions = [\n    {\n      label: t('buttons.cancel', { ns: 'common' }),\n      onClick: handleDirtyClose,\n      variant: \"outline\" as const,\n      disabled: loading\n    },\n    {\n      label: loading ? t('actions.saving', { ns: 'common' }) : t('buttons.save', { ns: 'common' }),\n      onClick: handleSubmit,\n      disabled: loading || !packageData.name.trim(),\n      loading: loading\n    }\n  ];\n\n  const toggleApplicableType = (type: string) => {\n    setPackageData(prev => ({\n      ...prev,\n      applicable_types: prev.applicable_types.includes(type)\n        ? prev.applicable_types.filter(t => t !== type)\n        : [...prev.applicable_types, type]\n    }));\n  };\n\n\n  return (\n    <AppSheetModal\n      title={t('package.add_title')}\n      isOpen={open}\n      onOpenChange={onOpenChange}\n      size=\"content\"\n      dirty={isDirty}\n      onDirtyClose={handleDirtyClose}\n      footerActions={footerActions}\n    >\n      <div className=\"space-y-6\">\n        {/* Package Name */}\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"name\">{t('package.name')} *</Label>\n          <Input\n            id=\"name\"\n            value={packageData.name}\n            onChange={(e) => setPackageData(prev => ({ ...prev, name: e.target.value }))}\n            placeholder={t('package.name_placeholder', { ns: 'forms' })}\n          />\n          {errors.name && <p className=\"text-sm text-destructive\">{errors.name}</p>}\n        </div>\n\n        {/* Description */}\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"description\">{t('package.description')}</Label>\n          <Textarea\n            id=\"description\"\n            value={packageData.description}\n            onChange={(e) => setPackageData(prev => ({ ...prev, description: e.target.value }))}\n            placeholder={t('package.description')}\n            rows={2}\n          />\n        </div>\n\n        {/* Price */}\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"price\">{t('package.price')} *</Label>\n          <p className=\"text-xs text-muted-foreground\">{t('package.price_help')}</p>\n          <Input\n            id=\"price\"\n            type=\"number\"\n            value={packageData.price}\n            onChange={(e) => setPackageData(prev => ({ ...prev, price: e.target.value }))}\n            placeholder={t('package.price_placeholder')}\n            min=\"0\"\n            step=\"100\"\n          />\n          {errors.price && <p className=\"text-sm text-destructive\">{errors.price}</p>}\n        </div>\n\n        {/* Base Service */}\n        {/* Duration */}\n        {/* Base Service */}\n        <div className=\"rounded-md border border-dashed bg-muted/10 p-3 text-xs text-muted-foreground\">\n          {t('package.session_type_hint')}\n        </div>\n\n        {/* Default Add-ons */}\n        <div className=\"space-y-2\">\n          <Label>{t('package.default_add_ons')}</Label>\n          <p className=\"text-xs text-muted-foreground mb-3\">\n            {t('package.add_ons_help_1')}{\" \"}\n            <button\n              type=\"button\"\n              onClick={() => navigate(\"/settings/services\")}\n              className=\"text-primary hover:underline\"\n            >\n              {t('package.services_section')}\n            </button>\n            {\" \"}{t('package.add_ons_help_2')}\n          </p>\n          <ServiceAddOnsPicker\n            services={services}\n            value={packageData.default_add_ons}\n            onChange={(addons) => setPackageData(prev => ({ ...prev, default_add_ons: addons }))}\n            navigate={navigate}\n          />\n        </div>\n\n        {/* Bundle Summary */}\n        <div className=\"space-y-2\">\n          <Label>{t('package.bundle_summary_title')}</Label>\n          <div className=\"rounded-md border bg-muted/20 p-3 space-y-1\">\n            <div className=\"flex items-center justify-between text-sm font-medium\">\n              <span>{t('package.bundle_summary_total_label')}</span>\n              <span>{formatCurrency(addonServicesTotal)}</span>\n            </div>\n            <div className=\"text-xs text-muted-foreground\">\n              {t('package.bundle_summary_breakdown_addons_only', {\n                addons: formatCurrency(addonServicesTotal),\n              })}\n            </div>\n            <div className=\"text-xs text-muted-foreground\">\n              {t('package.bundle_summary_count', {\n                count: addonServices.length,\n              })}\n            </div>\n          </div>\n        </div>\n\n        {/* Applicable Types */}\n        <div className=\"space-y-2\">\n          <Label>{t('package.applicable_types')}</Label>\n          <p className=\"text-xs text-muted-foreground mb-3\">\n            {t('package.applicable_types_help_1')}{\" \"}\n            <button\n              type=\"button\"\n              onClick={() => navigate(\"/settings/projects\")}\n              className=\"text-primary hover:underline\"\n            >\n              {t('package.project_types')}\n            </button>\n            {\" \"}{t('package.applicable_types_help_2')}\n          </p>\n          {projectTypes.length === 0 ? (\n            <div className=\"text-center py-4 text-muted-foreground\">\n              <p className=\"text-sm\">{t('package.no_project_types_exist')}</p>\n              <button\n                type=\"button\"\n                onClick={() => navigate(\"/settings/projects\")}\n                className=\"text-sm text-primary hover:underline mt-1\"\n              >\n                {t('package.create_project_types_link')}\n              </button>\n            </div>\n          ) : (\n            <div className=\"flex flex-wrap gap-2\">\n              {projectTypes.map((type: any) => (\n                <Badge\n                  key={type.id}\n                  variant={packageData.applicable_types.includes(type.name) ? \"default\" : \"outline\"}\n                  className={`cursor-pointer transition-colors ${\n                    packageData.applicable_types.includes(type.name) \n                      ? \"bg-primary text-primary-foreground hover:bg-primary/90\" \n                      : \"hover:bg-accent hover:text-accent-foreground\"\n                  }`}\n                  onClick={() => toggleApplicableType(type.name)}\n                >\n                  {type.name}\n                  {packageData.applicable_types.includes(type.name) && (\n                    <X className=\"ml-1 h-3 w-3\" />\n                  )}\n                </Badge>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Visibility */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"space-y-0.5\">\n            <Label htmlFor=\"isActive\">{t('package.visibility')}</Label>\n            <p className=\"text-xs text-muted-foreground\">\n              {t('package.visibility_help')}\n            </p>\n          </div>\n          <Switch\n            id=\"isActive\"\n            checked={packageData.is_active}\n            onCheckedChange={(checked) => setPackageData(prev => ({ ...prev, is_active: checked }))}\n          />\n        </div>\n      </div>\n      <NavigationGuardDialog\n        open={navigation.showGuard}\n        onDiscard={navigation.handleDiscardChanges}\n        onStay={navigation.handleStayOnModal}\n        onSaveAndExit={navigation.handleSaveAndExit}\n        message={navigation.message}\n      />\n\n    </AppSheetModal>\n  );\n}\n\nexport function EditPackageDialog({ package: pkg, open, onOpenChange, onPackageUpdated }: EditPackageDialogProps) {\n  const { t } = useTranslation(['forms', 'common']);\n  const [packageData, setPackageData] = useState({\n    name: \"\",\n    description: \"\",\n    price: \"\",\n    applicable_types: [] as string[],\n    default_add_ons: [] as string[],\n    is_active: true\n  });\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [loading, setLoading] = useState(false);\n  const { toast } = useToast();\n  const navigate = useNavigate();\n  const originalAddOns = useMemo(() => extractAddonIds(pkg), [pkg]);\n\n  // Fetch project types\n  const { data: projectTypes = [] } = useQuery({\n    queryKey: ['project_types'],\n    queryFn: async () => {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return [];\n\n      // Get user's organization ID\n      const { getUserOrganizationId } = await import('@/lib/organizationUtils');\n      const organizationId = await getUserOrganizationId();\n\n      if (!organizationId) {\n        return [];\n      }\n\n      const { data, error } = await supabase\n        .from('project_types')\n        .select('*')\n        .eq('organization_id', organizationId)\n        .order('name', { ascending: true });\n      \n      if (error) throw error;\n      return data || [];\n    },\n  });\n\n  // Fetch services\n  const { data: services = [] } = useQuery({\n    queryKey: ['services'],\n    queryFn: async () => {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return [];\n\n      // Get user's organization ID\n      const { getUserOrganizationId } = await import('@/lib/organizationUtils');\n      const organizationId = await getUserOrganizationId();\n\n      if (!organizationId) {\n        return [];\n      }\n\n      const { data, error } = await supabase\n        .from('services')\n        .select('*')\n        .eq('organization_id', organizationId)\n        .order('name', { ascending: true });\n      \n      if (error) throw error;\n      return data || [];\n    },\n  });\n\n  const addonServices = useMemo(\n    () => services.filter((service) => packageData.default_add_ons.includes(service.id)),\n    [services, packageData.default_add_ons]\n  );\n\n  const addonServicesTotal = useMemo(\n    () => addonServices.reduce((sum, service) => sum + getServiceUnitPrice(service), 0),\n    [addonServices]\n  );\n\n  useEffect(() => {\n    if (pkg && open) {\n      setPackageData({\n        name: pkg.name,\n        description: pkg.description || \"\",\n        price: pkg.price.toString(),\n        applicable_types: [...pkg.applicable_types],\n        default_add_ons: [...originalAddOns],\n        is_active: pkg.is_active\n      });\n      setErrors({});\n    }\n  }, [pkg, open, originalAddOns]);\n\n  const validateForm = () => {\n    const newErrors: Record<string, string> = {};\n\n    if (!packageData.name.trim()) {\n      newErrors.name = t('package.errors.name_required');\n    }\n\n    if (!packageData.price || isNaN(Number(packageData.price)) || Number(packageData.price) <= 0) {\n      newErrors.price = t('common.errors.price_required');\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = async () => {\n    if (!validateForm()) return;\n\n    try {\n      setLoading(true);\n      if (!pkg) return;\n\n      const addonLineItems = packageData.default_add_ons.map((serviceId) =>\n        createLineItem(serviceId, \"addon\")\n      );\n      const lineItems = addonLineItems;\n\n      const { error } = await supabase\n        .from('packages')\n        .update({\n          name: packageData.name.trim(),\n          description: packageData.description.trim() || null,\n          price: Number(packageData.price),\n          duration: null,\n          applicable_types: packageData.applicable_types,\n          default_add_ons: packageData.default_add_ons,\n          line_items: lineItems,\n          is_active: packageData.is_active\n        })\n        .eq('id', pkg.id);\n\n      if (error) throw error;\n\n      toast({\n        title: t('common.toast.success'),\n        description: t('package.success.updated'),\n      });\n\n      onPackageUpdated();\n    } catch (error) {\n      console.error('Error updating package:', error);\n      toast({\n        title: t('common.toast.error'),\n        description: t('package.errors.update_failed'),\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const toggleApplicableType = (type: string) => {\n    setPackageData(prev => ({\n      ...prev,\n      applicable_types: prev.applicable_types.includes(type)\n        ? prev.applicable_types.filter(t => t !== type)\n        : [...prev.applicable_types, type]\n    }));\n  };\n\n  const resetEditForm = () => {\n    if (!pkg) return;\n    setPackageData({\n      name: pkg.name,\n      description: pkg.description || \"\",\n      price: pkg.price.toString(),\n      applicable_types: [...pkg.applicable_types],\n      default_add_ons: [...originalAddOns],\n      is_active: pkg.is_active\n    });\n    setErrors({});\n  };\n\n  const isDirtyEdit = pkg ? Boolean(\n    packageData.name !== pkg.name ||\n    packageData.description !== (pkg.description || \"\") ||\n    packageData.price !== pkg.price.toString() ||\n    JSON.stringify([...packageData.applicable_types].sort()) !== JSON.stringify([...pkg.applicable_types].sort()) ||\n    JSON.stringify([...packageData.default_add_ons].sort()) !== JSON.stringify([...originalAddOns].sort()) ||\n    packageData.is_active !== pkg.is_active\n  ) : false;\n\n  const navigationEdit = useModalNavigation({\n    isDirty: isDirtyEdit,\n    onDiscard: () => {\n      resetEditForm();\n      onOpenChange(false);\n    },\n    onSaveAndExit: async () => {\n      await handleSubmit();\n    },\n    message: t('confirm.unsaved_changes', { ns: 'common' })\n  });\n\n  const handleDirtyCloseEdit = () => {\n    const canClose = navigationEdit.handleModalClose();\n    if (canClose) {\n      resetEditForm();\n      onOpenChange(false);\n    }\n  };\n\n  const footerActionsEdit = [\n    {\n      label: t('buttons.cancel', { ns: 'common' }),\n      onClick: handleDirtyCloseEdit,\n      variant: \"outline\" as const,\n      disabled: loading\n    },\n    {\n      label: loading ? t('actions.saving', { ns: 'common' }) : t('buttons.update', { ns: 'common' }),\n      onClick: handleSubmit,\n      disabled: loading || !packageData.name.trim(),\n      loading: loading\n    }\n  ];\n\n\n  if (!pkg) return null;\n\n  return (\n    <AppSheetModal\n      title={t('package.edit_title')}\n      isOpen={open}\n      onOpenChange={onOpenChange}\n      size=\"content\"\n      dirty={isDirtyEdit}\n      onDirtyClose={handleDirtyCloseEdit}\n      footerActions={footerActionsEdit}\n    >\n      <div className=\"space-y-6\">\n        {/* Package Name */}\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"name\">{t('package.name')} *</Label>\n          <Input\n            id=\"name\"\n            value={packageData.name}\n            onChange={(e) => setPackageData(prev => ({ ...prev, name: e.target.value }))}\n            placeholder={t('package.name_placeholder', { ns: 'forms' })}\n          />\n          {errors.name && <p className=\"text-sm text-destructive\">{errors.name}</p>}\n        </div>\n\n        {/* Description */}\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"description\">{t('package.description')}</Label>\n          <Textarea\n            id=\"description\"\n            value={packageData.description}\n            onChange={(e) => setPackageData(prev => ({ ...prev, description: e.target.value }))}\n            placeholder={t('package.description')}\n            rows={2}\n          />\n        </div>\n\n        {/* Price */}\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"price\">{t('package.price')} *</Label>\n          <p className=\"text-xs text-muted-foreground\">{t('package.price_help')}</p>\n          <Input\n            id=\"price\"\n            type=\"number\"\n            value={packageData.price}\n            onChange={(e) => setPackageData(prev => ({ ...prev, price: e.target.value }))}\n            placeholder={t('package.price_placeholder')}\n            min=\"0\"\n            step=\"100\"\n          />\n          {errors.price && <p className=\"text-sm text-destructive\">{errors.price}</p>}\n        </div>\n\n        <div className=\"rounded-md border border-dashed bg-muted/10 p-3 text-xs text-muted-foreground\">\n          {t('package.session_type_hint')}\n        </div>\n\n        {/* Default Add-ons */}\n        <div className=\"space-y-2\">\n          <Label>{t('package.default_add_ons')}</Label>\n          <p className=\"text-xs text-muted-foreground mb-3\">\n            {t('package.add_ons_help_1')}{\" \"}\n            <button\n              type=\"button\"\n              onClick={() => navigate(\"/settings/services\")}\n              className=\"text-primary hover:underline\"\n            >\n              {t('package.services_section')}\n            </button>\n            {\" \"}{t('package.add_ons_help_2')}\n          </p>\n          <ServiceAddOnsPicker\n            services={services}\n            value={packageData.default_add_ons}\n            onChange={(addons) => setPackageData(prev => ({ ...prev, default_add_ons: addons }))}\n            navigate={navigate}\n          />\n        </div>\n\n        {/* Bundle Summary */}\n        <div className=\"space-y-2\">\n          <Label>{t('package.bundle_summary_title')}</Label>\n          <div className=\"rounded-md border bg-muted/20 p-3 space-y-1\">\n            <div className=\"flex items-center justify-between text-sm font-medium\">\n              <span>{t('package.bundle_summary_total_label')}</span>\n              <span>{formatCurrency(addonServicesTotal)}</span>\n            </div>\n            <div className=\"text-xs text-muted-foreground\">\n              {t('package.bundle_summary_breakdown_addons_only', {\n                addons: formatCurrency(addonServicesTotal),\n              })}\n            </div>\n            <div className=\"text-xs text-muted-foreground\">\n              {t('package.bundle_summary_count', {\n                count: addonServices.length,\n              })}\n            </div>\n          </div>\n        </div>\n\n        {/* Applicable Types */}\n        <div className=\"space-y-2\">\n          <Label>{t('package.applicable_types')}</Label>\n          <p className=\"text-xs text-muted-foreground mb-3\">\n            {t('package.applicable_types_help_1')}{\" \"}\n            <button\n              type=\"button\"\n              onClick={() => navigate(\"/settings/projects\")}\n              className=\"text-primary hover:underline\"\n            >\n              {t('package.project_types')}\n            </button>\n            {\" \"}{t('package.applicable_types_help_2')}\n          </p>\n          {projectTypes.length === 0 ? (\n            <div className=\"text-center py-4 text-muted-foreground\">\n              <p className=\"text-sm\">{t('package.no_project_types_exist')}</p>\n              <button\n                type=\"button\"\n                onClick={() => navigate(\"/settings/projects\")}\n                className=\"text-sm text-primary hover:underline mt-1\"\n              >\n                {t('package.create_project_types_link')}\n              </button>\n            </div>\n          ) : (\n            <div className=\"flex flex-wrap gap-2\">\n              {projectTypes.map((type: any) => (\n                <Badge\n                  key={type.id}\n                  variant={packageData.applicable_types.includes(type.name) ? \"default\" : \"outline\"}\n                  className={`cursor-pointer transition-colors ${\n                    packageData.applicable_types.includes(type.name) \n                      ? \"bg-primary text-primary-foreground hover:bg-primary/90\" \n                      : \"hover:bg-accent hover:text-accent-foreground\"\n                  }`}\n                  onClick={() => toggleApplicableType(type.name)}\n                >\n                  {type.name}\n                  {packageData.applicable_types.includes(type.name) && (\n                    <X className=\"ml-1 h-3 w-3\" />\n                  )}\n                </Badge>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Visibility */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"space-y-0.5\">\n            <Label htmlFor=\"isActive\">{t('package.visibility')}</Label>\n            <p className=\"text-xs text-muted-foreground\">\n              {t('package.visibility_help')}\n            </p>\n          </div>\n          <Switch\n            id=\"isActive\"\n            checked={packageData.is_active}\n            onCheckedChange={(checked) => setPackageData(prev => ({ ...prev, is_active: checked }))}\n          />\n        </div>\n      </div>\n\n      <NavigationGuardDialog\n        open={navigationEdit.showGuard}\n        onDiscard={navigationEdit.handleDiscardChanges}\n        onStay={navigationEdit.handleStayOnModal}\n        onSaveAndExit={navigationEdit.handleSaveAndExit}\n        message={navigationEdit.message}\n      />\n\n    </AppSheetModal>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/ProjectStageDialogs.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'formData.lifecycle'. Either include it or remove the dependency array.","line":43,"column":6,"nodeType":"ArrayExpression","endLine":43,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [formData.lifecycle, formData.name]","fix":{"range":[1775,1790],"text":"[formData.lifecycle, formData.name]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3439,3442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3439,3442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":296,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9540,9543],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9540,9543],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":338,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":338,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10551,10554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10551,10554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { AppSheetModal } from \"@/components/ui/app-sheet-modal\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\nimport { useModalNavigation } from \"@/hooks/useModalNavigation\";\nimport { NavigationGuardDialog } from \"./NavigationGuardDialog\";\nimport { SegmentedControl } from \"@/components/ui/segmented-control\";\n\ninterface AddProjectStageDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onStageAdded: () => void;\n}\n\nexport function AddProjectStageDialog({ open, onOpenChange, onStageAdded }: AddProjectStageDialogProps) {\n  const { t } = useTranslation('forms');\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    color: \"#EF4444\",\n    lifecycle: \"active\" as \"active\" | \"completed\" | \"cancelled\", // No \"archived\" for projects\n  });\n\n  // Smart default based on name (no \"archived\" for projects)\n  const getSmartLifecycleDefault = (name: string): \"active\" | \"completed\" | \"cancelled\" => {\n    const lowerName = name.toLowerCase();\n    if (lowerName.includes(\"cancel\")) return \"cancelled\";\n    if (lowerName.includes(\"complete\") || lowerName.includes(\"deliver\") || lowerName.includes(\"done\")) return \"completed\";\n    return \"active\";\n  };\n\n  // Update lifecycle when name changes\n  useEffect(() => {\n    if (formData.name) {\n      const suggestedLifecycle = getSmartLifecycleDefault(formData.name);\n      if (suggestedLifecycle !== formData.lifecycle) {\n        setFormData(prev => ({ ...prev, lifecycle: suggestedLifecycle }));\n      }\n    }\n  }, [formData.name]);\n\n  const handleSubmit = async () => {\n    if (!formData.name.trim()) {\n      toast({\n        title: t('errors.title', { defaultValue: 'Error' }),\n        description: t('project_stage.errors.name_required'),\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('User not authenticated');\n\n      // Get user's organization ID\n      const { getUserOrganizationId } = await import('@/lib/organizationUtils');\n      const organizationId = await getUserOrganizationId();\n\n      if (!organizationId) {\n        throw new Error(\"Organization required\");\n      }\n\n      // Get the next sort order\n      const { data: existingStages } = await supabase\n        .from('project_statuses')\n        .select('sort_order')\n        .eq('organization_id', organizationId)\n        .order('sort_order', { ascending: false })\n        .limit(1);\n\n      const nextSortOrder = (existingStages?.[0]?.sort_order || 0) + 1;\n\n      const { error } = await supabase\n        .from('project_statuses')\n        .insert({\n          user_id: user.id,\n          organization_id: organizationId,\n          name: formData.name.trim(),\n          color: formData.color,\n          lifecycle: formData.lifecycle,\n          sort_order: nextSortOrder\n        });\n\n      if (error) throw error;\n\n      toast({\n        title: t('success.created'),\n        description: t('project_stage.success.added')\n      });\n\n      setFormData({ name: \"\", color: \"#EF4444\", lifecycle: \"active\" });\n      onOpenChange(false);\n      onStageAdded();\n    } catch (error: any) {\n      toast({\n        title: t('project_stage.errors.add_failed'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isDirty = Boolean(formData.name.trim() || formData.color !== \"#EF4444\" || formData.lifecycle !== \"active\");\n\n  const navigation = useModalNavigation({\n    isDirty,\n    onDiscard: () => {\n      setFormData({ name: \"\", color: \"#EF4444\", lifecycle: \"active\" });\n      onOpenChange(false);\n    },\n    onSaveAndExit: async () => {\n      await handleSubmit();\n    }\n  });\n\n  const handleDirtyClose = () => {\n    const canClose = navigation.handleModalClose();\n    if (canClose) {\n      setFormData({ name: \"\", color: \"#EF4444\", lifecycle: \"active\" });\n      onOpenChange(false);\n    }\n  };\n\n  const footerActions = [\n    {\n      label: t('buttons.cancel'),\n      onClick: handleDirtyClose,\n      variant: \"outline\" as const,\n      disabled: loading\n    },\n    {\n      label: loading ? t('buttons.adding') : t('buttons.add'),\n      onClick: handleSubmit,\n      disabled: loading || !formData.name.trim(),\n      loading: loading\n    }\n  ];\n\n  const colorOptions = [\n    \"#EF4444\", \"#F97316\", \"#EAB308\", \"#84CC16\", \"#22C55E\", \"#06B6D4\",\n    \"#3B82F6\", \"#6366F1\", \"#8B5CF6\", \"#A855F7\", \"#EC4899\", \"#64748B\"\n  ];\n\n  return (\n    <AppSheetModal\n      title={t('project_stage.add_title')}\n      isOpen={open}\n      onOpenChange={onOpenChange}\n      size=\"content\"\n      dirty={isDirty}\n      onDirtyClose={handleDirtyClose}\n      footerActions={footerActions}\n    >\n      <div className=\"space-y-6\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"name\">{t('project_stage.name_label')}</Label>\n          <Input\n            id=\"name\"\n            value={formData.name}\n            onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n            placeholder={t('project_stage.name_placeholder')}\n            maxLength={50}\n            className=\"rounded-xl\"\n          />\n          <p className=\"text-sm text-muted-foreground\">{t('project_stage.name_help')}</p>\n        </div>\n\n        <div className=\"space-y-3\">\n          <Label>{t('project_stage.color_label')}</Label>\n          <div className=\"grid grid-cols-6 gap-3 p-2\">\n            {colorOptions.map((color) => (\n              <button\n                key={color}\n                type=\"button\"\n                onClick={() => setFormData(prev => ({ ...prev, color }))}\n                className={`w-10 h-10 rounded-full border-4 transition-all ${\n                  formData.color === color \n                    ? 'border-gray-900 scale-110' \n                    : 'border-transparent hover:scale-105'\n                }`}\n                style={{ backgroundColor: color }}\n              />\n            ))}\n          </div>\n        </div>\n\n        <div className=\"space-y-3\">\n          <Label>{t('project_stage.lifecycle.label')}</Label>\n        <SegmentedControl\n          size=\"md\"\n          value={formData.lifecycle}\n          onValueChange={(value) =>\n            setFormData(prev => ({ ...prev, lifecycle: value as typeof prev.lifecycle }))\n          }\n          options={[\n            { value: \"active\", label: t('project_stage.lifecycle.active') },\n            { value: \"completed\", label: t('project_stage.lifecycle.completed') },\n            { value: \"cancelled\", label: t('project_stage.lifecycle.cancelled') },\n          ]}\n          className=\"mt-2 w-full justify-between\"\n        />\n          <div className=\"space-y-1 text-sm text-muted-foreground\">\n            <p>{t('project_stage.lifecycle.help.title')}</p>\n            <ul className=\"space-y-1 ml-4\">\n              <li>â€¢ <strong>{t('project_stage.lifecycle.active')}</strong>: {t('project_stage.lifecycle.help.active')}</li>\n              <li>â€¢ <strong>{t('project_stage.lifecycle.completed')}</strong>: {t('project_stage.lifecycle.help.completed')}</li>\n              <li>â€¢ <strong>{t('project_stage.lifecycle.cancelled')}</strong>: {t('project_stage.lifecycle.help.cancelled')}</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n\n      <NavigationGuardDialog\n        open={navigation.showGuard}\n        onDiscard={navigation.handleDiscardChanges}\n        onStay={navigation.handleStayOnModal}\n        onSaveAndExit={navigation.handleSaveAndExit}\n        message={navigation.message}\n      />\n    </AppSheetModal>\n  );\n}\n\n// Types for compatibility with ProjectStatusesSection\ninterface ProjectStatus {\n  id: string;\n  name: string;\n  color: string;\n  lifecycle?: 'active' | 'completed' | 'cancelled';\n  is_system_required?: boolean;\n}\n\ninterface EditProjectStageDialogProps {\n  stage: ProjectStatus | null;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onStageUpdated: () => void;\n}\n\nexport function EditProjectStageDialog({ stage, open, onOpenChange, onStageUpdated }: EditProjectStageDialogProps) {\n  const { t } = useTranslation('forms');\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    color: \"#EF4444\",\n    lifecycle: \"active\" as \"active\" | \"completed\" | \"cancelled\",\n  });\n\n  useEffect(() => {\n    if (stage && open) {\n      setFormData({\n        name: stage.name,\n        color: stage.color,\n        lifecycle: stage.lifecycle || \"active\",\n      });\n    }\n  }, [stage, open]);\n\n  const handleSubmit = async () => {\n    if (!formData.name.trim()) {\n      toast({\n        title: t('errors.title', { defaultValue: 'Error' }),\n        description: t('project_stage.errors.name_required'),\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const { error } = await supabase\n        .from('project_statuses')\n        .update({\n          name: formData.name.trim(),\n          color: formData.color,\n          lifecycle: formData.lifecycle,\n        })\n        .eq('id', stage.id);\n\n      if (error) throw error;\n\n      toast({\n        title: t('success.updated'),\n        description: t('project_stage.success.updated')\n      });\n\n      onOpenChange(false);\n      onStageUpdated();\n    } catch (error: any) {\n      toast({\n        title: t('project_stage.errors.update_failed'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!stage) return;\n    \n    // Check if it's a system required stage\n    if (stage.is_system_required) {\n      toast({\n        title: t('errors.title', { defaultValue: 'Cannot Delete' }),\n        description: t('project_stage.errors.cannot_delete'),\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    if (!window.confirm(t('project_stage.confirm.delete'))) return;\n    \n    setLoading(true);\n    try {\n      const { error } = await supabase\n        .from('project_statuses')\n        .delete()\n        .eq('id', stage.id);\n\n      if (error) throw error;\n\n      toast({\n        title: t('success.deleted'),\n        description: t('project_stage.success.deleted')\n      });\n\n      onOpenChange(false);\n      onStageUpdated();\n    } catch (error: any) {\n      toast({\n        title: t('project_stage.errors.delete_failed'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isSystemRequired = Boolean(stage?.is_system_required);\n  const isDirty = stage ? Boolean(\n    formData.name !== stage.name ||\n    formData.color !== stage.color ||\n    formData.lifecycle !== (stage.lifecycle || \"active\")\n  ) : false;\n\n  const navigation = useModalNavigation({\n    isDirty,\n    onDiscard: () => {\n      onOpenChange(false);\n    },\n    onSaveAndExit: async () => {\n      await handleSubmit();\n    }\n  });\n\n  if (!stage) return null;\n\n  const handleDirtyClose = () => {\n    const canClose = navigation.handleModalClose();\n    if (canClose) {\n      onOpenChange(false);\n    }\n  };\n\n  const footerActions = [\n    // Only show delete for non-system-required stages\n    ...(!isSystemRequired ? [{\n      label: t('buttons.delete'),\n      onClick: handleDelete,\n      variant: \"destructive\" as const,\n      disabled: loading\n    }] : []),\n    {\n      label: t('buttons.cancel'),\n      onClick: handleDirtyClose,\n      variant: \"outline\" as const,\n      disabled: loading\n    },\n    {\n      label: loading ? t('buttons.saving') : t('buttons.save'),\n      onClick: handleSubmit,\n      disabled: loading || !formData.name.trim(),\n      loading: loading\n    }\n  ];\n\n  const colorOptions = [\n    \"#EF4444\", \"#F97316\", \"#EAB308\", \"#84CC16\", \"#22C55E\", \"#06B6D4\",\n    \"#3B82F6\", \"#6366F1\", \"#8B5CF6\", \"#A855F7\", \"#EC4899\", \"#64748B\"\n  ];\n\n  return (\n    <AppSheetModal\n      title={t('project_stage.edit_title')}\n      isOpen={open}\n      onOpenChange={onOpenChange}\n      size=\"content\"\n      dirty={isDirty}\n      onDirtyClose={handleDirtyClose}\n      footerActions={footerActions}\n    >\n      <div className=\"space-y-6\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"name\">{t('project_stage.name_label')}</Label>\n          <Input\n            id=\"name\"\n            value={formData.name}\n            onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n            placeholder={t('project_stage.name_placeholder')}\n            maxLength={50}\n            className=\"rounded-xl\"\n          />\n          {isSystemRequired && (\n            <p className=\"text-sm text-muted-foreground\">\n              {t('project_stage.system_required_note')}\n            </p>\n          )}\n        </div>\n\n        <div className=\"space-y-3\">\n          <Label>{t('project_stage.color_label')}</Label>\n          <div className=\"grid grid-cols-6 gap-3 p-2\">\n            {colorOptions.map((color) => (\n              <button\n                key={color}\n                type=\"button\"\n                onClick={() => setFormData(prev => ({ ...prev, color }))}\n                className={`w-10 h-10 rounded-full border-4 transition-all ${\n                  formData.color === color \n                    ? 'border-gray-900 scale-110' \n                    : 'border-transparent hover:scale-105'\n                }`}\n                style={{ backgroundColor: color }}\n              />\n            ))}\n          </div>\n        </div>\n\n        {/* Only show lifecycle selector for non-system-required stages */}\n        {!isSystemRequired && (\n          <div className=\"space-y-3\">\n            <Label>{t('project_stage.lifecycle.label')}</Label>\n            <SegmentedControl\n              size=\"md\"\n              value={formData.lifecycle}\n              onValueChange={(value) =>\n                setFormData(prev => ({ ...prev, lifecycle: value as typeof prev.lifecycle }))\n              }\n              options={[\n                { value: \"active\", label: t('project_stage.lifecycle.active') },\n                { value: \"completed\", label: t('project_stage.lifecycle.completed') },\n                { value: \"cancelled\", label: t('project_stage.lifecycle.cancelled') },\n              ]}\n              className=\"mt-2 w-full justify-between\"\n            />\n            <div className=\"space-y-1 text-sm text-muted-foreground\">\n              <p>{t('project_stage.lifecycle.help.title')}</p>\n              <ul className=\"space-y-1 ml-4\">\n                <li>â€¢ <strong>{t('project_stage.lifecycle.active')}</strong>: {t('project_stage.lifecycle.help.active')}</li>\n                <li>â€¢ <strong>{t('project_stage.lifecycle.completed')}</strong>: {t('project_stage.lifecycle.help.completed')}</li>\n                <li>â€¢ <strong>{t('project_stage.lifecycle.cancelled')}</strong>: {t('project_stage.lifecycle.help.cancelled')}</li>\n              </ul>\n            </div>\n          </div>\n        )}\n\n        {/* Show info for system required stages */}\n        {isSystemRequired && (\n          <div className=\"p-3 bg-blue-50 border border-blue-200 rounded-lg\">\n            <p className=\"text-sm text-blue-800\">\n              {t('project_stage.system_required_info')}\n            </p>\n          </div>\n        )}\n      </div>\n\n      <NavigationGuardDialog\n        open={navigation.showGuard}\n        onDiscard={navigation.handleDiscardChanges}\n        onStay={navigation.handleStayOnModal}\n        onSaveAndExit={navigation.handleSaveAndExit}\n        message={navigation.message}\n      />\n    </AppSheetModal>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/ProjectTypeDialogs.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2732,2735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2732,2735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":184,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5793,5796],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5793,5796],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":253,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7721,7724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7721,7724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":328,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":328,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9548,9551],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9548,9551],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { AppSheetModal } from \"@/components/ui/app-sheet-modal\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { Plus } from \"lucide-react\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\nimport { useTranslation } from \"react-i18next\";\nimport { useModalNavigation } from \"@/hooks/useModalNavigation\";\nimport { NavigationGuardDialog } from \"./NavigationGuardDialog\";\n\ninterface AddProjectTypeDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onTypeAdded: () => void;\n}\n\nexport function AddProjectTypeDialog({ open, onOpenChange, onTypeAdded }: AddProjectTypeDialogProps) {\n  const { t } = useTranslation('forms');\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    is_default: false,\n  });\n\n  const handleSubmit = async () => {\n    if (!formData.name.trim()) {\n      toast({\n        title: t('common:errors.validation'),\n        description: t('project_type.errors.name_required'),\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('User not authenticated');\n\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) throw new Error('No organization found');\n\n      // If setting this as default, first unset all others\n      if (formData.is_default) {\n        await supabase\n          .from('project_types')\n          .update({ is_default: false })\n          .eq('organization_id', organizationId);\n      }\n\n      // Get the next sort order\n      const { data: existingTypes } = await supabase\n        .from('project_types')\n        .select('sort_order')\n        .eq('organization_id', organizationId)\n        .order('sort_order', { ascending: false })\n        .limit(1);\n\n      const nextSortOrder = (existingTypes?.[0]?.sort_order || 0) + 1;\n\n      const { error } = await supabase\n        .from('project_types')\n        .insert({\n          user_id: user.id,\n          organization_id: organizationId,\n          name: formData.name.trim(),\n          sort_order: nextSortOrder,\n          is_default: formData.is_default\n        });\n\n      if (error) throw error;\n\n      toast({\n        title: t('common:success.created'),\n        description: t('project_type.success.added')\n      });\n\n      setFormData({ name: \"\", is_default: false });\n      onOpenChange(false);\n      onTypeAdded();\n    } catch (error: any) {\n      toast({\n        title: t('common:errors.save'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isDirty = Boolean(formData.name.trim() || formData.is_default);\n\n  const navigation = useModalNavigation({\n    isDirty,\n    onDiscard: () => {\n      setFormData({ name: \"\", is_default: false });\n      onOpenChange(false);\n    },\n    onSaveAndExit: async () => {\n      await handleSubmit();\n    }\n  });\n\n  const handleDirtyClose = () => {\n    const canClose = navigation.handleModalClose();\n    if (canClose) {\n      setFormData({ name: \"\", is_default: false });\n      onOpenChange(false);\n    }\n  };\n\n  const footerActions = [\n    {\n      label: t('common:buttons.cancel'),\n      onClick: handleDirtyClose,\n      variant: \"outline\" as const,\n      disabled: loading\n    },\n    {\n      label: loading ? t('buttons.adding') : t('common:buttons.add'),\n      onClick: handleSubmit,\n      disabled: loading || !formData.name.trim(),\n      loading: loading\n    }\n  ];\n\n  return (\n    <AppSheetModal\n      title={t('project_type.add_title')}\n      isOpen={open}\n      onOpenChange={onOpenChange}\n      size=\"content\"\n      dirty={isDirty}\n      onDirtyClose={handleDirtyClose}\n      footerActions={footerActions}\n    >\n      <div className=\"space-y-6\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"name\">{t('project_type.name_label')}</Label>\n          <Input\n            id=\"name\"\n            value={formData.name}\n            onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n            placeholder={t('project_type.name_placeholder')}\n            maxLength={50}\n            className=\"rounded-xl\"\n          />\n          <p className=\"text-sm text-muted-foreground\">{t('project_type.name_help')}</p>\n        </div>\n\n        <div className=\"flex items-center space-x-3\">\n          <input\n            type=\"checkbox\"\n            id=\"is_default\"\n            checked={formData.is_default}\n            onChange={(e) => setFormData(prev => ({ ...prev, is_default: e.target.checked }))}\n            className=\"h-5 w-5 rounded border-2 border-input accent-primary focus:ring-2 focus:ring-primary/20 [&:checked]:text-white\"\n          />\n          <div \n            className=\"cursor-pointer flex-1\"\n            onClick={() => setFormData(prev => ({ ...prev, is_default: !prev.is_default }))}\n          >\n            <Label htmlFor=\"is_default\" className=\"text-sm font-medium cursor-pointer\">{t('project_type.set_as_default')}</Label>\n            <p className=\"text-sm text-muted-foreground cursor-pointer\">{t('project_type.set_as_default_help')}</p>\n          </div>\n        </div>\n      </div>\n      <NavigationGuardDialog\n        open={navigation.showGuard}\n        onDiscard={navigation.handleDiscardChanges}\n        onStay={navigation.handleStayOnModal}\n        onSaveAndExit={navigation.handleSaveAndExit}\n        message={navigation.message}\n      />\n    </AppSheetModal>\n  );\n}\n\ninterface EditProjectTypeDialogProps {\n  type: any;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onTypeUpdated: () => void;\n}\n\nexport function EditProjectTypeDialog({ type, open, onOpenChange, onTypeUpdated }: EditProjectTypeDialogProps) {\n  const { t } = useTranslation('forms');\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    is_default: false,\n  });\n\n  useEffect(() => {\n    if (type && open) {\n      setFormData({\n        name: type.name,\n        is_default: type.is_default || false,\n      });\n    }\n  }, [type, open]);\n\n  const handleSubmit = async () => {\n    if (!formData.name.trim()) {\n      toast({\n        title: t('common:errors.validation'),\n        description: t('project_type.errors.name_required'),\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('User not authenticated');\n      \n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) throw new Error('No organization found');\n      \n      // If setting this as default, first unset all others\n      if (formData.is_default && !type.is_default) {\n        await supabase\n          .from('project_types')\n          .update({ is_default: false })\n          .eq('organization_id', organizationId)\n          .neq('id', type.id);\n      }\n      \n      // Then update this type\n      const { error } = await supabase\n        .from('project_types')\n        .update({\n          name: formData.name.trim(),\n          is_default: formData.is_default,\n        })\n        .eq('id', type.id)\n        .eq('organization_id', organizationId);\n\n      if (error) throw error;\n\n      toast({\n        title: t('common:success.updated'),\n        description: t('project_type.success.updated')\n      });\n\n      onOpenChange(false);\n      onTypeUpdated();\n    } catch (error: any) {\n      toast({\n        title: t('common:errors.save'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isDirty = type ? Boolean(formData.name !== type.name || formData.is_default !== (type.is_default || false)) : false;\n\n  const navigation = useModalNavigation({\n    isDirty,\n    onDiscard: () => {\n      if (type) {\n        setFormData({\n          name: type.name,\n          is_default: type.is_default || false,\n        });\n      }\n      onOpenChange(false);\n    },\n    onSaveAndExit: async () => {\n      await handleSubmit();\n    }\n  });\n\n  if (!type) return null;\n\n  const handleDirtyClose = () => {\n    const canClose = navigation.handleModalClose();\n    if (canClose) {\n      setFormData({\n        name: type.name,\n        is_default: type.is_default || false,\n      });\n      onOpenChange(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    // Prevent deleting the default type\n    if (type.is_default) {\n      toast({\n        title: t('common:errors.delete'),\n        description: t('project_type.errors.cannot_delete_default'),\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (!window.confirm(t('project_type.confirm.delete'))) return;\n    \n    setLoading(true);\n    try {\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) throw new Error('No organization found');\n\n      const { error } = await supabase\n        .from('project_types')\n        .delete()\n        .eq('id', type.id)\n        .eq('organization_id', organizationId);\n\n      if (error) throw error;\n\n      toast({\n        title: t('common:success.deleted'),\n        description: t('project_type.success.deleted')\n      });\n\n      onOpenChange(false);\n      onTypeUpdated();\n    } catch (error: any) {\n      toast({\n        title: t('common:errors.delete'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const footerActions = [\n    {\n      label: t('common:buttons.delete'),\n      onClick: handleDelete,\n      variant: \"destructive\" as const,\n      disabled: loading\n    },\n    {\n      label: t('common:buttons.cancel'),\n      onClick: handleDirtyClose,\n      variant: \"outline\" as const,\n      disabled: loading\n    },\n    {\n      label: loading ? t('buttons.saving') : t('common:buttons.save'),\n      onClick: handleSubmit,\n      disabled: loading || !formData.name.trim(),\n      loading: loading\n    }\n  ];\n\n  return (\n    <AppSheetModal\n      title={t('project_type.edit_title')}\n      isOpen={open}\n      onOpenChange={onOpenChange}\n      size=\"content\"\n      dirty={isDirty}\n      onDirtyClose={handleDirtyClose}\n      footerActions={footerActions}\n    >\n      <div className=\"space-y-6\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"name\">{t('project_type.name_label')}</Label>\n          <Input\n            id=\"name\"\n            value={formData.name}\n            onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n            placeholder={t('project_type.name_placeholder')}\n            maxLength={50}\n            className=\"rounded-xl\"\n          />\n        </div>\n\n        <div className=\"flex items-center space-x-3\">\n          <input\n            type=\"checkbox\"\n            id=\"is_default_edit\"\n            checked={formData.is_default}\n            onChange={(e) => setFormData(prev => ({ ...prev, is_default: e.target.checked }))}\n            className=\"h-5 w-5 rounded border-2 border-input accent-primary focus:ring-2 focus:ring-primary/20 [&:checked]:text-white\"\n          />\n          <div \n            className=\"cursor-pointer flex-1\"\n            onClick={() => setFormData(prev => ({ ...prev, is_default: !prev.is_default }))}\n          >\n            <Label htmlFor=\"is_default_edit\" className=\"text-sm font-medium cursor-pointer\">{t('project_type.set_as_default')}</Label>\n            <p className=\"text-sm text-muted-foreground cursor-pointer\">{t('project_type.set_as_default_help')}</p>\n          </div>\n        </div>\n      </div>\n      <NavigationGuardDialog\n        open={navigation.showGuard}\n        onDiscard={navigation.handleDiscardChanges}\n        onStay={navigation.handleStayOnModal}\n        onSaveAndExit={navigation.handleSaveAndExit}\n        message={navigation.message}\n      />\n    </AppSheetModal>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/ServiceDialogs.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":486,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":486,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16364,16367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16364,16367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":807,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":807,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29261,29264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29261,29264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":988,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":988,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35992,35995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35992,35995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useEffect, useId, useMemo, useState } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\nimport { AppSheetModal } from \"@/components/ui/app-sheet-modal\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { Plus, Users, Package } from \"lucide-react\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, SelectSeparator } from \"@/components/ui/select\";\nimport { useTranslation } from \"react-i18next\";\nimport { useModalNavigation } from \"@/hooks/useModalNavigation\";\nimport { NavigationGuardDialog } from \"./NavigationGuardDialog\";\nimport { cn } from \"@/lib/utils\";\nimport { useOrganizationTaxProfile } from \"@/hooks/useOrganizationData\";\nimport { DEFAULT_ORGANIZATION_TAX_PROFILE } from \"@/lib/organizationSettingsCache\";\n\ntype ServiceType = \"coverage\" | \"deliverable\";\n\ninterface ServiceFormState {\n  name: string;\n  description: string;\n  category: string;\n  price: string;\n  cost_price: string;\n  selling_price: string;\n  vat_rate: string;\n  price_includes_vat: boolean;\n  extra: boolean;\n  service_type: ServiceType;\n  vendor_name: string;\n  is_active: boolean;\n}\n\nconst DEFAULT_CATEGORIES: Record<ServiceType, string[]> = {\n  coverage: [\"Lead Photographer\", \"Second Shooter\", \"Videographer\", \"Assistant\", \"Production Crew\", \"Styling\"],\n  deliverable: [\"Albums\", \"Prints\", \"Digital\", \"Retouching\", \"Frames\", \"Extras\", \"Packages\"],\n};\n\ninterface ServiceVatDefaults {\n  vatRate?: number | null;\n  priceIncludesVat?: boolean | null;\n}\n\nconst formatVatRate = (value?: number | null) => {\n  if (value == null || Number.isNaN(value)) return \"\";\n  return String(value);\n};\n\nconst createFormState = (\n  serviceType: ServiceType,\n  overrides: Partial<ServiceFormState> = {},\n  vatDefaults: ServiceVatDefaults = {}\n): ServiceFormState => ({\n  name: \"\",\n  description: \"\",\n  category: \"\",\n  price: \"\",\n  cost_price: \"\",\n  selling_price: \"\",\n  vat_rate: formatVatRate(vatDefaults.vatRate),\n  price_includes_vat: Boolean(vatDefaults.priceIncludesVat),\n  extra: false,\n  service_type: serviceType,\n  vendor_name: \"\",\n  is_active: true,\n  ...overrides,\n});\n\nconst useServiceCategories = (open: boolean) => {\n  const [categoriesByType, setCategoriesByType] = useState<Record<ServiceType, string[]>>({\n    coverage: [...DEFAULT_CATEGORIES.coverage],\n    deliverable: [...DEFAULT_CATEGORIES.deliverable],\n  });\n\n  useEffect(() => {\n    if (!open) return;\n\n    let cancelled = false;\n    const fetchCategories = async () => {\n      try {\n        const {\n          data: { user },\n        } = await supabase.auth.getUser();\n        if (!user) return;\n\n        const organizationId = await getUserOrganizationId();\n        if (!organizationId) return;\n\n        const { data, error } = await supabase\n          .from(\"services\")\n          .select(\"category, service_type\")\n          .eq(\"organization_id\", organizationId)\n          .not(\"category\", \"is\", null);\n\n        if (error) throw error;\n\n        if (!cancelled) {\n          const next: Record<ServiceType, Set<string>> = {\n            coverage: new Set(DEFAULT_CATEGORIES.coverage),\n            deliverable: new Set(DEFAULT_CATEGORIES.deliverable),\n          };\n\n          (data || []).forEach((item) => {\n            const category = typeof item.category === \"string\" ? item.category.trim() : \"\";\n            if (!category) return;\n            const type = item.service_type === \"coverage\" ? \"coverage\" : \"deliverable\";\n            next[type].add(category);\n          });\n\n          setCategoriesByType({\n            coverage: Array.from(next.coverage).sort((a, b) => a.localeCompare(b, undefined, { sensitivity: \"base\" })),\n            deliverable: Array.from(next.deliverable).sort((a, b) => a.localeCompare(b, undefined, { sensitivity: \"base\" })),\n          });\n        }\n      } catch (error) {\n        console.error(\"Error fetching categories:\", error);\n      }\n    };\n\n    fetchCategories();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [open]);\n\n  const addCategory = (type: ServiceType, category: string) => {\n    const normalized = category.trim();\n    if (!normalized) return;\n\n    setCategoriesByType((prev) => {\n      const updated = new Set(prev[type] ?? []);\n      updated.add(normalized);\n      return {\n        ...prev,\n        [type]: Array.from(updated).sort((a, b) => a.localeCompare(b, undefined, { sensitivity: \"base\" })),\n      };\n    });\n  };\n\n  return { categoriesByType, addCategory };\n};\n\ninterface VatSettingsSectionProps {\n  t: (key: string, options?: Record<string, unknown>) => string;\n  open: boolean;\n  vatDefaults: ServiceVatDefaults;\n  vatRateValue: string;\n  onVatRateChange: (value: string) => void;\n  vatRateValid: boolean;\n  priceIncludesVat: boolean;\n  onPriceIncludesVatChange: (value: boolean) => void;\n}\n\nconst VatSettingsSection = ({\n  t,\n  open,\n  vatDefaults,\n  vatRateValue,\n  onVatRateChange,\n  vatRateValid,\n  priceIncludesVat,\n  onPriceIncludesVatChange,\n}: VatSettingsSectionProps) => {\n  const toggleId = useId();\n  const rateInputId = useId();\n\n  const defaultRate = vatDefaults.vatRate ?? DEFAULT_ORGANIZATION_TAX_PROFILE.defaultVatRate;\n  const defaultMode =\n    vatDefaults.priceIncludesVat ?? DEFAULT_ORGANIZATION_TAX_PROFILE.pricesIncludeVat;\n\n  const trimmedRate = vatRateValue.trim();\n  const parsedRate = parseFloat(trimmedRate.replace(\",\", \".\"));\n  const usesDefaultRate =\n    trimmedRate === \"\" ||\n    (!Number.isNaN(parsedRate) && Math.abs(parsedRate - defaultRate) < 0.001);\n  const usesDefaultMode = priceIncludesVat === defaultMode;\n  const differsFromDefaults = !usesDefaultRate || !usesDefaultMode;\n\n  const [expanded, setExpanded] = useState(false);\n\n  useEffect(() => {\n    if (!open) {\n      setExpanded(false);\n      return;\n    }\n    if ((differsFromDefaults || !vatRateValid) && !expanded) {\n      setExpanded(true);\n    }\n  }, [open, differsFromDefaults, vatRateValid, expanded]);\n\n  useEffect(() => {\n    if (!vatRateValid && !expanded) {\n      setExpanded(true);\n    }\n  }, [vatRateValid, expanded]);\n\n  useEffect(() => {\n    if (differsFromDefaults && !expanded) {\n      setExpanded(true);\n    }\n  }, [differsFromDefaults, expanded]);\n\n  const formatter = useMemo(\n    () =>\n      new Intl.NumberFormat(\"tr-TR\", {\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 2,\n      }),\n    []\n  );\n\n  const summaryRate = (() => {\n    if (trimmedRate === \"\") {\n      return formatter.format(defaultRate);\n    }\n    const numeric = parseFloat(trimmedRate.replace(\",\", \".\"));\n    if (!Number.isFinite(numeric)) {\n      return formatter.format(defaultRate);\n    }\n    return formatter.format(numeric);\n  })();\n\n  const summaryMode = t(\n    `service.vat_section.summary_mode.${priceIncludesVat ? \"inclusive\" : \"exclusive\"}`\n  );\n  const summaryText = t(\"service.vat_section.summary\", {\n    rate: summaryRate,\n    mode: summaryMode,\n  });\n\n  const handleToggleChange = useCallback(\n    (checked: boolean) => {\n      if (!checked) {\n        onVatRateChange(\"\");\n        onPriceIncludesVatChange(Boolean(defaultMode));\n      }\n      setExpanded(checked);\n    },\n    [defaultMode, onPriceIncludesVatChange, onVatRateChange, setExpanded]\n  );\n\n  return (\n    <div className=\"space-y-3 rounded-xl border border-border/70 bg-muted/10 p-4\">\n      <div className=\"flex flex-wrap items-start justify-between gap-3\">\n        <div className=\"space-y-1\">\n          <p className=\"text-sm font-semibold text-slate-900\">{t(\"service.vat_section.title\")}</p>\n          <p className=\"text-xs text-muted-foreground\">\n            {expanded ? t(\"service.vat_section.description\") : summaryText}\n          </p>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          <Switch id={toggleId} checked={expanded} onCheckedChange={handleToggleChange} />\n          <div className=\"space-y-1\">\n            <Label htmlFor={toggleId} className=\"text-sm font-medium text-slate-900\">\n              {t(\"service.vat_section.toggle_label\")}\n            </Label>\n            <p className=\"text-xs text-muted-foreground\">{t(\"service.vat_section.toggle_helper\")}</p>\n          </div>\n        </div>\n      </div>\n\n      {expanded ? (\n        <div className=\"flex flex-wrap items-end gap-3\">\n          <div className=\"flex min-w-[140px] flex-col gap-1\">\n            <Label\n              htmlFor={rateInputId}\n              className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\"\n            >\n              {t(\"service.vat_section.rate_label\")}\n            </Label>\n            <Input\n              id={rateInputId}\n              type=\"number\"\n              inputMode=\"decimal\"\n              min={0}\n              max={99.99}\n              step=\"0.01\"\n              value={vatRateValue}\n              onChange={(event) => onVatRateChange(event.target.value)}\n              placeholder={String(defaultRate)}\n              className=\"h-9 w-[120px]\"\n            />\n            <p className={cn(\"text-xs\", vatRateValid ? \"text-muted-foreground\" : \"text-destructive\")}>\n              {vatRateValid\n                ? t(\"service.vat_section.defaults_hint\")\n                : t(\"service.errors.vat_rate_range\")}\n            </p>\n          </div>\n          <div className=\"flex min-w-[180px] flex-col gap-1\">\n            <Label className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\">\n              {t(\"service.vat_section.mode_label\")}\n            </Label>\n            <Select\n              value={priceIncludesVat ? \"inclusive\" : \"exclusive\"}\n              onValueChange={(value) => onPriceIncludesVatChange(value === \"inclusive\")}\n            >\n              <SelectTrigger className=\"h-9 rounded-xl\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"inclusive\">{t(\"service.vat_section.mode_inclusive\")}</SelectItem>\n                <SelectItem value=\"exclusive\">{t(\"service.vat_section.mode_exclusive\")}</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n      ) : null}\n    </div>\n  );\n};\n\ninterface AddServiceDialogProps {\n  open: boolean;\n  initialType: ServiceType;\n  onOpenChange: (open: boolean) => void;\n  onServiceAdded: () => void;\n}\n\n\nexport function AddServiceDialog({ open, onOpenChange, onServiceAdded, initialType }: AddServiceDialogProps) {\n  const { t } = useTranslation([\"forms\", \"common\"]);\n  const [loading, setLoading] = useState(false);\n  const { categoriesByType, addCategory } = useServiceCategories(open);\n  const [showNewCategoryInput, setShowNewCategoryInput] = useState(false);\n  const [newCategoryName, setNewCategoryName] = useState(\"\");\n  const { data: organizationTaxProfile } = useOrganizationTaxProfile();\n  const vatDefaults = useMemo(\n    () => ({\n      vatRate: organizationTaxProfile?.defaultVatRate ?? DEFAULT_ORGANIZATION_TAX_PROFILE.defaultVatRate,\n      priceIncludesVat: organizationTaxProfile?.pricesIncludeVat ?? DEFAULT_ORGANIZATION_TAX_PROFILE.pricesIncludeVat,\n    }),\n    [organizationTaxProfile]\n  );\n  const [formData, setFormData] = useState<ServiceFormState>(() =>\n    createFormState(initialType, {}, vatDefaults)\n  );\n  const [selectedType, setSelectedType] = useState<ServiceType | null>(null);\n\n  useEffect(() => {\n    if (open) {\n      setFormData(createFormState(initialType, {}, vatDefaults));\n      setShowNewCategoryInput(false);\n      setNewCategoryName(\"\");\n      setSelectedType(null);\n    }\n  }, [open, initialType, vatDefaults]);\n\n  const serviceTypeOptions = useMemo(\n    () => [\n      {\n        value: \"coverage\" as ServiceType,\n        label: t(\"service.service_type_coverage\"),\n        description: t(\"service.service_type_coverage_hint\"),\n        icon: Users,\n      },\n      {\n        value: \"deliverable\" as ServiceType,\n        label: t(\"service.service_type_deliverable\"),\n        description: t(\"service.service_type_deliverable_hint\"),\n        icon: Package,\n      },\n    ],\n    [t]\n  );\n\n  const handleServiceTypeSelect = useCallback((type: ServiceType) => {\n    setSelectedType(type);\n    setFormData((prev) => ({\n      ...prev,\n      service_type: type,\n      category: \"\",\n    }));\n    setShowNewCategoryInput(false);\n    setNewCategoryName(\"\");\n  }, []);\n\n  const defaultCategories = useMemo(\n    () => (selectedType ? DEFAULT_CATEGORIES[selectedType] : []),\n    [selectedType]\n  );\n  const customCategories = useMemo(() => {\n    if (!selectedType) {\n      return [];\n    }\n    const categories = categoriesByType[selectedType] ?? [];\n    return categories.filter((category) => !DEFAULT_CATEGORIES[selectedType].includes(category));\n  }, [categoriesByType, selectedType]);\n\n  const hasSelectedType = selectedType !== null;\n  const hasSelectedCategory = hasSelectedType && Boolean(formData.category.trim());\n  const vatRateNumeric = parseFloat(formData.vat_rate.replace(\",\", \".\"));\n  const vatRateValid =\n    (formData.vat_rate.trim() === \"\" && vatDefaults.vatRate != null) ||\n    (!Number.isNaN(vatRateNumeric) && vatRateNumeric >= 0 && vatRateNumeric <= 99.99);\n  const isSaveDisabled =\n    loading || !hasSelectedCategory || !formData.name.trim() || !vatRateValid;\n\n  const typeCardBase = \"group flex flex-col gap-3 rounded-xl border p-4 text-left transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500/60 focus-visible:ring-offset-2 focus-visible:ring-offset-white\";\n\n  const handleCreateNewCategory = () => {\n    if (!selectedType) return;\n    const normalized = newCategoryName.trim();\n    if (!normalized) return;\n    addCategory(selectedType, normalized);\n    setFormData((prev) => ({ ...prev, category: normalized }));\n    setShowNewCategoryInput(false);\n    setNewCategoryName(\"\");\n  };\n\n  const handleSubmit = async () => {\n    if (!selectedType || !formData.category.trim()) {\n      return;\n    }\n\n    if (!formData.name.trim()) {\n      toast({\n        title: t(\"toast.error\", { ns: \"common\" }),\n        description: t(\"service.errors.name_required\"),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const parsedVatRate =\n      formData.vat_rate.trim() === \"\"\n        ? vatDefaults.vatRate ?? DEFAULT_ORGANIZATION_TAX_PROFILE.defaultVatRate\n        : parseFloat(formData.vat_rate.replace(\",\", \".\"));\n\n    if (Number.isNaN(parsedVatRate) || parsedVatRate < 0 || parsedVatRate > 99.99) {\n      toast({\n        title: t(\"toast.error\", { ns: \"common\" }),\n        description: t(\"service.errors.vat_rate_invalid\"),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const {\n        data: { user },\n      } = await supabase.auth.getUser();\n      if (!user) throw new Error(\"User not authenticated\");\n\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) throw new Error(\"Organization required\");\n\n      const isCoverage = selectedType === \"coverage\";\n\n      const { error } = await supabase.from(\"services\").insert({\n        user_id: user.id,\n        organization_id: organizationId,\n        name: formData.name.trim(),\n        description: formData.description.trim() || null,\n        category: formData.category.trim(),\n        price: formData.price ? parseFloat(formData.price) : 0,\n        cost_price: formData.cost_price ? parseFloat(formData.cost_price) : 0,\n        selling_price: formData.selling_price ? parseFloat(formData.selling_price) : 0,\n        extra: formData.extra,\n        service_type: selectedType,\n        is_people_based: isCoverage,\n        is_active: formData.is_active,\n        vendor_name: formData.vendor_name.trim() || null,\n        default_unit: null,\n        vat_rate: parsedVatRate,\n        price_includes_vat: formData.price_includes_vat,\n      });\n\n      if (error) throw error;\n\n      toast({\n        title: t(\"toast.success\", { ns: \"common\" }),\n        description: t(\"service.success.added\"),\n      });\n\n      setFormData(createFormState(initialType, {}, vatDefaults));\n      setSelectedType(null);\n      setShowNewCategoryInput(false);\n      setNewCategoryName(\"\");\n      onOpenChange(false);\n      onServiceAdded();\n    } catch (error: any) {\n      toast({\n        title: t(\"toast.error\", { ns: \"common\" }),\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isDirty = useMemo(() => {\n    const baseState = createFormState(initialType, {}, vatDefaults);\n    return (\n      formData.name.trim() !== baseState.name ||\n      formData.description.trim() !== baseState.description ||\n      formData.category.trim() !== baseState.category ||\n      formData.price.trim() !== baseState.price ||\n      formData.cost_price.trim() !== baseState.cost_price ||\n      formData.selling_price.trim() !== baseState.selling_price ||\n      formData.vat_rate.trim() !== baseState.vat_rate.trim() ||\n      formData.price_includes_vat !== baseState.price_includes_vat ||\n      formData.extra !== baseState.extra ||\n      formData.service_type !== baseState.service_type ||\n      formData.vendor_name.trim() !== baseState.vendor_name.trim() ||\n      formData.is_active !== baseState.is_active\n    );\n  }, [formData, initialType, vatDefaults]);\n\n  const navigation = useModalNavigation({\n    isDirty,\n    onDiscard: () => {\n      setFormData(createFormState(initialType, {}, vatDefaults));\n      setShowNewCategoryInput(false);\n      setNewCategoryName(\"\");\n      setSelectedType(null);\n      onOpenChange(false);\n    },\n    onSaveAndExit: handleSubmit,\n  });\n\n  const handleDirtyClose = () => {\n    const canClose = navigation.handleModalClose();\n    if (canClose) {\n      setFormData(createFormState(initialType, {}, vatDefaults));\n      setShowNewCategoryInput(false);\n      setNewCategoryName(\"\");\n      setSelectedType(null);\n      onOpenChange(false);\n    }\n  };\n\n  const footerActions = [\n    {\n      label: t(\"buttons.cancel\", { ns: \"common\" }),\n      onClick: handleDirtyClose,\n      variant: \"outline\" as const,\n      disabled: loading,\n    },\n    {\n      label: loading ? t(\"actions.saving\", { ns: \"common\" }) : t(\"buttons.save\", { ns: \"common\" }),\n      onClick: handleSubmit,\n      disabled: isSaveDisabled,\n      loading,\n    },\n  ];\n\n  return (\n    <AppSheetModal\n      title={t(\"service.add_title\")}\n      isOpen={open}\n      onOpenChange={onOpenChange}\n      size=\"content\"\n      dirty={isDirty}\n      onDirtyClose={handleDirtyClose}\n      footerActions={footerActions}\n    >\n      <div className=\"space-y-4\">\n        <p className=\"text-sm text-muted-foreground\">{t(\"service.intro\")}</p>\n\n        <div className=\"space-y-2\">\n          <Label className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\">\n            {t(\"service.service_type_label\")} <span className=\"text-rose-500\">*</span>\n          </Label>\n          <p className=\"text-xs text-muted-foreground\">{t(\"service.service_type_hint\")}</p>\n          <div className=\"grid gap-2 sm:grid-cols-2\">\n            {serviceTypeOptions.map((option) => {\n              const isSelected = selectedType === option.value;\n              const isOther = hasSelectedType && !isSelected;\n              return (\n                <button\n                  key={option.value}\n                  type=\"button\"\n                  onClick={() => handleServiceTypeSelect(option.value)}\n                  className={cn(\n                    typeCardBase,\n                    hasSelectedType\n                      ? \"border border-emerald-200 bg-white/80\"\n                      : \"border-dashed border-emerald-300/70 bg-white/60 hover:border-emerald-400\",\n                    isSelected && \"border-emerald-500 bg-emerald-50 shadow-sm\",\n                    isOther && \"opacity-60 hover:opacity-80\",\n                    hasSelectedType ? \"py-3\" : \"py-4\"\n                  )}\n                >\n                  <span\n                    className={cn(\n                      \"inline-flex items-center justify-center rounded-full text-emerald-600 shadow-sm transition-all\",\n                      hasSelectedType ? \"h-7 w-7 bg-emerald-100\" : \"h-9 w-9 bg-emerald-50\"\n                    )}\n                  >\n                    <option.icon className={cn(\"transition-transform\", hasSelectedType ? \"h-4 w-4\" : \"h-5 w-5\")} aria-hidden=\"true\" />\n                  </span>\n                  <div className={cn(\"flex-1 space-y-1\", hasSelectedType && \"space-y-0\")}>\n                    <div className={cn(\"font-semibold text-slate-900\", hasSelectedType ? \"text-sm\" : \"text-base\")}>{option.label}</div>\n                    {!hasSelectedType && (\n                      <p className=\"text-xs leading-relaxed text-muted-foreground\">{option.description}</p>\n                    )}\n                  </div>\n                </button>\n              );\n            })}\n          </div>\n        </div>\n\n        {hasSelectedType && (\n          <div className=\"space-y-2 transition-all duration-300\">\n            <Label htmlFor=\"category\" className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\">\n              {t(\"service.category\")} <span className=\"text-rose-500\">*</span>\n            </Label>\n            {showNewCategoryInput ? (\n              <div className=\"flex gap-2\">\n                <Input\n                  value={newCategoryName}\n                  onChange={(event) => setNewCategoryName(event.target.value)}\n                  placeholder={t(\"service.new_category_placeholder\")}\n                  className=\"rounded-xl\"\n                  onKeyDown={(event) => {\n                    if (event.key === \"Enter\") {\n                      handleCreateNewCategory();\n                    }\n                    if (event.key === \"Escape\") {\n                      setShowNewCategoryInput(false);\n                      setNewCategoryName(\"\");\n                    }\n                  }}\n                />\n                <Button type=\"button\" size=\"sm\" onClick={handleCreateNewCategory} disabled={!newCategoryName.trim()} className=\"w-16\">\n                  {t(\"buttons.add\", { ns: \"common\" })}\n                </Button>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => {\n                    setShowNewCategoryInput(false);\n                    setNewCategoryName(\"\");\n                  }}\n                  className=\"w-16\"\n                >\n                  {t(\"buttons.cancel\", { ns: \"common\" })}\n                </Button>\n              </div>\n            ) : (\n              <Select\n                value={formData.category}\n                onValueChange={(value) => {\n                  if (value === \"create-new\") {\n                    setShowNewCategoryInput(true);\n                  } else {\n                    setFormData((prev) => ({ ...prev, category: value }));\n                  }\n                }}\n              >\n                <SelectTrigger className=\"rounded-xl\">\n                  <SelectValue placeholder={t(\"service.category_placeholder\")} />\n                </SelectTrigger>\n                <SelectContent className=\"bg-popover border border-border shadow-lg z-50\">\n                  <div className=\"px-2 py-1.5 text-xs font-medium uppercase tracking-wide text-muted-foreground\">\n                    {t(\"service.default_categories_label\")}\n                  </div>\n                  {defaultCategories.map((category) => (\n                    <SelectItem key={category} value={category} className=\"hover:bg-accent hover:text-accent-foreground\">\n                      {category}\n                    </SelectItem>\n                  ))}\n\n                  {customCategories.length > 0 && (\n                    <>\n                      <SelectSeparator />\n                      <div className=\"px-2 py-1.5 text-xs font-medium uppercase tracking-wide text-muted-foreground\">\n                        {t(\"service.custom_categories_label\")}\n                      </div>\n                      {customCategories.map((category) => (\n                        <SelectItem key={category} value={category} className=\"hover:bg-accent hover:text-accent-foreground\">\n                          {category}\n                        </SelectItem>\n                      ))}\n                    </>\n                  )}\n\n                  <SelectSeparator />\n                  <SelectItem value=\"create-new\" className=\"text-primary hover:bg-accent hover:text-accent-foreground\">\n                    <div className=\"flex items-center\">\n                      <Plus className=\"mr-2 h-4 w-4\" />\n                      {t(\"service.new_category\")}\n                    </div>\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            )}\n          </div>\n        )}\n\n        {hasSelectedCategory && (\n          <div className=\"space-y-4 transition-all duration-300\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"name\">\n                {t(\"service.name\")} <span className=\"text-rose-500\">*</span>\n              </Label>\n              <Input\n                id=\"name\"\n                value={formData.name}\n                onChange={(event) => setFormData((prev) => ({ ...prev, name: event.target.value }))}\n                placeholder={t(\"service.name_placeholder\")}\n                maxLength={100}\n                className=\"rounded-xl\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"description\">{t(\"service.description\")}</Label>\n              <Textarea\n                id=\"description\"\n                value={formData.description}\n                onChange={(event) => setFormData((prev) => ({ ...prev, description: event.target.value }))}\n                placeholder={t(\"service.description_placeholder\")}\n                rows={3}\n                className=\"resize-none\"\n              />\n            </div>\n\n            <div className=\"grid gap-4 sm:grid-cols-2\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"cost_price\">{t(\"service.cost_price\")} (TRY)</Label>\n                <Input\n                  id=\"cost_price\"\n                  type=\"number\"\n                  inputMode=\"decimal\"\n                  step=\"0.01\"\n                  value={formData.cost_price}\n                  onChange={(event) => setFormData((prev) => ({ ...prev, cost_price: event.target.value }))}\n                  placeholder=\"0.00\"\n                />\n              </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"selling_price\">{t(\"service.selling_price\")} (TRY)</Label>\n              <Input\n                id=\"selling_price\"\n                type=\"number\"\n                  inputMode=\"decimal\"\n                  step=\"0.01\"\n                  value={formData.selling_price}\n                  onChange={(event) => setFormData((prev) => ({ ...prev, selling_price: event.target.value }))}\n                placeholder=\"0.00\"\n              />\n            </div>\n          </div>\n\n          <VatSettingsSection\n            t={t}\n            open={open}\n            vatDefaults={vatDefaults}\n            vatRateValue={formData.vat_rate}\n            onVatRateChange={(value) => setFormData((prev) => ({ ...prev, vat_rate: value }))}\n            vatRateValid={vatRateValid}\n            priceIncludesVat={formData.price_includes_vat}\n            onPriceIncludesVatChange={(value) =>\n              setFormData((prev) => ({ ...prev, price_includes_vat: value }))\n            }\n          />\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"vendor_name\">\n              {t(\"service.vendor_label\")}\n              <span className=\"ml-1 text-xs text-muted-foreground\">{t(\"service.optional_hint\")}</span>\n            </Label>\n              <Input\n                id=\"vendor_name\"\n                value={formData.vendor_name}\n                onChange={(event) => setFormData((prev) => ({ ...prev, vendor_name: event.target.value }))}\n                placeholder={t(\"service.vendor_placeholder\")}\n              />\n            </div>\n\n            <div className=\"flex items-start justify-between rounded-lg border p-4\">\n              <div>\n                <p className=\"text-sm font-medium leading-none\">{t(\"service.visibility_label\")}</p>\n                <p className=\"mt-1 text-xs text-muted-foreground\">{t(\"service.visibility_help\")}</p>\n              </div>\n              <Switch\n                id=\"service-is-active\"\n                checked={formData.is_active}\n                onCheckedChange={(checked) => setFormData((prev) => ({ ...prev, is_active: checked }))}\n                aria-label={t(\"service.visibility_label\")}\n              />\n            </div>\n          </div>\n        )}\n      </div>\n\n      <NavigationGuardDialog\n        open={navigation.showGuard}\n        onDiscard={navigation.handleDiscardChanges}\n        onStay={navigation.handleStayOnModal}\n        onSaveAndExit={navigation.handleSaveAndExit}\n        message={navigation.message}\n      />\n    </AppSheetModal>\n  );\n}\ninterface EditServiceDialogProps {\n  service: any;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onServiceUpdated: () => void;\n}\n\n\nexport function EditServiceDialog({ service, open, onOpenChange, onServiceUpdated }: EditServiceDialogProps) {\n  const { t } = useTranslation([\"forms\", \"common\"]);\n  const [loading, setLoading] = useState(false);\n  const { categoriesByType, addCategory } = useServiceCategories(open);\n  const [showNewCategoryInput, setShowNewCategoryInput] = useState(false);\n  const [newCategoryName, setNewCategoryName] = useState(\"\");\n  const { data: organizationTaxProfile } = useOrganizationTaxProfile();\n  const vatDefaults = useMemo(\n    () => ({\n      vatRate: organizationTaxProfile?.defaultVatRate ?? DEFAULT_ORGANIZATION_TAX_PROFILE.defaultVatRate,\n      priceIncludesVat: organizationTaxProfile?.pricesIncludeVat ?? DEFAULT_ORGANIZATION_TAX_PROFILE.pricesIncludeVat,\n    }),\n    [organizationTaxProfile]\n  );\n  const [formData, setFormData] = useState<ServiceFormState>(() =>\n    createFormState(\"deliverable\", {}, vatDefaults)\n  );\n  const [selectedType, setSelectedType] = useState<ServiceType | null>(null);\n\n  useEffect(() => {\n    if (service && open) {\n      const resolvedType = (service.service_type ?? \"deliverable\") as ServiceType;\n      setFormData(\n        createFormState(\n          resolvedType,\n          {\n            name: service.name || \"\",\n            description: service.description || \"\",\n            category: service.category || \"\",\n            price: service.price?.toString() || \"\",\n            cost_price: service.cost_price?.toString() || \"\",\n            selling_price: service.selling_price?.toString() || \"\",\n            vat_rate: service.vat_rate != null ? String(service.vat_rate) : \"\",\n            price_includes_vat:\n              service.price_includes_vat ?? (vatDefaults.priceIncludesVat ?? DEFAULT_ORGANIZATION_TAX_PROFILE.pricesIncludeVat),\n            extra: service.extra ?? false,\n            service_type: resolvedType,\n            vendor_name: service.vendor_name || \"\",\n            is_active: service.is_active ?? true,\n          },\n          vatDefaults\n        )\n      );\n      setShowNewCategoryInput(false);\n      setNewCategoryName(\"\");\n      setSelectedType(resolvedType);\n    }\n  }, [service, open, vatDefaults]);\n\n  const serviceTypeOptions = useMemo(\n    () => [\n      {\n        value: \"coverage\" as ServiceType,\n        label: t(\"service.service_type_coverage\"),\n        description: t(\"service.service_type_coverage_hint\"),\n        icon: Users,\n      },\n      {\n        value: \"deliverable\" as ServiceType,\n        label: t(\"service.service_type_deliverable\"),\n        description: t(\"service.service_type_deliverable_hint\"),\n        icon: Package,\n      },\n    ],\n    [t]\n  );\n\n  const handleServiceTypeSelect = useCallback((type: ServiceType) => {\n    setSelectedType(type);\n    setFormData((prev) => ({\n      ...prev,\n      service_type: type,\n      category: \"\",\n    }));\n    setShowNewCategoryInput(false);\n    setNewCategoryName(\"\");\n  }, []);\n\n  const activeType: ServiceType = (selectedType ?? formData.service_type ?? \"deliverable\") as ServiceType;\n  const defaultCategories = useMemo(() => DEFAULT_CATEGORIES[activeType], [activeType]);\n  const customCategories = useMemo(\n    () => (categoriesByType[activeType] ?? []).filter((category) => !defaultCategories.includes(category)),\n    [categoriesByType, activeType, defaultCategories]\n  );\n\n  const hasSelectedType = selectedType !== null;\n  const hasSelectedCategory = Boolean(formData.category?.trim());\n  const editVatRateNumeric = parseFloat(formData.vat_rate.replace(\",\", \".\"));\n  const editVatRateValid =\n    (formData.vat_rate.trim() === \"\" && vatDefaults.vatRate != null) ||\n    (!Number.isNaN(editVatRateNumeric) && editVatRateNumeric >= 0 && editVatRateNumeric <= 99.99);\n  const isSaveDisabled =\n    loading || !hasSelectedType || !hasSelectedCategory || !formData.name.trim() || !editVatRateValid;\n\n  const typeCardBase = \"group flex flex-col gap-3 rounded-xl border p-4 text-left transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500/60 focus-visible:ring-offset-2 focus-visible:ring-offset-white\";\n\n  const handleCreateNewCategory = () => {\n    const typeForCategory = selectedType ?? formData.service_type;\n    if (!typeForCategory) return;\n    const normalized = newCategoryName.trim();\n    if (!normalized) return;\n    addCategory(typeForCategory, normalized);\n    setFormData((prev) => ({ ...prev, category: normalized }));\n    setShowNewCategoryInput(false);\n    setNewCategoryName(\"\");\n  };\n\n  const handleSubmit = async () => {\n    if (!selectedType || !service) {\n      return;\n    }\n\n    if (!formData.category.trim()) {\n      toast({\n        title: t(\"toast.error\", { ns: \"common\" }),\n        description: t(\"service.errors.category_required\"),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!formData.name.trim()) {\n      toast({\n        title: t(\"toast.error\", { ns: \"common\" }),\n        description: t(\"service.errors.name_required\"),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const parsedVatRate =\n      formData.vat_rate.trim() === \"\"\n        ? vatDefaults.vatRate ?? DEFAULT_ORGANIZATION_TAX_PROFILE.defaultVatRate\n        : parseFloat(formData.vat_rate.replace(\",\", \".\"));\n\n    if (Number.isNaN(parsedVatRate) || parsedVatRate < 0 || parsedVatRate > 99.99) {\n      toast({\n        title: t(\"toast.error\", { ns: \"common\" }),\n        description: t(\"service.errors.vat_rate_invalid\"),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const { error } = await supabase\n        .from(\"services\")\n        .update({\n          name: formData.name.trim(),\n          description: formData.description.trim() || null,\n          category: formData.category.trim(),\n          price: formData.price ? parseFloat(formData.price) : 0,\n          cost_price: formData.cost_price ? parseFloat(formData.cost_price) : 0,\n          selling_price: formData.selling_price ? parseFloat(formData.selling_price) : 0,\n          extra: formData.extra,\n          service_type: selectedType,\n          is_people_based: selectedType === \"coverage\" ? (service?.is_people_based ?? true) : false,\n          vendor_name: formData.vendor_name.trim() || null,\n          is_active: formData.is_active,\n          vat_rate: parsedVatRate,\n          price_includes_vat: formData.price_includes_vat,\n        })\n        .eq(\"id\", service?.id);\n\n      if (error) throw error;\n\n      toast({\n        title: t(\"toast.success\", { ns: \"common\" }),\n        description: t(\"service.success.updated\"),\n      });\n\n      onServiceUpdated();\n      onOpenChange(false);\n    } catch (error: any) {\n      toast({\n        title: t(\"toast.error\", { ns: \"common\" }),\n        description: error.message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isDirty = useMemo(() => {\n    if (!service) return false;\n    const baseState = createFormState(\n      (service.service_type ?? \"deliverable\") as ServiceType,\n      {\n        name: service.name || \"\",\n        description: service.description || \"\",\n        category: service.category || \"\",\n        price: service.price?.toString() || \"\",\n        cost_price: service.cost_price?.toString() || \"\",\n        selling_price: service.selling_price?.toString() || \"\",\n        vat_rate: service.vat_rate != null ? String(service.vat_rate) : \"\",\n        price_includes_vat:\n          service.price_includes_vat ?? (vatDefaults.priceIncludesVat ?? DEFAULT_ORGANIZATION_TAX_PROFILE.pricesIncludeVat),\n        extra: service.extra ?? false,\n        service_type: (service.service_type ?? \"deliverable\") as ServiceType,\n        vendor_name: service.vendor_name || \"\",\n        is_active: service.is_active ?? true,\n      },\n      vatDefaults\n    );\n\n    return (\n      formData.name.trim() !== baseState.name.trim() ||\n      formData.description.trim() !== baseState.description?.trim() ||\n      formData.category.trim() !== baseState.category?.trim() ||\n      formData.price.trim() !== baseState.price.trim() ||\n      formData.cost_price.trim() !== baseState.cost_price.trim() ||\n      formData.selling_price.trim() !== baseState.selling_price.trim() ||\n      formData.vat_rate.trim() !== baseState.vat_rate.trim() ||\n      formData.price_includes_vat !== baseState.price_includes_vat ||\n      formData.extra !== baseState.extra ||\n      formData.service_type !== baseState.service_type ||\n      formData.vendor_name.trim() !== baseState.vendor_name?.trim() ||\n      formData.is_active !== baseState.is_active\n    );\n  }, [formData, service, vatDefaults]);\n\n  const navigation = useModalNavigation({\n    isDirty,\n    onDiscard: () => {\n      if (!service) {\n        onOpenChange(false);\n        return;\n      }\n      const resolvedType = (service.service_type ?? \"deliverable\") as ServiceType;\n      setFormData(\n        createFormState(\n          resolvedType,\n          {\n            name: service.name || \"\",\n            description: service.description || \"\",\n            category: service.category || \"\",\n            price: service.price?.toString() || \"\",\n            cost_price: service.cost_price?.toString() || \"\",\n            selling_price: service.selling_price?.toString() || \"\",\n            vat_rate: service.vat_rate != null ? String(service.vat_rate) : \"\",\n            price_includes_vat:\n              service.price_includes_vat ?? (vatDefaults.priceIncludesVat ?? DEFAULT_ORGANIZATION_TAX_PROFILE.pricesIncludeVat),\n            extra: service.extra ?? false,\n            service_type: resolvedType,\n            vendor_name: service.vendor_name || \"\",\n            is_active: service.is_active ?? true,\n          },\n          vatDefaults\n        )\n      );\n      setShowNewCategoryInput(false);\n      setNewCategoryName(\"\");\n      setSelectedType(resolvedType);\n      onOpenChange(false);\n    },\n    onSaveAndExit: handleSubmit,\n  });\n\n  const handleDirtyClose = () => {\n    const canClose = navigation.handleModalClose();\n    if (canClose && service) {\n      const resolvedType = (service.service_type ?? \"deliverable\") as ServiceType;\n      setFormData(\n        createFormState(\n          resolvedType,\n          {\n            name: service.name || \"\",\n            description: service.description || \"\",\n            category: service.category || \"\",\n            price: service.price?.toString() || \"\",\n            cost_price: service.cost_price?.toString() || \"\",\n            selling_price: service.selling_price?.toString() || \"\",\n            vat_rate: service.vat_rate != null ? String(service.vat_rate) : \"\",\n            price_includes_vat:\n              service.price_includes_vat ?? (vatDefaults.priceIncludesVat ?? DEFAULT_ORGANIZATION_TAX_PROFILE.pricesIncludeVat),\n            extra: service.extra ?? false,\n            service_type: resolvedType,\n            vendor_name: service.vendor_name || \"\",\n            is_active: service.is_active ?? true,\n          },\n          vatDefaults\n        )\n      );\n      setShowNewCategoryInput(false);\n      setNewCategoryName(\"\");\n      setSelectedType(resolvedType);\n      onOpenChange(false);\n    }\n  };\n\n  const footerActions = [\n    {\n      label: t(\"buttons.cancel\", { ns: \"common\" }),\n      onClick: handleDirtyClose,\n      variant: \"outline\" as const,\n      disabled: loading,\n    },\n    {\n      label: loading ? t(\"actions.saving\", { ns: \"common\" }) : t(\"buttons.save\", { ns: \"common\" }),\n      onClick: handleSubmit,\n      disabled: isSaveDisabled,\n      loading,\n    },\n  ];\n\n  return (\n    <AppSheetModal\n      title={t(\"service.edit_title\")}\n      isOpen={open}\n      onOpenChange={onOpenChange}\n      size=\"content\"\n      dirty={isDirty}\n      onDirtyClose={handleDirtyClose}\n      footerActions={footerActions}\n    >\n      <div className=\"space-y-4\">\n        <p className=\"text-sm text-muted-foreground\">{t(\"service.intro\")}</p>\n\n        <div className=\"space-y-2\">\n          <Label className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\">\n            {t(\"service.service_type_label\")} <span className=\"text-rose-500\">*</span>\n          </Label>\n          <p className=\"text-xs text-muted-foreground\">{t(\"service.service_type_hint\")}</p>\n          <div className=\"grid gap-2 sm:grid-cols-2\">\n            {serviceTypeOptions.map((option) => {\n              const isSelected = selectedType === option.value;\n              const isOther = hasSelectedType && !isSelected;\n              return (\n                <button\n                  key={option.value}\n                  type=\"button\"\n                  onClick={() => handleServiceTypeSelect(option.value)}\n                  className={cn(\n                    typeCardBase,\n                    hasSelectedType\n                      ? \"border border-emerald-200 bg-white/80\"\n                      : \"border-dashed border-emerald-300/70 bg-white/60 hover:border-emerald-400\",\n                    isSelected && \"border-emerald-500 bg-emerald-50 shadow-sm\",\n                    isOther && \"opacity-60 hover:opacity-80\",\n                    hasSelectedType ? \"py-3\" : \"py-4\"\n                  )}\n                >\n                  <span\n                    className={cn(\n                      \"inline-flex items-center justify-center rounded-full text-emerald-600 shadow-sm transition-all\",\n                      hasSelectedType ? \"h-7 w-7 bg-emerald-100\" : \"h-9 w-9 bg-emerald-50\"\n                    )}\n                  >\n                    <option.icon className={cn(\"transition-transform\", hasSelectedType ? \"h-4 w-4\" : \"h-5 w-5\")} aria-hidden=\"true\" />\n                  </span>\n                  <div className={cn(\"flex-1 space-y-1\", hasSelectedType && \"space-y-0\")}>\n                    <div className={cn(\"font-semibold text-slate-900\", hasSelectedType ? \"text-sm\" : \"text-base\")}>{option.label}</div>\n                    {!hasSelectedType && (\n                      <p className=\"text-xs leading-relaxed text-muted-foreground\">{option.description}</p>\n                    )}\n                  </div>\n                </button>\n              );\n            })}\n          </div>\n        </div>\n\n        {hasSelectedType && (\n          <div className=\"space-y-2 transition-all duration-300\">\n            <Label htmlFor=\"edit-category\" className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\">\n              {t(\"service.category\")} <span className=\"text-rose-500\">*</span>\n            </Label>\n            {showNewCategoryInput ? (\n              <div className=\"flex gap-2\">\n                <Input\n                  id=\"edit-category\"\n                  value={newCategoryName}\n                  onChange={(event) => setNewCategoryName(event.target.value)}\n                  placeholder={t(\"service.new_category_placeholder\")}\n                  className=\"rounded-xl\"\n                  onKeyDown={(event) => {\n                    if (event.key === \"Enter\") {\n                      handleCreateNewCategory();\n                    }\n                    if (event.key === \"Escape\") {\n                      setShowNewCategoryInput(false);\n                      setNewCategoryName(\"\");\n                    }\n                  }}\n                />\n                <Button type=\"button\" size=\"sm\" onClick={handleCreateNewCategory} disabled={!newCategoryName.trim()} className=\"w-16\">\n                  {t(\"buttons.add\", { ns: \"common\" })}\n                </Button>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => {\n                    setShowNewCategoryInput(false);\n                    setNewCategoryName(\"\");\n                  }}\n                  className=\"w-16\"\n                >\n                  {t(\"buttons.cancel\", { ns: \"common\" })}\n                </Button>\n              </div>\n            ) : (\n              <Select\n                value={formData.category}\n                onValueChange={(value) => {\n                  if (value === \"create-new\") {\n                    setShowNewCategoryInput(true);\n                  } else {\n                    setFormData((prev) => ({ ...prev, category: value }));\n                  }\n                }}\n              >\n                <SelectTrigger className=\"rounded-xl\">\n                  <SelectValue placeholder={t(\"service.category_placeholder\")} />\n                </SelectTrigger>\n                <SelectContent className=\"bg-popover border border-border shadow-lg z-50\">\n                  <div className=\"px-2 py-1.5 text-xs font-medium uppercase tracking-wide text-muted-foreground\">\n                    {t(\"service.default_categories_label\")}\n                  </div>\n                  {defaultCategories.map((category) => (\n                    <SelectItem key={category} value={category} className=\"hover:bg-accent hover:text-accent-foreground\">\n                      {category}\n                    </SelectItem>\n                  ))}\n\n                  {customCategories.length > 0 && (\n                    <>\n                      <SelectSeparator />\n                      <div className=\"px-2 py-1.5 text-xs font-medium uppercase tracking-wide text-muted-foreground\">\n                        {t(\"service.custom_categories_label\")}\n                      </div>\n                      {customCategories.map((category) => (\n                        <SelectItem key={category} value={category} className=\"hover:bg-accent hover:text-accent-foreground\">\n                          {category}\n                        </SelectItem>\n                      ))}\n                    </>\n                  )}\n\n                  <SelectSeparator />\n                  <SelectItem value=\"create-new\" className=\"text-primary hover:bg-accent hover:text-accent-foreground\">\n                    <div className=\"flex items-center\">\n                      <Plus className=\"mr-2 h-4 w-4\" />\n                      {t(\"service.new_category\")}\n                    </div>\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            )}\n          </div>\n        )}\n\n        {hasSelectedCategory && (\n          <div className=\"space-y-4 transition-all duration-300\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-name\">\n                {t(\"service.name\")} <span className=\"text-rose-500\">*</span>\n              </Label>\n              <Input\n                id=\"edit-name\"\n                value={formData.name}\n                onChange={(event) => setFormData((prev) => ({ ...prev, name: event.target.value }))}\n                placeholder={t(\"service.name_placeholder\")}\n                maxLength={100}\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-description\">{t(\"service.description\")}</Label>\n              <Textarea\n                id=\"edit-description\"\n                value={formData.description}\n                onChange={(event) => setFormData((prev) => ({ ...prev, description: event.target.value }))}\n                placeholder={t(\"service.description_placeholder\")}\n                rows={3}\n                className=\"resize-none\"\n              />\n            </div>\n\n            <div className=\"grid gap-4 sm:grid-cols-2\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-cost-price\">{t(\"service.cost_price\")} (TRY)</Label>\n                <Input\n                  id=\"edit-cost-price\"\n                  type=\"number\"\n                  inputMode=\"decimal\"\n                  step=\"0.01\"\n                  value={formData.cost_price}\n                  onChange={(event) => setFormData((prev) => ({ ...prev, cost_price: event.target.value }))}\n                  placeholder=\"0.00\"\n                />\n              </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-selling-price\">{t(\"service.selling_price\")} (TRY)</Label>\n              <Input\n                id=\"edit-selling-price\"\n                type=\"number\"\n                  inputMode=\"decimal\"\n                  step=\"0.01\"\n                  value={formData.selling_price}\n                  onChange={(event) => setFormData((prev) => ({ ...prev, selling_price: event.target.value }))}\n                placeholder=\"0.00\"\n              />\n            </div>\n          </div>\n\n          <VatSettingsSection\n            t={t}\n            open={open}\n            vatDefaults={vatDefaults}\n            vatRateValue={formData.vat_rate}\n            onVatRateChange={(value) => setFormData((prev) => ({ ...prev, vat_rate: value }))}\n            vatRateValid={editVatRateValid}\n            priceIncludesVat={formData.price_includes_vat}\n            onPriceIncludesVatChange={(value) =>\n              setFormData((prev) => ({ ...prev, price_includes_vat: value }))\n            }\n          />\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-vendor-name\">\n                {t(\"service.vendor_label\")}\n                <span className=\"ml-1 text-xs text-muted-foreground\">{t(\"service.optional_hint\")}</span>\n              </Label>\n              <Input\n                id=\"edit-vendor-name\"\n                value={formData.vendor_name}\n                onChange={(event) => setFormData((prev) => ({ ...prev, vendor_name: event.target.value }))}\n                placeholder={t(\"service.vendor_placeholder\")}\n              />\n            </div>\n\n            <div className=\"flex items-start justify-between rounded-lg border p-4\">\n              <div>\n                <p className=\"text-sm font-medium leading-none\">{t(\"service.visibility_label\")}</p>\n                <p className=\"text-xs text-muted-foreground mt-1\">{t(\"service.visibility_help\")}</p>\n              </div>\n              <Switch\n                id=\"edit-service-is-active\"\n                checked={formData.is_active}\n                onCheckedChange={(checked) => setFormData((prev) => ({ ...prev, is_active: checked }))}\n                aria-label={t(\"service.visibility_label\")}\n              />\n            </div>\n          </div>\n        )}\n      </div>\n\n      <NavigationGuardDialog\n        open={navigation.showGuard}\n        onDiscard={navigation.handleDiscardChanges}\n        onStay={navigation.handleStayOnModal}\n        onSaveAndExit={navigation.handleSaveAndExit}\n        message={navigation.message}\n      />\n    </AppSheetModal>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/SessionStatusDialogs.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'formData.lifecycle'. Either include it or remove the dependency array.","line":44,"column":6,"nodeType":"ArrayExpression","endLine":44,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [formData.lifecycle, formData.name]","fix":{"range":[1815,1830],"text":"[formData.lifecycle, formData.name]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3461,3464],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3461,3464],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":233,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7923,7926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7923,7926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":289,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9410,9413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9410,9413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":356,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":356,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10938,10941],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10938,10941],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\nimport { AppSheetModal } from \"@/components/ui/app-sheet-modal\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\nimport { useModalNavigation } from \"@/hooks/useModalNavigation\";\nimport { NavigationGuardDialog } from \"./NavigationGuardDialog\";\nimport { SegmentedControl } from \"@/components/ui/segmented-control\";\n\ninterface AddSessionStatusDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onStatusAdded: () => void;\n}\n\nexport function AddSessionStatusDialog({ open, onOpenChange, onStatusAdded }: AddSessionStatusDialogProps) {\n  const { t } = useTranslation('forms');\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    color: \"#3B82F6\",\n    lifecycle: \"active\" as \"active\" | \"completed\" | \"cancelled\", // No \"archived\" for sessions\n  });\n\n  // Smart default based on name (no \"archived\" for sessions)\n  const getSmartLifecycleDefault = (name: string): \"active\" | \"completed\" | \"cancelled\" => {\n    const lowerName = name.toLowerCase();\n    if (lowerName.includes(\"cancel\")) return \"cancelled\";\n    if (lowerName.includes(\"deliver\") || lowerName.includes(\"complete\")) return \"completed\";\n    return \"active\";\n  };\n\n  // Update lifecycle when name changes\n  useEffect(() => {\n    if (formData.name) {\n      const suggestedLifecycle = getSmartLifecycleDefault(formData.name);\n      if (suggestedLifecycle !== formData.lifecycle) {\n        setFormData(prev => ({ ...prev, lifecycle: suggestedLifecycle }));\n      }\n    }\n  }, [formData.name]);\n\n  const handleSubmit = async () => {\n    if (!status) return;\n    if (!formData.name.trim()) {\n      toast({\n        title: t('common:errors.validation'),\n        description: t('session_status.errors.name_required'),\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('User not authenticated');\n\n      // Get user's active organization\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) {\n        throw new Error(\"Organization required\");\n      }\n\n      // Get the next sort order\n      const { data: existingStatuses } = await supabase\n        .from('session_statuses')\n        .select('sort_order')\n        .eq('organization_id', organizationId)\n        .order('sort_order', { ascending: false })\n        .limit(1);\n\n      const nextSortOrder = (existingStatuses?.[0]?.sort_order || 0) + 1;\n\n      const { error } = await supabase\n        .from('session_statuses')\n        .insert({\n          user_id: user.id,\n          organization_id: organizationId,\n          name: formData.name.trim(),\n          color: formData.color,\n          lifecycle: formData.lifecycle,\n          sort_order: nextSortOrder,\n          is_system_initial: false\n        });\n\n      if (error) throw error;\n\n      toast({\n        title: t('common:success.created'),\n        description: t('session_status.success.added')\n      });\n\n      setFormData({ name: \"\", color: \"#3B82F6\", lifecycle: \"active\" });\n      onOpenChange(false);\n      onStatusAdded();\n    } catch (error: any) {\n      toast({\n        title: t('common:errors.save'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isDirty = Boolean(formData.name.trim() || formData.color !== \"#3B82F6\" || formData.lifecycle !== \"active\");\n\n  const navigation = useModalNavigation({\n    isDirty,\n    onDiscard: () => {\n      setFormData({ name: \"\", color: \"#3B82F6\", lifecycle: \"active\" });\n      onOpenChange(false);\n    },\n    onSaveAndExit: async () => {\n      await handleSubmit();\n    }\n  });\n\n  const handleDirtyClose = () => {\n    const canClose = navigation.handleModalClose();\n    if (canClose) {\n      setFormData({ name: \"\", color: \"#3B82F6\", lifecycle: \"active\" });\n      onOpenChange(false);\n    }\n  };\n\n  const footerActions = [\n    {\n      label: t('common:buttons.cancel'),\n      onClick: handleDirtyClose,\n      variant: \"outline\" as const,\n      disabled: loading\n    },\n    {\n      label: loading ? t('buttons.adding') : t('common:buttons.add'),\n      onClick: handleSubmit,\n      disabled: loading || !formData.name.trim(),\n      loading: loading\n    }\n  ];\n\n  const colorOptions = [\n    \"#EF4444\", \"#F97316\", \"#EAB308\", \"#84CC16\", \"#22C55E\", \"#06B6D4\",\n    \"#3B82F6\", \"#6366F1\", \"#8B5CF6\", \"#A855F7\", \"#EC4899\", \"#64748B\"\n  ];\n\n  return (\n    <AppSheetModal\n      title={t('session_status.add_title')}\n      isOpen={open}\n      onOpenChange={onOpenChange}\n      size=\"content\"\n      dirty={isDirty}\n      onDirtyClose={handleDirtyClose}\n      footerActions={footerActions}\n    >\n      <div className=\"space-y-6\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"name\">{t('session_status.name_label')}</Label>\n          <Input\n            id=\"name\"\n            value={formData.name}\n            onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n            placeholder={t('session_status.name_placeholder')}\n            maxLength={50}\n            className=\"rounded-xl\"\n          />\n          <p className=\"text-sm text-muted-foreground\">{t('session_status.name_help')}</p>\n        </div>\n\n        <div className=\"space-y-3\">\n          <Label>{t('session_status.color_label')}</Label>\n          <div className=\"grid grid-cols-6 gap-3 p-4\">\n            {colorOptions.map((color) => (\n              <button\n                key={color}\n                type=\"button\"\n                onClick={() => setFormData(prev => ({ ...prev, color }))}\n                className={`w-10 h-10 rounded-full border-4 transition-all ${\n                  formData.color === color \n                    ? 'border-gray-900 scale-110' \n                    : 'border-transparent hover:scale-105'\n                }`}\n                style={{ backgroundColor: color }}\n              />\n            ))}\n          </div>\n        </div>\n\n        <div className=\"space-y-3\">\n          <Label>{t('session_status.lifecycle.label')}</Label>\n        <SegmentedControl\n          size=\"md\"\n          value={formData.lifecycle}\n          onValueChange={(value) =>\n            setFormData(prev => ({ ...prev, lifecycle: value as typeof prev.lifecycle }))\n          }\n          options={[\n            { value: \"active\", label: t('session_status.lifecycle.active') },\n            { value: \"completed\", label: t('session_status.lifecycle.completed') },\n            { value: \"cancelled\", label: t('session_status.lifecycle.cancelled') },\n          ]}\n          className=\"mt-2 w-full justify-between\"\n        />\n          <div className=\"space-y-1 text-sm text-muted-foreground\">\n            <p>{t('session_status.lifecycle.help.title')}</p>\n            <ul className=\"space-y-1 ml-4\">\n              <li>â€¢ <strong>{t('session_status.lifecycle.active')}:</strong> {t('session_status.lifecycle.help.active')}</li>\n              <li>â€¢ <strong>{t('session_status.lifecycle.completed')}:</strong> {t('session_status.lifecycle.help.completed')}</li>\n              <li>â€¢ <strong>{t('session_status.lifecycle.cancelled')}:</strong> {t('session_status.lifecycle.help.cancelled')}</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n\n      <NavigationGuardDialog\n        open={navigation.showGuard}\n        onDiscard={navigation.handleDiscardChanges}\n        onStay={navigation.handleStayOnModal}\n        onSaveAndExit={navigation.handleSaveAndExit}\n        message={navigation.message}\n      />\n    </AppSheetModal>\n  );\n}\n\ninterface EditSessionStatusDialogProps {\n  status: any;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onStatusUpdated: () => void;\n}\n\nexport function EditSessionStatusDialog({ status, open, onOpenChange, onStatusUpdated }: EditSessionStatusDialogProps) {\n  const { t } = useTranslation('forms');\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    color: \"#3B82F6\",\n    lifecycle: \"active\" as \"active\" | \"completed\" | \"cancelled\", // No \"archived\" for sessions\n  });\n\n  useEffect(() => {\n    if (status && open) {\n      setFormData({\n        name: status.name,\n        color: status.color,\n        lifecycle: status.lifecycle || \"active\",\n      });\n    }\n  }, [status, open]);\n\n  const handleSubmit = async () => {\n    if (!status) return;\n    if (!formData.name.trim()) {\n      toast({\n        title: t('common:errors.validation'),\n        description: t('session_status.errors.name_required'),\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const { error } = await supabase\n        .from('session_statuses')\n        .update({\n          name: formData.name.trim(),\n          color: formData.color,\n          lifecycle: formData.lifecycle,\n        })\n        .eq('id', status.id);\n\n      if (error) throw error;\n\n      toast({\n        title: t('common:success.updated'),\n        description: t('session_status.success.updated')\n      });\n\n      onOpenChange(false);\n      onStatusUpdated();\n    } catch (error: any) {\n      toast({\n        title: t('common:errors.save'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isDirty = status ? Boolean(\n    formData.name !== status.name ||\n    formData.color !== status.color ||\n    formData.lifecycle !== (status.lifecycle || \"active\")\n  ) : false;\n\n  const navigation = useModalNavigation({\n    isDirty,\n    onDiscard: () => {\n      onOpenChange(false);\n    },\n    onSaveAndExit: async () => {\n      await handleSubmit();\n    }\n  });\n\n  if (!status) return null;\n\n  const handleDirtyClose = () => {\n    const canClose = navigation.handleModalClose();\n    if (canClose) {\n      onOpenChange(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!status) return;\n    \n    // Check if it's a system required status\n    if (status.is_system_required) {\n      toast({\n        title: t('common:errors.delete'),\n        description: t('session_status.errors.cannot_delete'),\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    if (!window.confirm(t('session_status.confirm.delete'))) return;\n    \n    setLoading(true);\n    try {\n      const { error } = await supabase\n        .from('session_statuses')\n        .delete()\n        .eq('id', status.id);\n\n      if (error) throw error;\n\n      toast({\n        title: t('common:success.deleted'),\n        description: t('session_status.success.deleted')\n      });\n\n      onOpenChange(false);\n      onStatusUpdated();\n    } catch (error: any) {\n      toast({\n        title: t('common:errors.delete'),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isSystemRequired = Boolean(status.is_system_required);\n\n  const footerActions = [\n    // Only show delete for non-system-required stages\n    ...(!isSystemRequired ? [{\n      label: t('common:buttons.delete'),\n      onClick: handleDelete,\n      variant: \"destructive\" as const,\n      disabled: loading\n    }] : []),\n    {\n      label: t('common:buttons.cancel'),\n      onClick: handleDirtyClose,\n      variant: \"outline\" as const,\n      disabled: loading\n    },\n    {\n      label: loading ? t('buttons.saving') : t('common:buttons.save'),\n      onClick: handleSubmit,\n      disabled: loading || !formData.name.trim(),\n      loading: loading\n    }\n  ];\n\n  const colorOptions = [\n    \"#EF4444\", \"#F97316\", \"#EAB308\", \"#84CC16\", \"#22C55E\", \"#06B6D4\",\n    \"#3B82F6\", \"#6366F1\", \"#8B5CF6\", \"#A855F7\", \"#EC4899\", \"#64748B\"\n  ];\n\n  return (\n    <AppSheetModal\n      title={t('session_status.edit_title')}\n      isOpen={open}\n      onOpenChange={onOpenChange}\n      size=\"content\"\n      dirty={isDirty}\n      onDirtyClose={handleDirtyClose}\n      footerActions={footerActions}\n    >\n      <div className=\"space-y-6\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"name\">{t('session_status.name_label')}</Label>\n          <Input\n            id=\"name\"\n            value={formData.name}\n            onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n            placeholder={t('session_status.name_placeholder')}\n            maxLength={50}\n            className=\"rounded-xl\"\n          />\n          {isSystemRequired && (\n            <p className=\"text-sm text-muted-foreground\">\n              {t('session_status.system_required_note')}\n            </p>\n          )}\n        </div>\n\n        <div className=\"space-y-3\">\n          <Label>{t('session_status.color_label')}</Label>\n          <div className=\"grid grid-cols-6 gap-3 p-2\">\n            {colorOptions.map((color) => (\n              <button\n                key={color}\n                type=\"button\"\n                onClick={() => setFormData(prev => ({ ...prev, color }))}\n                className={`w-10 h-10 rounded-full border-4 transition-all ${\n                  formData.color === color \n                    ? 'border-gray-900 scale-110' \n                    : 'border-transparent hover:scale-105'\n                }`}\n                style={{ backgroundColor: color }}\n              />\n            ))}\n          </div>\n        </div>\n\n        {/* Only show lifecycle selector for non-system-required stages */}\n        {!isSystemRequired && (\n          <div className=\"space-y-3\">\n            <Label>{t('session_status.lifecycle.label')}</Label>\n            <SegmentedControl\n              size=\"md\"\n              value={formData.lifecycle}\n              onValueChange={(value) =>\n                setFormData(prev => ({ ...prev, lifecycle: value as typeof prev.lifecycle }))\n              }\n              options={[\n                { value: \"active\", label: t('session_status.lifecycle.active') },\n                { value: \"completed\", label: t('session_status.lifecycle.completed') },\n                { value: \"cancelled\", label: t('session_status.lifecycle.cancelled') },\n              ]}\n              className=\"mt-2 w-full justify-between\"\n            />\n            <div className=\"space-y-1 text-sm text-muted-foreground\">\n              <p>{t('session_status.lifecycle.help.title')}</p>\n              <ul className=\"space-y-1 ml-4\">\n                <li>â€¢ <strong>{t('session_status.lifecycle.active')}:</strong> {t('session_status.lifecycle.help.active')}</li>\n                <li>â€¢ <strong>{t('session_status.lifecycle.completed')}:</strong> {t('session_status.lifecycle.help.completed')}</li>\n                <li>â€¢ <strong>{t('session_status.lifecycle.cancelled')}:</strong> {t('session_status.lifecycle.help.cancelled')}</li>\n              </ul>\n            </div>\n          </div>\n        )}\n\n        {/* Show info for system required stages */}\n        {isSystemRequired && (\n          <div className=\"p-3 bg-blue-50 border border-blue-200 rounded-lg\">\n            <p className=\"text-sm text-blue-800\">\n              <strong>{t('session_status.lifecycle.active')}:</strong> {t('session_status.system_required_info')}\n            </p>\n          </div>\n        )}\n      </div>\n\n      <NavigationGuardDialog\n        open={navigation.showGuard}\n        onDiscard={navigation.handleDiscardChanges}\n        onStay={navigation.handleStayOnModal}\n        onSaveAndExit={navigation.handleSaveAndExit}\n        message={navigation.message}\n      />\n    </AppSheetModal>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/SessionTypeDialogs.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5890,5893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5890,5893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":467,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":467,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15403,15406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15403,15406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\nimport { AppSheetModal } from \"@/components/ui/app-sheet-modal\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\nimport { useModalNavigation } from \"@/hooks/useModalNavigation\";\nimport { NavigationGuardDialog } from \"./NavigationGuardDialog\";\n\nexport interface SessionType {\n  id: string;\n  organization_id: string;\n  user_id: string;\n  name: string;\n  description: string | null;\n  category: string | null;\n  duration_minutes: number;\n  is_active: boolean;\n  sort_order: number;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface DurationOption {\n  value: string;\n  minutes: number | null;\n  labelKey: string;\n}\n\nconst SESSION_DURATION_OPTIONS: DurationOption[] = [\n  { value: \"30\", minutes: 30, labelKey: \"sessionType.durationOptions.30m\" },\n  { value: \"45\", minutes: 45, labelKey: \"sessionType.durationOptions.45m\" },\n  { value: \"60\", minutes: 60, labelKey: \"sessionType.durationOptions.60m\" },\n  { value: \"90\", minutes: 90, labelKey: \"sessionType.durationOptions.90m\" },\n  { value: \"120\", minutes: 120, labelKey: \"sessionType.durationOptions.120m\" },\n  { value: \"180\", minutes: 180, labelKey: \"sessionType.durationOptions.180m\" },\n  { value: \"240\", minutes: 240, labelKey: \"sessionType.durationOptions.240m\" },\n  { value: \"480\", minutes: 480, labelKey: \"sessionType.durationOptions.480m\" },\n  { value: \"custom\", minutes: null, labelKey: \"sessionType.durationOptions.custom\" },\n];\n\nconst DEFAULT_FORM_STATE = {\n  name: \"\",\n  category: \"\",\n  description: \"\",\n  durationOption: \"60\",\n  customDuration: \"\",\n  isActive: true,\n  setAsDefault: false,\n};\n\ninterface BaseDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\ninterface AddSessionTypeDialogProps extends BaseDialogProps {\n  onSessionTypeAdded: (payload: { sessionType: SessionType; setAsDefault: boolean }) => void;\n  nextSortOrder: number;\n}\n\ninterface EditSessionTypeDialogProps extends BaseDialogProps {\n  sessionType: SessionType | null;\n  defaultSessionTypeId: string | null;\n  onSessionTypeUpdated: (payload: {\n    sessionType: SessionType;\n    setAsDefault: boolean;\n    wasDefault: boolean;\n  }) => void;\n}\n\nconst parseDuration = (option: string, customValue: string): number | null => {\n  if (option === \"custom\") {\n    const minutes = parseInt(customValue.trim(), 10);\n    return Number.isFinite(minutes) && minutes > 0 ? minutes : null;\n  }\n  const fromPreset = SESSION_DURATION_OPTIONS.find((opt) => opt.value === option);\n  return fromPreset?.minutes ?? null;\n};\n\nconst getDurationOptionForMinutes = (minutes: number): { option: string; customValue: string } => {\n  const presetOption = SESSION_DURATION_OPTIONS.find(\n    (opt) => opt.minutes !== null && opt.minutes === minutes\n  );\n\n  if (presetOption) {\n    return { option: presetOption.value, customValue: \"\" };\n  }\n\n  return { option: \"custom\", customValue: minutes.toString() };\n};\n\nexport function AddSessionTypeDialog({\n  open,\n  onOpenChange,\n  onSessionTypeAdded,\n  nextSortOrder,\n}: AddSessionTypeDialogProps) {\n  const { t } = useTranslation([\"forms\", \"common\"]);\n  const { toast } = useToast();\n  const [loading, setLoading] = useState(false);\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [formData, setFormData] = useState({ ...DEFAULT_FORM_STATE });\n\n  useEffect(() => {\n    if (open) {\n      setFormData({ ...DEFAULT_FORM_STATE });\n      setErrors({});\n    }\n  }, [open]);\n\n  const validate = () => {\n    const newErrors: Record<string, string> = {};\n\n    if (!formData.name.trim()) {\n      newErrors.name = t(\"sessionType.errors.name_required\", { ns: \"forms\" });\n    }\n\n    const minutes = parseDuration(formData.durationOption, formData.customDuration);\n    if (!minutes) {\n      newErrors.duration = t(\"sessionType.errors.duration_required\", { ns: \"forms\" });\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = async () => {\n    if (!validate()) return;\n\n    try {\n      setLoading(true);\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error(\"Not authenticated\");\n\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) throw new Error(\"Organization required\");\n\n      const durationMinutes = parseDuration(formData.durationOption, formData.customDuration);\n      if (!durationMinutes) throw new Error(\"Duration invalid\");\n\n      const { data, error } = await supabase\n        .from(\"session_types\")\n        .insert({\n          user_id: user.id,\n          organization_id: organizationId,\n          name: formData.name.trim(),\n          description: formData.description.trim() || null,\n          category: formData.category.trim() || null,\n          duration_minutes: durationMinutes,\n          is_active: formData.isActive,\n          sort_order: nextSortOrder,\n        })\n        .select(\"*\")\n        .single();\n\n      if (error) throw error;\n      if (!data) throw new Error(\"Failed to load created session type\");\n      const createdSessionType = data as SessionType;\n\n      toast({\n        title: t(\"common.toast.success\"),\n        description: t(\"sessionTypes.success.added\", { ns: \"forms\" }),\n      });\n\n      onSessionTypeAdded({\n        sessionType: createdSessionType,\n        setAsDefault: formData.setAsDefault,\n      });\n      onOpenChange(false);\n    } catch (error: any) {\n      console.error(\"Error creating session type:\", error);\n      toast({\n        title: t(\"common.toast.error\"),\n        description: error.message || t(\"sessionTypes.errors.add_failed\", { ns: \"forms\" }),\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isDirty = useMemo(() => {\n    return (\n      formData.name.trim() !== \"\" ||\n      formData.category.trim() !== \"\" ||\n      formData.description.trim() !== \"\" ||\n      formData.durationOption !== DEFAULT_FORM_STATE.durationOption ||\n      formData.customDuration.trim() !== \"\" ||\n      formData.isActive !== DEFAULT_FORM_STATE.isActive ||\n      formData.setAsDefault !== DEFAULT_FORM_STATE.setAsDefault\n    );\n  }, [formData]);\n\n  const navigation = useModalNavigation({\n    isDirty,\n    onDiscard: () => {\n      setFormData({ ...DEFAULT_FORM_STATE });\n      setErrors({});\n      onOpenChange(false);\n    },\n    onSaveAndExit: async () => {\n      await handleSubmit();\n    }\n  });\n\n  const handleDirtyClose = () => {\n    const canClose = navigation.handleModalClose();\n    if (canClose) {\n      setFormData({ ...DEFAULT_FORM_STATE });\n      setErrors({});\n      onOpenChange(false);\n    }\n  };\n\n  const footerActions = [\n    {\n      label: t(\"buttons.cancel\", { ns: \"common\" }),\n      onClick: handleDirtyClose,\n      variant: \"outline\" as const,\n      disabled: loading,\n    },\n    {\n      label: loading ? t(\"actions.saving\", { ns: \"common\" }) : t(\"buttons.save\", { ns: \"common\" }),\n      onClick: handleSubmit,\n      disabled: loading,\n      loading,\n    },\n  ];\n\n  return (\n    <AppSheetModal\n      title={t(\"sessionType.add_title\", { ns: \"forms\" })}\n      isOpen={open}\n      onOpenChange={onOpenChange}\n      size=\"content\"\n      dirty={isDirty}\n      onDirtyClose={handleDirtyClose}\n      footerActions={footerActions}\n    >\n      <div className=\"space-y-5\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"session-type-name\">\n            {t(\"sessionType.name_label\", { ns: \"forms\" })} *\n          </Label>\n          <Input\n            id=\"session-type-name\"\n            value={formData.name}\n            onChange={(event) =>\n              setFormData((prev) => ({ ...prev, name: event.target.value }))\n            }\n            placeholder={t(\"sessionType.name_placeholder\", { ns: \"forms\" })}\n          />\n          {errors.name && <p className=\"text-sm text-destructive\">{errors.name}</p>}\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"session-type-category\">\n            {t(\"sessionType.category_label\", { ns: \"forms\" })}\n          </Label>\n          <Input\n            id=\"session-type-category\"\n            value={formData.category}\n            onChange={(event) =>\n              setFormData((prev) => ({ ...prev, category: event.target.value }))\n            }\n            placeholder={t(\"sessionType.category_placeholder\", { ns: \"forms\" })}\n          />\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label>{t(\"sessionType.duration_label\", { ns: \"forms\" })} *</Label>\n          <Select\n            value={formData.durationOption}\n            onValueChange={(value) =>\n              setFormData((prev) => ({\n                ...prev,\n                durationOption: value,\n                customDuration: value === \"custom\" ? prev.customDuration : \"\",\n              }))\n            }\n          >\n            <SelectTrigger>\n              <SelectValue placeholder={t(\"sessionType.duration_placeholder\", { ns: \"forms\" })} />\n            </SelectTrigger>\n            <SelectContent>\n              {SESSION_DURATION_OPTIONS.map((option) => (\n                <SelectItem key={option.value} value={option.value}>\n                  {t(option.labelKey, { ns: \"forms\" })}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n          {formData.durationOption === \"custom\" && (\n            <Input\n              className=\"mt-2\"\n              type=\"number\"\n              min={1}\n              value={formData.customDuration}\n              onChange={(event) =>\n                setFormData((prev) => ({ ...prev, customDuration: event.target.value }))\n              }\n              placeholder={t(\"sessionType.custom_duration_placeholder\", { ns: \"forms\" })}\n            />\n          )}\n          {errors.duration && <p className=\"text-sm text-destructive\">{errors.duration}</p>}\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"session-type-description\">\n            {t(\"sessionType.description_label\", { ns: \"forms\" })}\n          </Label>\n          <Textarea\n            id=\"session-type-description\"\n            value={formData.description}\n            onChange={(event) =>\n              setFormData((prev) => ({ ...prev, description: event.target.value }))\n            }\n            placeholder={t(\"sessionType.description_placeholder\", { ns: \"forms\" })}\n            rows={3}\n          />\n        </div>\n\n        <div className=\"flex flex-col gap-4\">\n          <div className=\"flex items-center justify-between rounded-md border p-3\">\n            <div>\n              <p className=\"text-sm font-medium\">\n                {t(\"sessionType.default_label\", { ns: \"forms\" })}\n              </p>\n              <p className=\"text-xs text-muted-foreground\">\n                {t(\"sessionType.default_hint\", { ns: \"forms\" })}\n              </p>\n            </div>\n            <Switch\n              checked={formData.setAsDefault}\n              onCheckedChange={(value) =>\n                setFormData((prev) => ({ ...prev, setAsDefault: value }))\n              }\n            />\n          </div>\n\n          <div className=\"flex items-center justify-between rounded-md border p-3\">\n            <div>\n              <p className=\"text-sm font-medium\">\n                {t(\"sessionType.active_label\", { ns: \"forms\" })}\n              </p>\n              <p className=\"text-xs text-muted-foreground\">\n                {t(\"sessionType.active_hint\", { ns: \"forms\" })}\n              </p>\n            </div>\n            <Switch\n              checked={formData.isActive}\n              onCheckedChange={(value) =>\n                setFormData((prev) => ({ ...prev, isActive: value }))\n              }\n            />\n          </div>\n        </div>\n      </div>\n      <NavigationGuardDialog\n        open={navigation.showGuard}\n        onDiscard={navigation.handleDiscardChanges}\n        onStay={navigation.handleStayOnModal}\n        onSaveAndExit={navigation.handleSaveAndExit}\n        message={navigation.message}\n      />\n    </AppSheetModal>\n  );\n}\n\nexport function EditSessionTypeDialog({\n  open,\n  onOpenChange,\n  sessionType,\n  defaultSessionTypeId,\n  onSessionTypeUpdated,\n}: EditSessionTypeDialogProps) {\n  const { t } = useTranslation([\"forms\", \"common\"]);\n  const { toast } = useToast();\n  const [loading, setLoading] = useState(false);\n  const [errors, setErrors] = useState<Record<string, string>>({});\n\n  const [formData, setFormData] = useState({ ...DEFAULT_FORM_STATE });\n\n  useEffect(() => {\n    if (open && sessionType) {\n      const durationMeta = getDurationOptionForMinutes(sessionType.duration_minutes);\n      setFormData({\n        name: sessionType.name,\n        category: sessionType.category ?? \"\",\n        description: sessionType.description ?? \"\",\n        durationOption: durationMeta.option,\n        customDuration: durationMeta.customValue,\n        isActive: sessionType.is_active,\n        setAsDefault: sessionType.id === defaultSessionTypeId,\n      });\n      setErrors({});\n    }\n  }, [open, sessionType, defaultSessionTypeId]);\n\n  const validate = () => {\n    const newErrors: Record<string, string> = {};\n\n    if (!formData.name.trim()) {\n      newErrors.name = t(\"sessionType.errors.name_required\", { ns: \"forms\" });\n    }\n\n    const minutes = parseDuration(formData.durationOption, formData.customDuration);\n    if (!minutes) {\n      newErrors.duration = t(\"sessionType.errors.duration_required\", { ns: \"forms\" });\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = async () => {\n    if (!validate()) return;\n\n    try {\n      setLoading(true);\n      const durationMinutes = parseDuration(formData.durationOption, formData.customDuration);\n      if (!durationMinutes) throw new Error(\"Duration invalid\");\n\n      const { data, error } = await supabase\n        .from(\"session_types\")\n        .update({\n          name: formData.name.trim(),\n          description: formData.description.trim() || null,\n          category: formData.category.trim() || null,\n          duration_minutes: durationMinutes,\n          is_active: formData.isActive,\n        })\n        .eq(\"id\", sessionType.id)\n        .select(\"*\")\n        .single();\n\n      if (error) throw error;\n      const updatedSessionType =\n        (data as SessionType | null) ??\n        ({\n          ...sessionType,\n          name: formData.name.trim(),\n          description: formData.description.trim() || null,\n          category: formData.category.trim() || null,\n          duration_minutes: durationMinutes,\n          is_active: formData.isActive,\n        } as SessionType);\n\n      toast({\n        title: t(\"common.toast.success\"),\n        description: t(\"sessionTypes.success.updated\", { ns: \"forms\" }),\n      });\n\n      onSessionTypeUpdated({\n        sessionType: updatedSessionType,\n        setAsDefault: formData.setAsDefault,\n        wasDefault: sessionType.id === defaultSessionTypeId,\n      });\n      onOpenChange(false);\n    } catch (error: any) {\n      console.error(\"Error updating session type:\", error);\n      toast({\n        title: t(\"common.toast.error\"),\n        description: error.message || t(\"sessionTypes.errors.update_failed\", { ns: \"forms\" }),\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const isDirty = useMemo(() => {\n    if (!sessionType) return false;\n    const durationMinutes = parseDuration(formData.durationOption, formData.customDuration);\n    return (\n      formData.name.trim() !== sessionType.name ||\n      (formData.category.trim() || \"\") !== (sessionType.category ?? \"\") ||\n      (formData.description.trim() || \"\") !== (sessionType.description ?? \"\") ||\n      durationMinutes !== sessionType.duration_minutes ||\n      formData.isActive !== sessionType.is_active ||\n      formData.setAsDefault !== (sessionType.id === defaultSessionTypeId)\n    );\n  }, [formData, sessionType, defaultSessionTypeId]);\n\n  const navigation = useModalNavigation({\n    isDirty,\n    onDiscard: () => {\n      if (sessionType) {\n        const durationMeta = getDurationOptionForMinutes(sessionType.duration_minutes);\n        setFormData({\n          name: sessionType.name,\n          category: sessionType.category ?? \"\",\n          description: sessionType.description ?? \"\",\n          durationOption: durationMeta.option,\n          customDuration: durationMeta.customValue,\n          isActive: sessionType.is_active,\n          setAsDefault: sessionType.id === defaultSessionTypeId,\n        });\n        setErrors({});\n      }\n      onOpenChange(false);\n    },\n    onSaveAndExit: async () => {\n      await handleSubmit();\n    }\n  });\n\n  const handleDirtyClose = () => {\n    const canClose = navigation.handleModalClose();\n    if (canClose) {\n      if (sessionType) {\n        const durationMeta = getDurationOptionForMinutes(sessionType.duration_minutes);\n        setFormData({\n          name: sessionType.name,\n          category: sessionType.category ?? \"\",\n          description: sessionType.description ?? \"\",\n          durationOption: durationMeta.option,\n          customDuration: durationMeta.customValue,\n          isActive: sessionType.is_active,\n          setAsDefault: sessionType.id === defaultSessionTypeId,\n        });\n        setErrors({});\n      }\n      onOpenChange(false);\n    }\n  };\n\n  if (!sessionType) return null;\n\n  const footerActions = [\n    {\n      label: t(\"buttons.cancel\", { ns: \"common\" }),\n      onClick: handleDirtyClose,\n      variant: \"outline\" as const,\n      disabled: loading,\n    },\n    {\n      label: loading ? t(\"actions.saving\", { ns: \"common\" }) : t(\"buttons.save\", { ns: \"common\" }),\n      onClick: handleSubmit,\n      disabled: loading,\n      loading,\n    },\n  ];\n\n  return (\n    <AppSheetModal\n      title={t(\"sessionType.edit_title\", { ns: \"forms\" })}\n      isOpen={open}\n      onOpenChange={onOpenChange}\n      size=\"content\"\n      dirty={isDirty}\n      onDirtyClose={handleDirtyClose}\n      footerActions={footerActions}\n    >\n      <div className=\"space-y-5\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"session-type-name-edit\">\n            {t(\"sessionType.name_label\", { ns: \"forms\" })} *\n          </Label>\n          <Input\n            id=\"session-type-name-edit\"\n            value={formData.name}\n            onChange={(event) =>\n              setFormData((prev) => ({ ...prev, name: event.target.value }))\n            }\n          />\n          {errors.name && <p className=\"text-sm text-destructive\">{errors.name}</p>}\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"session-type-category-edit\">\n            {t(\"sessionType.category_label\", { ns: \"forms\" })}\n          </Label>\n          <Input\n            id=\"session-type-category-edit\"\n            value={formData.category}\n            onChange={(event) =>\n              setFormData((prev) => ({ ...prev, category: event.target.value }))\n            }\n          />\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label>{t(\"sessionType.duration_label\", { ns: \"forms\" })} *</Label>\n          <Select\n            value={formData.durationOption}\n            onValueChange={(value) =>\n              setFormData((prev) => ({\n                ...prev,\n                durationOption: value,\n                customDuration: value === \"custom\" ? prev.customDuration : \"\",\n              }))\n            }\n          >\n            <SelectTrigger>\n              <SelectValue placeholder={t(\"sessionType.duration_placeholder\", { ns: \"forms\" })} />\n            </SelectTrigger>\n            <SelectContent>\n              {SESSION_DURATION_OPTIONS.map((option) => (\n                <SelectItem key={option.value} value={option.value}>\n                  {t(option.labelKey, { ns: \"forms\" })}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n          {formData.durationOption === \"custom\" && (\n            <Input\n              className=\"mt-2\"\n              type=\"number\"\n              min={1}\n              value={formData.customDuration}\n              onChange={(event) =>\n                setFormData((prev) => ({ ...prev, customDuration: event.target.value }))\n              }\n              placeholder={t(\"sessionType.custom_duration_placeholder\", { ns: \"forms\" })}\n            />\n          )}\n          {errors.duration && <p className=\"text-sm text-destructive\">{errors.duration}</p>}\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"session-type-description-edit\">\n            {t(\"sessionType.description_label\", { ns: \"forms\" })}\n          </Label>\n          <Textarea\n            id=\"session-type-description-edit\"\n            value={formData.description}\n            onChange={(event) =>\n              setFormData((prev) => ({ ...prev, description: event.target.value }))\n            }\n            rows={3}\n          />\n        </div>\n\n        <div className=\"flex flex-col gap-4\">\n          <div className=\"flex items-center justify-between rounded-md border p-3\">\n            <div>\n              <p className=\"text-sm font-medium\">\n                {t(\"sessionType.default_label\", { ns: \"forms\" })}\n              </p>\n              <p className=\"text-xs text-muted-foreground\">\n                {t(\"sessionType.default_hint\", { ns: \"forms\" })}\n              </p>\n            </div>\n            <Switch\n              checked={formData.setAsDefault}\n              onCheckedChange={(value) =>\n                setFormData((prev) => ({ ...prev, setAsDefault: value }))\n              }\n            />\n          </div>\n\n          <div className=\"flex items-center justify-between rounded-md border p-3\">\n            <div>\n              <p className=\"text-sm font-medium\">\n                {t(\"sessionType.active_label\", { ns: \"forms\" })}\n              </p>\n              <p className=\"text-xs text-muted-foreground\">\n                {t(\"sessionType.active_hint\", { ns: \"forms\" })}\n              </p>\n            </div>\n            <Switch\n              checked={formData.isActive}\n              onCheckedChange={(value) =>\n                setFormData((prev) => ({ ...prev, isActive: value }))\n              }\n            />\n          </div>\n        </div>\n      </div>\n      <NavigationGuardDialog\n        open={navigation.showGuard}\n        onDiscard={navigation.handleDiscardChanges}\n        onStay={navigation.handleStayOnModal}\n        onSaveAndExit={navigation.handleSaveAndExit}\n        message={navigation.message}\n      />\n    </AppSheetModal>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/SettingsHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/SettingsHelpButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/SettingsHelpSheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/SettingsLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/SettingsPageWrapper.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/SettingsStickyFooter.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useTranslation\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":24,"column":17,"nodeType":"Identifier","endLine":24,"endColumn":31}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Button } from \"@/components/ui/button\";\nimport { Loader2, Check } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useTranslation } from \"react-i18next\";\n\nexport interface SettingsStickyFooterProps {\n  show: boolean;\n  isSaving: boolean;\n  showSuccess?: boolean;\n  onSave: () => void;\n  onCancel: () => void;\n  className?: string;\n}\n\nexport function SettingsStickyFooter({\n  show,\n  isSaving,\n  showSuccess,\n  onSave,\n  onCancel,\n  className,\n}: SettingsStickyFooterProps) {\n  if (!show) return null;\n  const { t } = useTranslation(\"common\");\n\n  return (\n    <div\n      className={cn(\n        \"sticky bottom-0 left-0 right-0 z-10 border-t border-border/80 bg-card/95 backdrop-blur-md transition-all duration-200 ease-in-out\",\n        \"animate-in slide-in-from-bottom-2\",\n        className\n      )}\n    >\n      <div className=\"flex w-full items-center justify-end gap-2 px-4 py-4 sm:px-0\">\n        <Button\n          variant=\"ghost\"\n          onClick={onCancel}\n          disabled={isSaving}\n          className={cn(\n            \"h-9 min-w-[80px] rounded-md px-4 text-sm font-medium text-muted-foreground transition-colors\",\n            \"hover:bg-destructive/10 hover:text-destructive focus-visible:ring-destructive/40\"\n          )}\n        >\n          {t(\"buttons.cancel\")}\n        </Button>\n        <Button\n          onClick={onSave}\n          disabled={isSaving}\n          className={cn(\n            \"h-9 min-w-[128px] rounded-md px-4 text-sm font-semibold text-[hsl(var(--accent-900))]\",\n            \"bg-[hsl(var(--accent-200))] hover:bg-[hsl(var(--accent-300))] focus-visible:ring-[hsl(var(--accent-300))]\",\n            \"disabled:opacity-70\"\n          )}\n        >\n          {isSaving ? (\n            <>\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n              {t(\"actions.saving\")}\n            </>\n          ) : showSuccess ? (\n            <>\n              <Check className=\"h-4 w-4\" />\n              {t(\"toast.settingsSavedTitle\")}\n            </>\n          ) : (\n            t(\"buttons.save_changes\")\n          )}\n        </Button>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/SocialChannelsSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2125,2128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2125,2128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from '@/components/ui/alert-dialog';\nimport { \n  Globe, \n  Facebook, \n  Instagram, \n  Twitter, \n  Linkedin, \n  Youtube, \n  Plus, \n  Trash2,\n  GripVertical,\n  Music\n} from 'lucide-react';\nimport { DragDropContext, Droppable, Draggable, DropResult } from '@hello-pangea/dnd';\nimport { SocialChannel } from '@/hooks/useOrganizationSettings';\nimport { cn } from '@/lib/utils';\nimport { useTranslation } from 'react-i18next';\n\ninterface SocialChannelsSectionProps {\n  socialChannels: Record<string, SocialChannel>;\n  onUpdate: (channels: Record<string, SocialChannel>) => void;\n  isDirty: boolean;\n}\n\nconst PREDEFINED_PLATFORMS = [\n  { key: 'website', name: 'Website', icon: Globe },\n  { key: 'facebook', name: 'Facebook', icon: Facebook },\n  { key: 'instagram', name: 'Instagram', icon: Instagram },\n  { key: 'twitter', name: 'Twitter/X', icon: Twitter },\n  { key: 'linkedin', name: 'LinkedIn', icon: Linkedin },\n  { key: 'youtube', name: 'YouTube', icon: Youtube },\n  { key: 'tiktok', name: 'TikTok', icon: Music },\n];\n\nexport function SocialChannelsSection({ socialChannels, onUpdate, isDirty }: SocialChannelsSectionProps) {\n  const { t } = useTranslation('forms');\n  const [customPlatformName, setCustomPlatformName] = useState('');\n\n  const addPredefinedPlatform = (platformKey: string) => {\n    const platform = PREDEFINED_PLATFORMS.find(p => p.key === platformKey);\n    if (!platform || socialChannels[platformKey]) return;\n\n    const maxOrder = Math.max(0, ...Object.values(socialChannels).map(c => c.order || 0));\n    const newChannel: SocialChannel = {\n      name: platform.name,\n      url: '',\n      platform: platformKey as any,\n      enabled: true,\n      order: maxOrder + 1,\n    };\n\n    onUpdate({\n      ...socialChannels,\n      [platformKey]: newChannel\n    });\n  };\n\n  const addCustomPlatform = () => {\n    if (!customPlatformName.trim()) return;\n\n    const customKey = `custom_${Date.now()}`;\n    const maxOrder = Math.max(0, ...Object.values(socialChannels).map(c => c.order || 0));\n    const newChannel: SocialChannel = {\n      name: customPlatformName.trim(),\n      url: '',\n      platform: 'custom',\n      customPlatformName: customPlatformName.trim(),\n      enabled: true,\n      order: maxOrder + 1,\n    };\n\n    onUpdate({\n      ...socialChannels,\n      [customKey]: newChannel\n    });\n    setCustomPlatformName('');\n  };\n\n  const updateChannel = (key: string, updates: Partial<SocialChannel>) => {\n    onUpdate({\n      ...socialChannels,\n      [key]: { ...socialChannels[key], ...updates }\n    });\n  };\n\n  const removeChannel = (key: string) => {\n    const { [key]: removed, ...remaining } = socialChannels;\n    onUpdate(remaining);\n  };\n\n  const handleDragEnd = (result: DropResult) => {\n    if (!result.destination) return;\n\n    const sortedEntries = Object.entries(socialChannels)\n      .sort(([, a], [, b]) => (a.order || 0) - (b.order || 0));\n    \n    const [reorderedItem] = sortedEntries.splice(result.source.index, 1);\n    sortedEntries.splice(result.destination.index, 0, reorderedItem);\n\n    const reorderedChannels = Object.fromEntries(\n      sortedEntries.map(([key, channel], index) => [\n        key,\n        { ...channel, order: index }\n      ])\n    );\n    onUpdate(reorderedChannels);\n  };\n\n  const validateUrl = (url: string): boolean => {\n    try {\n      new URL(url);\n      return true;\n    } catch {\n      return false;\n    }\n  };\n\n  const getChannelIcon = (channel: SocialChannel) => {\n    const platform = PREDEFINED_PLATFORMS.find(p => p.key === channel.platform);\n    return platform?.icon || Globe;\n  };\n\n  const availablePlatforms = PREDEFINED_PLATFORMS.filter(\n    platform => !socialChannels[platform.key]\n  );\n\n  const channelEntries = Object.entries(socialChannels)\n    .sort(([, a], [, b]) => (a.order || 0) - (b.order || 0));\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Globe className=\"h-5 w-5\" />\n          {t('social_channels.title')}\n          {isDirty && <Badge variant=\"secondary\">{t('social_channels.unsaved_changes')}</Badge>}\n        </CardTitle>\n        <p className=\"text-sm text-muted-foreground\">\n          {t('social_channels.description')}\n        </p>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-4\">\n          {/* Existing Channels with Drag & Drop */}\n          {channelEntries.length > 0 && (\n            <DragDropContext onDragEnd={handleDragEnd}>\n              <Droppable droppableId=\"social-channels\">\n                {(provided) => (\n                  <div \n                    {...provided.droppableProps} \n                    ref={provided.innerRef}\n                    className=\"space-y-3\"\n                  >\n                    {channelEntries.map(([key, channel], index) => {\n                      const Icon = getChannelIcon(channel);\n                      const hasValidUrl = channel.url && validateUrl(channel.url);\n                      \n                      return (\n                        <Draggable key={key} draggableId={key} index={index}>\n                          {(provided, snapshot) => (\n                            <div\n                              ref={provided.innerRef}\n                              {...provided.draggableProps}\n                              className={cn(\n                                \"flex items-center gap-3 p-3 rounded-lg border bg-card transition-colors\",\n                                !hasValidUrl && channel.url && \"border-destructive/50 bg-destructive/5\",\n                                snapshot.isDragging && \"shadow-lg\"\n                              )}\n                            >\n                              <div \n                                {...provided.dragHandleProps}\n                                className=\"cursor-grab active:cursor-grabbing\"\n                              >\n                                <GripVertical className=\"h-4 w-4 text-muted-foreground\" />\n                              </div>\n                              \n                              <Icon className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n                              \n                              <div className=\"min-w-0 w-20 flex-shrink-0\">\n                                <span className=\"text-sm font-medium truncate block\">\n                                  {channel.customPlatformName || channel.name}\n                                </span>\n                              </div>\n                              \n                              <div className=\"flex-1\">\n                                <Input\n                                  placeholder={`https://${channel.platform === 'website' ? 'yourwebsite.com' : `${channel.platform}.com/yourprofile`}`}\n                                  value={channel.url}\n                                  onChange={(e) => updateChannel(key, { url: e.target.value })}\n                                  className={cn(\n                                    \"h-9 text-sm\",\n                                    !hasValidUrl && channel.url && \"border-destructive focus:ring-destructive\"\n                                  )}\n                                 />\n                                 {!hasValidUrl && channel.url && (\n                                   <p className=\"text-xs text-destructive mt-1\">{t('social_channels.url_invalid')}</p>\n                                 )}\n                               </div>\n                              \n                              <AlertDialog>\n                                <AlertDialogTrigger asChild>\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    className=\"text-destructive hover:text-destructive hover:bg-destructive/10 h-9 w-9 p-0 flex-shrink-0\"\n                                  >\n                                    <Trash2 className=\"h-4 w-4\" />\n                                  </Button>\n                                </AlertDialogTrigger>\n                                 <AlertDialogContent>\n                                   <AlertDialogHeader>\n                                     <AlertDialogTitle>{t('social_channels.remove_channel_title')}</AlertDialogTitle>\n                                     <AlertDialogDescription>\n                                       {t('social_channels.remove_channel_description', { name: channel.customPlatformName || channel.name })}\n                                     </AlertDialogDescription>\n                                   </AlertDialogHeader>\n                                   <AlertDialogFooter>\n                                     <AlertDialogCancel>{t('common:common.buttons.cancel')}</AlertDialogCancel>\n                                     <AlertDialogAction \n                                       onClick={() => removeChannel(key)}\n                                       className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                                     >\n                                       {t('social_channels.remove_button')}\n                                     </AlertDialogAction>\n                                   </AlertDialogFooter>\n                                 </AlertDialogContent>\n                              </AlertDialog>\n                            </div>\n                          )}\n                        </Draggable>\n                      );\n                    })}\n                    {provided.placeholder}\n                  </div>\n                )}\n              </Droppable>\n            </DragDropContext>\n          )}\n\n          {/* Empty State */}\n          {channelEntries.length === 0 && (\n            <div className=\"text-center py-6 text-muted-foreground\">\n              <Globe className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n              <p className=\"text-sm\">{t('social_channels.no_channels')}</p>\n              <p className=\"text-xs\">{t('social_channels.add_links_description')}</p>\n            </div>\n          )}\n\n          {/* Add Platform Buttons */}\n          {availablePlatforms.length > 0 && (\n            <div>\n              <Label className=\"text-sm font-medium mb-2 block\">{t('social_channels.add_platform')}</Label>\n              <div className=\"flex flex-wrap gap-2\">\n                {availablePlatforms.map((platform) => {\n                  const Icon = platform.icon;\n                  return (\n                    <Button\n                      key={platform.key}\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => addPredefinedPlatform(platform.key)}\n                      className=\"flex items-center gap-2 h-9\"\n                    >\n                      <Icon className=\"h-4 w-4\" />\n                      {platform.name}\n                    </Button>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* Add Custom Platform */}\n          <div className=\"flex gap-2\">\n            <Input\n              placeholder={t('social_channels.custom_platform_placeholder')}\n              value={customPlatformName}\n              onChange={(e) => setCustomPlatformName(e.target.value)}\n              onKeyPress={(e) => e.key === 'Enter' && addCustomPlatform()}\n              className=\"flex-1 h-9\"\n            />\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={addCustomPlatform}\n              disabled={!customPlatformName.trim()}\n              className=\"flex items-center gap-2 h-9\"\n            >\n              <Plus className=\"h-4 w-4\" />\n              {t('social_channels.add_custom')}\n            </Button>\n          </div>\n\n          {/* Helper Text */}\n          <div className=\"text-xs text-muted-foreground space-y-1\">\n            <p>â€¢ {t('social_channels.help_text.appear_in_emails')}</p>\n            <p>â€¢ {t('social_channels.help_text.drag_to_reorder')}</p>\n            <p>â€¢ {t('social_channels.help_text.valid_urls_only')}</p>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/TaxBillingSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/__tests__/LeadStatusDialogs.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1160,1163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1160,1163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1363,1366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1363,1366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1771,1774],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1771,1774],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1875,1878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1875,1878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":194,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6447,6450],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6447,6450],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { act, fireEvent, render, screen, waitFor } from \"@/utils/testUtils\";\nimport {\n  AddLeadStatusDialog,\n  EditLeadStatusDialog,\n} from \"../LeadStatusDialogs\";\n\nconst supabaseAuthGetUserMock = jest.fn();\nconst supabaseFromMock = jest.fn();\nconst getUserOrganizationIdMock = jest.fn();\nconst toastMock = jest.fn();\nconst useModalNavigationMock = jest.fn();\n\njest.mock(\"@/integrations/supabase/client\", () => ({\n  supabase: {\n    auth: {\n      getUser: (...args: unknown[]) => supabaseAuthGetUserMock(...args),\n    },\n    from: (...args: unknown[]) => supabaseFromMock(...args),\n  },\n}));\n\njest.mock(\"@/lib/organizationUtils\", () => ({\n  getUserOrganizationId: (...args: unknown[]) => getUserOrganizationIdMock(...args),\n}));\n\njest.mock(\"@/hooks/use-toast\", () => ({\n  toast: (...args: unknown[]) => toastMock(...args),\n  useToast: () => ({\n    toast: (...args: unknown[]) => toastMock(...args),\n  }),\n}));\n\njest.mock(\"@/hooks/useModalNavigation\", () => ({\n  useModalNavigation: (...args: unknown[]) => useModalNavigationMock(...args),\n}));\n\njest.mock(\"@/components/ui/app-sheet-modal\", () => ({\n  AppSheetModal: ({ title, isOpen, children, footerActions }: any) => {\n    if (!isOpen) return null;\n    return (\n      <div data-testid=\"app-sheet-modal\">\n        <h2>{title}</h2>\n        <div>{children}</div>\n        <div>\n          {footerActions?.map((action: any) => (\n            <button\n              key={action.label}\n              type=\"button\"\n              onClick={action.onClick}\n              disabled={action.disabled}\n            >\n              {action.label}\n            </button>\n          ))}\n        </div>\n      </div>\n    );\n  },\n}));\n\njest.mock(\"@/components/ui/segmented-control\", () => ({\n  SegmentedControl: ({ value, onValueChange, options }: any) => (\n    <div>\n      <div data-testid=\"lifecycle-value\">{value}</div>\n      {options?.map((option: any) => (\n        <button\n          key={option.value}\n          type=\"button\"\n          onClick={() => onValueChange(option.value)}\n        >\n          {option.label}\n        </button>\n      ))}\n    </div>\n  ),\n}));\n\njest.mock(\"../NavigationGuardDialog\", () => ({\n  NavigationGuardDialog: () => null,\n}));\n\nconst translations: Record<string, string> = {\n  \"forms:success.created\": \"Created\",\n  \"forms:success.updated\": \"Updated\",\n  \"forms:success.deleted\": \"Deleted\",\n  \"forms:buttons.save\": \"Save\",\n  \"forms:buttons.cancel\": \"Cancel\",\n  \"forms:buttons.delete\": \"Delete\",\n  \"forms:actions.saving\": \"Savingâ€¦\",\n  \"forms:errors.title\": \"Error\",\n  \"forms:lead_status.add_title\": \"Add lead status\",\n  \"forms:lead_status.edit_title\": \"Edit lead status\",\n  \"forms:lead_status.name_label\": \"Status name\",\n  \"forms:lead_status.name_placeholder\": \"Name placeholder\",\n  \"forms:lead_status.color_label\": \"Color\",\n  \"forms:lead_status.lifecycle.label\": \"Lifecycle\",\n  \"forms:lead_status.lifecycle.active\": \"Active\",\n  \"forms:lead_status.lifecycle.completed\": \"Completed\",\n  \"forms:lead_status.lifecycle.cancelled\": \"Cancelled\",\n  \"forms:lead_status.lifecycle.help.title\": \"Lifecycle help\",\n  \"forms:lead_status.lifecycle.help.active\": \"Active help\",\n  \"forms:lead_status.lifecycle.help.completed\": \"Completed help\",\n  \"forms:lead_status.lifecycle.help.cancelled\": \"Cancelled help\",\n  \"forms:lead_status.errors.name_required\": \"Name required\",\n  \"forms:lead_status.errors.add_failed\": \"Add failed\",\n  \"forms:lead_status.errors.update_failed\": \"Update failed\",\n  \"forms:lead_status.errors.delete_failed\": \"Delete failed\",\n  \"forms:lead_status.errors.cannot_delete\": \"Cannot delete\",\n  \"forms:lead_status.confirm.delete\": \"Delete lead status?\",\n  \"forms:lead_status.success.added\": \"Lead status created\",\n  \"forms:lead_status.success.updated\": \"Lead status updated\",\n  \"forms:lead_status.success.deleted\": \"Lead status deleted\",\n  \"forms:lead_status.system_required_note\": \"System required status\",\n  \"forms:lead_status.system_required_info\": \"System required info\",\n  \"common:buttons.cancel\": \"Cancel\",\n  \"common:buttons.save\": \"Save\",\n  \"common:buttons.add\": \"Add\",\n  \"common:buttons.delete\": \"Delete\",\n  \"common:actions.saving\": \"Savingâ€¦\",\n  \"common:errors.title\": \"Error\",\n  \"common:success.created\": \"Success\",\n  \"common:success.updated\": \"Success\",\n  \"common:success.deleted\": \"Success\",\n};\n\nconst resolveNamespace = (namespace?: string | string[], override?: string) => {\n  if (override) return override;\n  if (Array.isArray(namespace)) return namespace[0];\n  return namespace;\n};\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: (namespace?: string | string[]) => ({\n    t: (key: string, options?: { ns?: string }) => {\n      const resolvedNamespace = resolveNamespace(namespace, options?.ns);\n      const compositeKey = resolvedNamespace ? `${resolvedNamespace}:${key}` : key;\n      return translations[compositeKey] ?? translations[key] ?? compositeKey;\n    },\n  }),\n}));\n\nconst createLeadStatusesTable = ({\n  existingSort = 2,\n  insertError = null,\n  updateError = null,\n  deleteError = null,\n}: {\n  existingSort?: number | null;\n  insertError?: unknown;\n  updateError?: unknown;\n  deleteError?: unknown;\n} = {}) => {\n  const limitMock = jest.fn(async () => ({\n    data: existingSort === null ? [] : [{ sort_order: existingSort }],\n    error: null,\n  }));\n  const orderMock = jest.fn(() => ({ limit: limitMock }));\n  const selectEqMock = jest.fn(() => ({ order: orderMock }));\n  const selectMock = jest.fn(() => ({ eq: selectEqMock }));\n\n  const insertMock = jest.fn(async () => ({ error: insertError }));\n\n  const updateSecondEqMock = jest.fn(async () => ({ error: updateError }));\n  const updateEqMock = jest.fn(() => ({ eq: updateSecondEqMock }));\n  const updateMock = jest.fn(() => ({ eq: updateEqMock }));\n\n  const deleteSecondEqMock = jest.fn(async () => ({ error: deleteError }));\n  const deleteEqMock = jest.fn(() => ({ eq: deleteSecondEqMock }));\n  const deleteMock = jest.fn(() => ({ eq: deleteEqMock }));\n\n  return {\n    selectMock,\n    selectEqMock,\n    orderMock,\n    limitMock,\n    insertMock,\n    updateMock,\n    updateEqMock,\n    updateSecondEqMock,\n    deleteMock,\n    deleteEqMock,\n    deleteSecondEqMock,\n  };\n};\n\ndescribe(\"LeadStatusDialogs\", () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    supabaseAuthGetUserMock.mockResolvedValue({\n      data: { user: { id: \"user-1\" } },\n      error: null,\n    });\n    getUserOrganizationIdMock.mockResolvedValue(\"org-123\");\n    useModalNavigationMock.mockImplementation(({ onDiscard, onSaveAndExit }: any = {}) => ({\n      showGuard: false,\n      message: \"\",\n      handleModalClose: () => true,\n      handleDiscardChanges: () => onDiscard?.(),\n      handleStayOnModal: jest.fn(),\n      handleSaveAndExit: () => onSaveAndExit?.(),\n    }));\n  });\n\n  it(\"creates a new lead status and notifies listeners\", async () => {\n    const table = createLeadStatusesTable({ existingSort: 3 });\n    supabaseFromMock.mockImplementation((tableName: string) => {\n      if (tableName === \"lead_statuses\") {\n        return {\n          select: table.selectMock,\n          insert: table.insertMock,\n        };\n      }\n      throw new Error(`Unexpected table ${tableName}`);\n    });\n\n    const onStatusAdded = jest.fn();\n    const onOpenChange = jest.fn();\n\n    render(\n      <AddLeadStatusDialog\n        open\n        onOpenChange={onOpenChange}\n        onStatusAdded={onStatusAdded}\n      />\n    );\n\n    fireEvent.change(screen.getByLabelText(\"Status name\"), {\n      target: { value: \"Follow Up\" },\n    });\n\n    await act(async () => {\n      fireEvent.click(screen.getByRole(\"button\", { name: \"Add\" }));\n    });\n\n    await waitFor(() =>\n      expect(table.insertMock).toHaveBeenCalledWith(\n        expect.objectContaining({\n          name: \"Follow Up\",\n          lifecycle: \"active\",\n          sort_order: 4,\n        })\n      )\n    );\n\n    expect(onStatusAdded).toHaveBeenCalled();\n    expect(onOpenChange).toHaveBeenCalledWith(false);\n    expect(toastMock).toHaveBeenCalledWith(\n      expect.objectContaining({\n        title: \"Created\",\n        description: \"Lead status created\",\n      })\n    );\n  });\n\n  it(\"prevents submission when name is empty\", async () => {\n    const table = createLeadStatusesTable();\n    supabaseFromMock.mockImplementation(() => ({\n      select: table.selectMock,\n      insert: table.insertMock,\n    }));\n\n    render(\n      <AddLeadStatusDialog\n        open\n        onOpenChange={jest.fn()}\n        onStatusAdded={jest.fn()}\n      />\n    );\n\n    expect(screen.getByRole(\"button\", { name: \"Add\" })).toBeDisabled();\n    await waitFor(() => expect(table.insertMock).not.toHaveBeenCalled());\n  });\n\n  it(\"auto-selects lifecycle suggestions based on the name\", async () => {\n    const table = createLeadStatusesTable();\n    supabaseFromMock.mockImplementation(() => ({\n      select: table.selectMock,\n      insert: table.insertMock,\n    }));\n\n    render(\n      <AddLeadStatusDialog\n        open\n        onOpenChange={jest.fn()}\n        onStatusAdded={jest.fn()}\n      />\n    );\n\n    fireEvent.change(screen.getByLabelText(\"Status name\"), {\n      target: { value: \"Completed Project\" },\n    });\n\n    await waitFor(() =>\n      expect(screen.getByTestId(\"lifecycle-value\").textContent).toBe(\"completed\")\n    );\n  });\n\n  it(\"updates a lead status successfully\", async () => {\n    const table = createLeadStatusesTable();\n    supabaseFromMock.mockImplementation(() => ({\n      update: table.updateMock,\n    }));\n\n    const onStatusUpdated = jest.fn();\n    const onOpenChange = jest.fn();\n\n    render(\n      <EditLeadStatusDialog\n        open\n        status={{\n          id: \"status-1\",\n          name: \"Prospect\",\n          color: \"#3B82F6\",\n          lifecycle: \"active\",\n          is_system_required: false,\n        }}\n        onOpenChange={onOpenChange}\n        onStatusUpdated={onStatusUpdated}\n      />\n    );\n\n    fireEvent.change(screen.getByLabelText(\"Status name\"), {\n      target: { value: \"Qualified\" },\n    });\n\n    await act(async () => {\n      fireEvent.click(screen.getByRole(\"button\", { name: \"Save\" }));\n    });\n\n    expect(table.updateMock).toHaveBeenCalledWith(\n      expect.objectContaining({\n        name: \"Qualified\",\n        lifecycle: \"active\",\n      })\n    );\n    expect(table.updateEqMock).toHaveBeenCalledWith(\"id\", \"status-1\");\n    expect(onStatusUpdated).toHaveBeenCalled();\n    expect(onOpenChange).toHaveBeenCalledWith(false);\n    expect(toastMock).toHaveBeenCalledWith(\n      expect.objectContaining({\n        title: \"Updated\",\n        description: \"Lead status updated\",\n      })\n    );\n  });\n\n  it(\"hides the delete control for system required statuses\", () => {\n    supabaseFromMock.mockImplementation(() => ({}));\n\n    render(\n      <EditLeadStatusDialog\n        open\n        status={{\n          id: \"status-1\",\n          name: \"Initial\",\n          color: \"#3B82F6\",\n          lifecycle: \"active\",\n          is_system_required: true,\n        }}\n        onOpenChange={jest.fn()}\n        onStatusUpdated={jest.fn()}\n      />\n    );\n\n    expect(\n      screen.queryByRole(\"button\", { name: \"Delete\" })\n    ).not.toBeInTheDocument();\n  });\n\n  it(\"deletes a lead status when confirmed\", async () => {\n    const table = createLeadStatusesTable();\n    supabaseFromMock.mockImplementation(() => ({\n      delete: table.deleteMock,\n    }));\n\n    const onStatusUpdated = jest.fn();\n    const onOpenChange = jest.fn();\n\n    jest.spyOn(window, \"confirm\").mockReturnValue(true);\n\n    render(\n      <EditLeadStatusDialog\n        open\n        status={{\n          id: \"status-2\",\n          name: \"Lost\",\n          color: \"#222222\",\n          lifecycle: \"cancelled\",\n          is_system_required: false,\n        }}\n        onOpenChange={onOpenChange}\n        onStatusUpdated={onStatusUpdated}\n      />\n    );\n\n    await act(async () => {\n      fireEvent.click(screen.getByRole(\"button\", { name: \"Delete\" }));\n    });\n\n    await waitFor(() => expect(table.deleteMock).toHaveBeenCalled());\n    expect(table.deleteEqMock).toHaveBeenCalledWith(\"id\", \"status-2\");\n    expect(onStatusUpdated).toHaveBeenCalled();\n    expect(onOpenChange).toHaveBeenCalledWith(false);\n    expect(toastMock).toHaveBeenCalledWith(\n      expect.objectContaining({\n        title: \"Deleted\",\n        description: \"Lead status deleted\",\n      })\n    );\n\n    (window.confirm as jest.Mock).mockRestore();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/__tests__/NavigationGuardDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/__tests__/PackageDialogs.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/__tests__/ProjectStageDialogs.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1166,1169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1166,1169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1369,1372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1369,1372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1777,1780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1777,1780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1881,1884],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1881,1884],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":192,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6253,6256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6253,6256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { act, fireEvent, render, screen, waitFor } from \"@/utils/testUtils\";\nimport {\n  AddProjectStageDialog,\n  EditProjectStageDialog,\n} from \"../ProjectStageDialogs\";\n\nconst supabaseAuthGetUserMock = jest.fn();\nconst supabaseFromMock = jest.fn();\nconst getUserOrganizationIdMock = jest.fn();\nconst toastMock = jest.fn();\nconst useModalNavigationMock = jest.fn();\n\njest.mock(\"@/integrations/supabase/client\", () => ({\n  supabase: {\n    auth: {\n      getUser: (...args: unknown[]) => supabaseAuthGetUserMock(...args),\n    },\n    from: (...args: unknown[]) => supabaseFromMock(...args),\n  },\n}));\n\njest.mock(\"@/lib/organizationUtils\", () => ({\n  getUserOrganizationId: (...args: unknown[]) => getUserOrganizationIdMock(...args),\n}));\n\njest.mock(\"@/hooks/use-toast\", () => ({\n  toast: (...args: unknown[]) => toastMock(...args),\n  useToast: () => ({\n    toast: (...args: unknown[]) => toastMock(...args),\n  }),\n}));\n\njest.mock(\"@/hooks/useModalNavigation\", () => ({\n  useModalNavigation: (...args: unknown[]) => useModalNavigationMock(...args),\n}));\n\njest.mock(\"@/components/ui/app-sheet-modal\", () => ({\n  AppSheetModal: ({ title, isOpen, children, footerActions }: any) => {\n    if (!isOpen) return null;\n    return (\n      <div data-testid=\"app-sheet-modal\">\n        <h2>{title}</h2>\n        <div>{children}</div>\n        <div>\n          {footerActions?.map((action: any) => (\n            <button\n              key={action.label}\n              type=\"button\"\n              onClick={action.onClick}\n              disabled={action.disabled}\n            >\n              {action.label}\n            </button>\n          ))}\n        </div>\n      </div>\n    );\n  },\n}));\n\njest.mock(\"@/components/ui/segmented-control\", () => ({\n  SegmentedControl: ({ value, onValueChange, options }: any) => (\n    <div>\n      <div data-testid=\"lifecycle-value\">{value}</div>\n      {options?.map((option: any) => (\n        <button\n          key={option.value}\n          type=\"button\"\n          onClick={() => onValueChange(option.value)}\n        >\n          {option.label}\n        </button>\n      ))}\n    </div>\n  ),\n}));\n\njest.mock(\"../NavigationGuardDialog\", () => ({\n  NavigationGuardDialog: () => null,\n}));\n\nconst translations: Record<string, string> = {\n  \"forms:project_stage.add_title\": \"Add project stage\",\n  \"forms:project_stage.edit_title\": \"Edit project stage\",\n  \"forms:project_stage.name_label\": \"Stage name\",\n  \"forms:project_stage.name_placeholder\": \"Stage placeholder\",\n  \"forms:project_stage.color_label\": \"Color\",\n  \"forms:project_stage.lifecycle.label\": \"Lifecycle\",\n  \"forms:project_stage.lifecycle.active\": \"Active\",\n  \"forms:project_stage.lifecycle.completed\": \"Completed\",\n  \"forms:project_stage.lifecycle.cancelled\": \"Cancelled\",\n  \"forms:project_stage.lifecycle.help.title\": \"Lifecycle help\",\n  \"forms:project_stage.lifecycle.help.active\": \"Active help\",\n  \"forms:project_stage.lifecycle.help.completed\": \"Completed help\",\n  \"forms:project_stage.lifecycle.help.cancelled\": \"Cancelled help\",\n  \"forms:project_stage.errors.name_required\": \"Stage name required\",\n  \"forms:project_stage.errors.add_failed\": \"Add failed\",\n  \"forms:project_stage.errors.update_failed\": \"Update failed\",\n  \"forms:project_stage.errors.delete_failed\": \"Delete failed\",\n  \"forms:project_stage.errors.cannot_delete\": \"Cannot delete stage\",\n  \"forms:project_stage.confirm.delete\": \"Delete this stage?\",\n  \"forms:project_stage.success.added\": \"Project stage created\",\n  \"forms:project_stage.success.updated\": \"Project stage updated\",\n  \"forms:project_stage.success.deleted\": \"Project stage deleted\",\n  \"forms:success.created\": \"Success\",\n  \"forms:success.updated\": \"Success\",\n  \"forms:success.deleted\": \"Success\",\n  \"forms:buttons.add\": \"Add\",\n  \"forms:buttons.adding\": \"Addingâ€¦\",\n  \"forms:buttons.save\": \"Save\",\n  \"forms:buttons.cancel\": \"Cancel\",\n  \"forms:buttons.delete\": \"Delete\",\n  \"forms:actions.saving\": \"Savingâ€¦\",\n  \"forms:errors.title\": \"Error\",\n  \"common:buttons.cancel\": \"Cancel\",\n  \"common:buttons.save\": \"Save\",\n  \"common:buttons.delete\": \"Delete\",\n  \"common:actions.saving\": \"Savingâ€¦\",\n  \"common:success.created\": \"Success\",\n  \"common:success.updated\": \"Success\",\n  \"common:success.deleted\": \"Success\",\n};\n\nconst resolveNamespace = (namespace?: string | string[], override?: string) => {\n  if (override) return override;\n  if (Array.isArray(namespace)) return namespace[0];\n  return namespace;\n};\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: (namespace?: string | string[]) => ({\n    t: (key: string, options?: { ns?: string }) => {\n      const resolvedNamespace = resolveNamespace(namespace, options?.ns);\n      const compositeKey = resolvedNamespace ? `${resolvedNamespace}:${key}` : key;\n      return translations[compositeKey] ?? translations[key] ?? compositeKey;\n    },\n  }),\n}));\n\nconst createProjectStagesTable = ({\n  existingSort = 5,\n  insertError = null,\n  updateError = null,\n  deleteError = null,\n}: {\n  existingSort?: number | null;\n  insertError?: unknown;\n  updateError?: unknown;\n  deleteError?: unknown;\n} = {}) => {\n  const limitMock = jest.fn(async () => ({\n    data: existingSort === null ? [] : [{ sort_order: existingSort }],\n    error: null,\n  }));\n  const orderMock = jest.fn(() => ({ limit: limitMock }));\n  const selectEqMock = jest.fn(() => ({ order: orderMock }));\n  const selectMock = jest.fn(() => ({ eq: selectEqMock }));\n\n  const insertMock = jest.fn(async () => ({ error: insertError }));\n\n  const updateEqMock = jest.fn(() => ({\n    eq: jest.fn(async () => ({ error: updateError })),\n  }));\n  const updateMock = jest.fn(() => ({ eq: updateEqMock }));\n\n  const deleteEqMock = jest.fn(() => ({\n    eq: jest.fn(async () => ({ error: deleteError })),\n  }));\n  const deleteMock = jest.fn(() => ({ eq: deleteEqMock }));\n\n  return {\n    selectMock,\n    selectEqMock,\n    orderMock,\n    limitMock,\n    insertMock,\n    updateMock,\n    updateEqMock,\n    deleteMock,\n    deleteEqMock,\n  };\n};\n\ndescribe(\"ProjectStageDialogs\", () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    supabaseAuthGetUserMock.mockResolvedValue({\n      data: { user: { id: \"user-1\" } },\n      error: null,\n    });\n    getUserOrganizationIdMock.mockResolvedValue(\"org-123\");\n    useModalNavigationMock.mockImplementation(({ onDiscard, onSaveAndExit }: any = {}) => ({\n      showGuard: false,\n      message: \"\",\n      handleModalClose: () => true,\n      handleDiscardChanges: () => onDiscard?.(),\n      handleStayOnModal: jest.fn(),\n      handleSaveAndExit: () => onSaveAndExit?.(),\n    }));\n  });\n\n  it(\"creates a project stage successfully\", async () => {\n    const table = createProjectStagesTable();\n    supabaseFromMock.mockImplementation((tableName: string) => {\n      if (tableName === \"project_statuses\") {\n        return {\n          select: table.selectMock,\n          insert: table.insertMock,\n        };\n      }\n      throw new Error(`Unexpected table ${tableName}`);\n    });\n\n    const onStageAdded = jest.fn();\n    const onOpenChange = jest.fn();\n\n    render(\n      <AddProjectStageDialog\n        open\n        onOpenChange={onOpenChange}\n        onStageAdded={onStageAdded}\n      />\n    );\n\n    fireEvent.change(screen.getByLabelText(\"Stage name\"), {\n      target: { value: \"Production\" },\n    });\n\n    await act(async () => {\n      fireEvent.click(screen.getByRole(\"button\", { name: \"Add\" }));\n    });\n\n    await waitFor(() =>\n      expect(table.insertMock).toHaveBeenCalledWith(\n        expect.objectContaining({\n          name: \"Production\",\n          sort_order: 6,\n        })\n      )\n    );\n\n    expect(onStageAdded).toHaveBeenCalled();\n    expect(onOpenChange).toHaveBeenCalledWith(false);\n    expect(toastMock).toHaveBeenCalledWith(\n      expect.objectContaining({\n        title: \"Success\",\n        description: \"Project stage created\",\n      })\n    );\n  });\n\n  it(\"keeps save disabled when name is empty\", () => {\n    supabaseFromMock.mockImplementation(() => ({\n      select: jest.fn(() => ({ eq: jest.fn(() => ({ order: jest.fn(() => ({ limit: jest.fn(async () => ({ data: [], error: null })) })) })) })),\n      insert: jest.fn(),\n    }));\n\n    render(\n      <AddProjectStageDialog\n        open\n        onOpenChange={jest.fn()}\n        onStageAdded={jest.fn()}\n      />\n    );\n\n    expect(screen.getByRole(\"button\", { name: \"Add\" })).toBeDisabled();\n  });\n\n  it(\"promotes lifecycle suggestions based on name\", async () => {\n    supabaseFromMock.mockImplementation(() => ({\n      select: jest.fn(() => ({ eq: jest.fn(() => ({ order: jest.fn(() => ({ limit: jest.fn(async () => ({ data: [], error: null })) })) })) })),\n      insert: jest.fn(),\n    }));\n\n    render(\n      <AddProjectStageDialog\n        open\n        onOpenChange={jest.fn()}\n        onStageAdded={jest.fn()}\n      />\n    );\n\n    fireEvent.change(screen.getByLabelText(\"Stage name\"), {\n      target: { value: \"Final Delivery\" },\n    });\n\n    await waitFor(() =>\n      expect(screen.getByTestId(\"lifecycle-value\").textContent).toBe(\"completed\")\n    );\n  });\n\n  it(\"updates a project stage\", async () => {\n    const table = createProjectStagesTable();\n    supabaseFromMock.mockImplementation(() => ({\n      update: table.updateMock,\n    }));\n\n    const onStageUpdated = jest.fn();\n    const onOpenChange = jest.fn();\n\n    render(\n      <EditProjectStageDialog\n        open\n        stage={{\n          id: \"stage-1\",\n          name: \"Planning\",\n          color: \"#FF0000\",\n          lifecycle: \"active\",\n          is_system_required: false,\n        }}\n        onOpenChange={onOpenChange}\n        onStageUpdated={onStageUpdated}\n      />\n    );\n\n    fireEvent.change(screen.getByLabelText(\"Stage name\"), {\n      target: { value: \"Execution\" },\n    });\n\n    await act(async () => {\n      fireEvent.click(screen.getByRole(\"button\", { name: \"Save\" }));\n    });\n\n    expect(table.updateMock).toHaveBeenCalledWith(\n      expect.objectContaining({\n        name: \"Execution\",\n        color: \"#FF0000\",\n      })\n    );\n    expect(onStageUpdated).toHaveBeenCalled();\n    expect(onOpenChange).toHaveBeenCalledWith(false);\n    expect(toastMock).toHaveBeenCalledWith(\n      expect.objectContaining({\n        title: \"Success\",\n        description: \"Project stage updated\",\n      })\n    );\n  });\n\n  it(\"prevents deleting system required stages\", () => {\n    supabaseFromMock.mockImplementation(() => ({}));\n\n    render(\n      <EditProjectStageDialog\n        open\n        stage={{\n          id: \"stage-2\",\n          name: \"Initial\",\n          color: \"#FF0000\",\n          lifecycle: \"active\",\n          is_system_required: true,\n        }}\n        onOpenChange={jest.fn()}\n        onStageUpdated={jest.fn()}\n      />\n    );\n\n    expect(\n      screen.queryByRole(\"button\", { name: \"Delete\" })\n    ).not.toBeInTheDocument();\n  });\n\n  it(\"deletes a project stage when confirmed\", async () => {\n    const table = createProjectStagesTable();\n    supabaseFromMock.mockImplementation(() => ({\n      delete: table.deleteMock,\n    }));\n\n    const onStageUpdated = jest.fn();\n    const onOpenChange = jest.fn();\n    jest.spyOn(window, \"confirm\").mockReturnValue(true);\n\n    render(\n      <EditProjectStageDialog\n        open\n        stage={{\n          id: \"stage-3\",\n          name: \"Archive\",\n          color: \"#AA0000\",\n          lifecycle: \"cancelled\",\n          is_system_required: false,\n        }}\n        onOpenChange={onOpenChange}\n        onStageUpdated={onStageUpdated}\n      />\n    );\n\n    await act(async () => {\n      fireEvent.click(screen.getByRole(\"button\", { name: \"Delete\" }));\n    });\n\n    await waitFor(() => expect(table.deleteMock).toHaveBeenCalled());\n    expect(onStageUpdated).toHaveBeenCalled();\n    expect(onOpenChange).toHaveBeenCalledWith(false);\n    expect(toastMock).toHaveBeenCalledWith(\n      expect.objectContaining({\n        title: \"Success\",\n        description: \"Project stage deleted\",\n      })\n    );\n\n    (window.confirm as jest.Mock).mockRestore();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/__tests__/ProjectTypeDialogs.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/__tests__/ServiceDialogs.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/__tests__/SessionStatusDialogs.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/__tests__/SessionTypeDialogs.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/__tests__/SettingsHelpButton.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[363,366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[363,366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[614,617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[614,617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":34,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":34,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1007,1010],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1007,1010],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { fireEvent, render, screen } from \"@/utils/testUtils\";\nimport { SettingsHelpButton } from \"../SettingsHelpButton\";\n\nconst useIsMobileMock = jest.fn();\nconst appSheetModalMock = jest.fn();\n\njest.mock(\"@/hooks/use-mobile\", () => ({\n  useIsMobile: () => useIsMobileMock(),\n}));\n\njest.mock(\"@/components/ui/app-sheet-modal\", () => ({\n  AppSheetModal: (props: any) => {\n    appSheetModalMock(props);\n    if (!props.isOpen) {\n      return null;\n    }\n\n    return (\n      <div data-testid=\"help-modal\">\n        <h2>{props.title}</h2>\n        <div>{props.children}</div>\n        {props.footerActions?.map((action: any) => (\n          <button key={action.label} onClick={action.onClick}>\n            {action.label}\n          </button>\n        ))}\n        <button onClick={() => props.onOpenChange(false)}>Close</button>\n      </div>\n    );\n  },\n}));\n\njest.mock(\"lucide-react\", () => {\n  const React = require(\"react\");\n  return new Proxy(\n    {},\n    {\n      get: (_target, property: PropertyKey) => (props: any) =>\n        React.createElement(\"svg\", {\n          \"data-icon\": String(property),\n          ...props,\n        }),\n    }\n  );\n});\n\ndescribe(\"SettingsHelpButton\", () => {\n  const helpContent = {\n    title: \"Settings Help\",\n    description: \"Need some assistance?\",\n    sections: [\n      { title: \"Overview\", content: \"Details about settings.\" },\n      { title: \"Tips\", content: \"Useful best practices.\" },\n    ],\n  };\n\n  let windowOpenSpy: jest.SpyInstance;\n\n  beforeEach(() => {\n    useIsMobileMock.mockReturnValue(false);\n    appSheetModalMock.mockClear();\n    windowOpenSpy = jest.spyOn(window, \"open\").mockImplementation(() => null);\n  });\n\n  afterEach(() => {\n    windowOpenSpy.mockRestore();\n  });\n\n  it(\"opens help modal and triggers footer actions on desktop\", async () => {\n    render(<SettingsHelpButton helpContent={helpContent} />);\n\n    fireEvent.click(screen.getByRole(\"button\", { name: \"Need Help?\" }));\n\n    expect(await screen.findByTestId(\"help-modal\")).toBeInTheDocument();\n    expect(screen.getByText(\"Settings Help\")).toBeInTheDocument();\n    expect(screen.getByText(\"Details about settings.\")).toBeInTheDocument();\n\n    fireEvent.click(await screen.findByRole(\"button\", { name: \"Documentation\" }));\n    expect(windowOpenSpy).toHaveBeenCalledWith(\n      \"https://docs.lovable.dev/\",\n      \"_blank\"\n    );\n\n    fireEvent.click(screen.getByRole(\"button\", { name: \"Need Help?\" }));\n    expect(await screen.findByTestId(\"help-modal\")).toBeInTheDocument();\n\n    fireEvent.click(await screen.findByRole(\"button\", { name: \"Email Support\" }));\n    expect(windowOpenSpy).toHaveBeenCalledWith(\n      \"mailto:support@lovable.dev?subject=Settings Help Request\",\n      \"_blank\"\n    );\n  });\n\n  it(\"renders icon-only button on mobile\", () => {\n    useIsMobileMock.mockReturnValue(true);\n    render(<SettingsHelpButton helpContent={helpContent} />);\n\n    expect(screen.getByRole(\"button\")).toBeInTheDocument();\n    expect(screen.queryByText(\"Need Help?\")).not.toBeInTheDocument();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/__tests__/SettingsLayout.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":75,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":75,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2628,2631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2628,2631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen } from \"@testing-library/react\";\nimport SettingsLayout from \"../SettingsLayout\";\nimport { MemoryRouter, Route, Routes } from \"react-router-dom\";\n\nconst useSettingsContextMock = jest.fn();\nconst useOnboardingMock = jest.fn();\nconst toastMock = jest.fn();\n\nconst translations: Record<string, string> = {\n  \"settings.title\": \"Settings\",\n  \"settings.personalSettings\": \"Personal\",\n  \"settings.organizationSettings\": \"Organization\",\n  \"settings.profile\": \"Profile\",\n  \"settings.notifications\": \"Notifications\",\n  \"settings.general\": \"General\",\n  \"settings.projects\": \"Projects\",\n  \"settings.leads\": \"Leads\",\n  \"settings.services\": \"Services\",\n  \"settings.contracts\": \"Contracts\",\n  \"settings.billing\": \"Billing\",\n  \"settings.dangerZone\": \"Danger Zone\",\n  \"settings.currentlyViewing\": \"Currently viewing\",\n  \"settings.completeGuidedSetup\": \"Complete guided setup to unlock settings\",\n  \"buttons.needHelp\": \"Need Help\",\n  \"buttons.close\": \"Close\",\n  \"toast.settingsSavedTitle\": \"Saved\",\n  \"toast.settingsSavedDescription\": \"Changes saved\",\n  \"toast.settingsDiscardedTitle\": \"Discarded\",\n  \"toast.settingsDiscardedDescription\": \"Changes discarded\",\n  \"settings.projects.title\": \"Projects & Sessions\",\n  \"settings.projects.description\": \"Manage project preferences\",\n  \"settings.general.title\": \"General\",\n  \"settings.general.description\": \"Manage general preferences\",\n};\n\njest.mock(\"@/contexts/SettingsContext\", () => ({\n  useSettingsContext: () => useSettingsContextMock(),\n}));\n\njest.mock(\"@/contexts/OnboardingContext\", () => ({\n  useOnboarding: () => useOnboardingMock(),\n}));\n\njest.mock(\"@/components/ui/tooltip\", () => ({\n  Tooltip: ({ children }: { children: React.ReactNode }) => <>{children}</>,\n  TooltipTrigger: ({ children }: { children: React.ReactNode }) => <>{children}</>,\n  TooltipContent: ({ children }: { children: React.ReactNode }) => (\n    <div data-testid=\"tooltip-content\">{children}</div>\n  ),\n}));\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string) => translations[key] ?? key,\n  }),\n}));\n\njest.mock(\"@/hooks/use-toast\", () => ({\n  useToast: () => ({ toast: toastMock }),\n}));\n\njest.mock(\"@/hooks/useSettingsNavigation\", () => ({\n  useSettingsNavigation: () => ({\n    showGuard: false,\n    message: \"\",\n    handleNavigationAttempt: () => true,\n    handleModalClose: () => true,\n    handleDiscardChanges: jest.fn(),\n    handleStayOnPage: jest.fn(),\n    handleSaveAndExit: undefined,\n  }),\n}));\n\njest.mock(\"lucide-react\", () => {\n  const React = require(\"react\");\n  return new Proxy(\n    {},\n    {\n      get: (_target, property: PropertyKey) => (props: any) =>\n        React.createElement(\"svg\", {\n          \"data-icon\": String(property),\n          ...props,\n        }),\n    }\n  );\n});\n\nconst renderLayout = (initialPath: string = \"/settings/projects\") => {\n  return render(\n    <MemoryRouter initialEntries={[initialPath]}>\n      <Routes>\n        <Route path=\"/settings/*\" element={<SettingsLayout />}>\n          <Route path=\"*\" element={<div data-testid=\"settings-content\" />} />\n        </Route>\n      </Routes>\n    </MemoryRouter>\n  );\n};\n\ndescribe(\"SettingsLayout\", () => {\n  beforeEach(() => {\n    useSettingsContextMock.mockReturnValue({\n      hasCategoryChanges: (href: string) => href === \"/settings/projects\",\n      cancelCategoryChanges: jest.fn(),\n      saveCategoryChanges: jest.fn().mockResolvedValue(undefined),\n    });\n    useOnboardingMock.mockReturnValue({\n      shouldLockNavigation: false,\n    });\n    toastMock.mockReset();\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it(\"renders navigation links and highlights active routes\", () => {\n    renderLayout();\n\n    expect(screen.getByText(\"Settings\")).toBeInTheDocument();\n    expect(screen.getByRole(\"button\", { name: /Close/i })).toBeInTheDocument();\n    expect(screen.getByText(\"Need Help\")).toBeInTheDocument();\n    expect(screen.getAllByText(\"Projects & Sessions\").length).toBeGreaterThan(0);\n\n    const projectLinks = screen.getAllByRole(\"link\", { name: /Projects/i });\n    expect(projectLinks.length).toBeGreaterThanOrEqual(1);\n    expect(projectLinks[0].getAttribute(\"href\")).toBe(\"/settings/projects\");\n\n    expect(screen.getByTestId(\"settings-content\")).toBeInTheDocument();\n  });\n\n  it(\"locks navigation when guided onboarding requires completion\", () => {\n    useOnboardingMock.mockReturnValue({\n      shouldLockNavigation: true,\n    });\n\n    renderLayout();\n\n    const projectsNav = document.querySelector('[data-walkthrough=\"projects-section\"]') as HTMLElement;\n    expect(projectsNav.tagName).toBe(\"DIV\");\n    expect(\n      screen.getAllByText(\"Complete guided setup to unlock settings\").length\n    ).toBeGreaterThan(0);\n  });\n\n  it(\"retains navigation as links for unlocked items\", () => {\n    renderLayout(\"/settings/general\");\n\n    const generalLinks = screen.getAllByRole(\"link\", { name: /General/i });\n    expect(generalLinks[0]).toHaveAttribute(\"href\", \"/settings/general\");\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/__tests__/SettingsPageWrapper.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/__tests__/SettingsStickyFooter.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/settings/settingsNavConfig.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/shared/ActivityForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/shared/ActivityTimeline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/shared/ActivityTimelineItem.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/shared/BaseOnboardingModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/shared/OnboardingTutorial.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/shared/TutorialExitGuardDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/shared/TutorialFloatingCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/sidebar/SidebarCategory.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/sidebar/SidebarNavItem.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/sidebar/SidebarSubItem.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/summary/SummaryCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/summary/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/support/HelpOptionCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/support/__tests__/HelpOptionCard.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[441,444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[441,444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1043,1046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1043,1046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { fireEvent, render, screen } from \"@/utils/testUtils\";\nimport { HelpOptionCard } from \"../HelpOptionCard\";\n\ndescribe(\"HelpOptionCard\", () => {\n  const icon = ({ className }: { className?: string }) => (\n    <svg data-testid=\"help-icon\" className={className} />\n  );\n\n  it(\"renders title, description, and icon while invoking onSelect\", () => {\n    const onSelect = jest.fn();\n\n    render(\n      <HelpOptionCard\n        icon={icon as any}\n        title=\"Documentation\"\n        description=\"Agent handbook\"\n        onSelect={onSelect}\n      />\n    );\n\n    expect(screen.getByText(\"Documentation\")).toBeInTheDocument();\n    expect(screen.getByText(\"Agent handbook\")).toBeInTheDocument();\n    expect(screen.getByTestId(\"help-icon\")).toBeInTheDocument();\n\n    fireEvent.click(screen.getByRole(\"button\", { name: /documentation/i }));\n    expect(onSelect).toHaveBeenCalledTimes(1);\n  });\n\n  it(\"disables interaction when disabled prop is true\", () => {\n    const onSelect = jest.fn();\n\n    render(\n      <HelpOptionCard\n        icon={icon as any}\n        title=\"Contact Support\"\n        description=\"Drop us a line\"\n        onSelect={onSelect}\n        disabled\n      />\n    );\n\n    const button = screen.getByRole(\"button\", { name: /contact support/i });\n    expect(button).toBeDisabled();\n\n    fireEvent.click(button);\n    expect(onSelect).not.toHaveBeenCalled();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/AddBlockSheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/BlockEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1349,1352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1349,1352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2373,2376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2373,2376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2488,2491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2488,2491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2592,2595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2592,2595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2699,2702],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2699,2702],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3876,3879],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3876,3879],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ChevronUp, ChevronDown, Trash2, Bold, Italic, List, AlignLeft, AlignCenter, AlignRight, AlignJustify, Upload, Smile } from \"lucide-react\";\nimport { TemplateBlock, TextBlockData, SessionDetailsBlockData, CTABlockData, ImageBlockData, FooterBlockData } from \"@/types/templateBuilder\";\nimport { VariablePicker } from \"./VariablePicker\";\nimport { EmojiPicker } from \"./EmojiPicker\";\nimport { ImageUpload } from \"./ImageUpload\";\nimport { ImageLibrarySheet } from \"./ImageLibrarySheet\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useRef, useState } from \"react\";\nimport { emojis } from \"@/lib/templateUtils\";\nimport { DividerBlockEditor, SocialLinksBlockEditor, HeaderBlockEditor, RawHTMLBlockEditor } from \"./NewBlockEditors\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface BlockEditorProps {\n  block: TemplateBlock;\n  onUpdate: (data: any) => void;\n  onRemove: () => void;\n  onMoveUp: () => void;\n  onMoveDown: () => void;\n  canMoveUp: boolean;\n  canMoveDown: boolean;\n}\n\nexport function BlockEditor({ block, onUpdate, onRemove, onMoveUp, onMoveDown, canMoveUp, canMoveDown }: BlockEditorProps) {\n  const { t } = useTranslation(\"pages\");\n  const renderEditor = () => {\n    switch (block.type) {\n      case \"text\":\n        return <TextBlockEditor data={block.data as TextBlockData} onUpdate={onUpdate} />;\n      case \"session-details\":\n        return <SessionDetailsBlockEditor data={block.data as SessionDetailsBlockData} onUpdate={onUpdate} />;\n      case \"cta\":\n        return <CTABlockEditor data={block.data as CTABlockData} onUpdate={onUpdate} />;\n      case \"image\":\n        return <ImageBlockEditor data={block.data as ImageBlockData} onUpdate={onUpdate} />;\n      case \"footer\":\n        return <FooterBlockEditor data={block.data as FooterBlockData} onUpdate={onUpdate} />;\n      case \"divider\":\n        return <DividerBlockEditor data={block.data as any} onUpdate={onUpdate} />;\n      case \"social-links\":\n        return <SocialLinksBlockEditor data={block.data as any} onUpdate={onUpdate} />;\n      case \"header\":\n        return <HeaderBlockEditor data={block.data as any} onUpdate={onUpdate} />;\n      case \"raw-html\":\n        return <RawHTMLBlockEditor data={block.data as any} onUpdate={onUpdate} />;\n      default:\n        return <div>{t(\"templateBuilder.blockEditor.unknownBlock\")}</div>;\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {renderEditor()}\n      \n      <Separator />\n      \n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-2\">\n          <Button size=\"sm\" variant=\"outline\" onClick={onMoveUp} disabled={!canMoveUp}>\n            <ChevronUp className=\"h-3 w-3\" />\n          </Button>\n          <Button size=\"sm\" variant=\"outline\" onClick={onMoveDown} disabled={!canMoveDown}>\n            <ChevronDown className=\"h-3 w-3\" />\n          </Button>\n        </div>\n        \n        <Button size=\"sm\" variant=\"destructive\" onClick={onRemove}>\n          <Trash2 className=\"h-3 w-3\" />\n          {t(\"templateBuilder.blockEditor.remove\")}\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nfunction TextBlockEditor({ data, onUpdate }: { data: TextBlockData; onUpdate: (data: TextBlockData) => void }) {\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const { t } = useTranslation(\"pages\");\n  \n  const updateFormatting = (key: keyof TextBlockData[\"formatting\"], value: any) => {\n    onUpdate({\n      ...data,\n      formatting: { ...data.formatting, [key]: value }\n    });\n  };\n\n  const insertVariable = (variable: string) => {\n    const textarea = textareaRef.current;\n    if (textarea) {\n      const start = textarea.selectionStart;\n      const end = textarea.selectionEnd;\n      const newContent = data.content.slice(0, start) + variable + data.content.slice(end);\n      onUpdate({ ...data, content: newContent });\n      \n      // Focus and set cursor position after variable\n      setTimeout(() => {\n        textarea.focus();\n        textarea.setSelectionRange(start + variable.length, start + variable.length);\n      }, 0);\n    } else {\n      onUpdate({ ...data, content: data.content + variable });\n    }\n  };\n\n  const insertEmoji = (emoji: string) => {\n    const textarea = textareaRef.current;\n    if (textarea) {\n      const start = textarea.selectionStart;\n      const end = textarea.selectionEnd;\n      const newContent = data.content.slice(0, start) + emoji + data.content.slice(end);\n      onUpdate({ ...data, content: newContent });\n      \n      // Focus and set cursor position after emoji\n      setTimeout(() => {\n        textarea.focus();\n        textarea.setSelectionRange(start + emoji.length, start + emoji.length);\n      }, 0);\n    } else {\n      onUpdate({ ...data, content: data.content + emoji });\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div>\n        <div className=\"flex items-center justify-between mb-2\">\n          <Label>{t(\"templateBuilder.blockEditor.text.contentLabel\")}</Label>\n          <div className=\"flex items-center gap-2\">\n            <EmojiPicker onEmojiSelect={insertEmoji} />\n            <VariablePicker onVariableSelect={insertVariable} />\n          </div>\n        </div>\n        <Textarea\n          ref={textareaRef}\n          value={data.content}\n          onChange={(e) => onUpdate({ ...data, content: e.target.value })}\n          placeholder={t(\"templateBuilder.blockEditor.text.contentPlaceholder\")}\n          rows={4}\n        />\n      </div>\n      \n      <div className=\"space-y-3\">\n        <Label>{t(\"templateBuilder.blockEditor.text.formatting\")}</Label>\n        \n        {/* First row: Bold, Italic, Bullets */}\n        <div className=\"flex items-center gap-2\">\n          <Button\n            size=\"sm\"\n            variant={data.formatting.bold ? \"default\" : \"outline\"}\n            onClick={() => updateFormatting(\"bold\", !data.formatting.bold)}\n          >\n            <Bold className=\"h-3 w-3\" />\n          </Button>\n          <Button\n            size=\"sm\"\n            variant={data.formatting.italic ? \"default\" : \"outline\"}\n            onClick={() => updateFormatting(\"italic\", !data.formatting.italic)}\n          >\n            <Italic className=\"h-3 w-3\" />\n          </Button>\n          <Button\n            size=\"sm\"\n            variant={data.formatting.bullets ? \"default\" : \"outline\"}\n            onClick={() => updateFormatting(\"bullets\", !data.formatting.bullets)}\n          >\n            <List className=\"h-3 w-3\" />\n          </Button>\n        </div>\n        \n        {/* Second row: Font size, Font family on same row */}\n        <div className=\"grid grid-cols-2 gap-2\">\n          <div>\n            <Label className=\"text-xs\">{t(\"templateBuilder.blockEditor.text.fontSize\")}</Label>\n            <Select value={data.formatting.fontSize} onValueChange={(value) => updateFormatting(\"fontSize\", value)}>\n              <SelectTrigger className=\"h-8\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"h1\">{t(\"templateBuilder.blockEditor.text.fontSizeOptions.h1\")}</SelectItem>\n                <SelectItem value=\"h2\">{t(\"templateBuilder.blockEditor.text.fontSizeOptions.h2\")}</SelectItem>\n                <SelectItem value=\"h3\">{t(\"templateBuilder.blockEditor.text.fontSizeOptions.h3\")}</SelectItem>\n                <SelectItem value=\"p\">{t(\"templateBuilder.blockEditor.text.fontSizeOptions.p\")}</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n          \n          <div>\n            <Label className=\"text-xs\">{t(\"templateBuilder.blockEditor.text.fontFamily\")}</Label>\n            <Select value={data.formatting.fontFamily} onValueChange={(value) => updateFormatting(\"fontFamily\", value)}>\n              <SelectTrigger className=\"h-8\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"Arial\">{t(\"templateBuilder.blockEditor.text.fontFamilyOptions.arial\")}</SelectItem>\n                <SelectItem value=\"Helvetica\">{t(\"templateBuilder.blockEditor.text.fontFamilyOptions.helvetica\")}</SelectItem>\n                <SelectItem value=\"Georgia\">{t(\"templateBuilder.blockEditor.text.fontFamilyOptions.georgia\")}</SelectItem>\n                <SelectItem value=\"Times New Roman\">{t(\"templateBuilder.blockEditor.text.fontFamilyOptions.timesNewRoman\")}</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        {/* Third row: Text alignment */}\n        <div>\n          <Label className=\"text-xs mb-2 block\">{t(\"templateBuilder.blockEditor.text.textAlignment\")}</Label>\n          <div className=\"flex items-center gap-1\">\n            <Button\n              size=\"sm\"\n              variant={data.formatting.alignment === \"left\" ? \"default\" : \"outline\"}\n              onClick={() => updateFormatting(\"alignment\", \"left\")}\n            >\n              <AlignLeft className=\"h-3 w-3\" />\n            </Button>\n            <Button\n              size=\"sm\"\n              variant={data.formatting.alignment === \"center\" ? \"default\" : \"outline\"}\n              onClick={() => updateFormatting(\"alignment\", \"center\")}\n            >\n              <AlignCenter className=\"h-3 w-3\" />\n            </Button>\n            <Button\n              size=\"sm\"\n              variant={data.formatting.alignment === \"right\" ? \"default\" : \"outline\"}\n              onClick={() => updateFormatting(\"alignment\", \"right\")}\n            >\n              <AlignRight className=\"h-3 w-3\" />\n            </Button>\n            <Button\n              size=\"sm\"\n              variant={data.formatting.alignment === \"justify\" ? \"default\" : \"outline\"}\n              onClick={() => updateFormatting(\"alignment\", \"justify\")}\n            >\n              <AlignJustify className=\"h-3 w-3\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction SessionDetailsBlockEditor({ data, onUpdate }: { data: SessionDetailsBlockData; onUpdate: (data: SessionDetailsBlockData) => void }) {\n  const { t } = useTranslation(\"pages\");\n  return (\n    <div className=\"space-y-4\">\n      <div>\n        <Label>{t(\"templateBuilder.blockEditor.sessionDetails.customLabel\")}</Label>\n        <Input\n          value={data.customLabel || \"\"}\n          onChange={(e) => onUpdate({ ...data, customLabel: e.target.value })}\n          placeholder={t(\"templateBuilder.blockEditor.sessionDetails.customLabelPlaceholder\")}\n        />\n      </div>\n      \n      <div className=\"space-y-3\">\n        <Label>{t(\"templateBuilder.blockEditor.sessionDetails.showFields\")}</Label>\n        \n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between\">\n            <Label className=\"text-sm\">{t(\"templateBuilder.blockEditor.sessionDetails.fields.date\")}</Label>\n            <Switch\n              checked={data.showDate}\n              onCheckedChange={(checked) => onUpdate({ ...data, showDate: checked })}\n            />\n          </div>\n          <div className=\"flex items-center justify-between\">\n            <Label className=\"text-sm\">{t(\"templateBuilder.blockEditor.sessionDetails.fields.time\")}</Label>\n            <Switch\n              checked={data.showTime}\n              onCheckedChange={(checked) => onUpdate({ ...data, showTime: checked })}\n            />\n          </div>\n          <div className=\"flex items-center justify-between\">\n            <Label className=\"text-sm\">{t(\"templateBuilder.blockEditor.sessionDetails.fields.location\")}</Label>\n            <Switch\n              checked={data.showLocation}\n              onCheckedChange={(checked) => onUpdate({ ...data, showLocation: checked })}\n            />\n          </div>\n          <div className=\"flex items-center justify-between\">\n            <Label className=\"text-sm\">{t(\"templateBuilder.blockEditor.sessionDetails.fields.notes\")}</Label>\n            <Switch\n              checked={data.showNotes}\n              onCheckedChange={(checked) => onUpdate({ ...data, showNotes: checked })}\n            />\n          </div>\n        </div>\n      </div>\n      \n      {data.showNotes && (\n        <div>\n          <Label>{t(\"templateBuilder.blockEditor.sessionDetails.customNotes\")}</Label>\n          <Textarea\n            value={data.customNotes || \"\"}\n            onChange={(e) => onUpdate({ ...data, customNotes: e.target.value })}\n            placeholder={t(\"templateBuilder.blockEditor.sessionDetails.customNotesPlaceholder\")}\n            rows={2}\n          />\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction CTABlockEditor({ data, onUpdate }: { data: CTABlockData; onUpdate: (data: CTABlockData) => void }) {\n  const { t } = useTranslation(\"pages\");\n  return (\n    <div className=\"space-y-4\">\n      <div>\n        <Label>{t(\"templateBuilder.blockEditor.cta.buttonText\")}</Label>\n        <Input\n          value={data.text}\n          onChange={(e) => onUpdate({ ...data, text: e.target.value })}\n          placeholder={t(\"templateBuilder.blockEditor.cta.buttonTextPlaceholder\")}\n        />\n      </div>\n      \n      <div>\n        <Label>{t(\"templateBuilder.blockEditor.cta.buttonStyle\")}</Label>\n        <Select value={data.variant} onValueChange={(value) => onUpdate({ ...data, variant: value as CTABlockData[\"variant\"] })}>\n          <SelectTrigger>\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"primary\">{t(\"templateBuilder.blockEditor.cta.buttonStyles.primary\")}</SelectItem>\n            <SelectItem value=\"secondary\">{t(\"templateBuilder.blockEditor.cta.buttonStyles.secondary\")}</SelectItem>\n            <SelectItem value=\"text\">{t(\"templateBuilder.blockEditor.cta.buttonStyles.text\")}</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n      \n      <div>\n        <Label>{t(\"templateBuilder.blockEditor.cta.linkLabel\")}</Label>\n        <Input\n          value={data.link || \"\"}\n          onChange={(e) => onUpdate({ ...data, link: e.target.value })}\n          placeholder={t(\"templateBuilder.blockEditor.cta.linkPlaceholder\")}\n        />\n      </div>\n    </div>\n  );\n}\n\nfunction ImageBlockEditor({ data, onUpdate }: { data: ImageBlockData; onUpdate: (data: ImageBlockData) => void }) {\n  const [isLibraryOpen, setIsLibraryOpen] = useState(false);\n  const { t } = useTranslation(\"pages\");\n  \n  const handleImageSelect = (imageUrl: string, altText?: string) => {\n    onUpdate({ \n      ...data, \n      src: imageUrl, \n      placeholder: false,\n      alt: altText || data.alt || t(\"templateBuilder.blockEditor.image.defaultAlt\")\n    });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <Tabs defaultValue=\"upload\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-3\">\n          <TabsTrigger value=\"upload\">{t(\"templateBuilder.blockEditor.image.tabs.upload\")}</TabsTrigger>\n          <TabsTrigger value=\"library\">{t(\"templateBuilder.blockEditor.image.tabs.library\")}</TabsTrigger>\n          <TabsTrigger value=\"url\">{t(\"templateBuilder.blockEditor.image.tabs.url\")}</TabsTrigger>\n        </TabsList>\n        \n        <TabsContent value=\"upload\" className=\"space-y-4\">\n          <ImageUpload onImageUploaded={handleImageSelect} />\n        </TabsContent>\n        \n        <TabsContent value=\"library\" className=\"space-y-4\">\n          <Button \n            variant=\"outline\" \n            onClick={() => setIsLibraryOpen(true)}\n            className=\"w-full\"\n          >\n            {t(\"templateBuilder.blockEditor.image.openLibrary\")}\n          </Button>\n        </TabsContent>\n        \n        <TabsContent value=\"url\" className=\"space-y-4\">\n          <div>\n            <Label>{t(\"templateBuilder.blockEditor.image.urlLabel\")}</Label>\n            <Input\n              value={data.src || \"\"}\n              onChange={(e) => onUpdate({ ...data, src: e.target.value, placeholder: !e.target.value })}\n              placeholder={t(\"templateBuilder.blockEditor.image.urlPlaceholder\")}\n            />\n          </div>\n        </TabsContent>\n      </Tabs>\n\n      {/* Show current image if exists */}\n      {data.src && !data.placeholder && (\n        <div className=\"border rounded-lg p-3\">\n          <Label className=\"text-sm text-muted-foreground\">{t(\"templateBuilder.blockEditor.image.currentImage\")}</Label>\n          <div className=\"mt-2\">\n            <img \n              src={data.src} \n              alt={data.alt || t(\"templateBuilder.blockEditor.image.defaultAlt\")} \n              className=\"max-w-full h-32 object-cover rounded border\"\n            />\n          </div>\n        </div>\n      )}\n      \n      <div>\n        <Label>{t(\"templateBuilder.blockEditor.image.altLabel\")}</Label>\n        <Input\n          value={data.alt || \"\"}\n          onChange={(e) => onUpdate({ ...data, alt: e.target.value })}\n          placeholder={t(\"templateBuilder.blockEditor.image.altPlaceholder\")}\n        />\n      </div>\n      \n      <div>\n        <Label>{t(\"templateBuilder.blockEditor.image.captionLabel\")}</Label>\n        <Input\n          value={data.caption || \"\"}\n          onChange={(e) => onUpdate({ ...data, caption: e.target.value })}\n          placeholder={t(\"templateBuilder.blockEditor.image.captionPlaceholder\")}\n        />\n      </div>\n      \n      <div>\n        <Label>{t(\"templateBuilder.blockEditor.image.linkLabel\")}</Label>\n        <Input\n          value={data.link || \"\"}\n          onChange={(e) => onUpdate({ ...data, link: e.target.value })}\n          placeholder={t(\"templateBuilder.blockEditor.image.linkPlaceholder\")}\n        />\n      </div>\n\n      <ImageLibrarySheet\n        open={isLibraryOpen}\n        onOpenChange={setIsLibraryOpen}\n        onImageSelect={handleImageSelect}\n      />\n    </div>\n  );\n}\n\nfunction FooterBlockEditor({ data, onUpdate }: { data: FooterBlockData; onUpdate: (data: FooterBlockData) => void }) {\n  const { t } = useTranslation(\"pages\");\n  return (\n    <div className=\"space-y-4\">\n      <div>\n        <Label>{t(\"templateBuilder.blockEditor.footer.customText\")}</Label>\n        <Textarea\n          value={data.customText || \"\"}\n          onChange={(e) => onUpdate({ ...data, customText: e.target.value })}\n          placeholder={t(\"templateBuilder.blockEditor.footer.customTextPlaceholder\")}\n          rows={2}\n        />\n      </div>\n      \n      <div className=\"space-y-3\">\n        <Label>{t(\"templateBuilder.blockEditor.footer.showElements\")}</Label>\n        \n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between\">\n            <Label className=\"text-sm\">{t(\"templateBuilder.blockEditor.footer.elements.logo\")}</Label>\n            <Switch\n              checked={data.showLogo}\n              onCheckedChange={(checked) => onUpdate({ ...data, showLogo: checked })}\n            />\n          </div>\n          <div className=\"flex items-center justify-between\">\n            <Label className=\"text-sm\">{t(\"templateBuilder.blockEditor.footer.elements.studioName\")}</Label>\n            <Switch\n              checked={data.showStudioName}\n              onCheckedChange={(checked) => onUpdate({ ...data, showStudioName: checked })}\n            />\n          </div>\n          <div className=\"flex items-center justify-between\">\n            <Label className=\"text-sm\">{t(\"templateBuilder.blockEditor.footer.elements.contactInfo\")}</Label>\n            <Switch\n              checked={data.showContactInfo}\n              onCheckedChange={(checked) => onUpdate({ ...data, showContactInfo: checked })}\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/CompactStorageIndicator.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchStorageUsage'. Either include it or remove the dependency array.","line":53,"column":6,"nodeType":"ArrayExpression","endLine":53,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [activeOrganization.id, fetchStorageUsage]","fix":{"range":[1646,1670],"text":"[activeOrganization.id, fetchStorageUsage]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { AlertTriangle, HardDrive } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useOrganization } from '@/contexts/OrganizationContext';\n\ninterface StorageUsage {\n  total_images: number;\n  total_storage_bytes: number;\n}\n\nconst STORAGE_LIMITS = {\n  MAX_IMAGES: 50,\n  MAX_STORAGE_BYTES: 50 * 1024 * 1024, // 50MB\n};\n\ninterface CompactStorageIndicatorProps {\n  onManageImages?: () => void;\n}\n\nexport function CompactStorageIndicator({ onManageImages }: CompactStorageIndicatorProps) {\n  const [storageUsage, setStorageUsage] = useState<StorageUsage>({ total_images: 0, total_storage_bytes: 0 });\n  const [loading, setLoading] = useState(true);\n  const { activeOrganization } = useOrganization();\n\n  const fetchStorageUsage = async () => {\n    if (!activeOrganization?.id) return;\n    \n    try {\n      const { data, error } = await supabase\n        .from('template_image_usage')\n        .select('total_images, total_storage_bytes')\n        .eq('organization_id', activeOrganization.id)\n        .single();\n\n      if (error && error.code !== 'PGRST116') {\n        console.error('Error fetching storage usage:', error);\n        return;\n      }\n\n      setStorageUsage(data || { total_images: 0, total_storage_bytes: 0 });\n    } catch (error) {\n      console.error('Error fetching storage usage:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchStorageUsage();\n  }, [activeOrganization?.id]);\n\n  if (loading) {\n    return <div className=\"h-4 w-32 bg-muted animate-pulse rounded\" />;\n  }\n\n  const imageProgress = (storageUsage.total_images / STORAGE_LIMITS.MAX_IMAGES) * 100;\n  const storageProgress = (storageUsage.total_storage_bytes / STORAGE_LIMITS.MAX_STORAGE_BYTES) * 100;\n  const isNearLimit = imageProgress > 80 || storageProgress > 80;\n  const isAtLimit = imageProgress >= 100 || storageProgress >= 100;\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes === 0) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))} ${sizes[i]}`;\n  };\n\n  return (\n    <div className=\"flex items-center gap-3 p-3 bg-muted/50 rounded-lg\">\n      <div className=\"flex items-center gap-2\">\n        <HardDrive className=\"h-4 w-4 text-muted-foreground\" />\n        <div className=\"space-y-1\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-xs text-muted-foreground\">\n              {storageUsage.total_images}/{STORAGE_LIMITS.MAX_IMAGES} images\n            </span>\n            {isAtLimit && <AlertTriangle className=\"h-3 w-3 text-destructive\" />}\n            {isNearLimit && !isAtLimit && <AlertTriangle className=\"h-3 w-3 text-warning\" />}\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Progress value={Math.min(imageProgress, 100)} className=\"w-20 h-1\" />\n            <span className=\"text-xs text-muted-foreground\">\n              {formatFileSize(storageUsage.total_storage_bytes)}/50MB\n            </span>\n          </div>\n        </div>\n      </div>\n      \n      {onManageImages && (\n        <Button variant=\"ghost\" size=\"sm\" onClick={onManageImages} className=\"text-xs\">\n          Manage\n        </Button>\n      )}\n      \n      {isAtLimit && (\n        <Badge variant=\"destructive\" className=\"text-xs\">\n          Limit Reached\n        </Badge>\n      )}\n      {isNearLimit && !isAtLimit && (\n        <Badge variant=\"secondary\" className=\"text-xs\">\n          Near Limit\n        </Badge>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/DeleteTemplateDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/EmojiPicker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/ImageLibrarySheet.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadAssets'. Either include it or remove the dependency array.","line":71,"column":6,"nodeType":"ArrayExpression","endLine":71,"endColumn":36,"suggestions":[{"desc":"Update the dependencies array to be: [open, activeOrganization.id, loadAssets]","fix":{"range":[2518,2548],"text":"[open, activeOrganization.id, loadAssets]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Sheet, SheetContent, SheetDescription, SheetHeader, SheetTitle } from '@/components/ui/sheet';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from '@/components/ui/alert-dialog';\nimport { Copy, Trash2, Edit3, Check, X } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useOrganization } from '@/contexts/OrganizationContext';\nimport { CompactStorageIndicator } from './CompactStorageIndicator';\nimport { useTranslation } from 'react-i18next';\nimport { useMessagesTranslation } from '@/hooks/useTypedTranslation';\n\ninterface TemplateAsset {\n  id: string;\n  file_name: string;\n  file_path: string;\n  file_size: number;\n  content_type: string;\n  alt_text?: string;\n  created_at: string;\n}\n\ninterface ImageLibrarySheetProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onImageSelect?: (imageUrl: string, altText?: string) => void;\n  templateId?: string;\n}\n\nexport function ImageLibrarySheet({ open, onOpenChange, onImageSelect, templateId }: ImageLibrarySheetProps) {\n  const [assets, setAssets] = useState<TemplateAsset[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [editingAltText, setEditingAltText] = useState<string | null>(null);\n  const [tempAltText, setTempAltText] = useState('');\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const { t: tMessages } = useMessagesTranslation();\n  const { activeOrganization } = useOrganization();\n\n  const loadAssets = async () => {\n    if (!activeOrganization?.id) return;\n    \n    try {\n      setLoading(true);\n      const { data, error } = await supabase\n        .from('template_assets')\n        .select('*')\n        .eq('organization_id', activeOrganization.id)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setAssets(data || []);\n    } catch (error) {\n      console.error('Error loading assets:', error);\n      toast({\n        title: 'Error',\n        description: 'Failed to load images',\n        variant: 'destructive',\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (open) {\n      loadAssets();\n    }\n  }, [open, activeOrganization?.id]);\n\n  const getImageUrl = (filePath: string) => {\n    const { data: { publicUrl } } = supabase.storage\n      .from('template-images')\n      .getPublicUrl(filePath);\n    return publicUrl;\n  };\n\n  const copyImageUrl = async (filePath: string) => {\n    const imageUrl = getImageUrl(filePath);\n    try {\n      await navigator.clipboard.writeText(imageUrl);\n      toast({\n        title: 'Success',\n        description: 'Image URL copied to clipboard',\n      });\n    } catch (error) {\n      toast({\n        title: 'Error',\n        description: 'Failed to copy URL',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const deleteAsset = async (asset: TemplateAsset) => {\n    try {\n      // Delete from storage\n      const { error: storageError } = await supabase.storage\n        .from('template-images')\n        .remove([asset.file_path]);\n\n      if (storageError) throw storageError;\n\n      // Delete from database\n      const { error: dbError } = await supabase\n        .from('template_assets')\n        .delete()\n        .eq('id', asset.id);\n\n      if (dbError) throw dbError;\n\n      toast({\n        title: 'Success',\n        description: 'Image deleted successfully',\n      });\n\n      // Refresh the list\n      loadAssets();\n    } catch (error) {\n      console.error('Error deleting asset:', error);\n      toast({\n        title: 'Error',\n        description: 'Failed to delete image',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const updateAltText = async (assetId: string, newAltText: string) => {\n    try {\n      const { error } = await supabase\n        .from('template_assets')\n        .update({ alt_text: newAltText })\n        .eq('id', assetId);\n\n      if (error) throw error;\n\n      setAssets(prev => prev.map(asset => \n        asset.id === assetId ? { ...asset, alt_text: newAltText } : asset\n      ));\n\n      toast({\n        title: 'Success',\n        description: 'Alt text updated',\n      });\n    } catch (error) {\n      console.error('Error updating alt text:', error);\n      toast({\n        title: 'Error',\n        description: 'Failed to update alt text',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const handleEditAltText = (assetId: string, currentAltText: string) => {\n    setEditingAltText(assetId);\n    setTempAltText(currentAltText || '');\n  };\n\n  const handleSaveAltText = (assetId: string) => {\n    updateAltText(assetId, tempAltText);\n    setEditingAltText(null);\n    setTempAltText('');\n  };\n\n  const handleCancelEditAltText = () => {\n    setEditingAltText(null);\n    setTempAltText('');\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes === 0) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))} ${sizes[i]}`;\n  };\n\n  return (\n    <Sheet open={open} onOpenChange={onOpenChange}>\n      <SheetContent className=\"w-[600px] sm:w-[700px] overflow-hidden flex flex-col\">\n        <SheetHeader>\n          <SheetTitle>Image Library</SheetTitle>\n          <SheetDescription>\n            Manage your uploaded images. Click on an image to select it for your template.\n          </SheetDescription>\n        </SheetHeader>\n\n        <div className=\"mt-4\">\n          <CompactStorageIndicator />\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto mt-6\">\n          {loading ? (\n            <div className=\"grid grid-cols-2 gap-4\">\n              {Array.from({ length: 6 }).map((_, i) => (\n                <div key={i} className=\"aspect-video bg-muted animate-pulse rounded-lg\" />\n              ))}\n            </div>\n          ) : assets.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <p className=\"text-muted-foreground\">No images uploaded yet</p>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                Upload an image using the image block to see it here\n              </p>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-2 gap-4\">\n              {assets.map((asset) => (\n                <div key={asset.id} className=\"group relative bg-card border rounded-lg overflow-hidden\">\n                  <div className=\"aspect-video relative\">\n                    <img\n                      src={getImageUrl(asset.file_path)}\n                      alt={asset.alt_text || asset.file_name}\n                      className=\"w-full h-full object-cover cursor-pointer hover:scale-105 transition-transform\"\n                      onClick={() => {\n                        if (onImageSelect) {\n                          onImageSelect(getImageUrl(asset.file_path), asset.alt_text);\n                          onOpenChange(false);\n                        }\n                      }}\n                    />\n                    <div className=\"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors\" />\n                    <div className=\"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"secondary\"\n                        onClick={() => copyImageUrl(asset.file_path)}\n                        className=\"h-8 w-8 p-0\"\n                        aria-label=\"Copy image URL\"\n                      >\n                        <Copy className=\"h-3 w-3\" />\n                      </Button>\n                      <AlertDialog>\n                        <AlertDialogTrigger asChild>\n                          <Button\n                            size=\"sm\"\n                            variant=\"destructive\"\n                            className=\"h-8 w-8 p-0\"\n                            aria-label=\"Delete image\"\n                          >\n                            <Trash2 className=\"h-3 w-3\" />\n                          </Button>\n                        </AlertDialogTrigger>\n                        <AlertDialogContent>\n                          <AlertDialogHeader>\n                            <AlertDialogTitle>Delete Image</AlertDialogTitle>\n                            <AlertDialogDescription>\n                              {tMessages('confirm.deleteWithName', { name: asset.file_name })} {tMessages('confirm.cannotUndo')}\n                            </AlertDialogDescription>\n                          </AlertDialogHeader>\n                          <AlertDialogFooter>\n                            <AlertDialogCancel>Cancel</AlertDialogCancel>\n                            <AlertDialogAction\n                              onClick={() => deleteAsset(asset)}\n                              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                            >\n                              Delete\n                            </AlertDialogAction>\n                          </AlertDialogFooter>\n                        </AlertDialogContent>\n                      </AlertDialog>\n                    </div>\n                  </div>\n                  \n                  <div className=\"p-3 space-y-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <p className=\"text-sm font-medium truncate\">{asset.file_name}</p>\n                      <Badge variant=\"secondary\" className=\"text-xs\">\n                        {formatFileSize(asset.file_size)}\n                      </Badge>\n                    </div>\n                    \n                    <div className=\"flex items-center gap-2\">\n                      {editingAltText === asset.id ? (\n                        <div className=\"flex items-center gap-1 flex-1\">\n                          <Input\n                            value={tempAltText}\n                            onChange={(e) => setTempAltText(e.target.value)}\n                            placeholder=\"Alt text\"\n                            className=\"h-7 text-xs\"\n                          />\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => handleSaveAltText(asset.id)}\n                            className=\"h-7 w-7 p-0\"\n                            aria-label=\"Confirm alt text\"\n                          >\n                            <Check className=\"h-3 w-3\" />\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={handleCancelEditAltText}\n                            className=\"h-7 w-7 p-0\"\n                            aria-label=\"Cancel alt text edit\"\n                          >\n                            <X className=\"h-3 w-3\" />\n                          </Button>\n                        </div>\n                      ) : (\n                        <div className=\"flex items-center gap-1 flex-1\">\n                          <p className=\"text-xs text-muted-foreground flex-1 truncate\">\n                            Alt: {asset.alt_text || 'No alt text'}\n                          </p>\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => handleEditAltText(asset.id, asset.alt_text || '')}\n                            className=\"h-7 w-7 p-0\"\n                            aria-label=\"Edit alt text\"\n                          >\n                            <Edit3 className=\"h-3 w-3\" />\n                          </Button>\n                        </div>\n                      )}\n                    </div>\n\n                    {onImageSelect && (\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        className=\"w-full h-7 text-xs\"\n                        onClick={() => {\n                          onImageSelect(getImageUrl(asset.file_path), asset.alt_text);\n                          onOpenChange(false);\n                        }}\n                      >\n                        Insert\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </SheetContent>\n    </Sheet>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/ImageUpload.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/InlinePreheaderEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/InlineSubjectEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/NewBlockEditors.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/OptimizedTemplateEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2097,2100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2097,2100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2635,2638],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2635,2638],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":172,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5795,5798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5795,5798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":366,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":366,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11379,11382],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11379,11382],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useCallback, useMemo } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Plus, GripVertical, Eye, EyeOff } from \"lucide-react\";\nimport { TemplateBlock, BlockData, TextBlockData, SessionDetailsBlockData, CTABlockData, ImageBlockData, FooterBlockData } from \"@/types/templateBuilder\";\nimport { BlockEditor } from \"./BlockEditor\";\nimport { AddBlockSheet } from \"./AddBlockSheet\";\nimport { useTranslation } from 'react-i18next';\n\nimport { cn } from \"@/lib/utils\";\nimport { DragDropContext, Droppable, Draggable, DropResult } from \"@hello-pangea/dnd\";\n\ninterface OptimizedTemplateEditorProps {\n  blocks: TemplateBlock[];\n  onBlocksChange: (blocks: TemplateBlock[]) => void;\n}\n\n// Helper function to get block title translation key\nfunction getBlockTitleKey(type: TemplateBlock[\"type\"]): string {\n  switch (type) {\n    case \"text\": return 'templateBuilder.blockTitles.text';\n    case \"session-details\": return 'templateBuilder.blockTitles.sessionDetails';\n    case \"cta\": return 'templateBuilder.blockTitles.cta';\n    case \"image\": return 'templateBuilder.blockTitles.image';\n    case \"footer\": return 'templateBuilder.blockTitles.footer';\n    case \"divider\": return 'templateBuilder.blockTitles.divider';\n    case \"columns\": return 'templateBuilder.blockTitles.columns';\n    case \"social-links\": return 'templateBuilder.blockTitles.socialLinks';\n    case \"header\": return 'templateBuilder.blockTitles.header';\n    case \"raw-html\": return 'templateBuilder.blockTitles.rawHtml';\n    default: return 'templateBuilder.blockTitles.unknown';\n  }\n}\n\n// Memoized block component to prevent unnecessary re-renders\nconst MemoizedBlockCard = React.memo(({ \n  block, \n  index, \n  isActive, \n  onActivate, \n  onToggleVisibility, \n  onUpdate, \n  onRemove, \n  onMove,\n  canMoveUp,\n  canMoveDown,\n  totalBlocks\n}: {\n  block: TemplateBlock;\n  index: number;\n  isActive: boolean;\n  onActivate: (id: string) => void;\n  onToggleVisibility: (id: string) => void;\n  onUpdate: (id: string, data: any) => void;\n  onRemove: (id: string) => void;\n  onMove: (id: string, direction: \"up\" | \"down\") => void;\n  canMoveUp: boolean;\n  canMoveDown: boolean;\n  totalBlocks: number;\n}) => {\n  const { t } = useTranslation('pages');\n  \n  const handleClick = useCallback(() => {\n    onActivate(block.id);\n  }, [block.id, onActivate]);\n\n  const handleToggleVisibility = useCallback((e: React.MouseEvent) => {\n    e.stopPropagation();\n    onToggleVisibility(block.id);\n  }, [block.id, onToggleVisibility]);\n\n  const handleUpdate = useCallback((data: any) => {\n    onUpdate(block.id, data);\n  }, [block.id, onUpdate]);\n\n  const handleRemove = useCallback(() => {\n    onRemove(block.id);\n  }, [block.id, onRemove]);\n\n  const handleMoveUp = useCallback(() => {\n    onMove(block.id, \"up\");\n  }, [block.id, onMove]);\n\n  const handleMoveDown = useCallback(() => {\n    onMove(block.id, \"down\");\n  }, [block.id, onMove]);\n\n  return (\n    <Draggable key={block.id} draggableId={block.id} index={index}>\n      {(provided, snapshot) => (\n        <Card\n          ref={provided.innerRef}\n          {...provided.draggableProps}\n          className={cn(\n            \"cursor-pointer transition-colors\",\n            isActive && \"ring-2 ring-primary\",\n            !block.visible && \"opacity-50\",\n            snapshot.isDragging && \"shadow-lg\"\n          )}\n          onClick={handleClick}\n        >\n          <CardHeader className=\"pb-2\">\n            <div className=\"flex items-center justify-between\">\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <div \n                  {...provided.dragHandleProps}\n                  className=\"cursor-grab active:cursor-grabbing\"\n                >\n                  <GripVertical className=\"h-4 w-4 text-muted-foreground\" />\n                </div>\n                {t(getBlockTitleKey(block.type))}\n              </CardTitle>\n              <div className=\"flex items-center gap-1\">\n                <Button\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={handleToggleVisibility}\n                >\n                  {block.visible ? (\n                    <Eye className=\"h-3 w-3\" />\n                  ) : (\n                    <EyeOff className=\"h-3 w-3\" />\n                  )}\n                </Button>\n              </div>\n            </div>\n          </CardHeader>\n          {isActive && (\n            <CardContent className=\"pt-0\">\n              <BlockEditor\n                block={block}\n                onUpdate={handleUpdate}\n                onRemove={handleRemove}\n                onMoveUp={handleMoveUp}\n                onMoveDown={handleMoveDown}\n                canMoveUp={canMoveUp}\n                canMoveDown={canMoveDown}\n              />\n            </CardContent>\n          )}\n        </Card>\n      )}\n    </Draggable>\n  );\n});\n\nMemoizedBlockCard.displayName = 'MemoizedBlockCard';\n\nexport const OptimizedTemplateEditor = React.memo(({ \n  blocks, \n  onBlocksChange\n}: OptimizedTemplateEditorProps) => {\n  const { t } = useTranslation('pages');\n  const [activeBlock, setActiveBlock] = useState<string | null>(null);\n  const [showAddBlock, setShowAddBlock] = useState(false);\n\n  const addBlock = useCallback((type: TemplateBlock[\"type\"]) => {\n    const newBlock: TemplateBlock = {\n      id: `block-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      type,\n      data: getDefaultBlockData(type),\n      visible: true,\n      order: blocks.length,\n    };\n    \n    const newBlocks = [...blocks, newBlock];\n    onBlocksChange(newBlocks);\n    setActiveBlock(newBlock.id);\n    setShowAddBlock(false);\n  }, [blocks, onBlocksChange]);\n\n  const updateBlock = useCallback((blockId: string, data: any) => {\n    const newBlocks = blocks.map(block => \n      block.id === blockId ? { ...block, data } : block\n    );\n    onBlocksChange(newBlocks);\n  }, [blocks, onBlocksChange]);\n\n  const toggleBlockVisibility = useCallback((blockId: string) => {\n    const newBlocks = blocks.map(block => \n      block.id === blockId ? { ...block, visible: !block.visible } : block\n    );\n    onBlocksChange(newBlocks);\n  }, [blocks, onBlocksChange]);\n\n  const removeBlock = useCallback((blockId: string) => {\n    const newBlocks = blocks.filter(block => block.id !== blockId);\n    onBlocksChange(newBlocks);\n    if (activeBlock === blockId) {\n      setActiveBlock(null);\n    }\n  }, [blocks, onBlocksChange, activeBlock]);\n\n  const moveBlock = useCallback((blockId: string, direction: \"up\" | \"down\") => {\n    const blockIndex = blocks.findIndex(b => b.id === blockId);\n    if (blockIndex === -1) return;\n    \n    const newIndex = direction === \"up\" ? blockIndex - 1 : blockIndex + 1;\n    if (newIndex < 0 || newIndex >= blocks.length) return;\n    \n    const newBlocks = [...blocks];\n    [newBlocks[blockIndex], newBlocks[newIndex]] = [newBlocks[newIndex], newBlocks[blockIndex]];\n    \n    // Update order values\n    newBlocks.forEach((block, index) => {\n      block.order = index;\n    });\n    \n    onBlocksChange(newBlocks);\n  }, [blocks, onBlocksChange]);\n\n  const onDragEnd = useCallback((result: DropResult) => {\n    if (!result.destination) return;\n\n    const items = Array.from(blocks);\n    const [reorderedItem] = items.splice(result.source.index, 1);\n    items.splice(result.destination.index, 0, reorderedItem);\n\n    // Update order values\n    const updatedItems = items.map((item, index) => ({\n      ...item,\n      order: index\n    }));\n\n    onBlocksChange(updatedItems);\n  }, [blocks, onBlocksChange]);\n\n  const handleShowAddBlock = useCallback(() => {\n    setShowAddBlock(true);\n  }, []);\n\n  const handleSetShowAddBlock = useCallback((show: boolean) => {\n    setShowAddBlock(show);\n  }, []);\n\n  // Memoize the blocks list to prevent unnecessary re-renders\n  const memoizedBlocks = useMemo(() => {\n    return blocks.map((block, index) => (\n      <MemoizedBlockCard\n        key={block.id}\n        block={block}\n        index={index}\n        isActive={activeBlock === block.id}\n        onActivate={setActiveBlock}\n        onToggleVisibility={toggleBlockVisibility}\n        onUpdate={updateBlock}\n        onRemove={removeBlock}\n        onMove={moveBlock}\n        canMoveUp={index > 0}\n        canMoveDown={index < blocks.length - 1}\n        totalBlocks={blocks.length}\n      />\n    ));\n  }, [blocks, activeBlock, toggleBlockVisibility, updateBlock, removeBlock, moveBlock]);\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* Header */}\n      <div className=\"border-b px-6 py-4\">\n        <div>\n          <h2 className=\"font-semibold\">{t('templateBuilder.editor.title')}</h2>\n          <p className=\"text-sm text-muted-foreground\">{t('templateBuilder.editor.description')}</p>\n        </div>\n      </div>\n\n      {/* Blocks List */}\n      <div className=\"flex-1 overflow-y-auto p-6 space-y-4\">\n        <DragDropContext onDragEnd={onDragEnd}>\n          <Droppable droppableId=\"template-blocks\">\n            {(provided) => (\n              <div\n                {...provided.droppableProps}\n                ref={provided.innerRef}\n                className=\"space-y-4\"\n              >\n                {memoizedBlocks}\n                {provided.placeholder}\n              </div>\n            )}\n          </Droppable>\n        </DragDropContext>\n\n        {/* Add Block Button */}\n        <Button\n          variant=\"outline\"\n          className=\"w-full h-12 border-dashed\"\n          onClick={handleShowAddBlock}\n        >\n          <Plus className=\"h-4 w-4\" />\n          {t('templateBuilder.editor.addBlock')}\n        </Button>\n      </div>\n\n      {/* Add Block Sheet */}\n      <AddBlockSheet\n        open={showAddBlock}\n        onOpenChange={handleSetShowAddBlock}\n        onAddBlock={addBlock}\n      />\n    </div>\n  );\n});\n\nOptimizedTemplateEditor.displayName = 'OptimizedTemplateEditor';\n\nfunction getDefaultBlockData(type: TemplateBlock[\"type\"]): BlockData {\n  switch (type) {\n    case \"text\":\n      return {\n        content: \"Enter your text here...\",\n        formatting: {\n          fontSize: \"p\" as const,\n          fontFamily: \"Arial\",\n          alignment: \"left\" as const,\n        },\n      } as TextBlockData;\n    case \"session-details\":\n      return {\n        showDate: true,\n        showTime: true,\n        showLocation: true,\n        showNotes: false,\n      } as SessionDetailsBlockData;\n    case \"cta\":\n      return {\n        text: \"Book Now\",\n        variant: \"primary\" as const,\n      } as CTABlockData;\n    case \"image\":\n      return {\n        placeholder: true,\n        alt: \"Image\",\n      } as ImageBlockData;\n    case \"footer\":\n      return {\n        showLogo: true,\n        showStudioName: true,\n        showContactInfo: true,\n      } as FooterBlockData;\n    case \"divider\":\n      return {\n        style: \"line\" as const,\n        color: \"#e5e5e5\",\n      };\n    case \"columns\":\n      return {\n        columns: 2,\n        content: [\"Column 1 content...\", \"Column 2 content...\"],\n      };\n    case \"social-links\":\n      return {\n        channelVisibility: {},\n      };\n    case \"header\":\n      return {\n        showLogo: true,\n        tagline: \"Professional Photography\",\n        backgroundColor: \"#ffffff\",\n      };\n    case \"raw-html\":\n      return {\n        html: \"<div>Your custom HTML here...</div>\",\n        sanitized: false,\n      };\n    default:\n      return {} as any;\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/OptimizedTemplatePreview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/PlainTextPreview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/StorageQuotaDisplay.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchAssets' and 'fetchStorageUsage'. Either include them or remove the dependency array.","line":117,"column":6,"nodeType":"ArrayExpression","endLine":117,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [activeOrganization?.id, fetchAssets, fetchStorageUsage]","fix":{"range":[3279,3303],"text":"[activeOrganization?.id, fetchAssets, fetchStorageUsage]"}}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":226,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":226,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Progress } from '@/components/ui/progress';\nimport { Badge } from '@/components/ui/badge';\nimport { AlertTriangle, Image as ImageIcon, Trash2 } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/hooks/use-toast';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useOrganization } from '@/contexts/OrganizationContext';\nimport { useAuth } from '@/contexts/AuthContext';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\n\ninterface StorageUsage {\n  total_images: number;\n  total_storage_bytes: number;\n}\n\ninterface TemplateAsset {\n  id: string;\n  file_name: string;\n  file_path: string;\n  file_size: number;\n  created_at: string;\n}\n\nconst STORAGE_LIMITS = {\n  MAX_IMAGES: 20,\n  MAX_STORAGE_BYTES: 50 * 1024 * 1024, // 50MB\n};\n\nexport function StorageQuotaDisplay() {\n  const [storageUsage, setStorageUsage] = useState<StorageUsage | null>(null);\n  const [assets, setAssets] = useState<TemplateAsset[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [isImageLibraryOpen, setIsImageLibraryOpen] = useState(false);\n  const { activeOrganization } = useOrganization();\n  const { user } = useAuth();\n  const { toast } = useToast();\n\n  const fetchStorageUsage = async () => {\n    if (!activeOrganization?.id) return;\n\n    try {\n      const { data: usage } = await supabase\n        .from('template_image_usage')\n        .select('total_images, total_storage_bytes')\n        .eq('organization_id', activeOrganization.id)\n        .single();\n\n      setStorageUsage(usage || { total_images: 0, total_storage_bytes: 0 });\n    } catch (error) {\n      console.error('Error fetching storage usage:', error);\n      setStorageUsage({ total_images: 0, total_storage_bytes: 0 });\n    }\n  };\n\n  const fetchAssets = async () => {\n    if (!activeOrganization?.id) return;\n\n    try {\n      const { data: assetList } = await supabase\n        .from('template_assets')\n        .select('id, file_name, file_path, file_size, created_at')\n        .eq('organization_id', activeOrganization.id)\n        .order('created_at', { ascending: false });\n\n      setAssets(assetList || []);\n    } catch (error) {\n      console.error('Error fetching assets:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const deleteAsset = async (asset: TemplateAsset) => {\n    try {\n      // Delete from storage\n      await supabase.storage\n        .from('template-images')\n        .remove([asset.file_path]);\n\n      // Delete from database (this will trigger the usage update)\n      await supabase\n        .from('template_assets')\n        .delete()\n        .eq('id', asset.id);\n\n      // Refresh data\n      await fetchStorageUsage();\n      await fetchAssets();\n\n      toast({\n        title: 'Success',\n        description: 'Image deleted successfully',\n      });\n    } catch (error) {\n      console.error('Error deleting asset:', error);\n      toast({\n        title: 'Error',\n        description: 'Failed to delete image',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  useEffect(() => {\n    if (activeOrganization?.id) {\n      fetchStorageUsage();\n      fetchAssets();\n    }\n  }, [activeOrganization?.id]);\n\n  if (loading || !storageUsage) {\n    return (\n      <div className=\"p-4 bg-muted rounded-lg\">\n        <div className=\"text-sm text-muted-foreground\">Loading storage info...</div>\n      </div>\n    );\n  }\n\n  const storagePercentage = (storageUsage.total_storage_bytes / STORAGE_LIMITS.MAX_STORAGE_BYTES) * 100;\n  const imagesPercentage = (storageUsage.total_images / STORAGE_LIMITS.MAX_IMAGES) * 100;\n  const storageInMB = storageUsage.total_storage_bytes / (1024 * 1024);\n\n  const isStorageNearLimit = storagePercentage > 80;\n  const isImagesNearLimit = imagesPercentage > 80;\n  const isStorageAtLimit = storagePercentage >= 100;\n  const isImagesAtLimit = imagesPercentage >= 100;\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"p-4 bg-muted rounded-lg\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <h3 className=\"text-sm font-medium\">Storage Usage</h3>\n          <Dialog open={isImageLibraryOpen} onOpenChange={setIsImageLibraryOpen}>\n            <DialogTrigger asChild>\n              <Button variant=\"outline\" size=\"sm\">\n                <ImageIcon className=\"w-4 h-4 mr-2\" />\n                Manage Images\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-hidden\">\n              <DialogHeader>\n                <DialogTitle>Image Library</DialogTitle>\n                <DialogDescription>\n                  Manage your uploaded template images\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"overflow-y-auto max-h-[60vh] space-y-3\">\n                {assets.length === 0 ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    No images uploaded yet\n                  </div>\n                ) : (\n                  assets.map((asset) => (\n                    <div key={asset.id} className=\"flex items-center justify-between p-3 border rounded-lg\">\n                      <div className=\"flex-1\">\n                        <div className=\"font-medium text-sm\">{asset.file_name}</div>\n                        <div className=\"text-xs text-muted-foreground\">\n                          {(asset.file_size / 1024).toFixed(1)} KB â€¢ {new Date(asset.created_at).toLocaleDateString()}\n                        </div>\n                      </div>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => deleteAsset(asset)}\n                        className=\"text-destructive hover:text-destructive\"\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </Button>\n                    </div>\n                  ))\n                )}\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n        \n        <div className=\"space-y-3\">\n          <div>\n            <div className=\"flex items-center justify-between text-xs mb-1\">\n              <span>Images ({storageUsage.total_images}/{STORAGE_LIMITS.MAX_IMAGES})</span>\n              {(isImagesNearLimit || isImagesAtLimit) && (\n                <Badge variant={isImagesAtLimit ? \"destructive\" : \"secondary\"} className=\"text-xs\">\n                  {isImagesAtLimit ? <AlertTriangle className=\"w-3 h-3 mr-1\" /> : null}\n                  {isImagesAtLimit ? 'Limit Reached' : 'Near Limit'}\n                </Badge>\n              )}\n            </div>\n            <Progress value={imagesPercentage} className=\"h-2\" />\n          </div>\n\n          <div>\n            <div className=\"flex items-center justify-between text-xs mb-1\">\n              <span>Storage ({storageInMB.toFixed(1)}/50 MB)</span>\n              {(isStorageNearLimit || isStorageAtLimit) && (\n                <Badge variant={isStorageAtLimit ? \"destructive\" : \"secondary\"} className=\"text-xs\">\n                  {isStorageAtLimit ? <AlertTriangle className=\"w-3 h-3 mr-1\" /> : null}\n                  {isStorageAtLimit ? 'Limit Reached' : 'Near Limit'}\n                </Badge>\n              )}\n            </div>\n            <Progress value={storagePercentage} className=\"h-2\" />\n          </div>\n        </div>\n\n        {(isStorageAtLimit || isImagesAtLimit) && (\n          <div className=\"mt-3 p-2 bg-destructive/10 border border-destructive/20 rounded text-xs text-destructive\">\n            <div className=\"flex items-center gap-1\">\n              <AlertTriangle className=\"w-3 h-3\" />\n              Upload limit reached. Delete some images to free up space.\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport function checkStorageLimits(currentUsage: StorageUsage, newFileSize: number): { \n  canUpload: boolean; \n  reason?: string; \n} {\n  if (currentUsage.total_images >= STORAGE_LIMITS.MAX_IMAGES) {\n    return { \n      canUpload: false, \n      reason: `Maximum number of images (${STORAGE_LIMITS.MAX_IMAGES}) reached. Please delete some images first.` \n    };\n  }\n\n  if (currentUsage.total_storage_bytes + newFileSize > STORAGE_LIMITS.MAX_STORAGE_BYTES) {\n    const remainingMB = (STORAGE_LIMITS.MAX_STORAGE_BYTES - currentUsage.total_storage_bytes) / (1024 * 1024);\n    return { \n      canUpload: false, \n      reason: `Not enough storage space. Only ${remainingMB.toFixed(1)}MB remaining.` \n    };\n  }\n\n  return { canUpload: true };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/TemplateErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/TemplateNameDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/TemplatePreview.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3056,3059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3056,3059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":141,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5181,5184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5181,5184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Button } from \"@/components/ui/button\";\nimport { Send, Monitor, Smartphone } from \"lucide-react\";\nimport { TemplateBlock } from \"@/types/templateBuilder\";\nimport { EmailPreview } from \"./previews/EmailPreview\";\nimport { WhatsAppPreview } from \"./previews/WhatsAppPreview\";\nimport { SMSPreview } from \"./previews/SMSPreview\";\nimport { PlainTextPreview } from \"./PlainTextPreview\";\nimport { cn } from \"@/lib/utils\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface TemplatePreviewProps {\n  blocks: TemplateBlock[];\n  activeChannel: \"email\" | \"whatsapp\" | \"sms\" | \"plaintext\";\n  onChannelChange: (channel: \"email\" | \"whatsapp\" | \"sms\" | \"plaintext\") => void;\n  emailSubject?: string;\n  preheader?: string;\n  previewData?: Record<string, string>;\n}\n\nexport function TemplatePreview({ blocks, activeChannel, onChannelChange, emailSubject, preheader, previewData }: TemplatePreviewProps) {\n  const [previewDevice, setPreviewDevice] = useState<\"desktop\" | \"mobile\">(\"desktop\");\n  const [isLoading, setIsLoading] = useState(false);\n  const { user } = useAuth();\n  const { t, i18n } = useTranslation('pages');\n\n  const defaultMockData = {\n    customer_name: t('templateBuilder.preview.mockData.customerName'),\n    session_date: t('templateBuilder.preview.mockData.sessionDate'),\n    session_time: t('templateBuilder.preview.mockData.sessionTime'),\n    session_location: t('templateBuilder.preview.mockData.sessionLocation'),\n    business_name: t('templateBuilder.preview.mockData.businessName'),\n    business_phone: t('templateBuilder.preview.mockData.businessPhone'),\n  };\n\n  const mockData = previewData || defaultMockData;\n\n  const sendTestEmail = async () => {\n    if (!user?.email) {\n      toast({\n        title: t('templateBuilder.preview.toast.errorTitle'),\n        description: t('templateBuilder.preview.toast.noUserEmail'),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (blocks.length === 0) {\n      toast({\n        title: t('templateBuilder.preview.toast.errorTitle'), \n        description: t('templateBuilder.preview.toast.noBlocks'),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsLoading(true);\n    \n    try {\n      const { data, error } = await supabase.functions.invoke('send-template-email', {\n        body: {\n          to: user.email,\n          subject: emailSubject || 'Test Email from Template Builder',\n          preheader: preheader,\n          blocks: blocks.filter(b => b.visible),\n          mockData: mockData,\n          isTest: true\n        }\n      });\n\n      if (error) {\n        throw error;\n      }\n\n      toast({\n        title: t('templateBuilder.preview.toast.successTitle'),\n        description: t('templateBuilder.preview.toast.testEmailSent', { email: user.email }),\n      });\n    } catch (error: any) {\n      console.error('Error sending test email:', error);\n      toast({\n        title: t('templateBuilder.preview.toast.errorTitle'),\n        description: error.message || t('templateBuilder.preview.toast.sendFailed'),\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* Header */}\n      <div className=\"border-b px-6 py-4\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"font-semibold\">{t('templateBuilder.preview.title')}</h2>\n            <p className=\"text-sm text-muted-foreground\">{t('templateBuilder.preview.description')}</p>\n          </div>\n          \n          <div className=\"flex items-center gap-2\">\n            {activeChannel === \"email\" && (\n              <>\n                <Button\n                  size=\"sm\"\n                  variant={previewDevice === \"desktop\" ? \"default\" : \"ghost\"}\n                  onClick={() => setPreviewDevice(\"desktop\")}\n                >\n                  <Monitor className=\"h-4 w-4\" />\n                  {t('templateBuilder.preview.desktop')}\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant={previewDevice === \"mobile\" ? \"default\" : \"ghost\"}\n                  onClick={() => setPreviewDevice(\"mobile\")}\n                >\n                  <Smartphone className=\"h-4 w-4\" />\n                  {t('templateBuilder.preview.mobile')}\n                </Button>\n              </>\n            )}\n            <Button \n              size=\"sm\" \n              variant=\"outline\"\n              onClick={sendTestEmail}\n              disabled={isLoading || blocks.length === 0}\n            >\n              <Send className=\"h-4 w-4\" />\n              {isLoading ? t('templateBuilder.preview.sending') : t('templateBuilder.preview.testSend')}\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Channel Tabs */}\n      <div className=\"border-b px-6 py-2\">\n        <Tabs value={activeChannel} onValueChange={(value) => onChannelChange(value as any)}>\n          <TabsList className=\"grid grid-cols-4 w-full max-w-lg\">\n            <TabsTrigger value=\"email\" className=\"flex items-center gap-2\">\n              ðŸ“§ {t('templateBuilder.preview.channels.email')}\n            </TabsTrigger>\n            <TabsTrigger value=\"whatsapp\" className=\"flex items-center gap-2\">\n              ðŸ’¬ {t('templateBuilder.preview.channels.whatsapp')}\n            </TabsTrigger>\n            <TabsTrigger value=\"sms\" className=\"flex items-center gap-2\">\n              ðŸ“± {t('templateBuilder.preview.channels.sms')}\n            </TabsTrigger>\n            <TabsTrigger value=\"plaintext\" className=\"flex items-center gap-2\">\n              ðŸ“„ {t('templateBuilder.preview.channels.plain')}\n            </TabsTrigger>\n          </TabsList>\n        </Tabs>\n      </div>\n\n      {/* Preview Content */}\n      <div className=\"flex-1 overflow-y-auto p-6\">\n        <div className={cn(\n          \"mx-auto transition-all duration-200\",\n          activeChannel === \"email\" \n            ? previewDevice === \"desktop\" \n              ? \"max-w-2xl\" \n              : \"max-w-sm\"\n            : activeChannel === \"plaintext\"\n              ? \"max-w-2xl\"\n              : \"max-w-sm\"\n        )}>\n          {activeChannel === \"email\" && (\n            <EmailPreview\n              blocks={blocks.filter(b => b.visible)}\n              mockData={mockData}\n              device={previewDevice}\n              emailSubject={emailSubject}\n              preheader={preheader}\n            />\n          )}\n          \n          {activeChannel === \"whatsapp\" && (\n            <WhatsAppPreview\n              blocks={blocks.filter(b => b.visible)}\n              mockData={mockData}\n            />\n          )}\n          \n          {activeChannel === \"sms\" && (\n            <SMSPreview\n              blocks={blocks.filter(b => b.visible)}\n              mockData={mockData}\n            />\n          )}\n\n          {activeChannel === \"plaintext\" && (\n            <PlainTextPreview\n              blocks={blocks.filter(b => b.visible)}\n              mockData={mockData}\n            />\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/VariablePicker.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1041,1044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1041,1044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from \"@/components/ui/command\";\nimport { Plus, Check } from \"lucide-react\";\nimport { useTemplateVariables } from \"@/hooks/useTemplateVariables\";\n\ninterface VariablePickerProps {\n  onVariableSelect: (variable: string) => void;\n  trigger?: React.ReactNode;\n}\n\nexport function VariablePicker({ onVariableSelect, trigger }: VariablePickerProps) {\n  const [open, setOpen] = useState(false);\n  const { variables, loading } = useTemplateVariables();\n\n  const handleSelect = (variableKey: string) => {\n    onVariableSelect(`{${variableKey}}`);\n    setOpen(false);\n  };\n\n  const groupedVariables = variables.reduce((acc, variable) => {\n    if (!acc[variable.category]) {\n      acc[variable.category] = [];\n    }\n    acc[variable.category].push(variable);\n    return acc;\n  }, {} as Record<string, any[]>);\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild>\n        {trigger || (\n          <Button variant=\"outline\" size=\"sm\">\n            <Plus className=\"h-3 w-3\" />\n            Variable\n          </Button>\n        )}\n      </PopoverTrigger>\n      <PopoverContent className=\"w-80 p-0\" align=\"start\">\n        <Command>\n          <CommandInput placeholder=\"Search variables...\" />\n          <CommandList>\n            <CommandEmpty>No variables found.</CommandEmpty>\n            {loading ? (\n              <div className=\"p-4 text-center text-muted-foreground\">\n                Loading variables...\n              </div>\n            ) : (\n              Object.entries(groupedVariables).map(([category, vars]) => (\n                <CommandGroup key={category} heading={category}>\n                  {vars.map((variable) => (\n                    <CommandItem\n                      key={variable.key}\n                      onSelect={() => handleSelect(variable.key)}\n                      className=\"cursor-pointer\"\n                    >\n                      <Check className=\"mr-2 h-4 w-4 opacity-0\" />\n                      <div>\n                        <div className=\"font-medium\">{variable.label}</div>\n                        <div className=\"text-xs text-muted-foreground\">{`{${variable.key}}`}</div>\n                      </div>\n                    </CommandItem>\n                  ))}\n                </CommandGroup>\n              ))\n            )}\n          </CommandList>\n        </Command>\n      </PopoverContent>\n    </Popover>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/__tests__/CompactStorageIndicator.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/__tests__/ImageLibrarySheet.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/__tests__/ImageUpload.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/__tests__/InlineEditors.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/__tests__/StorageQuotaDisplay.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/__tests__/TemplateBuilderAssets.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/__tests__/TemplateBuilderDialogs.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/__tests__/TemplateBuilderEditors.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/__tests__/TemplateBuilderPreview.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/__tests__/TemplateBuilderStorage.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":20,"column":18,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":20,"endColumn":59},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[601,604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[601,604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[613,616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[613,616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen, waitFor, fireEvent } from \"@/utils/testUtils\";\nimport { CompactStorageIndicator } from \"../CompactStorageIndicator\";\n\njest.mock(\"@/contexts/OrganizationContext\", () => ({\n  useOrganization: jest.fn(() => ({ activeOrganization: { id: \"org-1\" } })),\n}));\n\njest.mock(\"@/integrations/supabase/client\", () => ({\n  supabase: {\n    from: jest.fn(),\n  },\n}));\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: jest.fn(() => ({\n    t: (key: string) => key,\n  })),\n}));\n\nconst supabase = require(\"@/integrations/supabase/client\").supabase;\n\nfunction mockStorageUsageResponse(data: any, error: any = null) {\n  (supabase.from as jest.Mock).mockImplementation(() => ({\n    select: jest.fn().mockReturnValue({\n      eq: jest.fn().mockReturnValue({\n        single: jest.fn().mockResolvedValue({ data, error }),\n      }),\n    }),\n  }));\n}\n\ndescribe(\"CompactStorageIndicator\", () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it(\"displays usage details and near-limit badge when approaching limits\", async () => {\n    mockStorageUsageResponse({\n      total_images: 45,\n      total_storage_bytes: 40 * 1024 * 1024,\n    });\n\n    const onManageImages = jest.fn();\n\n    render(<CompactStorageIndicator onManageImages={onManageImages} />);\n\n    await waitFor(() =>\n      expect(screen.getByText(\"45/50 images\")).toBeInTheDocument()\n    );\n\n    expect(screen.getByText(\"Near Limit\")).toBeInTheDocument();\n\n    fireEvent.click(screen.getByRole(\"button\", { name: /Manage/i }));\n    expect(onManageImages).toHaveBeenCalled();\n  });\n\n  it(\"shows limit reached badge when thresholds are exceeded\", async () => {\n    mockStorageUsageResponse({\n      total_images: 50,\n      total_storage_bytes: 52 * 1024 * 1024,\n    });\n\n    render(<CompactStorageIndicator />);\n\n    await waitFor(() =>\n      expect(screen.getByText(\"50/50 images\")).toBeInTheDocument()\n    );\n\n    expect(screen.getByText(\"Limit Reached\")).toBeInTheDocument();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/__tests__/TemplatePreview.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":43,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":43,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { fireEvent, render, screen, waitFor } from \"@/utils/testUtils\";\nimport { TemplatePreview } from \"../TemplatePreview\";\nimport { PlainTextPreview } from \"../PlainTextPreview\";\nimport { SMSPreview } from \"../previews/SMSPreview\";\nimport { WhatsAppPreview } from \"../previews/WhatsAppPreview\";\nimport { EmailPreview } from \"../previews/EmailPreview\";\nimport type { TemplateBlock } from \"@/types/templateBuilder\";\n\nconst toastMock = jest.fn();\nconst invokeMock = jest.fn();\nconst useAuthMock = jest.fn();\nconst useOrganizationSettingsMock = jest.fn(() => ({ settings: null }));\nconst generatePlainTextMock = jest.fn(() => \"Plain text body\");\n\njest.mock(\"@/hooks/use-toast\", () => ({\n  toast: (...args: unknown[]) => toastMock(...args),\n  useToast: () => ({ toast: (...args: unknown[]) => toastMock(...args) }),\n}));\n\njest.mock(\"@/integrations/supabase/client\", () => ({\n  supabase: {\n    functions: {\n      invoke: (...args: unknown[]) => invokeMock(...args),\n    },\n  },\n}));\n\njest.mock(\"@/contexts/AuthContext\", () => ({\n  useAuth: () => useAuthMock(),\n}));\n\njest.mock(\"@/hooks/useOrganizationSettings\", () => ({\n  useOrganizationSettings: () => useOrganizationSettingsMock(),\n}));\n\njest.mock(\"@/lib/templateUtils\", () => ({\n  ...jest.requireActual(\"@/lib/templateUtils\"),\n  generatePlainText: (...args: unknown[]) => generatePlainTextMock(...args),\n}));\n\njest.mock(\"@/components/ui/tabs\", () => {\n  const React = require(\"react\");\n  const TabsContext = React.createContext<{ onValueChange?: (value: string) => void }>({});\n\n  const Tabs = ({\n    onValueChange,\n    children,\n  }: {\n    onValueChange?: (value: string) => void;\n    children: React.ReactNode;\n  }) => <TabsContext.Provider value={{ onValueChange }}>{children}</TabsContext.Provider>;\n\n  const TabsList = ({ children, ...props }: { children: React.ReactNode }) => <div {...props}>{children}</div>;\n\n  const TabsTrigger = ({\n    value,\n    children,\n    ...props\n  }: {\n    value: string;\n    children: React.ReactNode;\n  } & React.ButtonHTMLAttributes<HTMLButtonElement>) => {\n    const ctx = React.useContext(TabsContext);\n    return (\n      <button\n        type=\"button\"\n        {...props}\n        onClick={() => ctx.onValueChange?.(value)}\n      >\n        {children}\n      </button>\n    );\n  };\n\n  const TabsContent = ({ children, ...props }: { children: React.ReactNode }) => <div {...props}>{children}</div>;\n\n  return {\n    Tabs,\n    TabsList,\n    TabsTrigger,\n    TabsContent,\n  };\n});\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string, options?: Record<string, unknown>) => {\n      if (options?.name) return `${key}:${options.name}`;\n      if (options?.email) return `${key}:${options.email}`;\n      return key;\n    },\n    i18n: { language: \"en\", changeLanguage: jest.fn() },\n  }),\n}));\n\nconst clipboardWriteMock = jest.fn().mockResolvedValue(undefined);\n\nbeforeAll(() => {\n  Object.assign(navigator, {\n    clipboard: {\n      writeText: clipboardWriteMock,\n    },\n  });\n});\n\nbeforeEach(() => {\n  toastMock.mockClear();\n  invokeMock.mockReset().mockResolvedValue({ data: { ok: true }, error: null });\n  clipboardWriteMock.mockClear();\n  useOrganizationSettingsMock.mockReturnValue({ settings: null });\n  useAuthMock.mockReturnValue({ user: { email: \"user@example.com\" } });\n  generatePlainTextMock.mockReturnValue(\"Plain text body\");\n});\n\nconst sampleBlocks: TemplateBlock[] = [\n  {\n    id: \"block-1\",\n    type: \"text\",\n    visible: true,\n    order: 0,\n    data: {\n      content: \"Hello {customer_name}\",\n      formatting: {\n        fontSize: \"p\",\n      },\n    },\n  },\n];\n\nconst previewData = {\n  customer_name: \"Alice Example\",\n  session_date: \"Aug 12\",\n  session_time: \"2:00 PM\",\n  session_location: \"Studio 5\",\n  business_name: \"Lumiso Studios\",\n  business_phone: \"555-1234\",\n};\n\ndescribe(\"TemplatePreview\", () => {\n  it(\"switches channels when tabs are selected\", () => {\n    const onChannelChange = jest.fn();\n\n    render(\n      <TemplatePreview\n        blocks={sampleBlocks}\n        activeChannel=\"email\"\n        onChannelChange={onChannelChange}\n        previewData={previewData}\n      />\n    );\n\n    fireEvent.click(screen.getByRole(\"button\", { name: /templateBuilder\\.preview\\.channels\\.whatsapp/ }));\n    expect(onChannelChange).toHaveBeenCalledWith(\"whatsapp\");\n\n    fireEvent.click(screen.getByRole(\"button\", { name: /templateBuilder\\.preview\\.channels\\.sms/ }));\n    expect(onChannelChange).toHaveBeenCalledWith(\"sms\");\n  });\n\n  it(\"sends a test email when user has an email and blocks exist\", async () => {\n    render(\n      <TemplatePreview\n        blocks={sampleBlocks}\n        activeChannel=\"email\"\n        onChannelChange={jest.fn()}\n        emailSubject=\"Subject {customer_name}\"\n        preheader=\"Preheader\"\n        previewData={previewData}\n      />\n    );\n\n    fireEvent.click(screen.getByRole(\"button\", { name: /templateBuilder\\.preview\\.testSend/ }));\n\n    await waitFor(() => {\n      expect(invokeMock).toHaveBeenCalledWith(\n        \"send-template-email\",\n        expect.objectContaining({\n          body: expect.objectContaining({\n            to: \"user@example.com\",\n            blocks: expect.arrayContaining([\n              expect.objectContaining({ id: \"block-1\" }),\n            ]),\n          }),\n        })\n      );\n    });\n\n    expect(toastMock).toHaveBeenCalledWith({\n      title: \"templateBuilder.preview.toast.successTitle\",\n      description: \"templateBuilder.preview.toast.testEmailSent:user@example.com\",\n    });\n  });\n\n  it(\"shows an error toast when no user email is present\", () => {\n    useAuthMock.mockReturnValue({ user: { email: null } });\n\n    render(\n      <TemplatePreview\n        blocks={sampleBlocks}\n        activeChannel=\"email\"\n        onChannelChange={jest.fn()}\n        previewData={previewData}\n      />\n    );\n\n    fireEvent.click(screen.getByRole(\"button\", { name: /templateBuilder\\.preview\\.testSend/ }));\n\n    expect(invokeMock).not.toHaveBeenCalled();\n    expect(toastMock).toHaveBeenCalledWith({\n      title: \"templateBuilder.preview.toast.errorTitle\",\n      description: \"templateBuilder.preview.toast.noUserEmail\",\n      variant: \"destructive\",\n    });\n  });\n\n  it(\"disables test send when no blocks are present\", () => {\n    render(\n      <TemplatePreview\n        blocks={[]}\n        activeChannel=\"email\"\n        onChannelChange={jest.fn()}\n        previewData={previewData}\n      />\n    );\n\n    const sendButton = screen.getByRole(\"button\", { name: /templateBuilder\\.preview\\.testSend/ });\n    expect(sendButton).toBeDisabled();\n    fireEvent.click(sendButton);\n    expect(invokeMock).not.toHaveBeenCalled();\n    expect(toastMock).not.toHaveBeenCalled();\n  });\n\n  it(\"surfaces Supabase errors from sendTestEmail\", async () => {\n    invokeMock.mockResolvedValueOnce({ data: null, error: { message: \"Send failed\" } });\n\n    render(\n      <TemplatePreview\n        blocks={sampleBlocks}\n        activeChannel=\"email\"\n        onChannelChange={jest.fn()}\n        previewData={previewData}\n      />\n    );\n\n    fireEvent.click(screen.getByRole(\"button\", { name: /templateBuilder\\.preview\\.testSend/ }));\n\n    await waitFor(() => {\n      expect(toastMock).toHaveBeenCalledWith({\n        title: \"templateBuilder.preview.toast.errorTitle\",\n        description: \"Send failed\",\n        variant: \"destructive\",\n      });\n    });\n  });\n\n  it(\"switches email preview device between desktop and mobile\", () => {\n    render(\n      <TemplatePreview\n        blocks={sampleBlocks}\n        activeChannel=\"email\"\n        onChannelChange={jest.fn()}\n        previewData={previewData}\n      />\n    );\n\n    const previewContainerBefore = document.querySelector(\".mx-auto.transition-all\");\n    expect(previewContainerBefore?.className).toContain(\"max-w-2xl\");\n\n    fireEvent.click(screen.getByRole(\"button\", { name: /templateBuilder\\.preview\\.mobile/ }));\n\n    const previewContainerAfter = document.querySelector(\".mx-auto.transition-all\");\n    expect(previewContainerAfter?.className).toContain(\"max-w-sm\");\n  });\n\n  it(\"renders WhatsApp preview when channel is whatsapp\", () => {\n    render(\n      <TemplatePreview\n        blocks={sampleBlocks}\n        activeChannel=\"whatsapp\"\n        onChannelChange={jest.fn()}\n        previewData={previewData}\n      />\n    );\n\n    expect(screen.getByText(/templateBuilder\\.preview\\.whatsapp\\.online/)).toBeInTheDocument();\n    expect(screen.getByText(/Hello ðŸ‘‹ Alice Example/)).toBeInTheDocument();\n  });\n\n  it(\"renders SMS preview when channel is sms\", () => {\n    render(\n      <TemplatePreview\n        blocks={sampleBlocks}\n        activeChannel=\"sms\"\n        onChannelChange={jest.fn()}\n        previewData={previewData}\n      />\n    );\n\n    expect(screen.getByText(/templateBuilder\\.preview\\.sms\\.label/)).toBeInTheDocument();\n    expect(screen.getByText(/templateBuilder\\.preview\\.sms\\.characters/)).toBeInTheDocument();\n  });\n});\n\ndescribe(\"PlainTextPreview\", () => {\n  it(\"copies generated text to the clipboard\", async () => {\n    render(<PlainTextPreview blocks={sampleBlocks} mockData={previewData} />);\n\n    fireEvent.click(screen.getByRole(\"button\", { name: \"Copy plain text preview\" }));\n\n    await waitFor(() => {\n      expect(generatePlainTextMock).toHaveBeenCalled();\n      expect(clipboardWriteMock).toHaveBeenCalledWith(\"Plain text body\");\n      expect(toastMock).toHaveBeenCalledWith({\n        title: \"Copied to clipboard\",\n        description: \"Plain text version has been copied to your clipboard.\",\n      });\n    });\n  });\n});\n\ndescribe(\"SMSPreview\", () => {\n  it(\"displays character counts and long message warning\", () => {\n    const longText = \"A\".repeat(170);\n    const smsBlock: TemplateBlock = {\n      id: \"sms-block\",\n      type: \"text\",\n      visible: true,\n      order: 0,\n      data: {\n        content: longText,\n        formatting: { fontSize: \"p\" },\n      },\n    };\n\n    render(<SMSPreview blocks={[smsBlock]} mockData={previewData} />);\n\n    expect(screen.getByText(/170/)).toBeInTheDocument();\n    expect(screen.getByText(/templateBuilder\\.preview\\.sms\\.longMessageWarning/)).toBeInTheDocument();\n  });\n});\n\ndescribe(\"WhatsAppPreview\", () => {\n  it(\"renders fallback content when no blocks are visible\", () => {\n    render(<WhatsAppPreview blocks={[]} mockData={previewData} />);\n\n    expect(screen.getByText(/templateBuilder\\.preview\\.excitedMessage/)).toBeInTheDocument();\n    expect(screen.getByText(/templateBuilder\\.preview\\.addBlocks/)).toBeInTheDocument();\n  });\n});\n\ndescribe(\"EmailPreview\", () => {\n  it(\"replaces template variables in text blocks\", () => {\n    render(\n      <EmailPreview\n        blocks={sampleBlocks}\n        mockData={previewData}\n        device=\"desktop\"\n        emailSubject=\"Subject for {customer_name}\"\n        preheader=\"Preheader for {business_name}\"\n      />\n    );\n\n    expect(screen.getByText(/Hello Alice Example/)).toBeInTheDocument();\n    expect(screen.getByText(/Subject for Alice Example/)).toBeInTheDocument();\n    expect(screen.getByText(/Preheader for Lumiso Studios/)).toBeInTheDocument();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/previews/EmailPreview.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4768,4771],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4768,4771],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":349,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12875,12878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12875,12878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":361,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":361,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13161,13164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13161,13164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":405,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":405,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14477,14480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14477,14480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":472,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":472,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16505,16508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16505,16508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { TemplateBlock, TextBlockData, SessionDetailsBlockData, CTABlockData, ImageBlockData, FooterBlockData } from \"@/types/templateBuilder\";\nimport { cn } from \"@/lib/utils\";\nimport { SocialChannel, useOrganizationSettings, OrganizationSettings } from \"@/hooks/useOrganizationSettings\";\nimport { useTranslation } from 'react-i18next';\n\ninterface EmailPreviewProps {\n  blocks: TemplateBlock[];\n  mockData: Record<string, string>;\n  device: \"desktop\" | \"mobile\";\n  emailSubject?: string;\n  preheader?: string;\n}\n\nexport function EmailPreview({ blocks, mockData, device, emailSubject, preheader }: EmailPreviewProps) {\n  const { t } = useTranslation('pages');\n  const { settings: organizationSettings } = useOrganizationSettings();\n\n  const replacePlaceholders = (text: string) => {\n    return text.replace(/\\{(\\w+)(?:\\|([^}]*))?\\}/g, (match, key, fallback) => {\n      return mockData[key] || fallback || match;\n    });\n  };\n\n  return (\n    <div className=\"bg-white rounded-lg border shadow-lg\">\n      {/* Email Header */}\n      <div className=\"bg-slate-600 text-white p-3 rounded-t-lg flex items-center gap-2\">\n        <div className=\"flex gap-1\">\n          <div className=\"w-3 h-3 bg-red-400 rounded-full\"></div>\n          <div className=\"w-3 h-3 bg-yellow-400 rounded-full\"></div>\n          <div className=\"w-3 h-3 bg-green-400 rounded-full\"></div>\n        </div>\n        <span className=\"text-sm font-medium\">{t('templateBuilder.preview.emailPreview')}</span>\n      </div>\n\n      {/* Email Meta */}\n      <div className=\"p-4 border-b bg-gray-50 text-sm\">\n        <div><strong>{t('templateBuilder.preview.subject')}</strong> {emailSubject ? replacePlaceholders(emailSubject) : t('templateBuilder.preview.defaultSubject')}</div>\n        {preheader && (\n          <div><strong>{t('templateBuilder.preview.previewText')}</strong> <span className=\"text-muted-foreground\">{replacePlaceholders(preheader)}</span></div>\n        )}\n      </div>\n\n      {/* Email Body */}\n      <div className={cn(\"p-6 space-y-6\", device === \"mobile\" && \"p-4 space-y-4\")}>\n        {/* Render all blocks */}\n        {blocks.map((block) => {\n          switch (block.type) {\n            case \"text\":\n              return <TextBlockPreview key={block.id} data={block.data as TextBlockData} replacePlaceholders={replacePlaceholders} />;\n            case \"session-details\":\n              return <SessionDetailsPreview key={block.id} data={block.data as SessionDetailsBlockData} mockData={mockData} />;\n            case \"cta\":\n              return (\n                <CTABlockPreview\n                  key={block.id}\n                  data={block.data as CTABlockData}\n                  replacePlaceholders={replacePlaceholders}\n                  organizationSettings={organizationSettings}\n                />\n              );\n            case \"image\":\n              return <ImageBlockPreview key={block.id} data={block.data as ImageBlockData} replacePlaceholders={replacePlaceholders} />;\n            case \"divider\":\n              return <DividerBlockPreview key={block.id} data={block.data} />;\n            case \"social-links\":\n              return (\n                <SocialLinksBlockPreview\n                  key={block.id}\n                  data={block.data}\n                  organizationSettings={organizationSettings}\n                />\n              );\n            case \"header\":\n              return <HeaderBlockPreview key={block.id} data={block.data} replacePlaceholders={replacePlaceholders} organizationSettings={organizationSettings} />;\n            case \"raw-html\":\n              return <RawHTMLBlockPreview key={block.id} data={block.data} />;\n            case \"footer\":\n              return <FooterBlockPreview key={block.id} data={block.data as FooterBlockData} mockData={mockData} organizationSettings={organizationSettings} />;\n            default:\n              return null;\n          }\n        })}\n\n        {blocks.length === 0 && (\n          <div className=\"text-center py-12 text-muted-foreground\">\n            <h3 className=\"font-semibold mb-2\">{t('templateBuilder.preview.helloCustomer', { name: mockData.customer_name })}</h3>\n            <p>{t('templateBuilder.preview.excitedMessage')}</p>\n            <p className=\"mt-8 text-sm\">{t('templateBuilder.preview.addBlocks')}</p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction TextBlockPreview({ data, replacePlaceholders }: { data: TextBlockData; replacePlaceholders: (text: string) => string }) {\n  const getTextStyles = () => {\n    const baseStyles: React.CSSProperties = {\n      fontFamily: data.formatting.fontFamily || 'Arial',\n      fontWeight: data.formatting.bold ? 'bold' : 'normal',\n      fontStyle: data.formatting.italic ? 'italic' : 'normal',\n      textAlign: data.formatting.alignment as any || 'left',\n    };\n\n    // Add font size based on semantic type\n    switch (data.formatting.fontSize) {\n      case 'h1':\n        return { ...baseStyles, fontSize: '32px', fontWeight: 'bold', lineHeight: '1.2' };\n      case 'h2':\n        return { ...baseStyles, fontSize: '24px', fontWeight: 'bold', lineHeight: '1.3' };\n      case 'h3':\n        return { ...baseStyles, fontSize: '20px', fontWeight: 'bold', lineHeight: '1.4' };\n      case 'p':\n      default:\n        return { ...baseStyles, fontSize: '16px', lineHeight: '1.6' };\n    }\n  };\n\n  const content = replacePlaceholders(data.content);\n  \n  // Map fontSize to actual HTML elements for proper semantic rendering\n  const getElementTag = () => {\n    switch (data.formatting.fontSize) {\n      case 'h1': return 'h1';\n      case 'h2': return 'h2'; \n      case 'h3': return 'h3';\n      case 'p':\n      default: return 'p';\n    }\n  };\n\n  const Tag = getElementTag() as keyof JSX.IntrinsicElements;\n\n  return (\n    <div>\n      <Tag style={getTextStyles()}>\n        {data.formatting.bullets ? (\n          <ul className=\"list-disc ml-6\">\n            {content.split('\\n').filter(line => line.trim()).map((line, index) => (\n              <li key={index}>{line.trim()}</li>\n            ))}\n          </ul>\n        ) : (\n          content.split('\\n').map((line, index) => (\n            <div key={index}>{line}</div>\n          ))\n        )}\n      </Tag>\n    </div>\n  );\n}\n\nfunction SessionDetailsPreview({ data, mockData }: { data: SessionDetailsBlockData; mockData: Record<string, string> }) {\n  const { t } = useTranslation('pages');\n  \n  return (\n    <div className=\"bg-slate-50 p-4 rounded-lg border\">\n      <h3 className=\"font-semibold mb-3 text-slate-900\">\n        {data.customLabel || t('templateBuilder.preview.sessionDetails.defaultLabel')}\n      </h3>\n      <div className=\"space-y-2\">\n        {data.showDate && (\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm font-medium text-slate-600 w-16\">{t('templateBuilder.preview.sessionDetails.date')}</span>\n            <span className=\"text-sm\">{mockData.session_date}</span>\n          </div>\n        )}\n        {data.showTime && (\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm font-medium text-slate-600 w-16\">{t('templateBuilder.preview.sessionDetails.time')}</span>\n            <span className=\"text-sm\">{mockData.session_time}</span>\n          </div>\n        )}\n        {data.showLocation && (\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm font-medium text-slate-600 w-16\">{t('templateBuilder.preview.sessionDetails.location')}</span>\n            <span className=\"text-sm\">{mockData.session_location}</span>\n          </div>\n        )}\n        {data.showNotes && (\n          <div className=\"flex items-start gap-2\">\n            <span className=\"text-sm font-medium text-slate-600 w-16\">{t('templateBuilder.preview.sessionDetails.notes')}</span>\n            <span className=\"text-sm\">{data.customNotes || t('templateBuilder.preview.sessionDetails.defaultNote')}</span>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction CTABlockPreview({\n  data,\n  replacePlaceholders,\n  organizationSettings,\n}: {\n  data: CTABlockData;\n  replacePlaceholders: (text: string) => string;\n  organizationSettings?: OrganizationSettings | null;\n}) {\n  const brandColor = organizationSettings?.primary_brand_color || \"#1EB29F\";\n\n  const getButtonStyles = () => {\n    switch (data.variant) {\n      case \"secondary\":\n        return \"bg-gray-100 text-gray-800 px-6 py-3 rounded-md font-medium inline-block no-underline border border-gray-300\";\n      case \"text\":\n        return \"font-medium underline inline-block no-underline\";\n      default:\n        return \"text-white px-6 py-3 rounded-md font-medium inline-block no-underline\";\n    }\n  };\n\n  const getButtonStyle = () => {\n    switch (data.variant) {\n      case \"text\":\n        return { color: brandColor };\n      case \"secondary\":\n        return {};\n      default:\n        return { backgroundColor: brandColor };\n    }\n  };\n\n  const buttonContent = replacePlaceholders(data.text);\n\n  return (\n    <div className=\"text-center\">\n      {data.link ? (\n        <a href={data.link} className={getButtonStyles()} style={getButtonStyle()}>\n          {buttonContent}\n        </a>\n      ) : (\n        <button className={getButtonStyles()} style={getButtonStyle()}>\n          {buttonContent}\n        </button>\n      )}\n    </div>\n  );\n}\n\nfunction ImageBlockPreview({ data, replacePlaceholders }: { data: ImageBlockData; replacePlaceholders: (text: string) => string }) {\n  return (\n    <div className=\"text-center\">\n      {data.placeholder || !data.src ? (\n        <div className=\"w-full h-48 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center\">\n          <div className=\"text-center\">\n            <div className=\"text-gray-400 mb-2\">ðŸ–¼ï¸</div>\n            <p className=\"text-sm text-gray-500\">Image Placeholder</p>\n          </div>\n        </div>\n      ) : (\n        <img\n          src={data.src}\n          alt={data.alt}\n          className=\"w-full rounded-lg\"\n        />\n      )}\n      {data.caption && (\n        <p className=\"text-sm text-gray-600 mt-2\">{replacePlaceholders(data.caption)}</p>\n      )}\n    </div>\n  );\n}\n\nfunction FooterBlockPreview({\n  data,\n  mockData,\n  organizationSettings,\n}: {\n  data: FooterBlockData;\n  mockData: Record<string, string>;\n  organizationSettings?: OrganizationSettings | null;\n}) {\n  const businessName = organizationSettings?.photography_business_name || mockData.business_name || 'Your Business';\n  const businessPhone = organizationSettings?.phone || mockData.business_phone || '+1 (555) 123-4567';\n  const businessEmail = organizationSettings?.email || mockData.business_email || `hello@${businessName.toLowerCase().replace(/\\s+/g, '')}.com`;\n  const logoUrl = organizationSettings?.logo_url;\n  const socialChannels = (organizationSettings?.social_channels as Record<string, SocialChannel>) || {};\n\n  // Filter and prepare social links\n  const validSocialLinks = Object.entries(socialChannels)\n    .filter(([key, channel]) => channel.enabled && channel.url)\n    .map(([key, channel]) => ({\n      platform: channel.platform,\n      name: channel.customPlatformName || channel.name,\n      url: channel.url\n    }));\n\n  return (\n    <div className=\"border-t pt-6 mt-8 text-center text-sm text-gray-600\">\n      {data.showLogo && (\n        <div className=\"mb-3 flex justify-center\">\n          {logoUrl ? (\n            <img \n              src={logoUrl} \n              alt={`${businessName} Logo`} \n              className=\"max-w-[80px] max-h-[80px] object-contain\"\n            />\n          ) : (\n            <div className=\"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold text-xl\">\n              {businessName.charAt(0)}\n            </div>\n          )}\n        </div>\n      )}\n      \n      {data.showStudioName && (\n        <div className=\"font-semibold text-gray-800 mb-2\">\n          {businessName}\n        </div>\n      )}\n      \n      {data.showContactInfo && (\n        <div className=\"space-y-1 mb-3\">\n          <div>{businessPhone}</div>\n          <div>{businessEmail}</div>\n        </div>\n      )}\n\n      {data.showSocialLinks && validSocialLinks.length > 0 && (\n        <div className=\"mb-3\">\n          <div className=\"flex justify-center gap-4 flex-wrap\">\n            {validSocialLinks.map((link, index) => (\n              <a \n                key={index} \n                href={link.url} \n                className=\"text-blue-600 hover:text-blue-800 text-sm\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n              >\n                {link.name}\n              </a>\n            ))}\n          </div>\n        </div>\n      )}\n      \n      {data.customText && (\n        <div className=\"mt-3 italic\">\n          {data.customText}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// New block preview components\nfunction DividerBlockPreview({ data }: { data: any }) {\n  if (data.style === \"line\") {\n    return <hr style={{ borderColor: data.color || \"#e5e5e5\", margin: \"20px 0\" }} />;\n  } else {\n    return <div style={{ height: data.height || 20 }}></div>;\n  }\n}\n\nfunction SocialLinksBlockPreview({\n  data,\n  organizationSettings,\n}: {\n  data: any;\n  organizationSettings?: OrganizationSettings | null;\n}) {\n  const socialChannelsArray = organizationSettings?.socialChannels\n    ? Object.entries(organizationSettings.socialChannels)\n        .sort(([, a], [, b]) => ((a as SocialChannel).order || 0) - ((b as SocialChannel).order || 0))\n        .filter(([key, channel]) => {\n          const socialChannel = channel as SocialChannel;\n          const hasUrl = socialChannel.url?.trim();\n          const isVisible = data.channelVisibility?.[key] !== false;\n          return hasUrl && isVisible;\n        })\n    : [];\n\n  if (socialChannelsArray.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"text-center py-4\">\n      <div className=\"flex justify-center gap-4\">\n        {socialChannelsArray.map(([key, channel]) => {\n          const socialChannel = channel as SocialChannel;\n          return (\n            <a\n              key={key}\n              href={socialChannel.url}\n              className=\"inline-block p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors text-sm\"\n              style={{ color: '#333' }}\n            >\n              {socialChannel.name}\n            </a>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\nfunction HeaderBlockPreview({\n  data,\n  replacePlaceholders,\n  organizationSettings,\n}: {\n  data: any;\n  replacePlaceholders: (text: string) => string;\n  organizationSettings?: OrganizationSettings | null;\n}) {\n  const businessName =\n    organizationSettings?.photography_business_name || \"Your Business\";\n  const logoUrl = organizationSettings?.logo_url;\n  const alignment = data.logoAlignment || \"center\";\n  const hasBackground = data.backgroundColor && data.backgroundColor !== \"#ffffff\";\n\n  const getAlignmentStyle = () => {\n    switch (alignment) {\n      case \"left\": return \"text-left\";\n      case \"right\": return \"text-right\";\n      case \"center\":\n      default: return \"text-center\";\n    }\n  };\n\n  const getJustifyStyle = () => {\n    switch (alignment) {\n      case \"left\": return \"justify-start\";\n      case \"right\": return \"justify-end\";\n      case \"center\":\n      default: return \"justify-center\";\n    }\n  };\n\n  const getPaddingClass = () => {\n    if (hasBackground && alignment === \"left\") {\n      return \"px-6 py-6\"; // Add horizontal padding when background and left aligned\n    }\n    return \"py-6\";\n  };\n\n  return (\n    <div \n      className={`rounded-lg ${getAlignmentStyle()} ${getPaddingClass()}`}\n      style={{ backgroundColor: data.backgroundColor || \"#ffffff\" }}\n    >\n      {data.showLogo && (\n        <div className={`mb-3 flex ${getJustifyStyle()}`}>\n          {logoUrl ? (\n            <img \n              src={logoUrl} \n              alt={`${businessName} Logo`} \n              className=\"max-w-[120px] max-h-[60px] object-contain\"\n            />\n          ) : (\n            <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold text-lg\">\n              {businessName.charAt(0)}\n            </div>\n          )}\n        </div>\n      )}\n      {data.tagline && (\n        <p \n          className=\"text-lg font-medium\"\n          style={{ color: data.taglineColor || \"#000000\" }}\n        >\n          {replacePlaceholders(data.tagline)}\n        </p>\n      )}\n    </div>\n  );\n}\n\nfunction RawHTMLBlockPreview({ data }: { data: any }) {\n  return (\n    <div className=\"border-2 border-dashed border-amber-300 bg-amber-50 p-4\">\n      <div className=\"text-sm text-amber-700 mb-2\">âš ï¸ Raw HTML Block (sanitized in production)</div>\n      <div dangerouslySetInnerHTML={{ __html: data.html || '<p>No HTML content</p>' }} />\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/previews/SMSPreview.tsx","messages":[{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":24,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":24,"endColumn":56,"suggestions":[{"messageId":"addBrackets","fix":{"range":[771,896],"text":"{ const textData = block.data as TextBlockData;\n          smsContent += replacePlaceholders(textData.content);\n          break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":29,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":29,"endColumn":69,"suggestions":[{"messageId":"addBrackets","fix":{"range":[940,1670],"text":"{ const sessionData = block.data as SessionDetailsBlockData;\n          smsContent += sessionData.customLabel || t('templateBuilder.preview.sessionDetails.defaultLabel');\n          smsContent += \"\\n\";\n          if (sessionData.showDate) smsContent += `${t('templateBuilder.preview.sessionDetails.date')} ${mockData.session_date}\\n`;\n          if (sessionData.showTime) smsContent += `${t('templateBuilder.preview.sessionDetails.time')} ${mockData.session_time}\\n`;\n          if (sessionData.showLocation) smsContent += `${t('templateBuilder.preview.sessionDetails.location')} ${mockData.session_location}\\n`;\n          if (sessionData.showNotes) smsContent += t('templateBuilder.preview.sessionDetails.defaultNote');\n          break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":39,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":39,"endColumn":54,"suggestions":[{"messageId":"addBrackets","fix":{"range":[1702,1910],"text":"{ const ctaData = block.data as CTABlockData;\n          smsContent += replacePlaceholders(ctaData.text);\n          if (ctaData.link) {\n            smsContent += `\\n${ctaData.link}`;\n          }\n          break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":47,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":47,"endColumn":58,"suggestions":[{"messageId":"addBrackets","fix":{"range":[1944,2255],"text":"{ const imageData = block.data as ImageBlockData;\n          smsContent += \"[Image]\";\n          if (imageData.caption) {\n            smsContent += ` ${replacePlaceholders(imageData.caption)}`;\n          }\n          if (imageData.link) {\n            smsContent += `\\n${imageData.link}`;\n          }\n          break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":58,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":58,"endColumn":60,"suggestions":[{"messageId":"addBrackets","fix":{"range":[2290,2824],"text":"{ const footerData = block.data as FooterBlockData;\n          if (footerData.showStudioName) {\n            smsContent += mockData.business_name;\n          }\n          if (footerData.showContactInfo) {\n            if (footerData.showStudioName) smsContent += \"\\n\";\n            smsContent += mockData.business_phone;\n          }\n          if (footerData.customText) {\n            if (footerData.showStudioName || footerData.showContactInfo) smsContent += \"\\n\";\n            smsContent += footerData.customText;\n          }\n          break; }"},"desc":"Add {} brackets around the case block."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { TemplateBlock, TextBlockData, SessionDetailsBlockData, CTABlockData, ImageBlockData, FooterBlockData } from \"@/types/templateBuilder\";\nimport { useTranslation } from 'react-i18next';\n\ninterface SMSPreviewProps {\n  blocks: TemplateBlock[];\n  mockData: Record<string, string>;\n}\n\nexport function SMSPreview({ blocks, mockData }: SMSPreviewProps) {\n  const { t } = useTranslation('pages');\n  const replacePlaceholders = (text: string) => {\n    return text.replace(/\\{(\\w+)\\}/g, (match, key) => mockData[key] || match);\n  };\n\n  // Convert all blocks to plain text\n  const generateSMSText = () => {\n    let smsContent = \"\";\n\n    blocks.forEach((block, index) => {\n      if (index > 0) smsContent += \"\\n\\n\";\n\n      switch (block.type) {\n        case \"text\":\n          const textData = block.data as TextBlockData;\n          smsContent += replacePlaceholders(textData.content);\n          break;\n\n        case \"session-details\":\n          const sessionData = block.data as SessionDetailsBlockData;\n          smsContent += sessionData.customLabel || t('templateBuilder.preview.sessionDetails.defaultLabel');\n          smsContent += \"\\n\";\n          if (sessionData.showDate) smsContent += `${t('templateBuilder.preview.sessionDetails.date')} ${mockData.session_date}\\n`;\n          if (sessionData.showTime) smsContent += `${t('templateBuilder.preview.sessionDetails.time')} ${mockData.session_time}\\n`;\n          if (sessionData.showLocation) smsContent += `${t('templateBuilder.preview.sessionDetails.location')} ${mockData.session_location}\\n`;\n          if (sessionData.showNotes) smsContent += t('templateBuilder.preview.sessionDetails.defaultNote');\n          break;\n\n        case \"cta\":\n          const ctaData = block.data as CTABlockData;\n          smsContent += replacePlaceholders(ctaData.text);\n          if (ctaData.link) {\n            smsContent += `\\n${ctaData.link}`;\n          }\n          break;\n\n        case \"image\":\n          const imageData = block.data as ImageBlockData;\n          smsContent += \"[Image]\";\n          if (imageData.caption) {\n            smsContent += ` ${replacePlaceholders(imageData.caption)}`;\n          }\n          if (imageData.link) {\n            smsContent += `\\n${imageData.link}`;\n          }\n          break;\n\n        case \"footer\":\n          const footerData = block.data as FooterBlockData;\n          if (footerData.showStudioName) {\n            smsContent += mockData.business_name;\n          }\n          if (footerData.showContactInfo) {\n            if (footerData.showStudioName) smsContent += \"\\n\";\n            smsContent += mockData.business_phone;\n          }\n          if (footerData.customText) {\n            if (footerData.showStudioName || footerData.showContactInfo) smsContent += \"\\n\";\n            smsContent += footerData.customText;\n          }\n          break;\n      }\n    });\n\n    return smsContent.trim();\n  };\n\n  const smsText = generateSMSText();\n  const characterCount = smsText.length;\n  const messageCount = Math.ceil(characterCount / 160);\n\n  return (\n    <div className=\"bg-slate-100 p-4 rounded-lg max-w-sm\">\n      {/* SMS Header */}\n      <div className=\"flex items-center justify-between mb-4 pb-3 border-b border-gray-300\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-sm font-bold\">\n            ðŸ“±\n          </div>\n          <div>\n            <div className=\"font-medium text-sm\">{mockData.business_name}</div>\n            <div className=\"text-xs text-gray-600\">{t('templateBuilder.preview.sms.label')}</div>\n          </div>\n        </div>\n        <div className=\"text-xs text-gray-500\">\n          {t('templateBuilder.preview.sms.now')}\n        </div>\n      </div>\n\n      {/* SMS Content */}\n      <div className=\"bg-blue-500 text-white p-3 rounded-2xl rounded-bl-sm mb-3 max-w-[85%] ml-auto\">\n        {smsText ? (\n          <div className=\"text-sm whitespace-pre-wrap\">\n            {smsText}\n          </div>\n        ) : (\n          <div className=\"text-sm\">\n            {t('templateBuilder.preview.helloCustomer', { name: mockData.customer_name })} {t('templateBuilder.preview.excitedMessage')}.\n            \n            {t('templateBuilder.preview.addBlocks')}.\n          </div>\n        )}\n      </div>\n\n      {/* Character Counter */}\n      <div className=\"text-xs text-gray-500 text-right space-y-1\">\n        <div>{characterCount} {t('templateBuilder.preview.sms.characters')}</div>\n        <div className={characterCount > 160 ? \"text-orange-600\" : \"\"}>\n          {messageCount} {messageCount !== 1 ? t('templateBuilder.preview.sms.messages') : t('templateBuilder.preview.sms.message')}\n        </div>\n        {characterCount > 160 && (\n          <div className=\"text-orange-600 text-[10px]\">\n            {t('templateBuilder.preview.sms.longMessageWarning')}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/template-builder/previews/WhatsAppPreview.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[589,592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[589,592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3274,3277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3274,3277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { TemplateBlock, TextBlockData, SessionDetailsBlockData, CTABlockData, FooterBlockData } from \"@/types/templateBuilder\";\nimport { useTranslation } from 'react-i18next';\n\ninterface WhatsAppPreviewProps {\n  blocks: TemplateBlock[];\n  mockData: Record<string, string>;\n}\n\nexport function WhatsAppPreview({ blocks, mockData }: WhatsAppPreviewProps) {\n  const { t } = useTranslation('pages');\n  \n  const replacePlaceholders = (text: string) => {\n    return text.replace(/\\{(\\w+)\\}/g, (match, key) => mockData[key] || match);\n  };\n\n  const formatWhatsAppText = (text: string, formatting: any) => {\n    let formatted = text;\n    if (formatting?.bold) formatted = `*${formatted}*`;\n    if (formatting?.italic) formatted = `_${formatted}_`;\n    return formatted;\n  };\n\n  const renderAllBlocks = () => {\n    if (blocks.length === 0) {\n      return (\n        <div className=\"text-sm\">\n          <div className=\"mb-2\">{t('templateBuilder.preview.helloCustomer', { name: mockData.customer_name })}</div>\n          <div>{t('templateBuilder.preview.excitedMessage')} âœ¨ðŸ“¸</div>\n          <div className=\"mt-2\">{t('templateBuilder.preview.lookingForward')}</div>\n          <div className=\"mt-3 text-gray-500 text-xs\">{t('templateBuilder.preview.addBlocks')}</div>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"text-sm space-y-2\">\n        {blocks.filter(block => block.visible).map((block, index) => (\n          <div key={block.id}>\n            {block.type === \"text\" && (\n              <WhatsAppTextBlock data={block.data as TextBlockData} replacePlaceholders={replacePlaceholders} formatText={formatWhatsAppText} />\n            )}\n            {block.type === \"session-details\" && (\n              <WhatsAppSessionDetails data={block.data as SessionDetailsBlockData} mockData={mockData} />\n            )}\n            {block.type === \"cta\" && (\n              <WhatsAppCTA data={block.data as CTABlockData} replacePlaceholders={replacePlaceholders} />\n            )}\n            {block.type === \"footer\" && (\n              <WhatsAppFooter data={block.data as FooterBlockData} mockData={mockData} />\n            )}\n          </div>\n        ))}\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"bg-[#e5ddd5] p-4 rounded-lg max-w-sm\">\n      {/* WhatsApp Header */}\n      <div className=\"flex items-center gap-3 mb-4 pb-3 border-b border-gray-300\">\n        <div className=\"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white font-bold\">\n          {mockData.business_name.charAt(0)}\n        </div>\n        <div>\n          <div className=\"font-semibold text-sm\">{mockData.business_name}</div>\n          <div className=\"text-xs text-gray-600\">{t('templateBuilder.preview.whatsapp.online')}</div>\n        </div>\n      </div>\n\n      {/* Single Message Bubble */}\n      <div className=\"bg-white p-4 rounded-lg shadow-sm\">\n        {renderAllBlocks()}\n      </div>\n\n      <div className=\"text-xs text-gray-500 text-right mt-2\">\n        {new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })} âœ“âœ“\n      </div>\n    </div>\n  );\n}\n\nfunction WhatsAppTextBlock({ \n  data, \n  replacePlaceholders, \n  formatText \n}: { \n  data: TextBlockData; \n  replacePlaceholders: (text: string) => string;\n  formatText: (text: string, formatting: any) => string;\n}) {\n  const content = replacePlaceholders(data.content);\n  const formatted = formatText(content, data.formatting);\n  \n  // Add emojis to enhance WhatsApp feel\n  const enhanceWithEmojis = (text: string) => {\n    return text\n      .replace(/\\b(hello|hi|hey)\\b/gi, '$& ðŸ‘‹')\n      .replace(/\\b(thank you|thanks)\\b/gi, '$& ðŸ™')\n      .replace(/\\b(excited|amazing|wonderful)\\b/gi, '$& âœ¨')\n      .replace(/\\b(perfect|great|awesome)\\b/gi, '$& ðŸŽ‰')\n      .replace(/\\b(photography|photo|session)\\b/gi, '$& ðŸ“¸')\n      .replace(/\\b(beautiful|stunning)\\b/gi, '$& ðŸ’«');\n  };\n  \n  return (\n    <div className=\"text-sm whitespace-pre-wrap\">\n      {enhanceWithEmojis(formatted).split('\\n').map((line, index) => (\n        <div key={index}>{line}</div>\n      ))}\n    </div>\n  );\n}\n\nfunction WhatsAppSessionDetails({ data, mockData }: { data: SessionDetailsBlockData; mockData: Record<string, string> }) {\n  const { t } = useTranslation('pages');\n  \n  return (\n    <div className=\"text-sm\">\n      <div className=\"font-medium mb-2\">\n        ðŸ“… {data.customLabel || t('templateBuilder.preview.sessionDetails.defaultLabel')}\n      </div>\n      <div className=\"space-y-1\">\n        {data.showDate && <div>ðŸ“… {t('templateBuilder.preview.sessionDetails.date')} {mockData.session_date}</div>}\n        {data.showTime && <div>ðŸ• {t('templateBuilder.preview.sessionDetails.time')} {mockData.session_time}</div>}\n        {data.showLocation && <div>ðŸ“ {t('templateBuilder.preview.sessionDetails.location')} {mockData.session_location}</div>}\n        {data.showNotes && <div>ðŸ“ {t('templateBuilder.preview.sessionDetails.defaultNote')}</div>}\n      </div>\n    </div>\n  );\n}\n\nfunction WhatsAppCTA({ data, replacePlaceholders }: { data: CTABlockData; replacePlaceholders: (text: string) => string }) {\n  return (\n    <div className=\"mt-2\">\n      <div className=\"text-sm font-medium\">\n        ðŸ‘† {replacePlaceholders(data.text)}\n      </div>\n      {data.link && (\n        <div className=\"text-xs mt-1 text-blue-600 underline\">\n          ðŸ”— {data.link}\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction WhatsAppFooter({ data, mockData }: { data: FooterBlockData; mockData: Record<string, string> }) {\n  return (\n    <div className=\"text-xs text-gray-600 border-t pt-2 mt-2\">\n      {data.showStudioName && (\n        <div className=\"font-medium text-gray-800 mb-1\">\n          ðŸ“¸ {mockData.business_name}\n        </div>\n      )}\n      \n      {data.showContactInfo && (\n        <div className=\"space-y-1\">\n          <div>ðŸ“ž {mockData.business_phone}</div>\n          <div>ðŸ’Œ Professional Photography Services</div>\n        </div>\n      )}\n      \n      {data.customText && (\n        <div className=\"mt-2 italic\">\n          âœ¨ {data.customText}\n        </div>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/app-sheet-modal.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[325,328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[325,328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[485,488],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[485,488],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[565,568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[565,568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[628,631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[628,631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[715,718],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[715,718],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[802,805],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[802,805],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { fireEvent, render, screen } from \"@testing-library/react\";\nimport { AppSheetModal } from \"../app-sheet-modal\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\n\njest.mock(\"@/hooks/use-mobile\", () => ({\n  useIsMobile: jest.fn(),\n}));\n\nconst sheetContentMock = jest.fn(({ side, children }: any) => (\n  <div data-testid=\"sheet-content\" data-side={side}>\n    {children}\n  </div>\n));\n\njest.mock(\"@/components/ui/sheet\", () => ({\n  Sheet: ({ children }: any) => <div data-testid=\"sheet-root\">{children}</div>,\n  SheetContent: (props: any) => sheetContentMock(props),\n  SheetHeader: ({ children }: any) => <div data-testid=\"sheet-header\">{children}</div>,\n  SheetTitle: ({ children }: any) => <div data-testid=\"sheet-title\">{children}</div>,\n  SheetFooter: ({ children }: any) => <div data-testid=\"sheet-footer\">{children}</div>,\n}));\n\ndescribe(\"AppSheetModal\", () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    (useIsMobile as jest.Mock).mockReturnValue(false);\n  });\n\n  const renderModal = (props: Partial<React.ComponentProps<typeof AppSheetModal>> = {}) =>\n    render(\n      <AppSheetModal\n        title=\"Edit Project\"\n        isOpen\n        onOpenChange={jest.fn()}\n        onDirtyClose={jest.fn()}\n        footerActions={[]}\n        {...props}\n      >\n        <div>Modal Content</div>\n      </AppSheetModal>\n    );\n\n  it(\"uses a right-side sheet on desktop and a bottom sheet on mobile\", () => {\n    const initial = renderModal();\n    expect(sheetContentMock).toHaveBeenCalledWith(expect.objectContaining({ side: \"right\" }));\n\n    sheetContentMock.mockClear();\n    (useIsMobile as jest.Mock).mockReturnValue(true);\n    initial.unmount();\n    renderModal({});\n\n    expect(sheetContentMock).toHaveBeenCalledWith(expect.objectContaining({ side: \"bottom\" }));\n  });\n\n  it(\"prefers onDirtyClose over onOpenChange when the form has unsaved changes\", () => {\n    const onDirtyClose = jest.fn();\n    const onOpenChange = jest.fn();\n\n    renderModal({ dirty: true, onDirtyClose, onOpenChange });\n\n    const closeButtons = screen.getAllByRole(\"button\");\n    fireEvent.click(closeButtons[0]);\n\n    expect(onDirtyClose).toHaveBeenCalledTimes(1);\n    expect(onOpenChange).not.toHaveBeenCalled();\n  });\n\n  it(\"falls back to onOpenChange when closing a clean modal\", () => {\n    const onOpenChange = jest.fn();\n    renderModal({ dirty: false, onOpenChange });\n\n    const closeButtons = screen.getAllByRole(\"button\");\n    fireEvent.click(closeButtons[0]);\n\n    expect(onOpenChange).toHaveBeenCalledWith(false);\n  });\n\n  it(\"renders footer actions and fires their callbacks\", () => {\n    const primaryAction = jest.fn();\n    const secondaryAction = jest.fn();\n\n    renderModal({\n      footerActions: [\n        { label: \"Cancel\", onClick: secondaryAction, variant: \"outline\" },\n        { label: \"Save\", onClick: primaryAction },\n      ],\n    });\n\n    fireEvent.click(screen.getByRole(\"button\", { name: \"Cancel\" }));\n    fireEvent.click(screen.getByRole(\"button\", { name: \"Save\" }));\n\n    expect(secondaryAction).toHaveBeenCalledTimes(1);\n    expect(primaryAction).toHaveBeenCalledTimes(1);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/card.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/data-table-container.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/data-table.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/date-time-picker.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/kpi-presets.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/loading-presets.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":18,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":18,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[624,627],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[624,627],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1111,1114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1111,1114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1144,1147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1144,1147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { render, screen } from \"@testing-library/react\";\nimport {\n  PageLoadingSkeleton,\n  DashboardLoadingSkeleton,\n  TableLoadingSkeleton,\n  ListLoadingSkeleton,\n  KanbanLoadingSkeleton,\n  FormLoadingSkeleton,\n  SearchLoadingSkeleton,\n  CompactLoadingSkeleton,\n  CardGridLoadingSkeleton,\n  DetailPageLoadingSkeleton,\n  SettingsLoadingSkeleton,\n} from \"../loading-presets\";\n\njest.mock(\"../loading-skeleton\", () => {\n  const React = require(\"react\");\n\n  return {\n    __esModule: true,\n    LoadingSkeleton: ({\n      variant,\n      rows,\n      showHeader,\n      showActions,\n      className,\n    }: any) => {\n      return (\n        <div\n          data-testid=\"loading-skeleton\"\n          data-variant={variant ?? \"\"}\n          data-rows={rows != null ? String(rows) : \"\"}\n          data-show-header={showHeader ? \"true\" : \"false\"}\n          data-show-actions={showActions ? \"true\" : \"false\"}\n          data-class-name={className ?? \"\"}\n        />\n      );\n    },\n  };\n});\n\ndescribe(\"loading-presets\", () => {\n  type SkeletonCase = {\n    name: string;\n    Component: React.ComponentType<any>;\n    props?: Record<string, any>;\n    expected: {\n      variant: string;\n      rows?: string;\n      showHeader?: boolean;\n      showActions?: boolean;\n      classForwarded?: boolean;\n    };\n    wrapperClasses?: string[];\n  };\n\n  const skeletonCases: SkeletonCase[] = [\n    {\n      name: \"PageLoadingSkeleton\",\n      Component: PageLoadingSkeleton,\n      expected: {\n        variant: \"settings\",\n        rows: \"3\",\n        showHeader: true,\n        showActions: false,\n        classForwarded: true,\n      },\n    },\n    {\n      name: \"DashboardLoadingSkeleton\",\n      Component: DashboardLoadingSkeleton,\n      expected: {\n        variant: \"dashboard\",\n        showHeader: false,\n        showActions: false,\n        classForwarded: false,\n      },\n      wrapperClasses: [\"p-4\", \"sm:p-6\"],\n    },\n    {\n      name: \"TableLoadingSkeleton\",\n      Component: TableLoadingSkeleton,\n      props: { rows: 4 },\n      expected: {\n        variant: \"table\",\n        rows: \"4\",\n        showHeader: true,\n        showActions: false,\n        classForwarded: false,\n      },\n      wrapperClasses: [\"p-4\"],\n    },\n    {\n      name: \"ListLoadingSkeleton\",\n      Component: ListLoadingSkeleton,\n      props: { rows: 2 },\n      expected: {\n        variant: \"list\",\n        rows: \"2\",\n        showHeader: true,\n        showActions: true,\n        classForwarded: false,\n      },\n      wrapperClasses: [\"p-4\"],\n    },\n    {\n      name: \"KanbanLoadingSkeleton\",\n      Component: KanbanLoadingSkeleton,\n      expected: {\n        variant: \"kanban\",\n        showHeader: false,\n        showActions: false,\n        classForwarded: false,\n      },\n      wrapperClasses: [\"p-4\", \"sm:p-6\"],\n    },\n    {\n      name: \"FormLoadingSkeleton\",\n      Component: FormLoadingSkeleton,\n      props: { rows: 7 },\n      expected: {\n        variant: \"form\",\n        rows: \"7\",\n        showHeader: true,\n        showActions: true,\n        classForwarded: false,\n      },\n      wrapperClasses: [\"p-6\"],\n    },\n    {\n      name: \"SearchLoadingSkeleton\",\n      Component: SearchLoadingSkeleton,\n      props: { rows: 6 },\n      expected: {\n        variant: \"search\",\n        rows: \"6\",\n        showHeader: false,\n        showActions: false,\n        classForwarded: false,\n      },\n      wrapperClasses: [\"p-4\"],\n    },\n    {\n      name: \"DetailPageLoadingSkeleton\",\n      Component: DetailPageLoadingSkeleton,\n      expected: {\n        variant: \"detail-page\",\n        showHeader: false,\n        showActions: false,\n        classForwarded: true,\n      },\n    },\n    {\n      name: \"SettingsLoadingSkeleton\",\n      Component: SettingsLoadingSkeleton,\n      props: { rows: 4 },\n      expected: {\n        variant: \"settings\",\n        rows: \"4\",\n        showHeader: true,\n        showActions: true,\n        classForwarded: true,\n      },\n    },\n  ];\n\n  it.each(skeletonCases)(\n    \"%s forwards the correct skeleton props\",\n    ({ Component, props = {}, expected, wrapperClasses }) => {\n      const { container } = render(<Component className=\"extra\" {...props} />);\n\n      const skeleton = screen.getByTestId(\"loading-skeleton\");\n      expect(skeleton).toHaveAttribute(\"data-variant\", expected.variant);\n\n      if (expected.rows !== undefined) {\n        expect(skeleton).toHaveAttribute(\"data-rows\", expected.rows);\n      } else {\n        expect(skeleton).toHaveAttribute(\"data-rows\", \"\");\n      }\n\n      if (expected.showHeader !== undefined) {\n        expect(skeleton).toHaveAttribute(\n          \"data-show-header\",\n          expected.showHeader ? \"true\" : \"false\"\n        );\n      }\n\n      if (expected.showActions !== undefined) {\n        expect(skeleton).toHaveAttribute(\n          \"data-show-actions\",\n          expected.showActions ? \"true\" : \"false\"\n        );\n      }\n\n      const forwardedClass = expected.classForwarded ? \"extra\" : \"\";\n      expect(skeleton).toHaveAttribute(\"data-class-name\", forwardedClass);\n\n      if (wrapperClasses?.length) {\n        const wrapper = container.firstChild as HTMLElement | null;\n        expect(wrapper).not.toBeNull();\n        wrapperClasses.forEach((className) => {\n          expect(wrapper).toHaveClass(className);\n        });\n        expect(wrapper).toHaveClass(\"extra\");\n      }\n    }\n  );\n\n  it(\"CompactLoadingSkeleton renders spinner with merged classes\", () => {\n    const { container } = render(<CompactLoadingSkeleton className=\"extra\" />);\n\n    const wrapper = container.firstChild as HTMLElement;\n    expect(wrapper).toHaveClass(\"flex\", \"items-center\", \"justify-center\", \"py-8\", \"extra\");\n    const spinner = wrapper.querySelector(\".animate-spin\") as HTMLElement | null;\n    expect(spinner).not.toBeNull();\n    expect(spinner).toHaveClass(\n      \"h-6\",\n      \"w-6\",\n      \"border-2\",\n      \"border-primary\",\n      \"border-t-transparent\",\n      \"rounded-full\"\n    );\n  });\n\n  it(\"CardGridLoadingSkeleton renders the requested number of cards\", () => {\n    const { container } = render(\n      <CardGridLoadingSkeleton className=\"extra\" count={4} />\n    );\n\n    const wrapper = container.firstChild as HTMLElement;\n    expect(wrapper).toHaveClass(\n      \"grid\",\n      \"gap-4\",\n      \"md:grid-cols-2\",\n      \"lg:grid-cols-3\",\n      \"p-4\",\n      \"extra\"\n    );\n\n    const cards = container.querySelectorAll(\n      \".animate-pulse.border.rounded-lg\"\n    );\n    expect(cards).toHaveLength(4);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/long-press-button.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/page-header.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/pagination.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/progress-bar.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/progress.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/segmented-control.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/switch.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/toast.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/toaster.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/__tests__/use-toast.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1712,1715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1712,1715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { act, renderHook } from \"@testing-library/react\";\nimport { toast, useToast } from \"@/hooks/use-toast\";\n\nconst clearToasts = () => {\n  const { result, unmount } = renderHook(() => useToast());\n  act(() => {\n    result.current.dismiss();\n    jest.runOnlyPendingTimers();\n  });\n  unmount();\n};\n\nbeforeEach(() => {\n  jest.useFakeTimers({ doNotFake: [\"performance\"] });\n  clearToasts();\n});\n\nafterEach(() => {\n  clearToasts();\n  jest.useRealTimers();\n});\n\ndescribe(\"toast hook\", () => {\n  it(\"adds toasts and enforces the queue limit\", () => {\n    const { result, unmount } = renderHook(() => useToast());\n\n    act(() => {\n      toast({ title: \"First\" });\n    });\n\n    expect(result.current.toasts).toHaveLength(1);\n    expect(result.current.toasts[0].title).toBe(\"First\");\n\n    act(() => {\n      toast({ title: \"Second\" });\n    });\n\n    expect(result.current.toasts).toHaveLength(1);\n    expect(result.current.toasts[0].title).toBe(\"Second\");\n\n    unmount();\n  });\n\n  it(\"dismisses toasts and removes them after the timer elapses\", () => {\n    const { result, unmount } = renderHook(() => useToast());\n\n    let toastId = \"\";\n    act(() => {\n      toastId = toast({ title: \"Dismiss me\" }).id;\n    });\n\n    act(() => {\n      result.current.dismiss(toastId);\n    });\n\n    expect(result.current.toasts[0].open).toBe(false);\n\n    act(() => {\n      jest.runOnlyPendingTimers();\n    });\n\n    expect(result.current.toasts).toHaveLength(0);\n\n    unmount();\n  });\n\n  it(\"allows updating toast properties\", () => {\n    const { result, unmount } = renderHook(() => useToast());\n\n    act(() => {\n      const handle = toast({ title: \"Initial\", description: \"Original\" });\n      handle.update({ description: \"Updated\" } as any);\n    });\n\n    expect(result.current.toasts[0]).toMatchObject({\n      title: \"Initial\",\n      description: \"Updated\",\n    });\n\n    unmount();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/app-sheet-modal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/aspect-ratio.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/badge.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":42,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":42,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n        success:\n          \"border-transparent bg-[hsl(var(--success-bg))] text-[hsl(var(--success-foreground))]\",\n        warning:\n          \"border-transparent bg-[hsl(var(--warning-bg))] text-[hsl(var(--warning-foreground))]\",\n        info:\n          \"border-transparent bg-[hsl(var(--info-bg))] text-[hsl(var(--info-foreground))]\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/breadcrumb.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/button.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":60,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":60,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground hover:text-white\",\n        link: \"text-accent underline-offset-4 hover:underline\",\n        cta: \"bg-accent text-accent-foreground hover:bg-accent/90 h-11 px-6 rounded-md border border-input shadow-sm transition-colors\",\n        dangerOutline: \"border border-destructive text-destructive hover:bg-destructive/10\",\n        chip:\n          \"bg-transparent text-current hover:bg-transparent hover:text-current shadow-none\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/command.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":24,"column":11,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":24,"endColumn":29,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[701,752],"text":"type CommandDialogProps = DialogProps"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\ninterface CommandDialogProps extends DialogProps {}\n\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/context-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/data-table-container.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/data-table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/date-time-picker.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":84,"column":5,"severity":1,"nodeType":null,"fix":{"range":[2679,2734],"text":" "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3915,3918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3915,3918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import React, { useEffect, useMemo, useState } from \"react\";\nimport { format } from \"date-fns\";\nimport { CalendarIcon, Clock } from \"lucide-react\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { cn, getUserLocale, getDateFnsLocale } from \"@/lib/utils\";\nimport ReactCalendar from \"react-calendar\";\nimport \"react-calendar/dist/Calendar.css\";\nimport \"@/components/react-calendar.css\";\n\ninterface DateTimePickerProps {\n  value?: string; // ISO local string: YYYY-MM-DDTHH:mm\n  onChange: (value: string) => void;\n  className?: string;\n  buttonClassName?: string;\n  placeholder?: string;\n  timeLabel?: string;\n  todayLabel?: string;\n  clearLabel?: string;\n  doneLabel?: string;\n}\n\nfunction toIsoLocal(date: Date, hours: number, minutes: number) {\n  const d = new Date(date);\n  d.setHours(hours, minutes, 0, 0);\n  const pad = (n: number) => String(n).padStart(2, \"0\");\n  return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;\n}\n\nfunction parseIsoLocal(value?: string) {\n  if (!value) return { date: undefined as Date | undefined, hours: 9, minutes: 0 };\n  const [datePart, timePart] = value.split(\"T\");\n  const [y, m, d] = datePart.split(\"-\").map(Number);\n  const [hh, mm] = (timePart || \"09:00\").split(\":\").map(Number);\n  return { date: new Date(y, (m || 1) - 1, d || 1), hours: hh || 9, minutes: mm || 0 };\n}\n\nconst displayFormat = (date?: Date, h?: number, m?: number) => {\n  if (!date) return undefined;\n  const withTime = new Date(date);\n  withTime.setHours(h ?? 0, m ?? 0, 0, 0);\n  return format(withTime, \"PP p\", { locale: getDateFnsLocale() });\n};\n\nexport const DateTimePicker: React.FC<DateTimePickerProps> = ({\n  value,\n  onChange,\n  className,\n  buttonClassName,\n  placeholder = \"Pick date & time\",\n  timeLabel = \"Time\",\n  todayLabel = \"Today\",\n  clearLabel = \"Clear\",\n  doneLabel = \"Done\",\n}) => {\n  const { date: initialDate, hours: initialHours, minutes: initialMinutes } = useMemo(\n    () => parseIsoLocal(value),\n    [value]\n  );\n\n  const [open, setOpen] = useState(false);\n  const [selectedDate, setSelectedDate] = useState<Date | undefined>(initialDate);\n  const [hours, setHours] = useState<number>(initialHours);\n  const [minutes, setMinutes] = useState<number>(initialMinutes);\n\n  useEffect(() => {\n    const parsed = parseIsoLocal(value);\n    setSelectedDate(parsed.date);\n    setHours(parsed.hours);\n    setMinutes(parsed.minutes);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [value]);\n\n  const browserLocale = getUserLocale();\n  const hourOptions = Array.from({ length: 24 }, (_, i) => i);\n  const minuteOptions = [0, 5, 10, 15, 20, 30, 45];\n\n  return (\n    <div className={className}>\n      <Popover open={open} onOpenChange={setOpen}>\n        <PopoverTrigger asChild>\n          <Button\n            variant=\"outline\"\n            type=\"button\"\n            className={cn(\n              \"justify-start text-left font-normal w-full md:w-[260px]\",\n              !value && \"text-muted-foreground\",\n              buttonClassName\n            )}\n          >\n            <CalendarIcon className=\"mr-2 h-4 w-4\" />\n            {displayFormat(selectedDate, hours, minutes) || placeholder}\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-auto p-0 rounded-xl border border-border shadow-md\" align=\"start\">\n          <div className=\"p-2\">\n            <ReactCalendar\n              className=\"react-calendar w-full p-2 pointer-events-auto\"\n              locale={browserLocale}\n              view=\"month\"\n              minDetail=\"month\"\n              next2Label={null}\n              prev2Label={null}\n              onChange={(value: any) => {\n                if (value instanceof Date) {\n                  setSelectedDate(value);\n                  // Automatically emit the change when date is selected\n                  onChange(toIsoLocal(value, hours, minutes));\n                }\n              }}\n              value={selectedDate || null}\n              formatShortWeekday={(_, date) => new Intl.DateTimeFormat(browserLocale, { weekday: 'short' }).format(date)}\n            />\n            <div className=\"px-1 pt-2\">\n              <Label className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                <Clock className=\"h-3 w-3\" /> {timeLabel}\n              </Label>\n              <div className=\"mt-2 grid grid-cols-2 gap-2\">\n                <Select value={String(hours)} onValueChange={(v) => {\n                  const newHours = parseInt(v);\n                  setHours(newHours);\n                  // Automatically emit the change when hours change\n                  if (selectedDate) {\n                    onChange(toIsoLocal(selectedDate, newHours, minutes));\n                  }\n                }}>\n                  <SelectTrigger className=\"h-9 rounded-md\">\n                    <SelectValue placeholder=\"Hour\" />\n                  </SelectTrigger>\n                  <SelectContent align=\"start\" className=\"max-h-64\">\n                    {hourOptions.map((h) => (\n                      <SelectItem key={h} value={String(h)}>\n                        {String(h).padStart(2, \"0\")}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <Select value={String(minutes)} onValueChange={(v) => {\n                  const newMinutes = parseInt(v);\n                  setMinutes(newMinutes);\n                  // Automatically emit the change when minutes change\n                  if (selectedDate) {\n                    onChange(toIsoLocal(selectedDate, hours, newMinutes));\n                  }\n                }}>\n                  <SelectTrigger className=\"h-9 rounded-md\">\n                    <SelectValue placeholder=\"Min\" />\n                  </SelectTrigger>\n                  <SelectContent align=\"start\" className=\"max-h-64\">\n                    {minuteOptions.map((m) => (\n                      <SelectItem key={m} value={String(m)}>\n                        {String(m).padStart(2, \"0\")}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"mt-3 flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"secondary\"\n                    size=\"sm\"\n                    onClick={() => {\n                      const today = new Date();\n                      setSelectedDate(today);\n                      // Also emit the change when \"Today\" is clicked\n                      onChange(toIsoLocal(today, hours, minutes));\n                    }}\n                  >\n                    {todayLabel}\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"text-muted-foreground\"\n                    onClick={() => {\n                      setSelectedDate(undefined);\n                      setHours(9);\n                      setMinutes(0);\n                      onChange(\"\");\n                    }}\n                  >\n                    {clearLabel}\n                  </Button>\n                </div>\n                <Button\n                  type=\"button\"\n                  size=\"sm\"\n                  onClick={() => setOpen(false)}\n                >\n                  {doneLabel}\n                </Button>\n              </div>\n            </div>\n          </div>\n        </PopoverContent>\n      </Popover>\n    </div>\n  );\n};\n\nexport default DateTimePicker;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/form.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":168,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":168,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  ControllerProps,\n  FieldPath,\n  FieldValues,\n  FormProvider,\n  useFormContext,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message) : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/hover-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/icon-action-button-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/icon-action-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/input-otp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/kpi-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/kpi-presets.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/loading-presets.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/loading-skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/long-press-button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/navigation-menu.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":119,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":119,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/page-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/progress-bar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/resizable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/segmented-control.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useCallback has an unnecessary dependency: 'indicatorInset'. Either exclude it or remove the dependency array.","line":75,"column":6,"nodeType":"ArrayExpression","endLine":75,"endColumn":29,"suggestions":[{"desc":"Update the dependencies array to be: [value]","fix":{"range":[2062,2085],"text":"[value]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\n\ntype SegmentedSize = \"sm\" | \"md\";\n\nexport interface SegmentedOption {\n  value: string;\n  label: React.ReactNode;\n  ariaLabel?: string;\n  disabled?: boolean;\n  tooltip?: React.ReactNode;\n}\n\nexport interface SegmentedControlProps\n  extends React.HTMLAttributes<HTMLDivElement> {\n  value: string;\n  onValueChange: (value: string) => void;\n  options: SegmentedOption[];\n  size?: SegmentedSize;\n}\n\nconst sizeClasses: Record<SegmentedSize, { container: string; item: string }> = {\n  sm: {\n    container: \"p-1 gap-1\",\n    item: \"px-3 py-1 text-xs\",\n  },\n  md: {\n    container: \"p-1.5 gap-1.5\",\n    item: \"px-4 py-1.5 text-sm\",\n  },\n};\n\nconst indicatorOffsets: Record<SegmentedSize, number> = {\n  sm: 2,\n  md: 3,\n};\n\nexport const SegmentedControl = React.forwardRef<\n  HTMLDivElement,\n  SegmentedControlProps\n>(({ value, onValueChange, options, size = \"md\", className, ...rest }, ref) => {\n  const containerRef = React.useRef<HTMLDivElement | null>(null);\n  const mergedRef = React.useCallback(\n    (node: HTMLDivElement | null) => {\n      containerRef.current = node;\n      if (typeof ref === \"function\") {\n        ref(node);\n      } else if (ref) {\n        (ref as React.MutableRefObject<HTMLDivElement | null>).current = node;\n      }\n    },\n    [ref],\n  );\n\n  const buttonRefs = React.useRef<Record<string, HTMLButtonElement | null>>({});\n  const sizeStyle = sizeClasses[size];\n  const indicatorInset = indicatorOffsets[size];\n  const [indicatorStyle, setIndicatorStyle] = React.useState<{\n    width: number;\n    left: number;\n  }>({ width: 0, left: 0 });\n\n  const updateIndicator = React.useCallback(() => {\n    const container = containerRef.current;\n    const activeButton = buttonRefs.current[value];\n    if (!container || !activeButton) return;\n    const width = activeButton.offsetWidth;\n    const left = activeButton.offsetLeft;\n    setIndicatorStyle({\n      width,\n      left,\n    });\n  }, [indicatorInset, value]);\n\n  React.useLayoutEffect(() => {\n    updateIndicator();\n  }, [updateIndicator, options]);\n\n  React.useEffect(() => {\n    window.addEventListener(\"resize\", updateIndicator);\n    return () => window.removeEventListener(\"resize\", updateIndicator);\n  }, [updateIndicator]);\n\n  return (\n    <TooltipProvider delayDuration={150}>\n      <div\n        ref={mergedRef}\n        role=\"group\"\n        className={cn(\n          \"relative inline-flex items-center rounded-full bg-muted/80 shadow-inner\",\n          sizeStyle.container,\n          className,\n        )}\n        {...rest}\n      >\n        <span\n          aria-hidden=\"true\"\n          className=\"pointer-events-none absolute rounded-full border border-border/40 bg-white shadow-sm transition-all duration-200 ease-out dark:border-slate-700 dark:bg-slate-900\"\n          style={{\n            width: indicatorStyle.width || 0,\n            left: indicatorStyle.left,\n            opacity: indicatorStyle.width ? 1 : 0,\n            top: indicatorInset,\n            bottom: indicatorInset,\n          }}\n        />\n        {options.map((option) => {\n          const isActive = option.value === value;\n          const button = (\n            <button\n              ref={(node) => {\n                buttonRefs.current[option.value] = node;\n              }}\n              type=\"button\"\n              disabled={option.disabled}\n              aria-pressed={isActive}\n              aria-label={option.ariaLabel}\n              onClick={() => {\n                if (option.disabled) return;\n                onValueChange(option.value);\n              }}\n              className={cn(\n                \"relative z-10 inline-flex items-center gap-1.5 rounded-full font-medium leading-none transition-colors duration-150 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/40 focus-visible:ring-offset-2 focus-visible:ring-offset-background\",\n                sizeStyle.item,\n                option.disabled && \"pointer-events-none opacity-50\",\n                isActive\n                  ? \"text-foreground\"\n                  : \"text-muted-foreground hover:text-foreground\",\n              )}\n            >\n              {option.label}\n            </button>\n          );\n\n          if (option.tooltip) {\n            return (\n              <Tooltip key={option.value}>\n                <TooltipTrigger asChild>{button}</TooltipTrigger>\n                <TooltipContent className=\"max-w-xs text-sm leading-snug\">\n                  {option.tooltip}\n                </TooltipContent>\n              </Tooltip>\n            );\n          }\n\n          return (\n            <React.Fragment key={option.value}>\n              {button}\n            </React.Fragment>\n          );\n        })}\n      </div>\n    </TooltipProvider>\n  );\n});\n\nSegmentedControl.displayName = \"SegmentedControl\";\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/selectable-pill.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[717,720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[717,720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { forwardRef, type KeyboardEventHandler } from \"react\";\nimport { Trash2 } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface SelectablePillProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  selected?: boolean;\n  onRemove?: () => void;\n  removeLabel?: string;\n  disableRemoveTooltip?: boolean;\n}\n\nexport const SelectablePill = forwardRef<HTMLButtonElement, SelectablePillProps>(\n  ({ children, className, selected = false, onRemove, removeLabel, onClick, onKeyDown, ...props }, ref) => {\n    const handleKeyDown: KeyboardEventHandler<HTMLButtonElement> = (event) => {\n      if (event.key === \"Enter\" || event.key === \" \") {\n        event.preventDefault();\n        onClick?.(event as any);\n      }\n      onKeyDown?.(event);\n    };\n\n    return (\n      <button\n        ref={ref}\n        type=\"button\"\n        aria-pressed={selected}\n        onClick={onClick}\n        onKeyDown={handleKeyDown}\n        className={cn(\n          \"group inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n          selected\n            ? \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\"\n            : \"border-border bg-white text-slate-700 hover:bg-slate-100\",\n          className\n        )}\n        {...props}\n      >\n        <span className=\"truncate\">{children}</span>\n        {onRemove ? (\n          <span\n            role=\"button\"\n            tabIndex={-1}\n            onClick={(event) => {\n              event.stopPropagation();\n              onRemove();\n            }}\n            onKeyDown={(event) => {\n              if (event.key === \"Enter\" || event.key === \" \") {\n                event.preventDefault();\n                event.stopPropagation();\n                onRemove();\n              }\n            }}\n            aria-label={removeLabel}\n            className={cn(\n              \"ml-1 inline-flex h-5 w-5 items-center justify-center rounded-full transition-colors\",\n              selected ? \"hover:bg-white/30\" : \"hover:bg-slate-900/10\"\n            )}\n          >\n            <Trash2 className=\"h-3.5 w-3.5 opacity-70\" aria-hidden />\n          </span>\n        ) : null}\n      </button>\n    );\n  }\n);\n\nSelectablePill.displayName = \"SelectablePill\";\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/sidebar.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":1204,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":1204,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { Sheet, SheetContent } from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\nimport { useTranslation } from \"react-i18next\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar:state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContext = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContext | null>(null)\n\ntype SidebarMenuHoverContextValue = {\n  hoveringMenuId: string | null\n  setHoveringMenuId: (id: string | null) => void\n}\n\nconst SidebarMenuHoverContext = React.createContext<\n  SidebarMenuHoverContextValue | null\n>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n    const [hoveringMenuId, setHoveringMenuId] = React.useState<string | null>(\n      null\n    )\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContext>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    const hoverContextValue = React.useMemo<SidebarMenuHoverContextValue>(\n      () => ({ hoveringMenuId, setHoveringMenuId }),\n      [hoveringMenuId]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <SidebarMenuHoverContext.Provider value={hoverContextValue}>\n          <TooltipProvider delayDuration={0}>\n            <div\n              style={\n                {\n                  \"--sidebar-width\": SIDEBAR_WIDTH,\n                  \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                  ...style,\n                } as React.CSSProperties\n              }\n              className={cn(\n                \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n                className\n              )}\n              ref={ref}\n              {...props}\n            >\n              {children}\n            </div>\n          </TooltipProvider>\n        </SidebarMenuHoverContext.Provider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden md:block text-sidebar-foreground\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n  const { t } = useTranslation(\"common\")\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">{t(\"sidebar.toggle\")}</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n  const { t } = useTranslation(\"common\")\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label={t(\"sidebar.toggle\")}\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title={t(\"sidebar.toggle\")}\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex min-h-svh flex-1 flex-col bg-background\",\n        \"peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\ntype SidebarMenuHighlightMode = \"active\" | \"hover\"\n\ninterface SidebarMenuHighlightContextValue {\n  setActive: (node: HTMLElement | null) => void\n  unsetActive: (node: HTMLElement | null) => void\n  setHover: (node: HTMLElement | null) => void\n  clearHover: (node: HTMLElement | null) => void\n  unregister: (node: HTMLElement | null) => void\n}\n\nconst SidebarMenuHighlightContext =\n  React.createContext<SidebarMenuHighlightContextValue | null>(null)\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, children, ...props }, ref) => {\n  const menuRef = React.useRef<HTMLUListElement | null>(null)\n  const activeNodeRef = React.useRef<HTMLElement | null>(null)\n  const hoverNodeRef = React.useRef<HTMLElement | null>(null)\n  const rafRef = React.useRef<number | null>(null)\n  const hoverContext = React.useContext(SidebarMenuHoverContext)\n  const menuId = React.useId()\n  const [indicator, setIndicator] = React.useState<{\n    x: number\n    y: number\n    width: number\n    height: number\n    borderRadius: string\n    opacity: number\n    mode: SidebarMenuHighlightMode\n  }>({\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0,\n    borderRadius: \"0px\",\n    opacity: 0,\n    mode: \"active\",\n  })\n\n  const applyIndicator = React.useCallback(\n    (node: HTMLElement, mode: SidebarMenuHighlightMode) => {\n      if (!menuRef.current) return\n\n      const menuRect = menuRef.current.getBoundingClientRect()\n      const nodeRect = node.getBoundingClientRect()\n      const styles = window.getComputedStyle(node)\n\n      setIndicator({\n        x: nodeRect.left - menuRect.left + menuRef.current.scrollLeft,\n        y: nodeRect.top - menuRect.top + menuRef.current.scrollTop,\n        width: nodeRect.width,\n        height: nodeRect.height,\n        borderRadius: styles.borderRadius,\n        opacity: mode === \"hover\" ? 0.92 : 1,\n        mode,\n      })\n    },\n    []\n  )\n\n  const scheduleIndicator = React.useCallback(\n    (node: HTMLElement, mode: SidebarMenuHighlightMode) => {\n      if (!menuRef.current) return\n      if (rafRef.current) {\n        cancelAnimationFrame(rafRef.current)\n      }\n      rafRef.current = window.requestAnimationFrame(() => {\n        applyIndicator(node, mode)\n      })\n    },\n    [applyIndicator]\n  )\n\n  const resetIndicator = React.useCallback(() => {\n    if (rafRef.current) {\n      cancelAnimationFrame(rafRef.current)\n      rafRef.current = null\n    }\n    setIndicator((prev) => ({\n      ...prev,\n      opacity: 0,\n    }))\n  }, [])\n\n  const setActive = React.useCallback(\n    (node: HTMLElement | null) => {\n      activeNodeRef.current = node\n      if (!node) {\n        if (!hoverNodeRef.current) {\n          resetIndicator()\n        }\n        return\n      }\n      if (hoverNodeRef.current && hoverNodeRef.current !== node) {\n        return\n      }\n      if (\n        hoverContext?.hoveringMenuId &&\n        hoverContext.hoveringMenuId !== menuId\n      ) {\n        return\n      }\n      scheduleIndicator(node, \"active\")\n    },\n    [hoverContext?.hoveringMenuId, menuId, resetIndicator, scheduleIndicator]\n  )\n\n  const unsetActive = React.useCallback(\n    (node: HTMLElement | null) => {\n      if (!node) return\n      if (activeNodeRef.current !== node) return\n      activeNodeRef.current = null\n      if (hoverNodeRef.current) {\n        scheduleIndicator(\n          hoverNodeRef.current,\n          hoverNodeRef.current === node ? \"active\" : \"hover\"\n        )\n      } else {\n        resetIndicator()\n      }\n    },\n    [resetIndicator, scheduleIndicator]\n  )\n\n  const setHover = React.useCallback(\n    (node: HTMLElement | null) => {\n      hoverNodeRef.current = node\n      if (!node) {\n        if (activeNodeRef.current) {\n          scheduleIndicator(activeNodeRef.current, \"active\")\n        } else {\n          resetIndicator()\n        }\n        if (hoverContext?.hoveringMenuId === menuId) {\n          hoverContext.setHoveringMenuId(null)\n        }\n        return\n      }\n      hoverContext?.setHoveringMenuId(menuId)\n      const mode =\n        activeNodeRef.current && activeNodeRef.current === node\n          ? \"active\"\n          : \"hover\"\n      scheduleIndicator(node, mode)\n    },\n    [hoverContext, menuId, resetIndicator, scheduleIndicator]\n  )\n\n  const clearHover = React.useCallback(\n    (node: HTMLElement | null) => {\n      if (!node) return\n      if (hoverNodeRef.current !== node) return\n      hoverNodeRef.current = null\n      if (hoverContext?.hoveringMenuId === menuId) {\n        hoverContext.setHoveringMenuId(null)\n      }\n      if (activeNodeRef.current) {\n        scheduleIndicator(activeNodeRef.current, \"active\")\n      } else {\n        resetIndicator()\n      }\n    },\n    [hoverContext, menuId, resetIndicator, scheduleIndicator]\n  )\n\n  const unregister = React.useCallback(\n    (node: HTMLElement | null) => {\n      if (!node) return\n      if (hoverNodeRef.current === node) {\n        hoverNodeRef.current = null\n      }\n      if (activeNodeRef.current === node) {\n        activeNodeRef.current = null\n        if (hoverNodeRef.current) {\n          scheduleIndicator(\n            hoverNodeRef.current,\n            hoverNodeRef.current === node ? \"active\" : \"hover\"\n          )\n        } else {\n          resetIndicator()\n        }\n      }\n      if (hoverContext?.hoveringMenuId === menuId) {\n        hoverContext.setHoveringMenuId(null)\n      }\n    },\n    [hoverContext, menuId, resetIndicator, scheduleIndicator]\n  )\n\n  React.useEffect(() => {\n    return () => {\n      if (rafRef.current) {\n        cancelAnimationFrame(rafRef.current)\n      }\n    }\n  }, [])\n\n  React.useLayoutEffect(() => {\n    if (typeof window === \"undefined\") return\n\n    const handleResize = () => {\n      const target = hoverNodeRef.current ?? activeNodeRef.current\n      if (target && menuRef.current) {\n        scheduleIndicator(\n          target,\n          target === activeNodeRef.current ? \"active\" : \"hover\"\n        )\n      }\n    }\n\n    window.addEventListener(\"resize\", handleResize)\n    return () => {\n      window.removeEventListener(\"resize\", handleResize)\n    }\n  }, [scheduleIndicator])\n\n  React.useLayoutEffect(() => {\n    const menu = menuRef.current\n    if (!menu || typeof ResizeObserver === \"undefined\") return\n\n    const observer = new ResizeObserver(() => {\n      const target = hoverNodeRef.current ?? activeNodeRef.current\n      if (target) {\n        scheduleIndicator(\n          target,\n          target === activeNodeRef.current ? \"active\" : \"hover\"\n        )\n      }\n    })\n\n    observer.observe(menu)\n    return () => {\n      observer.disconnect()\n    }\n  }, [scheduleIndicator])\n\n  React.useEffect(() => {\n    if (!hoverContext) return\n    if (\n      hoverContext.hoveringMenuId &&\n      hoverContext.hoveringMenuId !== menuId &&\n      !hoverNodeRef.current\n    ) {\n      resetIndicator()\n      return\n    }\n    if (\n      (!hoverContext.hoveringMenuId ||\n        hoverContext.hoveringMenuId === menuId) &&\n      !hoverNodeRef.current &&\n      activeNodeRef.current\n    ) {\n      scheduleIndicator(activeNodeRef.current, \"active\")\n    }\n  }, [hoverContext, menuId, resetIndicator, scheduleIndicator])\n\n  const setMenuRef = React.useCallback(\n    (node: HTMLUListElement | null) => {\n      menuRef.current = node\n      if (typeof ref === \"function\") {\n        ref(node)\n      } else if (ref) {\n        ;(ref as React.MutableRefObject<HTMLUListElement | null>).current = node\n      }\n    },\n    [ref]\n  )\n\n  const contextValue = React.useMemo<SidebarMenuHighlightContextValue>(\n    () => ({\n      setActive,\n      unsetActive,\n      setHover,\n      clearHover,\n      unregister,\n    }),\n    [clearHover, setActive, setHover, unregister, unsetActive]\n  )\n\n  const handleMenuPointerLeave = React.useCallback(() => {\n    if (hoverNodeRef.current) {\n      setHover(null)\n      return\n    }\n\n    if (!hoverContext) {\n      return\n    }\n\n    if (hoverContext.hoveringMenuId !== menuId) {\n      return\n    }\n\n    hoverContext.setHoveringMenuId(null)\n    if (activeNodeRef.current) {\n      scheduleIndicator(activeNodeRef.current, \"active\")\n    } else {\n      resetIndicator()\n    }\n  }, [\n    hoverContext,\n    menuId,\n    resetIndicator,\n    scheduleIndicator,\n    setHover,\n  ])\n\n  return (\n    <SidebarMenuHighlightContext.Provider value={contextValue}>\n      <ul\n        ref={setMenuRef}\n        data-sidebar=\"menu\"\n        className={cn(\n          \"relative flex w-full min-w-0 flex-col gap-1\",\n          className\n        )}\n        onPointerLeave={handleMenuPointerLeave}\n        {...props}\n      >\n        <li\n          aria-hidden=\"true\"\n          data-sidebar=\"menu-highlight\"\n          className=\"pointer-events-none absolute left-0 top-0 z-0 list-none border border-[hsl(var(--accent-200))] bg-[linear-gradient(135deg,_hsl(var(--accent-100)),_hsl(var(--accent-300)))] shadow-[0_20px_36px_-26px_hsl(var(--accent-400)_/_0.85)] transition-[opacity,transform,width,height] duration-300 ease-out will-change-transform data-[mode=hover]:border-[hsl(var(--accent-300))] data-[mode=hover]:shadow-[0_24px_40px_-24px_hsl(var(--accent-400)_/_0.92)] data-[mode=active]:border-[hsl(var(--accent-300))] data-[mode=active]:shadow-[0_24px_40px_-24px_hsl(var(--accent-400)_/_0.92)]\"\n          data-mode={indicator.mode}\n          style={{\n            transform: `translate3d(${indicator.x}px, ${indicator.y}px, 0)`,\n            width: indicator.width ? `${indicator.width}px` : 0,\n            height: indicator.height ? `${indicator.height}px` : 0,\n            borderRadius: indicator.borderRadius,\n            opacity: indicator.opacity,\n          }}\n        />\n        {children}\n      </ul>\n    </SidebarMenuHighlightContext.Provider>\n  )\n})\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative z-10\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button relative z-[1] isolate flex w-full items-center gap-2 overflow-hidden rounded-xl px-3 py-2 text-left text-sm font-medium text-sidebar-foreground/85 outline-none ring-sidebar-ring transition-all duration-300 ease-out hover:translate-x-[4px] hover:text-sidebar-accent-foreground focus-visible:translate-x-[4px] focus-visible:ring-2 focus-visible:ring-offset-0 focus-visible:ring-[hsl(var(--accent-300))] active:translate-x-[2px] disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-9 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:font-semibold data-[active=true]:text-[hsl(var(--accent-900))] data-[state=open]:text-[hsl(var(--accent-900))] group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:transition-colors\",\n  {\n    variants: {\n      variant: {\n        default: \"\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))] data-[active=true]:shadow-[0_0_0_1px_hsl(var(--accent-300))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      onMouseEnter,\n      onMouseLeave,\n      onFocus,\n      onBlur,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n    const highlight = React.useContext(SidebarMenuHighlightContext)\n    const localRef =\n      React.useRef<HTMLButtonElement | HTMLAnchorElement | null>(null)\n    const lastAssignedRef = React.useRef<HTMLElement | null>(null)\n\n    const setRefs = React.useCallback(\n      (node: HTMLElement | null) => {\n        localRef.current = node as HTMLButtonElement | HTMLAnchorElement | null\n        if (node) {\n          lastAssignedRef.current = node\n        }\n\n        if (typeof ref === \"function\") {\n          ref(node as HTMLButtonElement | null)\n        } else if (ref) {\n          ;(ref as React.MutableRefObject<HTMLButtonElement | null>).current =\n            node as HTMLButtonElement | null\n        }\n      },\n      [ref]\n    )\n\n    React.useLayoutEffect(() => {\n      if (!highlight) return\n      const node = localRef.current as unknown as HTMLElement | null\n      if (!node) return\n\n      if (isActive) {\n        highlight.setActive(node)\n        return () => {\n          highlight.unsetActive(node)\n        }\n      }\n\n      highlight.unsetActive(node)\n    }, [highlight, isActive])\n\n    React.useEffect(() => {\n      if (!highlight) return\n      const node = lastAssignedRef.current\n      if (!node) return\n\n      return () => {\n        highlight.unregister(node)\n      }\n    }, [highlight])\n\n    const handleMouseEnter = React.useCallback(\n      (event: React.MouseEvent<HTMLElement>) => {\n        onMouseEnter?.(event as React.MouseEvent<HTMLButtonElement>)\n        if (highlight && localRef.current) {\n          highlight.setHover(localRef.current as unknown as HTMLElement)\n        }\n      },\n      [highlight, onMouseEnter]\n    )\n\n    const handleMouseLeave = React.useCallback(\n      (event: React.MouseEvent<HTMLElement>) => {\n        onMouseLeave?.(event as React.MouseEvent<HTMLButtonElement>)\n        if (highlight && localRef.current) {\n          highlight.clearHover(localRef.current as unknown as HTMLElement)\n        }\n      },\n      [highlight, onMouseLeave]\n    )\n\n    const handleFocus = React.useCallback(\n      (event: React.FocusEvent<HTMLElement>) => {\n        onFocus?.(event as React.FocusEvent<HTMLButtonElement>)\n        if (highlight && localRef.current) {\n          highlight.setHover(localRef.current as unknown as HTMLElement)\n        }\n      },\n      [highlight, onFocus]\n    )\n\n    const handleBlur = React.useCallback(\n      (event: React.FocusEvent<HTMLElement>) => {\n        onBlur?.(event as React.FocusEvent<HTMLButtonElement>)\n        if (highlight && localRef.current) {\n          highlight.clearHover(localRef.current as unknown as HTMLElement)\n        }\n      },\n      [highlight, onBlur]\n    )\n\n    const button = (\n      <Comp\n        ref={setRefs}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n        onFocus={handleFocus}\n        onBlur={handleBlur}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"rounded-md h-8 flex gap-2 px-2 items-center\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 flex-1 max-w-[--skeleton-width]\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/sonner.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":29,"column":19,"nodeType":"Identifier","messageId":"namedExport","endLine":29,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useTheme } from \"next-themes\"\nimport { Toaster as Sonner, toast } from \"sonner\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster, toast }\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/textarea.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":5,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":5,"endColumn":31,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[73,159],"text":"type TextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/time-picker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/toggle-section.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/toggle.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":43,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":43,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3\",\n        sm: \"h-9 px-2.5\",\n        lg: \"h-11 px-5\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/components/ui/use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/constants/entityConstants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/constants/onboarding.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/contexts/AuthContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":149,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":149,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { User, Session } from '@supabase/supabase-js';\nimport { supabase } from '@/integrations/supabase/client';\n\ntype UserRole = 'admin' | 'support' | 'user';\n\ninterface AuthContextType {\n  user: User | null;\n  session: Session | null;\n  userRoles: UserRole[];\n  loading: boolean;\n  signOut: () => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [session, setSession] = useState<Session | null>(null);\n  const [userRoles, setUserRoles] = useState<UserRole[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [initialized, setInitialized] = useState(false);\n\n  const fetchUserRoles = async (userId: string) => {\n    try {\n      const { data: roles, error } = await supabase\n        .rpc('get_user_roles', { user_uuid: userId });\n      \n      if (error) {\n        console.error('Error fetching user roles:', error);\n        return [];\n      }\n      \n      return roles || [];\n    } catch (error) {\n      console.error('Error fetching user roles:', error);\n      return [];\n    }\n  };\n\n  const signOut = async () => {\n    try {\n      // Clear everything first\n      localStorage.clear();\n      setUser(null);\n      setSession(null);\n      setUserRoles([]);\n      \n      // Then sign out\n      await supabase.auth.signOut({ scope: 'global' });\n      \n      // Use window navigation for auth redirect\n      window.location.href = '/auth';\n    } catch (error) {\n      console.error('Sign out error:', error);\n      // Force reload anyway\n      window.location.href = '/auth';\n    }\n  };\n\n  useEffect(() => {\n    console.log('AuthProvider initializing...');\n    \n    let isMounted = true;\n\n    const initializeAuth = async () => {\n      try {\n        // Get current session\n        const { data: { session }, error } = await supabase.auth.getSession();\n        \n        if (error) {\n          console.error('Session error:', error);\n        }\n\n        if (isMounted && !initialized) {\n          console.log('Setting initial auth state:', session?.user?.id || 'no user');\n          setSession(session);\n          setUser(session?.user ?? null);\n          \n          // Fetch user roles if user exists\n          if (session?.user) {\n            setTimeout(async () => {\n              const roles = await fetchUserRoles(session.user.id);\n              if (isMounted) {\n                setUserRoles(roles);\n              }\n            }, 0);\n          }\n          \n          setLoading(false);\n          setInitialized(true);\n        }\n      } catch (error) {\n        console.error('Auth initialization error:', error);\n        if (isMounted) {\n          setLoading(false);\n          setInitialized(true);\n        }\n      }\n    };\n\n    // Set up auth state listener\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\n      async (event, session) => {\n        console.log('Auth state change:', event, session?.user?.id || 'no user');\n        \n        if (isMounted) {\n          setSession(session);\n          setUser(session?.user ?? null);\n          \n          // Fetch user roles if user exists\n          if (session?.user) {\n            setTimeout(async () => {\n              const roles = await fetchUserRoles(session.user.id);\n              if (isMounted) {\n                setUserRoles(roles);\n              }\n            }, 0);\n          } else {\n            setUserRoles([]);\n          }\n          \n          // Only set loading to false if we haven't initialized yet\n          if (!initialized) {\n            setLoading(false);\n            setInitialized(true);\n          }\n        }\n      }\n    );\n\n    // Initialize auth state\n    initializeAuth();\n\n    return () => {\n      console.log('AuthProvider cleanup...');\n      isMounted = false;\n      subscription.unsubscribe();\n    };\n  }, [initialized]);\n\n  return (\n    <AuthContext.Provider value={{ user, session, userRoles, loading, signOut }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/contexts/ConnectivityContext.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'no-console').","line":65,"column":11,"severity":1,"nodeType":null,"fix":{"range":[2336,2374],"text":" "}},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":94,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":94,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import React, { createContext, useCallback, useContext, useEffect, useMemo, useRef, useState } from 'react';\n\ntype RetryFn = () => Promise<void> | void;\n\ninterface ConnectivityContextValue {\n  isOffline: boolean;\n  isRetrying: boolean;\n  reportNetworkError: (error?: unknown) => void;\n  reportRecovery: () => void;\n  registerRetry: (key: string, fn: RetryFn) => () => void;\n  runRetryAll: () => Promise<void>;\n}\n\nconst ConnectivityContext = createContext<ConnectivityContextValue | undefined>(undefined);\n\nexport const ConnectivityProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  // Default to online; rely on real network errors or offline events to flip state.\n  // navigator.onLine can be unreliable on some platforms at startup.\n  const [isOffline, setIsOffline] = useState<boolean>(false);\n  const [isRetrying, setIsRetrying] = useState(false);\n  const retryCallbacksRef = useRef<Map<string, RetryFn>>(new Map());\n\n  // Window online/offline listeners keep our state accurate even if no requests are made\n  useEffect(() => {\n    const handleOnline = () => setIsOffline(false);\n    const handleOffline = () => setIsOffline(true);\n\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, []);\n\n  const reportNetworkError = useCallback((_error?: unknown) => {\n    setIsOffline(true);\n  }, []);\n\n  const reportRecovery = useCallback(() => {\n    if (typeof navigator === 'undefined' || navigator.onLine) {\n      setIsOffline(false);\n    }\n  }, []);\n\n  const registerRetry = useCallback((key: string, fn: RetryFn) => {\n    retryCallbacksRef.current.set(key, fn);\n    return () => {\n      retryCallbacksRef.current.delete(key);\n    };\n  }, []);\n\n  const runRetryAll = useCallback(async () => {\n    if (isRetrying) return;\n    setIsRetrying(true);\n    try {\n      const fns = Array.from(retryCallbacksRef.current.values());\n      for (const fn of fns) {\n        try {\n          await fn();\n        } catch (err) {\n          // Intentionally swallow individual errors here\n          // Offline banner will remain if we are still offline\n          // and pages can surface context-specific errors/toasts.\n          // eslint-disable-next-line no-console\n          console.error('Retry action failed', err);\n        }\n      }\n      // If device is online and retries did not throw hard, clear offline\n      if (typeof navigator === 'undefined' || navigator.onLine) {\n        setIsOffline(false);\n      }\n    } finally {\n      setIsRetrying(false);\n    }\n  }, [isRetrying]);\n\n  const value = useMemo<ConnectivityContextValue>(() => ({\n    isOffline,\n    isRetrying,\n    reportNetworkError,\n    reportRecovery,\n    registerRetry,\n    runRetryAll,\n  }), [isOffline, isRetrying, registerRetry, reportNetworkError, reportRecovery, runRetryAll]);\n\n  return (\n    <ConnectivityContext.Provider value={value}>\n      {children}\n    </ConnectivityContext.Provider>\n  );\n};\n\nexport const useConnectivity = (): ConnectivityContextValue => {\n  const ctx = useContext(ConnectivityContext);\n  if (!ctx) throw new Error('useConnectivity must be used within a ConnectivityProvider');\n  return ctx;\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/contexts/LanguageContext.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadUserLanguagePreference'. Either include it or remove the dependency array.","line":48,"column":6,"nodeType":"ArrayExpression","endLine":48,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [loadUserLanguagePreference, user]","fix":{"range":[1413,1419],"text":"[loadUserLanguagePreference, user]"}}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":154,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":154,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { toast } from '@/hooks/use-toast';\n\ninterface LanguageContextType {\n  currentLanguage: string;\n  availableLanguages: Array<{\n    code: string;\n    name: string;\n    native_name: string;\n  }>;\n  isLoading: boolean;\n  changeLanguage: (languageCode: string) => Promise<void>;\n}\n\nconst LanguageContext = createContext<LanguageContextType | undefined>(undefined);\n\ninterface LanguageProviderProps {\n  children: ReactNode;\n}\n\nexport function LanguageProvider({ children }: LanguageProviderProps) {\n  const { i18n } = useTranslation();\n  const { user } = useAuth();\n  const [currentLanguage, setCurrentLanguage] = useState(i18n.language || 'en');\n  const [availableLanguages, setAvailableLanguages] = useState<Array<{\n    code: string;\n    name: string;\n    native_name: string;\n  }>>([]);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Load available languages\n  useEffect(() => {\n    loadAvailableLanguages();\n  }, []);\n\n  // Load user's language preference\n  useEffect(() => {\n    if (user) {\n      loadUserLanguagePreference();\n    } else {\n      // For non-authenticated users, use browser detection or default\n      setIsLoading(false);\n    }\n  }, [user]);\n\n  const loadAvailableLanguages = async () => {\n    try {\n      const { data: languages } = await supabase\n        .from('languages')\n        .select('code, name, native_name')\n        .eq('is_active', true)\n        .order('sort_order');\n\n      if (languages) {\n        setAvailableLanguages(languages);\n      }\n    } catch (error) {\n      console.error('Error loading languages:', error);\n    }\n  };\n\n  const loadUserLanguagePreference = async () => {\n    if (!user) return;\n\n    try {\n      const { data: preference } = await supabase\n        .from('user_language_preferences')\n        .select('language_code')\n        .eq('user_id', user.id)\n        .single();\n\n      if (preference?.language_code) {\n        await changeLanguageInternal(preference.language_code);\n      }\n    } catch (error) {\n      // No preference found, use browser detection or default\n      console.log('No user language preference found');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const changeLanguageInternal = async (languageCode: string) => {\n    try {\n      await i18n.changeLanguage(languageCode);\n      setCurrentLanguage(languageCode);\n    } catch (error) {\n      console.error('Error changing language:', error);\n    }\n  };\n\n  const changeLanguage = async (languageCode: string) => {\n    try {\n      setIsLoading(true);\n      \n      // Change the i18n language\n      await changeLanguageInternal(languageCode);\n\n      // Save user preference if authenticated\n      if (user) {\n        const { error } = await supabase\n          .from('user_language_preferences')\n          .upsert({\n            user_id: user.id,\n            language_code: languageCode,\n          }, {\n            onConflict: 'user_id'\n          });\n\n        if (error) {\n          console.error('Error saving language preference:', error);\n          toast({\n            title: \"Warning\",\n            description: \"Language changed but preference not saved\",\n            variant: \"destructive\",\n          });\n        }\n      }\n\n      toast({\n        title: \"Language Changed\",\n        description: `Interface language changed to ${languageCode.toUpperCase()}`,\n      });\n    } catch (error) {\n      console.error('Error changing language:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to change language\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const value: LanguageContextType = {\n    currentLanguage,\n    availableLanguages,\n    isLoading,\n    changeLanguage,\n  };\n\n  return (\n    <LanguageContext.Provider value={value}>\n      {children}\n    </LanguageContext.Provider>\n  );\n}\n\nexport function useLanguage() {\n  const context = useContext(LanguageContext);\n  if (context === undefined) {\n    throw new Error('useLanguage must be used within a LanguageProvider');\n  }\n  return context;\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/contexts/OnboardingContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":203,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":203,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useMemo } from \"react\";\nimport { useUserPreferences } from \"@/hooks/useUserPreferences\";\nimport { ONBOARDING_STEPS, TOTAL_STEPS, OnboardingStage } from \"@/constants/onboarding\";\n\ninterface OnboardingContextValue {\n  // State\n  stage: OnboardingStage;\n  currentStep: number;\n  loading: boolean;\n  \n  // Computed values (memoized for performance)\n  shouldShowWelcomeModal: boolean;\n  isInGuidedSetup: boolean;\n  isOnboardingComplete: boolean;\n  shouldLockNavigation: boolean;\n  \n  // Step information\n  currentStepInfo: (typeof ONBOARDING_STEPS)[number] | null;\n  nextStepInfo: (typeof ONBOARDING_STEPS)[number] | null;\n  completedSteps: (typeof ONBOARDING_STEPS)[number][];\n  isAllStepsComplete: boolean;\n  totalSteps: number;\n  \n  // Actions\n  startGuidedSetup: () => Promise<void>;\n  completeCurrentStep: () => Promise<void>;\n  completeMultipleSteps: (numberOfSteps: number) => Promise<void>;\n  completeOnboarding: () => Promise<void>;\n  skipOnboarding: () => Promise<void>;\n  resetOnboarding: () => Promise<void>;\n}\n\nconst OnboardingContext = createContext<OnboardingContextValue | null>(null);\n\nexport function OnboardingProvider({ children }: { children: React.ReactNode }) {\n  const { data: preferences, isLoading, updatePreferences } = useUserPreferences();\n\n  // Memoized computed values to prevent excessive recalculations\n  const computedValues = useMemo(() => {\n    if (!preferences || isLoading) {\n      return {\n        shouldShowWelcomeModal: false,\n        isInGuidedSetup: false,\n        isOnboardingComplete: false,\n        shouldLockNavigation: false,\n        currentStepInfo: null,\n        nextStepInfo: null,\n        completedSteps: [],\n        isAllStepsComplete: false\n      };\n    }\n\n    const { onboardingStage, currentOnboardingStep, welcomeModalShown } = preferences;\n\n    // BULLETPROOF: Modal shows ONLY if user has NEVER seen it\n    const shouldShowWelcomeModal = onboardingStage === 'not_started' && !welcomeModalShown;\n    \n    const isInGuidedSetup = onboardingStage === 'in_progress';\n    \n    const isOnboardingComplete = onboardingStage === 'completed' || onboardingStage === 'skipped';\n    \n    const shouldLockNavigation = onboardingStage === 'in_progress';\n\n    // Step information\n    const currentStepInfo = isInGuidedSetup && currentOnboardingStep >= 1 && currentOnboardingStep <= TOTAL_STEPS\n      ? ONBOARDING_STEPS[currentOnboardingStep - 1]\n      : null;\n\n    const nextStepInfo = isInGuidedSetup && currentOnboardingStep < TOTAL_STEPS\n      ? ONBOARDING_STEPS[currentOnboardingStep]\n      : null;\n\n    const completedSteps = isInGuidedSetup \n      ? ONBOARDING_STEPS.slice(0, currentOnboardingStep - 1)\n      : [];\n\n    const isAllStepsComplete = isInGuidedSetup && currentOnboardingStep > TOTAL_STEPS;\n\n    return {\n      shouldShowWelcomeModal,\n      isInGuidedSetup,\n      isOnboardingComplete,\n      shouldLockNavigation,\n      currentStepInfo,\n      nextStepInfo,\n      completedSteps,\n      isAllStepsComplete\n    };\n  }, [preferences, isLoading]);\n\n  // Action functions\n  const startGuidedSetup = async () => {\n    if (!preferences) return;\n    \n    // Starting guided setup - modal disabled for improved performance\n    \n    await updatePreferences({\n      onboardingStage: 'in_progress',\n      currentOnboardingStep: 1,\n      welcomeModalShown: true // PERMANENT - NEVER reset\n    });\n  };\n\n  const completeCurrentStep = async () => {\n    if (!preferences || preferences.onboardingStage !== 'in_progress') {\n      console.warn(\"ðŸš« completeCurrentStep: Cannot complete - not in progress\");\n      return;\n    }\n\n    const nextStep = preferences.currentOnboardingStep + 1;\n    // Completing current step and advancing to next\n\n    // Bulletproof: Prevent completing beyond total steps\n    if (preferences.currentOnboardingStep >= TOTAL_STEPS) {\n      console.warn(\"ðŸš« completeCurrentStep: Attempted to complete step beyond total steps\");\n      return;\n    }\n\n    await updatePreferences({\n      currentOnboardingStep: nextStep\n    });\n  };\n\n  const completeMultipleSteps = async (numberOfSteps: number) => {\n    if (!preferences || preferences.onboardingStage !== 'in_progress') {\n      console.warn(\"ðŸš« completeMultipleSteps: Cannot complete - not in progress\");\n      return;\n    }\n\n    const targetStep = preferences.currentOnboardingStep + numberOfSteps;\n    // Completing multiple steps in batch\n\n    // Prevent completing beyond total steps\n    if (preferences.currentOnboardingStep >= TOTAL_STEPS) {\n      console.warn(\"ðŸš« completeMultipleSteps: Already at or beyond total steps\");\n      return;\n    }\n\n    const finalStep = Math.min(targetStep, TOTAL_STEPS + 1);\n    \n    await updatePreferences({\n      currentOnboardingStep: finalStep\n    });\n  };\n\n  const completeOnboarding = async () => {\n    if (!preferences) return;\n\n    // Completing onboarding process\n    \n    await updatePreferences({\n      onboardingStage: 'completed',\n      currentOnboardingStep: TOTAL_STEPS + 1\n    });\n  };\n\n  const skipOnboarding = async () => {\n    if (!preferences) return;\n\n    await updatePreferences({\n      onboardingStage: 'skipped'\n    });\n  };\n\n  const resetOnboarding = async () => {\n    if (!preferences) return;\n\n    // Resetting onboarding to guided mode\n    \n    await updatePreferences({\n      onboardingStage: 'in_progress',\n      currentOnboardingStep: 1,\n      welcomeModalShown: true // Keep modal permanently disabled\n    });\n  };\n\n  const contextValue: OnboardingContextValue = {\n    // State\n    stage: preferences?.onboardingStage || 'not_started',\n    currentStep: preferences?.currentOnboardingStep || 1,\n    loading: isLoading,\n    \n    // Computed values (memoized)\n    ...computedValues,\n    totalSteps: TOTAL_STEPS,\n    \n    // Actions\n    startGuidedSetup,\n    completeCurrentStep,\n    completeMultipleSteps,\n    completeOnboarding,\n    skipOnboarding,\n    resetOnboarding\n  };\n\n  return (\n    <OnboardingContext.Provider value={contextValue}>\n      {children}\n    </OnboardingContext.Provider>\n  );\n}\n\nexport function useOnboarding(): OnboardingContextValue {\n  const context = useContext(OnboardingContext);\n  if (!context) {\n    throw new Error(\"useOnboarding must be used within an OnboardingProvider\");\n  }\n  return context;\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/contexts/OrganizationContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":27,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":27,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect, ReactNode, useCallback } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { useQueryClient } from '@tanstack/react-query';\nimport { detectBrowserTimezone } from '@/lib/dateFormatUtils';\nimport {\n  fetchOrganizationSettingsWithCache,\n  ORGANIZATION_SETTINGS_CACHE_TTL,\n} from '@/lib/organizationSettingsCache';\n\ninterface Organization {\n  id: string;\n  name: string;\n  owner_id: string;\n}\n\ninterface OrganizationContextType {\n  activeOrganizationId: string | null;\n  activeOrganization: Organization | null;\n  loading: boolean;\n  refreshOrganization: () => Promise<void>;\n  setActiveOrganization: (orgId: string) => Promise<void>;\n}\n\nconst OrganizationContext = createContext<OrganizationContextType | undefined>(undefined);\n\nexport function useOrganization() {\n  const context = useContext(OrganizationContext);\n  if (context === undefined) {\n    throw new Error('useOrganization must be used within an OrganizationProvider');\n  }\n  return context;\n}\n\ninterface OrganizationProviderProps {\n  children: ReactNode;\n}\n\nexport function OrganizationProvider({ children }: OrganizationProviderProps) {\n  const [activeOrganizationId, setActiveOrganizationId] = useState<string | null>(null);\n  const [activeOrganization, setActiveOrganization] = useState<Organization | null>(null);\n  const [loading, setLoading] = useState(true);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const fetchActiveOrganization = async () => {\n    try {\n      setLoading(true);\n      \n      // Use the organization utils function\n      const { getUserOrganizationId } = await import('@/lib/organizationUtils');\n      const orgId = await getUserOrganizationId();\n      \n      if (!orgId) {\n        setActiveOrganizationId(null);\n        setActiveOrganization(null);\n        return;\n      }\n\n      // Fetch organization details\n      const { data: org, error: orgDetailsError } = await supabase\n        .from('organizations')\n        .select('id, name, owner_id')\n        .eq('id', orgId)\n        .single();\n\n      if (orgDetailsError) {\n        console.error('Error getting organization details:', orgDetailsError);\n        return;\n      }\n\n      setActiveOrganizationId(orgId);\n      setActiveOrganization(org);\n    } catch (error) {\n      console.error('Error in fetchActiveOrganization:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const refreshOrganization = async () => {\n    await fetchActiveOrganization();\n  };\n\n  const setActiveOrganizationHandler = async (orgId: string) => {\n    // In single-photographer model, organization is determined by ownership\n    // No need to update user settings since getUserOrganizationId handles this\n    console.log('Organization switch not needed in single-photographer mode:', orgId);\n    \n    // Just refresh the organization data\n    await refreshOrganization();\n    \n    toast({\n      title: \"Success\", \n      description: \"Organization data refreshed\",\n    });\n  };\n\n  // Set up simplified presence tracking for single-photographer\n  useEffect(() => {\n    let presenceInterval: ReturnType<typeof setInterval> | null = null;\n\n    const setupPresence = async () => {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user || !activeOrganizationId) return;\n\n      // Simple periodic activity update - no complex presence channels needed\n      presenceInterval = setInterval(async () => {\n        try {\n          // Just update user_settings to show activity\n          await supabase\n            .from('user_settings')\n            .update({ updated_at: new Date().toISOString() })\n            .eq('user_id', user.id);\n        } catch (error) {\n          console.warn('Failed to update activity timestamp:', error);\n        }\n      }, 300000); // Update every 5 minutes\n    };\n\n    if (activeOrganizationId) {\n      setupPresence();\n    }\n\n    return () => {\n      if (presenceInterval) {\n        clearInterval(presenceInterval);\n      }\n    };\n  }, [activeOrganizationId]);\n\n  // Initialize on mount and when auth state changes\n  useEffect(() => {\n    const initializeOrganization = async () => {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (user) {\n        await fetchActiveOrganization();\n      } else {\n        setActiveOrganizationId(null);\n        setActiveOrganization(null);\n        setLoading(false);\n      }\n    };\n\n    initializeOrganization();\n\n    // Listen for auth state changes\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\n      (event, session) => {\n        if (event === 'SIGNED_IN' && session) {\n          fetchActiveOrganization();\n        } else if (event === 'SIGNED_OUT') {\n          setActiveOrganizationId(null);\n          setActiveOrganization(null);\n          setLoading(false);\n        }\n      }\n    );\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, []);\n\n  // Prefetch common organization-scoped data to speed up first paint across pages\n  const prefetchOrgData = useCallback(async (orgId: string) => {\n    const tasks: Array<Promise<unknown>> = [];\n\n    // Project types\n    tasks.push(\n      queryClient.prefetchQuery({\n        queryKey: ['project_types', orgId],\n        queryFn: async () => {\n          const { data, error } = await supabase\n            .from('project_types')\n            .select('*')\n            .eq('organization_id', orgId)\n            .order('sort_order');\n          if (error) throw error;\n          return data || [];\n        },\n        staleTime: 5 * 60 * 1000,\n      })\n    );\n\n    // Project statuses\n    tasks.push(\n      queryClient.prefetchQuery({\n        queryKey: ['project_statuses', orgId],\n        queryFn: async () => {\n          const { data, error } = await supabase\n            .from('project_statuses')\n            .select('*')\n            .eq('organization_id', orgId)\n            .order('sort_order');\n          if (error) throw error;\n          return data || [];\n        },\n        staleTime: 5 * 60 * 1000,\n      })\n    );\n\n    // Services\n    tasks.push(\n      queryClient.prefetchQuery({\n        queryKey: ['services', orgId],\n        queryFn: async () => {\n          const { data, error } = await supabase\n            .from('services')\n            .select('*')\n            .eq('organization_id', orgId)\n            .order('name');\n          if (error) throw error;\n          return data || [];\n        },\n        staleTime: 5 * 60 * 1000,\n      })\n    );\n\n    // Session statuses\n    tasks.push(\n      queryClient.prefetchQuery({\n        queryKey: ['session_statuses', orgId],\n        queryFn: async () => {\n          const { data, error } = await supabase\n            .from('session_statuses')\n            .select('*')\n            .eq('organization_id', orgId)\n            .order('sort_order');\n          if (error) throw error;\n          return data || [];\n        },\n        staleTime: 5 * 60 * 1000,\n      })\n    );\n\n    // Lead statuses (used widely in leads and dialogs)\n    tasks.push(\n      queryClient.prefetchQuery({\n        queryKey: ['lead_statuses', orgId],\n        queryFn: async () => {\n          const { data, error } = await supabase\n            .from('lead_statuses')\n            .select('*')\n            .eq('organization_id', orgId)\n            .order('sort_order');\n          if (error) throw error;\n          return data || [];\n        },\n        staleTime: 5 * 60 * 1000,\n      })\n    );\n\n    // Organization settings (cache aware)\n    tasks.push(\n      queryClient.prefetchQuery({\n        queryKey: ['organization_settings', orgId],\n        queryFn: async () => {\n          const detectedTimezone =\n            typeof window !== 'undefined' ? detectBrowserTimezone() : undefined;\n          return fetchOrganizationSettingsWithCache(orgId, {\n            detectedTimezone,\n          });\n        },\n        staleTime: ORGANIZATION_SETTINGS_CACHE_TTL,\n      })\n    );\n\n    // Packages (used by settings, dialogs)\n    tasks.push(\n      queryClient.prefetchQuery({\n        queryKey: ['packages', orgId],\n        queryFn: async () => {\n          const { data: user } = await supabase.auth.getUser();\n          if (!user.user) return [];\n          await supabase.rpc('ensure_default_packages_for_org', {\n            user_uuid: user.user.id,\n            org_id: orgId,\n          });\n          const { data, error } = await supabase\n            .from('packages')\n            .select('*')\n            .eq('organization_id', orgId)\n            .order('created_at', { ascending: false });\n          if (error) throw error;\n          return data || [];\n        },\n        staleTime: 5 * 60 * 1000,\n      })\n    );\n\n    // Session types\n    tasks.push(\n      queryClient.prefetchQuery({\n        queryKey: ['session_types', orgId],\n        queryFn: async () => {\n          const { data: user } = await supabase.auth.getUser();\n          if (!user.user) return [];\n          await supabase.rpc('ensure_default_session_types_for_org', {\n            user_uuid: user.user.id,\n            org_id: orgId,\n          });\n          const { data, error } = await supabase\n            .from('session_types')\n            .select('*')\n            .eq('organization_id', orgId)\n            .order('sort_order', { ascending: true })\n            .order('name', { ascending: true });\n          if (error) throw error;\n          return data || [];\n        },\n        staleTime: 5 * 60 * 1000,\n      })\n    );\n\n    // Lead field definitions â€” not on React Query, seed localStorage for fast bootstrap\n    tasks.push((async () => {\n      try {\n        const { data: authUser } = await supabase.auth.getUser();\n        await supabase.rpc('ensure_default_lead_field_definitions', { org_id: orgId, user_uuid: authUser.user?.id });\n      } catch (error) {\n        console.warn('Failed to ensure default lead field definitions', error);\n      }\n      try {\n        const { data, error } = await supabase\n          .from('lead_field_definitions')\n          .select('*')\n          .eq('organization_id', orgId)\n          .order('sort_order', { ascending: true });\n        if (!error && data && typeof window !== 'undefined') {\n          try {\n            localStorage.setItem(`lead_field_definitions:${orgId}`, JSON.stringify(data));\n          } catch (storageError) {\n            console.warn('Failed to cache lead field definitions', storageError);\n          }\n        }\n      } catch (error) {\n        console.warn('Failed to preload lead field definitions', error);\n      }\n    })());\n\n    await Promise.allSettled(tasks);\n  }, [queryClient]);\n\n  // Trigger prefetch whenever org becomes available\n  useEffect(() => {\n    if (activeOrganizationId) {\n      prefetchOrgData(activeOrganizationId);\n    }\n  }, [activeOrganizationId, prefetchOrgData]);\n\n  return (\n    <OrganizationContext.Provider\n      value={{\n        activeOrganizationId,\n        activeOrganization,\n        loading,\n        refreshOrganization,\n        setActiveOrganization: setActiveOrganizationHandler,\n      }}\n    >\n      {children}\n    </OrganizationContext.Provider>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/contexts/PortalResetContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":17,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":17,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useCallback, useContext, useMemo, useState } from \"react\";\n\ninterface PortalResetContextValue {\n  resetKey: number;\n  reset: () => void;\n}\n\nconst PortalResetContext = createContext<PortalResetContextValue | undefined>(undefined);\n\nexport function PortalResetProvider({ children }: { children: React.ReactNode }) {\n  const [resetKey, setResetKey] = useState(0);\n  const reset = useCallback(() => setResetKey((k) => k + 1), []);\n  const value = useMemo(() => ({ resetKey, reset }), [resetKey, reset]);\n  return <PortalResetContext.Provider value={value}>{children}</PortalResetContext.Provider>;\n}\n\nexport function usePortalReset(): PortalResetContextValue {\n  const ctx = useContext(PortalResetContext);\n  return ctx ?? { resetKey: 0, reset: () => {} };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/contexts/ProfileContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[569,572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[569,572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[665,668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[665,668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[737,740],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[737,740],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":198,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":198,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5909,5912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5909,5912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":243,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7261,7264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7261,7264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":285,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":285,"endColumn":27}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect, ReactNode, useCallback } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { useAuth } from './AuthContext';\n\ninterface Profile {\n  id?: string;\n  user_id?: string;\n  full_name?: string;\n  phone_number?: string;\n  profile_photo_url?: string;\n}\n\ninterface ProfileContextType {\n  profile: Profile | null;\n  loading: boolean;\n  uploading: boolean;\n  updateProfile: (updates: Partial<Profile>) => Promise<{ success: boolean; error?: any }>;\n  uploadProfilePhoto: (file: File) => Promise<{ success: boolean; url?: string; error?: any }>;\n  deleteProfilePhoto: () => Promise<{ success: boolean; error?: any }>;\n  refreshProfile: () => Promise<void>;\n}\n\nconst ProfileContext = createContext<ProfileContextType | undefined>(undefined);\n\n// Global cache to prevent duplicate requests\nlet profileCache: { profile: Profile | null; timestamp: number; userId: string } | null = null;\nlet ongoingProfileFetch: Promise<Profile | null> | null = null;\nconst PROFILE_CACHE_DURATION = 30000; // 30 seconds\n\nexport function ProfileProvider({ children }: { children: ReactNode }) {\n  const [profile, setProfile] = useState<Profile | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [uploading, setUploading] = useState(false);\n  const { toast } = useToast();\n  const { user } = useAuth();\n\n  const fetchProfile = useCallback(async (): Promise<Profile | null> => {\n    if (!user?.id) return null;\n\n    // Return cached profile if still fresh and for the same user\n    if (\n      profileCache && \n      profileCache.userId === user.id &&\n      Date.now() - profileCache.timestamp < PROFILE_CACHE_DURATION\n    ) {\n      return profileCache.profile;\n    }\n\n    // If there's already an ongoing fetch for this user, wait for it\n    if (ongoingProfileFetch) {\n      return await ongoingProfileFetch;\n    }\n\n    try {\n      // Create the fetch promise and store it\n      ongoingProfileFetch = (async () => {\n        const { data, error } = await supabase\n          .from('profiles')\n          .select('*')\n          .eq('user_id', user.id)\n          .maybeSingle();\n\n        if (error && error.code !== 'PGRST116') {\n          throw error;\n        }\n\n        const profileData = data || { user_id: user.id };\n        profileCache = { \n          profile: profileData, \n          timestamp: Date.now(), \n          userId: user.id \n        };\n        return profileData;\n      })();\n\n      return await ongoingProfileFetch;\n    } catch (error) {\n      console.error('Error fetching profile:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to load profile\",\n        variant: \"destructive\",\n      });\n      return null;\n    } finally {\n      ongoingProfileFetch = null;\n    }\n  }, [user?.id, toast]);\n\n  const refreshProfile = useCallback(async () => {\n    if (!user?.id) return;\n    \n    setLoading(true);\n    // Clear cache to force fresh fetch\n    profileCache = null;\n    const fetchedProfile = await fetchProfile();\n    setProfile(fetchedProfile);\n    setLoading(false);\n  }, [fetchProfile, user?.id]);\n\n  const updateProfile = useCallback(async (updates: Partial<Profile>) => {\n    if (!user?.id) return { success: false, error: 'No user found' };\n\n    try {\n      let data, error;\n\n      if (profile?.id) {\n        // Update existing profile\n        const result = await supabase\n          .from('profiles')\n          .update(updates)\n          .eq('user_id', user.id)\n          .select()\n          .single();\n        data = result.data;\n        error = result.error;\n      } else {\n        // Insert new profile\n        const result = await supabase\n          .from('profiles')\n          .insert({ ...updates, user_id: user.id })\n          .select()\n          .single();\n        data = result.data;\n        error = result.error;\n      }\n\n      if (error) throw error;\n\n      setProfile(data);\n      // Update cache\n      profileCache = { \n        profile: data, \n        timestamp: Date.now(), \n        userId: user.id \n      };\n      return { success: true };\n    } catch (error) {\n      console.error('Error updating profile:', error);\n      return { success: false, error };\n    }\n  }, [profile?.id, user?.id]);\n\n  const uploadProfilePhoto = useCallback(async (file: File) => {\n    if (!user?.id) return { success: false, error: 'No user found' };\n\n    try {\n      setUploading(true);\n\n      // Validate file type\n      if (!file.type.startsWith('image/')) {\n        throw new Error('File must be an image');\n      }\n\n      // Validate file size (2MB limit)\n      if (file.size > 2 * 1024 * 1024) {\n        throw new Error('File size must be less than 2MB');\n      }\n\n      // Create unique filename\n      const fileExt = file.name.split('.').pop();\n      const fileName = `${user.id}/profile-${Date.now()}.${fileExt}`;\n\n      // Delete existing photo if it exists\n      if (profile?.profile_photo_url) {\n        const oldPath = profile.profile_photo_url.split('/').pop();\n        if (oldPath) {\n          await supabase.storage\n            .from('profile-photos')\n            .remove([`${user.id}/${oldPath}`]);\n        }\n      }\n\n      // Upload new file\n      const { error: uploadError } = await supabase.storage\n        .from('profile-photos')\n        .upload(fileName, file);\n\n      if (uploadError) throw uploadError;\n\n      // Get public URL\n      const { data: { publicUrl } } = supabase.storage\n        .from('profile-photos')\n        .getPublicUrl(fileName);\n\n      // Update profile with new photo URL\n      const updateResult = await updateProfile({ profile_photo_url: publicUrl });\n      \n      if (!updateResult.success) throw updateResult.error;\n\n      toast({\n        title: \"Success\",\n        description: \"Profile photo uploaded successfully\",\n      });\n\n      return { success: true, url: publicUrl };\n    } catch (error: any) {\n      console.error('Error uploading profile photo:', error);\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to upload profile photo\",\n        variant: \"destructive\",\n      });\n      return { success: false, error };\n    } finally {\n      setUploading(false);\n    }\n  }, [user?.id, profile?.profile_photo_url, updateProfile, toast]);\n\n  const deleteProfilePhoto = useCallback(async () => {\n    if (!profile?.profile_photo_url) {\n      return { success: true };\n    }\n\n    try {\n      // Extract file path from URL\n      const url = new URL(profile.profile_photo_url);\n      const pathParts = url.pathname.split('/');\n      const fileName = pathParts[pathParts.length - 1];\n\n      // Delete the file from storage\n      const { error: deleteError } = await supabase.storage\n        .from('profile-photos')\n        .remove([fileName]);\n\n      if (deleteError) {\n        console.error('Error deleting photo file:', deleteError);\n        // Continue anyway to clear the URL from profile\n      }\n\n      // Update profile to remove photo URL\n      const result = await updateProfile({ profile_photo_url: null });\n      \n      if (result.success) {\n        toast({\n          title: \"Success\",\n          description: \"Profile photo deleted successfully\",\n        });\n      }\n\n      return result;\n    } catch (error: any) {\n      console.error('Error deleting profile photo:', error);\n      toast({\n        title: \"Error\", \n        description: error.message || \"Failed to delete profile photo\",\n        variant: \"destructive\",\n      });\n      return { success: false, error };\n    }\n  }, [profile?.profile_photo_url, updateProfile, toast]);\n\n  // Fetch profile when user changes\n  useEffect(() => {\n    if (user?.id) {\n      const initializeProfile = async () => {\n        const fetchedProfile = await fetchProfile();\n        setProfile(fetchedProfile);\n        setLoading(false);\n      };\n      initializeProfile();\n    } else {\n      setProfile(null);\n      setLoading(false);\n      profileCache = null; // Clear cache when user signs out\n    }\n  }, [user?.id, fetchProfile]);\n\n  return (\n    <ProfileContext.Provider value={{\n      profile,\n      loading,\n      uploading,\n      updateProfile,\n      uploadProfilePhoto,\n      deleteProfilePhoto,\n      refreshProfile\n    }}>\n      {children}\n    </ProfileContext.Provider>\n  );\n}\n\nexport function useProfile() {\n  const context = useContext(ProfileContext);\n  if (context === undefined) {\n    throw new Error('useProfile must be used within a ProfileProvider');\n  }\n  return context;\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/contexts/SettingsContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":31,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":31,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useState, ReactNode, useCallback } from \"react\";\n\ninterface CategoryChanges {\n  [sectionId: string]: {\n    sectionName: string;\n    isDirty: boolean;\n    saveHandler: () => Promise<void>;\n    cancelHandler: () => void;\n  };\n}\n\ninterface SettingsContextType {\n  dirtySections: Set<string>;\n  addDirtySection: (section: string) => void;\n  removeDirtySection: (section: string) => void;\n  clearAllDirtySections: () => void;\n  hasDirtySections: boolean;\n  // New category-based management\n  categoryChanges: { [categoryPath: string]: CategoryChanges };\n  registerSectionHandler: (categoryPath: string, sectionId: string, sectionName: string, saveHandler: () => Promise<void>, cancelHandler: () => void) => void;\n  unregisterSectionHandler: (categoryPath: string, sectionId: string) => void;\n  setSectionDirty: (categoryPath: string, sectionId: string, isDirty: boolean) => void;\n  getCategoryDirtySections: (categoryPath: string) => string[];\n  hasCategoryChanges: (categoryPath: string) => boolean;\n  saveCategoryChanges: (categoryPath: string) => Promise<void>;\n  cancelCategoryChanges: (categoryPath: string) => void;\n}\n\nconst SettingsContext = createContext<SettingsContextType | undefined>(undefined);\n\nexport function useSettingsContext() {\n  const context = useContext(SettingsContext);\n  if (!context) {\n    throw new Error(\"useSettingsContext must be used within a SettingsProvider\");\n  }\n  return context;\n}\n\ninterface SettingsProviderProps {\n  children: ReactNode;\n}\n\nexport function SettingsProvider({ children }: SettingsProviderProps) {\n  const [dirtySections, setDirtySections] = useState<Set<string>>(new Set());\n  const [categoryChanges, setCategoryChanges] = useState<{ [categoryPath: string]: CategoryChanges }>({});\n\n  const addDirtySection = (section: string) => {\n    setDirtySections(prev => new Set(prev).add(section));\n  };\n\n  const removeDirtySection = (section: string) => {\n    setDirtySections(prev => {\n      const newSet = new Set(prev);\n      newSet.delete(section);\n      return newSet;\n    });\n  };\n\n  const clearAllDirtySections = () => {\n    setDirtySections(new Set());\n  };\n\n  const hasDirtySections = dirtySections.size > 0;\n\n  const registerSectionHandler = useCallback((\n    categoryPath: string, \n    sectionId: string, \n    sectionName: string, \n    saveHandler: () => Promise<void>, \n    cancelHandler: () => void\n  ) => {\n    setCategoryChanges(prev => ({\n      ...prev,\n      [categoryPath]: {\n        ...prev[categoryPath],\n        [sectionId]: {\n          sectionName,\n          isDirty: false,\n          saveHandler,\n          cancelHandler\n        }\n      }\n    }));\n  }, []);\n\n  const unregisterSectionHandler = useCallback((categoryPath: string, sectionId: string) => {\n    setCategoryChanges(prev => {\n      const newCategory = { ...prev[categoryPath] };\n      delete newCategory[sectionId];\n      return {\n        ...prev,\n        [categoryPath]: newCategory\n      };\n    });\n  }, []);\n\n  const setSectionDirty = useCallback((categoryPath: string, sectionId: string, isDirty: boolean) => {\n    setCategoryChanges(prev => {\n      const section = prev[categoryPath]?.[sectionId];\n      if (!section) return prev;\n      \n      return {\n        ...prev,\n        [categoryPath]: {\n          ...prev[categoryPath],\n          [sectionId]: {\n            ...section,\n            isDirty\n          }\n        }\n      };\n    });\n  }, []);\n\n  const getCategoryDirtySections = useCallback((categoryPath: string) => {\n    const sections = categoryChanges[categoryPath] || {};\n    return Object.keys(sections).filter(sectionId => sections[sectionId].isDirty);\n  }, [categoryChanges]);\n\n  const hasCategoryChanges = useCallback((categoryPath: string) => {\n    return getCategoryDirtySections(categoryPath).length > 0;\n  }, [getCategoryDirtySections]);\n\n  const saveCategoryChanges = useCallback(async (categoryPath: string) => {\n    const sections = categoryChanges[categoryPath] || {};\n    const dirtySections = Object.entries(sections).filter(([_, section]) => section.isDirty);\n    \n    for (const [sectionId, section] of dirtySections) {\n      await section.saveHandler();\n      setSectionDirty(categoryPath, sectionId, false);\n    }\n  }, [categoryChanges, setSectionDirty]);\n\n  const cancelCategoryChanges = useCallback((categoryPath: string) => {\n    const sections = categoryChanges[categoryPath] || {};\n    const dirtySections = Object.entries(sections).filter(([_, section]) => section.isDirty);\n    \n    for (const [sectionId, section] of dirtySections) {\n      section.cancelHandler();\n      setSectionDirty(categoryPath, sectionId, false);\n    }\n  }, [categoryChanges, setSectionDirty]);\n\n  return (\n    <SettingsContext.Provider value={{\n      dirtySections,\n      addDirtySection,\n      removeDirtySection,\n      clearAllDirtySections,\n      hasDirtySections,\n      categoryChanges,\n      registerSectionHandler,\n      unregisterSectionHandler,\n      setSectionDirty,\n      getCategoryDirtySections,\n      hasCategoryChanges,\n      saveCategoryChanges,\n      cancelCategoryChanges\n    }}>\n      {children}\n    </SettingsContext.Provider>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/contexts/__tests__/AuthContext.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1798,1801],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1798,1801],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1874,1877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1874,1877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { renderHook, waitFor, act } from \"@testing-library/react\";\nimport { AuthProvider, useAuth } from \"../AuthContext\";\nimport { supabase } from \"@/integrations/supabase/client\";\n\njest.mock(\"@/integrations/supabase/client\", () => {\n  const unsubscribe = jest.fn();\n  return {\n    supabase: {\n      auth: {\n        getSession: jest.fn(),\n        onAuthStateChange: jest.fn(() => ({\n          data: { subscription: { unsubscribe } },\n        })),\n        signOut: jest.fn(),\n      },\n      rpc: jest.fn(),\n    },\n  };\n});\n\nconst mockGetSession = supabase.auth.getSession as jest.Mock;\nconst mockOnAuthStateChange = supabase.auth.onAuthStateChange as jest.Mock;\nconst mockSignOut = supabase.auth.signOut as jest.Mock;\nconst mockRpc = supabase.rpc as jest.Mock;\n\nlet consoleLogSpy: jest.SpyInstance;\nlet consoleErrorSpy: jest.SpyInstance;\n\nbeforeAll(() => {\n  consoleLogSpy = jest.spyOn(console, \"log\").mockImplementation(() => {});\n  consoleErrorSpy = jest.spyOn(console, \"error\").mockImplementation(() => {});\n});\n\nafterAll(() => {\n  consoleLogSpy.mockRestore();\n  consoleErrorSpy.mockRestore();\n});\n\nconst wrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\n  <AuthProvider>{children}</AuthProvider>\n);\n\ndescribe(\"AuthContext\", () => {\n  beforeEach(() => {\n    mockGetSession.mockResolvedValue({\n      data: {\n        session: {\n          user: { id: \"user-1\" },\n        },\n      },\n      error: null,\n    });\n    mockRpc.mockResolvedValue({ data: [\"admin\"], error: null });\n    mockSignOut.mockResolvedValue({});\n    window.localStorage.setItem(\"test\", \"value\");\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n    window.localStorage.clear();\n  });\n\n  it(\"initializes auth state and fetches user roles\", async () => {\n    const listeners: Array<(event: string, session: any) => void> = [];\n    mockOnAuthStateChange.mockImplementation((callback: any) => {\n      listeners.push(callback);\n      return { data: { subscription: { unsubscribe: jest.fn() } } };\n    });\n\n    const { result } = renderHook(() => useAuth(), { wrapper });\n    expect(listeners).toHaveLength(1);\n\n    await waitFor(() => expect(result.current.loading).toBe(false));\n    expect(result.current.user?.id).toBe(\"user-1\");\n\n    await act(async () => {\n      listeners[0]?.(\"SIGNED_IN\", { user: { id: \"user-1\" } });\n      await Promise.resolve();\n    });\n\n    await act(async () => {\n      await new Promise((resolve) => setTimeout(resolve, 0));\n    });\n\n    await waitFor(() => expect(mockRpc).toHaveBeenCalled());\n    expect(mockRpc).toHaveBeenCalledWith(\"get_user_roles\", {\n      user_uuid: \"user-1\",\n    });\n\n    expect(result.current.userRoles).toEqual([]);\n  });\n\n  it(\"signOut clears state and redirects to auth\", async () => {\n    const { result } = renderHook(() => useAuth(), { wrapper });\n\n    await waitFor(() => expect(result.current.loading).toBe(false));\n\n    await act(async () => {\n      await result.current.signOut();\n    });\n\n    expect(mockSignOut).toHaveBeenCalledWith({ scope: \"global\" });\n    expect(window.localStorage.getItem(\"test\")).toBeNull();\n  });\n\n  it(\"throws when useAuth is used outside provider\", () => {\n    expect(() => renderHook(() => useAuth())).toThrow(\n      \"useAuth must be used within an AuthProvider\"\n    );\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/contexts/__tests__/OnboardingContext.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1336,1339],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1336,1339],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1891,1894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1891,1894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2725,2728],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2725,2728],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3778,3781],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3778,3781],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { renderHook, act } from \"@testing-library/react\";\nimport { OnboardingProvider, useOnboarding } from \"../OnboardingContext\";\nimport { useUserPreferences } from \"@/hooks/useUserPreferences\";\nimport { ONBOARDING_STEPS, TOTAL_STEPS } from \"@/constants/onboarding\";\n\njest.mock(\"@/hooks/useUserPreferences\", () => ({\n  useUserPreferences: jest.fn(),\n}));\n\nconst mockUseUserPreferences = useUserPreferences as jest.MockedFunction<\n  typeof useUserPreferences\n>;\n\nconst basePreferences = {\n  userId: \"user-1\",\n  activeOrganizationId: \"org-1\",\n  onboardingStage: \"not_started\" as const,\n  currentOnboardingStep: 1,\n  welcomeModalShown: false,\n  organizationId: \"org-1\",\n  businessName: \"Business\",\n  logoUrl: null,\n  primaryBrandColor: \"#1EB29F\",\n  timezone: \"UTC\",\n  dateFormat: \"DD/MM/YYYY\",\n  timeFormat: \"12-hour\",\n  displayName: null,\n  avatarUrl: null,\n  lastUpdated: new Date().toISOString(),\n};\n\nconst createWrapper =\n  () =>\n  ({ children }: { children: React.ReactNode }) =>\n    <OnboardingProvider>{children}</OnboardingProvider>;\n\ndescribe(\"OnboardingContext\", () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it(\"provides default values while loading preferences\", () => {\n    mockUseUserPreferences.mockReturnValue({\n      data: undefined,\n      isLoading: true,\n      updatePreferences: jest.fn(),\n    } as any);\n\n    const { result } = renderHook(() => useOnboarding(), {\n      wrapper: createWrapper(),\n    });\n\n    expect(result.current.loading).toBe(true);\n    expect(result.current.shouldShowWelcomeModal).toBe(false);\n    expect(result.current.completedSteps).toEqual([]);\n  });\n\n  it(\"computes onboarding state and supports guided setup start\", async () => {\n    const updatePreferences = jest.fn(() => Promise.resolve());\n    mockUseUserPreferences.mockReturnValue({\n      data: basePreferences,\n      isLoading: false,\n      updatePreferences,\n    } as any);\n\n    const { result } = renderHook(() => useOnboarding(), {\n      wrapper: createWrapper(),\n    });\n\n    expect(result.current.shouldShowWelcomeModal).toBe(true);\n    expect(result.current.isInGuidedSetup).toBe(false);\n\n    await act(async () => {\n      await result.current.startGuidedSetup();\n    });\n\n    expect(updatePreferences).toHaveBeenCalledWith({\n      onboardingStage: \"in_progress\",\n      currentOnboardingStep: 1,\n      welcomeModalShown: true,\n    });\n  });\n\n  it(\"handles step progression and completion guards\", async () => {\n    const updatePreferences = jest.fn(() => Promise.resolve());\n    mockUseUserPreferences.mockReturnValue({\n      data: { ...basePreferences, onboardingStage: \"in_progress\", currentOnboardingStep: 2, welcomeModalShown: true },\n      isLoading: false,\n      updatePreferences,\n    } as any);\n\n    const { result } = renderHook(() => useOnboarding(), {\n      wrapper: createWrapper(),\n    });\n\n    expect(result.current.completedSteps).toEqual(ONBOARDING_STEPS.slice(0, 1));\n    expect(result.current.currentStepInfo?.id).toBe(2);\n    expect(result.current.nextStepInfo?.id).toBe(3);\n\n    await act(async () => {\n      await result.current.completeCurrentStep();\n    });\n\n    expect(updatePreferences).toHaveBeenCalledWith({\n      currentOnboardingStep: 3,\n    });\n\n    await act(async () => {\n      await result.current.completeMultipleSteps(10);\n    });\n\n    expect(updatePreferences).toHaveBeenLastCalledWith({\n      currentOnboardingStep: TOTAL_STEPS + 1,\n    });\n  });\n\n  it(\"supports completion, skipping, and reset flows\", async () => {\n    const updatePreferences = jest.fn(() => Promise.resolve());\n    mockUseUserPreferences.mockReturnValue({\n      data: { ...basePreferences, onboardingStage: \"in_progress\", currentOnboardingStep: TOTAL_STEPS, welcomeModalShown: true },\n      isLoading: false,\n      updatePreferences,\n    } as any);\n\n    const { result } = renderHook(() => useOnboarding(), {\n      wrapper: createWrapper(),\n    });\n\n    await act(async () => {\n      await result.current.completeOnboarding();\n    });\n    await act(async () => {\n      await result.current.skipOnboarding();\n    });\n    await act(async () => {\n      await result.current.resetOnboarding();\n    });\n\n    expect(updatePreferences).toHaveBeenNthCalledWith(1, {\n      onboardingStage: \"completed\",\n      currentOnboardingStep: TOTAL_STEPS + 1,\n    });\n    expect(updatePreferences).toHaveBeenNthCalledWith(2, {\n      onboardingStage: \"skipped\",\n    });\n    expect(updatePreferences).toHaveBeenNthCalledWith(3, {\n      onboardingStage: \"in_progress\",\n      currentOnboardingStep: 1,\n      welcomeModalShown: true,\n    });\n  });\n\n  it(\"throws when hook used outside provider\", () => {\n    expect(() => renderHook(() => useOnboarding())).toThrow(\n      \"useOnboarding must be used within an OnboardingProvider\"\n    );\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/contexts/__tests__/OrganizationContext.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1559,1562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1559,1562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1867,1870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1867,1870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3031,3034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3031,3034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { renderHook, act, waitFor } from \"@testing-library/react\";\nimport {\n  OrganizationProvider,\n  useOrganization,\n} from \"../OrganizationContext\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\n\njest.mock(\"@/hooks/use-toast\", () => {\n  const toast = jest.fn();\n  return {\n    useToast: () => ({ toast }),\n    __esModule: true,\n    toastMock: toast,\n  };\n});\n\nconst { toastMock } = jest.requireMock(\"@/hooks/use-toast\") as {\n  toastMock: jest.Mock;\n};\n\njest.mock(\"@/lib/organizationUtils\", () => ({\n  getUserOrganizationId: jest.fn(),\n}));\n\njest.mock(\"@/lib/dateFormatUtils\", () => ({\n  detectBrowserTimezone: jest.fn(() => \"Europe/Istanbul\"),\n}));\n\njest.mock(\"@/lib/organizationSettingsCache\", () => ({\n  fetchOrganizationSettingsWithCache: jest.fn(),\n  ORGANIZATION_SETTINGS_CACHE_TTL: 60_000,\n}));\n\njest.mock(\"@/integrations/supabase/client\", () => {\n  const auth = {\n    getUser: jest.fn(),\n    onAuthStateChange: jest.fn(),\n  };\n\n  return {\n    supabase: {\n      auth,\n      from: jest.fn(),\n      rpc: jest.fn(),\n    },\n  };\n});\n\nconst mockGetUserOrganizationId =\n  getUserOrganizationId as jest.MockedFunction<typeof getUserOrganizationId>;\nconst mockSupabaseFrom = supabase.from as jest.Mock;\nconst mockSupabaseAuthGetUser = supabase.auth.getUser as jest.Mock;\nconst mockSupabaseAuthOnChange = supabase.auth.onAuthStateChange as jest.Mock;\n\nconst createOrganizationChain = () => {\n  const chain: any = {};\n  chain.select = jest.fn(() => chain);\n  chain.eq = jest.fn(() => chain);\n  chain.single = jest.fn(() =>\n    Promise.resolve({\n      data: { id: \"org-1\", name: \"Primary Org\", owner_id: \"user-1\" },\n      error: null,\n    })\n  );\n  return chain;\n};\n\nconst createGenericChain = () => {\n  const chain: any = {};\n  chain.select = jest.fn(() => chain);\n  chain.eq = jest.fn(() => chain);\n  chain.order = jest.fn(() => Promise.resolve({ data: [], error: null }));\n  chain.single = jest.fn(() =>\n    Promise.resolve({ data: null, error: null })\n  );\n  return chain;\n};\n\nconst createUpdateChain = () => ({\n  eq: jest.fn(() => Promise.resolve({ data: null, error: null })),\n});\n\nconst renderWithProviders = () => {\n  const queryClient = new QueryClient();\n  jest\n    .spyOn(queryClient, \"prefetchQuery\")\n    .mockImplementation(() => Promise.resolve());\n\n  const wrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (\n    <QueryClientProvider client={queryClient}>\n      <OrganizationProvider>{children}</OrganizationProvider>\n    </QueryClientProvider>\n  );\n\n  const hook = renderHook(() => useOrganization(), { wrapper });\n\n  return { hook, queryClient };\n};\n\ndescribe(\"OrganizationContext\", () => {\n  beforeEach(() => {\n    mockGetUserOrganizationId.mockResolvedValue(\"org-1\");\n    mockSupabaseAuthGetUser.mockResolvedValue({\n      data: { user: { id: \"user-1\" } },\n      error: null,\n    });\n\n    mockSupabaseAuthOnChange.mockImplementation((callback: any) => ({\n      data: { subscription: { unsubscribe: jest.fn() } },\n    }));\n\n    mockSupabaseFrom.mockImplementation((table: string) => {\n      if (table === \"organizations\") {\n        return createOrganizationChain();\n      }\n      if (table === \"user_settings\") {\n        return { update: jest.fn(() => createUpdateChain()) };\n      }\n      return createGenericChain();\n    });\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it(\"initializes organization data from Supabase\", async () => {\n    const { hook } = renderWithProviders();\n\n    await waitFor(() => expect(hook.result.current.loading).toBe(false));\n    expect(hook.result.current.activeOrganizationId).toBe(\"org-1\");\n    expect(hook.result.current.activeOrganization).toMatchObject({\n      name: \"Primary Org\",\n    });\n  });\n\n  it(\"refreshes organization data and triggers toast on manual switch\", async () => {\n    const toastMock =\n      (await import(\"@/hooks/use-toast\")).toastMock as jest.Mock;\n    const { hook } = renderWithProviders();\n\n    await waitFor(() => expect(hook.result.current.loading).toBe(false));\n\n    await act(async () => {\n      await hook.result.current.setActiveOrganization(\"org-99\");\n    });\n\n    expect(mockGetUserOrganizationId).toHaveBeenCalledTimes(2);\n    expect(toastMock).toHaveBeenCalledWith({\n      title: \"Success\",\n      description: \"Organization data refreshed\",\n    });\n  });\n\n  it(\"throws when hook is used outside provider\", () => {\n    expect(() => renderHook(() => useOrganization())).toThrow(\n      \"useOrganization must be used within an OrganizationProvider\"\n    );\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/components/PackageCreationWizard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/components/PackageCreationWizardSheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/components/__tests__/PackageCreationWizard.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/context/PackageCreationProvider.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your React context(s) to a separate file.","line":10,"column":14,"nodeType":"Identifier","messageId":"reactContext","endLine":10,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, ReactNode, useMemo, useReducer } from \"react\";\nimport { packageCreationReducer, createInitialPackageCreationState } from \"../state/packageCreationReducer\";\nimport { PackageCreationAction, PackageCreationEntryContext, PackageCreationState } from \"../types\";\n\ninterface PackageCreationContextValue {\n  state: PackageCreationState;\n  dispatch: React.Dispatch<PackageCreationAction>;\n}\n\nexport const PackageCreationContext = createContext<PackageCreationContextValue | undefined>(undefined);\n\ninterface PackageCreationProviderProps {\n  children: ReactNode;\n  entryContext?: PackageCreationEntryContext;\n}\n\nexport const PackageCreationProvider = ({ children, entryContext }: PackageCreationProviderProps) => {\n  const [state, dispatch] = useReducer(\n    packageCreationReducer,\n    createInitialPackageCreationState(entryContext)\n  );\n\n  const value = useMemo(\n    () => ({\n      state,\n      dispatch,\n    }),\n    [state]\n  );\n\n  return <PackageCreationContext.Provider value={value}>{children}</PackageCreationContext.Provider>;\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/hooks/usePackageCreationActions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/hooks/usePackageCreationContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/hooks/usePackageCreationSnapshot.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[639,642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[639,642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo } from \"react\";\nimport { usePackageCreationContext } from \"./usePackageCreationContext\";\nimport {\n  createPackageSnapshot,\n  preparePackagePersistence,\n  PackageSnapshot,\n  PackagePersistencePayload,\n  CreatePackageSnapshotOptions,\n} from \"../services/packageCreationSnapshot\";\nimport { usePackageDeliveryMethods } from \"@/hooks/useOrganizationData\";\n\nexport const usePackageCreationSnapshot = () => {\n  const { state } = usePackageCreationContext();\n  const deliveryMethodsQuery = usePackageDeliveryMethods();\n\n  const catalog = useMemo(() => {\n    const raw = deliveryMethodsQuery.data ?? [];\n    return raw.map((entry: any) => ({\n      id: entry.id,\n      name: entry.name ?? null,\n    }));\n  }, [deliveryMethodsQuery.data]);\n\n  const options: CreatePackageSnapshotOptions = useMemo(\n    () => ({ deliveryMethodsCatalog: catalog }),\n    [catalog]\n  );\n\n  const snapshot = useMemo<PackageSnapshot>(() => createPackageSnapshot(state, options), [state, options]);\n\n  const buildPersistencePayload = (context: { userId: string; organizationId: string }): PackagePersistencePayload => {\n    return preparePackagePersistence(state, context, options);\n  };\n\n  return {\n    snapshot,\n    buildPersistencePayload,\n    deliveryMethodsQuery,\n  };\n};\n\nexport type { PackageSnapshot } from \"../services/packageCreationSnapshot\";\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/services/__tests__/packageCreationSnapshot.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":302,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9577,9580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9577,9580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":313,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":313,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9871,9874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9871,9874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n  buildPackageHydrationFromRecord,\n  buildPackageUpdatePayload,\n  preparePackagePersistence,\n} from \"../packageCreationSnapshot\";\nimport type { Database } from \"@/integrations/supabase/types\";\nimport type { PackageCreationLineItem, PackageCreationState } from \"../../types\";\nimport { calculateLineItemPricing } from \"../../utils/lineItemPricing\";\n\ntype PackageRow = Database[\"public\"][\"Tables\"][\"packages\"][\"Row\"];\n\nconst baseRecord = (): PackageRow => ({\n  applicable_types: [\"wedding\"],\n  created_at: \"2024-11-08T10:30:00.000Z\",\n  client_total: 2300,\n  default_add_ons: [\"svc-2\"],\n  delivery_estimate_type: \"range\",\n  delivery_lead_time_unit: \"weeks\",\n  delivery_lead_time_value: 4,\n  delivery_methods: [\n    {\n      methodId: \"online-gallery\",\n      name: \"Online gallery\",\n    },\n  ],\n  delivery_photo_count_max: 400,\n  delivery_photo_count_min: 250,\n  description: \"Full day coverage with album\",\n  id: \"pkg-1\",\n  include_addons_in_price: false,\n  is_active: true,\n  line_items: [\n    {\n      id: \"line-1\",\n      type: \"existing\",\n      serviceId: \"svc-1\",\n      name: \"Primary shoot\",\n      quantity: 1,\n      unitCost: 500,\n      unitPrice: 1800,\n      vendorName: \"Internal\",\n      source: \"catalog\",\n      vatRate: 18,\n      vatMode: \"inclusive\",\n    },\n    {\n      id: \"line-2\",\n      type: \"custom\",\n      name: \"Drone footage\",\n      quantity: 1,\n      unitCost: 200,\n      unitPrice: 500,\n      vendorName: \"Freelancer\",\n      vatRate: null,\n      vatMode: \"exclusive\",\n    },\n  ],\n  name: \"Golden Wedding\",\n  organization_id: \"org-1\",\n  pricing_metadata: {\n    enableDeposit: true,\n    depositMode: \"percent_subtotal\",\n    depositValue: 25,\n    depositTarget: \"subtotal\",\n    depositAmount: 575,\n    packageVatRate: 18,\n    packageVatMode: \"inclusive\",\n    packageVatOverrideEnabled: false,\n    basePriceInput: 1800,\n  },\n  price: 1800,\n  updated_at: \"2024-11-08T10:30:00.000Z\",\n  user_id: \"user-1\",\n});\n\ndescribe(\"buildPackageHydrationFromRecord\", () => {\n  it(\"hydrates basics, services, delivery, and pricing slices\", () => {\n    const hydration = buildPackageHydrationFromRecord(baseRecord());\n\n    expect(hydration.basics).toMatchObject({\n      name: \"Golden Wedding\",\n      description: \"Full day coverage with album\",\n      applicableTypeIds: [\"wedding\"],\n      isActive: true,\n    });\n\n    expect(hydration.services.items).toHaveLength(2);\n    expect(hydration.services.items[0]).toMatchObject({\n      id: \"line-1\",\n      type: \"existing\",\n      serviceId: \"svc-1\",\n      quantity: 1,\n      unitPrice: 1800,\n      vendorName: \"Internal\",\n      source: \"catalog\",\n      vatRate: 18,\n      vatMode: \"inclusive\",\n    });\n\n    expect(hydration.delivery).toMatchObject({\n      enablePhotoEstimate: true,\n      enableLeadTime: true,\n      enableMethods: true,\n      estimateType: \"range\",\n      countMin: 250,\n      countMax: 400,\n      leadTimeValue: 4,\n      leadTimeUnit: \"weeks\",\n      methods: [\"online-gallery\"],\n    });\n\n    expect(hydration.pricing).toMatchObject({\n      basePrice: \"1800\",\n      includeAddOnsInPrice: false,\n      enableDeposit: true,\n      depositMode: \"percent_subtotal\",\n      depositValue: \"25\",\n      packageVatRate: 18,\n      packageVatMode: \"inclusive\",\n      packageVatOverrideEnabled: false,\n      packageVatInitialized: true,\n    });\n  });\n\n  it(\"falls back to defaults when optional metadata is missing\", () => {\n    const record = baseRecord();\n    record.pricing_metadata = {};\n    record.delivery_methods = [];\n    record.include_addons_in_price = null as unknown as boolean;\n\n    const hydration = buildPackageHydrationFromRecord(record);\n\n    expect(hydration.delivery.enableMethods).toBe(false);\n    expect(hydration.delivery.methods).toEqual([]);\n    expect(hydration.pricing.includeAddOnsInPrice).toBe(true);\n    expect(hydration.pricing.enableDeposit).toBe(false);\n    expect(hydration.pricing.depositMode).toBe(\"percent_subtotal\");\n    expect(hydration.pricing.depositValue).toBe(\"\");\n    expect(hydration.pricing.packageVatOverrideEnabled).toBe(false);\n    expect(hydration.pricing.packageVatInitialized).toBe(false);\n  });\n\n  it(\"maps snapshot into update payload correctly\", () => {\n    const record = baseRecord();\n    const hydration = buildPackageHydrationFromRecord(record);\n    const basePriceNumeric = Number(hydration.pricing.basePrice);\n    const baseVatRate = hydration.pricing.packageVatRate ?? 0;\n    const baseVatMode = hydration.pricing.packageVatMode;\n    const basePriceLine: PackageCreationLineItem = {\n      id: \"base\",\n      type: \"custom\",\n      name: \"Package price\",\n      quantity: 1,\n      unitPrice: basePriceNumeric,\n      vatRate: baseVatRate,\n      vatMode: baseVatMode,\n    };\n    const basePricing = calculateLineItemPricing(basePriceLine);\n    const basePriceGross = Math.round(basePricing.gross * 100) / 100;\n    const basePriceNet = Math.round(basePricing.net * 100) / 100;\n    const basePriceVatPortion = Math.round(basePricing.vat * 100) / 100;\n    const contextSnapshot = {\n      basics: hydration.basics,\n      services: {\n        items: hydration.services.items.map((item) => ({\n          ...item,\n          unitCost: item.unitCost ?? null,\n          unitPrice: item.unitPrice ?? null,\n          vatRate: item.vatRate ?? null,\n          vatMode: item.vatMode ?? \"exclusive\",\n        })),\n        totals: { cost: 0, price: 0, vat: 0, total: 0 },\n        defaultAddOnIds: [],\n        itemCount: hydration.services.items.length,\n        totalQuantity: hydration.services.items.reduce((acc, item) => acc + item.quantity, 0),\n      },\n      delivery: {\n        photosEnabled: hydration.delivery.enablePhotoEstimate,\n        leadTimeEnabled: hydration.delivery.enableLeadTime,\n        methodsEnabled: hydration.delivery.enableMethods,\n        estimateType: hydration.delivery.estimateType,\n        photoCountMin: hydration.delivery.countMin,\n        photoCountMax: hydration.delivery.countMax,\n        leadTimeValue: hydration.delivery.leadTimeValue,\n        leadTimeUnit: hydration.delivery.leadTimeUnit,\n        methods: hydration.delivery.methods.map((methodId) => ({\n          methodId,\n          name: methodId,\n        })),\n      },\n      pricing: {\n        basePrice: basePriceGross,\n        basePriceInput: basePriceNumeric,\n        basePriceNet,\n        basePriceVatPortion,\n        servicesCostTotal: 0,\n        servicesPriceTotal: 0,\n        servicesVatTotal: 0,\n        servicesGrossTotal: 0,\n        servicesMargin: 0,\n        subtotal: basePriceGross,\n        clientTotal: record.client_total,\n        includeAddOnsInPrice: hydration.pricing.includeAddOnsInPrice,\n        depositMode: hydration.pricing.depositMode,\n        depositValue: Number(hydration.pricing.depositValue),\n        depositAmount: record.pricing_metadata?.depositAmount ?? 0,\n        enableDeposit: hydration.pricing.enableDeposit,\n        packageVatRate: baseVatRate,\n        packageVatMode: baseVatMode,\n        packageVatOverrideEnabled: hydration.pricing.packageVatOverrideEnabled,\n      },\n      meta: {\n        selectedServiceCount: hydration.services.items.length,\n        totalSelectedQuantity: hydration.services.items.reduce(\n          (acc, item) => acc + item.quantity,\n          0\n        ),\n      },\n    } as const;\n\n    const updatePayload = buildPackageUpdatePayload(\n      contextSnapshot,\n      record.id\n    );\n\n    expect(updatePayload).toMatchObject({\n      id: \"pkg-1\",\n      name: \"Golden Wedding\",\n      price: Number(hydration.pricing.basePrice),\n      client_total: record.client_total,\n      include_addons_in_price: false,\n    });\n    expect(updatePayload.pricing_metadata).toEqual(\n      expect.objectContaining({\n        enableDeposit: true,\n        depositMode: \"percent_subtotal\",\n        depositValue: Number(hydration.pricing.depositValue),\n        packageVatRate: baseVatRate,\n        packageVatMode: baseVatMode,\n        packageVatOverrideEnabled: hydration.pricing.packageVatOverrideEnabled,\n        basePriceInput: basePriceNumeric,\n      })\n    );\n\n    const lineItems = updatePayload.line_items as unknown[];\n    expect(Array.isArray(lineItems)).toBe(true);\n    expect(lineItems).toEqual(\n      expect.arrayContaining([\n        expect.objectContaining({\n          serviceId: \"svc-1\",\n          quantity: 1,\n          unitPrice: 1800,\n          vatMode: \"inclusive\",\n          vatRate: 18,\n        }),\n        expect.objectContaining({\n          name: \"Drone footage\",\n          unitPrice: 500,\n          vatMode: \"exclusive\",\n          vatRate: null,\n        }),\n      ])\n    );\n  });\n\n  it(\"builds insert payloads with enriched line item metadata\", () => {\n    const record = baseRecord();\n    const hydration = buildPackageHydrationFromRecord(record);\n\n    const state: PackageCreationState = {\n      basics: hydration.basics,\n      services: hydration.services,\n      delivery: hydration.delivery,\n      pricing: hydration.pricing,\n      meta: {\n        currentStep: \"summary\",\n        isDirty: false,\n        mode: \"create\",\n      },\n    };\n\n    const { insert, snapshot } = preparePackagePersistence(state, {\n      userId: \"user-1\",\n      organizationId: record.organization_id ?? \"org-1\",\n    });\n\n    expect(snapshot.services.items).toEqual(\n      expect.arrayContaining([\n        expect.objectContaining({\n          serviceId: \"svc-1\",\n          quantity: 1,\n          unitPrice: 1800,\n          vatMode: \"inclusive\",\n          vatRate: 18,\n        }),\n      ])\n    );\n\n    const persisted = insert.line_items as unknown[];\n    expect(Array.isArray(persisted)).toBe(true);\n    const baseLineItem = persisted.find(\n      (item) => (item as any).serviceId === \"svc-1\"\n    ) as Record<string, unknown>;\n    expect(baseLineItem).toMatchObject({\n      serviceId: \"svc-1\",\n      quantity: 1,\n      unitPrice: 1800,\n      vatMode: \"inclusive\",\n      vatRate: 18,\n    });\n\n    const customLineItem = persisted.find(\n      (item) => (item as any).type === \"custom\"\n    ) as Record<string, unknown>;\n    expect(customLineItem).toMatchObject({\n      name: \"Drone footage\",\n      unitPrice: 500,\n      vatMode: \"exclusive\",\n    });\n    expect(customLineItem).toHaveProperty(\"vatRate\", null);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/services/packageCreationSnapshot.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":604,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":604,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19638,19641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19638,19641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":604,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":604,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19680,19683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19680,19683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":605,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":605,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19731,19734],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19731,19734],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Database, Json } from \"@/integrations/supabase/types\";\nimport type {\n  PackageCreationBasics,\n  PackageCreationDeliveryState,\n  PackageCreationLineItem,\n  PackageCreationPricingState,\n  PackageCreationServicesState,\n  PackageCreationState,\n  PackageLineItemType,\n} from \"../types\";\nimport { calculateLineItemPricing } from \"../utils/lineItemPricing\";\n\ntype PackageInsert = Database[\"public\"][\"Tables\"][\"packages\"][\"Insert\"];\ntype PackageRow = Database[\"public\"][\"Tables\"][\"packages\"][\"Row\"];\ntype PackageUpdate = Database[\"public\"][\"Tables\"][\"packages\"][\"Update\"];\n\nexport interface PackageLineItemPayload {\n  id: string;\n  type: PackageLineItemType;\n  role: \"addon\";\n  serviceId: string | null;\n  name: string;\n  quantity: number;\n  unitCost: number | null;\n  unitPrice: number | null;\n  vendorName: string | null;\n  source?: \"catalog\" | \"adhoc\";\n  vatRate: number | null;\n  vatMode: PackageCreationLineItem[\"vatMode\"];\n  unit: string | null;\n}\n\nexport interface PackageDeliveryMethodPayload {\n  methodId: string;\n  name: string | null;\n}\n\nexport interface PackagePricingDetailsPayload {\n  basePrice: number;\n  basePriceInput: number;\n  basePriceNet: number;\n  basePriceVatPortion: number;\n  servicesCostTotal: number;\n  servicesPriceTotal: number;\n  servicesVatTotal: number;\n  servicesGrossTotal: number;\n  servicesMargin: number;\n  subtotal: number;\n  clientTotal: number;\n  includeAddOnsInPrice: boolean;\n  depositMode: PackageCreationState[\"pricing\"][\"depositMode\"];\n  depositValue: number;\n  depositTarget?: \"subtotal\" | \"base\";\n  depositAmount: number;\n  enableDeposit: boolean;\n  packageVatRate: number;\n  packageVatMode: PackageCreationLineItem[\"vatMode\"];\n  packageVatOverrideEnabled: boolean;\n}\n\nexport interface PackageServicesSnapshot {\n  items: PackageLineItemPayload[];\n  totals: {\n    cost: number;\n    price: number;\n    vat: number;\n    total: number;\n  };\n  defaultAddOnIds: string[];\n  itemCount: number;\n  totalQuantity: number;\n}\n\nexport interface PackageDeliverySnapshot {\n  photosEnabled: boolean;\n  leadTimeEnabled: boolean;\n  methodsEnabled: boolean;\n  estimateType: PackageCreationState[\"delivery\"][\"estimateType\"];\n  photoCountMin: number | null;\n  photoCountMax: number | null;\n  leadTimeValue: number | null;\n  leadTimeUnit: PackageCreationState[\"delivery\"][\"leadTimeUnit\"] | null;\n  methods: PackageDeliveryMethodPayload[];\n}\n\nexport interface PackageBasicsSnapshot {\n  name: string;\n  description: string | null;\n  applicableTypeIds: string[];\n  isActive: boolean;\n}\n\nexport interface PackageSnapshot {\n  basics: PackageBasicsSnapshot;\n  services: PackageServicesSnapshot;\n  delivery: PackageDeliverySnapshot;\n  pricing: PackagePricingDetailsPayload;\n  meta: {\n    selectedServiceCount: number;\n    totalSelectedQuantity: number;\n  };\n}\n\nexport interface DeliveryMethodCatalogEntry {\n  id: string;\n  name: string | null;\n}\n\nexport interface CreatePackageSnapshotOptions {\n  deliveryMethodsCatalog?: DeliveryMethodCatalogEntry[];\n}\n\nexport interface PackagePersistenceContext {\n  userId: string;\n  organizationId: string;\n}\n\nexport interface PackagePersistencePayload {\n  snapshot: PackageSnapshot;\n  insert: PackageInsert;\n}\n\nexport interface PackageHydrationSlices {\n  basics: PackageCreationBasics;\n  services: PackageCreationServicesState;\n  delivery: PackageCreationDeliveryState;\n  pricing: PackageCreationPricingState;\n}\n\nexport const createPackageSnapshot = (\n  state: PackageCreationState,\n  options: CreatePackageSnapshotOptions = {}\n): PackageSnapshot => {\n  const basics = buildBasicsSnapshot(state);\n  const services = buildServicesSnapshot(state.services.items);\n  const delivery = buildDeliverySnapshot(state, options.deliveryMethodsCatalog ?? []);\n  const pricing = buildPricingSnapshot(state, services.totals);\n\n  return {\n    basics,\n    services,\n    delivery,\n    pricing,\n    meta: {\n      selectedServiceCount: services.itemCount,\n      totalSelectedQuantity: services.totalQuantity,\n    },\n  };\n};\n\nexport const buildPackageInsertPayload = (\n  snapshot: PackageSnapshot,\n  context: PackagePersistenceContext\n): PackageInsert => {\n  const lineItemsJson = snapshot.services.items as unknown as Json;\n  const deliveryMethodsJson = snapshot.delivery.methodsEnabled\n    ? (snapshot.delivery.methods as unknown as Json)\n    : ([] as unknown as Json);\n\n  const hasLeadTimeValue = snapshot.delivery.leadTimeEnabled && snapshot.delivery.leadTimeValue !== null && snapshot.delivery.leadTimeValue !== undefined;\n  const applicableTypes = snapshot.basics.applicableTypeIds.filter(Boolean);\n  const defaultAddOns = snapshot.services.defaultAddOnIds;\n  const pricingMetadata = buildPricingMetadata(snapshot.pricing);\n\n  const insertPayload: PackageInsert = {\n    user_id: context.userId,\n    organization_id: context.organizationId,\n    name: snapshot.basics.name,\n    description: snapshot.basics.description,\n    price: snapshot.pricing.basePrice,\n    client_total: snapshot.pricing.clientTotal,\n    applicable_types: applicableTypes.length ? applicableTypes : [],\n    default_add_ons: defaultAddOns.length ? defaultAddOns : [],\n    is_active: snapshot.basics.isActive,\n    line_items: lineItemsJson,\n    delivery_estimate_type: snapshot.delivery.estimateType,\n    delivery_photo_count_min: snapshot.delivery.photoCountMin,\n    delivery_photo_count_max: snapshot.delivery.photoCountMax,\n    delivery_lead_time_value: hasLeadTimeValue ? snapshot.delivery.leadTimeValue : null,\n    delivery_lead_time_unit: hasLeadTimeValue ? snapshot.delivery.leadTimeUnit ?? null : null,\n    delivery_methods: deliveryMethodsJson,\n    include_addons_in_price: snapshot.pricing.includeAddOnsInPrice,\n    pricing_metadata: pricingMetadata,\n  };\n\n  return insertPayload;\n};\n\nexport const buildPackageUpdatePayload = (\n  snapshot: PackageSnapshot,\n  packageId: string\n): PackageUpdate => {\n  const lineItemsJson = snapshot.services.items as unknown as Json;\n  const deliveryMethodsJson = snapshot.delivery.methodsEnabled\n    ? (snapshot.delivery.methods as unknown as Json)\n    : ([] as unknown as Json);\n  const hasLeadTimeValue =\n    snapshot.delivery.leadTimeEnabled &&\n    snapshot.delivery.leadTimeValue !== null &&\n    snapshot.delivery.leadTimeValue !== undefined;\n  const applicableTypes = snapshot.basics.applicableTypeIds.filter(Boolean);\n  const defaultAddOns = snapshot.services.defaultAddOnIds;\n  const pricingMetadata = buildPricingMetadata(snapshot.pricing);\n\n  const updatePayload: PackageUpdate = {\n    id: packageId,\n    name: snapshot.basics.name,\n    description: snapshot.basics.description ?? null,\n    price: snapshot.pricing.basePrice,\n    client_total: snapshot.pricing.clientTotal,\n    applicable_types: applicableTypes.length ? applicableTypes : [],\n    default_add_ons: defaultAddOns.length ? defaultAddOns : [],\n    is_active: snapshot.basics.isActive,\n    line_items: lineItemsJson,\n    delivery_estimate_type: snapshot.delivery.estimateType,\n    delivery_photo_count_min: snapshot.delivery.photoCountMin,\n    delivery_photo_count_max: snapshot.delivery.photoCountMax,\n    delivery_lead_time_value: hasLeadTimeValue ? snapshot.delivery.leadTimeValue : null,\n    delivery_lead_time_unit: hasLeadTimeValue ? snapshot.delivery.leadTimeUnit ?? null : null,\n    delivery_methods: deliveryMethodsJson,\n    include_addons_in_price: snapshot.pricing.includeAddOnsInPrice,\n    pricing_metadata: pricingMetadata,\n  };\n\n  return updatePayload;\n};\n\nexport const preparePackagePersistence = (\n  state: PackageCreationState,\n  context: PackagePersistenceContext,\n  options: CreatePackageSnapshotOptions = {}\n): PackagePersistencePayload => {\n  const snapshot = createPackageSnapshot(state, options);\n  const insert = buildPackageInsertPayload(snapshot, context);\n\n  return { snapshot, insert };\n};\n\nexport const buildPackageHydrationFromRecord = (\n  record: PackageRow\n): PackageHydrationSlices => {\n  const basics: PackageCreationBasics = {\n    name: record.name ?? \"\",\n    description: record.description ?? \"\",\n    applicableTypeIds: Array.isArray(record.applicable_types)\n      ? (record.applicable_types.filter(Boolean) as string[])\n      : [],\n    isActive: record.is_active ?? true,\n  };\n\n  const services: PackageCreationServicesState = {\n    items: parseServiceLineItems(record.line_items),\n    showQuickAdd: false,\n  };\n\n  const methodIds = parseDeliveryMethodIds(record.delivery_methods);\n  const enablePhotoEstimate =\n    record.delivery_photo_count_min !== null || record.delivery_photo_count_max !== null;\n  const enableLeadTime =\n    record.delivery_lead_time_value !== null &&\n    record.delivery_lead_time_value !== undefined;\n  const enableMethods = methodIds.length > 0;\n  const estimateType =\n    record.delivery_estimate_type === \"range\" ? \"range\" : \"single\";\n\n  const delivery: PackageCreationDeliveryState = {\n    enablePhotoEstimate,\n    enableLeadTime,\n    enableMethods,\n    estimateType,\n    countMin: enablePhotoEstimate ? record.delivery_photo_count_min ?? null : null,\n    countMax:\n      enablePhotoEstimate && estimateType === \"range\"\n        ? record.delivery_photo_count_max ?? null\n        : null,\n    leadTimeValue: enableLeadTime ? record.delivery_lead_time_value ?? null : null,\n    leadTimeUnit:\n      enableLeadTime && record.delivery_lead_time_unit === \"weeks\" ? \"weeks\" : \"days\",\n    methods: enableMethods ? methodIds : [],\n    customMethodDraft: \"\",\n  };\n\n  const pricingMeta = parsePricingMetadata(record.pricing_metadata);\n  const includeAddOnsInPrice =\n    record.include_addons_in_price === undefined || record.include_addons_in_price === null\n      ? true\n      : record.include_addons_in_price;\n\n  const basePriceInput =\n    pricingMeta.basePriceInput != null\n      ? pricingMeta.basePriceInput\n      : record.price != null\n      ? Number(record.price)\n      : null;\n  const packageVatInitialized =\n    pricingMeta.packageVatRate !== null ||\n    pricingMeta.packageVatOverrideEnabled ||\n    pricingMeta.basePriceInput !== null;\n\n  const pricing: PackageCreationPricingState = {\n    basePrice: basePriceInput != null ? String(basePriceInput) : \"\",\n    packageVatRate: pricingMeta.packageVatRate,\n    packageVatMode: pricingMeta.packageVatMode,\n    packageVatOverrideEnabled: pricingMeta.packageVatOverrideEnabled,\n    packageVatInitialized,\n    depositMode: pricingMeta.depositMode,\n    depositValue: pricingMeta.depositValue != null ? String(pricingMeta.depositValue) : \"\",\n    enableDeposit: pricingMeta.enableDeposit,\n    includeAddOnsInPrice,\n  };\n\n  return {\n    basics,\n    services,\n    delivery,\n    pricing,\n  };\n};\n\nconst buildBasicsSnapshot = (state: PackageCreationState): PackageBasicsSnapshot => {\n  const name = state.basics.name.trim();\n  const description = state.basics.description?.trim() || null;\n\n  return {\n    name,\n    description,\n    applicableTypeIds: state.basics.applicableTypeIds.filter(Boolean),\n    isActive: state.basics.isActive,\n  };\n};\n\nconst buildServicesSnapshot = (items: PackageCreationLineItem[]): PackageServicesSnapshot => {\n  const totalsAccumulator = {\n    cost: 0,\n    price: 0,\n    vat: 0,\n    total: 0,\n  };\n\n  const payloadItems = items.map((item) => {\n    const quantity = normalizeInteger(item.quantity, { fallback: 1 }) ?? 1;\n    const unitCost = Number(item.unitCost ?? 0);\n    const pricing = calculateLineItemPricing(item);\n\n    totalsAccumulator.cost += unitCost * quantity;\n    totalsAccumulator.price += pricing.net;\n    totalsAccumulator.vat += pricing.vat;\n    totalsAccumulator.total += pricing.gross;\n\n    return toLineItemPayload(item);\n  });\n\n  const defaultAddOnIds = Array.from(\n    new Set(\n      payloadItems\n        .filter((item) => item.type === \"existing\" && Boolean(item.serviceId))\n        .map((item) => item.serviceId as string)\n    )\n  );\n\n  const totalQuantity = payloadItems.reduce((sum, item) => sum + item.quantity, 0);\n\n  return {\n    items: payloadItems,\n    totals: {\n      cost: roundCurrency(totalsAccumulator.cost),\n      price: roundCurrency(totalsAccumulator.price),\n      vat: roundCurrency(totalsAccumulator.vat),\n      total: roundCurrency(totalsAccumulator.total),\n    },\n    defaultAddOnIds,\n    itemCount: payloadItems.length,\n    totalQuantity,\n  };\n};\n\nconst buildDeliverySnapshot = (\n  state: PackageCreationState,\n  catalog: DeliveryMethodCatalogEntry[]\n): PackageDeliverySnapshot => {\n  const catalogMap = new Map(catalog.map((entry) => [entry.id, entry]));\n  const photosEnabled = state.delivery.enablePhotoEstimate !== false;\n  const leadTimeEnabled = state.delivery.enableLeadTime !== false;\n  const methodsEnabled = state.delivery.enableMethods !== false;\n\n  const enabledMethodIds = methodsEnabled\n    ? Array.from(new Set((state.delivery.methods ?? []).filter(Boolean)))\n    : [];\n\n  const methods: PackageDeliveryMethodPayload[] = enabledMethodIds.map((methodId) => {\n    const entry = catalogMap.get(methodId);\n    return {\n      methodId,\n      name: entry?.name ?? null,\n    };\n  });\n\n  const estimateType = state.delivery.estimateType;\n  const photoCountMin = photosEnabled ? normalizeInteger(state.delivery.countMin) : null;\n  const photoCountMax = photosEnabled && estimateType === \"range\"\n    ? normalizeInteger(state.delivery.countMax)\n    : null;\n\n  const leadTimeValue = leadTimeEnabled\n    ? normalizeInteger(state.delivery.leadTimeValue, { allowZero: true })\n    : null;\n  const leadTimeUnit = leadTimeValue === null ? null : state.delivery.leadTimeUnit ?? \"days\";\n\n  return {\n    photosEnabled,\n    leadTimeEnabled,\n    methodsEnabled,\n    estimateType,\n    photoCountMin,\n    photoCountMax,\n    leadTimeValue,\n    leadTimeUnit,\n    methods,\n  };\n};\n\nconst buildPricingSnapshot = (\n  state: PackageCreationState,\n  totals: { cost: number; price: number; vat: number; total: number }\n): PackagePricingDetailsPayload => {\n  const basePriceInput = roundCurrency(parseCurrency(state.pricing.basePrice));\n  const packageVatRate = normalizeVatRate(state.pricing.packageVatRate) ?? 0;\n  const packageVatMode: PackageCreationLineItem[\"vatMode\"] =\n    state.pricing.packageVatMode === \"inclusive\" ? \"inclusive\" : \"exclusive\";\n  const packageVatOverrideEnabled = Boolean(state.pricing.packageVatOverrideEnabled);\n\n  const basePricePricing = calculateLineItemPricing({\n    id: \"package-base-price\",\n    type: \"custom\",\n    name: \"Package price\",\n    quantity: 1,\n    unitPrice: basePriceInput,\n    vatRate: packageVatRate,\n    vatMode: packageVatMode,\n  } as PackageCreationLineItem);\n\n  const basePriceNet = roundCurrency(basePricePricing.net);\n  const basePriceVatPortion = roundCurrency(basePricePricing.vat);\n  const basePrice = roundCurrency(basePricePricing.gross);\n\n  const servicesCostTotal = roundCurrency(totals.cost);\n  const servicesPriceTotal = roundCurrency(totals.price);\n  const servicesVatTotal = roundCurrency(totals.vat);\n  const servicesGrossTotal = roundCurrency(totals.total);\n  const servicesMargin = roundCurrency(servicesPriceTotal - servicesCostTotal);\n  const subtotal = roundCurrency(basePrice + servicesGrossTotal);\n  const includeAddOns = state.pricing.includeAddOnsInPrice ?? true;\n  const clientTotal = roundCurrency(includeAddOns ? basePrice : subtotal);\n\n  const depositMode = state.pricing.depositMode;\n  const enableDeposit = Boolean(state.pricing.enableDeposit);\n\n  if (depositMode === \"fixed\") {\n    const depositRaw = roundCurrency(parseCurrency(state.pricing.depositValue));\n    const depositAmount = enableDeposit ? depositRaw : 0;\n    return {\n      basePrice,\n      servicesCostTotal,\n      servicesPriceTotal,\n      servicesVatTotal,\n      servicesGrossTotal,\n      servicesMargin,\n      subtotal,\n      clientTotal,\n      includeAddOnsInPrice: includeAddOns,\n      depositMode,\n      depositValue: depositRaw,\n      depositAmount,\n      enableDeposit,\n      basePriceInput,\n      basePriceNet,\n      basePriceVatPortion,\n      packageVatRate,\n      packageVatMode,\n      packageVatOverrideEnabled,\n    };\n  }\n\n  const depositTarget = depositMode === \"percent_base\" ? \"base\" : \"subtotal\";\n  const percentValue = Math.max(0, parsePercent(state.pricing.depositValue));\n  const calculationTarget =\n    depositTarget === \"base\"\n      ? basePrice\n      : includeAddOns\n      ? clientTotal\n      : subtotal;\n  const depositAmount = roundCurrency((calculationTarget * percentValue) / 100);\n\n  return {\n    basePrice,\n    servicesCostTotal,\n    servicesPriceTotal,\n    servicesVatTotal,\n    servicesGrossTotal,\n    servicesMargin,\n    subtotal,\n    clientTotal,\n    includeAddOnsInPrice: includeAddOns,\n    depositMode,\n      depositTarget,\n      depositValue: percentValue,\n      depositAmount: enableDeposit ? depositAmount : 0,\n      enableDeposit,\n      basePriceInput,\n      basePriceNet,\n      basePriceVatPortion,\n      packageVatRate,\n      packageVatMode,\n      packageVatOverrideEnabled,\n  };\n};\n\nconst toLineItemPayload = (item: PackageCreationLineItem): PackageLineItemPayload => {\n  const quantity = normalizeInteger(item.quantity, { fallback: 1 }) ?? 1;\n  const name = item.name?.trim() || \"Unnamed service\";\n\n  const unitCost = normalizeMoney(item.unitCost);\n  const unitPrice = normalizeMoney(item.unitPrice);\n\n  const payload: PackageLineItemPayload = {\n    id: item.id,\n    type: item.type,\n    role: \"addon\",\n    serviceId: item.type === \"existing\" ? item.serviceId ?? null : null,\n    name,\n    quantity,\n    unitCost,\n    unitPrice,\n    vendorName: item.vendorName ?? null,\n    vatRate: normalizeVatRate(item.vatRate),\n    vatMode: item.vatMode ?? \"exclusive\",\n    unit: typeof item.unit === \"string\" && item.unit.trim().length ? item.unit : null,\n  };\n\n  if (item.source) {\n    payload.source = item.source;\n  }\n\n  return payload;\n};\n\nconst buildPricingMetadata = (pricing: PackagePricingDetailsPayload): Json => {\n  return {\n    enableDeposit: pricing.enableDeposit,\n    depositMode: pricing.depositMode,\n    depositValue: pricing.depositValue,\n    depositTarget: pricing.depositTarget ?? null,\n    depositAmount: pricing.depositAmount,\n    packageVatRate: pricing.packageVatRate,\n    packageVatMode: pricing.packageVatMode,\n    packageVatOverrideEnabled: pricing.packageVatOverrideEnabled,\n    basePriceInput: pricing.basePriceInput,\n  } as Json;\n};\n\nconst parseServiceLineItems = (value: Json): PackageCreationLineItem[] => {\n  if (!Array.isArray(value)) return [];\n\n  return (value as unknown[]).map((entry, index) => {\n    if (!entry || typeof entry !== \"object\") {\n      return createFallbackLineItem(index);\n    }\n\n    const item = entry as Record<string, unknown>;\n    const type: PackageLineItemType =\n      item.type === \"existing\" ? \"existing\" : \"custom\";\n    const quantity =\n      normalizeInteger(\n        typeof item.quantity === \"number\"\n          ? item.quantity\n          : Number(item.quantity ?? 1),\n        { fallback: 1 }\n      ) ?? 1;\n\n    const unitCost =\n      item.unitCost != null && !Number.isNaN(Number(item.unitCost))\n        ? Number(item.unitCost)\n        : undefined;\n    const unitPrice =\n      item.unitPrice != null && !Number.isNaN(Number(item.unitPrice))\n        ? Number(item.unitPrice)\n        : undefined;\n    const source =\n      item.source === \"catalog\" || item.source === \"adhoc\"\n        ? (item.source as \"catalog\" | \"adhoc\")\n        : undefined;\n    const vatRate =\n      item.vatRate != null && !Number.isNaN(Number(item.vatRate))\n        ? normalizeVatRate(Number(item.vatRate))\n        : null;\n    const rawVatMode = item.vatMode;\n    const vatMode: PackageCreationLineItem[\"vatMode\"] =\n      rawVatMode === \"inclusive\" || rawVatMode === \"exclusive\"\n        ? rawVatMode\n        : \"exclusive\";\n    const unit =\n      typeof item.unit === \"string\" && item.unit.trim().length\n        ? item.unit\n        : typeof (item as any).defaultUnit === \"string\" && (item as any).defaultUnit.trim().length\n        ? ((item as any).defaultUnit as string)\n        : null;\n\n    return {\n      id: typeof item.id === \"string\" ? item.id : createRandomId(),\n      type,\n      serviceId:\n        type === \"existing\" && typeof item.serviceId === \"string\"\n          ? item.serviceId\n          : undefined,\n      name:\n        typeof item.name === \"string\" && item.name.trim().length\n          ? item.name\n          : `Hizmet ${index + 1}`,\n      quantity,\n      unitCost,\n      unitPrice,\n      vendorName:\n        typeof item.vendorName === \"string\" ? item.vendorName : undefined,\n      source,\n      vatRate,\n      vatMode,\n      unit,\n    };\n  });\n};\n\nconst parseDeliveryMethodIds = (value: Json): string[] => {\n  if (!Array.isArray(value)) return [];\n  const ids: string[] = [];\n\n  for (const entry of value as unknown[]) {\n    if (typeof entry === \"string\") {\n      ids.push(entry);\n      continue;\n    }\n    if (entry && typeof entry === \"object\") {\n      const record = entry as Record<string, unknown>;\n      if (typeof record.methodId === \"string\") {\n        ids.push(record.methodId);\n      } else if (typeof record.id === \"string\") {\n        ids.push(record.id);\n      }\n    }\n  }\n\n  return Array.from(new Set(ids));\n};\n\nconst parsePricingMetadata = (\n  value: Json\n): {\n  enableDeposit: boolean;\n  depositMode: PackageCreationState[\"pricing\"][\"depositMode\"];\n  depositValue: number | null;\n  packageVatRate: number | null;\n  packageVatMode: PackageCreationLineItem[\"vatMode\"];\n  packageVatOverrideEnabled: boolean;\n  basePriceInput: number | null;\n} => {\n  if (!value || typeof value !== \"object\") {\n    return {\n      enableDeposit: false,\n      depositMode: \"percent_subtotal\",\n      depositValue: null,\n      packageVatRate: null,\n      packageVatMode: \"inclusive\",\n      packageVatOverrideEnabled: false,\n      basePriceInput: null,\n    };\n  }\n\n  const metadata = value as Record<string, unknown>;\n  const enableDeposit = Boolean(metadata.enableDeposit);\n  const rawMode = metadata.depositMode;\n  const depositMode: PackageCreationState[\"pricing\"][\"depositMode\"] =\n    rawMode === \"percent_base\" || rawMode === \"fixed\"\n      ? (rawMode as PackageCreationState[\"pricing\"][\"depositMode\"])\n      : \"percent_subtotal\";\n\n  const depositValue =\n    typeof metadata.depositValue === \"number\"\n      ? metadata.depositValue\n      : Number.isFinite(Number(metadata.depositValue))\n      ? Number(metadata.depositValue)\n      : null;\n\n  const packageVatRate = normalizeVatRate(\n    typeof metadata.packageVatRate === \"number\"\n      ? metadata.packageVatRate\n      : Number.isFinite(Number(metadata.packageVatRate))\n      ? Number(metadata.packageVatRate)\n      : null\n  );\n  const rawPackageVatMode = metadata.packageVatMode;\n  const packageVatMode: PackageCreationLineItem[\"vatMode\"] =\n    rawPackageVatMode === \"inclusive\" || rawPackageVatMode === \"exclusive\" ? rawPackageVatMode : \"inclusive\";\n  const packageVatOverrideEnabled = Boolean(metadata.packageVatOverrideEnabled);\n  const basePriceInput =\n    typeof metadata.basePriceInput === \"number\"\n      ? metadata.basePriceInput\n      : Number.isFinite(Number(metadata.basePriceInput))\n      ? Number(metadata.basePriceInput)\n      : null;\n\n  return {\n    enableDeposit,\n    depositMode,\n    depositValue,\n    packageVatRate,\n    packageVatMode,\n    packageVatOverrideEnabled,\n    basePriceInput,\n  };\n};\n\nconst createFallbackLineItem = (seed: number): PackageCreationLineItem => ({\n  id: createRandomId(),\n  type: \"custom\",\n  name: `Hizmet ${seed + 1}`,\n  quantity: 1,\n  vatRate: null,\n  vatMode: \"exclusive\",\n  unit: null,\n});\n\nconst createRandomId = (): string => {\n  if (typeof crypto !== \"undefined\" && typeof crypto.randomUUID === \"function\") {\n    return crypto.randomUUID();\n  }\n  return `pkg_${Math.random().toString(36).slice(2, 10)}`;\n};\n\nconst normalizeInteger = (\n  value: number | null | undefined,\n  options: { allowZero?: boolean; fallback?: number } = {}\n): number | null => {\n  if (value === null || value === undefined) {\n    return options.fallback ?? null;\n  }\n\n  const parsed = Number.isFinite(value) ? Math.floor(Number(value)) : NaN;\n  if (!Number.isFinite(parsed)) {\n    return options.fallback ?? null;\n  }\n\n  if (!options.allowZero && parsed <= 0) {\n    return options.fallback ?? null;\n  }\n\n  return parsed;\n};\n\nconst normalizeMoney = (value: number | null | undefined): number | null => {\n  if (value === null || value === undefined) return null;\n  if (Number.isNaN(value)) return null;\n  return roundCurrency(Number(value));\n};\n\nconst normalizeVatRate = (value: number | null | undefined): number | null => {\n  if (value === null || value === undefined) return null;\n  if (!Number.isFinite(value)) return null;\n  if (value <= 0) return null;\n  return Math.min(99.99, Math.max(0, Number(value)));\n};\n\nconst parseCurrency = (input: string | number | null | undefined): number => {\n  if (typeof input === \"number\") {\n    return Number.isFinite(input) ? input : 0;\n  }\n\n  if (!input) return 0;\n\n  const numeric = Number.parseFloat(String(input).replace(/[^0-9.,-]/g, \"\").replace(/,/g, \".\"));\n  return Number.isFinite(numeric) ? numeric : 0;\n};\n\nconst parsePercent = (input: string | number | null | undefined): number => {\n  if (typeof input === \"number\") {\n    return Number.isFinite(input) ? input : 0;\n  }\n\n  if (!input) return 0;\n\n  const numeric = Number.parseFloat(String(input).replace(/[^0-9.,-]/g, \"\").replace(/,/g, \".\"));\n  return Number.isFinite(numeric) ? numeric : 0;\n};\n\nconst roundCurrency = (value: number): number => {\n  return Math.round((Number.isFinite(value) ? value : 0) * 100) / 100;\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/state/__tests__/packageCreationReducer.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/state/packageCreationReducer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/steps/BasicsStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/steps/DeliveryStep.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":243,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8639,8642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8639,8642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":279,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9720,9723],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9720,9723],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { SegmentedControl } from \"@/components/ui/segmented-control\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { usePackageCreationContext } from \"../hooks/usePackageCreationContext\";\nimport { usePackageCreationActions } from \"../hooks/usePackageCreationActions\";\nimport { usePackageDeliveryMethods } from \"@/hooks/useOrganizationData\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { ToggleSection } from \"@/components/ui/toggle-section\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { SelectablePill } from \"@/components/ui/selectable-pill\";\n\ninterface DeliveryMethodRecord {\n  id: string;\n  name: string;\n  description?: string | null;\n  is_active?: boolean | null;\n  sort_order?: number | null;\n}\n\nconst DEFAULT_METHOD_NAMES = [\n  \"Ã‡evrim iÃ§i galeri\",\n  \"USB Bellek\",\n  \"BaskÄ±lÄ± albÃ¼m\",\n];\n\nexport const DeliveryStep = () => {\n  const { t } = useTranslation(\"packageCreation\");\n  const { state } = usePackageCreationContext();\n  const { updateDelivery } = usePackageCreationActions();\n  const { activeOrganizationId } = useOrganization();\n  const { toast } = useToast();\n\n  const methodsQuery = usePackageDeliveryMethods();\n  const methods = useMemo<DeliveryMethodRecord[]>(\n    () =>\n      ((methodsQuery.data as DeliveryMethodRecord[] | undefined) ?? []).filter(\n        (method) => method.is_active !== false\n      ),\n    [methodsQuery.data]\n  );\n\n  const [newMethodName, setNewMethodName] = useState(\"\");\n  const [isSavingMethod, setIsSavingMethod] = useState(false);\n  const [methodError, setMethodError] = useState<string | null>(null);\n  const [methodToDelete, setMethodToDelete] = useState<DeliveryMethodRecord | null>(null);\n  const [isDeletingMethod, setIsDeletingMethod] = useState(false);\n\n  const leadTimeUnit = state.delivery.leadTimeUnit ?? \"days\";\n  const photoEnabled = state.delivery.enablePhotoEstimate !== false;\n  const leadTimeEnabled = state.delivery.enableLeadTime !== false;\n  const methodsEnabled = state.delivery.enableMethods !== false;\n  const selectedMethodIds = Array.isArray(state.delivery.methods) ? state.delivery.methods : [];\n\n  const handleEstimateChange = (value: string) => {\n    if (value !== \"single\" && value !== \"range\") return;\n    updateDelivery({ estimateType: value });\n    if (value === \"single\") {\n      const singleValue = state.delivery.countMin ?? state.delivery.countMax ?? null;\n      updateDelivery({ countMin: singleValue, countMax: null });\n    }\n  };\n\n  const updateSingleCount = (value: string) => {\n    const parsed = parsePositiveInt(value);\n    updateDelivery({ countMin: parsed, countMax: null });\n  };\n\n  const updateRangeCount = (key: \"countMin\" | \"countMax\", value: string) => {\n    const parsed = parsePositiveInt(value);\n    updateDelivery({ [key]: parsed });\n  };\n\n  const updateLeadTimeValue = (value: string) => {\n    const parsed = parsePositiveInt(value, { allowZero: true });\n    updateDelivery({ leadTimeValue: parsed });\n  };\n\n  const updateLeadTimeUnit = (value: \"days\" | \"weeks\") => {\n    updateDelivery({ leadTimeUnit: value });\n  };\n\n  const toggleMethod = (methodId: string) => {\n    if (!methodsEnabled) return;\n    if (selectedMethodIds.includes(methodId)) {\n      updateDelivery({ methods: selectedMethodIds.filter((id) => id !== methodId) });\n    } else {\n      updateDelivery({ methods: [...selectedMethodIds, methodId] });\n    }\n  };\n\n  const handlePhotoToggle = (enabled: boolean) => {\n    if (enabled) {\n      updateDelivery({ enablePhotoEstimate: true });\n      return;\n    }\n    updateDelivery({ enablePhotoEstimate: false, countMin: null, countMax: null });\n  };\n\n  const handleLeadTimeToggle = (enabled: boolean) => {\n    if (enabled) {\n      updateDelivery({ enableLeadTime: true });\n      return;\n    }\n    updateDelivery({ enableLeadTime: false, leadTimeValue: null });\n  };\n\n  const handleMethodsToggle = (enabled: boolean) => {\n    if (enabled) {\n      updateDelivery({ enableMethods: true });\n      return;\n    }\n    setMethodError(null);\n    setNewMethodName(\"\");\n    updateDelivery({ enableMethods: false, methods: [] });\n  };\n\n  const photoSummary = photoEnabled\n    ? (() => {\n        if (state.delivery.estimateType === \"range\") {\n          return state.delivery.countMin && state.delivery.countMax\n            ? t(\"steps.delivery.sections.photo.range\", {\n                min: state.delivery.countMin,\n                max: state.delivery.countMax,\n              })\n            : t(\"steps.delivery.sections.photo.notSet\");\n        }\n        return state.delivery.countMin\n          ? t(\"steps.delivery.sections.photo.single\", { count: state.delivery.countMin })\n          : t(\"steps.delivery.sections.photo.notSet\");\n      })()\n    : t(\"steps.delivery.sections.disabled\");\n\n  const leadTimeSummary = leadTimeEnabled\n    ? state.delivery.leadTimeValue\n      ? t(\"steps.delivery.sections.leadTime.value\", {\n          value: state.delivery.leadTimeValue,\n          unit: t(`steps.delivery.leadTime.${state.delivery.leadTimeUnit ?? \"days\"}`),\n        })\n      : t(\"steps.delivery.sections.leadTime.notSet\")\n    : t(\"steps.delivery.sections.disabled\");\n\n  const methodsSummary = methodsEnabled\n    ? selectedMethodIds.length\n      ? t(\"steps.delivery.sections.methods.count\", { count: selectedMethodIds.length })\n      : t(\"steps.delivery.sections.methods.notSet\")\n    : t(\"steps.delivery.sections.disabled\");\n\n  const handleAddMethod = async () => {\n    const trimmed = newMethodName.trim();\n    setMethodError(null);\n\n    if (!methodsEnabled) {\n      return;\n    }\n\n    if (!trimmed) {\n      setMethodError(t(\"steps.delivery.methods.errors.required\", { defaultValue: \"Enter a method name.\" }));\n      return;\n    }\n\n    if (!activeOrganizationId) {\n      setMethodError(t(\"steps.delivery.methods.errors.organization\", { defaultValue: \"Select an organization before adding methods.\" }));\n      return;\n    }\n\n    const catalogRecords = (methodsQuery.data as DeliveryMethodRecord[] | undefined) ?? [];\n    const normalizedInput = trimmed.toLocaleLowerCase(\"tr-TR\");\n    const existingRecord = catalogRecords.find(\n      (record) => record.name?.trim().toLocaleLowerCase(\"tr-TR\") === normalizedInput\n    );\n\n    if (existingRecord && existingRecord.is_active !== false) {\n      setMethodError(t(\"steps.delivery.methods.errors.duplicate\", { defaultValue: \"This method already exists.\" }));\n      return;\n    }\n\n    setIsSavingMethod(true);\n    try {\n      const { data: { user }, error: authError } = await supabase.auth.getUser();\n      if (authError) throw authError;\n      if (!user) throw new Error(\"Auth required\");\n\n      let methodId: string | null = null;\n      let reactivated = false;\n\n      if (existingRecord && existingRecord.is_active === false) {\n        const { error } = await supabase\n          .from(\"package_delivery_methods\")\n          .update({ is_active: true })\n          .eq(\"id\", existingRecord.id);\n        if (error) throw error;\n        methodId = existingRecord.id;\n        reactivated = true;\n      } else {\n        const { data, error } = await supabase\n          .from(\"package_delivery_methods\")\n          .insert([\n            {\n              organization_id: activeOrganizationId,\n              user_id: user.id,\n              name: trimmed,\n              sort_order: DEFAULT_METHOD_NAMES.includes(trimmed) ? 0 : 100,\n            },\n          ])\n          .select()\n          .single();\n\n        if (error) throw error;\n        methodId = data?.id ?? null;\n      }\n\n      await methodsQuery.refetch();\n      if (methodId) {\n        updateDelivery({\n          methods: Array.from(new Set([...selectedMethodIds.filter(Boolean), methodId])),\n        });\n      }\n      setNewMethodName(\"\");\n      toast({\n        title: t(\"common:toast.success\"),\n        description: reactivated\n          ? t(\"steps.delivery.methods.reactivateSuccess\", {\n              name: existingRecord?.name ?? trimmed,\n              defaultValue: \"Delivery method restored.\",\n            })\n          : t(\"steps.delivery.methods.success\", { defaultValue: \"Delivery method added.\" }),\n      });\n    } catch (error: any) {\n      console.error(\"Failed to add delivery method\", error);\n      setMethodError(error.message ?? \"Unable to add delivery method\");\n    } finally {\n      setIsSavingMethod(false);\n    }\n  };\n\n  const handleRequestDeleteMethod = (method: DeliveryMethodRecord) => {\n    setMethodToDelete(method);\n  };\n\n  const handleConfirmDeleteMethod = async () => {\n    if (!methodToDelete) return;\n    setIsDeletingMethod(true);\n    try {\n      const { error } = await supabase\n        .from(\"package_delivery_methods\")\n        .update({ is_active: false })\n        .eq(\"id\", methodToDelete.id);\n\n      if (error) throw error;\n\n      updateDelivery({\n        methods: selectedMethodIds.filter((id) => id !== methodToDelete.id),\n      });\n\n      await methodsQuery.refetch();\n      toast({\n        title: t(\"common:toast.success\", { defaultValue: \"Success\" }),\n        description: t(\"steps.delivery.methods.removeSuccess\", {\n          name: methodToDelete.name,\n          defaultValue: \"Delivery method removed.\",\n        }),\n      });\n      setMethodToDelete(null);\n    } catch (error: any) {\n      console.error(\"Failed to remove delivery method\", error);\n      toast({\n        variant: \"destructive\",\n        title: t(\"common:toast.error\", { defaultValue: \"Something went wrong\" }),\n        description: t(\"steps.delivery.methods.removeError\", {\n          defaultValue: \"We couldn't remove this delivery method.\",\n        }),\n      });\n    } finally {\n      setIsDeletingMethod(false);\n    }\n  };\n\n  const handleDeleteDialogOpenChange = (open: boolean) => {\n    if (!open && !isDeletingMethod) {\n      setMethodToDelete(null);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"space-y-2\">\n        <h2 className=\"text-xl font-semibold tracking-tight text-slate-900\">\n          {t(\"steps.delivery.title\")}\n        </h2>\n        <p className=\"text-sm text-muted-foreground\">\n          {t(\"steps.delivery.description\")}\n        </p>\n      </div>\n\n      <div className=\"space-y-4\">\n        <ToggleSection\n          title={t(\"steps.delivery.sections.photo.title\")}\n          description={t(\"steps.delivery.sections.photo.description\")}\n          enabled={photoEnabled}\n          onToggle={handlePhotoToggle}\n          summary={<span>{photoSummary}</span>}\n        >\n          <div className=\"space-y-3\">\n            <SegmentedControl\n              value={state.delivery.estimateType}\n              onValueChange={handleEstimateChange}\n              options={[\n                { value: \"single\", label: t(\"steps.delivery.photoCount.single.label\") },\n                { value: \"range\", label: t(\"steps.delivery.photoCount.range.label\") },\n              ]}\n            />\n\n            {state.delivery.estimateType === \"single\" ? (\n              <div className=\"grid max-w-xs gap-2\">\n                <Input\n                  inputMode=\"numeric\"\n                  pattern=\"[0-9]*\"\n                  value={state.delivery.countMin ? String(state.delivery.countMin) : \"\"}\n                  onChange={(event) => updateSingleCount(event.target.value)}\n                  placeholder={t(\"steps.delivery.photoCount.single.placeholder\")}\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  {t(\"steps.delivery.photoCount.single.helper\")}\n                </p>\n              </div>\n            ) : (\n              <div className=\"grid gap-3 sm:grid-cols-2 sm:max-w-md\">\n                <div className=\"space-y-2\">\n                  <Input\n                    inputMode=\"numeric\"\n                    pattern=\"[0-9]*\"\n                    value={state.delivery.countMin ? String(state.delivery.countMin) : \"\"}\n                    onChange={(event) => updateRangeCount(\"countMin\", event.target.value)}\n                    placeholder={t(\"steps.delivery.photoCount.range.minPlaceholder\")}\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    {t(\"steps.delivery.photoCount.range.minHelper\")}\n                  </p>\n                </div>\n                <div className=\"space-y-2\">\n                  <Input\n                    inputMode=\"numeric\"\n                    pattern=\"[0-9]*\"\n                    value={state.delivery.countMax ? String(state.delivery.countMax) : \"\"}\n                    onChange={(event) => updateRangeCount(\"countMax\", event.target.value)}\n                    placeholder={t(\"steps.delivery.photoCount.range.maxPlaceholder\")}\n                  />\n                  <p className=\"text-xs text-muted-foreground\">\n                    {t(\"steps.delivery.photoCount.range.maxHelper\")}\n                  </p>\n                </div>\n              </div>\n            )}\n          </div>\n        </ToggleSection>\n\n        <ToggleSection\n          title={t(\"steps.delivery.sections.leadTime.title\")}\n          description={t(\"steps.delivery.sections.leadTime.description\")}\n          enabled={leadTimeEnabled}\n          onToggle={handleLeadTimeToggle}\n          summary={<span>{leadTimeSummary}</span>}\n        >\n          <div className=\"space-y-2\">\n            <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3\">\n              <Input\n                className=\"sm:w-32\"\n                inputMode=\"numeric\"\n                pattern=\"[0-9]*\"\n                value={state.delivery.leadTimeValue ? String(state.delivery.leadTimeValue) : \"\"}\n                onChange={(event) => updateLeadTimeValue(event.target.value)}\n                placeholder={t(\"steps.delivery.leadTime.placeholder\")}\n              />\n              <Select value={leadTimeUnit} onValueChange={updateLeadTimeUnit}>\n                <SelectTrigger className=\"sm:w-40\">\n                  <SelectValue placeholder={t(\"steps.delivery.leadTime.unitPlaceholder\")} />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"days\">{t(\"steps.delivery.leadTime.days\")}</SelectItem>\n                  <SelectItem value=\"weeks\">{t(\"steps.delivery.leadTime.weeks\")}</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              {t(\"steps.delivery.leadTime.helper\")}\n            </p>\n          </div>\n        </ToggleSection>\n\n        <ToggleSection\n          title={t(\"steps.delivery.sections.methods.title\")}\n          description={t(\"steps.delivery.sections.methods.description\")}\n          enabled={methodsEnabled}\n          onToggle={handleMethodsToggle}\n          summary={<span>{methodsSummary}</span>}\n        >\n          <div className=\"space-y-3\">\n            <p className=\"text-xs text-muted-foreground\">\n              {t(\"steps.delivery.methods.helper\")}\n            </p>\n            {methodsQuery.isLoading ? (\n              <div className=\"flex flex-wrap gap-2\">\n                {Array.from({ length: 4 }).map((_, index) => (\n                  <Skeleton key={index} className=\"h-6 w-24 rounded-full\" />\n                ))}\n              </div>\n            ) : methods.length === 0 ? (\n              <div className=\"rounded-md border border-dashed px-3 py-4 text-sm text-muted-foreground\">\n                {t(\"steps.delivery.methods.empty\")}\n              </div>\n            ) : (\n              <div className=\"flex flex-wrap gap-2\">\n                {methods.map((method) => {\n                  const isSelected = selectedMethodIds.includes(method.id);\n                  return (\n                    <SelectablePill\n                      key={method.id}\n                      selected={isSelected}\n                      onClick={() => toggleMethod(method.id)}\n                      onRemove={() => handleRequestDeleteMethod(method)}\n                      removeLabel={t(\"steps.delivery.methods.removeLabel\", {\n                        name: method.name,\n                        defaultValue: \"Remove method\",\n                      })}\n                      className=\"text-xs\"\n                    >\n                      {method.name}\n                    </SelectablePill>\n                  );\n                })}\n              </div>\n            )}\n\n            <div className=\"space-y-2\">\n              <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3\">\n                <Input\n                  value={newMethodName}\n                  onChange={(event) => setNewMethodName(event.target.value)}\n                  placeholder={t(\"steps.delivery.methods.placeholder\")}\n                  className=\"sm:w-64\"\n                />\n                <Button onClick={handleAddMethod} disabled={isSavingMethod || !newMethodName.trim()}>\n                  {isSavingMethod\n                    ? t(\"steps.delivery.methods.saving\", { defaultValue: \"Savingâ€¦\" })\n                    : t(\"steps.delivery.methods.add\")}\n                </Button>\n              </div>\n              {methodError ? (\n                <p className=\"text-xs text-destructive\">{methodError}</p>\n              ) : (\n                <p className=\"text-xs text-muted-foreground\">\n                  {t(\"steps.delivery.methods.addHelper\")}\n                </p>\n              )}\n            </div>\n          </div>\n        </ToggleSection>\n      </div>\n\n      <AlertDialog open={!!methodToDelete} onOpenChange={handleDeleteDialogOpenChange}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>\n              {t(\"steps.delivery.methods.removeConfirmTitle\", {\n                name: methodToDelete?.name ?? \"\",\n                defaultValue: \"Remove this delivery method?\",\n              })}\n            </AlertDialogTitle>\n            <AlertDialogDescription>\n              {t(\"steps.delivery.methods.removeConfirmDescription\", {\n                defaultValue:\n                  \"This method will disappear from your catalog. Any packages using it will stop showing this method.\",\n              })}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel disabled={isDeletingMethod}>\n              {t(\"steps.delivery.methods.removeCancel\", { defaultValue: \"Keep\" })}\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleConfirmDeleteMethod}\n              disabled={isDeletingMethod}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {isDeletingMethod\n                ? t(\"steps.delivery.methods.removeInProgress\", { defaultValue: \"Removingâ€¦\" })\n                : t(\"steps.delivery.methods.removeConfirm\", { defaultValue: \"Remove\" })}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n};\n\nfunction parsePositiveInt(value: string, options: { allowZero?: boolean } = {}) {\n  const numeric = value.replace(/[^0-9]/g, \"\");\n  if (!numeric) return null;\n  const parsed = parseInt(numeric, 10);\n  if (!Number.isFinite(parsed)) return null;\n  if (parsed === 0 && !options.allowZero) return null;\n  return parsed;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/steps/PricingStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/steps/ServicesStep.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getUnitLabel'. Either include it or remove the dependency array.","line":581,"column":6,"nodeType":"ArrayExpression","endLine":581,"endColumn":43,"suggestions":[{"desc":"Update the dependencies array to be: [getUnitLabel, serviceMap, state.services.items]","fix":{"range":[19014,19051],"text":"[getUnitLabel, serviceMap, state.services.items]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  ServiceInventorySelector,\n  type ServiceInventoryItem,\n  type ServiceInventoryType,\n} from \"@/components/ServiceInventorySelector\";\nimport {\n  ServicesTableCard,\n  type ServicesTableRow,\n  SummaryTotalRow,\n  SummaryTotalsCard,\n  SummaryTotalsDivider,\n  SummaryTotalsSection,\n} from \"@/components/services\";\nimport {\n  useServices,\n  useOrganizationTaxProfile,\n} from \"@/hooks/useOrganizationData\";\nimport { usePackageCreationContext } from \"../hooks/usePackageCreationContext\";\nimport { usePackageCreationActions } from \"../hooks/usePackageCreationActions\";\nimport type { PackageCreationLineItem, PackageVatMode } from \"../types\";\nimport { cn } from \"@/lib/utils\";\nimport { calculateLineItemPricing } from \"../utils/lineItemPricing\";\nimport {\n  DEFAULT_SERVICE_UNIT,\n  normalizeServiceUnit,\n  type ServiceUnit,\n} from \"@/lib/services/units\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Users, Package as PackageIcon, Layers } from \"lucide-react\";\nimport {\n  ServiceVatOverridesSection,\n  type ServiceVatOverridesItem,\n  type ServiceVatOverridesMeta,\n} from \"@/features/services/components/ServiceVatOverridesSection\";\nimport {\n  CustomServicesSection,\n  type CustomServiceFormState,\n  type CustomServiceItemView,\n} from \"@/features/services/components/CustomServicesSection\";\ninterface ServiceRecord {\n  id: string;\n  name: string;\n  category?: string | null;\n  cost_price?: number | null;\n  selling_price?: number | null;\n  price?: number | null;\n  vendor_name?: string | null;\n  is_active?: boolean | null;\n  service_type?: ServiceInventoryType | null;\n  vat_rate?: number | null;\n  price_includes_vat?: boolean | null;\n  default_unit?: string | null;\n}\n\ninterface ServiceWithMetadata extends ServiceRecord {\n  unitCost: number;\n  unitPrice: number;\n  serviceType: ServiceInventoryType;\n  isActive: boolean;\n  vatRate: number | null;\n  vatMode: PackageVatMode;\n  priceIncludesVat: boolean;\n  unit: ServiceUnit;\n}\n\nconst formatCurrency = (amount: number) =>\n  new Intl.NumberFormat(\"tr-TR\", {\n    style: \"currency\",\n    currency: \"TRY\",\n    minimumFractionDigits: 0,\n  }).format(amount);\n\nexport const ServicesStep = () => {\n  const { t } = useTranslation(\"packageCreation\");\n  const { t: tForms } = useTranslation(\"forms\");\n  const { state } = usePackageCreationContext();\n  const { updateServices } = usePackageCreationActions();\n\n  const servicesQuery = useServices();\n  const taxProfileQuery = useOrganizationTaxProfile();\n  const taxProfile = taxProfileQuery.data;\n  const defaultVatRate = useMemo(() => {\n    if (\n      typeof taxProfile?.defaultVatRate === \"number\" &&\n      Number.isFinite(taxProfile.defaultVatRate)\n    ) {\n      return Number(taxProfile.defaultVatRate);\n    }\n    return 0;\n  }, [taxProfile]);\n  const defaultVatMode: PackageVatMode = useMemo(\n    () =>\n      taxProfile?.defaultVatMode === \"inclusive\" ? \"inclusive\" : \"exclusive\",\n    [taxProfile]\n  );\n  const defaultVatRateString = useMemo(\n    () =>\n      Number.isFinite(defaultVatRate) && defaultVatRate !== null\n        ? String(defaultVatRate)\n        : \"\",\n    [defaultVatRate]\n  );\n  const services = useMemo(\n    () => (servicesQuery.data as ServiceRecord[] | undefined) ?? [],\n    [servicesQuery.data]\n  );\n\n  const [customName, setCustomName] = useState(\"\");\n  const [customCost, setCustomCost] = useState(\"\");\n  const [customPrice, setCustomPrice] = useState(\"\");\n  const [customError, setCustomError] = useState<string | null>(null);\n  const [customVatRate, setCustomVatRate] = useState<string>(\n    defaultVatRateString\n  );\n  const [customVatMode, setCustomVatMode] =\n    useState<PackageVatMode>(defaultVatMode);\n  const [customVatPanels, setCustomVatPanels] = useState<\n    Record<string, boolean>\n  >({});\n  const [showQuickAddVatForm, setShowQuickAddVatForm] = useState(false);\n  const [showQuickAddVatResetPrompt, setShowQuickAddVatResetPrompt] =\n    useState(false);\n  const [pendingCustomVatResetId, setPendingCustomVatResetId] = useState<\n    string | null\n  >(null);\n  const hasVatOverrides = useMemo(() => {\n    return state.services.items.some((item) => {\n      const rate =\n        typeof item.vatRate === \"number\" && Number.isFinite(item.vatRate)\n          ? item.vatRate\n          : null;\n      const mode = item.vatMode ?? null;\n      const rateDiff = rate != null && Math.abs(rate - defaultVatRate) > 0.001;\n      const modeDiff = mode != null && mode !== defaultVatMode;\n      return rateDiff || modeDiff;\n    });\n  }, [state.services.items, defaultVatRate, defaultVatMode]);\n  const [showVatControls, setShowVatControls] = useState(false);\n  const [showVatResetPrompt, setShowVatResetPrompt] = useState(false);\n\n  useEffect(() => {\n    if (!state.services.showQuickAdd) {\n      setCustomVatRate(defaultVatRateString);\n      setCustomVatMode(defaultVatMode);\n      setShowQuickAddVatForm(false);\n      setShowQuickAddVatResetPrompt(false);\n    }\n  }, [\n    defaultVatMode,\n    defaultVatRateString,\n    state.services.showQuickAdd,\n  ]);\n\n  const serviceMap = useMemo<Map<string, ServiceWithMetadata>>(() => {\n    const entries = services\n      .filter((service) => service.is_active !== false)\n      .map((service) => {\n        const vatRate =\n          typeof service.vat_rate === \"number\" &&\n          Number.isFinite(service.vat_rate)\n            ? Number(service.vat_rate)\n            : null;\n        const vatMode: PackageVatMode = service.price_includes_vat\n          ? \"inclusive\"\n          : \"exclusive\";\n        const unit = normalizeServiceUnit(service.default_unit);\n        return [\n          service.id,\n          {\n            ...service,\n            unitCost: service.cost_price ?? 0,\n            unitPrice: service.selling_price ?? service.price ?? 0,\n            serviceType: (service.service_type ??\n              \"unknown\") as ServiceInventoryType,\n            isActive: true,\n            vatRate,\n            vatMode,\n            priceIncludesVat: service.price_includes_vat ?? false,\n            unit,\n          },\n        ] as const;\n      });\n    return new Map(entries);\n  }, [services]);\n\n  const inventoryServices = useMemo<ServiceInventoryItem[]>(\n    () =>\n      services\n        .filter((service) => service.is_active !== false)\n        .map((service) => ({\n          id: service.id,\n          name: service.name,\n          category: service.category,\n          serviceType: (service.service_type ??\n            \"unknown\") as ServiceInventoryType,\n          vendorName: service.vendor_name ?? null,\n          unitCost: service.cost_price ?? null,\n          unitPrice: service.selling_price ?? service.price ?? null,\n          unit: normalizeServiceUnit(service.default_unit),\n          defaultUnit: service.default_unit ?? null,\n          isActive: true,\n          vatRate:\n            typeof service.vat_rate === \"number\" &&\n            Number.isFinite(service.vat_rate)\n              ? Number(service.vat_rate)\n              : null,\n          priceIncludesVat: service.price_includes_vat ?? false,\n        })),\n    [services]\n  );\n\n  const existingItems = state.services.items.filter(\n    (item) => item.type === \"existing\"\n  );\n  const customItems = state.services.items.filter(\n    (item) => item.type === \"custom\"\n  );\n\n  const selectedQuantities = useMemo(\n    () =>\n      existingItems.reduce<Record<string, number>>((acc, item) => {\n        if (item.serviceId) {\n          acc[item.serviceId] = Math.max(1, item.quantity ?? 1);\n        }\n        return acc;\n      }, {}),\n    [existingItems]\n  );\n\n  const totals = useMemo(() => {\n    return state.services.items.reduce(\n      (acc, item) => {\n        const quantity = Math.max(1, item.quantity ?? 1);\n        const unitCost = Number(item.unitCost ?? 0);\n        const pricing = calculateLineItemPricing(item);\n        acc.cost += unitCost * quantity;\n        acc.price += pricing.net;\n        acc.vat += pricing.vat;\n        acc.total += pricing.gross;\n        return acc;\n      },\n      { cost: 0, price: 0, vat: 0, total: 0 }\n    );\n  }, [state.services.items]);\n\n  const margin = totals.price - totals.cost;\n\n  const parseQuantityInput = (value: string) => {\n    const numeric = value.replace(/[^0-9]/g, \"\");\n    const parsed = parseInt(numeric, 10);\n    return Number.isFinite(parsed) && parsed > 0 ? parsed : 1;\n  };\n\n  const handleAddExistingService = (serviceId: string) => {\n    const service = serviceMap.get(serviceId);\n    if (!service) return;\n\n    const vatRate =\n      typeof service.vatRate === \"number\" && Number.isFinite(service.vatRate)\n        ? Number(service.vatRate)\n        : defaultVatRate;\n    const vatMode: PackageVatMode = service.priceIncludesVat\n      ? \"inclusive\"\n      : \"exclusive\";\n    const unit = service.unit ?? DEFAULT_SERVICE_UNIT;\n\n    const filteredExisting = existingItems.filter(\n      (item) => item.serviceId !== serviceId\n    );\n    const nextItems: PackageCreationLineItem[] = [\n      ...filteredExisting,\n      {\n        id: serviceId,\n        type: \"existing\",\n        serviceId,\n        name: service.name,\n        quantity: 1,\n        unitCost: service.unitCost,\n        unitPrice: service.unitPrice,\n        vendorName: service.vendor_name ?? null,\n        source: \"catalog\",\n        vatRate,\n        vatMode,\n        unit,\n      },\n      ...customItems,\n    ];\n\n    updateServices({\n      items: nextItems,\n      showQuickAdd: state.services.showQuickAdd,\n    });\n  };\n\n  const handleIncreaseExistingService = (serviceId: string) => {\n    const nextExisting = existingItems.map((item) => {\n      if (item.serviceId !== serviceId) return item;\n      const current = Math.max(1, item.quantity ?? 1);\n      return { ...item, quantity: current + 1 };\n    });\n\n    updateServices({\n      items: [...nextExisting, ...customItems],\n      showQuickAdd: state.services.showQuickAdd,\n    });\n  };\n\n  const handleDecreaseExistingService = (serviceId: string) => {\n    const nextExisting = existingItems.map((item) => {\n      if (item.serviceId !== serviceId) return item;\n      const current = Math.max(1, item.quantity ?? 1);\n      return { ...item, quantity: Math.max(1, current - 1) };\n    });\n\n    updateServices({\n      items: [...nextExisting, ...customItems],\n      showQuickAdd: state.services.showQuickAdd,\n    });\n  };\n\n  const handleSetExistingServiceQuantity = (\n    serviceId: string,\n    quantity: number\n  ) => {\n    const nextExisting = existingItems.map((item) => {\n      if (item.serviceId !== serviceId) return item;\n      return { ...item, quantity: Math.max(1, quantity) };\n    });\n\n    updateServices({\n      items: [...nextExisting, ...customItems],\n      showQuickAdd: state.services.showQuickAdd,\n    });\n  };\n\n  const handleRemoveExistingService = (serviceId: string) => {\n    const nextExisting = existingItems.filter(\n      (item) => item.serviceId !== serviceId\n    );\n    updateServices({\n      items: [...nextExisting, ...customItems],\n      showQuickAdd: state.services.showQuickAdd,\n    });\n  };\n\n  const inventoryLabels = useMemo(\n    () => ({\n      typeMeta: {\n        deliverable: {\n          title: tForms(\"services.types.deliverable\", {\n            defaultValue: t(\"steps.services.inventory.types.deliverable.title\", {\n              defaultValue: \"Deliverables\",\n            }),\n          }),\n          subtitle: tForms(\"services.types.deliverable_hint\", {\n            defaultValue: t(\n              \"steps.services.inventory.types.deliverable.subtitle\",\n              { defaultValue: \"Albums, prints and other client handoffs\" }\n            ),\n          }),\n          icon: PackageIcon,\n          iconBackgroundClassName: \"bg-emerald-50\",\n          iconClassName: \"text-emerald-600\",\n        },\n        coverage: {\n          title: tForms(\"services.types.coverage\", {\n            defaultValue: t(\"steps.services.inventory.types.coverage.title\", {\n              defaultValue: \"Crew services\",\n            }),\n          }),\n          subtitle: tForms(\"services.types.coverage_hint\", {\n            defaultValue: t(\n              \"steps.services.inventory.types.coverage.subtitle\",\n              {\n                defaultValue:\n                  \"People-based coverage like photographers or videographers\",\n              }\n            ),\n          }),\n          icon: Users,\n          iconBackgroundClassName: \"bg-emerald-50\",\n          iconClassName: \"text-emerald-600\",\n        },\n        unknown: {\n          title: t(\"steps.services.inventory.types.unknown.title\", {\n            defaultValue: \"Other services\",\n          }),\n          subtitle: t(\"steps.services.inventory.types.unknown.subtitle\", {\n            defaultValue: \"Items without a service type yet\",\n          }),\n          icon: Layers,\n          iconBackgroundClassName: \"bg-emerald-50\",\n          iconClassName: \"text-emerald-600\",\n        },\n      },\n      add: t(\"steps.services.inventory.add\", { defaultValue: \"Add\" }),\n      decrease: t(\"common:actions.decrease\", { defaultValue: \"Decrease\" }),\n      increase: t(\"common:actions.increase\", { defaultValue: \"Increase\" }),\n      remove: t(\"steps.services.list.remove\", { defaultValue: \"Remove\" }),\n      vendor: t(\"steps.services.list.vendor\", { defaultValue: \"Vendor\" }),\n      unitCost: t(\"steps.services.list.unitCost\", {\n        defaultValue: \"Unit cost\",\n      }),\n      unitPrice: t(\"steps.services.list.unitPrice\", {\n        defaultValue: \"Unit price\",\n      }),\n      uncategorized: t(\"steps.services.inventory.uncategorized\", {\n        defaultValue: \"Other\",\n      }),\n      inactive: t(\"steps.services.inventory.inactive\", {\n        defaultValue: \"Inactive\",\n      }),\n      empty: t(\"steps.services.inventory.empty\", {\n        defaultValue:\n          \"No services in your catalog yet. Create services to add them here.\",\n      }),\n      quantity: t(\"steps.services.list.quantity\", { defaultValue: \"Quantity\" }),\n      selectedTag: (selected: number, total: number) =>\n        t(\"steps.services.inventory.selectedTag\", {\n          selected,\n          total,\n        }),\n      quantityTag: (count: number) =>\n        t(\"steps.services.inventory.quantityTag\", {\n          count,\n        }),\n      retry: t(\"common:actions.retry\", { defaultValue: \"Retry\" }),\n    }),\n    [t, tForms]\n  );\n\n  const vatModeOptions = useMemo(\n    () => [\n      {\n        value: \"inclusive\" as PackageVatMode,\n        label: t(\"steps.services.vatControls.mode.inclusive\"),\n      },\n      {\n        value: \"exclusive\" as PackageVatMode,\n        label: t(\"steps.services.vatControls.mode.exclusive\"),\n      },\n    ],\n    [t]\n  );\n\n  const vatOverrideItems = useMemo<ServiceVatOverridesItem[]>(() => {\n    return state.services.items.map((item) => {\n      const service =\n        item.type === \"existing\" && item.serviceId ? serviceMap.get(item.serviceId) : null;\n      const vatRateValue =\n        typeof item.vatRate === \"number\" && Number.isFinite(item.vatRate)\n          ? String(item.vatRate)\n          : \"\";\n      const vatModeValue: PackageVatMode =\n        item.vatMode === \"inclusive\" || item.vatMode === \"exclusive\"\n          ? item.vatMode\n          : defaultVatMode;\n      const meta: ServiceVatOverridesMeta[] = [];\n      const vendorLabel = item.vendorName\n        ? t(\"steps.services.vatControls.vendorLabel\", { vendor: item.vendorName })\n        : service?.vendor_name\n        ? t(\"steps.services.vatControls.vendorLabel\", { vendor: service.vendor_name })\n        : null;\n      if (vendorLabel) {\n        meta.push({ label: vendorLabel });\n      }\n      const serviceTypeKey =\n        (service?.serviceType as ServiceInventoryType | undefined) ?? \"unknown\";\n      const serviceTypeLabel =\n        serviceTypeKey === \"unknown\"\n          ? t(\"steps.services.inventory.types.unknown.title\")\n          : tForms(`services.types.${serviceTypeKey}`, {\n              defaultValue: t(\n                `steps.services.inventory.types.${serviceTypeKey}.title`\n              ),\n            });\n      meta.push({\n        label: t(\"steps.services.vatControls.typeLabel\", { type: serviceTypeLabel }),\n      });\n      if (item.type === \"custom\") {\n        meta.push({\n          label: t(\"summaryView.services.customTag\"),\n          variant: \"badge\",\n        });\n      }\n      return {\n        id: item.id,\n        name: item.name,\n        vatRate: vatRateValue,\n        vatMode: vatModeValue,\n        meta,\n      };\n    });\n  }, [state.services.items, serviceMap, defaultVatMode, t, tForms]);\n\n  const getUnitLabel = useCallback(\n    (unit?: string | null) =>\n      t(`steps.services.units.short.${normalizeServiceUnit(unit)}`, {\n        defaultValue: t(\n          `steps.services.units.options.${normalizeServiceUnit(unit)}`\n        ),\n      }),\n    [t]\n  );\n\n  const totalSelected = existingItems.length + customItems.length;\n\n  const serviceTableLabels = useMemo(\n    () => ({\n      columns: {\n        name: t(\"steps.services.summary.table.name\", {\n          defaultValue: \"Service\",\n        }),\n        quantity: t(\"steps.services.summary.table.quantity\", {\n          defaultValue: \"Qty\",\n        }),\n        cost: t(\"steps.services.summary.table.cost\", { defaultValue: \"Cost\" }),\n        unitPrice: t(\"summaryView.services.columns.unitPrice\"),\n        lineTotal: t(\"summaryView.services.columns.lineTotal\"),\n      },\n      customTag: t(\"summaryView.services.customTag\"),\n      customVendorFallback: t(\"summaryView.services.customVendorFallback\"),\n    }),\n    [t]\n  );\n\n  const summaryTableRows = useMemo<ServicesTableRow[]>(() => {\n    return state.services.items.map((item) => {\n      const quantity = Math.max(1, item.quantity ?? 1);\n      const unitPriceValue =\n        typeof item.unitPrice === \"number\" && Number.isFinite(item.unitPrice)\n          ? item.unitPrice\n          : null;\n      const pricing = calculateLineItemPricing(item);\n      const service =\n        item.type === \"existing\" && item.serviceId\n          ? serviceMap.get(item.serviceId)\n          : null;\n\n      const vendorName =\n        service?.vendor_name ??\n        // @ts-expect-error legacy camelCase vendor\n        service?.vendorName ??\n        item.vendorName ??\n        null;\n      const displayName = item.name ?? service?.name ?? item.serviceId ?? \"â€”\";\n      const unitLabel = getUnitLabel(\n        item.unit ?? service?.unit ?? DEFAULT_SERVICE_UNIT\n      );\n\n      const lineCost =\n        typeof item.unitCost === \"number\" && Number.isFinite(item.unitCost)\n          ? Math.round(item.unitCost * quantity * 100) / 100\n          : service?.unitCost\n          ? Math.round(service.unitCost * quantity * 100) / 100\n          : null;\n\n      return {\n        id: item.id,\n        name: displayName,\n        vendor: vendorName,\n        quantity,\n        unitLabel,\n        lineCost,\n        unitPrice: unitPriceValue,\n        lineTotal: Math.round(pricing.gross * 100) / 100,\n        isCustom: item.type === \"custom\",\n      };\n    });\n  }, [serviceMap, state.services.items, t]);\n\n  const updateItem = (\n    itemId: string,\n    updates: Partial<PackageCreationLineItem>\n  ) => {\n    const nextItems = state.services.items.map((item) =>\n      item.id === itemId ? { ...item, ...updates } : item\n    );\n    updateServices({ items: nextItems });\n  };\n\n  const handleVatModeChange = (itemId: string, mode: PackageVatMode) => {\n    updateItem(itemId, { vatMode: mode });\n  };\n\n  const handleVatRateChange = (itemId: string, value: string) => {\n    const trimmed = value.trim();\n    if (!trimmed) {\n      updateItem(itemId, { vatRate: null });\n      return;\n    }\n\n    const numeric = Number(trimmed.replace(/,/g, \".\"));\n    if (Number.isNaN(numeric)) {\n      return;\n    }\n\n    const clamped = Math.min(99.99, Math.max(0, numeric));\n    updateItem(itemId, { vatRate: clamped });\n  };\n\n  const formatPercent = (value: number) =>\n    new Intl.NumberFormat(\"tr-TR\", {\n      minimumFractionDigits: Number.isInteger(value) ? 0 : 1,\n      maximumFractionDigits: 2,\n    }).format(value);\n\n  const vatBreakdown = useMemo(() => {\n    const buckets = new Map<number, number>();\n    state.services.items.forEach((item) => {\n      const pricing = calculateLineItemPricing(item);\n      if (!(pricing.vat > 0)) return;\n      const rate =\n        typeof item.vatRate === \"number\" && Number.isFinite(item.vatRate)\n          ? item.vatRate\n          : 0;\n      const current = buckets.get(rate) ?? 0;\n      buckets.set(rate, current + pricing.vat);\n    });\n\n    return Array.from(buckets.entries())\n      .sort((a, b) => b[0] - a[0])\n      .map(([rate, amount]) => ({ rate, amount }));\n  }, [state.services.items]);\n\n  const removeItem = (itemId: string) => {\n    updateServices({\n      items: state.services.items.filter((item) => item.id !== itemId),\n    });\n    setCustomVatPanels((previous) => {\n      if (!previous[itemId]) {\n        return previous;\n      }\n      const next = { ...previous };\n      delete next[itemId];\n      return next;\n    });\n    if (pendingCustomVatResetId === itemId) {\n      setPendingCustomVatResetId(null);\n    }\n  };\n\n  const handleQuantityChange = (itemId: string, value: string) => {\n    updateItem(itemId, { quantity: parseQuantityInput(value) });\n  };\n\n  const adjustQuantity = (itemId: string, delta: number) => {\n    const target = state.services.items.find((item) => item.id === itemId);\n    const next = Math.max(1, (target?.quantity ?? 1) + delta);\n    updateItem(itemId, { quantity: next });\n  };\n\n  const customFormState: CustomServiceFormState = {\n    name: customName,\n    cost: customCost,\n    price: customPrice,\n    vatRate: customVatRate,\n    vatMode: customVatMode,\n    vatFormOpen: showQuickAddVatForm,\n  };\n\n  const handleCustomFormChange = (updates: Partial<CustomServiceFormState>) => {\n    if (updates.name !== undefined) setCustomName(updates.name);\n    if (updates.cost !== undefined) setCustomCost(updates.cost);\n    if (updates.price !== undefined) setCustomPrice(updates.price);\n    if (updates.vatRate !== undefined) setCustomVatRate(updates.vatRate);\n    if (updates.vatMode !== undefined) setCustomVatMode(updates.vatMode);\n  };\n\n  const customServiceItems = useMemo<CustomServiceItemView[]>(\n    () =>\n      customItems.map((item) => ({\n        id: item.id,\n        name: item.name,\n        quantity: Math.max(1, item.quantity ?? 1),\n        unitCost: item.unitCost ?? null,\n        unitPrice: item.unitPrice ?? null,\n        unitLabel: getUnitLabel(item.unit ?? DEFAULT_SERVICE_UNIT),\n        vatRate:\n          typeof item.vatRate === \"number\" && Number.isFinite(item.vatRate)\n            ? item.vatRate\n            : null,\n        vatMode:\n          item.vatMode === \"inclusive\" || item.vatMode === \"exclusive\"\n            ? item.vatMode\n            : defaultVatMode,\n        vatEditorOpen: Boolean(customVatPanels[item.id]),\n      })),\n    [customItems, customVatPanels, getUnitLabel, defaultVatMode]\n  );\n\n  const customServicesStrings = useMemo(() => {\n    const vatModeLabel = t(`steps.services.vatControls.mode.${defaultVatMode}`);\n    const vatHelperText = t(\"steps.services.custom.vatHelper\", {\n      rate: formatPercent(defaultVatRate),\n      mode: vatModeLabel,\n    });\n    return {\n      nameLabel: t(\"steps.services.custom.nameLabel\"),\n      namePlaceholder: t(\"steps.services.custom.namePlaceholder\"),\n      costLabel: t(\"steps.services.custom.costLabel\"),\n      costPlaceholder: t(\"steps.services.custom.costPlaceholder\"),\n      priceLabel: t(\"steps.services.custom.priceLabel\"),\n      pricePlaceholder: t(\"steps.services.custom.pricePlaceholder\"),\n      listCostLabel: t(\"steps.services.list.unitCost\"),\n      listPriceLabel: t(\"steps.services.list.unitPrice\"),\n      addButton: t(\"steps.services.custom.add\"),\n      cancelButton: t(\"steps.services.custom.cancel\"),\n      vatToggleOpen: t(\"steps.services.custom.vatButtonOpen\"),\n      vatToggleClose: t(\"steps.services.custom.vatButtonClose\"),\n      vatRateLabel: t(\"steps.services.custom.vatRateLabel\"),\n      vatRatePlaceholder: t(\"steps.services.custom.vatRatePlaceholder\"),\n      vatModeLabel: t(\"steps.services.custom.vatModeLabel\"),\n      vatHelper: vatHelperText,\n      vatHelperPerItem: vatHelperText,\n      quantityLabel: t(\"steps.services.list.quantity\"),\n      decreaseAriaLabel: t(\"common:actions.decrease\", {\n        defaultValue: \"Decrease\",\n      }),\n      increaseAriaLabel: t(\"common:actions.increase\", {\n        defaultValue: \"Increase\",\n      }),\n      removeAriaLabel: t(\"steps.services.list.remove\"),\n      customBadgeLabel: t(\"summaryView.services.customTag\"),\n      emptyState: t(\"steps.services.custom.emptyState\", {\n        defaultValue: \"No custom services yet.\",\n      }),\n    };\n  }, [t, defaultVatRate, defaultVatMode]);\n\n  const handleToggleVatControls = () => {\n    if (showVatControls) {\n      if (hasVatOverrides) {\n        setShowVatResetPrompt(true);\n        return;\n      }\n      setShowVatControls(false);\n      return;\n    }\n    setShowVatControls(true);\n  };\n\n  const hasQuickAddVatOverrides = useCallback(() => {\n    const trimmed = customVatRate.trim();\n    const numeric = trimmed\n      ? Number(trimmed.replace(/,/g, \".\"))\n      : defaultVatRate;\n    const normalized = Number.isFinite(numeric)\n      ? Math.min(99.99, Math.max(0, numeric))\n      : defaultVatRate;\n    const rateDiff = Math.abs(normalized - defaultVatRate) > 0.0001;\n    const modeDiff = customVatMode !== defaultVatMode;\n    return rateDiff || modeDiff;\n  }, [customVatRate, customVatMode, defaultVatMode, defaultVatRate]);\n\n  const handleQuickAddVatToggle = () => {\n    if (!showQuickAddVatForm) {\n      setShowQuickAddVatForm(true);\n      return;\n    }\n    if (hasQuickAddVatOverrides()) {\n      setShowQuickAddVatResetPrompt(true);\n      return;\n    }\n    setCustomVatRate(defaultVatRateString);\n    setCustomVatMode(defaultVatMode);\n    setShowQuickAddVatForm(false);\n    setShowQuickAddVatResetPrompt(false);\n  };\n\n  const handleConfirmQuickAddVatReset = () => {\n    setCustomVatRate(defaultVatRateString);\n    setCustomVatMode(defaultVatMode);\n    setShowQuickAddVatForm(false);\n    setShowQuickAddVatResetPrompt(false);\n  };\n\n  const customItemHasVatOverrides = useCallback(\n    (item: PackageCreationLineItem) => {\n      const rate =\n        typeof item.vatRate === \"number\" && Number.isFinite(item.vatRate)\n          ? item.vatRate\n          : defaultVatRate;\n      const mode = item.vatMode ?? defaultVatMode;\n      const rateDiff = Math.abs(rate - defaultVatRate) > 0.0001;\n      const modeDiff = mode !== defaultVatMode;\n      return rateDiff || modeDiff;\n    },\n    [defaultVatMode, defaultVatRate]\n  );\n\n  const handleCustomVatToggle = (itemId: string) => {\n    const item = state.services.items.find((serviceItem) => serviceItem.id === itemId);\n    if (!item) return;\n    const isOpen = Boolean(customVatPanels[itemId]);\n    if (isOpen) {\n      if (customItemHasVatOverrides(item)) {\n        setPendingCustomVatResetId(itemId);\n        return;\n      }\n      setCustomVatPanels((previous) => {\n        const next = { ...previous };\n        delete next[itemId];\n        return next;\n      });\n      return;\n    }\n    setCustomVatPanels((previous) => ({ ...previous, [itemId]: true }));\n  };\n\n  const handleConfirmCustomVatReset = () => {\n    if (!pendingCustomVatResetId) return;\n    updateItem(pendingCustomVatResetId, {\n      vatRate: defaultVatRate,\n      vatMode: defaultVatMode,\n    });\n    setCustomVatPanels((previous) => {\n      const next = { ...previous };\n      delete next[pendingCustomVatResetId];\n      return next;\n    });\n    setPendingCustomVatResetId(null);\n  };\n\n  const resetVatOverrides = useCallback(() => {\n    const resetItems = state.services.items.map((item) => {\n      const service =\n        item.type === \"existing\" && item.serviceId\n          ? serviceMap.get(item.serviceId)\n          : null;\n      const fallbackRate =\n        typeof service?.vatRate === \"number\" && Number.isFinite(service.vatRate)\n          ? service.vatRate\n          : defaultVatRate;\n      const fallbackMode: PackageVatMode = service?.vatMode ?? defaultVatMode;\n\n      return {\n        ...item,\n        vatRate: fallbackRate,\n        vatMode: fallbackMode,\n      };\n    });\n\n    updateServices({ items: resetItems });\n    setShowVatControls(false);\n    setShowVatResetPrompt(false);\n  }, [\n    state.services.items,\n    serviceMap,\n    defaultVatRate,\n    defaultVatMode,\n    updateServices,\n  ]);\n\n  const toggleQuickAdd = () => {\n    const nextOpen = !state.services.showQuickAdd;\n    updateServices({ showQuickAdd: nextOpen });\n    setCustomError(null);\n    setCustomName(\"\");\n    setCustomCost(\"\");\n    setCustomPrice(\"\");\n    setCustomVatRate(defaultVatRateString);\n    setCustomVatMode(defaultVatMode);\n    setShowQuickAddVatForm(false);\n    setShowQuickAddVatResetPrompt(false);\n    setPendingCustomVatResetId(null);\n  };\n\n  const handleAddCustomService = () => {\n    setCustomError(null);\n    const trimmedName = customName.trim();\n    const parsedPrice = Number(customPrice);\n    const parsedCost = customCost.trim() === \"\" ? 0 : Number(customCost);\n    const trimmedVat = customVatRate.trim();\n\n    if (!trimmedName) {\n      setCustomError(\n        t(\"steps.services.custom.errors.name\", {\n          defaultValue: \"Name is required.\",\n        })\n      );\n      return;\n    }\n\n    if (!Number.isFinite(parsedPrice) || parsedPrice <= 0) {\n      setCustomError(\n        t(\"steps.services.custom.errors.price\", {\n          defaultValue: \"Enter a valid price.\",\n        })\n      );\n      return;\n    }\n\n    if (\n      customCost.trim() !== \"\" &&\n      (!Number.isFinite(parsedCost) || parsedCost < 0)\n    ) {\n      setCustomError(\n        t(\"steps.services.custom.errors.cost\", {\n          defaultValue: \"Enter a valid cost.\",\n        })\n      );\n      return;\n    }\n\n    let parsedVatRate = defaultVatRate;\n    if (trimmedVat) {\n      const numericVat = Number(trimmedVat.replace(/,/g, \".\"));\n      if (Number.isNaN(numericVat)) {\n        setCustomError(\n          t(\"steps.services.custom.errors.vat\", {\n            defaultValue: \"Enter a valid VAT rate.\",\n          })\n        );\n        return;\n      }\n      parsedVatRate = Math.min(99.99, Math.max(0, numericVat));\n    }\n\n    const newItem: PackageCreationLineItem = {\n      id: `custom-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,\n      type: \"custom\",\n      name: trimmedName,\n      quantity: 1,\n      unitCost: Number.isFinite(parsedCost) ? parsedCost : 0,\n      unitPrice: parsedPrice,\n      vendorName: null,\n      source: \"adhoc\",\n      vatRate: parsedVatRate,\n      vatMode: customVatMode,\n      unit: DEFAULT_SERVICE_UNIT,\n    };\n\n    updateServices({\n      items: [...state.services.items, newItem],\n      showQuickAdd: true,\n    });\n\n    setCustomName(\"\");\n    setCustomCost(\"\");\n    setCustomPrice(\"\");\n    setCustomVatRate(defaultVatRateString);\n    setCustomVatMode(defaultVatMode);\n    setShowQuickAddVatForm(false);\n    setShowQuickAddVatResetPrompt(false);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"space-y-2\">\n        <h2 className=\"text-xl font-semibold tracking-tight text-slate-900\">\n          {t(\"steps.services.title\")}\n        </h2>\n        <p className=\"text-sm text-muted-foreground\">\n          {t(\"steps.services.description\")}\n        </p>\n      </div>\n\n      <ServiceInventorySelector\n        services={inventoryServices}\n        selected={selectedQuantities}\n        labels={inventoryLabels}\n        onAdd={handleAddExistingService}\n        onIncrease={handleIncreaseExistingService}\n        onDecrease={handleDecreaseExistingService}\n        onSetQuantity={handleSetExistingServiceQuantity}\n        onRemove={handleRemoveExistingService}\n        isLoading={servicesQuery.isLoading}\n        error={servicesQuery.error ? t(\"steps.services.picker.error\") : null}\n        onRetry={\n          servicesQuery.error ? () => servicesQuery.refetch() : undefined\n        }\n      />\n      {state.services.items.length > 0 ? (\n        <ServiceVatOverridesSection\n          title={t(\"steps.services.vatControls.title\")}\n          description={t(\"steps.services.vatControls.description\")}\n          tooltipLabel={t(\"steps.services.vatControls.toggleLabel\")}\n          tooltipContent={t(\"steps.services.vatControls.toggleDescription\")}\n          toggleButtonLabel={\n            showVatControls\n              ? t(\"steps.services.vatControls.buttonClose\")\n              : t(\"steps.services.vatControls.buttonOpen\")\n          }\n          isOpen={showVatControls}\n          onToggle={handleToggleVatControls}\n          items={vatOverrideItems}\n          rateLabel={t(\"steps.services.vatControls.rateLabel\")}\n          modeLabel={t(\"steps.services.vatControls.modeLabel\")}\n          modeOptions={vatModeOptions}\n          onRateChange={handleVatRateChange}\n          onModeChange={handleVatModeChange}\n        />\n      ) : null}\n\n      <CustomServicesSection\n        title={t(\"steps.services.custom.managerTitle\")}\n        description={t(\"steps.services.custom.managerDescription\")}\n        tooltipLabel={t(\"steps.services.custom.managerTitle\")}\n        tooltipContent={t(\"steps.services.custom.catalogTooltip\")}\n        toggleButtonLabels={{\n          open: t(\"steps.services.custom.buttonOpen\"),\n          close: t(\"steps.services.custom.buttonClose\"),\n        }}\n        open={state.services.showQuickAdd}\n        onToggle={toggleQuickAdd}\n        form={customFormState}\n        onFormChange={handleCustomFormChange}\n        onSubmit={handleAddCustomService}\n        onCancel={toggleQuickAdd}\n        error={customError}\n        strings={customServicesStrings}\n        vatModeOptions={vatModeOptions}\n        onQuickAddVatToggle={handleQuickAddVatToggle}\n        items={customServiceItems}\n        onItemNameChange={(itemId, value) => updateItem(itemId, { name: value })}\n        onItemCostChange={(itemId, value) =>\n          updateItem(itemId, { unitCost: value === \"\" ? null : Number(value) })\n        }\n        onItemPriceChange={(itemId, value) =>\n          updateItem(itemId, { unitPrice: value === \"\" ? null : Number(value) })\n        }\n        onItemQuantityChange={handleQuantityChange}\n        onItemAdjustQuantity={adjustQuantity}\n        onItemRemove={removeItem}\n        onItemVatToggle={handleCustomVatToggle}\n        onItemVatRateChange={handleVatRateChange}\n        onItemVatModeChange={handleVatModeChange}\n      />\n\n      <div className=\"space-y-3\">\n        <p className=\"text-xs font-medium uppercase tracking-wide text-muted-foreground\">\n          {t(\"steps.services.summary.listHeading\", {\n            defaultValue: \"Selected services\",\n          })}\n        </p>\n        <ServicesTableCard\n          rows={summaryTableRows}\n          totals={undefined}\n          labels={serviceTableLabels}\n          emptyMessage={t(\"steps.services.summary.empty\")}\n          formatCurrency={formatCurrency}\n          className=\"bg-white/80 backdrop-blur\"\n        />\n        {summaryTableRows.length ? (\n          <div className=\"flex justify-end\">\n            <SummaryTotalsCard className=\"sm:w-auto sm:min-w-[320px]\">\n              <SummaryTotalRow\n                label={t(\"steps.services.summary.countLabel\")}\n                value={totalSelected}\n              />\n              <SummaryTotalsSection>\n                <SummaryTotalRow\n                  label={t(\"steps.services.summary.cost\")}\n                  value={formatCurrency(totals.cost)}\n                />\n                <SummaryTotalRow\n                  label={t(\"steps.services.summary.price\")}\n                  value={formatCurrency(totals.price)}\n                />\n              </SummaryTotalsSection>\n              {vatBreakdown.length ? (\n                <SummaryTotalsSection className=\"space-y-1\">\n                  {vatBreakdown.map((entry) => (\n                    <SummaryTotalRow\n                      key={entry.rate}\n                      label={t(\"steps.services.summary.vatBreakdownItem\", {\n                        rate: formatPercent(entry.rate),\n                      })}\n                      value={formatCurrency(entry.amount)}\n                    />\n                  ))}\n                </SummaryTotalsSection>\n              ) : null}\n              {vatBreakdown.length !== 1 ? (\n                <SummaryTotalsSection>\n                  <SummaryTotalRow\n                    label={\n                      vatBreakdown.length > 1\n                        ? t(\"steps.services.summary.vatTotal\", {\n                            defaultValue: \"Total VAT\",\n                          })\n                        : t(\"steps.services.summary.vat\", {\n                            defaultValue: \"VAT\",\n                          })\n                    }\n                    value={formatCurrency(totals.vat)}\n                  />\n                </SummaryTotalsSection>\n              ) : null}\n              <SummaryTotalsDivider />\n              <SummaryTotalsSection className=\"pt-3\">\n                <SummaryTotalRow\n                  label={t(\"steps.services.summary.gross\", {\n                    defaultValue: \"Total\",\n                  })}\n                  value={formatCurrency(totals.total)}\n                  emphasizeLabel\n                />\n                <SummaryTotalRow\n                  label={t(\"steps.services.summary.margin\")}\n                  value={formatCurrency(margin)}\n                  tone={margin >= 0 ? \"positive\" : \"negative\"}\n                  emphasizeLabel\n                />\n              </SummaryTotalsSection>\n            </SummaryTotalsCard>\n          </div>\n        ) : null}\n      </div>\n\n      <AlertDialog\n        open={showVatResetPrompt}\n        onOpenChange={setShowVatResetPrompt}\n      >\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>\n              {t(\"steps.services.vatControls.resetConfirmTitle\")}\n            </AlertDialogTitle>\n            <AlertDialogDescription>\n              {t(\"steps.services.vatControls.resetConfirmDescription\")}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel\n              onClick={() => {\n                setShowVatResetPrompt(false);\n              }}\n            >\n              {t(\"steps.services.vatControls.resetConfirmCancel\")}\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={resetVatOverrides}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {t(\"steps.services.vatControls.resetConfirmConfirm\")}\n            </AlertDialogAction>\n      </AlertDialogFooter>\n    </AlertDialogContent>\n  </AlertDialog>\n\n      <AlertDialog\n        open={showQuickAddVatResetPrompt}\n        onOpenChange={setShowQuickAddVatResetPrompt}\n      >\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>\n              {t(\"steps.services.vatControls.resetConfirmTitle\")}\n            </AlertDialogTitle>\n            <AlertDialogDescription>\n              {t(\"steps.services.vatControls.resetConfirmDescription\")}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel\n              onClick={() => setShowQuickAddVatResetPrompt(false)}\n            >\n              {t(\"steps.services.vatControls.resetConfirmCancel\")}\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleConfirmQuickAddVatReset}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {t(\"steps.services.vatControls.resetConfirmConfirm\")}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      <AlertDialog\n        open={pendingCustomVatResetId !== null}\n        onOpenChange={(open) => {\n          if (!open) {\n            setPendingCustomVatResetId(null);\n          }\n        }}\n      >\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>\n              {t(\"steps.services.vatControls.resetConfirmTitle\")}\n            </AlertDialogTitle>\n            <AlertDialogDescription>\n              {t(\"steps.services.vatControls.resetConfirmDescription\")}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel onClick={() => setPendingCustomVatResetId(null)}>\n              {t(\"steps.services.vatControls.resetConfirmCancel\")}\n            </AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleConfirmCustomVatReset}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {t(\"steps.services.vatControls.resetConfirmConfirm\")}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/steps/SummaryStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/steps/__tests__/PricingStep.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1141,1144],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1141,1144],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2089,2092],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2089,2092],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2307,2310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2307,2310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2388,2391],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2388,2391],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { ReactNode, useReducer } from \"react\";\nimport { fireEvent, render, screen } from \"@/utils/testUtils\";\nimport { PricingStep } from \"../PricingStep\";\nimport {\n  createInitialPackageCreationState,\n  packageCreationReducer,\n} from \"../../state/packageCreationReducer\";\nimport { PackageCreationContext } from \"../../context/PackageCreationProvider\";\nimport type { PackageCreationState } from \"../../types\";\nimport en from \"@/i18n/resources/en/packageCreation.json\";\nimport { useTranslation } from \"react-i18next\";\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: jest.fn(),\n}));\n\njest.mock(\"@/hooks/useOrganizationData\", () => {\n  const actual = jest.requireActual(\"@/hooks/useOrganizationData\");\n  return {\n    ...actual,\n    useOrganizationTaxProfile: jest.fn(() => ({\n      data: {\n        defaultVatRate: 18,\n        defaultVatMode: \"inclusive\",\n      },\n      isLoading: false,\n      error: null,\n    })),\n  };\n});\n\ntype DeepPartial<T> = {\n  [P in keyof T]?: T[P] extends object ? DeepPartial<T[P]> : T[P];\n};\n\nconst getTranslation = (key: string): string | undefined => {\n  const parts = key.split(\".\");\n  let current: any = en;\n  for (const part of parts) {\n    if (current && typeof current === \"object\" && part in current) {\n      current = current[part];\n    } else {\n      return undefined;\n    }\n  }\n  return typeof current === \"string\" ? current : undefined;\n};\n\nconst applyInterpolation = (\n  template: string,\n  options?: Record<string, unknown>\n): string => {\n  if (!options) return template;\n  return template.replace(/\\{\\{\\s*(\\w+)\\s*\\}\\}/g, (match, key) => {\n    const replacement = options[key];\n    return replacement !== undefined ? String(replacement) : match;\n  });\n};\n\nconst mergeState = <T extends object>(target: T, source?: DeepPartial<T>): T => {\n  if (!source) return target;\n  const output = Array.isArray(target)\n    ? ([...target] as unknown as T)\n    : ({ ...target } as T);\n\n  Object.entries(source).forEach(([key, value]) => {\n    if (value === undefined) return;\n    const typedKey = key as keyof T;\n    const originalValue = (output as any)[typedKey];\n    if (\n      originalValue &&\n      typeof originalValue === \"object\" &&\n      !Array.isArray(originalValue) &&\n      typeof value === \"object\" &&\n      !Array.isArray(value)\n    ) {\n      (output as any)[typedKey] = mergeState(originalValue, value);\n    } else {\n      (output as any)[typedKey] = value;\n    }\n  });\n\n  return output;\n};\n\ninterface ProviderProps {\n  initial: PackageCreationState;\n  children: ReactNode;\n}\n\nconst TestProvider = ({ initial, children }: ProviderProps) => {\n  const [state, dispatch] = useReducer(packageCreationReducer, initial);\n  return (\n    <PackageCreationContext.Provider value={{ state, dispatch }}>\n      {children}\n    </PackageCreationContext.Provider>\n  );\n};\n\nconst renderWithState = (overrides?: DeepPartial<PackageCreationState>) => {\n  const base = createInitialPackageCreationState();\n  const withServices = mergeState(base, overrides);\n  return render(<PricingStep />, {\n    wrapper: ({ children }) => (\n      <TestProvider initial={withServices}>{children}</TestProvider>\n    ),\n  });\n};\n\ndescribe(\"PricingStep\", () => {\n  beforeEach(() => {\n    (useTranslation as jest.Mock).mockReturnValue({\n      t: (\n        key: string,\n        options?: { defaultValue?: string } & Record<string, unknown>\n      ) =>\n        applyInterpolation(\n          getTranslation(key) ?? options?.defaultValue ?? key,\n          options\n        ),\n    });\n  });\n\n  it(\"renders default package VAT summary and stats\", () => {\n    const overrides: DeepPartial<PackageCreationState> = {\n      services: {\n        items: [\n          {\n            id: \"line-1\",\n            type: \"existing\",\n            name: \"Drone\",\n            serviceId: \"svc-1\",\n            quantity: 1,\n            unitCost: 250,\n            unitPrice: 750,\n          },\n        ],\n      },\n      pricing: {\n        basePrice: \"18000\",\n        includeAddOnsInPrice: true,\n      },\n    };\n\n    renderWithState(overrides);\n\n    expect(screen.getByLabelText(\"Package price (TRY)\")).toHaveValue(18000);\n    expect(\n      screen.getByText(\n        \"This amount applies VAT %18 with Included in price handling.\"\n      )\n    ).toBeInTheDocument();\n    expect(screen.getByText(\"Package (incl. VAT)\")).toBeInTheDocument();\n  });\n\n  it(\"switches to add-on mode and updates helper text\", () => {\n    const overrides: DeepPartial<PackageCreationState> = {\n      services: {\n        items: [\n          {\n            id: \"line-1\",\n            type: \"existing\",\n            name: \"Second Shooter\",\n            serviceId: \"svc-1\",\n            quantity: 1,\n            unitCost: 400,\n            unitPrice: 1200,\n          },\n        ],\n      },\n      pricing: {\n        basePrice: \"15000\",\n        includeAddOnsInPrice: true,\n      },\n    };\n\n    renderWithState(overrides);\n\n    fireEvent.click(screen.getByText(\"Bill add-ons on top of the package\"));\n\n    expect(\n      screen.getByText(/This combines the package price with selected services\\./)\n    ).toBeInTheDocument();\n  });\n\n  it(\"enables deposit configuration when toggled on\", () => {\n    const overrides: DeepPartial<PackageCreationState> = {\n      services: {\n        items: [\n          {\n            id: \"line-1\",\n            type: \"existing\",\n            name: \"Album\",\n            serviceId: \"svc-1\",\n            quantity: 1,\n            unitCost: 300,\n            unitPrice: 900,\n          },\n        ],\n      },\n      pricing: {\n        basePrice: \"12000\",\n        includeAddOnsInPrice: false,\n        enableDeposit: false,\n      },\n    };\n\n    renderWithState(overrides);\n\n    const switchControl = screen.getByRole(\"switch\", { name: \"Deposit\" });\n    fireEvent.click(switchControl);\n\n    expect(\n      screen.getByRole(\"button\", { name: \"Percentage\" })\n    ).toBeInTheDocument();\n    expect(\n      screen.getByRole(\"button\", { name: \"Fixed amount\" })\n    ).toBeInTheDocument();\n  });\n\n  it(\"allows overriding package VAT values\", () => {\n    renderWithState({\n      pricing: {\n        basePrice: \"15000\",\n        includeAddOnsInPrice: true,\n      },\n    });\n\n    const toggle = screen.getByRole(\"button\", { name: \"I want to modify VAT\" });\n    fireEvent.click(toggle);\n\n    const rateInput = screen.getByLabelText(\"VAT rate (%)\");\n    fireEvent.change(rateInput, { target: { value: \"10\" } });\n\n    expect(rateInput).toHaveValue(10);\n    expect(\n      screen.getByText(\n        \"This amount applies VAT %10 with Included in price handling.\"\n      )\n    ).toBeInTheDocument();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/steps/__tests__/SummaryStep.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[835,838],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[835,838],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { render, screen } from \"@/utils/testUtils\";\nimport { SummaryStep } from \"../SummaryStep\";\nimport type { PackageSnapshot } from \"../../services/packageCreationSnapshot\";\nimport en from \"@/i18n/resources/en/packageCreation.json\";\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: jest.fn(),\n}));\n\njest.mock(\"../../hooks/usePackageCreationSnapshot\", () => ({\n  usePackageCreationSnapshot: jest.fn(),\n}));\n\njest.mock(\"@/hooks/useOrganizationData\", () => ({\n  useProjectTypes: jest.fn(),\n}));\n\nimport { useTranslation } from \"react-i18next\";\nimport { usePackageCreationSnapshot } from \"../../hooks/usePackageCreationSnapshot\";\nimport { useProjectTypes } from \"@/hooks/useOrganizationData\";\n\nconst getTranslation = (key: string): string | undefined => {\n  const parts = key.split(\".\");\n  let current: any = en;\n  for (const part of parts) {\n    if (current && typeof current === \"object\" && part in current) {\n      current = current[part];\n    } else {\n      return undefined;\n    }\n  }\n  return typeof current === \"string\" ? current : undefined;\n};\n\nconst applyInterpolation = (\n  template: string,\n  options?: Record<string, unknown>\n): string => {\n  if (!options) return template;\n  return template.replace(/\\{\\{\\s*(\\w+)\\s*\\}\\}/g, (match, key) => {\n    const replacement = options[key];\n    return replacement !== undefined ? String(replacement) : match;\n  });\n};\n\nconst baseSnapshot = (): PackageSnapshot => ({\n  basics: {\n    name: \"Sunset Deluxe\",\n    description: \"Tam gÃ¼n Ã§ekim ve albÃ¼m\",\n    applicableTypeIds: [\"type-1\"],\n    isActive: true,\n  },\n  services: {\n    items: [\n      {\n        id: \"item-1\",\n        type: \"existing\",\n        role: \"addon\",\n        serviceId: \"svc-1\",\n        name: \"Drone Ã§ekimi\",\n        quantity: 1,\n        unitCost: 250,\n        unitPrice: 750,\n        vendorName: \"Freelancer\",\n        vatRate: 0,\n        vatMode: \"exclusive\",\n      },\n    ],\n    totals: {\n      cost: 250,\n      price: 750,\n      vat: 0,\n      total: 750,\n    },\n    defaultAddOnIds: [\"svc-1\"],\n    itemCount: 1,\n    totalQuantity: 1,\n  },\n  delivery: {\n    photosEnabled: true,\n    leadTimeEnabled: true,\n    methodsEnabled: true,\n    estimateType: \"range\",\n    photoCountMin: 250,\n    photoCountMax: 400,\n    leadTimeValue: 6,\n    leadTimeUnit: \"weeks\",\n    methods: [\n      {\n        methodId: \"online-gallery\",\n        name: \"Online gallery\",\n      },\n    ],\n  },\n  pricing: {\n    basePrice: 18000,\n    servicesCostTotal: 250,\n    servicesPriceTotal: 750,\n    servicesVatTotal: 0,\n    servicesGrossTotal: 750,\n    servicesMargin: 500,\n    subtotal: 18750,\n    clientTotal: 18000,\n    includeAddOnsInPrice: true,\n    depositMode: \"percent_subtotal\",\n    depositValue: 25,\n    depositTarget: \"subtotal\",\n    depositAmount: 4500,\n    enableDeposit: true,\n  },\n  meta: {\n    selectedServiceCount: 1,\n    totalSelectedQuantity: 1,\n  },\n});\n\ndescribe(\"SummaryStep\", () => {\n  beforeEach(() => {\n    (useTranslation as jest.Mock).mockReturnValue({\n      t: (\n        key: string,\n        options?: { defaultValue?: string } & Record<string, unknown>\n      ) => applyInterpolation(getTranslation(key) ?? options?.defaultValue ?? key, options),\n    });\n    (useProjectTypes as jest.Mock).mockReturnValue({\n      data: [{ id: \"type-1\", name: \"Wedding\" }],\n    });\n  });\n\n  it(\"renders inclusive client total and deposit summary\", () => {\n    (usePackageCreationSnapshot as jest.Mock).mockReturnValue({\n      snapshot: baseSnapshot(),\n    });\n\n    render(<SummaryStep />);\n\n    expect(screen.getByText(\"Sunset Deluxe\")).toBeInTheDocument();\n    expect(screen.getByText(\"Wedding\")).toBeInTheDocument();\n    const clientTotalRow = screen\n      .getByText(\"Client total\")\n      .parentElement?.parentElement as HTMLElement;\n    expect(clientTotalRow.textContent).toContain(\"â‚º18.000\");\n    expect(clientTotalRow.textContent).toContain(\n      \"Client total = package price + selected services.\"\n    );\n    const depositRow = screen\n      .getByText(\"Deposit\")\n      .parentElement?.parentElement as HTMLElement;\n    expect(depositRow.textContent).toContain(\"â‚º4.500\");\n    expect(depositRow.textContent).toContain(\n      \"25% of package + services total\"\n    );\n  });\n\n  it(\"renders add-on mode summary with deposit disabled helper\", () => {\n    const snapshot = baseSnapshot();\n    snapshot.pricing.includeAddOnsInPrice = false;\n    snapshot.pricing.clientTotal = 18750;\n    snapshot.pricing.enableDeposit = false;\n    snapshot.pricing.depositAmount = 0;\n    snapshot.pricing.depositValue = 0;\n\n    (usePackageCreationSnapshot as jest.Mock).mockReturnValue({\n      snapshot,\n    });\n\n    render(<SummaryStep />);\n\n    const clientTotalRow = screen\n      .getByText(\"Client total\")\n      .parentElement?.parentElement as HTMLElement;\n    expect(clientTotalRow.textContent).toContain(\n      \"Package price already includes selected services.\"\n    );\n    expect(clientTotalRow.textContent).toMatch(/â‚º\\s?18\\.750/);\n    const depositRow = screen\n      .getByText(\"Deposit\")\n      .parentElement?.parentElement as HTMLElement;\n    expect(depositRow.textContent).toContain(\"No deposit collected\");\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/steps/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/package-creation/utils/lineItemPricing.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/project-creation/components/ProjectCreationWizard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/project-creation/components/ProjectCreationWizardSheet.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":284,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":284,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8752,8755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8752,8755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'navigate'. Either include it or remove the dependency array.","line":301,"column":6,"nodeType":"ArrayExpression","endLine":322,"endColumn":4,"suggestions":[{"desc":"Update the dependencies array to be: [completeCurrentStep, currentStep, forceClose, navigate, onProjectCreated, shouldLockNavigation, state.details.basePrice, state.details.description, state.details.name, state.details.projectTypeId, state.details.statusId, state.lead.id, state.meta.defaultStatusId, state.meta.entrySource, state.services.items, state.services.packageId, tCommon, tForms, tProject, toast, validateBeforeSubmit]","fix":{"range":[9195,9662],"text":"[completeCurrentStep, currentStep, forceClose, navigate, onProjectCreated, shouldLockNavigation, state.details.basePrice, state.details.description, state.details.name, state.details.projectTypeId, state.details.statusId, state.lead.id, state.meta.defaultStatusId, state.meta.entrySource, state.services.items, state.services.packageId, tCommon, tForms, tProject, toast, validateBeforeSubmit]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { AppSheetModal } from \"@/components/ui/app-sheet-modal\";\nimport { ProjectCreationProvider } from \"../context/ProjectCreationProvider\";\nimport { ProjectCreationWizard } from \"./ProjectCreationWizard\";\nimport { useProjectCreationActions } from \"../hooks/useProjectCreationActions\";\nimport { useProjectCreationContext } from \"../hooks/useProjectCreationContext\";\nimport { ProjectCreationStepId } from \"../types\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\nimport { useToast } from \"@/components/ui/use-toast\";\nimport { useTranslation } from \"react-i18next\";\nimport { trackEvent } from \"@/lib/telemetry\";\nimport { useOnboarding } from \"@/contexts/OnboardingContext\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useNavigate } from \"react-router-dom\";\n\ninterface ProjectCreationWizardSheetProps {\n  isOpen: boolean;\n  onOpenChange: (open: boolean) => void;\n  leadId?: string;\n  leadName?: string;\n  entrySource?: string;\n  defaultStatusId?: string | null;\n  startStepOverride?: ProjectCreationStepId;\n  onProjectCreated?: (project?: { id: string; name?: string }) => void;\n}\n\nexport const ProjectCreationWizardSheet = ({\n  isOpen,\n  onOpenChange,\n  leadId,\n  leadName,\n  entrySource,\n  defaultStatusId,\n  startStepOverride,\n  onProjectCreated,\n}: ProjectCreationWizardSheetProps) => {\n  const entryContext = useMemo(\n    () => ({\n      leadId,\n      leadName,\n      entrySource,\n      defaultStatusId: defaultStatusId ?? undefined,\n      startStepOverride,\n    }),\n    [leadId, leadName, entrySource, defaultStatusId, startStepOverride]\n  );\n\n  const providerKey = useMemo(\n    () => JSON.stringify(entryContext),\n    [entryContext]\n  );\n\n  return (\n    <ProjectCreationProvider key={providerKey} entryContext={entryContext}>\n      <ProjectCreationWizardSheetInner\n        isOpen={isOpen}\n        onOpenChange={onOpenChange}\n        onProjectCreated={onProjectCreated}\n      />\n    </ProjectCreationProvider>\n  );\n};\n\nconst ProjectCreationWizardSheetInner = ({\n  isOpen,\n  onOpenChange,\n  onProjectCreated,\n}: Pick<ProjectCreationWizardSheetProps, \"isOpen\" | \"onOpenChange\" | \"onProjectCreated\">) => {\n  const { state } = useProjectCreationContext();\n  const { reset } = useProjectCreationActions();\n  const [isCreating, setIsCreating] = useState(false);\n  const { toast } = useToast();\n  const { t: tProject } = useTranslation(\"projectCreation\");\n  const { t: tForms } = useTranslation(\"forms\");\n  const { t: tCommon } = useTranslation(\"common\");\n  const { currentStep, shouldLockNavigation, completeCurrentStep } = useOnboarding();\n  const openedRef = useRef(false);\n  const [showGuardDialog, setShowGuardDialog] = useState(false);\n  const navigate = useNavigate();\n\n  const forceClose = useCallback(() => {\n    onOpenChange(false);\n    reset(state.meta.initialEntryContext);\n    setIsCreating(false);\n    openedRef.current = false;\n    setShowGuardDialog(false);\n  }, [onOpenChange, reset, state.meta.initialEntryContext]);\n\n  const requestClose = useCallback(() => {\n    if (state.meta.isDirty) {\n      setShowGuardDialog(true);\n      return;\n    }\n    forceClose();\n  }, [forceClose, state.meta.isDirty]);\n\n  const handleModalOpenChange = useCallback(\n    (open: boolean) => {\n      if (open) {\n        onOpenChange(true);\n        return;\n      }\n      requestClose();\n    },\n    [onOpenChange, requestClose]\n  );\n\n  useEffect(() => {\n    if (!isOpen) return;\n    if (openedRef.current) return;\n    openedRef.current = true;\n    trackEvent(\"project_wizard_opened\", {\n      entrySource: state.meta.entrySource ?? \"direct\",\n    });\n  }, [isOpen, state.meta.entrySource]);\n\n  const validateBeforeSubmit = useCallback(() => {\n    if (!state.lead.id) {\n      toast({\n        title: tProject(\"validation.lead.title\"),\n        description: tProject(\"validation.lead.description\"),\n        variant: \"destructive\",\n      });\n      return false;\n    }\n\n    if (!state.details.name?.trim() || !state.details.projectTypeId) {\n      toast({\n        title: tProject(\"validation.details.title\"),\n        description: tProject(\"validation.details.description\"),\n        variant: \"destructive\",\n      });\n      return false;\n    }\n\n    return true;\n  }, [state.lead.id, state.details.name, state.details.projectTypeId, toast, tProject]);\n\n  const handleComplete = useCallback(async () => {\n    if (!validateBeforeSubmit()) {\n      return;\n    }\n\n    setIsCreating(true);\n    const entrySource = state.meta.entrySource ?? \"direct\";\n\n    try {\n      const {\n        data: { user },\n      } = await supabase.auth.getUser();\n      if (!user) {\n        throw new Error(\n          tCommon(\"messages.error.auth_required\", {\n            defaultValue: \"You need to be signed in to create a project.\",\n          })\n        );\n      }\n\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) {\n        throw new Error(\n          tCommon(\"messages.error.organization_required\", {\n            defaultValue: \"Select an active organization before creating a project.\",\n          })\n        );\n      }\n\n      let statusId = state.details.statusId ?? state.meta.defaultStatusId ?? undefined;\n      if (!statusId) {\n        const { data: defaultStatus, error: statusError } = await supabase.rpc(\n          \"get_default_project_status\",\n          { user_uuid: user.id }\n        );\n        if (statusError) throw statusError;\n        statusId = defaultStatus ?? undefined;\n      }\n\n      if (!statusId) {\n        throw new Error(\n          tProject(\"validation.details.description\", {\n            defaultValue: \"Enter the required project details before continuing.\",\n          })\n        );\n      }\n\n      const basePriceValue = parseFloat(state.details.basePrice ?? \"\") || 0;\n\n      const { data: newProject, error: projectError } = await supabase\n        .from(\"projects\")\n        .insert({\n          user_id: user.id,\n          organization_id: organizationId,\n          lead_id: state.lead.id,\n          name: state.details.name?.trim(),\n          description: state.details.description?.trim() || null,\n          status_id: statusId,\n          project_type_id: state.details.projectTypeId,\n          base_price: basePriceValue,\n        })\n        .select(\"id\")\n        .single();\n\n      if (projectError) throw projectError;\n\n      if (basePriceValue > 0) {\n        const { error: paymentError } = await supabase.from(\"payments\").insert({\n          project_id: newProject.id,\n          user_id: user.id,\n          organization_id: organizationId,\n          amount: basePriceValue,\n          description: tForms(\"payments.base_price\"),\n          status: \"due\",\n          type: \"base_price\",\n        });\n\n        if (paymentError) throw paymentError;\n      }\n\n      const catalogLineItems = state.services.items.filter(\n        (item) => item.type === \"existing\" && item.serviceId\n      );\n\n      if (catalogLineItems.length > 0) {\n        const servicePayload = catalogLineItems.map((item) => ({\n          project_id: newProject.id,\n          service_id: item.serviceId!,\n          user_id: user.id,\n        }));\n\n        const { error: servicesError } = await supabase\n          .from(\"project_services\")\n          .insert(servicePayload);\n\n        if (servicesError) throw servicesError;\n      }\n\n      toast({\n        title: tCommon(\"actions.success\"),\n        description: (\n          <div className=\"space-y-2\">\n            <p>{tCommon(\"messages.success.project_created\")}</p>\n            <button\n              type=\"button\"\n              className=\"text-sm font-semibold text-primary transition-colors hover:text-primary/80 focus-visible:outline-none\"\n              onClick={() => navigate(`/projects/${newProject.id}`)}\n            >\n              {tCommon(\"buttons.view_project\")}\n            </button>\n          </div>\n        ),\n        className: \"flex-col items-start\",\n      });\n\n      if (shouldLockNavigation && currentStep === 3) {\n        try {\n          await completeCurrentStep();\n        } catch (error) {\n          console.error(\"Failed to complete onboarding step:\", error);\n        }\n      }\n\n      trackEvent(\"project_wizard_completed\", {\n        projectId: newProject.id,\n        entrySource,\n        packageId: state.services.packageId ?? null,\n        serviceCount: catalogLineItems.length,\n        basePrice: basePriceValue,\n      });\n      onProjectCreated?.({\n        id: newProject.id,\n        name: state.details.name?.trim(),\n      });\n      forceClose();\n    } catch (error: any) {\n      trackEvent(\"project_wizard_error\", {\n        message: error?.message,\n        entrySource,\n      });\n      toast({\n        title: tCommon(\"labels.error\"),\n        description:\n          error?.message ??\n          tCommon(\"messages.error.generic\", {\n            defaultValue: \"Something went wrong. Please try again.\",\n          }),\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsCreating(false);\n    }\n  }, [\n    completeCurrentStep,\n    currentStep,\n    forceClose,\n    onProjectCreated,\n    shouldLockNavigation,\n    state.details.basePrice,\n    state.details.description,\n    state.details.name,\n    state.details.projectTypeId,\n    state.details.statusId,\n    state.lead.id,\n    state.meta.defaultStatusId,\n    state.meta.entrySource,\n    state.services.items,\n    state.services.packageId,\n    tCommon,\n    tForms,\n    tProject,\n    toast,\n    validateBeforeSubmit,\n  ]);\n\n  return (\n    <>\n      <AppSheetModal\n        title={tProject(\"wizard.title\")}\n        isOpen={isOpen}\n        onOpenChange={handleModalOpenChange}\n        size=\"xl\"\n        dirty={state.meta.isDirty}\n        onDirtyClose={requestClose}\n      >\n        {isOpen ? (\n          <div className=\"flex h-full flex-col\">\n            <ProjectCreationWizard onComplete={handleComplete} isCompleting={isCreating} />\n          </div>\n        ) : null}\n      </AppSheetModal>\n\n      <AlertDialog open={showGuardDialog} onOpenChange={setShowGuardDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{tProject(\"guardrail.unsavedTitle\")}</AlertDialogTitle>\n            <AlertDialogDescription>{tProject(\"guardrail.unsavedDescription\")}</AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>{tProject(\"guardrail.stay\")}</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={forceClose}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {tProject(\"guardrail.discard\")}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/project-creation/components/__tests__/ProjectCreationWizard.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/project-creation/components/__tests__/ProjectCreationWizardSheet.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":38,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":38,"endColumn":33},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":39,"column":41,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":39,"endColumn":89}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen } from \"@testing-library/react\";\nimport type { ReactNode } from \"react\";\nimport { ProjectCreationWizardSheet } from \"../ProjectCreationWizardSheet\";\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({ t: (key: string) => key }),\n}));\n\njest.mock(\"@/components/ui/app-sheet-modal\", () => ({\n  AppSheetModal: ({\n    children,\n  }: {\n    children: ReactNode;\n  }) => <div data-testid=\"modal\">{children}</div>,\n}));\n\njest.mock(\"@/components/ui/use-toast\", () => ({\n  useToast: () => ({ toast: jest.fn() }),\n}));\n\njest.mock(\"@/contexts/OnboardingContext\", () => ({\n  useOnboarding: () => ({\n    currentStep: \"project-wizard\",\n    shouldLockNavigation: false,\n    completeCurrentStep: jest.fn(),\n  }),\n}));\n\njest.mock(\"@/lib/telemetry\", () => ({\n  trackEvent: jest.fn(),\n}));\n\njest.mock(\"@/lib/organizationUtils\", () => ({\n  getUserOrganizationId: jest.fn().mockResolvedValue(\"org-123\"),\n}));\n\njest.mock(\"../ProjectCreationWizard\", () => {\n  const React = require(\"react\");\n  const { useProjectCreationContext } = require(\"../../hooks/useProjectCreationContext\");\n  return {\n    ProjectCreationWizard: jest.fn(() => {\n      const { state } = useProjectCreationContext();\n      return (\n        <div data-testid=\"wizard-step\">{state.meta.currentStep}</div>\n      );\n    }),\n  };\n});\n\ndescribe(\"ProjectCreationWizardSheet initial step selection\", () => {\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it(\"starts on the lead step by default\", () => {\n    render(\n      <ProjectCreationWizardSheet\n        isOpen\n        onOpenChange={jest.fn()}\n      />\n    );\n\n    expect(screen.getByTestId(\"wizard-step\")).toHaveTextContent(\"lead\");\n  });\n\n  it(\"advances to details when lead context is provided\", () => {\n    render(\n      <ProjectCreationWizardSheet\n        isOpen\n        onOpenChange={jest.fn()}\n        leadId=\"lead-001\"\n        leadName=\"Jordan\"\n      />\n    );\n\n    expect(screen.getByTestId(\"wizard-step\")).toHaveTextContent(\"details\");\n  });\n\n  it(\"honours a start step override\", () => {\n    render(\n      <ProjectCreationWizardSheet\n        isOpen\n        onOpenChange={jest.fn()}\n        leadId=\"lead-001\"\n        startStepOverride=\"packages\"\n      />\n    );\n\n    expect(screen.getByTestId(\"wizard-step\")).toHaveTextContent(\"packages\");\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/project-creation/context/ProjectCreationProvider.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your React context(s) to a separate file.","line":10,"column":14,"nodeType":"Identifier","messageId":"reactContext","endLine":10,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, ReactNode, useMemo, useReducer } from \"react\";\nimport { projectCreationReducer, createInitialProjectCreationState } from \"../state/projectCreationReducer\";\nimport { ProjectCreationAction, ProjectCreationEntryContext, ProjectCreationState } from \"../types\";\n\ninterface ProjectCreationContextValue {\n  state: ProjectCreationState;\n  dispatch: React.Dispatch<ProjectCreationAction>;\n}\n\nexport const ProjectCreationContext = createContext<ProjectCreationContextValue | undefined>(undefined);\n\ninterface ProjectCreationProviderProps {\n  children: ReactNode;\n  entryContext?: ProjectCreationEntryContext;\n}\n\nexport const ProjectCreationProvider = ({ children, entryContext }: ProjectCreationProviderProps) => {\n  const [state, dispatch] = useReducer(projectCreationReducer, createInitialProjectCreationState(entryContext));\n\n  const value = useMemo(\n    () => ({\n      state,\n      dispatch,\n    }),\n    [state]\n  );\n\n  return <ProjectCreationContext.Provider value={value}>{children}</ProjectCreationContext.Provider>;\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/project-creation/hooks/useProjectCreationActions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/project-creation/hooks/useProjectCreationContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/project-creation/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/project-creation/state/__tests__/ProjectCreationReducer.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/project-creation/state/projectCreationReducer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/project-creation/steps/DetailsStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/project-creation/steps/LeadStep.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3032,3035],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3032,3035],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { EnhancedAddLeadDialog } from \"@/components/EnhancedAddLeadDialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/components/ui/use-toast\";\nimport { LeadStatusBadge } from \"@/components/LeadStatusBadge\";\nimport { useLeadStatuses } from \"@/hooks/useOrganizationData\";\nimport { LeadInitials } from \"@/components/LeadInitials\";\nimport { cn } from \"@/lib/utils\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\nimport { useProjectCreationActions } from \"../hooks/useProjectCreationActions\";\nimport { useProjectCreationContext } from \"../hooks/useProjectCreationContext\";\nimport { Check, ChevronDown, Loader2, Search, UserPlus } from \"lucide-react\";\n\ninterface LeadOption {\n  id: string;\n  name: string;\n  email?: string | null;\n  phone?: string | null;\n  status?: string | null;\n  status_id?: string | null;\n}\n\nexport const LeadStep = () => {\n  const { t } = useTranslation(\"projectCreation\");\n  const { toast } = useToast();\n  const { state } = useProjectCreationContext();\n  const { updateLead } = useProjectCreationActions();\n  const [leadOptions, setLeadOptions] = useState<LeadOption[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [hasLoadedOnce, setHasLoadedOnce] = useState(false);\n  const [dropdownOpen, setDropdownOpen] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [createLeadOpen, setCreateLeadOpen] = useState(false);\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const latestRequestRef = useRef(0);\n  const { data: leadStatuses = [], isLoading: leadStatusesLoading } = useLeadStatuses();\n\n  const loadLeads = useCallback(\n    async (term: string) => {\n      const requestId = ++latestRequestRef.current;\n      setLoading(true);\n      try {\n        const organizationId = await getUserOrganizationId();\n        if (!organizationId) {\n          if (latestRequestRef.current === requestId) {\n            setLeadOptions([]);\n          }\n          return;\n        }\n\n        const sanitized = term.trim().replace(/[%_]/g, \"\\\\$&\");\n        let query = supabase\n          .from(\"leads\")\n          .select(\"id, name, email, phone, status, status_id\")\n          .eq(\"organization_id\", organizationId)\n          .order(\"updated_at\", { ascending: false })\n          .limit(25);\n\n        if (sanitized) {\n          query = query.or(\n            `name.ilike.%${sanitized}%,email.ilike.%${sanitized}%,phone.ilike.%${sanitized}%`\n          );\n        }\n\n        const { data, error } = await query;\n        if (error) throw error;\n\n        if (latestRequestRef.current === requestId) {\n          setLeadOptions((data as LeadOption[]) || []);\n        }\n      } catch (error: any) {\n        console.error(\"Failed to load leads\", error);\n        if (latestRequestRef.current === requestId) {\n          setLeadOptions([]);\n          setHasLoadedOnce(true);\n        }\n        toast({\n          title: t(\"steps.lead.fetchErrorTitle\"),\n          description: error.message,\n          variant: \"destructive\",\n        });\n      } finally {\n        if (latestRequestRef.current === requestId) {\n          setLoading(false);\n          setHasLoadedOnce(true);\n        }\n      }\n    },\n    [toast, t]\n  );\n\n  useEffect(() => {\n    loadLeads(\"\");\n  }, [loadLeads]);\n\n  useEffect(() => {\n    if (!dropdownOpen) return;\n    const handler = window.setTimeout(() => {\n      loadLeads(searchTerm);\n    }, 250);\n    return () => {\n      window.clearTimeout(handler);\n    };\n  }, [dropdownOpen, searchTerm, loadLeads]);\n\n \n  useEffect(() => {\n    if (!dropdownOpen) return;\n    const handlePointerDown = (event: PointerEvent) => {\n      if (\n        containerRef.current &&\n        !containerRef.current.contains(event.target as Node)\n      ) {\n        setDropdownOpen(false);\n      }\n    };\n    document.addEventListener(\"pointerdown\", handlePointerDown);\n    return () => {\n      document.removeEventListener(\"pointerdown\", handlePointerDown);\n    };\n  }, [dropdownOpen]);\n\n  const selectedLeadOption = useMemo(() => {\n    if (!state.lead.id) return undefined;\n    return leadOptions.find((lead) => lead.id === state.lead.id);\n  }, [leadOptions, state.lead.id]);\n\n  const handleAssignLead = (lead: LeadOption) => {\n    updateLead({\n      id: lead.id,\n      name: lead.name,\n      email: lead.email ?? undefined,\n      phone: lead.phone ?? undefined,\n      notes: \"\",\n      mode: \"existing\",\n    });\n    setDropdownOpen(false);\n    setSearchTerm(\"\");\n  };\n\n  const handleLeadCreated = (lead: LeadOption) => {\n    setCreateLeadOpen(false);\n    const normalized: LeadOption = {\n      id: lead.id,\n      name: lead.name,\n      email: lead.email,\n      phone: lead.phone,\n      status: lead.status,\n      status_id: lead.status_id,\n    };\n    setLeadOptions((prev) => {\n      const without = prev.filter((item) => item.id !== normalized.id);\n      return [normalized, ...without];\n    });\n    handleAssignLead(normalized);\n    void loadLeads(\"\");\n  };\n\n  const showInitialLoading = loading && !hasLoadedOnce && leadOptions.length === 0;\n  const showEmptyState = !loading && hasLoadedOnce && leadOptions.length === 0;\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"space-y-2\">\n        <h2 className=\"text-xl font-semibold tracking-tight\">\n          {t(\"steps.lead.heading\")}\n        </h2>\n        <p className=\"text-sm text-muted-foreground\">\n          {t(\"steps.lead.description\")}\n        </p>\n      </div>\n\n      <div className=\"space-y-3\">\n        <Label className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\">\n          {t(\"steps.lead.selectExisting\")}\n        </Label>\n        <div className=\"relative\" ref={containerRef}>\n          <Button\n            type=\"button\"\n            onClick={() => setDropdownOpen((prev) => !prev)}\n            className={cn(\n              \"group flex h-12 w-full items-center justify-between rounded-xl border border-border/70 bg-white px-4 py-3 text-left font-semibold text-slate-900 shadow-sm transition hover:border-emerald-400/70 hover:shadow-md focus-visible:ring-2 focus-visible:ring-emerald-300\",\n              dropdownOpen && \"border-emerald-400/80 shadow-emerald-200\",\n              loading && leadOptions.length === 0 && \"cursor-wait opacity-70\"\n            )}\n            disabled={loading && leadOptions.length === 0}\n          >\n            {selectedLeadOption ? (\n              <div className=\"flex w-full items-center justify-between gap-3\">\n                <LeadSummaryPreview\n                  lead={selectedLeadOption}\n                  textColor=\"text-slate-900\"\n                  subtleColor=\"text-muted-foreground\"\n                />\n                {(selectedLeadOption.status || selectedLeadOption.status_id) ? (\n                  <LeadStatusBadge\n                    leadId={selectedLeadOption.id}\n                    currentStatusId={selectedLeadOption.status_id ?? undefined}\n                    currentStatus={selectedLeadOption.status ?? undefined}\n                    editable={false}\n                    size=\"sm\"\n                    statuses={leadStatuses}\n                    statusesLoading={leadStatusesLoading}\n                  />\n                ) : null}\n              </div>\n            ) : loading && !hasLoadedOnce ? (\n              t(\"steps.lead.loading\")\n            ) : (\n              t(\"steps.lead.selectPlaceholder\")\n            )}\n            <ChevronDown className=\"ml-2 h-4 w-4 shrink-0 text-muted-foreground transition group-data-[state=open]:rotate-180\" />\n          </Button>\n\n          {dropdownOpen && (\n            <div className=\"absolute top-full left-0 right-0 z-50 mt-2 rounded-2xl border border-border bg-background shadow-xl\">\n              <div className=\"px-4 py-3\">\n                <div className=\"relative\">\n                  <Search className=\"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n                  <Input\n                    value={searchTerm}\n                    onChange={(event) => setSearchTerm(event.target.value)}\n                    placeholder={t(\"steps.lead.searchPlaceholder\")}\n                    className=\"h-11 rounded-xl border border-border bg-white pl-9 text-sm shadow-inner focus:border-emerald-400 focus:ring-2 focus:ring-emerald-100\"\n                    autoFocus\n                  />\n                </div>\n              </div>\n              <div className=\"relative max-h-64 min-h-[10rem] overflow-y-auto border-t border-border/80 bg-white\">\n                {showInitialLoading ? (\n                  <div className=\"flex h-full flex-col items-center justify-center gap-2 px-4 py-6 text-sm text-muted-foreground\">\n                    <Loader2 className=\"h-4 w-4 animate-spin text-emerald-500\" />\n                    {t(\"steps.lead.loading\")}\n                  </div>\n                ) : showEmptyState ? (\n                  <p className=\"px-4 py-6 text-center text-sm text-muted-foreground\">\n                    {searchTerm ? t(\"steps.lead.noResults\") : t(\"steps.lead.emptyState\")}\n                  </p>\n                ) : (\n                  <>\n                    {loading && (\n                      <div className=\"sticky top-0 flex items-center gap-2 bg-white/95 px-4 py-2 text-xs text-muted-foreground backdrop-blur\">\n                        <Loader2 className=\"h-3.5 w-3.5 animate-spin\" />\n                        {t(\"steps.lead.loading\")}\n                      </div>\n                    )}\n                    <div className=\"divide-y\">\n                      {leadOptions.map((lead) => {\n                        const isActive = state.lead.id === lead.id;\n                        return (\n                          <button\n                            key={lead.id}\n                            type=\"button\"\n                            onClick={() => handleAssignLead(lead)}\n                            className={cn(\n                              \"flex w-full items-center justify-between px-4 py-3 text-left transition hover:bg-muted/60\",\n                              isActive && \"bg-emerald-100/40\"\n                            )}\n                          >\n                            <div className=\"flex items-center gap-3\">\n                              <Avatar className=\"h-9 w-9 border border-border/70 bg-muted shadow-sm\">\n                                <AvatarFallback className=\"text-sm font-semibold uppercase text-slate-700\">\n                                  <LeadInitials name={lead.name} fallback=\"?\" maxInitials={2} />\n                                </AvatarFallback>\n                              </Avatar>\n                              <div className=\"flex flex-col\">\n                                <span className=\"text-sm font-semibold text-slate-900\">\n                                  {lead.name}\n                                </span>\n                                {(lead.email || lead.phone) && (\n                                  <span className=\"text-xs text-muted-foreground\">\n                                    {[lead.email, lead.phone].filter(Boolean).join(\" â€¢ \")}\n                                  </span>\n                                )}\n                              </div>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              {(lead.status || lead.status_id) ? (\n                                <LeadStatusBadge\n                                  leadId={lead.id}\n                                  currentStatusId={lead.status_id ?? undefined}\n                                  currentStatus={lead.status ?? undefined}\n                                  editable={false}\n                                  size=\"sm\"\n                                  statuses={leadStatuses}\n                                  statusesLoading={leadStatusesLoading}\n                                />\n                              ) : null}\n                              <Check\n                                className={cn(\n                                  \"h-4 w-4 text-emerald-500 transition\",\n                                  isActive ? \"opacity-100\" : \"opacity-0\"\n                                )}\n                              />\n                            </div>\n                          </button>\n                        );\n                      })}\n                    </div>\n                  </>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n\n        <Button\n          variant=\"outline\"\n          className=\"gap-2\"\n          onClick={() => setCreateLeadOpen(true)}\n        >\n          <UserPlus className=\"h-4 w-4\" />\n          {t(\"steps.lead.createButton\")}\n        </Button>\n\n        {leadOptions.length === 0 && !loading && (\n          <p className=\"text-xs text-muted-foreground\">\n            {t(\"steps.lead.emptyState\")}\n          </p>\n        )}\n      </div>\n\n      <EnhancedAddLeadDialog\n        open={createLeadOpen}\n        onOpenChange={setCreateLeadOpen}\n        onClose={() => setCreateLeadOpen(false)}\n        onSuccess={handleLeadCreated}\n      />\n    </div>\n  );\n};\n\nconst LeadSummaryPreview = ({\n  lead,\n  textColor = \"text-foreground\",\n  subtleColor = \"text-muted-foreground\",\n}: {\n  lead: LeadOption;\n  textColor?: string;\n  subtleColor?: string;\n}) => {\n  return (\n    <div className=\"flex w-full items-center gap-3\">\n      <Avatar className=\"h-9 w-9 border border-border/60 bg-muted shadow-sm\">\n        <AvatarFallback className=\"text-xs font-semibold uppercase text-slate-700\">\n          <LeadInitials name={lead.name} fallback=\"?\" maxInitials={2} />\n        </AvatarFallback>\n      </Avatar>\n      <div className=\"flex flex-col\">\n        <span className={cn(\"text-sm font-medium\", textColor)}>{lead.name}</span>\n        {(lead.email || lead.phone) && (\n          <span className={cn(\"text-xs\", subtleColor)}>\n            {[lead.email, lead.phone].filter(Boolean).join(\" â€¢ \")}\n          </span>\n        )}\n      </div>\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/project-creation/steps/PackagesStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/project-creation/steps/SummaryStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/project-creation/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/services/components/CustomServicesSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/services/components/HelperTooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/services/components/ServiceVatOverridesSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/api/leadProjectCreation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/api/savedResources.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[448,451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[448,451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[660,663],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[660,663],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from \"@/integrations/supabase/client\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\n\nexport interface SavedLocationRecord {\n  id: string;\n  label: string;\n  address: string;\n  meetingUrl?: string | null;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface SavedNotePresetRecord {\n  id: string;\n  title: string;\n  body: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nconst mapLocation = (row: any): SavedLocationRecord => ({\n  id: row.id,\n  label: row.label,\n  address: row.address,\n  meetingUrl: row.meeting_url,\n  createdAt: row.created_at,\n  updatedAt: row.updated_at,\n});\n\nconst mapNotePreset = (row: any): SavedNotePresetRecord => ({\n  id: row.id,\n  title: row.title,\n  body: row.body,\n  createdAt: row.created_at,\n  updatedAt: row.updated_at,\n});\n\nasync function requireUser() {\n  const {\n    data: { user },\n    error,\n  } = await supabase.auth.getUser();\n  if (error) throw error;\n  if (!user) throw new Error(\"User not authenticated\");\n  return user.id;\n}\n\nexport async function fetchSavedLocations(): Promise<SavedLocationRecord[]> {\n  await requireUser();\n  const { data, error } = await supabase\n    .from(\"session_saved_locations\")\n    .select(\"id,label,address,meeting_url,created_at,updated_at\")\n    .order(\"created_at\", { ascending: false });\n  if (error) throw error;\n  return (data ?? []).map(mapLocation);\n}\n\nexport async function createSavedLocation(payload: {\n  label: string;\n  address: string;\n  meetingUrl?: string;\n}): Promise<SavedLocationRecord> {\n  const userId = await requireUser();\n  const organizationId = await getUserOrganizationId();\n\n  const { data, error } = await supabase\n    .from(\"session_saved_locations\")\n    .insert({\n      label: payload.label.trim(),\n      address: payload.address.trim(),\n      meeting_url: payload.meetingUrl?.trim() || null,\n      user_id: userId,\n      organization_id: organizationId ?? null,\n    })\n    .select(\"id,label,address,meeting_url,created_at,updated_at\")\n    .single();\n  if (error) throw error;\n  return mapLocation(data);\n}\n\nexport async function updateSavedLocation(\n  id: string,\n  payload: {\n    label: string;\n    address: string;\n    meetingUrl?: string;\n  }\n): Promise<SavedLocationRecord> {\n  await requireUser();\n  const { data, error } = await supabase\n    .from(\"session_saved_locations\")\n    .update({\n      label: payload.label.trim(),\n      address: payload.address.trim(),\n      meeting_url: payload.meetingUrl?.trim() || null,\n    })\n    .eq(\"id\", id)\n    .select(\"id,label,address,meeting_url,created_at,updated_at\")\n    .single();\n  if (error) throw error;\n  return mapLocation(data);\n}\n\nexport async function deleteSavedLocation(id: string): Promise<void> {\n  await requireUser();\n  const { error } = await supabase\n    .from(\"session_saved_locations\")\n    .delete()\n    .eq(\"id\", id);\n  if (error) throw error;\n}\n\nexport async function fetchSavedNotePresets(): Promise<\n  SavedNotePresetRecord[]\n> {\n  await requireUser();\n  const { data, error } = await supabase\n    .from(\"session_saved_note_presets\")\n    .select(\"id,title,body,created_at,updated_at\")\n    .order(\"created_at\", { ascending: false });\n  if (error) throw error;\n  return (data ?? []).map(mapNotePreset);\n}\n\nexport async function createSavedNotePreset(payload: {\n  title: string;\n  body: string;\n}): Promise<SavedNotePresetRecord> {\n  const userId = await requireUser();\n  const organizationId = await getUserOrganizationId();\n  const { data, error } = await supabase\n    .from(\"session_saved_note_presets\")\n    .insert({\n      title: payload.title.trim(),\n      body: payload.body.trim(),\n      user_id: userId,\n      organization_id: organizationId ?? null,\n    })\n    .select(\"id,title,body,created_at,updated_at\")\n    .single();\n  if (error) throw error;\n  return mapNotePreset(data);\n}\n\nexport async function deleteSavedNotePreset(id: string): Promise<void> {\n  await requireUser();\n  const { error } = await supabase\n    .from(\"session_saved_note_presets\")\n    .delete()\n    .eq(\"id\", id);\n  if (error) throw error;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/api/sessionCreation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/components/SessionPlanningWizard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/components/SessionPlanningWizardSheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/components/__tests__/SessionPlanningWizardSheet.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1301,1304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1301,1304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1340,1343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1340,1343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2988,2991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2988,2991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":128,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":128,"endColumn":33},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":129,"column":41,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":129,"endColumn":89}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen } from \"@testing-library/react\";\nimport type { ReactNode } from \"react\";\nimport { SessionPlanningWizardSheet } from \"../SessionPlanningWizardSheet\";\nimport { useSessionPlanningContext } from \"../../hooks/useSessionPlanningContext\";\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({ t: (key: string) => key }),\n}));\n\njest.mock(\"@/features/session-planning/context/SessionSavedResourcesProvider\", () => ({\n  SessionSavedResourcesProvider: ({ children }: { children: ReactNode }) => <>{children}</>,\n}));\n\njest.mock(\"@/features/session-planning/context/SessionWorkflowProvider\", () => ({\n  SessionWorkflowProvider: ({ children }: { children: ReactNode }) => <>{children}</>,\n  useSessionWorkflowCatalog: () => ({\n    reminderWorkflows: [],\n    summaryEmailWorkflows: [],\n    otherWorkflows: [],\n  }),\n}));\n\njest.mock(\"@/lib/telemetry\", () => ({\n  trackEvent: jest.fn(),\n  debug: jest.fn(),\n}));\n\njest.mock(\"@/components/ui/app-sheet-modal\", () => ({\n  AppSheetModal: ({ children }: { children: ReactNode }) => <div data-testid=\"modal\">{children}</div>,\n}));\n\ntype SupabaseBuilder = {\n  select: jest.Mock<SupabaseBuilder, [string?]>;\n  eq: jest.Mock<SupabaseBuilder, [string, unknown]>;\n  limit: jest.Mock<SupabaseBuilder, [number]>;\n  maybeSingle: jest.Mock<Promise<any>, []>;\n  single: jest.Mock<Promise<any>, []>;\n  order: jest.Mock<SupabaseBuilder, [string, { ascending?: boolean }?]>;\n};\n\nfunction createBuilder() {\n  const builder: Partial<SupabaseBuilder> = {};\n  const chain = () => builder as SupabaseBuilder;\n  builder.select = jest.fn(() => chain());\n  builder.eq = jest.fn(() => chain());\n  builder.limit = jest.fn(() => chain());\n  builder.order = jest.fn(() => chain());\n  builder.maybeSingle = jest.fn(() =>\n    Promise.resolve({ data: null, error: null, status: 200, statusText: \"OK\" })\n  );\n  builder.single = jest.fn(() =>\n    Promise.resolve({ data: null, error: null, status: 200, statusText: \"OK\" })\n  );\n  return builder as SupabaseBuilder;\n}\n\nfunction createSupabaseStub() {\n  let sessionResponse = { data: null, error: null, status: 200, statusText: \"OK\" };\n  const sessionBuilder = createBuilder();\n  sessionBuilder.maybeSingle = jest.fn(() => Promise.resolve(sessionResponse));\n  sessionBuilder.single = jest.fn(() => Promise.resolve(sessionResponse));\n  const builders = new Map<string, SupabaseBuilder>();\n  const getBuilder = (table: string) => {\n    if (table === \"sessions\") {\n      return sessionBuilder;\n    }\n    if (!builders.has(table)) {\n      builders.set(table, createBuilder());\n    }\n    return builders.get(table)!;\n  };\n\n  const supabase = {\n    auth: {\n      getUser: jest.fn(async () => ({ data: { user: { id: \"wizard-user\" } }, error: null })),\n      onAuthStateChange: jest.fn(() => ({\n        data: { subscription: { unsubscribe: jest.fn() } },\n      })),\n    },\n    from: jest.fn((table: string) => getBuilder(table)),\n    rpc: jest.fn(),\n  };\n\n  return {\n    supabase,\n    setSessionResponse: (response: any) => {\n      sessionResponse = {\n        status: 200,\n        statusText: \"OK\",\n        error: null,\n        ...response,\n      };\n    },\n    reset: () => {\n      sessionResponse = { data: null, error: null, status: 200, statusText: \"OK\" };\n      sessionBuilder.select.mockClear();\n      sessionBuilder.eq.mockClear();\n      sessionBuilder.limit.mockClear();\n      sessionBuilder.order.mockClear();\n      sessionBuilder.maybeSingle.mockClear();\n      sessionBuilder.single.mockClear();\n      builders.forEach((builder) => {\n        builder.select.mockClear();\n        builder.eq.mockClear();\n        builder.limit.mockClear();\n        builder.order.mockClear();\n        builder.maybeSingle.mockClear();\n        builder.single.mockClear();\n      });\n      builders.clear();\n      supabase.auth.getUser.mockClear();\n      supabase.auth.onAuthStateChange.mockClear();\n      supabase.from.mockClear();\n      supabase.rpc.mockClear();\n    },\n  };\n}\n\njest.mock(\"@/integrations/supabase/client\", () => {\n  const stub = createSupabaseStub();\n  return {\n    supabase: stub.supabase,\n    __supabaseTestStub: stub,\n  };\n});\n\njest.mock(\"../SessionPlanningWizard\", () => {\n  const React = require(\"react\");\n  const { useSessionPlanningContext } = require(\"../../hooks/useSessionPlanningContext\");\n  return {\n    SessionPlanningWizard: jest.fn(() => {\n      const { state } = useSessionPlanningContext();\n      return <div data-testid=\"wizard-step\">{state.meta.currentStep}</div>;\n    }),\n  };\n});\n\nconst getSupabaseStub = () =>\n  (jest.requireMock(\"@/integrations/supabase/client\") as unknown as {\n    __supabaseTestStub: ReturnType<typeof createSupabaseStub>;\n  }).__supabaseTestStub;\n\ndescribe(\"SessionPlanningWizardSheet start step behaviour\", () => {\n  beforeEach(() => {\n    getSupabaseStub().reset();\n    localStorage.clear();\n  });\n\n  it(\"respects start step override for create flow\", async () => {\n    render(\n      <SessionPlanningWizardSheet\n        isOpen={false}\n        onOpenChange={jest.fn()}\n        leadId=\"lead-1\"\n        leadName=\"Taylor\"\n        startStepOverride=\"schedule\"\n      />\n    );\n\n    expect(await screen.findByTestId(\"wizard-step\")).toHaveTextContent(\"schedule\");\n  });\n\n  it(\"defaults edit sessions to summary when no override provided\", async () => {\n    const stub = getSupabaseStub();\n    stub.setSessionResponse({\n      data: {\n        id: \"session-1\",\n        session_date: \"2024-05-10\",\n        session_time: \"10:00\",\n        session_name: \"Planning\",\n        lead_id: \"lead-99\",\n        leads: { id: \"lead-99\", name: \"Jamie\" },\n        project_id: \"project-42\",\n        projects: { id: \"project-42\", name: \"Shoot\" },\n        session_types: { id: \"type-1\", name: \"Standard\" },\n      },\n    });\n\n    render(\n      <SessionPlanningWizardSheet\n        isOpen={false}\n        onOpenChange={jest.fn()}\n        mode=\"edit\"\n        sessionId=\"session-1\"\n      />\n    );\n\n    expect(await screen.findByTestId(\"wizard-step\")).toHaveTextContent(\"summary\");\n  });\n\n  it(\"honours edit mode start step override\", async () => {\n    const stub = getSupabaseStub();\n    stub.setSessionResponse({\n      data: {\n        id: \"session-2\",\n        session_date: \"2024-07-01\",\n        session_time: \"08:30\",\n        lead_id: \"lead-7\",\n        leads: { id: \"lead-7\", name: \"Morgan\" },\n        session_types: { id: \"type-2\", name: \"Mini\" },\n      },\n    });\n\n    render(\n      <SessionPlanningWizardSheet\n        isOpen={false}\n        onOpenChange={jest.fn()}\n        mode=\"edit\"\n        sessionId=\"session-2\"\n        startStepOverride=\"schedule\"\n      />\n    );\n\n    expect(await screen.findByTestId(\"wizard-step\")).toHaveTextContent(\"schedule\");\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/context/SessionPlanningOriginalStateContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":8,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":8,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext } from \"react\";\nimport type { SessionPlanningState } from \"../types\";\n\nconst SessionPlanningOriginalStateContext = createContext<SessionPlanningState | null>(null);\n\nexport const SessionPlanningOriginalStateProvider = SessionPlanningOriginalStateContext.Provider;\n\nexport const useSessionPlanningOriginalState = () =>\n  useContext(SessionPlanningOriginalStateContext);\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/context/SessionPlanningProvider.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your React context(s) to a separate file.","line":10,"column":14,"nodeType":"Identifier","messageId":"reactContext","endLine":10,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, ReactNode, useMemo, useReducer } from \"react\";\nimport { sessionPlanningReducer, createInitialSessionPlanningState } from \"../state/sessionPlanningReducer\";\nimport { SessionPlanningAction, SessionPlanningEntryContext, SessionPlanningState } from \"../types\";\n\ninterface SessionPlanningContextValue {\n  state: SessionPlanningState;\n  dispatch: React.Dispatch<SessionPlanningAction>;\n}\n\nexport const SessionPlanningContext = createContext<SessionPlanningContextValue | undefined>(undefined);\n\ninterface SessionPlanningProviderProps {\n  children: ReactNode;\n  entryContext?: SessionPlanningEntryContext;\n}\n\nexport const SessionPlanningProvider = ({ children, entryContext }: SessionPlanningProviderProps) => {\n  const [state, dispatch] = useReducer(\n    sessionPlanningReducer,\n    createInitialSessionPlanningState(entryContext)\n  );\n\n  const value = useMemo(\n    () => ({\n      state,\n      dispatch\n    }),\n    [state]\n  );\n\n  return <SessionPlanningContext.Provider value={value}>{children}</SessionPlanningContext.Provider>;\n};\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/context/SessionSavedResourcesProvider.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2171,2174],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2171,2174],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3013,3016],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3013,3016],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":206,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":206,"endColumn":38}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n  type ReactNode,\n} from \"react\";\nimport {\n  fetchSavedLocations,\n  fetchSavedNotePresets,\n  type SavedLocationRecord,\n  type SavedNotePresetRecord,\n} from \"../api/savedResources\";\nimport { sanitizeNotesInput } from \"../utils/sanitizeNotes\";\n\ninterface ResourceState<T> {\n  items: T[];\n  loading: boolean;\n  error: string | null;\n  hasLoaded: boolean;\n}\n\ninterface SessionSavedResourcesContextValue {\n  savedLocations: SavedLocationRecord[];\n  savedLocationsLoading: boolean;\n  savedLocationsError: string | null;\n  savedLocationsLoaded: boolean;\n  updateSavedLocations: (\n    updater: (current: SavedLocationRecord[]) => SavedLocationRecord[]\n  ) => void;\n  reloadSavedLocations: () => Promise<void>;\n  setSavedLocationsError: (error: string | null) => void;\n  savedNotes: SavedNotePresetRecord[];\n  savedNotesLoading: boolean;\n  savedNotesError: string | null;\n  savedNotesLoaded: boolean;\n  updateSavedNotes: (\n    updater: (current: SavedNotePresetRecord[]) => SavedNotePresetRecord[]\n  ) => void;\n  reloadSavedNotes: () => Promise<void>;\n  setSavedNotesError: (error: string | null) => void;\n}\n\nconst SessionSavedResourcesContext =\n  createContext<SessionSavedResourcesContextValue | undefined>(undefined);\n\nconst createInitialState = <T,>(): ResourceState<T> => ({\n  items: [],\n  loading: true,\n  error: null,\n  hasLoaded: false,\n});\n\nexport const SessionSavedResourcesProvider = ({ children }: { children: ReactNode }) => {\n  const [locationsState, setLocationsState] = useState<ResourceState<SavedLocationRecord>>(\n    () => createInitialState<SavedLocationRecord>()\n  );\n  const [notesState, setNotesState] = useState<ResourceState<SavedNotePresetRecord>>(\n    () => createInitialState<SavedNotePresetRecord>()\n  );\n\n  const loadLocations = useCallback(async () => {\n    setLocationsState((prev) => ({\n      ...prev,\n      loading: true,\n      error: null,\n    }));\n    try {\n      const data = await fetchSavedLocations();\n      setLocationsState({\n        items: data,\n        loading: false,\n        error: null,\n        hasLoaded: true,\n      });\n    } catch (error: any) {\n      console.error(\"Failed to load saved locations\", error);\n      const message =\n        error instanceof Error\n          ? error.message\n          : \"Unable to load saved locations. Please try again.\";\n      setLocationsState((prev) => ({\n        ...prev,\n        loading: false,\n        error: message,\n        hasLoaded: true,\n      }));\n    }\n  }, []);\n\n  const loadNotes = useCallback(async () => {\n    setNotesState((prev) => ({\n      ...prev,\n      loading: true,\n      error: null,\n    }));\n    try {\n      const data = await fetchSavedNotePresets();\n      const sanitized = data.map((preset) => ({\n        ...preset,\n        body: sanitizeNotesInput(preset.body),\n      }));\n      setNotesState({\n        items: sanitized,\n        loading: false,\n        error: null,\n        hasLoaded: true,\n      });\n    } catch (error: any) {\n      console.error(\"Failed to load saved note presets\", error);\n      const message =\n        error instanceof Error\n          ? error.message\n          : \"Unable to load saved notes. Please try again.\";\n      setNotesState((prev) => ({\n        ...prev,\n        loading: false,\n        error: message,\n        hasLoaded: true,\n      }));\n    }\n  }, []);\n\n  useEffect(() => {\n    void Promise.all([loadLocations(), loadNotes()]);\n  }, [loadLocations, loadNotes]);\n\n  const updateSavedLocations = useCallback(\n    (updater: (current: SavedLocationRecord[]) => SavedLocationRecord[]) => {\n      setLocationsState((prev) => ({\n        ...prev,\n        items: updater(prev.items),\n      }));\n    },\n    []\n  );\n\n  const updateSavedNotes = useCallback(\n    (updater: (current: SavedNotePresetRecord[]) => SavedNotePresetRecord[]) => {\n      setNotesState((prev) => ({\n        ...prev,\n        items: updater(prev.items).map((preset) => ({\n          ...preset,\n          body: sanitizeNotesInput(preset.body),\n        })),\n      }));\n    },\n    []\n  );\n\n  const setSavedLocationsError = useCallback((error: string | null) => {\n    setLocationsState((prev) => ({\n      ...prev,\n      error,\n    }));\n  }, []);\n\n  const setSavedNotesError = useCallback((error: string | null) => {\n    setNotesState((prev) => ({\n      ...prev,\n      error,\n    }));\n  }, []);\n\n  const value = useMemo<SessionSavedResourcesContextValue>(() => ({\n    savedLocations: locationsState.items,\n    savedLocationsLoading: locationsState.loading,\n    savedLocationsError: locationsState.error,\n    savedLocationsLoaded: locationsState.hasLoaded,\n    updateSavedLocations,\n    reloadSavedLocations: loadLocations,\n    setSavedLocationsError,\n    savedNotes: notesState.items,\n    savedNotesLoading: notesState.loading,\n    savedNotesError: notesState.error,\n    savedNotesLoaded: notesState.hasLoaded,\n    updateSavedNotes,\n    reloadSavedNotes: loadNotes,\n    setSavedNotesError,\n  }), [\n    locationsState.items,\n    locationsState.loading,\n    locationsState.error,\n    locationsState.hasLoaded,\n    updateSavedLocations,\n    loadLocations,\n    setSavedLocationsError,\n    notesState.items,\n    notesState.loading,\n    notesState.error,\n    notesState.hasLoaded,\n    updateSavedNotes,\n    loadNotes,\n    setSavedNotesError,\n  ]);\n\n  return (\n    <SessionSavedResourcesContext.Provider value={value}>\n      {children}\n    </SessionSavedResourcesContext.Provider>\n  );\n};\n\nexport const useSessionSavedResources = () => {\n  const context = useContext(SessionSavedResourcesContext);\n  if (!context) {\n    throw new Error(\n      \"useSessionSavedResources must be used within a SessionSavedResourcesProvider\"\n    );\n  }\n  return context;\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/context/SessionWorkflowProvider.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":134,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4177,4180],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4177,4180],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":199,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":199,"endColumn":39}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useCallback, useContext, useEffect, useMemo, useState } from \"react\";\nimport type { ReactNode } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\nimport type { WorkflowStep } from \"@/types/workflow\";\nimport type { TriggerType } from \"@/types/workflow\";\n\ntype WorkflowTriggerConditions = Record<string, unknown> | null | undefined;\n\nconst getReminderType = (conditions: WorkflowTriggerConditions) => {\n  if (!conditions || typeof conditions !== \"object\") return null;\n  const raw = (conditions as { reminder_type?: unknown }).reminder_type;\n  return typeof raw === \"string\" ? raw : null;\n};\n\nexport interface WorkflowSummary {\n  id: string;\n  name: string;\n  description?: string | null;\n  delayMinutes?: number | null;\n  steps: WorkflowStep[];\n  triggerConditions?: WorkflowTriggerConditions;\n  reminderType?: string | null;\n  triggerType: TriggerType;\n}\n\nexport interface SessionWorkflowCatalog {\n  loading: boolean;\n  reminderWorkflows: WorkflowSummary[];\n  summaryEmailWorkflows: WorkflowSummary[];\n  otherWorkflows: WorkflowSummary[];\n  allWorkflows: WorkflowSummary[];\n  workflowMap: Record<string, WorkflowSummary>;\n  reload: () => Promise<void>;\n}\n\nconst SessionWorkflowContext = createContext<SessionWorkflowCatalog | undefined>(undefined);\n\nconst getDelayMinutes = (steps: WorkflowStep[]): number | null => {\n  if (!steps?.length) return null;\n  const delays = steps\n    .map((step) => step.delay_minutes ?? null)\n    .filter((value): value is number => value !== null);\n  if (!delays.length) return null;\n  return Math.min(...delays);\n};\n\nconst hasSummaryEmailStep = (workflow: WorkflowSummary) =>\n  workflow.steps.some((step) => {\n    if (step.action_type === \"send_email\") return true;\n    if (step.action_type === \"send_notification\") {\n      const channels = step.action_config?.channels as string[] | undefined;\n      return Array.isArray(channels) && channels.includes(\"email\");\n    }\n    return false;\n  });\n\nconst categorizeWorkflows = (workflows: WorkflowSummary[]) => {\n  const reminderIds = new Set<string>();\n  const summaryIds = new Set<string>();\n\n  const reminderWorkflows: WorkflowSummary[] = [];\n  const summaryWorkflows: WorkflowSummary[] = [];\n\n  for (const workflow of workflows) {\n    if (workflow.triggerType === \"session_reminder\") {\n      reminderIds.add(workflow.id);\n      reminderWorkflows.push(workflow);\n      continue;\n    }\n\n    if (workflow.triggerType === \"session_scheduled\" && hasSummaryEmailStep(workflow)) {\n      summaryIds.add(workflow.id);\n      summaryWorkflows.push(workflow);\n      continue;\n    }\n  }\n\n  const otherWorkflows = workflows.filter(\n    (workflow) => !reminderIds.has(workflow.id) && !summaryIds.has(workflow.id)\n  );\n\n  return {\n    reminderWorkflows,\n    summaryWorkflows,\n    otherWorkflows,\n  };\n};\n\nexport const SessionWorkflowProvider = ({ children }: { children: ReactNode }) => {\n  const { toast } = useToast();\n  const [loading, setLoading] = useState(true);\n  const [workflows, setWorkflows] = useState<WorkflowSummary[]>([]);\n\n  const loadWorkflows = useCallback(async () => {\n    try {\n      setLoading(true);\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) {\n        setWorkflows([]);\n        return;\n      }\n\n      const { data, error } = await supabase\n        .from(\"workflows\")\n        .select(\n          `\n            id,\n            name,\n            description,\n            trigger_type,\n            is_active,\n            workflow_steps (\n              id,\n              workflow_id,\n              step_order,\n              action_type,\n              action_config,\n              delay_minutes,\n              is_active\n            ),\n            trigger_conditions\n          `\n        )\n        .eq(\"organization_id\", organizationId)\n        .in(\"trigger_type\", [\"session_scheduled\", \"session_reminder\"])\n        .eq(\"is_active\", true)\n        .order(\"created_at\", { ascending: false });\n\n      if (error) throw error;\n\n      const summaries: WorkflowSummary[] =\n        data?.map((workflow: any) => {\n          const steps: WorkflowStep[] = (workflow.workflow_steps || []).filter(\n            (step: WorkflowStep) => step.is_active !== false\n          );\n\n          const stepReminderType =\n            steps.find((step) => typeof step.action_config?.reminder_type === \"string\")\n              ?.action_config?.reminder_type ?? null;\n          const reminderType =\n            getReminderType(workflow.trigger_conditions) ??\n            (typeof stepReminderType === \"string\" ? stepReminderType : null);\n          const delayMinutes = getDelayMinutes(steps);\n\n          return {\n            id: workflow.id,\n            name: workflow.name,\n            description: workflow.description,\n            delayMinutes,\n            steps,\n            triggerConditions: workflow.trigger_conditions ?? null,\n            reminderType,\n            triggerType: workflow.trigger_type as TriggerType,\n          };\n        }) ?? [];\n\n      setWorkflows(summaries);\n    } catch (error) {\n      console.error(\"Failed to load session workflows\", error);\n      toast({\n        title: \"Error\",\n        description: \"Unable to load notification workflows.\",\n        variant: \"destructive\",\n      });\n      setWorkflows([]);\n    } finally {\n      setLoading(false);\n    }\n  }, [toast]);\n\n  useEffect(() => {\n    void loadWorkflows();\n  }, [loadWorkflows]);\n\n  const catalog = useMemo<SessionWorkflowCatalog>(() => {\n    const { reminderWorkflows, summaryWorkflows, otherWorkflows } = categorizeWorkflows(workflows);\n    const workflowMap = Object.fromEntries(workflows.map((workflow) => [workflow.id, workflow]));\n\n    return {\n      loading,\n      reminderWorkflows,\n      summaryEmailWorkflows: summaryWorkflows,\n      otherWorkflows,\n      allWorkflows: workflows,\n      workflowMap,\n      reload: loadWorkflows,\n    };\n  }, [loading, workflows, loadWorkflows]);\n\n  return (\n    <SessionWorkflowContext.Provider value={catalog}>\n      {children}\n    </SessionWorkflowContext.Provider>\n  );\n};\n\nexport const useSessionWorkflowCatalog = () => {\n  const context = useContext(SessionWorkflowContext);\n  if (!context) {\n    throw new Error(\"useSessionWorkflowCatalog must be used within a SessionWorkflowProvider\");\n  }\n  return context;\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/hooks/useSessionPlanningActions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/hooks/useSessionPlanningContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/hooks/useSessionPlanningEntryContext.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/state/__tests__/SessionPlanningProvider.integration.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/state/__tests__/SessionPlanningReducer.startStep.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/state/sessionPlanningReducer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/steps/LeadStep.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3027,3030],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3027,3030],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { EnhancedAddLeadDialog } from \"@/components/EnhancedAddLeadDialog\";\nimport { useSessionPlanningActions } from \"../hooks/useSessionPlanningActions\";\nimport { useSessionPlanningContext } from \"../hooks/useSessionPlanningContext\";\nimport { useTranslation } from \"react-i18next\";\nimport { useToast } from \"@/components/ui/use-toast\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\nimport { Check, ChevronDown, Loader2, Search, UserPlus } from \"lucide-react\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { cn } from \"@/lib/utils\";\nimport { LeadStatusBadge } from \"@/components/LeadStatusBadge\";\nimport { useLeadStatuses } from \"@/hooks/useOrganizationData\";\nimport { LeadInitials } from \"@/components/LeadInitials\";\n\ninterface LeadOption {\n  id: string;\n  name: string;\n  email?: string;\n  phone?: string;\n  status?: string | null;\n  status_id?: string | null;\n}\n\nexport const LeadStep = () => {\n  const { state } = useSessionPlanningContext();\n  const { updateLead } = useSessionPlanningActions();\n  const { t } = useTranslation(\"sessionPlanning\");\n  const { toast } = useToast();\n  const [leadOptions, setLeadOptions] = useState<LeadOption[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [hasLoadedOnce, setHasLoadedOnce] = useState(false);\n  const [dropdownOpen, setDropdownOpen] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [createLeadOpen, setCreateLeadOpen] = useState(false);\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const latestRequestRef = useRef(0);\n  const { data: leadStatuses = [], isLoading: leadStatusesLoading } = useLeadStatuses();\n\n  const loadLeads = useCallback(\n    async (term: string) => {\n      const requestId = ++latestRequestRef.current;\n      setLoading(true);\n      try {\n        const organizationId = await getUserOrganizationId();\n        if (!organizationId) {\n          if (latestRequestRef.current === requestId) {\n            setLeadOptions([]);\n          }\n          return;\n        }\n\n        const sanitized = term.trim().replace(/[%_]/g, \"\\\\$&\");\n        let query = supabase\n          .from(\"leads\")\n          .select(\"id, name, email, phone, status, status_id\")\n          .eq(\"organization_id\", organizationId)\n          .order(\"updated_at\", { ascending: false })\n          .limit(25);\n\n        if (sanitized) {\n          const filter = `name.ilike.%${sanitized}%,email.ilike.%${sanitized}%,phone.ilike.%${sanitized}%`;\n          query = query.or(filter);\n        }\n\n        const { data, error } = await query;\n        if (error) throw error;\n\n        if (latestRequestRef.current === requestId) {\n          setLeadOptions((data as LeadOption[]) || []);\n        }\n      } catch (error: any) {\n        console.error(\"Failed to load leads\", error);\n        if (latestRequestRef.current === requestId) {\n          setLeadOptions([]);\n          setHasLoadedOnce(true);\n        }\n        toast({\n          title: t(\"steps.lead.fetchErrorTitle\"),\n          description: error.message,\n          variant: \"destructive\",\n        });\n      } finally {\n        if (latestRequestRef.current === requestId) {\n          setLoading(false);\n          setHasLoadedOnce(true);\n        }\n      }\n    },\n    [toast, t]\n  );\n\n  useEffect(() => {\n    loadLeads(\"\");\n  }, [loadLeads]);\n\n  useEffect(() => {\n    if (!dropdownOpen) return;\n    const handler = window.setTimeout(() => {\n      loadLeads(searchTerm);\n    }, 250);\n    return () => {\n      window.clearTimeout(handler);\n    };\n  }, [dropdownOpen, searchTerm, loadLeads]);\n\n  useEffect(() => {\n    if (!dropdownOpen) return;\n    const handlePointerDown = (event: PointerEvent) => {\n      if (\n        containerRef.current &&\n        !containerRef.current.contains(event.target as Node)\n      ) {\n        setDropdownOpen(false);\n      }\n    };\n    document.addEventListener(\"pointerdown\", handlePointerDown);\n    return () => {\n      document.removeEventListener(\"pointerdown\", handlePointerDown);\n    };\n  }, [dropdownOpen]);\n\n  const selectedLeadOption = useMemo(() => {\n    if (!state.lead.id) return undefined;\n    return leadOptions.find((lead) => lead.id === state.lead.id);\n  }, [leadOptions, state.lead.id]);\n\n  const handleAssignLead = (lead: LeadOption) => {\n    updateLead({\n      id: lead.id,\n      name: lead.name,\n      email: lead.email,\n      phone: lead.phone,\n      notes: \"\",\n      mode: \"existing\"\n    });\n    setDropdownOpen(false);\n    setSearchTerm(\"\");\n  };\n\n  const handleLeadCreated = (lead: { id: string; name: string; email?: string | null; phone?: string | null; status?: string | null; status_id?: string | null }) => {\n    setCreateLeadOpen(false);\n    const normalized: LeadOption = {\n      id: lead.id,\n      name: lead.name,\n      email: lead.email || undefined,\n      phone: lead.phone || undefined,\n      status: lead.status || undefined,\n      status_id: lead.status_id || undefined\n    };\n    setLeadOptions((prev) => {\n      const without = prev.filter((item) => item.id !== lead.id);\n      return [normalized, ...without];\n    });\n    handleAssignLead(normalized);\n    void loadLeads(\"\");\n  };\n\n  const showInitialLoading = loading && !hasLoadedOnce && leadOptions.length === 0;\n  const showEmptyState = !loading && hasLoadedOnce && leadOptions.length === 0;\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"space-y-2\">\n        <h2 className=\"text-xl font-semibold tracking-tight\">{t(\"steps.lead.navigationLabel\")}</h2>\n        <p className=\"text-sm text-muted-foreground\">{t(\"steps.lead.description\")}</p>\n      </div>\n\n      <div className=\"space-y-3\">\n        <Label className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\">\n          {t(\"steps.lead.selectExisting\")}\n        </Label>\n        <div className=\"relative\" ref={containerRef}>\n          <Button\n            type=\"button\"\n            onClick={() => setDropdownOpen((prev) => !prev)}\n            className={cn(\n              \"group flex h-12 w-full items-center justify-between rounded-xl border border-border/70 bg-white px-4 py-3 text-left font-semibold text-slate-900 shadow-sm transition hover:border-emerald-400/70 hover:shadow-md focus-visible:ring-2 focus-visible:ring-emerald-300\",\n              dropdownOpen && \"border-emerald-400/80 shadow-emerald-200\",\n              loading && leadOptions.length === 0 && \"cursor-wait opacity-70\"\n            )}\n            disabled={loading && leadOptions.length === 0}\n          >\n            {selectedLeadOption ? (\n              <div className=\"flex w-full items-center justify-between gap-3\">\n                <LeadSummaryPreview\n                  lead={selectedLeadOption}\n                  textColor=\"text-slate-900\"\n                  subtleColor=\"text-muted-foreground\"\n                />\n                {selectedLeadOption.status || selectedLeadOption.status_id ? (\n                  <LeadStatusBadge\n                    leadId={selectedLeadOption.id}\n                    currentStatusId={selectedLeadOption.status_id ?? undefined}\n                    currentStatus={selectedLeadOption.status ?? undefined}\n                    editable={false}\n                    size=\"sm\"\n                    statuses={leadStatuses}\n                    statusesLoading={leadStatusesLoading}\n                  />\n                ) : null}\n              </div>\n            ) : loading && !hasLoadedOnce ? (\n              t(\"steps.lead.loading\")\n            ) : (\n              t(\"steps.lead.selectPlaceholder\")\n            )}\n            <ChevronDown className=\"ml-2 h-4 w-4 shrink-0 text-muted-foreground transition group-data-[state=open]:rotate-180\" />\n          </Button>\n\n          {dropdownOpen && (\n            <div className=\"absolute top-full left-0 right-0 z-50 mt-2 overflow-hidden rounded-2xl border border-border bg-background shadow-xl\">\n              <div className=\"px-4 py-3\">\n                <div className=\"relative\">\n                  <Search className=\"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n                  <Input\n                    value={searchTerm}\n                    onChange={(event) => setSearchTerm(event.target.value)}\n                    placeholder={t(\"steps.lead.searchPlaceholder\")}\n                    className=\"h-11 rounded-xl border border-border bg-white pl-9 text-sm shadow-inner focus:border-emerald-400 focus:ring-2 focus:ring-emerald-100\"\n                    autoFocus\n                  />\n                </div>\n              </div>\n              <div className=\"relative max-h-64 min-h-[10rem] overflow-y-auto border-t border-border/80 bg-white\">\n                {showInitialLoading ? (\n                  <div className=\"flex h-full flex-col items-center justify-center gap-2 px-4 py-6 text-sm text-muted-foreground\">\n                    <Loader2 className=\"h-4 w-4 animate-spin text-emerald-500\" />\n                    {t(\"steps.lead.loading\")}\n                  </div>\n                ) : showEmptyState ? (\n                  <p className=\"px-4 py-6 text-center text-sm text-muted-foreground\">\n                    {searchTerm ? t(\"steps.lead.noResults\") : t(\"steps.lead.emptyState\")}\n                  </p>\n                ) : (\n                  <>\n                    {loading && (\n                      <div className=\"sticky top-0 flex items-center gap-2 bg-white/95 px-4 py-2 text-xs text-muted-foreground backdrop-blur\">\n                        <Loader2 className=\"h-3.5 w-3.5 animate-spin\" />\n                        {t(\"steps.lead.loading\")}\n                      </div>\n                    )}\n                    <div className=\"divide-y\">\n                      {leadOptions.map((lead) => {\n                        const isActive = state.lead.id === lead.id;\n                        return (\n                          <button\n                            key={lead.id}\n                            type=\"button\"\n                            onClick={() => handleAssignLead(lead)}\n                            className={cn(\n                              \"flex w-full items-center justify-between px-4 py-3 text-left transition hover:bg-muted/60\",\n                              isActive && \"bg-emerald-100/40\"\n                            )}\n                          >\n                            <div className=\"flex items-center gap-3\">\n                              <Avatar className=\"h-9 w-9 border border-border/70 bg-muted shadow-sm\">\n                                <AvatarFallback className=\"text-sm font-semibold uppercase text-slate-700\">\n                                  <LeadInitials name={lead.name} fallback=\"?\" maxInitials={2} />\n                                </AvatarFallback>\n                              </Avatar>\n                              <div className=\"flex flex-col\">\n                                <span className=\"text-sm font-semibold text-slate-900\">\n                                  {lead.name}\n                                </span>\n                                {(lead.email || lead.phone) && (\n                                  <span className=\"text-xs text-muted-foreground\">\n                                    {[lead.email, lead.phone]\n                                      .filter(Boolean)\n                                      .join(\" â€¢ \")}\n                                  </span>\n                                )}\n                              </div>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              {(lead.status || lead.status_id) ? (\n                                <LeadStatusBadge\n                                  leadId={lead.id}\n                                  currentStatusId={lead.status_id ?? undefined}\n                                  currentStatus={lead.status ?? undefined}\n                                  editable={false}\n                                  size=\"sm\"\n                                  statuses={leadStatuses}\n                                  statusesLoading={leadStatusesLoading}\n                                />\n                              ) : null}\n                              <Check\n                                className={cn(\n                                  \"h-4 w-4 text-emerald-500 transition\",\n                                  isActive ? \"opacity-100\" : \"opacity-0\"\n                                )}\n                              />\n                            </div>\n                          </button>\n                        );\n                      })}\n                    </div>\n                  </>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n\n        <Button\n          variant=\"outline\"\n          className=\"gap-2\"\n          onClick={() => setCreateLeadOpen(true)}\n        >\n          <UserPlus className=\"h-4 w-4\" />\n          {t(\"steps.lead.createButton\")}\n        </Button>\n\n        {leadOptions.length === 0 && !loading && (\n          <p className=\"text-xs text-muted-foreground\">{t(\"steps.lead.emptyState\")}</p>\n        )}\n      </div>\n\n      <EnhancedAddLeadDialog\n        open={createLeadOpen}\n        onOpenChange={setCreateLeadOpen}\n        onClose={() => setCreateLeadOpen(false)}\n        onSuccess={handleLeadCreated}\n      />\n    </div>\n  );\n};\n\nconst LeadSummaryPreview = ({\n  lead,\n  textColor = \"text-foreground\",\n  subtleColor = \"text-muted-foreground\",\n}: {\n  lead: LeadOption;\n  textColor?: string;\n  subtleColor?: string;\n}) => {\n  return (\n    <div className=\"flex w-full items-center gap-3\">\n      <Avatar className=\"h-9 w-9 border border-border/60 bg-muted shadow-sm\">\n        <AvatarFallback className=\"text-xs font-semibold uppercase text-slate-700\">\n          <LeadInitials name={lead.name} fallback=\"?\" maxInitials={2} />\n        </AvatarFallback>\n      </Avatar>\n      <div className=\"flex flex-col\">\n        <span className={cn(\"text-sm font-medium\", textColor)}>{lead.name}</span>\n        {(lead.email || lead.phone) && (\n          <span className={cn(\"text-xs\", subtleColor)}>\n            {[lead.email, lead.phone].filter(Boolean).join(\" â€¢ \")}\n          </span>\n        )}\n      </div>\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/steps/LocationStep.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":171,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5024,5027],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5024,5027],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":233,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7011,7014],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7011,7014],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useRef, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Collapsible,\n  CollapsibleContent,\n} from \"@/components/ui/collapsible\";\nimport { useToast } from \"@/components/ui/use-toast\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  createSavedLocation,\n  deleteSavedLocation,\n  SavedLocationRecord,\n  updateSavedLocation,\n} from \"../api/savedResources\";\nimport { useSessionPlanningContext } from \"../hooks/useSessionPlanningContext\";\nimport { useSessionPlanningActions } from \"../hooks/useSessionPlanningActions\";\nimport { MapPin, Pencil, Plus, Trash2 } from \"lucide-react\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useSessionSavedResources } from \"../context/SessionSavedResourcesProvider\";\n\ntype LocationFormMode =\n  | { type: \"create\" }\n  | { type: \"edit\"; id: string }\n  | { type: \"hidden\" };\n\nexport const LocationStep = () => {\n  const { state } = useSessionPlanningContext();\n  const { updateSessionFields } = useSessionPlanningActions();\n  const { t } = useTranslation([\"sessionPlanning\", \"common\"]);\n  const { toast } = useToast();\n  const {\n    savedLocations,\n    savedLocationsLoading,\n    savedLocationsError,\n    savedLocationsLoaded,\n    updateSavedLocations,\n    reloadSavedLocations,\n    setSavedLocationsError,\n  } = useSessionSavedResources();\n\n  const [formMode, setFormMode] = useState<LocationFormMode>({\n    type: \"hidden\",\n  });\n  const [formValues, setFormValues] = useState({\n    label: \"\",\n    address: \"\",\n    meetingUrl: \"\",\n  });\n\n  const [customOpen, setCustomOpen] = useState(false);\n\n  const selectedLocationId = state.locationId;\n\n  const initialHydrationRef = useRef(false);\n  const customToggleRef = useRef(false);\n\n  useEffect(() => {\n    if (!savedLocationsLoaded) {\n      return;\n    }\n\n    if (savedLocations.length === 0) {\n      customToggleRef.current = false;\n      setFormMode((prev) =>\n        prev.type === \"edit\" ? prev : { type: \"create\" }\n      );\n      setCustomOpen(true);\n      return;\n    }\n\n    if (!initialHydrationRef.current) {\n      initialHydrationRef.current = true;\n      if (!state.locationId) {\n        const [latestLocation] = [...savedLocations].sort((a, b) =>\n          a.updatedAt < b.updatedAt ? 1 : a.updatedAt > b.updatedAt ? -1 : 0\n        );\n\n        if (latestLocation) {\n          updateSessionFields({\n            locationId: latestLocation.id,\n            locationLabel: latestLocation.label,\n            location: latestLocation.address,\n            meetingUrl: latestLocation.meetingUrl ?? \"\",\n          });\n        }\n      }\n      setFormMode({ type: \"hidden\" });\n      setCustomOpen(false);\n    }\n  }, [savedLocationsLoaded, savedLocations.length, savedLocations, state.locationId, updateSessionFields]);\n\n  useEffect(() => {\n    if (!savedLocationsLoaded) return;\n    if (!state.locationId) {\n      const hasCustomDraft =\n        (state.location && state.location.trim().length > 0) ||\n        (state.meetingUrl && state.meetingUrl.trim().length > 0);\n      if (hasCustomDraft && !customToggleRef.current) {\n        setCustomOpen(true);\n      }\n    }\n  }, [\n    savedLocationsLoaded,\n    state.locationId,\n    state.location,\n    state.meetingUrl,\n  ]);\n\n  const handleToggleCustom = () => {\n    setCustomOpen((prev) => {\n      const next = !prev;\n      customToggleRef.current = true;\n      if (!prev) {\n        updateSessionFields({\n          locationId: undefined,\n          locationLabel: undefined,\n        });\n      }\n      return next;\n    });\n  };\n\n  const resetForm = () => {\n    setFormValues({ label: \"\", address: \"\", meetingUrl: \"\" });\n    setFormMode({ type: \"hidden\" });\n  };\n\n  const handleSelectLocation = (location: SavedLocationRecord) => {\n    updateSessionFields({\n      locationId: location.id,\n      locationLabel: location.label,\n      location: location.address,\n      meetingUrl: location.meetingUrl ?? \"\",\n    });\n  };\n\n  const handleStartCreate = () => {\n    setFormValues({ label: \"\", address: \"\", meetingUrl: \"\" });\n    setFormMode({ type: \"create\" });\n  };\n\n  const handleStartEdit = (location: SavedLocationRecord) => {\n    setFormValues({\n      label: location.label,\n      address: location.address,\n      meetingUrl: location.meetingUrl ?? \"\",\n    });\n    setFormMode({ type: \"edit\", id: location.id });\n  };\n\n  const handleDeleteLocation = async (id: string) => {\n    try {\n      await deleteSavedLocation(id);\n      updateSavedLocations((current) =>\n        current.filter((item) => item.id !== id)\n      );\n      if (state.locationId === id) {\n        updateSessionFields({\n          locationId: undefined,\n          locationLabel: undefined,\n        });\n      }\n      toast({\n        title: t(\"steps.location.toastDeletedTitle\"),\n        description: t(\"steps.location.toastDeletedDescription\"),\n      });\n    } catch (error: any) {\n      console.error(\"Failed to delete location\", error);\n      toast({\n        title: t(\"steps.location.toastErrorTitle\"),\n        description: error?.message ?? t(\"steps.location.toastErrorDescription\"),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleSubmitLocation = async () => {\n    const payload = {\n      label: formValues.label.trim(),\n      address: formValues.address.trim(),\n      meetingUrl: formValues.meetingUrl.trim(),\n    };\n\n    if (!payload.label || !payload.address) {\n      toast({\n        title: t(\"steps.location.toastValidationTitle\"),\n        description: t(\"steps.location.toastValidationDescription\"),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (payload.meetingUrl && !/^https?:\\/\\//i.test(payload.meetingUrl)) {\n      toast({\n        title: t(\"steps.location.toastValidationTitle\"),\n        description: t(\"steps.location.invalidMeetingUrl\"),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      let location: SavedLocationRecord;\n      if (formMode.type === \"edit\") {\n        location = await updateSavedLocation(formMode.id, payload);\n        updateSavedLocations((current) =>\n          current.map((item) => (item.id === location.id ? location : item))\n        );\n      } else {\n        location = await createSavedLocation(payload);\n        updateSavedLocations((current) => {\n          const without = current.filter((item) => item.id !== location.id);\n          return [location, ...without];\n        });\n      }\n      setSavedLocationsError(null);\n      handleSelectLocation(location);\n      resetForm();\n      toast({\n        title:\n          formMode.type === \"edit\"\n            ? t(\"steps.location.toastUpdatedTitle\")\n            : t(\"steps.location.toastSavedTitle\"),\n        description:\n          formMode.type === \"edit\"\n            ? t(\"steps.location.toastUpdatedDescription\")\n            : t(\"steps.location.toastSavedDescription\"),\n      });\n    } catch (error: any) {\n      console.error(\"Failed to save location\", error);\n      toast({\n        title: t(\"steps.location.toastErrorTitle\"),\n        description: error?.message ?? t(\"steps.location.toastErrorDescription\"),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const sortedLocations = useMemo(() => {\n    return [...savedLocations].sort((a, b) =>\n      a.createdAt < b.createdAt ? 1 : a.createdAt > b.createdAt ? -1 : 0\n    );\n  }, [savedLocations]);\n\n  const renderSavedLocations = () => {\n    if (savedLocationsLoading && savedLocations.length === 0) {\n      return (\n        <div className=\"space-y-3\">\n          {Array.from({ length: 3 }).map((_, index) => (\n            <div\n              key={index}\n              className=\"flex items-start justify-between gap-3 rounded-2xl border border-slate-200 bg-white px-4 py-3 shadow-sm\"\n            >\n              <Skeleton className=\"h-10 w-10 rounded-full\" />\n              <div className=\"flex flex-1 flex-col gap-2\">\n                <Skeleton className=\"h-4 w-40\" />\n                <Skeleton className=\"h-3 w-full\" />\n                <Skeleton className=\"h-3 w-1/2\" />\n              </div>\n              <div className=\"flex gap-2\">\n                <Skeleton className=\"h-8 w-8 rounded-full\" />\n                <Skeleton className=\"h-8 w-8 rounded-full\" />\n              </div>\n            </div>\n          ))}\n        </div>\n      );\n    }\n\n    if (savedLocationsError) {\n      return (\n        <div className=\"rounded-2xl border border-destructive/30 bg-destructive/5 p-4 text-sm text-destructive\">\n          <div className=\"flex items-center justify-between gap-3\">\n            <span>{savedLocationsError}</span>\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 px-3 text-xs text-destructive hover:bg-destructive/10 hover:text-destructive\"\n              onClick={() => {\n                setSavedLocationsError(null);\n                void reloadSavedLocations();\n              }}\n            >\n              {t(\"common:tryAgain\")}\n            </Button>\n          </div>\n        </div>\n      );\n    }\n\n    if (sortedLocations.length === 0) {\n      return (\n        <div className=\"rounded-2xl border border-dashed border-slate-300 bg-white/80 p-4 text-sm text-muted-foreground\">\n          {t(\"steps.location.emptyState\")}\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"space-y-3\">\n        {sortedLocations.map((location) => {\n          const isActive = selectedLocationId === location.id;\n          return (\n            <div\n              key={location.id}\n              className={cn(\n                \"flex items-start justify-between gap-3 rounded-2xl border px-4 py-3 transition\",\n                isActive\n                  ? \"border-primary/60 bg-primary/10 shadow\"\n                  : \"border-slate-200 bg-white hover:border-primary/30 hover:bg-primary/5\"\n              )}\n            >\n              <button\n                type=\"button\"\n                onClick={() => handleSelectLocation(location)}\n                className=\"flex flex-1 flex-col items-start text-left\"\n              >\n                <span className=\"flex items-center gap-2 text-sm font-semibold text-slate-900\">\n                  <MapPin className=\"h-4 w-4 text-primary\" />\n                  {location.label}\n                </span>\n                <span className=\"mt-1 text-xs text-muted-foreground\">\n                  {location.address}\n                </span>\n                {location.meetingUrl ? (\n                  <span className=\"mt-1 text-xs font-medium text-primary\">\n                    {location.meetingUrl}\n                  </span>\n                ) : null}\n              </button>\n              <div className=\"flex gap-1\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"h-8 w-8 text-muted-foreground hover:bg-primary/10 hover:text-primary\"\n                  onClick={() => handleStartEdit(location)}\n                  aria-label={t(\"steps.location.editLocation\")}\n                >\n                  <Pencil className=\"h-4 w-4\" />\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"h-8 w-8 text-muted-foreground hover:bg-destructive/10 hover:text-destructive\"\n                  onClick={() => handleDeleteLocation(location.id)}\n                  aria-label={t(\"steps.location.deleteLocation\")}\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    );\n  };\n\n  const renderForm = () => (\n    <Collapsible open={formMode.type !== \"hidden\"}>\n      <CollapsibleContent className=\"mt-4 space-y-4 rounded-2xl border border-dashed border-slate-300 bg-white/90 p-5 data-[state=closed]:animate-collapse-up data-[state=open]:animate-collapse-down\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h3 className=\"text-sm font-semibold text-slate-900\">\n              {formMode.type === \"edit\"\n                ? t(\"steps.location.editHeading\")\n                : t(\"steps.location.addNewHeading\")}\n            </h3>\n            <p className=\"text-xs text-muted-foreground\">\n              {formMode.type === \"edit\"\n                ? t(\"steps.location.editDescription\")\n                : t(\"steps.location.addNewDescription\")}\n            </p>\n          </div>\n          {formMode.type !== \"hidden\" && savedLocations.length > 0 ? (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={resetForm}\n              className=\"h-7 px-3 text-xs text-muted-foreground hover:text-primary\"\n            >\n              {t(\"steps.location.cancel\")}\n            </Button>\n          ) : null}\n        </div>\n\n        <div className=\"grid gap-3\">\n          <div className=\"grid gap-2\">\n            <Label\n              htmlFor=\"location-form-label\"\n              className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\"\n            >\n              {t(\"steps.location.newLabel\")}\n            </Label>\n            <Input\n              id=\"location-form-label\"\n              placeholder={t(\"steps.location.newLabelPlaceholder\")}\n              value={formValues.label}\n              onChange={(event) =>\n                setFormValues((prev) => ({\n                  ...prev,\n                  label: event.target.value,\n                }))\n              }\n            />\n          </div>\n\n          <div className=\"grid gap-2\">\n            <Label\n              htmlFor=\"location-form-address\"\n              className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\"\n            >\n              {t(\"steps.location.newAddress\")}\n            </Label>\n            <Textarea\n              id=\"location-form-address\"\n              rows={3}\n              className=\"resize-none\"\n              placeholder={t(\"steps.location.newAddressPlaceholder\")}\n              value={formValues.address}\n              onChange={(event) =>\n                setFormValues((prev) => ({\n                  ...prev,\n                  address: event.target.value,\n                }))\n              }\n            />\n          </div>\n\n          <div className=\"grid gap-2\">\n            <Label\n              htmlFor=\"location-form-meeting-url\"\n              className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\"\n            >\n              {t(\"steps.location.newMeetingUrl\")}\n            </Label>\n            <Input\n              id=\"location-form-meeting-url\"\n              placeholder={t(\"steps.location.meetingUrlPlaceholder\")}\n              value={formValues.meetingUrl}\n              onChange={(event) =>\n                setFormValues((prev) => ({\n                  ...prev,\n                  meetingUrl: event.target.value,\n                }))\n              }\n            />\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <Button\n              type=\"button\"\n              className=\"gap-2\"\n              onClick={handleSubmitLocation}\n            >\n              <Plus className=\"h-4 w-4\" />\n              {formMode.type === \"edit\"\n                ? t(\"steps.location.updateLocation\")\n                : t(\"steps.location.saveLocation\")}\n            </Button>\n            <p className=\"text-xs text-muted-foreground\">\n              {t(\"steps.location.quickApplyHint\")}\n            </p>\n          </div>\n        </div>\n      </CollapsibleContent>\n    </Collapsible>\n  );\n\n  const renderCustomForm = (alwaysOpen: boolean) => (\n    <Collapsible\n      open={alwaysOpen ? true : customOpen}\n      onOpenChange={setCustomOpen}\n    >\n      <CollapsibleContent className=\"mt-4 space-y-4 rounded-2xl border border-slate-200 bg-white/80 p-5 data-[state=closed]:animate-collapse-up data-[state=open]:animate-collapse-down\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h3 className=\"text-sm font-semibold text-slate-900\">\n              {t(\"steps.location.customHeading\")}\n            </h3>\n            <p className=\"text-xs text-muted-foreground\">\n              {t(\"steps.location.customDescription\")}\n            </p>\n          </div>\n          {!alwaysOpen ? (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 px-3 text-xs text-muted-foreground hover:text-primary\"\n              onClick={handleToggleCustom}\n            >\n              {t(\"steps.location.closeCustom\")}\n            </Button>\n          ) : null}\n        </div>\n        <div className=\"grid gap-3\">\n          <div className=\"grid gap-2\">\n            <Label\n              htmlFor=\"custom-location-address\"\n              className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\"\n            >\n              {t(\"steps.location.addressLabel\")}\n            </Label>\n            <Textarea\n              id=\"custom-location-address\"\n              rows={3}\n              className=\"resize-none\"\n              placeholder={t(\"steps.location.addressPlaceholder\")}\n              value={state.location ?? \"\"}\n              onChange={(event) =>\n                updateSessionFields({\n                  locationId: undefined,\n                  locationLabel: undefined,\n                  location: event.target.value,\n                })\n              }\n            />\n          </div>\n          <div className=\"grid gap-2\">\n            <Label\n              htmlFor=\"custom-location-url\"\n              className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\"\n            >\n              {t(\"steps.location.meetingUrlLabel\")}\n            </Label>\n            <Input\n              id=\"custom-location-url\"\n              placeholder={t(\"steps.location.meetingUrlPlaceholder\")}\n              value={state.meetingUrl ?? \"\"}\n              onChange={(event) =>\n                updateSessionFields({\n                  locationId: undefined,\n                  locationLabel: undefined,\n                  meetingUrl: event.target.value,\n                })\n              }\n            />\n          </div>\n        </div>\n      </CollapsibleContent>\n    </Collapsible>\n  );\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"space-y-2\">\n        <h2 className=\"text-xl font-semibold tracking-tight\">\n          {t(\"steps.location.navigationLabel\")}\n        </h2>\n        <p className=\"text-sm text-muted-foreground\">\n          {t(\"steps.location.description\")}\n        </p>\n        <div className=\"rounded-xl border border-amber-200 bg-amber-50 px-4 py-3 text-xs text-amber-900\">\n          {t(\"steps.location.clientFacingHelper\")}\n        </div>\n      </div>\n\n      {renderSavedLocations()}\n\n      {savedLocations.length > 0 ? (\n        <div className=\"flex flex-wrap items-center gap-3\">\n          <Button\n            variant=\"outline\"\n            className=\"h-11 gap-2\"\n            onClick={\n              formMode.type === \"hidden\" ? handleStartCreate : resetForm\n            }\n          >\n            <Plus className=\"h-4 w-4\" />\n            {formMode.type === \"hidden\"\n              ? t(\"steps.location.addButton\")\n              : t(\"steps.location.cancel\")}\n          </Button>\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            className=\"h-11 px-4 text-sm font-medium text-muted-foreground transition hover:bg-emerald-50 hover:text-emerald-600\"\n            onClick={handleToggleCustom}\n          >\n            {customOpen\n              ? t(\"steps.location.closeCustom\")\n              : t(\"steps.location.customButton\")}\n          </Button>\n        </div>\n      ) : null}\n\n      {renderForm()}\n\n      {savedLocations.length === 0 ? (\n        <p className=\"text-xs text-muted-foreground\">\n          {t(\"steps.location.noSavedReminder\")}\n        </p>\n      ) : null}\n\n      {renderCustomForm(savedLocations.length === 0)}\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/steps/NotesStep.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3120,3123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3120,3123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":127,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4152,4155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4152,4155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useState } from \"react\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Collapsible,\n  CollapsibleContent,\n} from \"@/components/ui/collapsible\";\nimport { useToast } from \"@/components/ui/use-toast\";\nimport { useSessionPlanningActions } from \"../hooks/useSessionPlanningActions\";\nimport { useSessionPlanningContext } from \"../hooks/useSessionPlanningContext\";\nimport { useTranslation } from \"react-i18next\";\nimport { Plus, Trash2 } from \"lucide-react\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  createSavedNotePreset,\n  deleteSavedNotePreset,\n  SavedNotePresetRecord,\n} from \"../api/savedResources\";\nimport { useSessionSavedResources } from \"../context/SessionSavedResourcesProvider\";\nimport { sanitizeNotesInput } from \"../utils/sanitizeNotes\";\n\nexport const NotesStep = () => {\n  const { state } = useSessionPlanningContext();\n  const { updateSessionFields } = useSessionPlanningActions();\n  const { t } = useTranslation([\"sessionPlanning\", \"common\"]);\n  const { toast } = useToast();\n  const {\n    savedNotes,\n    savedNotesLoading,\n    savedNotesError,\n    savedNotesLoaded,\n    updateSavedNotes,\n    reloadSavedNotes,\n    setSavedNotesError,\n  } = useSessionSavedResources();\n  const [newPreset, setNewPreset] = useState({\n    title: \"\",\n    body: \"\",\n  });\n  const [newPresetOpen, setNewPresetOpen] = useState(false);\n  const [presetHydrated, setPresetHydrated] = useState(false);\n\n  useEffect(() => {\n    if (!state.notes) return;\n    const sanitized = sanitizeNotesInput(state.notes);\n    if (sanitized !== state.notes) {\n      updateSessionFields({ notes: sanitized });\n    }\n  }, [state.notes, updateSessionFields]);\n\n  useEffect(() => {\n    if (!savedNotesLoaded) {\n      return;\n    }\n\n    if (!presetHydrated) {\n      setPresetHydrated(true);\n      setNewPresetOpen(savedNotes.length === 0);\n      return;\n    }\n\n    if (savedNotes.length === 0) {\n      setNewPresetOpen(true);\n    }\n  }, [savedNotesLoaded, savedNotes.length, presetHydrated]);\n\n  const sortedNotes = useMemo(() => {\n    return [...savedNotes].sort((a, b) =>\n      a.createdAt < b.createdAt ? 1 : a.createdAt > b.createdAt ? -1 : 0\n    );\n  }, [savedNotes]);\n\n  const handleApplyPreset = (preset: SavedNotePresetRecord) => {\n    const existingNotes = state.notes?.trim() ?? \"\";\n    const addition = preset.body.trim();\n    const nextNotes = existingNotes\n      ? `${existingNotes}\\n\\n${addition}`\n      : addition;\n    updateSessionFields({\n      notes: sanitizeNotesInput(nextNotes),\n    });\n  };\n\n  const handleDeletePreset = async (presetId: string) => {\n    try {\n      await deleteSavedNotePreset(presetId);\n      updateSavedNotes((current) =>\n        current.filter((preset) => preset.id !== presetId)\n      );\n      toast({\n        title: t(\"steps.notes.toastDeletedTitle\"),\n        description: t(\"steps.notes.toastDeletedDescription\"),\n      });\n    } catch (error: any) {\n      console.error(\"Failed to delete note preset\", error);\n      toast({\n        title: t(\"steps.notes.toastErrorTitle\"),\n        description: error?.message ?? t(\"steps.notes.toastErrorDescription\"),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const canSavePreset =\n    newPreset.title.trim().length > 0 && newPreset.body.trim().length > 0;\n\n  const handleSavePreset = async () => {\n    if (!canSavePreset) return;\n    try {\n      const sanitizedTitle = sanitizeNotesInput(newPreset.title).trim();\n      const sanitizedBody = sanitizeNotesInput(newPreset.body).trim();\n      const preset = await createSavedNotePreset({\n        title: sanitizedTitle,\n        body: sanitizedBody,\n      });\n      updateSavedNotes((current) => [preset, ...current]);\n      setSavedNotesError(null);\n      setNewPreset({ title: \"\", body: \"\" });\n      setNewPresetOpen(false);\n      toast({\n        title: t(\"steps.notes.toastSavedTitle\"),\n        description: t(\"steps.notes.toastSavedDescription\"),\n      });\n    } catch (error: any) {\n      console.error(\"Failed to save note preset\", error);\n      toast({\n        title: t(\"steps.notes.toastErrorTitle\"),\n        description: error?.message ?? t(\"steps.notes.toastErrorDescription\"),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"space-y-2\">\n        <h2 className=\"text-xl font-semibold tracking-tight\">\n          {t(\"steps.notes.navigationLabel\")}\n        </h2>\n        <p className=\"text-sm text-muted-foreground\">\n          {t(\"steps.notes.description\")}\n        </p>\n        <div className=\"rounded-xl border border-amber-200 bg-amber-50 px-4 py-3 text-xs text-amber-900\">\n          {t(\"steps.notes.clientFacingHelper\")}\n        </div>\n      </div>\n\n      {savedNotesLoading && savedNotes.length === 0 ? (\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <Skeleton className=\"h-3 w-24 rounded-full\" />\n            <Skeleton className=\"h-3 w-16 rounded-full\" />\n          </div>\n          <div className=\"flex flex-wrap gap-2\">\n            {Array.from({ length: 4 }).map((_, index) => (\n              <Skeleton key={index} className=\"h-8 w-28 rounded-full\" />\n            ))}\n          </div>\n        </div>\n      ) : savedNotesError ? (\n        <div className=\"rounded-2xl border border-destructive/30 bg-destructive/5 p-4 text-sm text-destructive\">\n          <div className=\"flex items-center justify-between gap-3\">\n            <span>{savedNotesError}</span>\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-7 px-3 text-xs text-destructive hover:bg-destructive/10 hover:text-destructive\"\n              onClick={() => {\n                setSavedNotesError(null);\n                void reloadSavedNotes();\n              }}\n            >\n              {t(\"common:tryAgain\")}\n            </Button>\n          </div>\n        </div>\n      ) : sortedNotes.length > 0 ? (\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\">\n              {t(\"steps.notes.savedHeading\")}\n            </h3>\n            <p className=\"text-[11px] text-muted-foreground\">\n              {t(\"steps.notes.quickInsertHint\")}\n            </p>\n          </div>\n          <div className=\"flex flex-wrap gap-2\">\n            {sortedNotes.map((preset) => (\n              <div\n                key={preset.id}\n                className=\"flex items-center overflow-hidden rounded-full border border-slate-200 bg-white pl-2 shadow-sm\"\n              >\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"h-8 px-3 text-xs font-semibold text-slate-700 hover:bg-primary/10 hover:text-primary\"\n                  onClick={() => handleApplyPreset(preset)}\n                >\n                  {preset.title}\n                </Button>\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"h-8 w-8 border-l border-slate-200 px-0 text-muted-foreground hover:bg-destructive/10 hover:text-destructive\"\n                  onClick={() => handleDeletePreset(preset.id)}\n                  aria-label={t(\"steps.notes.deletePreset\")}\n                >\n                  <Trash2 className=\"h-3.5 w-3.5\" />\n                </Button>\n              </div>\n            ))}\n          </div>\n        </div>\n      ) : savedNotesLoaded ? (\n        <p className=\"text-xs text-muted-foreground\">\n          {t(\"steps.notes.noPresets\")}\n        </p>\n      ) : null}\n\n      {sortedNotes.length > 0 ? (\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={() => setNewPresetOpen((prev) => !prev)}\n        >\n          {newPresetOpen\n            ? t(\"steps.notes.hidePresetForm\")\n            : t(\"steps.notes.addPresetButton\")}\n        </Button>\n      ) : null}\n\n      <Collapsible open={newPresetOpen || sortedNotes.length === 0}>\n        <CollapsibleContent className=\"rounded-2xl border border-dashed border-slate-300 bg-white/80 p-5 data-[state=closed]:animate-collapse-up data-[state=open]:animate-collapse-down\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-semibold text-slate-900\">\n                {t(\"steps.notes.addPresetHeading\")}\n              </h3>\n              <p className=\"text-xs text-muted-foreground\">\n                {t(\"steps.notes.addPresetDescription\")}\n              </p>\n            </div>\n          </div>\n          <div className=\"mt-4 space-y-4\">\n            <div className=\"grid gap-2\">\n              <Label\n                htmlFor=\"new-note-title\"\n                className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\"\n              >\n                {t(\"steps.notes.newPresetTitle\")}\n              </Label>\n              <Input\n                id=\"new-note-title\"\n                value={newPreset.title}\n                placeholder={t(\"steps.notes.newPresetTitlePlaceholder\")}\n                onChange={(event) =>\n                  setNewPreset((prev) => ({\n                    ...prev,\n                    title: sanitizeNotesInput(event.target.value),\n                  }))\n                }\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label\n                htmlFor=\"new-note-body\"\n                className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\"\n              >\n                {t(\"steps.notes.newPresetBody\")}\n              </Label>\n              <Textarea\n                id=\"new-note-body\"\n                rows={3}\n                className=\"resize-none\"\n                placeholder={t(\"steps.notes.newPresetBodyPlaceholder\")}\n                value={newPreset.body}\n                onChange={(event) =>\n                  setNewPreset((prev) => ({\n                    ...prev,\n                    body: sanitizeNotesInput(event.target.value),\n                  }))\n                }\n              />\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <Button\n                type=\"button\"\n                onClick={handleSavePreset}\n                disabled={!canSavePreset}\n                className=\"gap-2\"\n              >\n                <Plus className=\"h-4 w-4\" />\n                {t(\"steps.notes.savePreset\")}\n              </Button>\n              <p className=\"text-xs text-muted-foreground\">\n                {t(\"steps.notes.savePresetHint\")}\n              </p>\n            </div>\n          </div>\n        </CollapsibleContent>\n      </Collapsible>\n\n      <Separator />\n\n      <div className=\"rounded-lg border border-border/70 bg-muted/40 p-4 shadow-sm\">\n        <Label\n          htmlFor=\"session-notes\"\n          className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\"\n        >\n          {t(\"steps.notes.notesLabel\")}\n        </Label>\n        <Textarea\n          id=\"session-notes\"\n          rows={6}\n          className=\"mt-2\"\n          value={state.notes ?? \"\"}\n          placeholder={t(\"steps.notes.notesPlaceholder\")}\n          onChange={(event) =>\n            updateSessionFields({\n              notes: sanitizeNotesInput(event.target.value),\n            })\n          }\n        />\n      </div>\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/steps/ProjectStep.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3663,3666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3663,3666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { useSessionPlanningActions } from \"../hooks/useSessionPlanningActions\";\nimport { useSessionPlanningContext } from \"../hooks/useSessionPlanningContext\";\nimport { useTranslation } from \"react-i18next\";\nimport { useToast } from \"@/components/ui/use-toast\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\nimport { Check, ChevronDown, FolderPlus, Search } from \"lucide-react\";\nimport { Label } from \"@/components/ui/label\";\nimport { cn } from \"@/lib/utils\";\nimport { ProjectCreationWizardSheet } from \"@/features/project-creation\";\n\ninterface ProjectOption {\n  id: string;\n  name: string;\n}\n\nexport const ProjectStep = ({ onContinue }: { onContinue?: () => void } = {}) => {\n  const { state } = useSessionPlanningContext();\n  const { updateProject } = useSessionPlanningActions();\n  const { t } = useTranslation(\"sessionPlanning\");\n  const { toast } = useToast();\n  const [projectOptions, setProjectOptions] = useState<ProjectOption[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [dropdownOpen, setDropdownOpen] = useState(false);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [hasAnyProject, setHasAnyProject] = useState(false);\n  const [hasLoadedInitial, setHasLoadedInitial] = useState(false);\n  const [isProjectWizardOpen, setProjectWizardOpen] = useState(false);\n  const latestRequestRef = useRef(0);\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  const leadId = state.lead.id;\n  const noProjectsAvailable =\n    Boolean(leadId) && hasLoadedInitial && !hasAnyProject;\n  const dropdownDisabled =\n    !leadId || noProjectsAvailable || (loading && projectOptions.length === 0);\n\n  useEffect(() => {\n    if (!leadId && state.project.id) {\n      updateProject({\n        id: undefined,\n        name: \"\",\n        description: \"\",\n        mode: \"existing\",\n        isSkipped: false,\n      });\n    }\n  }, [leadId, state.project.id, updateProject]);\n\n  const loadProjects = useCallback(\n    async (targetLeadId: string, term: string) => {\n      const requestId = ++latestRequestRef.current;\n      const isBaseQuery = term.trim().length === 0;\n      if (!targetLeadId) {\n        setProjectOptions([]);\n        setHasAnyProject(false);\n        setHasLoadedInitial(false);\n        return;\n      }\n      setLoading(true);\n      try {\n        const organizationId = await getUserOrganizationId();\n        if (!organizationId) {\n          if (latestRequestRef.current === requestId) {\n            setProjectOptions([]);\n            if (isBaseQuery) {\n              setHasAnyProject(false);\n              setHasLoadedInitial(true);\n            }\n          }\n          return;\n        }\n\n        const sanitized = term.trim().replace(/[%_]/g, \"\\\\$&\");\n        let query = supabase\n          .from(\"projects\")\n          .select(\"id, name\")\n          .eq(\"lead_id\", targetLeadId)\n          .eq(\"organization_id\", organizationId)\n          .order(\"updated_at\", { ascending: false })\n          .limit(25);\n\n        if (sanitized) {\n          query = query.ilike(\"name\", `%${sanitized}%`);\n        }\n\n        const { data, error } = await query;\n        if (error) throw error;\n\n        if (latestRequestRef.current === requestId) {\n          setProjectOptions((data as ProjectOption[]) || []);\n          if (isBaseQuery) {\n            setHasAnyProject(((data as ProjectOption[]) || []).length > 0);\n            setHasLoadedInitial(true);\n          }\n        }\n      } catch (error: any) {\n        console.error(\"Failed to load projects\", error);\n        if (latestRequestRef.current === requestId) {\n          setProjectOptions([]);\n          if (isBaseQuery) {\n            setHasAnyProject(false);\n            setHasLoadedInitial(true);\n          }\n        }\n        toast({\n          title: t(\"steps.project.fetchErrorTitle\"),\n          description: error.message,\n          variant: \"destructive\",\n        });\n      } finally {\n        if (latestRequestRef.current === requestId) {\n          setLoading(false);\n        }\n      }\n    },\n    [toast, t]\n  );\n\n  useEffect(() => {\n    if (!leadId) {\n      setProjectOptions([]);\n      setHasAnyProject(false);\n      setHasLoadedInitial(false);\n      return;\n    }\n    loadProjects(leadId, \"\");\n  }, [leadId, loadProjects]);\n\n  useEffect(() => {\n    if (!dropdownOpen || !leadId) return;\n    const handler = window.setTimeout(() => {\n      loadProjects(leadId, searchTerm);\n    }, 250);\n    return () => {\n      window.clearTimeout(handler);\n    };\n  }, [dropdownOpen, searchTerm, leadId, loadProjects]);\n\n  useEffect(() => {\n    if (!dropdownOpen) return;\n    const handlePointerDown = (event: PointerEvent) => {\n      if (\n        containerRef.current &&\n        !containerRef.current.contains(event.target as Node)\n      ) {\n        setDropdownOpen(false);\n      }\n    };\n    document.addEventListener(\"pointerdown\", handlePointerDown);\n    return () => {\n      document.removeEventListener(\"pointerdown\", handlePointerDown);\n    };\n  }, [dropdownOpen]);\n\n  const selectedProjectOption = useMemo(() => {\n    if (!state.project.id) return undefined;\n    return projectOptions.find((project) => project.id === state.project.id);\n  }, [projectOptions, state.project.id]);\n\n  const handleSelectProject = (project: ProjectOption) => {\n    updateProject({\n      id: project.id,\n      name: project.name,\n      description: state.project.description,\n      mode: \"existing\",\n      isSkipped: false,\n    });\n    setDropdownOpen(false);\n    setSearchTerm(\"\");\n  };\n\n  const handleProjectCreated = (project?: { id: string; name: string }) => {\n    if (project) {\n      const option = { id: project.id, name: project.name };\n      setProjectOptions((prev) => {\n        const without = prev.filter((item) => item.id !== project.id);\n        return [option, ...without];\n      });\n      handleSelectProject(option);\n    } else if (leadId) {\n      void loadProjects(leadId, \"\");\n    }\n  };\n\n  const handleSkipProject = () => {\n    updateProject({\n      id: undefined,\n      name: \"\",\n      description: \"\",\n      mode: \"existing\",\n      isSkipped: true,\n    });\n    setDropdownOpen(false);\n    setSearchTerm(\"\");\n    onContinue?.();\n  };\n\n  useEffect(() => {\n    if (dropdownOpen && (!leadId || noProjectsAvailable)) {\n      setDropdownOpen(false);\n    }\n  }, [dropdownOpen, leadId, noProjectsAvailable]);\n\n  useEffect(() => {\n    if (!leadId && isProjectWizardOpen) {\n      setProjectWizardOpen(false);\n    }\n  }, [isProjectWizardOpen, leadId]);\n\n  return (\n    <>\n      <ProjectCreationWizardSheet\n        isOpen={isProjectWizardOpen}\n        onOpenChange={setProjectWizardOpen}\n        leadId={leadId || undefined}\n        leadName={state.lead.name}\n        onProjectCreated={handleProjectCreated}\n        entrySource=\"session_planning\"\n      />\n\n      <div className=\"space-y-6\">\n        <div className=\"space-y-2\">\n          <h2 className=\"text-xl font-semibold tracking-tight\">\n            {t(\"steps.project.navigationLabel\")}\n          </h2>\n          <p className=\"text-sm text-muted-foreground\">\n            {t(\"steps.project.description\")}\n          </p>\n        </div>\n\n        <div className=\"space-y-3\">\n        <Label className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\">\n          {t(\"steps.project.selectExisting\")}\n        </Label>\n        <div className=\"relative\" ref={containerRef}>\n          <Button\n            type=\"button\"\n            onClick={() => {\n              if (dropdownDisabled) return;\n              setDropdownOpen((prev) => !prev);\n            }}\n            className={cn(\n              \"group flex h-12 w-full items-center justify-between rounded-xl border-none bg-gradient-to-r from-emerald-500 via-teal-500 to-cyan-500 px-4 py-3 text-left font-semibold text-white shadow-lg shadow-emerald-500/20 transition focus-visible:ring-2 focus-visible:ring-emerald-300\",\n              dropdownOpen && \"ring-2 ring-emerald-300\",\n              dropdownDisabled && \"cursor-not-allowed opacity-60\"\n            )}\n            disabled={dropdownDisabled}\n          >\n            {selectedProjectOption ? (\n              <span className=\"text-sm font-semibold text-white\">\n                {selectedProjectOption.name}\n              </span>\n            ) : !leadId ? (\n              t(\"steps.project.selectLeadFirst\")\n            ) : loading ? (\n              t(\"steps.project.loading\")\n            ) : (\n              t(\"steps.project.selectPlaceholder\")\n            )}\n            <ChevronDown className=\"ml-2 h-4 w-4 shrink-0 opacity-80 transition group-data-[state=open]:rotate-180\" />\n          </Button>\n\n          {dropdownOpen && (\n            <div className=\"absolute top-full left-0 right-0 z-50 mt-2 overflow-hidden rounded-2xl border border-emerald-200/40 bg-white shadow-2xl shadow-emerald-900/10\">\n              <div className=\"bg-gradient-to-r from-emerald-500 via-teal-500 to-cyan-500 px-4 py-3 text-sm font-semibold text-white\">\n                {t(\"steps.project.searchHeading\")}\n              </div>\n              <div className=\"px-4 py-3\">\n                <div className=\"relative\">\n                  <Search className=\"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-emerald-500\" />\n                  <Input\n                    value={searchTerm}\n                    onChange={(event) => setSearchTerm(event.target.value)}\n                    placeholder={t(\"steps.project.searchPlaceholder\")}\n                    className=\"h-11 rounded-xl border border-emerald-300/60 bg-white pl-9 text-sm shadow-inner shadow-emerald-900/5 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200\"\n                    autoFocus\n                  />\n                </div>\n              </div>\n              <div className=\"max-h-64 overflow-y-auto border-t border-slate-100\">\n                {loading ? (\n                  <p className=\"px-4 py-6 text-center text-sm text-muted-foreground\">\n                    {t(\"steps.project.loading\")}\n                  </p>\n                ) : projectOptions.length === 0 ? (\n                  <p className=\"px-4 py-6 text-center text-sm text-muted-foreground\">\n                    {searchTerm\n                      ? t(\"steps.project.noResults\")\n                      : t(\"steps.project.emptyState\")}\n                  </p>\n                ) : (\n                  projectOptions.map((project) => {\n                    const isActive = state.project.id === project.id;\n                    return (\n                      <button\n                        key={project.id}\n                        type=\"button\"\n                        onClick={() => handleSelectProject(project)}\n                        className={cn(\n                          \"flex w-full items-center justify-between px-4 py-3 text-left transition hover:bg-emerald-50/70\",\n                          isActive && \"bg-emerald-500/10\"\n                        )}\n                      >\n                        <span className=\"text-sm font-semibold text-slate-900\">\n                          {project.name}\n                        </span>\n                        <Check\n                          className={cn(\n                            \"h-4 w-4 text-emerald-500 transition\",\n                            isActive ? \"opacity-100\" : \"opacity-0\"\n                          )}\n                        />\n                      </button>\n                    );\n                  })\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {noProjectsAvailable && (\n          <div className=\"rounded-2xl border border-border/70 bg-white px-4 py-6 text-sm text-muted-foreground shadow-sm\">\n            {t(\"steps.project.noProjects\")}\n          </div>\n        )}\n\n        <div className=\"flex flex-wrap items-center gap-3\">\n          <Button\n            variant=\"outline\"\n            className=\"h-11 gap-2\"\n            disabled={!leadId}\n            onClick={() => {\n              if (!leadId) return;\n              setProjectWizardOpen(true);\n            }}\n          >\n            <FolderPlus className=\"h-4 w-4\" />\n            {t(\"steps.project.createButton\")}\n          </Button>\n\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            className=\"h-11 px-4 text-sm font-medium text-muted-foreground transition hover:bg-emerald-50 hover:text-emerald-600\"\n            onClick={handleSkipProject}\n          >\n            {t(\"steps.project.skipButton\")}\n          </Button>\n        </div>\n\n        {leadId && projectOptions.length === 0 && !loading && !noProjectsAvailable && (\n          <p className=\"text-xs text-muted-foreground\">\n            {t(\"steps.project.emptyState\")}\n          </p>\n        )}\n        </div>\n      </div>\n    </>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/steps/ScheduleStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/steps/SessionTypeStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/steps/SummaryStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/session-planning/utils/sanitizeNotes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/features/wizard/components/WizardStepList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/use-mobile.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useAccessibility.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useCalendarPerformanceMonitor.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useDataTable.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useDebounce.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useEntityActions.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useEntityData.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useKanbanSettings.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useLeadDetailData.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useLeadStatusActions.test.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useToast\" cannot be called at the top level. React Hooks must be called in a React function component or a custom React Hook function.","line":55,"column":20,"nodeType":"Identifier","endLine":55,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1274,1277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1274,1277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1286,1289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1286,1289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1575,1578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1575,1578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"jest.mock(\"@/integrations/supabase/client\", () => {\n  const auth = {\n    getUser: jest.fn(),\n    signIn: jest.fn(),\n    signOut: jest.fn(),\n  };\n\n  const rpc = jest.fn();\n\n  const from = jest.fn();\n\n  return {\n    __esModule: true,\n    supabase: {\n      auth,\n      rpc,\n      from,\n      functions: {\n        invoke: jest.fn(),\n      },\n    },\n  };\n});\n\njest.mock(\"@/hooks/use-toast\", () => {\n  const toast = jest.fn();\n  return {\n    __esModule: true,\n    useToast: () => ({ toast }),\n    _toastMock: toast,\n  };\n});\n\njest.mock(\"@/components/ui/toast\", () => ({\n  __esModule: true,\n  ToastAction: ({\n    children,\n    onClick,\n  }: {\n    children: React.ReactNode;\n    onClick?: () => Promise<void> | void;\n  }) => React.createElement(\"button\", { onClick }, children),\n}));\n\nimport React from \"react\";\nimport { renderHook, act } from \"@testing-library/react\";\n\nimport { useLeadStatusActions } from \"../useLeadStatusActions\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nconst authMock = supabase.auth.getUser as jest.Mock;\nconst rpcMock = supabase.rpc as jest.Mock;\nconst fromMock = supabase.from as jest.Mock;\nconst toastMock = (useToast() as { toast: jest.Mock }).toast;\n\nconst leadStatusQueue: Array<{ data: any; error: any }> = [];\nconst leadStatusesQuery = {\n  select: jest.fn().mockReturnThis(),\n  eq: jest.fn().mockReturnThis(),\n  maybeSingle: jest.fn().mockImplementation(() =>\n    Promise.resolve(leadStatusQueue.shift() ?? { data: null, error: null })\n  ),\n};\n\nconst leadsUpdateResults: Array<{ error: any }> = [];\nconst leadsQuery = {\n  update: jest.fn().mockReturnThis(),\n  eq: jest.fn().mockImplementation((_column: string, _value: string) =>\n    Promise.resolve(leadsUpdateResults.shift() ?? { error: null })\n  ),\n};\n\nbeforeEach(() => {\n  jest.useRealTimers();\n\n  authMock.mockReset();\n  rpcMock.mockReset();\n  fromMock.mockReset();\n  toastMock.mockReset();\n\n  leadStatusQueue.length = 0;\n  leadStatusesQuery.select.mockClear();\n  leadStatusesQuery.eq.mockClear();\n  leadStatusesQuery.maybeSingle.mockClear();\n\n  leadsUpdateResults.length = 0;\n  leadsQuery.update.mockClear();\n  leadsQuery.eq.mockClear();\n\n  authMock.mockResolvedValue({ data: { user: { id: \"user-1\" } }, error: null });\n  rpcMock.mockResolvedValue({ data: null, error: null });\n\n  fromMock.mockImplementation((table: string) => {\n    if (table === \"lead_statuses\") {\n      return leadStatusesQuery;\n    }\n    if (table === \"leads\") {\n      return leadsQuery;\n    }\n    throw new Error(`Unexpected table ${table}`);\n  });\n});\n\ndescribe(\"useLeadStatusActions\", () => {\n  it(\"updates status, triggers callbacks, and supports undo\", async () => {\n    const onStatusChange = jest.fn();\n\n    leadStatusQueue.push(\n      { data: { id: \"status-complete\", name: \"Completed\" }, error: null },\n      { data: { id: \"status-prev\", name: \"Qualified\" }, error: null }\n    );\n\n    leadsUpdateResults.push({ error: null }, { error: null });\n\n    const { result } = renderHook(() =>\n      useLeadStatusActions({ leadId: \"lead-1\", onStatusChange })\n    );\n\n    await act(async () => {\n      await result.current.markAsCompleted(\"Qualified\");\n    });\n\n    expect(result.current.isUpdating).toBe(false);\n    expect(authMock).toHaveBeenCalled();\n    expect(rpcMock).toHaveBeenCalledWith(\"ensure_system_lead_statuses\", {\n      user_uuid: \"user-1\",\n    });\n    expect(leadStatusesQuery.select).toHaveBeenCalledWith(\"id, name\");\n    expect(leadStatusesQuery.eq).toHaveBeenCalledWith(\"name\", \"Completed\");\n    expect(leadsQuery.update).toHaveBeenCalledWith({\n      status_id: \"status-complete\",\n      status: \"Completed\",\n    });\n    expect(leadsQuery.eq).toHaveBeenCalledWith(\"id\", \"lead-1\");\n    expect(onStatusChange).toHaveBeenCalledTimes(1);\n\n    const toastArgs = toastMock.mock.calls[0]?.[0];\n    expect(toastArgs).toMatchObject({\n      title: \"Status Updated\",\n      description: \"Lead marked as Completed\",\n    });\n    expect(React.isValidElement(toastArgs.action)).toBe(true);\n\n    await act(async () => {\n      await toastArgs.action.props.onClick();\n    });\n\n    expect(leadStatusesQuery.eq).toHaveBeenCalledWith(\"name\", \"Qualified\");\n    expect(leadsQuery.update).toHaveBeenLastCalledWith({\n      status_id: \"status-prev\",\n      status: \"Qualified\",\n    });\n\n    expect(onStatusChange).toHaveBeenCalledTimes(2);\n    const undoToast = toastMock.mock.calls[1]?.[0];\n    expect(undoToast).toMatchObject({\n      title: \"Undone\",\n      description: \"Status reverted to Qualified\",\n    });\n  });\n\n  it(\"shows destructive toast when user not authenticated\", async () => {\n    authMock.mockResolvedValue({ data: { user: null }, error: null });\n\n    const { result } = renderHook(() =>\n      useLeadStatusActions({ leadId: \"lead-1\", onStatusChange: jest.fn() })\n    );\n\n    await act(async () => {\n      await result.current.markAsCompleted();\n    });\n\n    const toastArgs = toastMock.mock.calls[0]?.[0];\n    expect(toastArgs).toMatchObject({\n      title: \"Error updating status\",\n      variant: \"destructive\",\n    });\n    expect(result.current.isUpdating).toBe(false);\n  });\n\n  it(\"surfaces errors from status lookup\", async () => {\n    leadStatusQueue.push({ data: null, error: new Error(\"status lookup failed\") });\n\n    const { result } = renderHook(() =>\n      useLeadStatusActions({ leadId: \"lead-1\", onStatusChange: jest.fn() })\n    );\n\n    await act(async () => {\n      await result.current.markAsCompleted();\n    });\n\n    const toastArgs = toastMock.mock.calls[0]?.[0];\n    expect(toastArgs).toMatchObject({\n      title: \"Error updating status\",\n      description: \"status lookup failed\",\n      variant: \"destructive\",\n    });\n  });\n\n  it(\"supports custom labels for lost status without undo\", async () => {\n    leadStatusQueue.push({ data: { id: \"status-archived\", name: \"Archived\" }, error: null });\n    leadsUpdateResults.push({ error: null });\n\n    const { result } = renderHook(() =>\n      useLeadStatusActions({ leadId: \"lead-1\", onStatusChange: jest.fn() })\n    );\n\n    await act(async () => {\n      await result.current.markAsLost(undefined, \"Archived\");\n    });\n\n    const toastArgs = toastMock.mock.calls[0]?.[0];\n    expect(toastArgs).toMatchObject({\n      description: \"Lead marked as Archived\",\n    });\n    expect(toastArgs.action).toBeUndefined();\n    expect(leadStatusesQuery.eq).toHaveBeenCalledWith(\"name\", \"Archived\");\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useMilestoneNotifications.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1164,1167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1164,1167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMilestoneNotifications } from \"../useMilestoneNotifications\";\n\nconst triggerProjectMilestoneMock = jest.fn();\n\njest.mock(\"@/hooks/useNotificationTriggers\", () => ({\n  useNotificationTriggers: () => ({\n    triggerProjectMilestone: (...args: unknown[]) => triggerProjectMilestoneMock(...args),\n  }),\n}));\n\ndescribe(\"useMilestoneNotifications\", () => {\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it(\"logs a warning when invoking the deprecated sender\", async () => {\n    const consoleSpy = jest.spyOn(console, \"log\").mockImplementation(() => {});\n\n    const { sendPendingMilestoneNotifications } = useMilestoneNotifications();\n    await sendPendingMilestoneNotifications();\n\n    expect(consoleSpy).toHaveBeenCalledWith(\n      \"Legacy milestone notification method called - please use triggerProjectMilestone directly\"\n    );\n    consoleSpy.mockRestore();\n  });\n\n  it(\"re-exports triggerProjectMilestone from the notification triggers hook\", async () => {\n    const { triggerProjectMilestone } = useMilestoneNotifications();\n\n    const payload = { projectId: \"proj-1\", milestoneId: \"milestone-2\" };\n    await triggerProjectMilestone(payload as any);\n\n    expect(triggerProjectMilestoneMock).toHaveBeenCalledWith(payload);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useNotificationTriggers.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useOrganizationData.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useOrganizationQuickSettings.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useOrganizationSettings.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":62,"column":30,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":62,"endColumn":62},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2215,2218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2215,2218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { renderHook, act, waitFor } from \"@testing-library/react\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport { useOrganizationSettings } from \"../useOrganizationSettings\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  fetchOrganizationSettingsWithCache,\n  getOrganizationSettingsFromCache,\n  setOrganizationSettingsCache,\n  ORGANIZATION_SETTINGS_CACHE_TTL,\n} from \"@/lib/organizationSettingsCache\";\nimport { supabase } from \"@/integrations/supabase/client\";\n\njest.mock(\"@/contexts/OrganizationContext\", () => ({\n  useOrganization: jest.fn(),\n}));\n\njest.mock(\"@/hooks/use-toast\", () => ({\n  useToast: jest.fn(),\n}));\n\njest.mock(\"@/lib/organizationSettingsCache\", () => ({\n  fetchOrganizationSettingsWithCache: jest.fn(),\n  getOrganizationSettingsFromCache: jest.fn(),\n  setOrganizationSettingsCache: jest.fn(),\n  ORGANIZATION_SETTINGS_CACHE_TTL: 12345,\n}));\n\njest.mock(\"@tanstack/react-query\", () => {\n  const actual = jest.requireActual(\"@tanstack/react-query\");\n  return {\n    ...actual,\n    useQuery: actual.useQuery,\n    useQueryClient: jest.fn().mockImplementation(() => ({\n      setQueryData: jest.fn(),\n    })),\n  };\n});\n\njest.mock(\"@/integrations/supabase/client\", () => ({\n  supabase: {\n    auth: {\n      getUser: jest.fn(),\n    },\n    from: jest.fn(),\n    storage: {\n      from: jest.fn().mockReturnThis(),\n      remove: jest.fn(),\n      upload: jest.fn(),\n      getPublicUrl: jest.fn(),\n    },\n    rpc: jest.fn(),\n  },\n}));\n\nconst mockedUseOrganization = useOrganization as jest.Mock;\nconst mockedUseToast = useToast as jest.Mock;\nconst mockedFetchWithCache = fetchOrganizationSettingsWithCache as jest.Mock;\nconst mockedGetFromCache = getOrganizationSettingsFromCache as jest.Mock;\nconst mockedSetCache = setOrganizationSettingsCache as jest.Mock;\nconst mockedGetUser = supabase.auth.getUser as jest.Mock;\nconst mockedUseQueryClient = require(\"@tanstack/react-query\").useQueryClient as jest.Mock;\nconst mockQueryClient = {\n  setQueryData: jest.fn(),\n};\nlet consoleErrorSpy: jest.SpyInstance;\n\nconst createQueryBuilder = (response: { data: unknown; error: unknown }) => {\n  const builder: any = {\n    eq: jest.fn().mockReturnThis(),\n    select: jest.fn().mockReturnThis(),\n    single: jest.fn().mockResolvedValue(response),\n  };\n  return builder;\n};\n\n\nconst createWrapper = () => {\n  const queryClient = new QueryClient();\n  return ({ children }: { children: React.ReactNode }) => (\n    <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>\n  );\n};\n\nconst renderHookWithProviders = () => {\n  const { result } = renderHook(() => useOrganizationSettings(), {\n    wrapper: createWrapper(),\n  });\n  return { result };\n};\n\nbeforeEach(() => {\n  mockedUseOrganization.mockReturnValue({\n    activeOrganizationId: \"org-1\",\n  });\n  mockedUseToast.mockReturnValue({\n    toast: jest.fn(),\n  });\n  mockedGetFromCache.mockReturnValue(null);\n  mockedFetchWithCache.mockResolvedValue({\n    id: \"settings-1\",\n    organization_id: \"org-1\",\n    logo_url: null,\n    social_channels: null,\n  });\n  mockedGetUser.mockResolvedValue({ data: { user: { id: \"user-1\" } }, error: null });\n  mockedUseQueryClient.mockReturnValue(mockQueryClient);\n  consoleErrorSpy = jest.spyOn(console, \"error\").mockImplementation(() => {});\n});\n\nafterEach(() => {\n  jest.clearAllMocks();\n  mockQueryClient.setQueryData.mockReset();\n  consoleErrorSpy.mockRestore();\n});\n\ndescribe(\"useOrganizationSettings\", () => {\n  it(\"loads settings and normalizes social channels\", async () => {\n    const snapshot = {\n      id: \"settings-1\",\n      organization_id: \"org-1\",\n      social_channels: {\n        instagram: {\n          name: \"Instagram\",\n          url: \"https://instagram.com\",\n          platform: \"instagram\",\n          enabled: true,\n          order: 1,\n        },\n      },\n    };\n    mockedGetFromCache.mockReturnValue(snapshot);\n    mockedFetchWithCache.mockResolvedValue(snapshot);\n\n    const { result } = renderHookWithProviders();\n    await waitFor(() => result.current.loading === false);\n    expect(result.current.settings?.socialChannels?.instagram?.name).toBe(\"Instagram\");\n  });\n\n  it(\"returns null settings when organization missing\", async () => {\n    mockedUseOrganization.mockReturnValue({\n      activeOrganizationId: null,\n    });\n\n    const { result } = renderHookWithProviders();\n    expect(result.current.settings).toBeNull();\n    expect(mockedFetchWithCache).not.toHaveBeenCalled();\n  });\n\n  it(\"updates settings via supabase update when record exists\", async () => {\n    mockedFetchWithCache.mockResolvedValue({\n      id: \"settings-1\",\n      organization_id: \"org-1\",\n    });\n    const updatePayloads: unknown[] = [];\n    const builder = createQueryBuilder({\n      data: { id: \"settings-1\", organization_id: \"org-1\", logo_url: \"logo.png\" },\n      error: null,\n    });\n    (supabase.from as jest.Mock).mockImplementation(() => ({\n      update: (payload: unknown) => {\n        updatePayloads.push(payload);\n        return builder;\n      },\n      upsert: jest.fn(),\n    }));\n\n    const { result } = renderHookWithProviders();\n    await waitFor(() => mockedFetchWithCache.mock.calls.length > 0);\n    await waitFor(() => result.current.loading === false);\n    expect(result.current.settings?.id).toBe(\"settings-1\");\n\n    const response = await result.current.updateSettings({ logo_url: \"new-logo.png\" });\n    expect(builder.eq).toHaveBeenCalledWith(\"id\", \"settings-1\");\n    expect(builder.select).toHaveBeenCalledWith(\"*\");\n    expect(response.success).toBe(true);\n    expect(mockedSetCache).toHaveBeenCalledWith(\"org-1\", { id: \"settings-1\", organization_id: \"org-1\", logo_url: \"logo.png\" });\n    expect(mockQueryClient.setQueryData).toHaveBeenCalledWith([\"organization_settings\", \"org-1\"], { id: \"settings-1\", organization_id: \"org-1\", logo_url: \"logo.png\" });\n    expect(updatePayloads[0]).toEqual({ logo_url: \"new-logo.png\" });\n  });\n\n  it(\"upserts settings when record absent\", async () => {\n    mockedFetchWithCache.mockResolvedValue(null);\n    const upsertCalls: Array<[unknown, unknown]> = [];\n    const builder = createQueryBuilder({\n      data: { id: \"settings-2\", organization_id: \"org-1\", logo_url: \"logo.png\" },\n      error: null,\n    });\n    (supabase.from as jest.Mock).mockImplementation(() => ({\n      update: jest.fn(),\n      upsert: (payload: unknown, options: unknown) => {\n        upsertCalls.push([payload, options]);\n        return builder;\n      },\n    }));\n\n    const { result } = renderHookWithProviders();\n    await waitFor(() => mockedFetchWithCache.mock.calls.length > 0);\n    await waitFor(() => result.current.loading === false);\n    await act(async () => {\n      await result.current.updateSettings({ logo_url: \"logo.png\" });\n    });\n\n    expect(upsertCalls[0]).toEqual([\n      { organization_id: \"org-1\", logo_url: \"logo.png\" },\n      { onConflict: \"organization_id\" },\n    ]);\n    expect(mockedSetCache).toHaveBeenCalledWith(\"org-1\", { id: \"settings-2\", organization_id: \"org-1\", logo_url: \"logo.png\" });\n    expect(mockQueryClient.setQueryData).toHaveBeenCalledWith([\"organization_settings\", \"org-1\"], { id: \"settings-2\", organization_id: \"org-1\", logo_url: \"logo.png\" });\n  });\n\n  it(\"handles update failure by toasting error\", async () => {\n    mockedFetchWithCache.mockResolvedValue({\n      id: \"settings-1\",\n      organization_id: \"org-1\",\n    });\n    mockedGetUser.mockResolvedValue({ data: { user: { id: \"user-1\" } }, error: null });\n    const builder = createQueryBuilder({ data: null, error: new Error(\"update failed\") });\n    (supabase.from as jest.Mock).mockImplementation(() => ({\n      update: () => builder,\n      upsert: jest.fn(),\n    }));\n\n    const toastSpy = jest.fn();\n    mockedUseToast.mockReturnValue({ toast: toastSpy });\n\n    const { result } = renderHookWithProviders();\n    await waitFor(() => mockedFetchWithCache.mock.calls.length > 0);\n    await waitFor(() => result.current.loading === false);\n    await act(async () => {\n      const response = await result.current.updateSettings({ logo_url: \"logo.png\" });\n      expect(response.success).toBe(false);\n    });\n    expect(toastSpy).toHaveBeenCalledWith({\n      title: \"Error\",\n      description: \"update failed\",\n      variant: \"destructive\",\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useOrganizationTimezone.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useProjectPayments.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useProjectSessionsSummary.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useReminderActions.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useSessionActions.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useSessionEditForm.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useSessionForm.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useSessionReminderScheduling.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useSettingsSection.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useSmartTimeRange.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useTemplateBuilder.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useTemplateValidation.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useUserPreferences.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[998,1001],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[998,1001],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1010,1013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1010,1013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1046,1049],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1046,1049],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1082,1085],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1082,1085],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"jest.mock(\"@/integrations/supabase/client\", () => {\n  const from = jest.fn();\n  const rpc = jest.fn();\n  const auth = {\n    getUser: jest.fn(),\n    signIn: jest.fn(),\n    signOut: jest.fn(),\n  };\n\n  return {\n    __esModule: true,\n    supabase: {\n      from,\n      rpc,\n      auth,\n      functions: {\n        invoke: jest.fn(),\n      },\n    },\n  };\n});\n\njest.mock(\"@/contexts/AuthContext\", () => ({\n  useAuth: jest.fn(),\n}));\n\nimport React, { type ReactNode } from \"react\";\nimport { renderHook, act, waitFor } from \"@testing-library/react\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\n\nimport { useUserPreferences } from \"../useUserPreferences\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useAuth } from \"@/contexts/AuthContext\";\n\nconst fromMock = supabase.from as jest.Mock;\nconst useAuthMock = useAuth as jest.Mock;\n\nconst baseUser = { id: \"user-1\" } as { id: string };\nconst USER_PREFS_KEY = \"user-preferences\";\n\ntype SelectResult = { data: any; error: any };\ntype UpdateResult = { error: any };\ntype InsertResult = { error: any };\n\nfunction createSelectTable(result: SelectResult) {\n  const maybeSingle = jest.fn().mockResolvedValue(result);\n  const eq = jest.fn().mockReturnValue({ maybeSingle });\n  const select = jest.fn().mockReturnValue({ eq });\n\n  return {\n    table: {\n      select,\n      insert: jest.fn(),\n      update: jest.fn(),\n    },\n    select,\n    eq,\n    maybeSingle,\n  };\n}\n\nfunction createInsertTable(result: InsertResult) {\n  const insert = jest.fn().mockResolvedValue(result);\n  return {\n    table: {\n      select: jest.fn(),\n      insert,\n      update: jest.fn(),\n    },\n    insert,\n  };\n}\n\nfunction createUpdateTable(result: UpdateResult) {\n  const eq = jest.fn().mockResolvedValue(result);\n  const update = jest.fn().mockReturnValue({ eq });\n  return {\n    table: {\n      select: jest.fn(),\n      insert: jest.fn(),\n      update,\n    },\n    update,\n    eq,\n  };\n}\n\nlet queryClient: QueryClient;\n\nconst createWrapper =\n  () =>\n  ({ children }: { children: ReactNode }) =>\n    React.createElement(QueryClientProvider, { client: queryClient }, children);\n\nbeforeEach(() => {\n  queryClient = new QueryClient({\n    defaultOptions: {\n      queries: {\n        retry: false,\n      },\n    },\n  });\n\n  fromMock.mockReset();\n  useAuthMock.mockReset();\n});\n\nafterEach(() => {\n  queryClient.clear();\n});\n\ndescribe(\"useUserPreferences\", () => {\n  it(\"disables fetching when no authenticated user is present\", () => {\n    useAuthMock.mockReturnValue({ user: null });\n\n    const wrapper = createWrapper();\n    const { result } = renderHook(() => useUserPreferences(), { wrapper });\n\n    expect(result.current.isReady).toBe(false);\n    expect(fromMock).not.toHaveBeenCalled();\n  });\n\n  it(\"returns user preferences from existing records\", async () => {\n    useAuthMock.mockReturnValue({ user: baseUser });\n\n    const selectCall = createSelectTable({\n      data: {\n        user_id: \"user-1\",\n        onboarding_stage: \"in_progress\",\n        current_onboarding_step: 3,\n        welcome_modal_shown: true,\n        updated_at: \"2025-10-20T00:00:00.000Z\",\n      },\n      error: null,\n    });\n\n    fromMock.mockImplementationOnce((table: string) => {\n      expect(table).toBe(\"user_settings\");\n      return selectCall.table;\n    });\n\n    const wrapper = createWrapper();\n    const { result } = renderHook(() => useUserPreferences(), { wrapper });\n\n    await waitFor(() => expect(result.current.isReady).toBe(true));\n\n    expect(selectCall.select).toHaveBeenCalledWith(`\n      user_id,\n      onboarding_stage,\n      current_onboarding_step,\n      welcome_modal_shown,\n      updated_at\n    `);\n    expect(selectCall.eq).toHaveBeenCalledWith(\"user_id\", \"user-1\");\n    expect(result.current.data).toMatchObject({\n      userId: \"user-1\",\n      onboardingStage: \"in_progress\",\n      currentOnboardingStep: 3,\n      welcomeModalShown: true,\n      timeFormat: \"12-hour\",\n      dateFormat: \"DD/MM/YYYY\",\n    });\n  });\n\n  it(\"creates default preferences when no record exists\", async () => {\n    useAuthMock.mockReturnValue({ user: baseUser });\n\n    const selectCall = createSelectTable({ data: null, error: null });\n    const insertCall = createInsertTable({ error: null });\n\n    fromMock\n      .mockImplementationOnce(() => selectCall.table)\n      .mockImplementationOnce(() => insertCall.table);\n\n    const wrapper = createWrapper();\n    const { result } = renderHook(() => useUserPreferences(), { wrapper });\n\n    await waitFor(() => expect(result.current.isReady).toBe(true));\n\n    expect(insertCall.insert).toHaveBeenCalledWith({\n      user_id: \"user-1\",\n      onboarding_stage: \"not_started\",\n      current_onboarding_step: 1,\n      welcome_modal_shown: false,\n    });\n\n    expect(result.current.data).toMatchObject({\n      userId: \"user-1\",\n      onboardingStage: \"not_started\",\n      currentOnboardingStep: 1,\n      welcomeModalShown: false,\n      primaryBrandColor: \"#1EB29F\",\n      timezone: \"UTC\",\n    });\n  });\n\n  it(\"applies optimistic updates and persists onboarding fields\", async () => {\n    useAuthMock.mockReturnValue({ user: baseUser });\n\n    const initialSelect = createSelectTable({\n      data: {\n        user_id: \"user-1\",\n        onboarding_stage: \"not_started\",\n        current_onboarding_step: 1,\n        welcome_modal_shown: false,\n        updated_at: \"2025-10-20T00:00:00.000Z\",\n      },\n      error: null,\n    });\n\n    const updateCall = createUpdateTable({ error: null });\n\n    const refreshedSelect = createSelectTable({\n      data: {\n        user_id: \"user-1\",\n        onboarding_stage: \"completed\",\n        current_onboarding_step: 5,\n        welcome_modal_shown: true,\n        updated_at: \"2025-10-21T00:00:00.000Z\",\n      },\n      error: null,\n    });\n\n    fromMock\n      .mockImplementationOnce(() => initialSelect.table)\n      .mockImplementationOnce(() => updateCall.table)\n      .mockImplementationOnce(() => refreshedSelect.table);\n\n    const invalidateSpy = jest.spyOn(queryClient, \"invalidateQueries\");\n\n    const wrapper = createWrapper();\n    const { result } = renderHook(() => useUserPreferences(), { wrapper });\n\n    await waitFor(() => expect(result.current.isReady).toBe(true));\n\n    await act(async () => {\n      await result.current.updatePreferences({\n        onboardingStage: \"completed\",\n        currentOnboardingStep: 5,\n        welcomeModalShown: true,\n      });\n    });\n\n    expect(updateCall.update).toHaveBeenCalledWith({\n      onboarding_stage: \"completed\",\n      current_onboarding_step: 5,\n      welcome_modal_shown: true,\n    });\n    expect(updateCall.eq).toHaveBeenCalledWith(\"user_id\", \"user-1\");\n\n    expect(invalidateSpy).toHaveBeenCalledWith({\n      queryKey: [USER_PREFS_KEY, \"user-1\"],\n    });\n\n    await waitFor(() =>\n      expect(result.current.data?.onboardingStage).toBe(\"completed\")\n    );\n    expect(result.current.data?.currentOnboardingStep).toBe(5);\n    expect(result.current.data?.welcomeModalShown).toBe(true);\n  });\n\n  it(\"reverts optimistic update when persistence fails\", async () => {\n    useAuthMock.mockReturnValue({ user: baseUser });\n\n    const initialSelect = createSelectTable({\n      data: {\n        user_id: \"user-1\",\n        onboarding_stage: \"not_started\",\n        current_onboarding_step: 1,\n        welcome_modal_shown: false,\n        updated_at: \"2025-10-20T00:00:00.000Z\",\n      },\n      error: null,\n    });\n\n    const updateCall = createUpdateTable({\n      error: new Error(\"update failed\"),\n    });\n\n    const refetchSelect = createSelectTable({\n      data: {\n        user_id: \"user-1\",\n        onboarding_stage: \"not_started\",\n        current_onboarding_step: 1,\n        welcome_modal_shown: false,\n        updated_at: \"2025-10-20T00:00:00.000Z\",\n      },\n      error: null,\n    });\n\n    fromMock\n      .mockImplementationOnce(() => initialSelect.table)\n      .mockImplementationOnce(() => updateCall.table)\n      .mockImplementationOnce(() => refetchSelect.table);\n\n    const invalidateSpy = jest.spyOn(queryClient, \"invalidateQueries\");\n\n    const wrapper = createWrapper();\n    const { result } = renderHook(() => useUserPreferences(), { wrapper });\n\n    await waitFor(() => expect(result.current.isReady).toBe(true));\n\n    await expect(\n      act(async () => {\n        await result.current.updatePreferences({\n          onboardingStage: \"completed\",\n        });\n      })\n    ).rejects.toThrow(\"update failed\");\n\n    expect(invalidateSpy).toHaveBeenCalledWith({\n      queryKey: [USER_PREFS_KEY, \"user-1\"],\n    });\n\n    await waitFor(() =>\n      expect(result.current.data?.onboardingStage).toBe(\"not_started\")\n    );\n  });\n\n  it(\"provides helpers to force refresh and clear cached data\", async () => {\n    useAuthMock.mockReturnValue({ user: baseUser });\n\n    const selectCall = createSelectTable({\n      data: {\n        user_id: \"user-1\",\n        onboarding_stage: \"not_started\",\n        current_onboarding_step: 1,\n        welcome_modal_shown: false,\n        updated_at: \"2025-10-20T00:00:00.000Z\",\n      },\n      error: null,\n    });\n\n    // initial fetch + refetch after forceRefresh + refetch after clear cache invalidation\n    const secondSelect = createSelectTable({\n      data: {\n        user_id: \"user-1\",\n        onboarding_stage: \"not_started\",\n        current_onboarding_step: 1,\n        welcome_modal_shown: false,\n        updated_at: \"2025-10-20T00:00:00.000Z\",\n      },\n      error: null,\n    });\n\n    const thirdSelect = createSelectTable({\n      data: {\n        user_id: \"user-1\",\n        onboarding_stage: \"not_started\",\n        current_onboarding_step: 1,\n        welcome_modal_shown: false,\n        updated_at: \"2025-10-20T00:00:00.000Z\",\n      },\n      error: null,\n    });\n\n    fromMock\n      .mockImplementationOnce(() => selectCall.table)\n      .mockImplementationOnce(() => secondSelect.table)\n      .mockImplementationOnce(() => thirdSelect.table);\n\n    const invalidateSpy = jest.spyOn(queryClient, \"invalidateQueries\");\n    const removeSpy = jest.spyOn(queryClient, \"removeQueries\");\n\n    const wrapper = createWrapper();\n    const { result } = renderHook(() => useUserPreferences(), { wrapper });\n\n    await waitFor(() => expect(result.current.isReady).toBe(true));\n\n    act(() => {\n      result.current.forceRefresh();\n    });\n\n    expect(invalidateSpy).toHaveBeenCalledWith({\n      queryKey: [USER_PREFS_KEY],\n    });\n\n    act(() => {\n      result.current.clearCache();\n    });\n\n    expect(removeSpy).toHaveBeenCalledWith({\n      queryKey: [USER_PREFS_KEY],\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/__tests__/useWorkflowTriggers.test.ts","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useToast\" cannot be called at the top level. React Hooks must be called in a React function component or a custom React Hook function.","line":30,"column":20,"nodeType":"Identifier","endLine":30,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"jest.mock(\"@/integrations/supabase/client\", () => {\n  const invoke = jest.fn();\n  return {\n    supabase: {\n      functions: {\n        invoke,\n      },\n    },\n    __esModule: true,\n    _invokeMock: invoke,\n  };\n});\n\njest.mock(\"@/hooks/use-toast\", () => {\n  const toast = jest.fn();\n  return {\n    useToast: () => ({ toast }),\n    __esModule: true,\n    _toastMock: toast,\n  };\n});\n\nimport { useWorkflowTriggers } from \"../useWorkflowTriggers\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nconst VALID_SESSION_ID = \"123e4567-e89b-12d3-a456-426614174000\";\nconst VALID_ORG_ID = \"123e4567-e89b-12d3-a456-426614174001\";\nconst invokeMock = supabase.functions.invoke as jest.Mock;\nconst toastMock = (useToast() as { toast: jest.Mock }).toast;\n\nbeforeEach(() => {\n  invokeMock.mockReset();\n  toastMock.mockReset();\n});\n\ndescribe(\"useWorkflowTriggers\", () => {\n  describe(\"triggerWorkflow\", () => {\n    it(\"rejects when required parameters are missing\", async () => {\n      const { triggerWorkflow } = useWorkflowTriggers();\n\n      await expect(\n        triggerWorkflow(\"session_scheduled\", \"session\", \"\", VALID_ORG_ID)\n      ).rejects.toThrow(\"Missing required parameters\");\n      expect(invokeMock).not.toHaveBeenCalled();\n    });\n\n    it(\"rejects when ids fail UUID validation\", async () => {\n      const { triggerWorkflow } = useWorkflowTriggers();\n\n      await expect(\n        triggerWorkflow(\"session_scheduled\", \"session\", \"not-a-uuid\", VALID_ORG_ID)\n      ).rejects.toThrow(\"Invalid entity ID format\");\n\n      await expect(\n        triggerWorkflow(\"session_scheduled\", \"session\", VALID_SESSION_ID, \"invalid-org\")\n      ).rejects.toThrow(\"Invalid organization ID format\");\n\n      expect(invokeMock).not.toHaveBeenCalled();\n    });\n\n    it(\"surfaces Supabase errors and shows a destructive toast\", async () => {\n      const { triggerWorkflow } = useWorkflowTriggers();\n\n      const supabaseError = new Error(\"RPC exploded\");\n      invokeMock.mockResolvedValueOnce({ data: null, error: supabaseError });\n\n      await expect(\n        triggerWorkflow(\"session_completed\", \"session\", VALID_SESSION_ID, VALID_ORG_ID)\n      ).rejects.toThrow(\"RPC exploded\");\n\n      expect(toastMock).toHaveBeenCalledWith({\n        title: \"Workflow Error\",\n        description: \"RPC exploded\",\n        variant: \"destructive\",\n      });\n    });\n\n    it(\"does not toast when Supabase reports no workflows\", async () => {\n      const { triggerWorkflow } = useWorkflowTriggers();\n\n      const noWorkflowError = new Error(\"No workflows found for this trigger\");\n      invokeMock.mockResolvedValueOnce({ data: null, error: noWorkflowError });\n\n      await expect(\n        triggerWorkflow(\"session_completed\", \"session\", VALID_SESSION_ID, VALID_ORG_ID)\n      ).rejects.toThrow(\"No workflows found for this trigger\");\n\n      expect(toastMock).not.toHaveBeenCalled();\n    });\n\n    it(\"resolves with result payload when invocation succeeds\", async () => {\n      const { triggerWorkflow } = useWorkflowTriggers();\n\n      invokeMock.mockResolvedValueOnce({\n        data: { result: { triggered_workflows: 0, detail: \"ok\" } },\n        error: null,\n      });\n\n      await expect(\n        triggerWorkflow(\"session_completed\", \"session\", VALID_SESSION_ID, VALID_ORG_ID)\n      ).resolves.toEqual({ triggered_workflows: 0, detail: \"ok\" });\n\n      expect(toastMock).not.toHaveBeenCalled();\n    });\n  });\n\n  describe(\"trigger wrappers\", () => {\n    beforeEach(() => {\n      invokeMock.mockResolvedValue({\n        data: { result: { triggered_workflows: 1 } },\n        error: null,\n      });\n    });\n\n    it(\"enriches session scheduled trigger payload with session metadata\", async () => {\n      const { triggerSessionScheduled } = useWorkflowTriggers();\n\n      await triggerSessionScheduled(VALID_SESSION_ID, VALID_ORG_ID, {\n        session_date: \"2024-01-01\",\n        session_time: \"09:00\",\n        location: \"Studio\",\n        custom: \"value\",\n      });\n\n      expect(invokeMock).toHaveBeenCalledWith(\"workflow-executor\", {\n        body: expect.objectContaining({\n          trigger_type: \"session_scheduled\",\n          trigger_entity_type: \"session\",\n          trigger_entity_id: VALID_SESSION_ID,\n          organization_id: VALID_ORG_ID,\n          trigger_data: expect.objectContaining({\n            session_date: \"2024-01-01\",\n            session_time: \"09:00\",\n            location: \"Studio\",\n            custom: \"value\",\n          }),\n        }),\n      });\n    });\n\n    it(\"passes through project status change payload\", async () => {\n      const { triggerProjectStatusChange } = useWorkflowTriggers();\n\n      await triggerProjectStatusChange(\n        VALID_SESSION_ID,\n        VALID_ORG_ID,\n        \"proposal\",\n        \"booked\",\n        { project_name: \"Wedding\" }\n      );\n\n      expect(invokeMock).toHaveBeenCalledWith(\"workflow-executor\", {\n        body: expect.objectContaining({\n          trigger_type: \"project_status_change\",\n          trigger_entity_type: \"project\",\n          trigger_data: expect.objectContaining({\n            old_status: \"proposal\",\n            new_status: \"booked\",\n            project_name: \"Wedding\",\n          }),\n        }),\n      });\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useAccessibility.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useCalendarPerformanceMonitor.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2076,2079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2076,2079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2131,2134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2131,2134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2214,2217],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2214,2217],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2298,2301],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2298,2301],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useRef, useState } from 'react';\nimport { performanceMonitor } from '@/utils/performance';\n\ninterface PerformanceMetrics {\n  renderTime: number;\n  queryTime: number;\n  eventProcessingTime: number;\n  totalEvents: number;\n  memoryUsage: {\n    used: number;\n    total: number;\n    limit: number;\n  } | null;\n}\n\n/**\n * Performance monitoring hook specifically for calendar operations\n * Tracks render times, query performance, and memory usage\n */\nexport function useCalendarPerformanceMonitor() {\n  const [metrics, setMetrics] = useState<PerformanceMetrics>({\n    renderTime: 0,\n    queryTime: 0,\n    eventProcessingTime: 0,\n    totalEvents: 0,\n    memoryUsage: null\n  });\n\n  const metricsRef = useRef<PerformanceMetrics>(metrics);\n  metricsRef.current = metrics;\n\n  // Start timing for calendar render\n  const startRenderTiming = () => {\n    performanceMonitor.startTiming('calendar-render');\n  };\n\n  // End timing for calendar render\n  const endRenderTiming = () => {\n    const renderTime = performanceMonitor.endTiming('calendar-render');\n    \n    setMetrics(prev => ({\n      ...prev,\n      renderTime\n    }));\n  };\n\n  // Start timing for data queries\n  const startQueryTiming = () => {\n    performanceMonitor.startTiming('calendar-query');\n  };\n\n  // End timing for data queries\n  const endQueryTiming = () => {\n    const queryTime = performanceMonitor.endTiming('calendar-query');\n    \n    setMetrics(prev => ({\n      ...prev,\n      queryTime\n    }));\n  };\n\n  // Start timing for event processing\n  const startEventProcessing = () => {\n    performanceMonitor.startTiming('calendar-event-processing');\n  };\n\n  // End timing for event processing\n  const endEventProcessing = (eventCount: number) => {\n    const eventProcessingTime = performanceMonitor.endTiming('calendar-event-processing');\n    \n    setMetrics(prev => ({\n      ...prev,\n      eventProcessingTime,\n      totalEvents: eventCount\n    }));\n  };\n\n  // Update memory usage\n  const updateMemoryUsage = () => {\n    // Browser-compatible memory usage check\n    const memoryUsage = (performance as any).memory ? {\n      used: Math.round((performance as any).memory.usedJSHeapSize / 1024 / 1024),\n      total: Math.round((performance as any).memory.totalJSHeapSize / 1024 / 1024),\n      limit: Math.round((performance as any).memory.jsHeapSizeLimit / 1024 / 1024)\n    } : null;\n    \n    setMetrics(prev => ({\n      ...prev,\n      memoryUsage\n    }));\n  };\n\n  // Performance warnings\n  useEffect(() => {\n    if (process.env.NODE_ENV === 'development') {\n      const { renderTime, queryTime, eventProcessingTime, totalEvents, memoryUsage } = metrics;\n      \n      // Warn about slow renders\n      if (renderTime > 100) {\n        console.warn(`[Calendar Performance] Slow render detected: ${renderTime.toFixed(2)}ms`);\n      }\n      \n      // Warn about slow queries\n      if (queryTime > 500) {\n        console.warn(`[Calendar Performance] Slow query detected: ${queryTime.toFixed(2)}ms`);\n      }\n      \n      // Warn about slow event processing\n      if (eventProcessingTime > 50 && totalEvents > 0) {\n        console.warn(`[Calendar Performance] Slow event processing: ${eventProcessingTime.toFixed(2)}ms for ${totalEvents} events`);\n      }\n      \n      // Warn about high memory usage\n      if (memoryUsage && memoryUsage.used > memoryUsage.limit * 0.8) {\n        console.warn(`[Calendar Performance] High memory usage: ${memoryUsage.used}MB / ${memoryUsage.limit}MB`);\n      }\n    }\n  }, [metrics]);\n\n  // Auto-update memory usage every 5 seconds in development\n  useEffect(() => {\n    if (process.env.NODE_ENV === 'development') {\n      const interval = setInterval(updateMemoryUsage, 5000);\n      return () => clearInterval(interval);\n    }\n  }, []);\n\n  // Performance summary\n  const getPerformanceSummary = () => {\n    const { renderTime, queryTime, eventProcessingTime, totalEvents } = metricsRef.current;\n    \n    return {\n      totalTime: renderTime + queryTime + eventProcessingTime,\n      renderTime,\n      queryTime,\n      eventProcessingTime,\n      eventsPerSecond: totalEvents > 0 && eventProcessingTime > 0 \n        ? (totalEvents / (eventProcessingTime / 1000)).toFixed(2)\n        : 0,\n      grade: renderTime < 50 && queryTime < 200 && eventProcessingTime < 30 ? 'A' :\n             renderTime < 100 && queryTime < 500 && eventProcessingTime < 50 ? 'B' :\n             renderTime < 200 && queryTime < 1000 && eventProcessingTime < 100 ? 'C' : 'D'\n    };\n  };\n\n  return {\n    metrics,\n    startRenderTiming,\n    endRenderTiming,\n    startQueryTiming,\n    endQueryTiming,\n    startEventProcessing,\n    endEventProcessing,\n    updateMemoryUsage,\n    getPerformanceSummary\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useDataTable.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[190,193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[190,193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[241,244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[241,244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1011,1014],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1011,1014],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getValue'. Either include it or remove the dependency array.","line":96,"column":6,"nodeType":"ArrayExpression","endLine":96,"endColumn":56,"suggestions":[{"desc":"Update the dependencies array to be: [data, filters, sortField, columns, getValue, sortDirection]","fix":{"range":[3041,3091],"text":"[data, filters, sortField, columns, getValue, sortDirection]"}}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo } from \"react\";\n\nexport interface Column<T> {\n  key: keyof T | string;\n  header: string;\n  sortable?: boolean;\n  filterable?: boolean;\n  render?: (item: T, value: any) => React.ReactNode;\n  accessor?: (item: T) => any;\n}\n\nexport interface UseDataTableProps<T> {\n  data: T[];\n  columns: Column<T>[];\n  itemsPerPage?: number;\n}\n\nexport type SortDirection = 'asc' | 'desc';\n\nexport function useDataTable<T>({ data, columns, itemsPerPage = 20 }: UseDataTableProps<T>) {\n  const [currentPage, setCurrentPage] = useState(1);\n  const [sortField, setSortField] = useState<string | null>(null);\n  const [sortDirection, setSortDirection] = useState<SortDirection>('asc');\n  const [filters, setFilters] = useState<Record<string, string>>({});\n\n  const getValue = (item: T, column: Column<T>) => {\n    if (column.accessor) {\n      return column.accessor(item);\n    }\n    if (typeof column.key === 'string' && column.key.includes('.')) {\n      const keys = column.key.split('.');\n      let value: any = item;\n      for (const key of keys) {\n        value = value?.[key];\n      }\n      return value;\n    }\n    return item[column.key as keyof T];\n  };\n\n  const filteredAndSortedData = useMemo(() => {\n    let filtered = data;\n\n    // Apply filters\n    Object.entries(filters).forEach(([columnKey, filterValue]) => {\n      if (filterValue.trim()) {\n        const column = columns.find(col => col.key === columnKey);\n        if (column) {\n          filtered = filtered.filter(item => {\n            const value = getValue(item, column);\n            const stringValue = String(value || '').toLowerCase();\n            return stringValue.includes(filterValue.toLowerCase());\n          });\n        }\n      }\n    });\n\n    // Apply sorting\n    if (sortField) {\n      const column = columns.find(col => col.key === sortField);\n      if (column) {\n        filtered.sort((a, b) => {\n          let aValue = getValue(a, column);\n          let bValue = getValue(b, column);\n\n          // Handle dates\n          if (aValue instanceof Date && bValue instanceof Date) {\n            aValue = aValue.getTime();\n            bValue = bValue.getTime();\n          } else if (typeof aValue === 'string' && typeof bValue === 'string') {\n            // Check if it's a date string\n            const aDate = new Date(aValue);\n            const bDate = new Date(bValue);\n            if (!isNaN(aDate.getTime()) && !isNaN(bDate.getTime())) {\n              aValue = aDate.getTime();\n              bValue = bDate.getTime();\n            } else {\n              aValue = aValue.toLowerCase();\n              bValue = bValue.toLowerCase();\n            }\n          }\n\n          // Handle null/undefined values\n          if (aValue == null && bValue == null) return 0;\n          if (aValue == null) return 1;\n          if (bValue == null) return -1;\n\n          if (aValue < bValue) return sortDirection === 'asc' ? -1 : 1;\n          if (aValue > bValue) return sortDirection === 'asc' ? 1 : -1;\n          return 0;\n        });\n      }\n    }\n\n    return filtered;\n  }, [data, filters, sortField, sortDirection, columns]);\n\n  // Pagination\n  const totalPages = Math.ceil(filteredAndSortedData.length / itemsPerPage);\n  const startIndex = (currentPage - 1) * itemsPerPage;\n  const paginatedData = filteredAndSortedData.slice(startIndex, startIndex + itemsPerPage);\n\n  const handleSort = (field: string) => {\n    if (sortField === field) {\n      setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');\n    } else {\n      setSortField(field);\n      setSortDirection('asc');\n    }\n  };\n\n  const handleFilter = (columnKey: string, value: string) => {\n    setFilters(prev => ({\n      ...prev,\n      [columnKey]: value\n    }));\n    setCurrentPage(1); // Reset to first page when filtering\n  };\n\n  const handlePageChange = (page: number) => {\n    setCurrentPage(page);\n  };\n\n  const resetFilters = () => {\n    setFilters({});\n    setCurrentPage(1);\n  };\n\n  return {\n    // Data\n    paginatedData,\n    filteredAndSortedData,\n    totalItems: filteredAndSortedData.length,\n    \n    // Pagination\n    currentPage,\n    totalPages,\n    itemsPerPage,\n    startIndex: startIndex + 1,\n    endIndex: Math.min(startIndex + itemsPerPage, filteredAndSortedData.length),\n    \n    // Sorting\n    sortField,\n    sortDirection,\n    \n    // Filtering\n    filters,\n    \n    // Actions\n    handleSort,\n    handleFilter,\n    handlePageChange,\n    resetFilters,\n    \n    // Utilities\n    getValue,\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useDebounce.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useEntityActions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useEntityData.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[229,232],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[229,232],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a spread element in its dependency array. This means we can't statically verify whether you've passed the correct dependencies.","line":57,"column":18,"nodeType":"SpreadElement","endLine":57,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\nimport { toast } from '@/hooks/use-toast';\n\nexport interface UseEntityDataOptions<T> {\n  fetchFn: () => Promise<T[]>;\n  onError?: (error: Error) => void;\n  dependencies?: any[];\n}\n\nexport interface EntityDataState<T> {\n  data: T[];\n  loading: boolean;\n  error: string | null;\n  refetch: () => Promise<void>;\n  refresh: () => void;\n}\n\nexport function useEntityData<T>({\n  fetchFn,\n  onError,\n  dependencies = []\n}: UseEntityDataOptions<T>): EntityDataState<T> {\n  const [data, setData] = useState<T[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const fetchData = useCallback(async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      const result = await fetchFn();\n      setData(result);\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'An unknown error occurred';\n      setError(errorMessage);\n      \n      if (onError) {\n        onError(err instanceof Error ? err : new Error(errorMessage));\n      } else {\n        toast({\n          title: \"Error\",\n          description: errorMessage,\n          variant: \"destructive\",\n        });\n      }\n    } finally {\n      setLoading(false);\n    }\n  }, [fetchFn, onError]);\n\n  const refresh = useCallback(() => {\n    fetchData();\n  }, [fetchData]);\n\n  useEffect(() => {\n    fetchData();\n  }, [fetchData, ...dependencies]);\n\n  return {\n    data,\n    loading,\n    error,\n    refetch: fetchData,\n    refresh\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useKanbanSettings.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useLeadActions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useLeadDetailData.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1240,1243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1240,1243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useMemo } from \"react\";\nimport { useQuery, UseQueryResult } from \"@tanstack/react-query\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\nimport {\n  fetchLeadById,\n  fetchLeadSessions,\n  fetchLeadProjectSummary,\n  fetchLatestLeadActivity,\n  LeadDetailRecord,\n  LeadSessionRecord,\n  LeadProjectSummaryPayload,\n  AggregatedPaymentSummary,\n  ProjectSummary\n} from \"@/services/LeadDetailService\";\nimport { useLeadStatuses } from \"./useOrganizationData\";\n\nconst ACTIVE_SESSION_STATUSES = new Set([\"planned\", \"upcoming\", \"confirmed\", \"scheduled\"]);\n\ninterface SessionMetrics {\n  todayCount: number;\n  todayNext: LeadSessionRecord | null;\n  nextUpcoming: LeadSessionRecord | null;\n  overdueCount: number;\n}\n\nexport interface LeadDetailQueryResult {\n  lead: LeadDetailRecord | null;\n  leadQuery: UseQueryResult<LeadDetailRecord | null, unknown>;\n  sessions: LeadSessionRecord[];\n  sessionsQuery: UseQueryResult<LeadSessionRecord[], unknown>;\n  projectSummary: ProjectSummary;\n  aggregatedPayments: AggregatedPaymentSummary;\n  summaryQuery: UseQueryResult<LeadProjectSummaryPayload, unknown>;\n  latestLeadActivity: string | null;\n  latestActivityQuery: UseQueryResult<string | null, unknown>;\n  leadStatuses: any[];\n  sessionMetrics: SessionMetrics;\n  latestSessionUpdate: string | null;\n  hasProjects: boolean;\n  isLoading: boolean;\n  refetchAll: () => Promise<void>;\n}\n\nconst DEFAULT_SUMMARY: ProjectSummary = { count: 0, latestUpdate: null };\nconst DEFAULT_PAYMENTS: AggregatedPaymentSummary = {\n  totalPaid: 0,\n  total: 0,\n  remaining: 0,\n  currency: \"TRY\"\n};\nconst DEFAULT_METRICS: SessionMetrics = {\n  todayCount: 0,\n  todayNext: null,\n  nextUpcoming: null,\n  overdueCount: 0\n};\n\nfunction sortSessions(sessions: LeadSessionRecord[]): LeadSessionRecord[] {\n  const sorted = [...sessions];\n\n  sorted.sort((a, b) => {\n    const aStatus = (a.status || \"\").toLowerCase();\n    const bStatus = (b.status || \"\").toLowerCase();\n\n    const aIsPlanned = aStatus === \"planned\";\n    const bIsPlanned = bStatus === \"planned\";\n\n    if (aIsPlanned !== bIsPlanned) {\n      return aIsPlanned ? -1 : 1;\n    }\n\n    const aDate = a.session_date ? new Date(a.session_date).getTime() : 0;\n    const bDate = b.session_date ? new Date(b.session_date).getTime() : 0;\n\n    return bDate - aDate;\n  });\n\n  return sorted;\n}\n\nfunction computeSessionMetrics(sessions: LeadSessionRecord[]): SessionMetrics {\n  if (!sessions.length) {\n    return DEFAULT_METRICS;\n  }\n\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  const todayKey = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, \"0\")}-${String(\n    today.getDate()\n  ).padStart(2, \"0\")}`;\n\n  const activeSessions = sessions\n    .map((session) => {\n      if (!session.session_date) return null;\n      const normalizedStatus = (session.status || \"\").toLowerCase();\n      if (!ACTIVE_SESSION_STATUSES.has(normalizedStatus)) return null;\n\n      const date = (() => {\n        const timePart = (session.session_time ?? \"\").trim();\n        if (timePart) {\n          const candidate = new Date(`${session.session_date}T${timePart}`);\n          if (!Number.isNaN(candidate.getTime())) return candidate;\n        }\n\n        const fallback = new Date(session.session_date);\n        return Number.isNaN(fallback.getTime()) ? null : fallback;\n      })();\n\n      if (!date) return null;\n      return { session, date };\n    })\n    .filter((value): value is { session: LeadSessionRecord; date: Date } => Boolean(value))\n    .sort((a, b) => a.date.getTime() - b.date.getTime());\n\n  const todays: LeadSessionRecord[] = [];\n  let nextUpcoming: LeadSessionRecord | null = null;\n  let overdueCount = 0;\n\n  for (const entry of activeSessions) {\n    const sessionKey = entry.session.session_date\n      ? entry.session.session_date.slice(0, 10)\n      : null;\n\n    if (!sessionKey) continue;\n\n    if (sessionKey < todayKey) {\n      overdueCount += 1;\n      continue;\n    }\n\n    if (sessionKey === todayKey) {\n      todays.push(entry.session);\n      continue;\n    }\n\n    if (!nextUpcoming) {\n      nextUpcoming = entry.session;\n    }\n  }\n\n  return {\n    todayCount: todays.length,\n    todayNext: todays[0] ?? null,\n    nextUpcoming,\n    overdueCount\n  };\n}\n\nfunction computeLatestSessionUpdate(sessions: LeadSessionRecord[]): string | null {\n  if (!sessions.length) return null;\n\n  return sessions.reduce<string | null>((latest, session) => {\n    const candidate = session.updated_at || session.created_at || null;\n    if (!candidate) return latest;\n    if (!latest) return candidate;\n    return new Date(candidate).getTime() > new Date(latest).getTime() ? candidate : latest;\n  }, null);\n}\n\nexport function useLeadDetailData(leadId?: string): LeadDetailQueryResult {\n  const { activeOrganizationId, loading: orgLoading } = useOrganization();\n  const {\n    data: leadStatuses = [],\n    isLoading: statusesLoading\n  } = useLeadStatuses();\n\n  const leadQuery = useQuery({\n    queryKey: [\"lead\", leadId],\n    queryFn: () => fetchLeadById(leadId!),\n    enabled: !!leadId,\n    staleTime: 5 * 60 * 1000\n  });\n\n  const sessionsQuery = useQuery({\n    queryKey: [\"lead\", leadId, \"sessions\", activeOrganizationId],\n    queryFn: () => fetchLeadSessions(leadId!, activeOrganizationId),\n    enabled: !!leadId && !orgLoading,\n    staleTime: 2 * 60 * 1000\n  });\n\n  const summaryQuery = useQuery({\n    queryKey: [\"lead\", leadId, \"project-summary\", activeOrganizationId],\n    queryFn: () => fetchLeadProjectSummary(leadId!, activeOrganizationId!),\n    enabled: !!leadId && !!activeOrganizationId,\n    staleTime: 2 * 60 * 1000\n  });\n\n  const latestActivityQuery = useQuery({\n    queryKey: [\"lead\", leadId, \"latest-activity\"],\n    queryFn: () => fetchLatestLeadActivity(leadId!),\n    enabled: !!leadId,\n    staleTime: 60 * 1000\n  });\n\n  const sessions = useMemo(() => {\n    if (!sessionsQuery.data) return [];\n    return sortSessions(sessionsQuery.data).map((session) => ({\n      ...session,\n      project_name: session.projects?.name ?? undefined\n    }));\n  }, [sessionsQuery.data]);\n\n  const sessionMetrics = useMemo(() => computeSessionMetrics(sessions), [sessions]);\n  const latestSessionUpdate = useMemo(() => computeLatestSessionUpdate(sessions), [sessions]);\n\n  const projectSummary = summaryQuery.data?.summary ?? DEFAULT_SUMMARY;\n  const aggregatedPayments = summaryQuery.data?.payments ?? DEFAULT_PAYMENTS;\n\n  const isLoading =\n    leadQuery.isLoading ||\n    sessionsQuery.isLoading ||\n    summaryQuery.isLoading ||\n    latestActivityQuery.isLoading ||\n    statusesLoading ||\n    orgLoading;\n\n  const refetchAll = useCallback(async () => {\n    await Promise.all([\n      leadQuery.refetch(),\n      sessionsQuery.refetch(),\n      summaryQuery.refetch(),\n      latestActivityQuery.refetch()\n    ]);\n  }, [leadQuery, sessionsQuery, summaryQuery, latestActivityQuery]);\n\n  return {\n    lead: leadQuery.data ?? null,\n    leadQuery,\n    sessions,\n    sessionsQuery,\n    projectSummary,\n    aggregatedPayments,\n    summaryQuery,\n    latestLeadActivity: latestActivityQuery.data ?? null,\n    latestActivityQuery,\n    leadStatuses,\n    sessionMetrics,\n    latestSessionUpdate,\n    hasProjects: summaryQuery.data?.hasProjects ?? false,\n    isLoading,\n    refetchAll\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useLeadFieldDefinitions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useLeadFieldValues.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useLeadStatusActions.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3081,3084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3081,3084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3397,3400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3397,3400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { ToastAction } from \"@/components/ui/toast\";\n\ninterface UseLeadStatusActionsProps {\n  leadId: string;\n  onStatusChange: () => void;\n}\n\nexport function useLeadStatusActions({ leadId, onStatusChange }: UseLeadStatusActionsProps) {\n  const [isUpdating, setIsUpdating] = useState(false);\n  const { toast } = useToast();\n\n  const updateLeadStatus = async (newStatusName: string, previousStatus?: string) => {\n    setIsUpdating(true);\n    try {\n      const { data: userData } = await supabase.auth.getUser();\n      if (!userData.user) throw new Error('User not authenticated');\n\n      // Ensure system statuses exist for this user\n      await supabase.rpc('ensure_system_lead_statuses', {\n        user_uuid: userData.user.id\n      });\n\n      // Find the status by name to get the ID\n      const { data: statusData, error: statusError } = await supabase\n        .from('lead_statuses')\n        .select('id, name')\n        .eq('user_id', userData.user.id)\n        .eq('name', newStatusName)\n        .maybeSingle();\n\n      if (statusError) throw statusError;\n      if (!statusData) throw new Error('Status not found');\n\n      const { error } = await supabase\n        .from('leads')\n        .update({ \n          status_id: statusData.id,\n          status: newStatusName // Keep text field updated for backward compatibility\n        })\n        .eq('id', leadId);\n\n      if (error) throw error;\n\n      onStatusChange();\n\n      // Show toast with undo functionality\n      const undoRef = { current: false };\n      \n      toast({\n        title: \"Status Updated\",\n        description: `Lead marked as ${newStatusName}`,\n        action: previousStatus ? (\n          <ToastAction\n            altText=\"Undo status change\"\n            onClick={async () => {\n              if (undoRef.current) return; // Prevent multiple clicks\n              undoRef.current = true;\n              \n              try {\n                // Find the previous status by name to get the ID\n                const { data: prevStatusData, error: prevStatusError } = await supabase\n                  .from('lead_statuses')\n                  .select('id, name')\n                  .eq('user_id', userData.user.id)\n                  .eq('name', previousStatus)\n                  .maybeSingle();\n\n                if (prevStatusError) throw prevStatusError;\n                if (!prevStatusData) throw new Error('Previous status not found');\n\n                const { error: undoError } = await supabase\n                  .from('leads')\n                  .update({ \n                    status_id: prevStatusData.id,\n                    status: previousStatus \n                  })\n                  .eq('id', leadId);\n\n                if (undoError) throw undoError;\n\n                onStatusChange();\n                toast({\n                  title: \"Undone\",\n                  description: `Status reverted to ${previousStatus}`\n                });\n              } catch (error: any) {\n                toast({\n                  title: \"Undo failed\",\n                  description: error.message,\n                  variant: \"destructive\"\n                });\n              }\n            }}\n          >\n            Undo\n          </ToastAction>\n        ) : undefined\n      });\n\n    } catch (error: any) {\n      toast({\n        title: \"Error updating status\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsUpdating(false);\n    }\n  };\n\n  const markAsCompleted = (previousStatus?: string, customCompletedLabel?: string) => \n    updateLeadStatus(customCompletedLabel || 'Completed', previousStatus);\n\n  const markAsLost = (previousStatus?: string, customLostLabel?: string) => \n    updateLeadStatus(customLostLabel || 'Lost', previousStatus);\n\n  return {\n    markAsCompleted,\n    markAsLost,\n    isUpdating\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useLeadStatusWorkflows.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[428,431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[428,431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useWorkflowTriggers } from '@/hooks/useWorkflowTriggers';\n\nexport function useLeadStatusWorkflows() {\n  const { triggerLeadStatusChange } = useWorkflowTriggers();\n\n  const triggerLeadStatusWorkflow = async (\n    leadId: string,\n    organizationId: string,\n    oldStatusName: string,\n    newStatusName: string,\n    leadData?: any\n  ) => {\n    try {\n      await triggerLeadStatusChange(leadId, organizationId, oldStatusName, newStatusName, leadData);\n    } catch (error) {\n      console.error('Error triggering lead status workflow:', error);\n    }\n  };\n\n  return {\n    triggerLeadStatusWorkflow\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useLeadTableColumns.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useLeadUpdate.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[563,566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[563,566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface UseLeadUpdateProps {\n  leadId: string;\n  onSuccess?: () => void;\n}\n\nexport function useLeadUpdate({ leadId, onSuccess }: UseLeadUpdateProps) {\n  const [isUpdating, setIsUpdating] = useState(false);\n  const { toast } = useToast();\n\n  const updateCoreField = async (fieldKey: string, value: string | null) => {\n    if (isUpdating) return;\n    \n    setIsUpdating(true);\n    try {\n      const updates: Record<string, any> = {\n        [fieldKey]: value || null,\n        updated_at: new Date().toISOString()\n      };\n\n      const { error } = await supabase\n        .from('leads')\n        .update(updates)\n        .eq('id', leadId);\n\n      if (error) throw error;\n\n      toast({\n        title: \"Field updated\",\n        description: \"The field has been updated successfully.\",\n      });\n\n      onSuccess?.();\n    } catch (error) {\n      console.error('Error updating core field:', error);\n      toast({\n        title: \"Update failed\",\n        description: \"Failed to update the field. Please try again.\",\n        variant: \"destructive\",\n      });\n      throw error;\n    } finally {\n      setIsUpdating(false);\n    }\n  };\n\n  const updateCustomField = async (fieldKey: string, value: string | null) => {\n    if (isUpdating) return;\n    \n    setIsUpdating(true);\n    try {\n      const { error } = await supabase\n        .from('lead_field_values')\n        .upsert({\n          lead_id: leadId,\n          field_key: fieldKey,\n          value: value || null,\n          updated_at: new Date().toISOString()\n        }, {\n          onConflict: 'lead_id,field_key'\n        });\n\n      if (error) throw error;\n\n      toast({\n        title: \"Field updated\",\n        description: \"The custom field has been updated successfully.\",\n      });\n\n      onSuccess?.();\n    } catch (error) {\n      console.error('Error updating custom field:', error);\n      toast({\n        title: \"Update failed\",\n        description: \"Failed to update the custom field. Please try again.\",\n        variant: \"destructive\",\n      });\n      throw error;\n    } finally {\n      setIsUpdating(false);\n    }\n  };\n\n  return {\n    isUpdating,\n    updateCoreField,\n    updateCustomField\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useLeadsWithCustomFields.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchLeadsWithCustomFields'. Either include it or remove the dependency array.","line":95,"column":6,"nodeType":"ArrayExpression","endLine":95,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchLeadsWithCustomFields]","fix":{"range":[2882,2884],"text":"[fetchLeadsWithCustomFields]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { getUserOrganizationId } from '@/lib/organizationUtils';\nimport { useToast } from '@/hooks/use-toast';\n\nexport interface LeadWithCustomFields {\n  id: string;\n  name: string;\n  email: string;\n  phone: string;\n  status: string;\n  status_id: string;\n  updated_at: string;\n  created_at: string;\n  due_date?: string;\n  notes?: string;\n  custom_fields: Record<string, string | null>;\n  lead_statuses?: {\n    id: string;\n    name: string;\n    color: string;\n    is_system_final: boolean;\n  };\n}\n\nexport function useLeadsWithCustomFields() {\n  const [leads, setLeads] = useState<LeadWithCustomFields[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const { toast } = useToast();\n\n  const fetchLeadsWithCustomFields = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) {\n        throw new Error('No active organization found');\n      }\n\n      // Fetch leads with status information\n      const { data: leadsData, error: leadsError } = await supabase\n        .from('leads')\n        .select(`\n          *,\n          lead_statuses(id, name, color, is_system_final)\n        `)\n        .eq('organization_id', organizationId)\n        .order('updated_at', { ascending: false });\n\n      if (leadsError) throw leadsError;\n\n      // Fetch all custom field values for these leads\n      const leadIds = leadsData?.map(lead => lead.id) || [];\n      const { data: fieldValues, error: fieldValuesError } = await supabase\n        .from('lead_field_values')\n        .select('lead_id, field_key, value')\n        .in('lead_id', leadIds);\n\n      if (fieldValuesError) throw fieldValuesError;\n\n      // Group field values by lead_id\n      const fieldValuesByLead = (fieldValues || []).reduce((acc, fv) => {\n        if (!acc[fv.lead_id]) {\n          acc[fv.lead_id] = {};\n        }\n        acc[fv.lead_id][fv.field_key] = fv.value;\n        return acc;\n      }, {} as Record<string, Record<string, string | null>>);\n\n      // Combine leads with their custom field values\n      const leadsWithFields: LeadWithCustomFields[] = (leadsData || []).map(lead => ({\n        ...lead,\n        custom_fields: fieldValuesByLead[lead.id] || {},\n      }));\n\n      setLeads(leadsWithFields);\n    } catch (err) {\n      console.error('Error fetching leads with custom fields:', err);\n      const errorMessage = err instanceof Error ? err.message : 'Failed to fetch leads';\n      setError(errorMessage);\n      toast({\n        title: \"Error fetching leads\",\n        description: errorMessage,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchLeadsWithCustomFields();\n  }, []);\n\n  return {\n    leads,\n    loading,\n    error,\n    refetch: fetchLeadsWithCustomFields\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useLifecycle.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useMilestoneNotifications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useModalNavigation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useNotificationTriggers.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1498,1501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1498,1501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2338,2341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2338,2341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3309,3312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3309,3312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4243,4246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4243,4246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport function useNotificationTriggers() {\n  const { toast } = useToast();\n\n  // Trigger project milestone notification\n  const triggerProjectMilestone = async (\n    projectId: string,\n    oldStatusId: string,\n    newStatusId: string,\n    organizationId: string\n  ) => {\n    try {\n      console.log(`Triggering milestone notification: ${projectId} (${oldStatusId} â†’ ${newStatusId})`);\n\n      // Get current user for changed_by_user_id\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) {\n        console.error('No authenticated user for milestone notification');\n        return;\n      }\n\n      // Fetch status names from IDs\n      const { data: oldStatus } = await supabase\n        .from('project_statuses')\n        .select('name')\n        .eq('id', oldStatusId)\n        .single();\n        \n      const { data: newStatus } = await supabase\n        .from('project_statuses')\n        .select('name, lifecycle')\n        .eq('id', newStatusId)\n        .single();\n\n      if (!oldStatus || !newStatus) {\n        console.error('Could not fetch status names for milestone notification');\n        return;\n      }\n\n      // Single photographer mode: notifications disabled, only log intent\n      console.log(\n        `Milestone change recorded for project ${projectId}: ${oldStatus.name} â†’ ${newStatus.name} (organization ${organizationId})`\n      );\n    } catch (error: any) {\n      console.error('Error in triggerProjectMilestone:', error);\n      toast({\n        title: \"Notification Error\",\n        description: \"Failed to send milestone notification\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n\n  // Schedule daily summary notifications for tomorrow\n  const scheduleDailySummaries = async (organizationId?: string) => {\n    try {\n      console.log('Scheduling daily summary notifications');\n\n      const { error } = await supabase.functions.invoke('notification-processor', {\n        body: {\n          action: 'schedule-notification',\n          organizationId: organizationId\n        }\n      });\n\n      if (error) {\n        console.error('Error scheduling daily summaries:', error);\n        throw error;\n      }\n\n      console.log('Daily summaries scheduled successfully');\n\n    } catch (error: any) {\n      console.error('Error in scheduleDailySummaries:', error);\n      toast({\n        title: \"Scheduling Error\",\n        description: \"Failed to schedule daily summaries\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Process pending notifications manually\n  const processPendingNotifications = async (organizationId?: string) => {\n    try {\n      console.log('Processing pending notifications');\n\n      const { data, error } = await supabase.functions.invoke('notification-processor', {\n        body: {\n          action: 'process-pending',\n          organizationId: organizationId,\n          force: true\n        }\n      });\n\n      if (error) {\n        console.error('Error processing notifications:', error);\n        throw error;\n      }\n\n      console.log('Processed notifications:', data);\n      \n      toast({\n        title: \"Success\",\n        description: `Processed ${data?.result?.processed || 0} notifications`,\n      });\n\n    } catch (error: any) {\n      console.error('Error in processPendingNotifications:', error);\n      toast({\n        title: \"Processing Error\",\n        description: \"Failed to process notifications\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Retry failed notifications\n  const retryFailedNotifications = async (organizationId?: string) => {\n    try {\n      console.log('Retrying failed notifications');\n\n      const { data, error } = await supabase.functions.invoke('notification-processor', {\n        body: {\n          action: 'retry-failed',\n          organizationId: organizationId\n        }\n      });\n\n      if (error) {\n        console.error('Error retrying notifications:', error);\n        throw error;\n      }\n\n      console.log('Retried notifications:', data);\n      \n      toast({\n        title: \"Success\",\n        description: `Retried ${data?.result?.retried_count || 0} failed notifications`,\n      });\n\n    } catch (error: any) {\n      console.error('Error in retryFailedNotifications:', error);\n      toast({\n        title: \"Retry Error\",\n        description: \"Failed to retry notifications\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return {\n    triggerProjectMilestone,\n    scheduleDailySummaries,\n    processPendingNotifications,\n    retryFailedNotifications\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useOnboardingBulletproofTest.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4986,4989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4986,4989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// V3 BULLETPROOF TEST FOR ONBOARDING SYSTEM\n// This file comprehensively tests all critical paths and edge cases\n\nimport { ONBOARDING_STEPS, TOTAL_STEPS } from \"@/constants/onboarding\";\n\nexport const runOnboardingBulletproofTestV3 = () => {\n  // Development-only test suite for onboarding system\n  if (process.env.NODE_ENV !== 'development') return;\n  \n  // Test 1: Verify step definitions\n  console.log(`âœ… Step Count: ${TOTAL_STEPS} steps defined`);\n  console.log(`âœ… Steps Array Length: ${ONBOARDING_STEPS.length}`);\n  console.log(`âœ… Steps Match: ${TOTAL_STEPS === ONBOARDING_STEPS.length ? 'PASS' : 'FAIL'}`);\n  \n  // Test 2: Verify all steps have required properties\n  ONBOARDING_STEPS.forEach((step, index) => {\n    const hasRequiredProps = step.id && step.title && step.description && step.route && step.buttonText && step.duration;\n    console.log(`âœ… Step ${index + 1} completeness: ${hasRequiredProps ? 'PASS' : 'FAIL'}`);\n  });\n  \n  // Test 3: Verify step IDs are sequential\n  const sequentialIds = ONBOARDING_STEPS.every((step, index) => step.id === index + 1);\n  console.log(`âœ… Sequential Step IDs: ${sequentialIds ? 'PASS' : 'FAIL'}`);\n  \n  // Test 4: V3 Critical flow tests \n  const v3CriticalFlows = [\n    'ðŸŽ¯ NEW USER FLOW:',\n    '  - New user â†’ Welcome modal appears â†’ Start guided setup â†’ Navigate to getting-started',\n    '  - New user â†’ Welcome modal appears â†’ Close modal â†’ Modal marked as shown (no re-show)',\n    '  - New user â†’ Welcome modal appears â†’ Skip with sample data â†’ Navigate to dashboard',\n    'ðŸ”„ RESTART FLOW:',\n    '  - Restart button â†’ Direct guided setup (bypass modal) â†’ Navigate to getting-started',\n    '  - No modal flickering or race conditions during restart',\n    'ðŸšª EXIT FLOW:',\n    '  - Exit button â†’ Complete onboarding â†’ Auto-redirect (no manual navigation)',\n    '  - No flickering or navigation loops',\n    'ðŸ”’ SESSION MANAGEMENT:',\n    '  - Modal shown once per session â†’ Session tracking prevents re-show',\n    '  - Page refresh â†’ Session state reset â†’ Modal can show again if needed',\n    'âš¡ STATE TRANSITIONS:',\n    '  - not_started â†’ in_progress (via startGuidedSetup)',\n    '  - in_progress â†’ completed (via completeOnboarding)',\n    '  - any_state â†’ in_progress (via resetOnboarding with bypass)',\n    '  - Atomic database updates prevent race conditions'\n  ];\n  \n  console.log('\\nðŸŽ¯ V3 CRITICAL FLOWS TO TEST:');\n  v3CriticalFlows.forEach((flow, index) => {\n    if (flow.startsWith('ðŸŽ¯') || flow.startsWith('ðŸ”„') || flow.startsWith('ðŸšª') || flow.startsWith('ðŸ”’') || flow.startsWith('âš¡')) {\n      console.log(`\\n${flow}`);\n    } else {\n      console.log(`${flow}`);\n    }\n  });\n  \n  // Test 5: V3 Enhanced edge cases\n  const v3EdgeCases = [\n    'User manually changes database onboarding_stage during session',\n    'User has invalid current_onboarding_step value (sanitized automatically)',\n    'Database connection fails during state fetch (graceful fallback)',\n    'User_settings record doesn\\'t exist (auto-created with defaults)',\n    'Step completion called when not in guided setup (safely ignored)', \n    'Step completion called beyond total steps (range validation)',\n    'Multiple rapid step completions (atomic updates prevent conflicts)',\n    'Page refresh during onboarding (session state reset)',\n    'Navigation while in guided setup (route protection active)',\n    'Modal closed without action (session tracking prevents re-show)',\n    'Restart during active guided setup (direct bypass to guided mode)',\n    'Exit during tutorial steps (completes onboarding properly)',\n    'Multiple browser tabs with same user (state synchronization)',\n    'Network interruption during state updates (error handling)',\n    'Component unmount during async operations (cleanup handling)'\n  ];\n  \n  console.log('\\nâš ï¸  V3 EDGE CASES HANDLED:');\n  v3EdgeCases.forEach((edge, index) => {\n    console.log(`${index + 1}. ${edge}`);\n  });\n  \n  // Test 6: V3 Session tracking validation\n  console.log('\\nðŸ” V3 SESSION TRACKING FEATURES:');\n  console.log('1. sessionModalShown flag prevents multiple modal displays');\n  console.log('2. markModalShown() function tracks modal display without starting setup');\n  console.log('3. Session state resets on page refresh (new browser session)');\n  console.log('4. Enhanced shouldShowWelcomeModal includes session tracking');\n  console.log('5. Restart flow bypasses modal entirely via direct guided setup');\n  \n  // Test 7: V3 Enhanced logging\n  console.log('\\nðŸ“ V3 ENHANCED LOGGING:');\n  console.log('1. All state transitions logged with V3 prefix');\n  console.log('2. Component-level logging for modal display logic');\n  console.log('3. Button-level logging for user actions');\n  console.log('4. Database operation logging with error details');\n  console.log('5. Session tracking logging for debugging');\n  \n  console.log('\\nâœ… V3 BULLETPROOF SYSTEM READY - NO MORE MODAL FLICKERING!');\n  return true;\n};\n\n// Export for testing in development\nif (typeof window !== 'undefined') {\n  (window as any).testOnboardingV3 = runOnboardingBulletproofTestV3;\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useOptimizedCalendarData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useOptimizedCalendarEvents.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useOptimizedCalendarNavigation.ts","messages":[{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":60,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":60,"endColumn":67,"suggestions":[{"messageId":"addBrackets","fix":{"range":[1787,2046],"text":"{ const weekStart = getStartOfWeek(currentDate, userLocale);\n        const weekEnd = getEndOfWeek(currentDate, userLocale);\n        return `${format(weekStart, \"MMM d\", { locale: dateFnsLocale })} - ${format(weekEnd, \"MMM d, yyyy\", { locale: dateFnsLocale })}`; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":61,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":61,"endColumn":63,"suggestions":[{"messageId":"addBrackets","fix":{"range":[1787,2046],"text":"{ const weekStart = getStartOfWeek(currentDate, userLocale);\n        const weekEnd = getEndOfWeek(currentDate, userLocale);\n        return `${format(weekStart, \"MMM d\", { locale: dateFnsLocale })} - ${format(weekEnd, \"MMM d, yyyy\", { locale: dateFnsLocale })}`; }"},"desc":"Add {} brackets around the case block."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useMemo } from 'react';\nimport { addDays, addWeeks, addMonths, format } from 'date-fns';\nimport { getUserLocale, getStartOfWeek, getEndOfWeek, getDateFnsLocale } from '@/lib/utils';\n\ntype ViewMode = 'day' | 'week' | 'month';\n\n/**\n * Optimized calendar navigation with memoized calculations\n * Handles date navigation and view title generation efficiently\n */\nexport function useOptimizedCalendarNavigation(\n  currentDate: Date,\n  viewMode: ViewMode,\n  setCurrentDate: (date: Date | ((prev: Date) => Date)) => void\n) {\n  const userLocale = getUserLocale();\n  const dateFnsLocale = getDateFnsLocale();\n\n  // Memoized navigation functions to prevent re-creation on every render\n  const navigatePrevious = useCallback(() => {\n    setCurrentDate(prev => {\n      switch (viewMode) {\n        case \"day\":\n          return addDays(prev, -1);\n        case \"week\":\n          return addWeeks(prev, -1);\n        case \"month\":\n          return addMonths(prev, -1);\n        default:\n          return prev;\n      }\n    });\n  }, [viewMode, setCurrentDate]);\n\n  const navigateNext = useCallback(() => {\n    setCurrentDate(prev => {\n      switch (viewMode) {\n        case \"day\":\n          return addDays(prev, 1);\n        case \"week\":\n          return addWeeks(prev, 1);\n        case \"month\":\n          return addMonths(prev, 1);\n        default:\n          return prev;\n      }\n    });\n  }, [viewMode, setCurrentDate]);\n\n  const goToToday = useCallback(() => {\n    setCurrentDate(new Date());\n  }, [setCurrentDate]);\n\n  // Memoized view title to avoid expensive date formatting on every render\n  const viewTitle = useMemo(() => {\n    switch (viewMode) {\n      case \"day\":\n        return format(currentDate, \"EEEE, MMMM d, yyyy\", { locale: dateFnsLocale });\n      case \"week\":\n        const weekStart = getStartOfWeek(currentDate, userLocale);\n        const weekEnd = getEndOfWeek(currentDate, userLocale);\n        return `${format(weekStart, \"MMM d\", { locale: dateFnsLocale })} - ${format(weekEnd, \"MMM d, yyyy\", { locale: dateFnsLocale })}`;\n      case \"month\":\n        return format(currentDate, \"MMMM yyyy\", { locale: dateFnsLocale });\n      default:\n        return '';\n    }\n  }, [currentDate, viewMode, userLocale, dateFnsLocale]);\n\n  // Memoized keyboard navigation handler\n  const handleKeyboardNavigation = useCallback((e: KeyboardEvent) => {\n    switch (e.key) {\n      case 'ArrowLeft':\n        e.preventDefault();\n        navigatePrevious();\n        break;\n      case 'ArrowRight':\n        e.preventDefault();\n        navigateNext();\n        break;\n      case 'Home':\n        e.preventDefault();\n        goToToday();\n        break;\n      case 'Escape':\n        e.preventDefault();\n        // Could be used to close modals or reset view\n        break;\n    }\n  }, [navigatePrevious, navigateNext, goToToday]);\n\n  return {\n    navigatePrevious,\n    navigateNext,\n    goToToday,\n    viewTitle,\n    handleKeyboardNavigation\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useOptimizedCalendarViewport.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useOptimizedTouchHandlers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useOptimizedViewport.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useOrganizationData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useOrganizationQuickSettings.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useOrganizationSettings.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":152,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4701,4704],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4701,4704],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":244,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":244,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7483,7486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7483,7486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":291,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8723,8726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8723,8726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo, useCallback } from \"react\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { detectBrowserTimezone } from \"@/lib/dateFormatUtils\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\nimport {\n  fetchOrganizationSettingsWithCache,\n  getOrganizationSettingsFromCache,\n  setOrganizationSettingsCache,\n  CachedOrganizationSettings,\n  DEFAULT_ORGANIZATION_TAX_PROFILE,\n  OrganizationTaxProfile,\n  ORGANIZATION_SETTINGS_CACHE_TTL,\n} from \"@/lib/organizationSettingsCache\";\n\nexport interface SocialChannel {\n  name: string;\n  url: string;\n  platform:\n    | \"website\"\n    | \"facebook\"\n    | \"instagram\"\n    | \"twitter\"\n    | \"linkedin\"\n    | \"youtube\"\n    | \"tiktok\"\n    | \"custom\";\n  customPlatformName?: string;\n  enabled: boolean;\n  icon?: string;\n  order: number;\n}\n\nexport interface OrganizationSettings extends CachedOrganizationSettings {\n  socialChannels?: Record<string, SocialChannel>;\n  taxProfile?: OrganizationTaxProfile;\n}\n\nconst DEFAULT_SOCIAL_CHANNELS: Record<string, SocialChannel> = {};\nconst normalizeSettings = (\n  settings: CachedOrganizationSettings | null\n): OrganizationSettings | null => {\n  if (!settings) return null;\n  const socialChannels =\n    (settings.social_channels as Record<string, SocialChannel> | null) ||\n    DEFAULT_SOCIAL_CHANNELS;\n  const rawProfile = settings.tax_profile as OrganizationTaxProfile | null;\n  const taxProfile: OrganizationTaxProfile = {\n    ...DEFAULT_ORGANIZATION_TAX_PROFILE,\n    ...(rawProfile ?? {}),\n    companyName:\n      rawProfile?.companyName ??\n      settings.photography_business_name ??\n      DEFAULT_ORGANIZATION_TAX_PROFILE.companyName,\n  };\n\n  return {\n    ...settings,\n    socialChannels,\n    taxProfile,\n  };\n};\n\nexport const useOrganizationSettings = () => {\n  const { activeOrganizationId } = useOrganization();\n  const [uploading, setUploading] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const cachedSnapshot = useMemo(\n    () =>\n      activeOrganizationId\n        ? getOrganizationSettingsFromCache(activeOrganizationId)\n        : null,\n    [activeOrganizationId]\n  );\n\n  const { data, isLoading } = useQuery({\n    queryKey: [\"organization_settings\", activeOrganizationId],\n    queryFn: async () => {\n      if (!activeOrganizationId) return null;\n      const detectedTimezone =\n        typeof window !== \"undefined\" ? detectBrowserTimezone() : undefined;\n      return fetchOrganizationSettingsWithCache(activeOrganizationId, {\n        detectedTimezone,\n      });\n    },\n    enabled: !!activeOrganizationId,\n    staleTime: ORGANIZATION_SETTINGS_CACHE_TTL,\n    initialData: cachedSnapshot ?? undefined,\n  });\n\n  const settings = useMemo(() => normalizeSettings(data), [data]);\n\n  const updateSettings = useCallback(\n    async (updates: Partial<OrganizationSettings>) => {\n      try {\n        const {\n          data: { user },\n          error: authError,\n        } = await supabase.auth.getUser();\n        if (authError) throw authError;\n        if (!user) throw new Error(\"User not authenticated\");\n        if (!activeOrganizationId) {\n          throw new Error(\"No active organization found\");\n        }\n\n        const { socialChannels, taxProfile, ...otherUpdates } = updates;\n        const dbUpdates: Record<string, unknown> = { ...otherUpdates };\n        if (socialChannels) {\n          dbUpdates.social_channels = socialChannels;\n        }\n        if (taxProfile) {\n          dbUpdates.tax_profile = taxProfile;\n        } else if (updates.taxProfile === null) {\n          dbUpdates.tax_profile = null;\n        }\n\n        let result;\n        if (settings?.id) {\n          result = await supabase\n            .from(\"organization_settings\")\n            .update(dbUpdates)\n            .eq(\"id\", settings.id)\n            .select(\"*\")\n            .single();\n        } else {\n          result = await supabase\n            .from(\"organization_settings\")\n            .upsert(\n              {\n                organization_id: activeOrganizationId,\n                ...dbUpdates,\n              },\n              { onConflict: \"organization_id\" }\n            )\n            .select(\"*\")\n            .single();\n        }\n\n        if (result.error) throw result.error;\n\n        const updated = result.data as CachedOrganizationSettings;\n        setOrganizationSettingsCache(activeOrganizationId, updated);\n        queryClient.setQueryData(\n          [\"organization_settings\", activeOrganizationId],\n          updated\n        );\n\n        return { success: true, data: normalizeSettings(updated) };\n      } catch (error: any) {\n        console.error(\"Error updating organization settings:\", error);\n        toast({\n          title: \"Error\",\n          description: error.message || \"Failed to update settings\",\n          variant: \"destructive\",\n        });\n        return { success: false, error };\n      }\n    },\n    [activeOrganizationId, queryClient, settings?.id, toast]\n  );\n\n  const refreshSettings = useCallback(async () => {\n    if (!activeOrganizationId) return;\n    const detectedTimezone =\n      typeof window !== \"undefined\" ? detectBrowserTimezone() : undefined;\n    const latest = await fetchOrganizationSettingsWithCache(\n      activeOrganizationId,\n      { force: true, detectedTimezone }\n    );\n    setOrganizationSettingsCache(activeOrganizationId, latest);\n    queryClient.setQueryData(\n      [\"organization_settings\", activeOrganizationId],\n      latest\n    );\n  }, [activeOrganizationId, queryClient]);\n\n  const uploadLogo = useCallback(\n    async (file: File) => {\n      if (!activeOrganizationId) {\n        const error = new Error(\"No active organization found\");\n        toast({\n          title: \"Error\",\n          description: error.message,\n          variant: \"destructive\",\n        });\n        return { success: false, error };\n      }\n\n      try {\n        setUploading(true);\n\n        if (!file.type.startsWith(\"image/\")) {\n          throw new Error(\"File must be an image\");\n        }\n\n        if (file.size > 2 * 1024 * 1024) {\n          throw new Error(\"File size must be less than 2MB\");\n        }\n\n        if (settings?.logo_url) {\n          const urlParts = settings.logo_url.split(\"/\");\n          const oldPath = urlParts.slice(-2).join(\"/\");\n          if (oldPath) {\n            try {\n              await supabase.storage\n                .from(\"business-assets\")\n                .remove([oldPath]);\n            } catch (removeError) {\n              console.warn(\n                \"Failed to remove old logo before uploading new one:\",\n                removeError\n              );\n            }\n          }\n        }\n\n        const fileExt = file.name.split(\".\").pop();\n        const fileName = `logo-${Date.now()}.${fileExt}`;\n        const filePath = `${activeOrganizationId}/${fileName}`;\n\n        const { error: uploadError } = await supabase.storage\n          .from(\"business-assets\")\n          .upload(filePath, file);\n\n        if (uploadError) throw uploadError;\n\n        const {\n          data: { publicUrl },\n        } = supabase.storage.from(\"business-assets\").getPublicUrl(filePath);\n\n        const result = await updateSettings({ logo_url: publicUrl });\n\n        if (result.success) {\n          toast({\n            title: \"Success\",\n            description: \"Logo uploaded successfully\",\n          });\n        }\n\n        return result;\n      } catch (error: any) {\n        console.error(\"Error uploading logo:\", error);\n        toast({\n          title: \"Error\",\n          description: error.message || \"Failed to upload logo\",\n          variant: \"destructive\",\n        });\n        return { success: false, error };\n      } finally {\n        setUploading(false);\n      }\n    },\n    [activeOrganizationId, settings?.logo_url, toast, updateSettings]\n  );\n\n  const deleteLogo = useCallback(async () => {\n    if (!settings?.logo_url) {\n      return { success: true };\n    }\n\n    if (!activeOrganizationId) {\n      const error = new Error(\"No active organization found\");\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n      return { success: false, error };\n    }\n\n    try {\n      const urlParts = settings.logo_url.split(\"/\");\n      const oldPath = urlParts.slice(-2).join(\"/\");\n      if (oldPath) {\n        await supabase.storage.from(\"business-assets\").remove([oldPath]);\n      }\n\n      const result = await updateSettings({ logo_url: null });\n\n      if (result.success) {\n        toast({\n          title: \"Success\",\n          description: \"Logo removed successfully\",\n        });\n      }\n\n      return result;\n    } catch (error: any) {\n      console.error(\"Error deleting logo:\", error);\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete logo\",\n        variant: \"destructive\",\n      });\n      return { success: false, error };\n    }\n  }, [activeOrganizationId, settings?.logo_url, toast, updateSettings]);\n\n  return {\n    settings,\n    loading: isLoading,\n    uploading,\n    updateSettings,\n    uploadLogo,\n    deleteLogo,\n    refreshSettings,\n  };\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useOrganizationTimezone.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useProjectActions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useProjectHeaderSummary.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useProjectPayments.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchPaymentSummary'. Either include it or remove the dependency array.","line":85,"column":6,"nodeType":"ArrayExpression","endLine":85,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [fetchPaymentSummary, projectId, refreshTrigger]","fix":{"range":[2383,2410],"text":"[fetchPaymentSummary, projectId, refreshTrigger]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\n\ninterface PaymentSummary {\n  totalPaid: number;\n  totalProject: number;\n  remaining: number;\n  currency: string;\n}\n\nexport const useProjectPayments = (projectId: string, refreshTrigger?: number) => {\n  const [paymentSummary, setPaymentSummary] = useState<PaymentSummary>({\n    totalPaid: 0,\n    totalProject: 0,\n    remaining: 0,\n    currency: 'TRY',\n  });\n  const [loading, setLoading] = useState(true);\n\n  const fetchPaymentSummary = async () => {\n    try {\n      // Get project base price\n      const { data: projectData, error: projectError } = await supabase\n        .from('projects')\n        .select('base_price')\n        .eq('id', projectId)\n        .single();\n\n      if (projectError) throw projectError;\n\n      // Get total cost of added services\n      const { data: servicesData, error: servicesError } = await supabase\n        .from('project_services')\n        .select(`\n          services!inner (\n            selling_price,\n            price\n          )\n        `)\n        .eq('project_id', projectId);\n\n      if (servicesError) throw servicesError;\n\n      // Get total paid amount\n      const { data: paymentsData, error: paymentsError } = await supabase\n        .from('payments')\n        .select('amount')\n        .eq('project_id', projectId)\n        .eq('status', 'paid');\n\n      if (paymentsError) throw paymentsError;\n\n      const basePrice = projectData?.base_price || 0;\n      const servicesCost = servicesData?.reduce((sum, ps) => {\n        const service = ps.services;\n        const price = service.selling_price || service.price || 0;\n        return sum + Number(price);\n      }, 0) || 0;\n      \n      const totalProject = basePrice + servicesCost;\n      const totalPaid = paymentsData?.reduce((sum, payment) => sum + Number(payment.amount), 0) || 0;\n      const remaining = Math.max(0, totalProject - totalPaid);\n\n      setPaymentSummary({\n        totalPaid,\n        totalProject,\n        remaining,\n        currency: 'TRY',\n      });\n    } catch (error) {\n      console.error('Error fetching payment summary:', error);\n      setPaymentSummary({\n        totalPaid: 0,\n        totalProject: 0,\n        remaining: 0,\n        currency: 'TRY',\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchPaymentSummary();\n  }, [projectId, refreshTrigger]);\n\n  return { paymentSummary, loading, refetch: fetchPaymentSummary };\n};","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useProjectProgress.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTodoProgress'. Either include it or remove the dependency array.","line":43,"column":6,"nodeType":"ArrayExpression","endLine":43,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTodoProgress, projectId, refreshTrigger]","fix":{"range":[1184,1211],"text":"[fetchTodoProgress, projectId, refreshTrigger]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\n\ninterface TodoProgress {\n  total: number;\n  completed: number;\n  percentage: number;\n}\n\nexport const useProjectProgress = (projectId: string, refreshTrigger?: number) => {\n  const [progress, setProgress] = useState<TodoProgress>({\n    total: 0,\n    completed: 0,\n    percentage: 0,\n  });\n  const [loading, setLoading] = useState(true);\n\n  const fetchTodoProgress = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('todos')\n        .select('is_completed')\n        .eq('project_id', projectId);\n\n      if (error) throw error;\n\n      const todos = data || [];\n      const total = todos.length;\n      const completed = todos.filter(todo => todo.is_completed).length;\n      const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;\n\n      setProgress({ total, completed, percentage });\n    } catch (error) {\n      console.error('Error fetching todo progress:', error);\n      setProgress({ total: 0, completed: 0, percentage: 0 });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchTodoProgress();\n  }, [projectId, refreshTrigger]);\n\n  return { progress, loading, refetch: fetchTodoProgress };\n};","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useProjectSessionsSummary.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useProjectStatusController.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":176,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5977,5980],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5977,5980],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useNotificationTriggers } from \"@/hooks/useNotificationTriggers\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\nimport { useWorkflowTriggers } from \"@/hooks/useWorkflowTriggers\";\nimport { useFormsTranslation } from \"@/hooks/useTypedTranslation\";\n\nexport interface ProjectStatus {\n  id: string;\n  name: string;\n  color: string;\n}\n\ninterface UseProjectStatusControllerOptions {\n  projectId: string;\n  currentStatusId?: string | null;\n  onStatusChange?: () => void;\n  statuses?: ProjectStatus[];\n  statusesLoading?: boolean;\n}\n\ninterface UseProjectStatusControllerResult {\n  statuses: ProjectStatus[];\n  currentStatus: ProjectStatus | null;\n  loading: boolean;\n  isUpdating: boolean;\n  handleStatusChange: (newStatusId: string) => Promise<void>;\n}\n\nexport function useProjectStatusController({\n  projectId,\n  currentStatusId,\n  onStatusChange,\n  statuses: passedStatuses,\n  statusesLoading\n}: UseProjectStatusControllerOptions): UseProjectStatusControllerResult {\n  const [statuses, setStatuses] = useState<ProjectStatus[]>([]);\n  const [currentStatus, setCurrentStatus] = useState<ProjectStatus | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [isUpdating, setIsUpdating] = useState(false);\n  const { toast } = useToast();\n  const { triggerProjectMilestone } = useNotificationTriggers();\n  const { activeOrganization } = useOrganization();\n  const { triggerProjectStatusChange } = useWorkflowTriggers();\n  const { t: tForms } = useFormsTranslation();\n\n  const fetchProjectStatuses = useCallback(async () => {\n    try {\n      const { data, error } = await supabase\n        .from(\"project_statuses\")\n        .select(\"*\")\n        .order(\"sort_order\", { ascending: true });\n\n      if (error) throw error;\n      setStatuses(data || []);\n    } catch (error) {\n      console.error(\"Error fetching project statuses:\", error);\n      toast({\n        title: tForms(\"status.errorUpdatingStatus\"),\n        description: tForms(\"status.statusNotFound\"),\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, [toast, tForms]);\n\n  useEffect(() => {\n    if (passedStatuses === undefined) {\n      fetchProjectStatuses();\n      return;\n    }\n\n    setStatuses(passedStatuses);\n    if (typeof statusesLoading === \"boolean\") {\n      setLoading(statusesLoading);\n    } else {\n      setLoading(false);\n    }\n  }, [fetchProjectStatuses, passedStatuses, statusesLoading]);\n\n  useEffect(() => {\n    if (currentStatusId && statuses.length > 0) {\n      const status = statuses.find(statusItem => statusItem.id === currentStatusId);\n      setCurrentStatus(status || null);\n    } else if (!currentStatusId) {\n      setCurrentStatus(null);\n    }\n  }, [currentStatusId, statuses]);\n\n  const handleStatusChange = useCallback(\n    async (newStatusId: string) => {\n      if (currentStatus && newStatusId === currentStatus.id) return;\n\n      setIsUpdating(true);\n      try {\n        const { data: userData } = await supabase.auth.getUser();\n        if (!userData.user) throw new Error(\"User not authenticated\");\n\n        const nextStatus = statuses.find(statusItem => statusItem.id === newStatusId);\n        if (!nextStatus) throw new Error(tForms(\"status.statusNotFound\"));\n        const organizationId = activeOrganization?.id ?? null;\n\n        const { data: projectData, error: projectError } = await supabase\n          .from(\"projects\")\n          .select(\"lead_id\")\n          .eq(\"id\", projectId)\n          .single();\n\n        if (projectError) throw projectError;\n\n        const { error: updateError } = await supabase\n          .from(\"projects\")\n          .update({ status_id: newStatusId })\n          .eq(\"id\", projectId);\n\n        if (updateError) throw updateError;\n\n        if (organizationId && currentStatus) {\n          const { error: activityError } = await supabase\n            .from(\"activities\")\n            .insert({\n              content: `Status changed from \"${currentStatus.name}\" to \"${nextStatus.name}\"`,\n              type: \"status_change\",\n              project_id: projectId,\n              lead_id: projectData.lead_id,\n              user_id: userData.user.id,\n              organization_id: organizationId\n            });\n\n          if (activityError) {\n            console.error(\"Error logging activity:\", activityError);\n          }\n        } else if (organizationId) {\n          const { error: activityError } = await supabase\n            .from(\"activities\")\n            .insert({\n              content: `Status set to \"${nextStatus.name}\"`,\n              type: \"status_change\",\n              project_id: projectId,\n              lead_id: projectData.lead_id,\n              user_id: userData.user.id,\n              organization_id: organizationId\n            });\n\n          if (activityError) {\n            console.error(\"Error logging activity:\", activityError);\n          }\n        }\n\n        setCurrentStatus(nextStatus);\n        onStatusChange?.();\n\n        toast({\n          title: tForms(\"status.statusUpdated\"),\n          description: `Project status ${currentStatus ? \"changed\" : \"set\"} to \"${nextStatus.name}\"`\n        });\n\n        if (organizationId && currentStatus?.id) {\n          await triggerProjectMilestone(projectId, currentStatus.id, newStatusId, organizationId);\n        }\n\n        if (organizationId && currentStatus?.id) {\n          try {\n            await triggerProjectStatusChange(projectId, organizationId, currentStatus.name, nextStatus.name, {\n              old_status_id: currentStatus.id,\n              new_status_id: newStatusId,\n              project_id: projectId,\n              lead_id: projectData.lead_id\n            });\n          } catch (workflowError) {\n            console.error(\"Error triggering project status workflow:\", workflowError);\n          }\n        }\n      } catch (error: any) {\n        toast({\n          title: tForms(\"status.errorUpdatingStatus\"),\n          description: error.message,\n          variant: \"destructive\"\n        });\n      } finally {\n        setIsUpdating(false);\n      }\n    },\n    [\n      activeOrganization?.id,\n      currentStatus,\n      onStatusChange,\n      projectId,\n      statuses,\n      tForms,\n      toast,\n      triggerProjectMilestone,\n      triggerProjectStatusChange\n    ]\n  );\n\n  return useMemo(\n    () => ({\n      statuses,\n      currentStatus,\n      loading,\n      isUpdating,\n      handleStatusChange\n    }),\n    [currentStatus, handleStatusChange, isUpdating, loading, statuses]\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useReminderActions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[565,568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[565,568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1353,1356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1353,1356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\n\nexport const useReminderActions = () => {\n  const { toast } = useToast();\n\n  const deleteReminder = async (reminderId: string) => {\n    try {\n      const { error } = await supabase\n        .from('activities')\n        .delete()\n        .eq('id', reminderId);\n\n      if (error) throw error;\n\n      toast({\n        title: \"Reminder deleted\",\n        description: \"Reminder has been removed from your calendar.\",\n      });\n\n      return true;\n    } catch (error: any) {\n      toast({\n        title: \"Error deleting reminder\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n      return false;\n    }\n  };\n\n  const updateReminder = async (\n    reminderId: string, \n    content: string, \n    reminderDate?: string, \n    reminderTime?: string,\n    leadName?: string\n  ) => {\n    try {\n      const { error } = await supabase\n        .from('activities')\n        .update({\n          content,\n          reminder_date: reminderDate || null,\n          reminder_time: reminderTime || null,\n        })\n        .eq('id', reminderId);\n\n      if (error) throw error;\n\n      toast({\n        title: \"Reminder updated\",\n        description: \"Reminder has been updated in your calendar.\",\n      });\n\n      return true;\n    } catch (error: any) {\n      toast({\n        title: \"Error updating reminder\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n      return false;\n    }\n  };\n\n  return {\n    deleteReminder,\n    updateReminder,\n  };\n};","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useSessionActions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1595,1598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1595,1598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4268,4271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4268,4271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { useSessionReminderScheduling } from '@/hooks/useSessionReminderScheduling';\nimport { useWorkflowTriggers } from './useWorkflowTriggers';\n\nexport const useSessionActions = () => {\n  const { toast } = useToast();\n  const { cancelSessionReminders } = useSessionReminderScheduling();\n  const { triggerSessionCompleted, triggerSessionCancelled } = useWorkflowTriggers();\n\n  const deleteSession = async (sessionId: string) => {\n    try {\n      // Hard-delete any scheduled reminders first to avoid FK constraint issues\n      const { error: remindersError } = await supabase\n        .from('scheduled_session_reminders')\n        .delete()\n        .eq('session_id', sessionId);\n\n      if (remindersError) {\n        console.error('Error deleting scheduled reminders for session:', remindersError);\n        // Continue; if FK prevents deletion we'll catch below\n      }\n\n      // Delete the session and verify deletion affected at least one row\n      const { data: deletedRows, error: deleteError } = await supabase\n        .from('sessions')\n        .delete()\n        .eq('id', sessionId)\n        .select('id');\n\n      if (deleteError) throw deleteError;\n      if (!deletedRows || deletedRows.length === 0) {\n        throw new Error('Session could not be deleted. It may not exist or you may not have permission.');\n      }\n\n      toast({\n        title: \"Session deleted\",\n        description: \"Session has been removed from your calendar.\",\n      });\n\n      return true;\n    } catch (error: any) {\n      console.error('Failed to delete session:', { sessionId, error });\n      toast({\n        title: \"Error deleting session\",\n        description: error?.message || 'Unknown error',\n        variant: \"destructive\",\n      });\n      return false;\n    }\n  };\n\n  const updateSessionStatus = async (sessionId: string, newStatus: string) => {\n    try {\n      // First, get the current session data including old status\n      const { data: sessionData, error: fetchError } = await supabase\n        .from('sessions')\n        .select(`\n          id,\n          status,\n          session_date,\n          session_time, \n          location,\n          lead_id,\n          project_id,\n          organization_id,\n          leads(name)\n        `)\n        .eq('id', sessionId)\n        .single();\n\n      if (fetchError) throw fetchError;\n      \n      const oldStatus = sessionData.status;\n      \n      // Update the session status\n      const { error } = await supabase\n        .from('sessions')\n        .update({ status: newStatus })\n        .eq('id', sessionId);\n\n      if (error) throw error;\n\n      // Trigger appropriate workflows based on new status\n      if (oldStatus !== newStatus && sessionData.organization_id) {\n        try {\n          const triggerData = {\n            old_status: oldStatus,\n            new_status: newStatus,\n            session_date: sessionData.session_date,\n            session_time: sessionData.session_time,\n            location: sessionData.location,\n            lead_id: sessionData.lead_id,\n            project_id: sessionData.project_id,\n            client_name: sessionData.leads?.name || 'Unknown Client'\n          };\n\n          if (newStatus === 'completed') {\n            console.log(`ðŸš€ Triggering session_completed workflow for session: ${sessionId}`);\n            await triggerSessionCompleted(sessionId, sessionData.organization_id, triggerData);\n          } else if (newStatus === 'cancelled') {\n            console.log(`ðŸš€ Triggering session_cancelled workflow for session: ${sessionId}`);\n            await triggerSessionCancelled(sessionId, sessionData.organization_id, triggerData);\n          }\n        } catch (workflowError) {\n          console.error('âŒ Error triggering workflow for status change:', workflowError);\n          // Don't fail the status update if workflow fails\n          toast({\n            title: \"Warning\",\n            description: \"Status updated successfully, but notifications may not be sent.\",\n            variant: \"default\"\n          });\n        }\n      }\n\n      toast({\n        title: \"Success\",\n        description: \"Session status updated successfully.\"\n      });\n\n      return true;\n    } catch (error: any) {\n      toast({\n        title: \"Error updating status\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n      return false;\n    }\n  };\n\n  return {\n    deleteSession,\n    updateSessionStatus,\n  };\n};","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useSessionEditForm.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":234,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":234,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7318,7321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7318,7321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { useWorkflowTriggers } from \"@/hooks/useWorkflowTriggers\";\nimport { useSessionReminderScheduling } from \"@/hooks/useSessionReminderScheduling\";\nimport { sessionSchema, sanitizeInput, sanitizeHtml } from \"@/lib/validation\";\nimport { ZodError } from \"zod\";\nimport { getUserOrganizationId } from \"@/lib/organizationUtils\";\nimport { generateSessionName } from \"@/lib/sessionUtils\";\n\n\ninterface SessionEditFormData {\n  session_name: string;\n  session_date: string;\n  session_time: string;\n  notes: string;\n  location: string;\n  project_id?: string;\n}\n\ninterface UseSessionEditFormProps {\n  sessionId: string;\n  leadId: string;\n  leadName: string;\n  initialData: {\n    session_name?: string;\n    session_date: string;\n    session_time: string;\n    notes?: string;\n    location?: string;\n    project_id?: string;\n  };\n  onSuccess?: () => void;\n}\n\nexport function useSessionEditForm({ \n  sessionId, \n  leadId, \n  leadName, \n  initialData, \n  onSuccess \n}: UseSessionEditFormProps) {\n  const [loading, setLoading] = useState(false);\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [formData, setFormData] = useState<SessionEditFormData>({\n    session_name: initialData.session_name || \"\",\n    session_date: initialData.session_date,\n    session_time: initialData.session_time,\n    notes: initialData.notes || \"\",\n    location: initialData.location || \"\",\n    project_id: initialData.project_id || \"\"\n  });\n\n  const { triggerSessionRescheduled } = useWorkflowTriggers();\n  const { rescheduleSessionReminders } = useSessionReminderScheduling();\n\n  // Update form data when initial data changes (using primitive dependencies)\n  useEffect(() => {\n    setFormData(prev => {\n      const newData = {\n        session_name: initialData.session_name || \"\",\n        session_date: initialData.session_date,\n        session_time: initialData.session_time,\n        notes: initialData.notes || \"\",\n        location: initialData.location || \"\",\n        project_id: initialData.project_id || \"\"\n      };\n      \n      // Only update if data actually changed to prevent unnecessary rerenders\n      if (JSON.stringify(prev) !== JSON.stringify(newData)) {\n        return newData;\n      }\n      return prev;\n    });\n  }, [\n    initialData.session_name,\n    initialData.session_date,\n    initialData.session_time,\n    initialData.notes,\n    initialData.location,\n    initialData.project_id\n  ]);\n\n\n  const handleInputChange = (field: keyof SessionEditFormData, value: string) => {\n    setFormData(prev => ({\n      ...prev,\n      [field]: value\n    }));\n    \n    // Clear field-specific errors when user starts typing\n    if (errors[field]) {\n      setErrors(prev => {\n        const newErrors = { ...prev };\n        delete newErrors[field];\n        return newErrors;\n      });\n    }\n  };\n\n  const resetForm = () => {\n    setFormData({\n      session_name: initialData.session_name || \"\",\n      session_date: initialData.session_date,\n      session_time: initialData.session_time,\n      notes: initialData.notes || \"\",\n      location: initialData.location || \"\",\n      project_id: initialData.project_id || \"\"\n    });\n    setErrors({});\n  };\n\n  const isDirty = Boolean(\n    formData.session_name !== (initialData.session_name || \"\") ||\n    formData.session_date !== initialData.session_date ||\n    formData.session_time !== initialData.session_time ||\n    formData.notes !== (initialData.notes || \"\") ||\n    formData.location !== (initialData.location || \"\") ||\n    formData.project_id !== (initialData.project_id || \"\")\n  );\n\n  const isValid = Boolean(\n    formData.session_date &&\n    formData.session_time &&\n    Object.keys(errors).length === 0\n  );\n\n  const validateForm = async () => {\n    setErrors({});\n    \n    try {\n      await sessionSchema.parseAsync({\n        session_date: sanitizeInput(formData.session_date),\n        session_time: sanitizeInput(formData.session_time),\n        notes: formData.notes ? await sanitizeHtml(formData.notes) : undefined\n      });\n      return true;\n    } catch (error) {\n      if (error instanceof ZodError) {\n        const newErrors: Record<string, string> = {};\n        error.issues.forEach((err) => {\n          const field = err.path[0] as string;\n          newErrors[field] = err.message;\n        });\n        setErrors(newErrors);\n      }\n      return false;\n    }\n  };\n\n  const submitForm = async () => {\n    if (!(await validateForm())) {\n      toast({\n        title: \"Validation error\",\n        description: \"Please fix the validation errors before saving.\",\n        variant: \"destructive\"\n      });\n      return false;\n    }\n\n    if (!isValid) {\n      toast({\n        title: \"Validation error\",\n        description: \"Date and time are required.\",\n        variant: \"destructive\"\n      });\n      return false;\n    }\n\n    setLoading(true);\n    try {\n      // Check if date/time changed for workflow trigger\n      const dateTimeChanged = \n        formData.session_date !== initialData.session_date || \n        formData.session_time !== initialData.session_time;\n      const oldDateTime = `${initialData.session_date} ${initialData.session_time}`;\n      const newDateTime = `${formData.session_date} ${formData.session_time}`;\n\n      // Generate session name if empty\n      const finalSessionName = formData.session_name.trim() || \n        generateSessionName(leadName || \"Client\");\n\n      const { error } = await supabase\n        .from('sessions')\n        .update({\n          session_name: sanitizeInput(finalSessionName),\n          session_date: sanitizeInput(formData.session_date),\n          session_time: sanitizeInput(formData.session_time),\n          notes: formData.notes ? await sanitizeHtml(formData.notes) : null,\n          location: formData.location.trim() || null,\n          project_id: formData.project_id || null\n        })\n        .eq('id', sessionId);\n\n      if (error) throw error;\n\n      // Trigger workflow for session rescheduled if date/time changed\n      if (dateTimeChanged) {\n        try {\n          const organizationId = await getUserOrganizationId();\n          if (organizationId) {\n            await triggerSessionRescheduled(sessionId, organizationId, oldDateTime, newDateTime, {\n              session_date: formData.session_date,\n              session_time: formData.session_time,\n              location: formData.location,\n              client_name: leadName,\n              lead_id: leadId,\n              project_id: formData.project_id || null\n            });\n          }\n        } catch (workflowError) {\n          console.error('Error triggering rescheduled workflow:', workflowError);\n          // Don't block session update if workflow fails\n        }\n      }\n\n      // Reschedule session reminders if date/time changed\n      if (dateTimeChanged) {\n        try {\n          await rescheduleSessionReminders(sessionId);\n        } catch (reminderError) {\n          console.error('Error rescheduling session reminders:', reminderError);\n          // Don't block session update if reminder scheduling fails\n        }\n      }\n\n      toast({\n        title: \"Success\",\n        description: \"Session updated successfully.\"\n      });\n\n      onSuccess?.();\n      return true;\n    } catch (error: any) {\n      toast({\n        title: \"Error updating session\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n      return false;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return {\n    formData,\n    loading,\n    errors,\n    isDirty,\n    isValid,\n    handleInputChange,\n    resetForm,\n    submitForm\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useSessionForm.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3976,3979],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3976,3979],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { useWorkflowTriggers } from \"@/hooks/useWorkflowTriggers\";\nimport { useSessionReminderScheduling } from \"@/hooks/useSessionReminderScheduling\";\nimport { createSession } from \"@/features/session-planning/api/sessionCreation\";\n\ninterface SessionFormData {\n  session_name: string;\n  session_date: string;\n  session_time: string;\n  notes: string;\n  location: string;\n  project_id?: string;\n}\n\ninterface UseSessionFormProps {\n  leadId: string;\n  leadName: string;\n  projectId?: string;\n  onSuccess?: () => void;\n}\n\nexport function useSessionForm({ leadId, leadName, projectId, onSuccess }: UseSessionFormProps) {\n  const [loading, setLoading] = useState(false);\n  const [formData, setFormData] = useState<SessionFormData>({\n    session_name: \"\",\n    session_date: \"\",\n    session_time: \"\",\n    notes: \"\",\n    location: \"\",\n    project_id: projectId || \"\"\n  });\n\n  const { triggerSessionScheduled } = useWorkflowTriggers();\n  const { scheduleSessionReminders } = useSessionReminderScheduling();\n\n  const handleInputChange = (field: keyof SessionFormData, value: string) => {\n    setFormData(prev => ({\n      ...prev,\n      [field]: value\n    }));\n  };\n\n  const resetForm = () => {\n    setFormData({\n      session_name: \"\",\n      session_date: \"\",\n      session_time: \"\",\n      notes: \"\",\n      location: \"\",\n      project_id: projectId || \"\"\n    });\n  };\n\n  const isDirty = Boolean(\n    formData.session_name.trim() ||\n    formData.session_date.trim() ||\n    formData.session_time.trim() ||\n    formData.notes.trim() ||\n    formData.location.trim()\n  );\n\n  const isValid = Boolean(\n    formData.session_name.trim() &&\n    formData.session_date &&\n    formData.session_time\n  );\n\n  const submitForm = async () => {\n    if (!isValid) {\n      toast({\n        title: \"Validation error\",\n        description: \"Session name, date and time are required.\",\n        variant: \"destructive\"\n      });\n      return false;\n    }\n\n    setLoading(true);\n    try {\n      const resolvedProjectId = formData.project_id || projectId || undefined;\n\n      const { sessionId, organizationId } = await createSession(\n        {\n          leadId,\n          leadName,\n          sessionName: formData.session_name.trim(),\n          sessionDate: formData.session_date,\n          sessionTime: formData.session_time,\n          notes: formData.notes,\n          location: formData.location,\n          projectId: resolvedProjectId\n        },\n        {\n          updateLeadStatus: !resolvedProjectId,\n          createActivity: !resolvedProjectId\n        }\n      );\n\n      // Trigger workflow for session scheduled\n      try {\n        console.log(`ðŸš€ Triggering session_scheduled workflow for session: ${sessionId}`);\n        const workflowResult = await triggerSessionScheduled(sessionId, organizationId, {\n          session_date: formData.session_date,\n          session_time: formData.session_time,\n          location: formData.location,\n          client_name: leadName,\n          lead_id: leadId,\n          project_id: resolvedProjectId,\n          status: 'planned'\n        });\n        console.log(`âœ… Session workflow result:`, workflowResult);\n      } catch (workflowError) {\n        console.error('âŒ Error triggering session_scheduled workflow:', workflowError);\n        toast({\n          title: \"Warning\", \n          description: \"Session created successfully, but notifications may not be sent.\",\n          variant: \"default\"\n        });\n      }\n\n      // Schedule session reminders\n      try {\n        console.log(`â° Scheduling reminders for session: ${sessionId}`);\n        await scheduleSessionReminders(sessionId);\n      } catch (reminderError) {\n        console.error('âŒ Error scheduling session reminders:', reminderError);\n      }\n\n      toast({\n        title: \"Success\",\n        description: \"Session scheduled successfully.\"\n      });\n\n      resetForm();\n      onSuccess?.();\n      return true;\n    } catch (error: any) {\n      toast({\n        title: \"Error scheduling session\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n      return false;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return {\n    formData,\n    loading,\n    isDirty,\n    isValid,\n    handleInputChange,\n    resetForm,\n    submitForm\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useSessionReminderScheduling.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1235,1238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1235,1238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2229,2232],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2229,2232],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2876,2879],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2876,2879],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\n\nexport function useSessionReminderScheduling() {\n  const { toast } = useToast();\n\n  const scheduleSessionReminders = useCallback(async (sessionId: string) => {\n    try {\n      console.log(`ðŸ”” Scheduling reminders for session: ${sessionId}`);\n\n      const { error } = await supabase.rpc('schedule_session_reminders', {\n        session_id_param: sessionId\n      });\n\n      if (error) {\n        console.error('âŒ Error scheduling session reminders:', error);\n        throw error;\n      }\n\n      console.log(`âœ… Successfully scheduled reminders for session: ${sessionId}`);\n      \n      // Verify reminders were created\n      const { data: reminders, error: checkError } = await supabase\n        .from('scheduled_session_reminders')\n        .select('id, reminder_type, scheduled_for, status')\n        .eq('session_id', sessionId)\n        .eq('status', 'pending');\n        \n      if (!checkError && reminders) {\n        console.log(`ðŸ“… Created ${reminders.length} reminder(s):`, reminders.map(r => \n          `${r.reminder_type} at ${r.scheduled_for}`\n        ));\n      }\n      \n    } catch (error: any) {\n      console.error('âŒ Failed to schedule session reminders:', error);\n      toast({\n        title: 'Warning',\n        description: 'Session created but reminders could not be scheduled automatically',\n        variant: 'destructive',\n      });\n      // Don't throw - allow session creation to succeed even if reminders fail\n    }\n  }, [toast]);\n\n  const cancelSessionReminders = useCallback(async (sessionId: string) => {\n    try {\n      console.log(`Cancelling reminders for session: ${sessionId}`);\n\n      const { error } = await supabase\n        .from('scheduled_session_reminders')\n        .update({ \n          status: 'cancelled',\n          processed_at: new Date().toISOString()\n        })\n        .eq('session_id', sessionId)\n        .eq('status', 'pending');\n\n      if (error) {\n        console.error('Error cancelling session reminders:', error);\n        throw error;\n      }\n\n      console.log(`Successfully cancelled reminders for session: ${sessionId}`);\n    } catch (error: any) {\n      console.error('Failed to cancel session reminders:', error);\n      // Don't show toast for this as it's usually called during deletion\n      // and shouldn't block the main action\n    }\n  }, []);\n\n  const rescheduleSessionReminders = useCallback(async (sessionId: string) => {\n    try {\n      console.log(`Rescheduling reminders for session: ${sessionId}`);\n\n      // Cancel existing reminders first\n      await cancelSessionReminders(sessionId);\n      \n      // Schedule new ones\n      await scheduleSessionReminders(sessionId);\n\n      console.log(`Successfully rescheduled reminders for session: ${sessionId}`);\n    } catch (error: any) {\n      console.error('Failed to reschedule session reminders:', error);\n      toast({\n        title: 'Warning', \n        description: 'Session updated but reminders could not be rescheduled automatically',\n        variant: 'destructive',\n      });\n      // Don't throw - allow session update to succeed\n    }\n  }, [scheduleSessionReminders, cancelSessionReminders, toast]);\n\n  return {\n    scheduleSessionReminders,\n    cancelSessionReminders,\n    rescheduleSessionReminders,\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useSettingsCategorySection.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[499,502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[499,502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'section'. Either include it or remove the dependency array.","line":66,"column":6,"nodeType":"ArrayExpression","endLine":66,"endColumn":85,"suggestions":[{"desc":"Update the dependencies array to be: [section.handleSave, section.handleCancel, section.values, section.updateValue, section]","fix":{"range":[2224,2303],"text":"[section.handleSave, section.handleCancel, section.values, section.updateValue, section]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'registerSectionHandler' and 'unregisterSectionHandler'. Either include them or remove the dependency array.","line":81,"column":6,"nodeType":"ArrayExpression","endLine":81,"endColumn":60,"suggestions":[{"desc":"Update the dependencies array to be: [categoryPath, options.sectionId, options.sectionName, registerSectionHandler, unregisterSectionHandler]","fix":{"range":[2705,2759],"text":"[categoryPath, options.sectionId, options.sectionName, registerSectionHandler, unregisterSectionHandler]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'section.values.logoFile'. Either include it or remove the dependency array.","line":87,"column":6,"nodeType":"ArrayExpression","endLine":87,"endColumn":73,"suggestions":[{"desc":"Update the dependencies array to be: [section.isDirty, categoryPath, options.sectionId, setSectionDirty, section.values.logoFile]","fix":{"range":[3042,3109],"text":"[section.isDirty, categoryPath, options.sectionId, setSectionDirty, section.values.logoFile]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useCallback, useRef } from \"react\";\nimport { useLocation } from \"react-router-dom\";\nimport { useSettingsSection } from \"./useSettingsSection\";\nimport { useSettingsContext } from \"@/contexts/SettingsContext\";\n\ninterface SettingsCategorySectionOptions<T> {\n  sectionId: string;\n  sectionName: string;\n  initialValues: T;\n  onSave: (values: T) => Promise<T | void>;\n  autoSave?: boolean;\n  throttleMs?: number;\n}\n\nexport function useSettingsCategorySection<T extends Record<string, any>>(\n  options: SettingsCategorySectionOptions<T>\n) {\n  const location = useLocation();\n  const categoryPath = location.pathname;\n  const { registerSectionHandler, unregisterSectionHandler, setSectionDirty } = useSettingsContext();\n  \n  const section = useSettingsSection({\n    sectionName: options.sectionName,\n    initialValues: options.initialValues,\n    onSave: options.onSave,\n    autoSave: options.autoSave,\n    throttleMs: options.throttleMs,\n    disableToast: true // Disable section-level toasts in favor of category-level toasts\n  });\n\n  // Use refs to avoid recreating functions\n  const handlersRef = useRef({\n    handleSave: section.handleSave,\n    handleCancel: section.handleCancel\n  });\n\n  // Update refs when handlers change\n  useEffect(() => {\n    handlersRef.current = {\n      handleSave: async () => {\n        console.log(\"ðŸŽ¯ Category section handleSave called\");\n        console.log(\"ðŸ“Š Current values before save:\", section.values);\n        \n        await section.handleSave();\n        \n        console.log(\"ðŸ“Š Values after save, before clearing:\", section.values);\n        \n        // Immediately clear file selection after successful save\n        if (section.values.logoFile) {\n          console.log(\"ðŸ§¹ Clearing logoFile from section state\");\n          section.updateValue(\"logoFile\", null);\n        }\n        \n        console.log(\"âœ… Section save completed\");\n      },\n      handleCancel: () => {\n        console.log(\"âŒ Section cancel called\");\n        section.handleCancel();\n        // Also clear file selection on cancel\n        if (section.values.logoFile) {\n          console.log(\"ðŸ§¹ Clearing logoFile on cancel\");\n          section.updateValue(\"logoFile\", null);\n        }\n      }\n    };\n  }, [section.handleSave, section.handleCancel, section.values, section.updateValue]);\n\n  // Register this section with the category context - only when path/id changes\n  useEffect(() => {\n    registerSectionHandler(\n      categoryPath,\n      options.sectionId,\n      options.sectionName,\n      () => handlersRef.current.handleSave(),\n      () => handlersRef.current.handleCancel()\n    );\n\n    return () => {\n      unregisterSectionHandler(categoryPath, options.sectionId);\n    };\n  }, [categoryPath, options.sectionId, options.sectionName]); // Removed handler deps\n\n  // Update dirty state in context\n  useEffect(() => {\n    console.log(`ðŸ” Dirty state check for ${options.sectionId}:`, section.isDirty, \"logoFile:\", !!section.values.logoFile);\n    setSectionDirty(categoryPath, options.sectionId, section.isDirty);\n  }, [section.isDirty, categoryPath, options.sectionId, setSectionDirty]);\n\n  return {\n    ...section,\n    // Override save/cancel to prevent section-level actions\n    handleSave: () => {}, // Disabled - use category-level save\n    handleCancel: () => {} // Disabled - use category-level cancel\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useSettingsNavigation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useSettingsSection.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[418,421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[418,421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'initialValues'. Either include it or remove the dependency array. If 'setValues' needs the current value of 'initialValues', you can also switch to useReducer instead of useState and read 'initialValues' in the reducer.","line":36,"column":6,"nodeType":"ArrayExpression","endLine":36,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [initialValues]","fix":{"range":[1201,1232],"text":"[initialValues]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":36,"column":7,"nodeType":"CallExpression","endLine":36,"endColumn":36},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'handleSave'. Either include it or remove the dependency array.","line":50,"column":6,"nodeType":"ArrayExpression","endLine":50,"endColumn":36,"suggestions":[{"desc":"Update the dependencies array to be: [autoSave, throttleMs, handleSave, values]","fix":{"range":[1606,1636],"text":"[autoSave, throttleMs, handleSave, values]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback, useRef, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface SettingsSectionOptions<T> {\n  sectionName: string;\n  initialValues: T;\n  onSave: (values: T) => Promise<T | void>;\n  autoSave?: boolean;\n  throttleMs?: number;\n  disableToast?: boolean; // New option to disable section-level toasts\n}\n\nexport function useSettingsSection<T extends Record<string, any>>({\n  sectionName,\n  initialValues,\n  onSave,\n  autoSave = false,\n  throttleMs = 1000,\n  disableToast = false\n}: SettingsSectionOptions<T>) {\n  const [values, setValues] = useState<T>(initialValues);\n  const [savedValues, setSavedValues] = useState<T>(initialValues);\n  const [isSaving, setIsSaving] = useState(false);\n  const [showSuccess, setShowSuccess] = useState(false);\n  const { toast } = useToast();\n  const throttleRef = useRef<NodeJS.Timeout>();\n  const saveTimeoutRef = useRef<NodeJS.Timeout>();\n\n  // Check if section has unsaved changes\n  const isDirty = JSON.stringify(values) !== JSON.stringify(savedValues);\n\n  // Update initial values when they change (e.g., from server)\n  useEffect(() => {\n    setValues(initialValues);\n    setSavedValues(initialValues);\n  }, [JSON.stringify(initialValues)]);\n\n  const updateValue = useCallback((key: keyof T, value: T[keyof T]) => {\n    setValues(prev => ({ ...prev, [key]: value }));\n    \n    if (autoSave) {\n      if (throttleRef.current) {\n        clearTimeout(throttleRef.current);\n      }\n      \n      throttleRef.current = setTimeout(() => {\n        handleSave({ ...values, [key]: value });\n      }, throttleMs);\n    }\n  }, [values, autoSave, throttleMs]);\n\n  const handleSave = useCallback(async (valuesToSave?: T) => {\n    const dataToSave = valuesToSave || values;\n    setIsSaving(true);\n    \n    try {\n      const result = await onSave(dataToSave);\n      \n      // If onSave returns cleaned values, use those; otherwise use original\n      const finalValues = result && typeof result === 'object' ? result : dataToSave;\n      setSavedValues(finalValues);\n      setValues(finalValues); // CRITICAL: Update current values to clear file selections\n      \n      // Only show toasts if not disabled (for category-based systems)\n      if (!disableToast) {\n        if (autoSave) {\n          // Show inline success indicator for auto-save\n          setShowSuccess(true);\n          if (saveTimeoutRef.current) {\n            clearTimeout(saveTimeoutRef.current);\n          }\n          saveTimeoutRef.current = setTimeout(() => {\n            setShowSuccess(false);\n          }, 1000);\n          \n          // Throttled toast for auto-save to avoid spam\n          toast({\n            title: `Updated ${sectionName}`,\n            duration: 2000,\n          });\n        } else {\n          // Regular toast for manual save\n          toast({\n            title: `Saved ${sectionName}`,\n            duration: 3000,\n          });\n        }\n      }\n    } catch (error) {\n      // Always show error toasts\n      toast({\n        title: \"Error\",\n        description: `Failed to save ${sectionName}. Please try again.`,\n        variant: \"destructive\",\n        duration: 5000,\n      });\n    } finally {\n      setIsSaving(false);\n    }\n  }, [values, onSave, sectionName, autoSave, toast, disableToast]);\n\n  const handleCancel = useCallback(() => {\n    setValues(savedValues);\n  }, [savedValues]);\n\n  const handleReset = useCallback(() => {\n    setValues(initialValues);\n    setSavedValues(initialValues);\n  }, [initialValues]);\n\n  // Cleanup timeouts\n  useEffect(() => {\n    return () => {\n      if (throttleRef.current) {\n        clearTimeout(throttleRef.current);\n      }\n      if (saveTimeoutRef.current) {\n        clearTimeout(saveTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  return {\n    values,\n    isDirty,\n    isSaving,\n    showSuccess,\n    updateValue,\n    handleSave,\n    handleCancel,\n    handleReset,\n    setValues\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useSettingsSectionWithContext.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[432,435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[432,435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect } from \"react\";\nimport { useSettingsSection } from \"./useSettingsSection\";\nimport { useSettingsContext } from \"@/contexts/SettingsContext\";\n\ninterface SettingsSectionWithContextOptions<T> {\n  sectionId: string;\n  sectionName: string;\n  initialValues: T;\n  onSave: (values: T) => Promise<void>;\n  autoSave?: boolean;\n  throttleMs?: number;\n}\n\nexport function useSettingsSectionWithContext<T extends Record<string, any>>(\n  options: SettingsSectionWithContextOptions<T>\n) {\n  const { addDirtySection, removeDirtySection } = useSettingsContext();\n  const section = useSettingsSection(options);\n\n  // Track dirty state in context\n  useEffect(() => {\n    if (section.isDirty) {\n      addDirtySection(options.sectionId);\n    } else {\n      removeDirtySection(options.sectionId);\n    }\n  }, [section.isDirty, options.sectionId, addDirtySection, removeDirtySection]);\n\n  // Override handleSave to update context\n  const handleSave = async () => {\n    await section.handleSave();\n    removeDirtySection(options.sectionId);\n  };\n\n  // Override handleCancel to update context\n  const handleCancel = () => {\n    section.handleCancel();\n    removeDirtySection(options.sectionId);\n  };\n\n  return {\n    ...section,\n    handleSave,\n    handleCancel\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useSmartTimeRange.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useTemplateBuilder.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1566,1569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1566,1569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3405,3408],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3405,3408],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3416,3419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3416,3419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":234,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":234,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8356,8359],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8356,8359],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Template, TemplateBuilderData, DatabaseTemplate } from \"@/types/template\";\nimport { TemplateBlock } from \"@/types/templateBuilder\";\nimport { blocksToHTML, blocksToPlainText, blocksToMasterContent, htmlToBlocks } from \"@/lib/templateBlockUtils\";\n\ninterface UseTemplateBuilderReturn {\n  template: TemplateBuilderData | null;\n  loading: boolean;\n  saving: boolean;\n  lastSaved: Date | null;\n  isDirty: boolean;\n  saveTemplate: (templateData: Partial<TemplateBuilderData>, showToast?: boolean) => Promise<TemplateBuilderData | null>;\n  publishTemplate: (templateData?: Partial<TemplateBuilderData>) => Promise<TemplateBuilderData | null>;\n  deleteTemplate: () => Promise<boolean>;\n  updateTemplate: (updates: Partial<TemplateBuilderData>) => void;\n  loadTemplate: () => Promise<void>;\n  resetDirtyState: () => void;\n}\n\n// Extract placeholders from text content\nconst extractPlaceholders = (content: string): string[] => {\n  const placeholderRegex = /{([^}]+)}/g;\n  const placeholders = new Set<string>();\n  let match;\n  \n  while ((match = placeholderRegex.exec(content)) !== null) {\n    placeholders.add(match[1]);\n  }\n  \n  return Array.from(placeholders);\n};\n\n// Transform database template to builder data\nconst transformToBuilderData = (dbTemplate: DatabaseTemplate & { blocks?: any }): TemplateBuilderData => {\n  const emailChannel = dbTemplate.template_channel_views?.find(v => v.channel === 'email');\n  \n  // Load blocks from database or try to parse from HTML content\n  let blocks: TemplateBlock[] = [];\n  \n  if (dbTemplate.blocks && Array.isArray(dbTemplate.blocks)) {\n    blocks = dbTemplate.blocks;\n  } else if (emailChannel?.html_content) {\n    // Try to parse blocks from HTML content (fallback)\n    blocks = htmlToBlocks(emailChannel.html_content);\n  } else if (dbTemplate.master_content) {\n    // Create basic text block from master content\n    blocks = [{\n      id: `text-${Date.now()}`,\n      type: 'text',\n      data: {\n        content: dbTemplate.master_content,\n        formatting: {\n          fontSize: 'p' as const,\n          alignment: 'left' as const\n        }\n      },\n      visible: true,\n      order: 0\n    }];\n  }\n  \n  return {\n    id: dbTemplate.id,\n    name: dbTemplate.name,\n    category: dbTemplate.category,\n    master_content: dbTemplate.master_content,\n    master_subject: dbTemplate.master_subject || undefined,\n    placeholders: Array.isArray(dbTemplate.placeholders) ? dbTemplate.placeholders : [],\n    is_active: dbTemplate.is_active,\n    created_at: dbTemplate.created_at,\n    updated_at: dbTemplate.updated_at,\n    user_id: dbTemplate.user_id,\n    organization_id: dbTemplate.organization_id,\n    // UI-specific fields\n    description: dbTemplate.master_content?.substring(0, 200) || undefined,\n    subject: emailChannel?.subject || dbTemplate.master_subject || '',\n    preheader: '', // Will be extracted from blocks if needed\n    blocks: blocks,\n    status: dbTemplate.is_active ? 'published' : 'draft',\n    published_at: dbTemplate.is_active ? dbTemplate.updated_at : null,\n    last_saved_at: dbTemplate.updated_at,\n    channels: dbTemplate.template_channel_views?.reduce((acc: any, view: any) => {\n      acc[view.channel] = {\n        subject: view.subject,\n        content: view.content,\n        html_content: view.html_content\n      };\n      return acc;\n    }, {}) || {}\n  };\n};\n\nexport function useTemplateBuilder(templateId?: string): UseTemplateBuilderReturn {\n  const [template, setTemplate] = useState<TemplateBuilderData | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [lastSaved, setLastSaved] = useState<Date | null>(null);\n  const [isDirty, setIsDirty] = useState(false);\n  \n  const { activeOrganizationId } = useOrganization();\n  const { user } = useAuth();\n  const { toast } = useToast();\n\n  const loadTemplate = useCallback(async () => {\n    if (!templateId || !activeOrganizationId) return;\n\n    try {\n      setLoading(true);\n      const { data, error } = await supabase\n        .from(\"message_templates\")\n        .select(`\n          *,\n          template_channel_views(\n            channel, subject, content, html_content\n          )\n        `)\n        .eq(\"id\", templateId)\n        .eq(\"organization_id\", activeOrganizationId)\n        .single();\n\n      if (error) throw error;\n\n      const transformedTemplate = transformToBuilderData(data);\n      setTemplate(transformedTemplate);\n      setIsDirty(false);\n    } catch (error) {\n      console.error(\"Error loading template:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to load template\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, [templateId, activeOrganizationId, toast]);\n\n  const saveTemplate = useCallback(async (\n    templateData: Partial<TemplateBuilderData>, \n    showToast = true\n  ): Promise<TemplateBuilderData | null> => {\n    if (!activeOrganizationId || !user?.id) return null;\n\n    try {\n      setSaving(true);\n\n      // Merge current template data with updates\n      const mergedData = template ? { ...template, ...templateData } : templateData;\n\n      // Generate content from blocks if blocks exist\n      const blocks = mergedData.blocks || [];\n      let generatedMasterContent = '';\n      let generatedHtmlContent = '';\n      \n      if (blocks.length > 0) {\n        generatedMasterContent = blocksToMasterContent(blocks);\n        generatedHtmlContent = blocksToHTML(blocks);\n      }\n\n      // Extract placeholders from all content including blocks\n      const allContent = [\n        generatedMasterContent || mergedData.master_content || '',\n        mergedData.subject || '',\n        mergedData.channels?.email?.content || '',\n        mergedData.channels?.sms?.content || '',\n        mergedData.channels?.whatsapp?.content || ''\n      ].join(' ');\n      \n      const extractedPlaceholders = extractPlaceholders(allContent);\n\n      // Prepare template payload with blocks\n      const templatePayload = {\n        name: mergedData.name || 'Untitled Template',\n        category: mergedData.category || 'general',\n        master_content: generatedMasterContent || mergedData.master_content || mergedData.description || '',\n        master_subject: mergedData.master_subject || mergedData.subject || '',\n        placeholders: extractedPlaceholders,\n        is_active: mergedData.status === 'published',\n        organization_id: activeOrganizationId,\n        user_id: user.id,\n        blocks: blocks, // Store blocks as JSON\n      };\n\n      let result;\n      if (templateId && template) {\n        // Update existing template\n        const { data, error } = await supabase\n          .from(\"message_templates\")\n          .update(templatePayload)\n          .eq(\"id\", templateId)\n          .eq(\"organization_id\", activeOrganizationId)\n          .select()\n          .single();\n\n        if (error) throw error;\n        result = data;\n      } else {\n        // Create new template\n        const { data, error } = await supabase\n          .from(\"message_templates\")\n          .insert(templatePayload)\n          .select()\n          .single();\n\n        if (error) throw error;\n        result = data;\n      }\n\n      // Save channel views - always update/create email channel with generated HTML\n      // Delete existing channel views first\n      await supabase\n        .from(\"template_channel_views\")\n        .delete()\n        .eq(\"template_id\", result.id);\n\n      // Prepare channel views with generated content\n      const channelViews = [];\n      \n      // Always create email channel view with generated HTML content\n      channelViews.push({\n        template_id: result.id,\n        channel: 'email',\n        subject: mergedData.subject || mergedData.master_subject || mergedData.name || 'Subject',\n        content: generatedMasterContent || mergedData.master_content || '',\n        html_content: generatedHtmlContent || null\n      });\n      \n      // Add other channels if they exist\n      if (mergedData.channels) {\n        Object.entries(mergedData.channels).forEach(([channel, channelData]: [string, any]) => {\n          if (channel !== 'email' && channelData && (channelData.subject || channelData.content || channelData.html_content)) {\n            channelViews.push({\n              template_id: result.id,\n              channel,\n              subject: channelData.subject || null,\n              content: channelData.content || null,\n              html_content: channelData.html_content || null\n            });\n          }\n        });\n      }\n\n      if (channelViews.length > 0) {\n        const { error: channelError } = await supabase\n          .from(\"template_channel_views\")\n          .insert(channelViews);\n\n        if (channelError) {\n          console.warn('Error saving channel views:', channelError);\n        }\n      }\n\n      // Transform result back to TemplateBuilderData\n      const savedTemplate: TemplateBuilderData = {\n        ...result,\n        placeholders: extractedPlaceholders,\n        description: result.master_content?.substring(0, 200) || undefined,\n        subject: mergedData.subject || result.master_subject || '',\n        preheader: mergedData.preheader || '',\n        blocks: mergedData.blocks || [],\n        status: result.is_active ? 'published' : 'draft',\n        published_at: result.is_active ? result.updated_at : null,\n        last_saved_at: result.updated_at,\n        channels: mergedData.channels || {}\n      };\n\n      setTemplate(savedTemplate);\n      setLastSaved(new Date());\n      setIsDirty(false);\n\n      if (showToast) {\n        toast({\n          title: \"Saved\",\n          description: \"Template saved successfully\",\n        });\n      }\n\n      return savedTemplate;\n    } catch (error) {\n      console.error(\"Error saving template:\", error);\n      if (showToast) {\n        toast({\n          title: \"Error\",\n          description: \"Failed to save template\",\n          variant: \"destructive\",\n        });\n      }\n      return null;\n    } finally {\n      setSaving(false);\n    }\n  }, [templateId, template, activeOrganizationId, user?.id, toast]);\n\n  const publishTemplate = useCallback(async (\n    templateData?: Partial<TemplateBuilderData>\n  ): Promise<TemplateBuilderData | null> => {\n    try {\n      setSaving(true);\n\n      const dataToPublish = template \n        ? { ...template, ...templateData } \n        : { name: 'Untitled Template', blocks: [], ...templateData };\n\n      const publishedTemplate = await saveTemplate({\n        ...dataToPublish,\n        status: 'published',\n        published_at: new Date().toISOString(),\n      }, false);\n\n      if (publishedTemplate) {\n        toast({\n          title: \"Published\",\n          description: \"Template published successfully\",\n        });\n      }\n\n      return publishedTemplate;\n    } catch (error) {\n      console.error(\"Error publishing template:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to publish template\",\n        variant: \"destructive\",\n      });\n      return null;\n    } finally {\n      setSaving(false);\n    }\n  }, [template, saveTemplate, toast]);\n\n  const deleteTemplate = useCallback(async (): Promise<boolean> => {\n    if (!templateId || !activeOrganizationId) return false;\n\n    try {\n      // Delete channel views first (foreign key dependency)\n      const { error: channelError } = await supabase\n        .from('template_channel_views')\n        .delete()\n        .eq('template_id', templateId);\n\n      if (channelError) {\n        console.warn('Error deleting channel views:', channelError);\n      }\n\n      // Then delete the main template\n      const { error } = await supabase\n        .from(\"message_templates\")\n        .delete()\n        .eq(\"id\", templateId)\n        .eq(\"organization_id\", activeOrganizationId);\n\n      if (error) throw error;\n\n      toast({\n        title: \"Deleted\",\n        description: \"Template deleted successfully\",\n      });\n\n      return true;\n    } catch (error) {\n      console.error(\"Error deleting template:\", error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete template\",\n        variant: \"destructive\",\n      });\n      return false;\n    }\n  }, [templateId, activeOrganizationId, toast]);\n\n  const updateTemplate = useCallback((updates: Partial<TemplateBuilderData>) => {\n    if (!template) {\n      // Create a basic template with updates\n      const newTemplate: TemplateBuilderData = {\n        id: '',\n        name: 'Untitled Template',\n        category: 'general',\n        master_content: '',\n        placeholders: [],\n        is_active: false,\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString(),\n        user_id: '',\n        organization_id: '',\n        subject: '',\n        preheader: '',\n        blocks: [],\n        status: 'draft',\n        ...updates,\n      };\n      setTemplate(newTemplate);\n      setIsDirty(true);\n      return;\n    }\n\n    const updatedTemplate = { ...template, ...updates };\n    setTemplate(updatedTemplate);\n    setIsDirty(true);\n  }, [template]);\n\n  const resetDirtyState = useCallback(() => {\n    setIsDirty(false);\n  }, []);\n\n  // Load template on mount\n  useEffect(() => {\n    if (templateId && activeOrganizationId) {\n      loadTemplate();\n    }\n  }, [templateId, activeOrganizationId, loadTemplate]);\n\n  return {\n    template,\n    loading,\n    saving,\n    lastSaved,\n    isDirty,\n    saveTemplate,\n    publishTemplate,\n    deleteTemplate,\n    updateTemplate,\n    loadTemplate,\n    resetDirtyState,\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useTemplateOperations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useTemplateValidation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useTemplateVariables.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchVariables'. Either include it or remove the dependency array.","line":26,"column":6,"nodeType":"ArrayExpression","endLine":26,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [activeOrganization?.id, fetchVariables]","fix":{"range":[789,813],"text":"[activeOrganization?.id, fetchVariables]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\nimport { TemplateVariable } from \"@/types/templateBuilder\";\n\ninterface BusinessInfo {\n  name: string;\n  logo_url: string | null;\n  primary_brand_color: string;\n  phone?: string;\n  email?: string;\n  address?: string;\n  website?: string;\n}\n\nexport function useTemplateVariables() {\n  const [variables, setVariables] = useState<TemplateVariable[]>([]);\n  const [businessInfo, setBusinessInfo] = useState<BusinessInfo | null>(null);\n  const [loading, setLoading] = useState(true);\n  const { activeOrganization } = useOrganization();\n\n  useEffect(() => {\n    if (activeOrganization?.id) {\n      fetchVariables();\n    }\n  }, [activeOrganization?.id]);\n\n  const fetchVariables = async () => {\n    if (!activeOrganization?.id) return;\n\n    try {\n      setLoading(true);\n\n      // Fetch organization settings for business info\n      const { data: orgSettings } = await supabase\n        .from(\"organization_settings\")\n        .select(\"photography_business_name, logo_url, primary_brand_color\")\n        .eq(\"organization_id\", activeOrganization.id)\n        .single();\n\n      // Fetch lead field definitions for dynamic variables\n      const { data: leadFields } = await supabase\n        .from(\"lead_field_definitions\")\n        .select(\"field_key, label, field_type\")\n        .eq(\"organization_id\", activeOrganization.id)\n        .order(\"sort_order\");\n\n      // Set business info\n      if (orgSettings) {\n        setBusinessInfo({\n          name: orgSettings.photography_business_name || \"Your Business\",\n          logo_url: orgSettings.logo_url,\n          primary_brand_color: orgSettings.primary_brand_color || \"#1EB29F\",\n        });\n      }\n\n      // Build template variables\n      const templateVariables: TemplateVariable[] = [\n        // Business variables (only real ones from organization_settings)\n        {\n          key: \"business_name\",\n          label: \"Business Name\",\n          category: \"business\"\n        },\n\n        // Lead variables from field definitions\n        ...(leadFields?.map(field => ({\n          key: `lead_${field.field_key}`,\n          label: `Lead ${field.label}`,\n          category: \"lead\" as const\n        })) || []),\n\n        // Static lead variables that exist in database\n        {\n          key: \"lead_status\",\n          label: \"Lead Status\",\n          category: \"lead\"\n        },\n        {\n          key: \"lead_due_date\",\n          label: \"Lead Due Date\", \n          category: \"lead\"\n        },\n        {\n          key: \"lead_created_date\",\n          label: \"Lead Created Date\",\n          category: \"lead\"\n        },\n        {\n          key: \"lead_updated_date\",\n          label: \"Lead Updated Date\",\n          category: \"lead\"\n        },\n\n        // Session variables (real database fields)\n        {\n          key: \"session_date\",\n          label: \"Session Date\",\n          category: \"session\"\n        },\n        {\n          key: \"session_time\", \n          label: \"Session Time\",\n          category: \"session\"\n        },\n        {\n          key: \"session_location\",\n          label: \"Session Location\",\n          category: \"session\"\n        },\n        {\n          key: \"session_notes\",\n          label: \"Session Notes\",\n          category: \"session\"\n        },\n        {\n          key: \"session_status\",\n          label: \"Session Status\",\n          category: \"session\"\n        },\n\n        // Project variables (real database fields)\n        {\n          key: \"project_name\",\n          label: \"Project Name\",\n          category: \"project\"\n        },\n        {\n          key: \"project_type\",\n          label: \"Project Type\", \n          category: \"project\"\n        },\n        {\n          key: \"project_status\",\n          label: \"Project Status\",\n          category: \"project\"\n        },\n        {\n          key: \"project_due_date\",\n          label: \"Project Due Date\",\n          category: \"project\"\n        },\n\n        // System variables\n        {\n          key: \"current_date\",\n          label: \"Current Date\",\n          category: \"custom\"\n        },\n        {\n          key: \"current_time\",\n          label: \"Current Time\", \n          category: \"custom\"\n        }\n      ];\n\n      setVariables(templateVariables);\n    } catch (error) {\n      console.error(\"Error fetching template variables:\", error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getVariableValue = (key: string, mockData?: Record<string, string>): string => {\n    // If mock data is provided, use it first\n    if (mockData && mockData[key]) {\n      return mockData[key];\n    }\n\n    // Business variables (only real ones)\n    if (key === \"business_name\") return businessInfo?.name || \"Your Business\";\n\n    // Lead variables with fallbacks\n    if (key.startsWith(\"lead_\")) {\n      const fieldKey = key.replace(\"lead_\", \"\");\n      if (fieldKey === \"name\") return \"John Smith\";\n      if (fieldKey === \"email\") return \"john@example.com\";\n      if (fieldKey === \"phone\") return \"-\"; // Show dash for empty phone\n      if (fieldKey === \"notes\") return \"Sample notes\";\n      if (fieldKey === \"status\") return \"New\";\n      if (fieldKey === \"due_date\") return new Date().toLocaleDateString();\n      if (fieldKey === \"created_date\") return new Date().toLocaleDateString();\n      if (fieldKey === \"updated_date\") return new Date().toLocaleDateString();\n      // For custom fields, return placeholder\n      return `Sample ${fieldKey}`;\n    }\n\n    // Session variables (real database fields)\n    if (key === \"session_date\") return new Date().toLocaleDateString();\n    if (key === \"session_time\") return \"2:00 PM\";  \n    if (key === \"session_location\") return \"Studio Location\";\n    if (key === \"session_notes\") return \"Bring comfortable clothes\";\n    if (key === \"session_status\") return \"Planned\";\n\n    // Project variables (real database fields)\n    if (key === \"project_name\") return \"Wedding Photography\";\n    if (key === \"project_type\") return \"Wedding\";\n    if (key === \"project_status\") return \"In Progress\";\n    if (key === \"project_due_date\") return new Date().toLocaleDateString();\n\n    // System variables\n    if (key === \"current_date\") return new Date().toLocaleDateString();\n    if (key === \"current_time\") return new Date().toLocaleTimeString();\n\n    return `{${key}}`;\n  };\n\n  return {\n    variables,\n    businessInfo,\n    loading,\n    getVariableValue,\n    refetch: fetchVariables\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useTemplates.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1407,1410],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1407,1410],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1592,1595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1592,1595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1603,1606],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1603,1606],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTemplates'. Either include it or remove the dependency array.","line":104,"column":6,"nodeType":"ArrayExpression","endLine":104,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTemplates]","fix":{"range":[3511,3513],"text":"[fetchTemplates]"}}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { getUserOrganizationId } from '@/lib/organizationUtils';\n\nimport { Template } from \"@/types/template\";\n\nexport function useTemplates() {\n  const [templates, setTemplates] = useState<Template[]>([]);\n  const [loading, setLoading] = useState(true);\n  const { toast } = useToast();\n\n  const fetchTemplates = async () => {\n    try {\n      setLoading(true);\n      const organizationId = await getUserOrganizationId();\n      \n      console.log('Organization ID for templates:', organizationId);\n      \n      if (!organizationId) {\n        console.warn('No organization ID found, cannot fetch templates');\n        setTemplates([]);\n        return;\n      }\n\n      const { data, error } = await supabase\n        .from('message_templates')\n        .select(`\n          *,\n          template_channel_views(\n            channel,\n            subject,\n            content,\n            html_content\n          )\n        `)\n        .eq('organization_id', organizationId)\n        .eq('is_active', true)\n        .order('created_at', { ascending: false });\n\n      console.log('Template query result:', { data, error });\n\n      if (error) throw error;\n      \n      // Transform data to include channel views\n      const transformedTemplates = (data || []).map((template: any) => ({\n        ...template,\n        placeholders: Array.isArray(template.placeholders) ? template.placeholders : [],\n        channels: template.template_channel_views?.reduce((acc: any, view: any) => {\n          acc[view.channel] = {\n            subject: view.subject,\n            content: view.content,\n            html_content: view.html_content\n          };\n          return acc;\n        }, {}) || {}\n      }));\n      \n      setTemplates(transformedTemplates as Template[]);\n      console.log('Templates loaded:', transformedTemplates?.length || 0);\n    } catch (error) {\n      console.error('Error fetching templates:', error);\n      toast({\n        title: 'Error',\n        description: 'Failed to load templates',\n        variant: 'destructive',\n      });\n      setTemplates([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getSessionTemplates = () => {\n    const sessionFiltered = templates.filter(template => \n      template.category === 'session_scheduled' || \n      template.category === 'session_reminder' ||\n      template.category === 'session_rescheduled' ||\n      template.category === 'session_cancelled' ||\n      template.category === 'session_completed' ||\n      template.category === 'session' || \n      template.category === 'sessions' ||\n      template.category === 'client-communication' ||\n      template.name.toLowerCase().includes('session') ||\n      template.name.toLowerCase().includes('appointment') ||\n      template.name.toLowerCase().includes('booking') ||\n      template.name.toLowerCase().includes('reminder') ||\n      template.name.toLowerCase().includes('confirmation')\n    );\n    \n    // If no session-specific templates found, show all general templates as fallback\n    const result = sessionFiltered.length > 0 ? sessionFiltered : templates;\n    \n    // Debug logging to help troubleshoot template loading\n    console.log('All templates:', templates);\n    console.log('Session-filtered templates:', sessionFiltered);\n    console.log('Final result templates:', result);\n    \n    return result;\n  };\n\n  useEffect(() => {\n    fetchTemplates();\n  }, []);\n\n  return {\n    templates,\n    sessionTemplates: getSessionTemplates(),\n    loading,\n    refetch: fetchTemplates,\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useThrottledRefetchOnFocus.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useTranslationFiles.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[133,136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[133,136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1609,1612],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1609,1612],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4077,4080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4077,4080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":357,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":357,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10710,10713],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10710,10713],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\nimport { toast } from '@/hooks/use-toast';\n\ntype TranslationRecord = Record<string, Record<string, any>>;\n\nconst DOWNLOAD_THROTTLE_MS = 5500;\nconst recentDownloads = new Map<string, number>();\n\nconst shouldThrottleDownload = (key: string): boolean => {\n  if (typeof window === 'undefined') {\n    return false;\n  }\n\n  const now = Date.now();\n  const last = recentDownloads.get(key);\n\n  if (last && now - last < DOWNLOAD_THROTTLE_MS) {\n    return true;\n  }\n\n  recentDownloads.set(key, now);\n\n  window.setTimeout(() => {\n    const stored = recentDownloads.get(key);\n    if (stored && stored <= now) {\n      recentDownloads.delete(key);\n    }\n  }, DOWNLOAD_THROTTLE_MS);\n\n  return false;\n};\n\nconst triggerDownload = (blob: Blob, fileName: string) => {\n  if (typeof document === 'undefined') {\n    return;\n  }\n\n  const url = URL.createObjectURL(blob);\n  const anchor = document.createElement('a');\n  anchor.href = url;\n  anchor.download = fileName;\n  anchor.rel = 'noopener';\n  anchor.style.display = 'none';\n  document.body.appendChild(anchor);\n\n  const clickEvent = new MouseEvent('click', {\n    bubbles: true,\n    cancelable: true,\n    view: typeof window !== 'undefined' ? window : undefined,\n  });\n\n  anchor.dispatchEvent(clickEvent);\n\n  const cleanup = () => {\n    if (anchor.parentNode) {\n      document.body.removeChild(anchor);\n    }\n    setTimeout(() => URL.revokeObjectURL(url), 750);\n  };\n\n  if (typeof requestAnimationFrame === 'function') {\n    requestAnimationFrame(cleanup);\n  } else {\n    cleanup();\n  }\n};\n\nconst translationModules = import.meta.glob<{ default: any }>(\n  '@/i18n/resources/*/*.json',\n  { eager: true }\n);\n\nconst buildTranslations = () => {\n  const result: TranslationRecord = {};\n\n  Object.entries(translationModules).forEach(([path, module]) => {\n    const match = path.match(/resources\\/(.+?)\\/(.+?)\\.json$/);\n    if (!match) {\n      return;\n    }\n\n    const [, language, namespace] = match;\n    const data = 'default' in module ? module.default : module;\n\n    if (!result[language]) {\n      result[language] = {};\n    }\n\n    result[language][namespace] = data;\n  });\n\n  return result;\n};\n\nconst translations = buildTranslations();\n\nconst getSupportedLanguages = () => Object.keys(translations).sort();\n\nconst getSupportedNamespaces = () => {\n  const namespaceSet = new Set<string>();\n\n  Object.values(translations).forEach((languageData) => {\n    Object.keys(languageData).forEach((namespace) => {\n      namespaceSet.add(namespace);\n    });\n  });\n\n  return Array.from(namespaceSet).sort();\n};\n\nexport const useTranslationFiles = () => {\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  const downloadLanguageFile = (languageCode: string, namespace: string) => {\n    try {\n      const data = translations[languageCode]?.[namespace];\n      if (!data) {\n        toast({\n          title: \"Error\",\n          description: `Translation file for ${languageCode}/${namespace} not found`,\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      if (shouldThrottleDownload(`file:${languageCode}:${namespace}`)) {\n        return;\n      }\n\n      const blob = new Blob([JSON.stringify(data, null, 2)], {\n        type: 'application/json',\n      });\n      triggerDownload(blob, `${languageCode}-${namespace}.json`);\n\n      toast({\n        title: \"Success\",\n        description: `Downloaded ${languageCode}/${namespace}.json`,\n      });\n    } catch (error) {\n      console.error('Error downloading file:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to download translation file\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const downloadLanguagePack = (languageCode: string) => {\n    try {\n      const languageData = translations[languageCode];\n      if (!languageData) {\n        toast({\n          title: \"Error\",\n          description: `Language pack for ${languageCode} not found`,\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      // Create a zip-like structure with multiple files\n      const files: { [key: string]: any } = {};\n      Object.entries(languageData).forEach(([namespace, data]) => {\n        files[`${namespace}.json`] = data;\n      });\n\n      if (shouldThrottleDownload(`pack:${languageCode}`)) {\n        return;\n      }\n\n      // For now, download as a single combined file\n      // In a real app, you might want to create an actual zip file\n      const blob = new Blob([JSON.stringify(files, null, 2)], {\n        type: 'application/json',\n      });\n      triggerDownload(blob, `${languageCode}-language-pack.json`);\n\n      toast({\n        title: \"Success\",\n        description: `Downloaded ${languageCode} language pack`,\n      });\n    } catch (error) {\n      console.error('Error downloading language pack:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to download language pack\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const downloadAllTranslations = () => {\n    try {\n      if (shouldThrottleDownload('pack:all')) {\n        return;\n      }\n\n      const blob = new Blob([JSON.stringify(translations, null, 2)], {\n        type: 'application/json',\n      });\n      triggerDownload(blob, 'all-translations.json');\n\n      toast({\n        title: \"Success\",\n        description: \"Downloaded all translations\",\n      });\n    } catch (error) {\n      console.error('Error downloading all translations:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to download translations\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const uploadTranslationFile = async (file: File, onFileWrite?: (filePath: string, content: string) => Promise<void>): Promise<boolean> => {\n    return new Promise((resolve) => {\n      setIsProcessing(true);\n      \n      const reader = new FileReader();\n      reader.onload = async (e) => {\n        try {\n          const content = e.target?.result as string;\n          const parsed = JSON.parse(content);\n          \n          // Validate the structure\n          if (typeof parsed !== 'object' || parsed === null) {\n            throw new Error('Invalid JSON structure');\n          }\n\n          // Parse filename to determine language and namespace\n          const fileName = file.name.replace('.json', '');\n          let languageCode: string, namespace: string;\n          \n          if (fileName.includes('-')) {\n            // Individual file format: en-common.json\n            [languageCode, namespace] = fileName.split('-');\n\n            // Validate language and namespace\n            if (!getSupportedLanguages().includes(languageCode)) {\n              throw new Error(`Invalid language code: ${languageCode}. Supported: ${getSupportedLanguages().join(', ')}`);\n            }\n\n            // Write individual file\n            if (onFileWrite) {\n              const filePath = `src/i18n/resources/${languageCode}/${namespace}.json`;\n              const fileContent = JSON.stringify(parsed, null, 2);\n              await onFileWrite(filePath, fileContent);\n            }\n\n            // Update in-memory translations immediately\n            translations[languageCode] = {\n              ...(translations[languageCode] || {}),\n              [namespace]: parsed,\n            };\n\n            toast({\n              title: \"Success\",\n              description: `Translation file ${file.name} uploaded successfully`,\n            });\n            \n          } else {\n            // Language pack format: process each namespace in the file\n            const match = fileName.match(/^([a-z]{2})(-language-pack)?$/);\n            if (match) {\n              languageCode = match[1];\n\n              if (!getSupportedLanguages().includes(languageCode)) {\n                throw new Error(`Invalid language code: ${languageCode}. Supported: ${getSupportedLanguages().join(', ')}`);\n              }\n\n              // Handle language pack format\n              if (typeof parsed === 'object' && Object.keys(parsed).some(key => key.includes('.json'))) {\n                // Language pack format with .json keys\n                for (const [fileKey, fileData] of Object.entries(parsed)) {\n                  if (fileKey.endsWith('.json')) {\n                    const ns = fileKey.replace('.json', '');\n\n                    if (onFileWrite) {\n                      const filePath = `src/i18n/resources/${languageCode}/${ns}.json`;\n                      const fileContent = JSON.stringify(fileData, null, 2);\n                      await onFileWrite(filePath, fileContent);\n                    }\n\n                    // Update in-memory translations\n                    translations[languageCode] = {\n                      ...(translations[languageCode] || {}),\n                      [ns]: fileData,\n                    };\n                  }\n                }\n                \n                toast({\n                  title: \"Success\",\n                  description: `Language pack ${fileName} uploaded successfully`,\n                });\n              } else {\n                throw new Error('Invalid language pack format');\n              }\n            } else {\n              throw new Error('Invalid file name format. Use: en-common.json or en-language-pack.json');\n            }\n          }\n          \n          setIsProcessing(false);\n          resolve(true);\n        } catch (error) {\n          console.error('Error processing file:', error);\n          toast({\n            title: \"Error\",\n            description: `Failed to process ${file.name}. ${error instanceof Error ? error.message : 'Please check the file format.'}`,\n            variant: \"destructive\",\n          });\n          setIsProcessing(false);\n          resolve(false);\n        }\n      };\n      \n      reader.onerror = () => {\n        toast({\n          title: \"Error\",\n          description: \"Failed to read file\",\n          variant: \"destructive\",\n        });\n        setIsProcessing(false);\n        resolve(false);\n      };\n      \n      reader.readAsText(file);\n    });\n  };\n\n  const getAvailableLanguages = () => getSupportedLanguages();\n  const getAvailableNamespaces = () => getSupportedNamespaces();\n\n  const getNamespacesForLanguage = (languageCode: string) =>\n    Object.keys(translations[languageCode] || {}).sort();\n\n  const getTranslationStats = () => {\n    const stats: { [key: string]: { [key: string]: number } } = {};\n\n    getSupportedLanguages().forEach((langCode) => {\n      const langData = translations[langCode] || {};\n      stats[langCode] = {};\n\n      Object.keys(langData)\n        .sort()\n        .forEach((namespace) => {\n          stats[langCode][namespace] = countKeys(langData[namespace]);\n        });\n    });\n\n    return stats;\n  };\n\n  const countKeys = (obj: any): number => {\n    let count = 0;\n    for (const key in obj) {\n      if (typeof obj[key] === 'object' && obj[key] !== null) {\n        count += countKeys(obj[key]);\n      } else {\n        count++;\n      }\n    }\n    return count;\n  };\n\n  return {\n    downloadLanguageFile,\n    downloadLanguagePack,\n    downloadAllTranslations,\n    uploadTranslationFile,\n    getAvailableLanguages,\n    getAvailableNamespaces,\n    getNamespacesForLanguage,\n    getTranslationStats,\n    isProcessing,\n  };\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useTutorialExit.ts","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":23,"column":30,"nodeType":"BlockStatement","messageId":"unexpected","endLine":23,"endColumn":32,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[799,799],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from \"react\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport { usePortalReset } from \"@/contexts/PortalResetContext\";\n\ninterface UseTutorialExitOptions {\n  currentStepTitle?: string;\n  onExitComplete?: () => void;\n}\n\nexport function useTutorialExit({ currentStepTitle, onExitComplete }: UseTutorialExitOptions = {}) {\n  const [isExiting, setIsExiting] = useState(false);\n  const navigate = useNavigate();\n  const location = useLocation();\n  const { reset } = usePortalReset();\n\n  const handleExitNow = useCallback(() => {\n    if (isExiting) return;\n    setIsExiting(true);\n    console.debug(\"[useTutorialExit] Long-press confirmed, exiting tutorial\");\n    try {\n      onExitComplete?.();\n    } finally {\n      try { reset(); } catch {}\n      requestAnimationFrame(() => {\n        requestAnimationFrame(() => {\n          if (location.pathname !== \"/getting-started\") {\n            navigate(\"/getting-started\", { replace: true });\n          }\n          setTimeout(() => setIsExiting(false), 0);\n        });\n      });\n    }\n  }, [isExiting, onExitComplete, reset, location.pathname, navigate]);\n\n  useEffect(() => {\n    return () => setIsExiting(false);\n  }, []);\n\n  return {\n    currentStepTitle,\n    isExiting,\n    handleExitNow\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useTypedTranslation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useUserPreferences.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":157,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5097,5100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5097,5100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { OnboardingStage } from \"@/constants/onboarding\";\n\nexport interface UserPreferences {\n  // User Settings\n  userId: string;\n  activeOrganizationId: string | null;\n  \n  // Onboarding Data\n  onboardingStage: OnboardingStage;\n  currentOnboardingStep: number;\n  welcomeModalShown: boolean;\n  \n  // Organization Settings\n  organizationId: string | null;\n  businessName: string;\n  logoUrl: string | null;\n  primaryBrandColor: string;\n  timezone: string;\n  dateFormat: string;\n  timeFormat: string;\n  \n  // User Profile\n  displayName: string | null;\n  avatarUrl: string | null;\n  \n  // Timestamps\n  lastUpdated: string;\n}\n\nconst PREFERENCES_CACHE_KEY = \"user-preferences\";\nconst CACHE_TTL = 12 * 60 * 60 * 1000; // 12 hours in ms\n\n// Fetch all user preferences in a single optimized query\nasync function fetchUserPreferences(userId: string): Promise<UserPreferences> {\n  console.log(\"ðŸ”„ fetchUserPreferences: Starting unified fetch for user\", userId);\n  \n  // Single query to get essential onboarding data (only columns we know exist)\n  const { data, error } = await supabase\n    .from('user_settings')\n    .select(`\n      user_id,\n      onboarding_stage,\n      current_onboarding_step,\n      welcome_modal_shown,\n      updated_at\n    `)\n    .eq('user_id', userId)\n    .maybeSingle();\n\n  if (error) {\n    console.error(\"ðŸ”„ fetchUserPreferences: Database error:\", error);\n    throw error;\n  }\n\n  // Create default preferences for new users\n  if (!data) {\n    console.log(\"ðŸ”„ fetchUserPreferences: No data found, creating defaults\");\n    \n    // Create minimal default user settings (only essential columns)\n    const { error: insertError } = await supabase\n      .from('user_settings')\n      .insert({\n        user_id: userId,\n        onboarding_stage: 'not_started',\n        current_onboarding_step: 1,\n        welcome_modal_shown: false\n      });\n\n    if (insertError) {\n      console.error(\"ðŸ”„ fetchUserPreferences: Error creating defaults:\", insertError);\n      throw insertError;\n    }\n\n    // Return default preferences\n    return {\n      userId,\n      activeOrganizationId: null,\n      onboardingStage: 'not_started' as OnboardingStage,\n      currentOnboardingStep: 1,\n      welcomeModalShown: false,\n      organizationId: null,\n      businessName: '',\n      logoUrl: null,\n      primaryBrandColor: '#1EB29F',\n      timezone: 'UTC',\n      dateFormat: 'DD/MM/YYYY',\n      timeFormat: '12-hour',\n      displayName: null,\n      avatarUrl: null,\n      lastUpdated: new Date().toISOString()\n    };\n  }\n\n  const preferences: UserPreferences = {\n    userId: data.user_id,\n    activeOrganizationId: null, // Will get from organization context\n    onboardingStage: (data.onboarding_stage as OnboardingStage) || 'not_started',\n    currentOnboardingStep: data.current_onboarding_step || 1,\n    welcomeModalShown: data.welcome_modal_shown || false,\n    organizationId: null, // Will get from organization context\n    businessName: '', // Will get from organization settings\n    logoUrl: null, // Will get from organization settings\n    primaryBrandColor: '#1EB29F', // Will get from organization settings\n    timezone: 'UTC', // Will get from organization settings\n    dateFormat: 'DD/MM/YYYY', // Will get from organization settings\n    timeFormat: '12-hour', // Default value\n    displayName: null, // Will get from profiles table\n    avatarUrl: null, // Will get from profiles table\n    lastUpdated: data.updated_at || new Date().toISOString()\n  };\n\n  console.log(\"ðŸ”„ fetchUserPreferences: Successfully fetched preferences\", {\n    onboardingStage: preferences.onboardingStage,\n    welcomeModalShown: preferences.welcomeModalShown,\n    currentStep: preferences.currentOnboardingStep\n  });\n\n  return preferences;\n}\n\nexport function useUserPreferences() {\n  const { user } = useAuth();\n  const queryClient = useQueryClient();\n\n  const query = useQuery({\n    queryKey: [PREFERENCES_CACHE_KEY, user?.id],\n    queryFn: () => fetchUserPreferences(user!.id),\n    enabled: !!user?.id,\n    staleTime: CACHE_TTL, // Consider data fresh for 12 hours\n    gcTime: CACHE_TTL * 2, // Keep in cache for 24 hours\n    refetchOnWindowFocus: false, // Don't refetch on window focus\n    refetchOnReconnect: true, // Do refetch on reconnect\n    retry: 3,\n    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000)\n  });\n\n  // Update preferences function with optimistic updates\n  const updatePreferences = async (updates: Partial<UserPreferences>) => {\n    if (!user?.id) return;\n\n    console.log(\"ðŸ”„ updatePreferences: Updating with optimistic update\", updates);\n\n    // Optimistic update\n    queryClient.setQueryData(\n      [PREFERENCES_CACHE_KEY, user.id],\n      (old: UserPreferences | undefined) => {\n        if (!old) return old;\n        return { ...old, ...updates, lastUpdated: new Date().toISOString() };\n      }\n    );\n\n    try {\n      // Update database (only onboarding-related columns for now)\n      const updateData: any = {};\n      \n      if (updates.onboardingStage !== undefined) updateData.onboarding_stage = updates.onboardingStage;\n      if (updates.currentOnboardingStep !== undefined) updateData.current_onboarding_step = updates.currentOnboardingStep;\n      if (updates.welcomeModalShown !== undefined) updateData.welcome_modal_shown = updates.welcomeModalShown;\n      \n      // Only update if we have data to update\n      if (Object.keys(updateData).length === 0) {\n        console.log(\"ðŸ”„ updatePreferences: No onboarding data to update, skipping\");\n        return;\n      }\n\n      const { error } = await supabase\n        .from('user_settings')\n        .update(updateData)\n        .eq('user_id', user.id);\n\n      if (error) throw error;\n\n      console.log(\"ðŸ”„ updatePreferences: Database updated successfully\");\n      \n      // Invalidate and refetch to ensure consistency\n      queryClient.invalidateQueries({ queryKey: [PREFERENCES_CACHE_KEY, user.id] });\n      \n    } catch (error) {\n      console.error(\"ðŸ”„ updatePreferences: Error updating preferences:\", error);\n      \n      // Revert optimistic update on error\n      queryClient.invalidateQueries({ queryKey: [PREFERENCES_CACHE_KEY, user.id] });\n      throw error;\n    }\n  };\n\n  // Forced refresh function for login/logout/org switch\n  const forceRefresh = () => {\n    console.log(\"ðŸ”„ forceRefresh: Forcing preferences refresh\");\n    queryClient.invalidateQueries({ queryKey: [PREFERENCES_CACHE_KEY] });\n  };\n\n  // Clear cache function\n  const clearCache = () => {\n    console.log(\"ðŸ”„ clearCache: Clearing preferences cache\");\n    queryClient.removeQueries({ queryKey: [PREFERENCES_CACHE_KEY] });\n  };\n\n  return {\n    data: query.data,\n    isLoading: query.isLoading,\n    error: query.error,\n    updatePreferences,\n    forceRefresh,\n    clearCache,\n    // Convenience computed values\n    isReady: !query.isLoading && !!query.data,\n    cacheStatus: query.isStale ? 'stale' : 'fresh'\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useUserRole.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useUserSettings.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4252,4255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4252,4255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSettings'. Either include it or remove the dependency array.","line":167,"column":6,"nodeType":"ArrayExpression","endLine":167,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSettings]","fix":{"range":[4630,4632],"text":"[fetchSettings]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Database } from \"@/integrations/supabase/types\";\n\ntype UserSettings = Database['public']['Tables']['user_settings']['Row'];\n\nconst defaultSettings: Partial<UserSettings> = {\n  show_quick_status_buttons: true,\n  photography_business_name: \"\",\n  logo_url: null,\n  primary_brand_color: \"#1EB29F\",\n  date_format: \"DD/MM/YYYY\",\n  notification_global_enabled: true,\n  notification_daily_summary_enabled: false,\n  notification_project_milestone_enabled: false,\n  notification_scheduled_time: \"09:00\"\n};\n\nexport function useUserSettings() {\n  const [settings, setSettings] = useState<Partial<UserSettings>>(defaultSettings);\n  const [loading, setLoading] = useState(true);\n  const [uploading, setUploading] = useState(false);\n  const { toast } = useToast();\n\n  // Fetch user settings\n  const fetchSettings = async () => {\n    try {\n      setLoading(true);\n      const { data: { user } } = await supabase.auth.getUser();\n      \n      if (!user) {\n        setLoading(false);\n        return;\n      }\n\n      // First ensure user settings exist\n      const { error: ensureError } = await supabase.rpc('ensure_user_settings', {\n        user_uuid: user.id\n      });\n\n      if (ensureError) throw ensureError;\n\n      // Then fetch the settings\n      const { data, error } = await supabase\n        .from('user_settings')\n        .select('*')\n        .eq('user_id', user.id)\n        .maybeSingle();\n\n      if (error && error.code !== 'PGRST116') {\n        throw error;\n      }\n\n      if (data) {\n        setSettings(data);\n      } else {\n        setSettings(defaultSettings);\n      }\n    } catch (error) {\n      console.error('Error fetching user settings:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to load settings\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Update user settings\n  const updateSettings = async (updates: Partial<UserSettings>) => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      \n      if (!user) throw new Error(\"No user found\");\n\n      const { data, error } = await supabase\n        .from('user_settings')\n        .update(updates)\n        .eq('user_id', user.id)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      setSettings(data);\n      return { success: true };\n    } catch (error) {\n      console.error('Error updating user settings:', error);\n      return { success: false, error };\n    }\n  };\n\n  // Upload logo file\n  const uploadLogo = async (file: File) => {\n    try {\n      setUploading(true);\n      const { data: { user } } = await supabase.auth.getUser();\n      \n      if (!user) throw new Error(\"No user found\");\n\n      // Validate file type\n      if (!file.type.startsWith('image/')) {\n        throw new Error('File must be an image');\n      }\n\n      // Validate file size (2MB limit)\n      if (file.size > 2 * 1024 * 1024) {\n        throw new Error('File size must be less than 2MB');\n      }\n\n      // Create unique filename\n      const fileExt = file.name.split('.').pop();\n      const fileName = `${user.id}/logo-${Date.now()}.${fileExt}`;\n\n      // Delete existing logo if it exists\n      if (settings?.logo_url) {\n        const oldPath = settings.logo_url.split('/').pop();\n        if (oldPath) {\n          await supabase.storage\n            .from('logos')\n            .remove([`${user.id}/${oldPath}`]);\n        }\n      }\n\n      // Upload new file\n      const { data: uploadData, error: uploadError } = await supabase.storage\n        .from('logos')\n        .upload(fileName, file);\n\n      if (uploadError) throw uploadError;\n\n      // Get public URL\n      const { data: { publicUrl } } = supabase.storage\n        .from('logos')\n        .getPublicUrl(fileName);\n\n      // Update settings with new logo URL\n      const updateResult = await updateSettings({ logo_url: publicUrl });\n      \n      if (!updateResult.success) throw updateResult.error;\n\n      toast({\n        title: \"Success\",\n        description: \"Logo uploaded successfully\",\n      });\n\n      return { success: true, url: publicUrl };\n    } catch (error: any) {\n      console.error('Error uploading logo:', error);\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to upload logo\",\n        variant: \"destructive\",\n      });\n      return { success: false, error };\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  // Initialize settings on mount\n  useEffect(() => {\n    fetchSettings();\n  }, []);\n\n  return {\n    settings,\n    loading,\n    uploading,\n    updateSettings,\n    uploadLogo,\n    refetch: fetchSettings\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useWorkflowHealth.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchWorkflowHealth'. Either include it or remove the dependency array.","line":198,"column":6,"nodeType":"ArrayExpression","endLine":198,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchWorkflowHealth]","fix":{"range":[6277,6279],"text":"[fetchWorkflowHealth]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { getUserOrganizationId } from '@/lib/organizationUtils';\n\ninterface WorkflowMetrics {\n  id: string;\n  organization_id: string;\n  date: string;\n  total_executions: number;\n  successful_executions: number;\n  failed_executions: number;\n  average_execution_time_ms: number;\n}\n\ninterface WorkflowHealth {\n  totalWorkflows: number;\n  activeWorkflows: number;\n  pausedWorkflows: number;\n  recentExecutions: number;\n  successRate: number;\n  averageExecutionTime: number;\n  failedExecutions: number;\n  stuckExecutions: number;\n  metrics: WorkflowMetrics[];\n}\n\nexport function useWorkflowHealth() {\n  const [health, setHealth] = useState<WorkflowHealth | null>(null);\n  const [loading, setLoading] = useState(true);\n  const { toast } = useToast();\n\n  const fetchWorkflowHealth = async () => {\n    try {\n      setLoading(true);\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) return;\n\n      // Get workflow counts\n      const { data: workflows, error: workflowsError } = await supabase\n        .from('workflows')\n        .select('id, is_active')\n        .eq('organization_id', organizationId);\n\n      if (workflowsError) throw workflowsError;\n\n      // Get execution metrics for the last 7 days\n      const sevenDaysAgo = new Date();\n      sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\n\n      const { data: metrics, error: metricsError } = await supabase\n        .from('workflow_execution_metrics')\n        .select('*')\n        .eq('organization_id', organizationId)\n        .gte('date', sevenDaysAgo.toISOString().split('T')[0])\n        .order('date', { ascending: false });\n\n      if (metricsError) throw metricsError;\n\n      // Get recent executions (last 24 hours)\n      const yesterday = new Date();\n      yesterday.setDate(yesterday.getDate() - 1);\n\n      const { data: recentExecutions, error: executionsError } = await supabase\n        .from('workflow_executions')\n        .select('id, status, started_at, completed_at')\n        .eq('workflows.organization_id', organizationId)\n        .gte('created_at', yesterday.toISOString());\n\n      if (executionsError) {\n        console.warn('Could not fetch recent executions:', executionsError);\n      }\n\n      // Check for stuck executions (running for more than 5 minutes)\n      const fiveMinutesAgo = new Date();\n      fiveMinutesAgo.setMinutes(fiveMinutesAgo.getMinutes() - 5);\n\n      const { data: stuckExecutions, error: stuckError } = await supabase\n        .from('workflow_executions')\n        .select('id')\n        .eq('status', 'running')\n        .lt('started_at', fiveMinutesAgo.toISOString());\n\n      if (stuckError) {\n        console.warn('Could not check for stuck executions:', stuckError);\n      }\n\n      // Calculate health metrics\n      const totalWorkflows = workflows?.length || 0;\n      const activeWorkflows = workflows?.filter(w => w.is_active).length || 0;\n      const pausedWorkflows = totalWorkflows - activeWorkflows;\n\n      const totalMetrics = metrics?.reduce((acc, m) => ({\n        total_executions: acc.total_executions + m.total_executions,\n        successful_executions: acc.successful_executions + m.successful_executions,\n        failed_executions: acc.failed_executions + m.failed_executions,\n        total_execution_time: acc.total_execution_time + (m.average_execution_time_ms * m.total_executions),\n      }), {\n        total_executions: 0,\n        successful_executions: 0,\n        failed_executions: 0,\n        total_execution_time: 0,\n      }) || {\n        total_executions: 0,\n        successful_executions: 0,\n        failed_executions: 0,\n        total_execution_time: 0,\n      };\n\n      const successRate = totalMetrics.total_executions > 0 \n        ? (totalMetrics.successful_executions / totalMetrics.total_executions) * 100 \n        : 100;\n\n      const averageExecutionTime = totalMetrics.total_executions > 0\n        ? totalMetrics.total_execution_time / totalMetrics.total_executions\n        : 0;\n\n      setHealth({\n        totalWorkflows,\n        activeWorkflows,\n        pausedWorkflows,\n        recentExecutions: recentExecutions?.length || 0,\n        successRate,\n        averageExecutionTime,\n        failedExecutions: totalMetrics.failed_executions,\n        stuckExecutions: stuckExecutions?.length || 0,\n        metrics: metrics || [],\n      });\n\n    } catch (error) {\n      console.error('Error fetching workflow health:', error);\n      toast({\n        title: 'Error',\n        description: 'Failed to load workflow health metrics',\n        variant: 'destructive',\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const cleanupStuckExecutions = async () => {\n    try {\n      const { data, error } = await supabase.rpc('cleanup_workflow_executions');\n      \n      if (error) throw error;\n\n      toast({\n        title: 'Success',\n        description: `Cleaned up ${data || 0} stuck executions`,\n      });\n\n      // Refresh health metrics\n      await fetchWorkflowHealth();\n    } catch (error) {\n      console.error('Error cleaning up executions:', error);\n      toast({\n        title: 'Error',\n        description: 'Failed to cleanup stuck executions',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const getHealthStatus = (): 'healthy' | 'warning' | 'critical' => {\n    if (!health) return 'warning';\n    \n    if (health.stuckExecutions > 0) return 'critical';\n    if (health.successRate < 80) return 'critical';\n    if (health.successRate < 95) return 'warning';\n    if (health.activeWorkflows === 0 && health.totalWorkflows > 0) return 'warning';\n    \n    return 'healthy';\n  };\n\n  const getHealthColor = () => {\n    const status = getHealthStatus();\n    switch (status) {\n      case 'healthy': return 'text-green-600';\n      case 'warning': return 'text-yellow-600';\n      case 'critical': return 'text-red-600';\n      default: return 'text-gray-600';\n    }\n  };\n\n  const getHealthIcon = () => {\n    const status = getHealthStatus();\n    switch (status) {\n      case 'healthy': return 'âœ…';\n      case 'warning': return 'âš ï¸';\n      case 'critical': return 'ðŸš¨';\n      default: return 'â“';\n    }\n  };\n\n  useEffect(() => {\n    fetchWorkflowHealth();\n  }, []);\n\n  return {\n    health,\n    loading,\n    fetchWorkflowHealth,\n    cleanupStuckExecutions,\n    getHealthStatus,\n    getHealthColor,\n    getHealthIcon,\n    refetch: fetchWorkflowHealth,\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useWorkflowTriggers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useWorkflows.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1221,1224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1221,1224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4812,4815],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4812,4815],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":176,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6110,6113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6110,6113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":226,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7990,7993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7990,7993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchWorkflows'. Either include it or remove the dependency array.","line":288,"column":6,"nodeType":"ArrayExpression","endLine":288,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchWorkflows]","fix":{"range":[9613,9615],"text":"[fetchWorkflows]"}}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useToast } from '@/hooks/use-toast';\nimport { Workflow, WorkflowStep, WorkflowFormData } from '@/types/workflow';\nimport { getUserOrganizationId } from '@/lib/organizationUtils';\n\nexport function useWorkflows() {\n  const [workflows, setWorkflows] = useState<Workflow[]>([]);\n  const [loading, setLoading] = useState(true);\n  const { toast } = useToast();\n\n  const fetchWorkflows = async () => {\n    try {\n      setLoading(true);\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) return;\n\n      const { data: workflowsData, error } = await supabase\n        .from('workflows')\n        .select(`\n          *,\n          workflow_steps (\n            id,\n            step_order,\n            action_type,\n            action_config,\n            delay_minutes,\n            is_active\n          )\n        `)\n        .eq('organization_id', organizationId)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      \n      // Transform workflows to include template data from steps\n      const transformedWorkflows = (workflowsData || []).map((workflow: any) => {\n        const firstStep = workflow.workflow_steps?.[0];\n        const actionConfig = firstStep?.action_config || {};\n        \n        return {\n          ...workflow,\n          template_id: actionConfig.template_id || '',\n          channels: actionConfig.channels || ['email'],\n          reminder_delay_minutes: firstStep?.delay_minutes || 0,\n          email_enabled: actionConfig.channels?.includes('email') ?? true,\n          whatsapp_enabled: actionConfig.channels?.includes('whatsapp') ?? true,\n          sms_enabled: actionConfig.channels?.includes('sms') ?? true\n        };\n      });\n      \n      setWorkflows(transformedWorkflows as Workflow[]);\n    } catch (error) {\n      console.error('Error fetching workflows:', error);\n      toast({\n        title: 'Error',\n        description: 'Failed to load workflows',\n        variant: 'destructive',\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const createWorkflow = async (formData: WorkflowFormData): Promise<void> => {\n    try {\n      // Input validation\n      if (!formData.name?.trim()) {\n        throw new Error('Workflow name is required');\n      }\n      if (!formData.trigger_type) {\n        throw new Error('Trigger type is required');\n      }\n      if (!formData.steps || formData.steps.length === 0) {\n        throw new Error('At least one workflow step is required');\n      }\n\n      const organizationId = await getUserOrganizationId();\n      if (!organizationId) throw new Error('No organization found');\n\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('No user found');\n\n      // Validate workflow steps\n      for (const [index, step] of formData.steps.entries()) {\n        if (!step.action_type) {\n          throw new Error(`Step ${index + 1}: Action type is required`);\n        }\n        if (!step.action_config || Object.keys(step.action_config).length === 0) {\n          throw new Error(`Step ${index + 1}: Action configuration is required`);\n        }\n        if (step.delay_minutes && (step.delay_minutes < 0 || step.delay_minutes > 43200)) {\n          throw new Error(`Step ${index + 1}: Delay must be between 0 and 43200 minutes (30 days)`);\n        }\n      }\n\n      const { data: workflow, error: workflowError } = await supabase\n        .from('workflows')\n        .insert({\n          user_id: user.id,\n          organization_id: organizationId,\n          name: formData.name.trim(),\n          description: formData.description?.trim() || null,\n          trigger_type: formData.trigger_type,\n          trigger_conditions: formData.trigger_conditions || {},\n          is_active: formData.is_active,\n        })\n        .select()\n        .single();\n\n      if (workflowError) throw workflowError;\n\n      // Create workflow steps with validation\n      if (formData.steps.length > 0) {\n        const stepsToInsert = formData.steps.map((step, index) => ({\n          workflow_id: workflow.id,\n          step_order: index + 1,\n          action_type: step.action_type,\n          action_config: step.action_config,\n          delay_minutes: Math.max(0, Math.min(43200, step.delay_minutes || 0)),\n          conditions: step.conditions || {},\n          is_active: step.is_active !== false, // Default to true\n        }));\n\n        const { error: stepsError } = await supabase\n          .from('workflow_steps')\n          .insert(stepsToInsert);\n\n        if (stepsError) throw stepsError;\n      }\n\n      toast({\n        title: 'Success',\n        description: 'Workflow created successfully',\n      });\n\n      await fetchWorkflows();\n    } catch (error: any) {\n      console.error('Error creating workflow:', error);\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to create workflow',\n        variant: 'destructive',\n      });\n      throw error;\n    }\n  };\n\n  const updateWorkflow = async (id: string, updates: Partial<WorkflowFormData>) => {\n    try {\n      // Input validation\n      if (!id) {\n        throw new Error('Workflow ID is required');\n      }\n      \n      if (updates.name !== undefined && !updates.name?.trim()) {\n        throw new Error('Workflow name cannot be empty');\n      }\n      \n      if (updates.steps) {\n        // Validate workflow steps\n        for (const [index, step] of updates.steps.entries()) {\n          if (!step.action_type) {\n            throw new Error(`Step ${index + 1}: Action type is required`);\n          }\n          if (!step.action_config || Object.keys(step.action_config).length === 0) {\n            throw new Error(`Step ${index + 1}: Action configuration is required`);\n          }\n          if (step.delay_minutes && (step.delay_minutes < 0 || step.delay_minutes > 43200)) {\n            throw new Error(`Step ${index + 1}: Delay must be between 0 and 43200 minutes (30 days)`);\n          }\n        }\n      }\n\n      // Update the main workflow\n      const updateData: any = { updated_at: new Date().toISOString() };\n      if (updates.name !== undefined) updateData.name = updates.name.trim();\n      if (updates.description !== undefined) updateData.description = updates.description?.trim() || null;\n      if (updates.trigger_type !== undefined) updateData.trigger_type = updates.trigger_type;\n      if (updates.trigger_conditions !== undefined) updateData.trigger_conditions = updates.trigger_conditions;\n      if (updates.is_active !== undefined) updateData.is_active = updates.is_active;\n\n      const { error: workflowError } = await supabase\n        .from('workflows')\n        .update(updateData)\n        .eq('id', id);\n\n      if (workflowError) throw workflowError;\n\n      // Handle workflow steps if provided\n      if (updates.steps) {\n        // Delete existing workflow steps\n        const { error: deleteError } = await supabase\n          .from('workflow_steps')\n          .delete()\n          .eq('workflow_id', id);\n\n        if (deleteError) throw deleteError;\n\n        // Insert new workflow steps with validation\n        if (updates.steps.length > 0) {\n          const stepsToInsert = updates.steps.map((step, index) => ({\n            workflow_id: id,\n            step_order: index + 1,\n            action_type: step.action_type,\n            action_config: step.action_config,\n            delay_minutes: Math.max(0, Math.min(43200, step.delay_minutes || 0)),\n            conditions: step.conditions || {},\n            is_active: step.is_active !== false, // Default to true\n          }));\n\n          const { error: stepsError } = await supabase\n            .from('workflow_steps')\n            .insert(stepsToInsert);\n\n          if (stepsError) throw stepsError;\n        }\n      }\n\n      toast({\n        title: 'Success',\n        description: 'Workflow updated successfully',\n      });\n\n      await fetchWorkflows();\n    } catch (error: any) {\n      console.error('Error updating workflow:', error);\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to update workflow',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const deleteWorkflow = async (id: string) => {\n    try {\n      // First delete workflow steps\n      await supabase.from('workflow_steps').delete().eq('workflow_id', id);\n      \n      // Then delete the workflow\n      const { error } = await supabase.from('workflows').delete().eq('id', id);\n      if (error) throw error;\n\n      toast({\n        title: 'Success',\n        description: 'Workflow deleted successfully',\n      });\n\n      await fetchWorkflows();\n    } catch (error) {\n      console.error('Error deleting workflow:', error);\n      toast({\n        title: 'Error',\n        description: 'Failed to delete workflow',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const toggleWorkflowStatus = async (id: string, isActive: boolean) => {\n    try {\n      const { error } = await supabase\n        .from('workflows')\n        .update({ is_active: isActive, updated_at: new Date().toISOString() })\n        .eq('id', id);\n\n      if (error) throw error;\n\n      toast({\n        title: 'Success',\n        description: `Workflow ${isActive ? 'activated' : 'paused'} successfully`,\n      });\n\n      await fetchWorkflows();\n    } catch (error) {\n      console.error('Error toggling workflow:', error);\n      toast({\n        title: 'Error',\n        description: 'Failed to update workflow status',\n        variant: 'destructive',\n      });\n    }\n  };\n\n  useEffect(() => {\n    fetchWorkflows();\n  }, []);\n\n  return {\n    workflows,\n    loading,\n    createWorkflow,\n    updateWorkflow,\n    deleteWorkflow,\n    toggleWorkflowStatus,\n    refetch: fetchWorkflows,\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/hooks/useWorkingHours.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchWorkingHours'. Either include it or remove the dependency array.","line":85,"column":6,"nodeType":"ArrayExpression","endLine":85,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchWorkingHours]","fix":{"range":[2151,2153],"text":"[fetchWorkingHours]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface WorkingHour {\n  id?: string;\n  day_of_week: number;\n  enabled: boolean;\n  start_time: string | null;\n  end_time: string | null;\n}\n\nexport function useWorkingHours() {\n  const [workingHours, setWorkingHours] = useState<WorkingHour[]>([]);\n  const [loading, setLoading] = useState(true);\n  const { toast } = useToast();\n\n  const fetchWorkingHours = async () => {\n    try {\n      setLoading(true);\n      const { data: { user } } = await supabase.auth.getUser();\n      \n      if (!user) {\n        setLoading(false);\n        return;\n      }\n\n      const { data, error } = await supabase\n        .from('working_hours')\n        .select('*')\n        .eq('user_id', user.id)\n        .order('day_of_week');\n\n      if (error) throw error;\n\n      setWorkingHours(data || []);\n    } catch (error) {\n      console.error('Error fetching working hours:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to load working hours\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const updateWorkingHour = async (dayOfWeek: number, updates: Partial<WorkingHour>) => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      \n      if (!user) throw new Error(\"No user found\");\n\n      const { data, error } = await supabase\n        .from('working_hours')\n        .update(updates)\n        .eq('user_id', user.id)\n        .eq('day_of_week', dayOfWeek)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      setWorkingHours(prev => \n        prev.map(wh => \n          wh.day_of_week === dayOfWeek ? { ...wh, ...updates } : wh\n        )\n      );\n\n      return { success: true };\n    } catch (error) {\n      console.error('Error updating working hour:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to update working hours\",\n        variant: \"destructive\",\n      });\n      return { success: false, error };\n    }\n  };\n\n  useEffect(() => {\n    fetchWorkingHours();\n  }, []);\n\n  return {\n    workingHours,\n    loading,\n    updateWorkingHour,\n    refetch: fetchWorkingHours\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/i18n/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/i18n/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/integrations/supabase/__tests__/client.test.ts","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":10,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":10,"endColumn":29},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":11,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":11,"endColumn":25},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":12,"column":27,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":12,"endColumn":47},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":62,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":62,"endColumn":23}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"jest.unmock(\"@/integrations/supabase/client\");\n\nconst createClientMock = jest.fn();\n\ntype LoadOptions = {\n  getUser?: jest.Mock;\n  onAuthStateChange?: jest.Mock;\n};\n\nconst path = require(\"path\");\nconst fs = require(\"fs\");\nconst { transformSync } = require(\"@swc/core\");\n\nconst CLIENT_PATH = path.resolve(__dirname, \"..\", \"client.ts\");\n\nconst loadClient = async (options: LoadOptions = {}) => {\n  createClientMock.mockReset();\n\n  const unsubscribe = jest.fn();\n  const getUser =\n    options.getUser ??\n    jest.fn().mockResolvedValue({\n      data: { user: { id: \"user-123\" } },\n      error: null,\n    });\n  const onAuthStateChange =\n    options.onAuthStateChange ??\n    jest.fn().mockReturnValue({\n      data: {\n        subscription: { unsubscribe },\n      },\n    });\n\n  createClientMock.mockReturnValue({\n    auth: {\n      getUser,\n      onAuthStateChange,\n    },\n  });\n\n  const source = fs.readFileSync(CLIENT_PATH, \"utf8\").replace(/import\\.meta/g, \"undefined\");\n  const { code } = transformSync(source, {\n    filename: CLIENT_PATH,\n    jsc: {\n      parser: { syntax: \"typescript\" },\n      target: \"es2019\",\n    },\n    module: {\n      type: \"commonjs\",\n    },\n  });\n\n  const moduleExports = {};\n  const moduleObj = { exports: moduleExports };\n  const localRequire = (id: string) => {\n    if (id === \"@supabase/supabase-js\") {\n      return { createClient: createClientMock };\n    }\n    if (id === \"./types\") {\n      return {};\n    }\n    return require(id);\n  };\n\n  const wrapped = new Function(\"require\", \"module\", \"exports\", \"__filename\", \"__dirname\", code);\n  wrapped(localRequire, moduleObj, moduleExports, CLIENT_PATH, path.dirname(CLIENT_PATH));\n\n  const supabase = moduleObj.exports.supabase as unknown as { auth: { getUser: jest.Mock } };\n\n  return { supabase, getUser, onAuthStateChange, unsubscribe };\n};\n\ndescribe(\"supabase client wrapper\", () => {\n  afterEach(() => {\n    jest.restoreAllMocks();\n    jest.clearAllMocks();\n  });\n\n  it(\"initializes Supabase client with persisted auth configuration\", async () => {\n    const { onAuthStateChange } = await loadClient();\n\n    expect(createClientMock).toHaveBeenCalledTimes(1);\n    const [url, key, options] = (createClientMock as jest.Mock).mock.calls[0];\n    expect(url).toBe(\"https://rifdykpdubrowzbylffe.supabase.co\");\n    expect(typeof key).toBe(\"string\");\n    expect(options.auth.persistSession).toBe(true);\n    expect(options.auth.autoRefreshToken).toBe(true);\n    expect(options.auth.storage).toBe(window.localStorage);\n    expect(onAuthStateChange).toHaveBeenCalledTimes(1);\n    expect(typeof onAuthStateChange.mock.calls[0][0]).toBe(\"function\");\n  });\n\n  it(\"reuses cached getUser responses within TTL and refreshes afterwards\", async () => {\n    const nowSpy = jest.spyOn(Date, \"now\").mockReturnValue(0);\n    const getUser = jest.fn().mockResolvedValue({\n      data: { user: { id: \"cached-user\" } },\n      error: null,\n    });\n\n    const { supabase } = await loadClient({ getUser });\n\n    await supabase.auth.getUser();\n    expect(getUser).toHaveBeenCalledTimes(1);\n\n    nowSpy.mockReturnValue(15_000);\n    await supabase.auth.getUser();\n    expect(getUser).toHaveBeenCalledTimes(1);\n\n    nowSpy.mockReturnValue(65_000);\n    await supabase.auth.getUser();\n    expect(getUser).toHaveBeenCalledTimes(2);\n  });\n\n  it(\"deduplicates inflight getUser requests\", async () => {\n    let resolveOriginal: (value: unknown) => void = () => {};\n    const originalPromise = new Promise((resolve) => {\n      resolveOriginal = resolve;\n    });\n    const getUser = jest.fn().mockReturnValue(originalPromise);\n    const { supabase } = await loadClient({ getUser });\n\n    const firstCall = supabase.auth.getUser();\n    const secondCall = supabase.auth.getUser();\n\n    expect(getUser).toHaveBeenCalledTimes(1);\n\n    resolveOriginal({\n      data: { user: { id: \"resolved-user\" } },\n      error: null,\n    });\n    await expect(firstCall).resolves.toEqual({\n      data: { user: { id: \"resolved-user\" } },\n      error: null,\n    });\n    await expect(secondCall).resolves.toEqual({\n      data: { user: { id: \"resolved-user\" } },\n      error: null,\n    });\n    expect(getUser).toHaveBeenCalledTimes(1);\n  });\n\n  it(\"does not cache null users\", async () => {\n    const getUser = jest\n      .fn()\n      .mockResolvedValueOnce({ data: { user: null }, error: null })\n      .mockResolvedValueOnce({ data: { user: { id: \"fresh-user\" } }, error: null });\n\n    const { supabase } = await loadClient({ getUser });\n\n    await supabase.auth.getUser();\n    await supabase.auth.getUser();\n\n    expect(getUser).toHaveBeenCalledTimes(2);\n  });\n\n  it(\"updates cached user when auth listener fires\", async () => {\n    const getUser = jest.fn().mockResolvedValue({\n      data: { user: { id: \"initial\" } },\n      error: null,\n    });\n    const { supabase, onAuthStateChange } = await loadClient({ getUser });\n\n    await supabase.auth.getUser();\n    const listener = onAuthStateChange.mock.calls[0][0] as (event: string, session: { user: unknown } | null) => void;\n    getUser.mockClear();\n\n    listener(\"TOKEN_REFRESHED\", { user: { id: \"from-event\" } });\n\n    const result = await supabase.auth.getUser();\n    expect(getUser).not.toHaveBeenCalled();\n    expect(result.data.user?.id).toBe(\"from-event\");\n  });\n\n  it(\"returns error payloads when getUser rejects\", async () => {\n    const failure = new Error(\"network\");\n    const getUser = jest\n      .fn()\n      .mockRejectedValueOnce(failure)\n      .mockResolvedValueOnce({ data: { user: { id: \"recovered\" } }, error: null });\n\n    const { supabase } = await loadClient({ getUser });\n\n    const first = await supabase.auth.getUser();\n    expect(first).toEqual({\n      data: { user: null },\n      error: failure,\n    });\n\n    const second = await supabase.auth.getUser();\n    expect(second.data.user?.id).toBe(\"recovered\");\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/integrations/supabase/client.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1154,1157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1154,1157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1210,1213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1210,1213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2080,2083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2080,2083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2345,2348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2345,2348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// This file is automatically generated. Do not edit it directly.\nimport { createClient } from '@supabase/supabase-js';\nimport type { Database } from './types';\n\nconst SUPABASE_URL = \"https://rifdykpdubrowzbylffe.supabase.co\";\nconst SUPABASE_PUBLISHABLE_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJpZmR5a3BkdWJyb3d6YnlsZmZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM3OTc5NDMsImV4cCI6MjA2OTM3Mzk0M30.lhSbTbVWckd9zsT0hRCAO06nPKszZpKNi_sq6-WPmV8\";\n\n// Import the supabase client like this:\n// import { supabase } from \"@/integrations/supabase/client\";\n\nexport const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {\n  auth: {\n    storage: localStorage,\n    persistSession: true,\n    autoRefreshToken: true,\n  }\n});\n\n// Lightweight cache wrapper to reduce repetitive auth.getUser network calls\n// Many components call getUser during mount; cache successful responses briefly and\n// update cache on auth state changes. Avoid caching null users to prevent stale state.\ntry {\n  // @ts-expect-error augment runtime method\n  const originalGetUser = supabase.auth.getUser.bind(supabase.auth);\n  let cachedUser: any = null;\n  let cachedAt = 0;\n  let inflight: Promise<any> | null = null;\n  // Increase cache TTL to reduce auth.getUser network calls,\n  // which were contributing to ~12 auth requests/min.\n  const TTL = 60_000; // 60 seconds\n\n  // Keep cache in sync with auth events\n  const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {\n    cachedUser = session?.user ?? null;\n    cachedAt = Date.now();\n  });\n  // Best-effort cleanup on hot reload\n  if (import.meta && import.meta.hot) {\n    import.meta.hot.on('supabase-auth-cache-dispose', () => subscription.unsubscribe());\n  }\n\n  // @ts-expect-error override runtime method\n  supabase.auth.getUser = async () => {\n    const now = Date.now();\n    if (cachedUser && now - cachedAt < TTL) {\n      return { data: { user: cachedUser }, error: null };\n    }\n    if (inflight) {\n      return inflight;\n    }\n    inflight = originalGetUser().then((res: any) => {\n      const user = res?.data?.user ?? null;\n      // Only cache if we actually have a user; avoid caching null\n      if (user) {\n        cachedUser = user;\n        cachedAt = Date.now();\n      }\n      inflight = null;\n      return res;\n    }).catch((err: any) => {\n      inflight = null;\n      return { data: { user: null }, error: err };\n    });\n    return inflight;\n  };\n} catch {\n  // no-op: if override fails, fall back to default behavior\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/integrations/supabase/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/AllProjectsLegacy.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchProjects'. Either include it or remove the dependency array.","line":126,"column":6,"nodeType":"ArrayExpression","endLine":126,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchProjects]","fix":{"range":[4949,4951],"text":"[fetchProjects]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6701,6704],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6701,6704],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6722,6725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6722,6725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":417,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":417,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15451,15454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15451,15454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @deprecated Use `AllProjectsRefactored` instead. Kept for historical reference.\nimport { useState, useEffect } from \"react\";\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Plus, LayoutGrid, List, Archive, ArrowUpDown, ArrowUp, ArrowDown, Settings } from \"lucide-react\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { format } from \"date-fns\";\nimport { ViewProjectDialog } from \"@/components/ViewProjectDialog\";\nimport { ProjectSheetView } from \"@/components/ProjectSheetView\";\nimport ProjectKanbanBoard from \"@/components/ProjectKanbanBoard\";\nimport GlobalSearch from \"@/components/GlobalSearch\";\nimport { PageHeader, PageHeaderSearch, PageHeaderActions } from \"@/components/ui/page-header\";\nimport { ProjectStatusBadge } from \"@/components/ProjectStatusBadge\";\nimport { formatDate } from \"@/lib/utils\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { OnboardingTutorial, TutorialStep } from \"@/components/shared/OnboardingTutorial\";\nimport { useOnboarding } from \"@/contexts/OnboardingContext\";\nimport { Calendar, MessageSquare, CheckSquare } from \"lucide-react\";\nimport { PageLoadingSkeleton } from \"@/components/ui/loading-presets\";\nimport { KanbanSettingsSheet } from \"@/components/KanbanSettingsSheet\";\nimport { useTranslation } from 'react-i18next';\nimport { useDashboardTranslation, useFormsTranslation } from '@/hooks/useTypedTranslation';\nimport { ProjectCreationWizardSheet } from \"@/features/project-creation\";\n\ninterface ProjectStatus {\n  id: string;\n  name: string;\n  color: string;\n  sort_order: number;\n}\n\ninterface Project {\n  id: string;\n  name: string;\n  description: string | null;\n  lead_id: string;\n  user_id: string;\n  created_at: string;\n  updated_at: string;\n  status_id?: string | null;\n  project_type_id?: string | null;\n  base_price?: number | null;\n  sort_order?: number;\n  lead: {\n    id: string;\n    name: string;\n    status: string;\n    email: string | null;\n    phone: string | null;\n  } | null;\n  project_status?: {\n    id: string;\n    name: string;\n    color: string;\n  } | null;\n  project_type?: {\n    id: string;\n    name: string;\n  } | null;\n  session_count?: number;\n  upcoming_session_count?: number;\n  planned_session_count?: number;\n  next_session_date?: string | null;\n  todo_count?: number;\n  completed_todo_count?: number;\n  total_payment_amount?: number;\n  paid_amount?: number;\n  remaining_amount?: number;\n  services?: Array<{\n    id: string;\n    name: string;\n  }>;\n}\n\ntype SortField = 'name' | 'lead_name' | 'project_type' | 'status' | 'created_at' | 'updated_at';\ntype SortDirection = 'asc' | 'desc';\n\nconst AllProjects = () => {\n  const [projects, setProjects] = useState<Project[]>([]);\n  const [archivedProjects, setArchivedProjects] = useState<Project[]>([]);\n  const [projectStatuses, setProjectStatuses] = useState<ProjectStatus[]>([]);\n  const [projectStatusesLoading, setProjectStatusesLoading] = useState(true);\n  const [loading, setLoading] = useState(true);\n  const [isInitialLoad, setIsInitialLoad] = useState(true);\n  const [viewMode, setViewMode] = useState<'board' | 'list' | 'archived'>('board');\n  const [viewingProject, setViewingProject] = useState<Project | null>(null);\n  const [showViewDialog, setShowViewDialog] = useState(false);\n  const [quickViewProject, setQuickViewProject] = useState<Project | null>(null);\n  const [showQuickView, setShowQuickView] = useState(false);\n  const [isProjectWizardOpen, setProjectWizardOpen] = useState(false);\n  const [sortField, setSortField] = useState<SortField>('created_at');\n  const [sortDirection, setSortDirection] = useState<SortDirection>('desc');\n  const navigate = useNavigate();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const { completeCurrentStep } = useOnboarding();\n  const isMobile = useIsMobile();\n  const { t } = useTranslation(['pages', 'common']);\n  const { t: tForms } = useFormsTranslation();\n  const { t: tDashboard } = useDashboardTranslation();\n\n  // Tutorial state\n  const [showTutorial, setShowTutorial] = useState(false);\n  const [currentTutorialStep, setCurrentTutorialStep] = useState(0);\n  \n  // Tutorial interaction tracking\n  const [hasMovedProject, setHasMovedProject] = useState(false);\n  const [hasClickedListView, setHasClickedListView] = useState(false);\n  const [hasClickedArchivedView, setHasClickedArchivedView] = useState(false);\n\n  // Update sort field when view mode changes\n  useEffect(() => {\n    if (viewMode === 'archived') {\n      setSortField('updated_at');\n    } else {\n      setSortField('created_at');\n    }\n    setSortDirection('desc');\n  }, [viewMode]);\n\n  useEffect(() => {\n    fetchProjects();\n  }, []);\n\n  // Handle tutorial launch\n  useEffect(() => {\n    const tutorial = searchParams.get('tutorial');\n    console.log('ðŸ” Tutorial check:', {\n      tutorial,\n      includes_true: tutorial?.includes('true'),\n      currentURL: window.location.href,\n      searchParams: searchParams.toString()\n    });\n    \n    // Check if tutorial parameter contains 'true' (handles malformed URLs)\n    if (tutorial?.includes('true')) {\n      console.log('âœ… Starting tutorial');\n      setShowTutorial(true);\n      // Clean up URL completely\n      const url = new URL(window.location.href);\n      url.searchParams.delete('tutorial');\n      window.history.replaceState({}, '', url.toString());\n    }\n  }, [searchParams]);\n\n  // Check if user is in guided mode but missing tutorial parameter\n  const { shouldLockNavigation, currentStepInfo } = useOnboarding();\n  useEffect(() => {\n    if (shouldLockNavigation && currentStepInfo?.id === 4 && !showTutorial) {\n      console.log('ðŸ”§ User in guided mode step 4 but no tutorial - redirecting with tutorial param');\n      navigate('/projects?tutorial=true', { replace: true });\n    }\n  }, [shouldLockNavigation, currentStepInfo, showTutorial, navigate]);\n\n  const handleSort = (field: SortField) => {\n    if (sortField === field) {\n      setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');\n    } else {\n      setSortField(field);\n      setSortDirection('asc');\n    }\n  };\n\n  const getSortIcon = (field: SortField) => {\n    if (sortField !== field) return <ArrowUpDown className=\"h-4 w-4\" />;\n    return sortDirection === 'asc' ? <ArrowUp className=\"h-4 w-4\" /> : <ArrowDown className=\"h-4 w-4\" />;\n  };\n\n  const sortedProjects = (viewMode === 'archived' ? archivedProjects : projects).sort((a, b) => {\n    let aValue: any;\n    let bValue: any;\n\n    switch (sortField) {\n      case 'name':\n        aValue = a.name;\n        bValue = b.name;\n        break;\n      case 'lead_name':\n        aValue = a.lead?.name || '';\n        bValue = b.lead?.name || '';\n        break;\n      case 'project_type':\n        aValue = a.project_type?.name || '';\n        bValue = b.project_type?.name || '';\n        break;\n      case 'status':\n        aValue = a.project_status?.name || '';\n        bValue = b.project_status?.name || '';\n        break;\n      case 'created_at':\n        aValue = new Date(a.created_at).getTime();\n        bValue = new Date(b.created_at).getTime();\n        break;\n      case 'updated_at':\n        aValue = new Date(a.updated_at).getTime();\n        bValue = new Date(b.updated_at).getTime();\n        break;\n      default:\n        return 0;\n    }\n\n    if (typeof aValue === 'string' && typeof bValue === 'string') {\n      aValue = aValue.toLowerCase();\n      bValue = bValue.toLowerCase();\n    }\n\n    if (aValue < bValue) return sortDirection === 'asc' ? -1 : 1;\n    if (aValue > bValue) return sortDirection === 'asc' ? 1 : -1;\n    return 0;\n  });\n\n  const fetchProjects = async () => {\n    try {\n      setProjectStatusesLoading(true);\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n\n      // Get user's active organization ID\n      const { data: organizationId } = await supabase.rpc('get_user_active_organization_id');\n      if (!organizationId) return;\n\n      const { data: projectsData, error } = await supabase\n        .from('projects')\n        .select('*')\n        .eq('organization_id', organizationId)\n        .order('sort_order', { ascending: true })\n        .order('created_at', { ascending: false });\n\n      if (error) {\n        console.error('Supabase error:', error);\n        throw error;\n      }\n\n      // Fetch all related data separately\n      const projectIds = (projectsData || []).map(p => p.id);\n      const leadIds = (projectsData || []).map(p => p.lead_id).filter(Boolean);\n      \n      const [sessionsData, todosData, servicesData, paymentsData, leadsData, projectStatusesData, projectTypesData] = await Promise.all([\n        // Get session counts\n        projectIds.length > 0 ? supabase\n          .from('sessions')\n          .select('project_id, status')\n          .in('project_id', projectIds) : Promise.resolve({ data: [] }),\n        \n        // Get todo counts  \n        projectIds.length > 0 ? supabase\n          .from('todos')\n          .select('project_id, is_completed')\n          .in('project_id', projectIds) : Promise.resolve({ data: [] }),\n          \n        // Get services\n        projectIds.length > 0 ? supabase\n          .from('project_services')\n          .select(`\n            project_id,\n            service:services(id, name)\n          `)\n          .in('project_id', projectIds) : Promise.resolve({ data: [] }),\n          \n        // Get payments\n        projectIds.length > 0 ? supabase\n          .from('payments')\n          .select('project_id, amount, status')\n          .in('project_id', projectIds) : Promise.resolve({ data: [] }),\n          \n        // Get leads\n        leadIds.length > 0 ? supabase\n          .from('leads')\n          .select('id, name, status, email, phone')\n          .in('id', leadIds) : Promise.resolve({ data: [] }),\n          \n        // Get project statuses\n        supabase\n          .from('project_statuses')\n          .select('id, name, color, sort_order')\n          .eq('organization_id', organizationId)\n          .order('sort_order', { ascending: true }),\n          \n        // Get project types\n        supabase\n          .from('project_types')\n          .select('id, name')\n          .eq('organization_id', organizationId)\n      ]);\n\n      // Process the data to handle archived projects\n      // Find the archived status ID\n      const archivedStatus = (projectStatusesData.data || []).find(status => status.name.toLowerCase() === 'archived');\n      const archivedStatusId = archivedStatus?.id;\n      \n      const activeProjects = (projectsData || []).filter(project => project.status_id !== archivedStatusId);\n      const archived = (projectsData || []).filter(project => project.status_id === archivedStatusId);\n\n      // Create count maps for efficient lookup\n      const sessionCounts = (sessionsData.data || []).reduce((acc, session) => {\n        if (!acc[session.project_id]) {\n          acc[session.project_id] = { total: 0, upcoming: 0, planned: 0 };\n        }\n        acc[session.project_id].total++;\n        if (session.status === 'upcoming') acc[session.project_id].upcoming++;\n        if (session.status === 'planned') acc[session.project_id].planned++;\n        return acc;\n      }, {});\n\n      const todoCounts = (todosData.data || []).reduce((acc, todo) => {\n        if (!acc[todo.project_id]) {\n          acc[todo.project_id] = { total: 0, completed: 0 };\n        }\n        acc[todo.project_id].total++;\n        if (todo.is_completed) acc[todo.project_id].completed++;\n        return acc;\n      }, {});\n\n      const projectServices = (servicesData.data || []).reduce((acc, ps) => {\n        if (!acc[ps.project_id]) acc[ps.project_id] = [];\n        if (ps.service) acc[ps.project_id].push(ps.service);\n        return acc;\n      }, {});\n\n      const paymentTotals = (paymentsData.data || []).reduce((acc, payment) => {\n        if (!acc[payment.project_id]) {\n          acc[payment.project_id] = { paid: 0 };\n        }\n        if (payment.status === 'paid') {\n          acc[payment.project_id].paid += Number(payment.amount || 0);\n        }\n        return acc;\n      }, {});\n\n      // Create lookup maps\n      const leadsMap = (leadsData.data || []).reduce((acc, lead) => {\n        acc[lead.id] = lead;\n        return acc;\n      }, {});\n      \n      const statusesMap = (projectStatusesData.data || []).reduce((acc, status) => {\n        acc[status.id] = status;\n        return acc;\n      }, {});\n      \n      const typesMap = (projectTypesData.data || []).reduce((acc, type) => {\n        acc[type.id] = type;\n        return acc;\n      }, {});\n\n      // Store project statuses for reuse\n      setProjectStatuses(projectStatusesData.data || []);\n\n      setProjects(activeProjects.map(project => ({\n        ...project,\n        lead: leadsMap[project.lead_id] || null,\n        project_status: statusesMap[project.status_id] || null,\n        project_type: typesMap[project.project_type_id] || null,\n        session_count: sessionCounts[project.id]?.total || 0,\n        upcoming_session_count: sessionCounts[project.id]?.upcoming || 0,\n        planned_session_count: sessionCounts[project.id]?.planned || 0,\n        todo_count: todoCounts[project.id]?.total || 0,\n        completed_todo_count: todoCounts[project.id]?.completed || 0,\n        paid_amount: paymentTotals[project.id]?.paid || 0,\n        remaining_amount: (Number(project.base_price || 0)) - (paymentTotals[project.id]?.paid || 0),\n        services: projectServices[project.id] || []\n      })) as Project[]);\n\n      setArchivedProjects(archived.map(project => ({\n        ...project,\n        lead: leadsMap[project.lead_id] || null,\n        project_status: statusesMap[project.status_id] || null,\n        project_type: typesMap[project.project_type_id] || null,\n        session_count: sessionCounts[project.id]?.total || 0,\n        upcoming_session_count: sessionCounts[project.id]?.upcoming || 0,\n        planned_session_count: sessionCounts[project.id]?.planned || 0,\n        todo_count: todoCounts[project.id]?.total || 0,\n        completed_todo_count: todoCounts[project.id]?.completed || 0,\n        paid_amount: paymentTotals[project.id]?.paid || 0,\n        remaining_amount: (Number(project.base_price || 0)) - (paymentTotals[project.id]?.paid || 0),\n        services: projectServices[project.id] || []\n      })) as Project[]);\n\n    } catch (error) {\n      console.error('Error fetching projects:', error);\n      toast({\n        title: t('common:labels.error'),\n        description: t('pages:projects.failedToLoadProjects'),\n        variant: \"destructive\",\n      });\n    } finally {\n      setProjectStatusesLoading(false);\n      setLoading(false);\n      setIsInitialLoad(false);\n    }\n  };\n\n  const handleProjectClick = (project: Project) => {\n    // Navigate to full project page instead of showing dialog\n    navigate(`/projects/${project.id}`);\n  };\n\n  const handleQuickView = (project: Project) => {\n    setQuickViewProject(project);\n    setShowQuickView(true);\n  };\n\n  const handleViewFullDetails = () => {\n    if (quickViewProject) {\n      navigate(`/projects/${quickViewProject.id}`);\n      setShowQuickView(false);\n    }\n  };\n\n  const handleLeadClick = (leadId: string) => {\n    navigate(`/leads/${leadId}`);\n  };\n\n  const handleSearchResult = (result: any) => {\n    if (result.type === 'project') {\n      navigate(`/projects/${result.id}`);\n    } else if (result.type === 'lead') {\n      navigate(`/leads/${result.id}`);\n    }\n  };\n\n  const getProgressBadge = (completed: number, total: number) => {\n    if (total === 0) return <span className=\"text-muted-foreground text-xs\">0/0</span>;\n    \n    const percentage = (completed / total) * 100;\n    const isComplete = percentage === 100;\n    \n    return (\n      <Badge \n        variant={isComplete ? \"default\" : \"secondary\"}\n        className={`text-xs ${isComplete ? 'bg-green-600 text-white' : ''}`}\n      >\n        {completed}/{total}\n      </Badge>\n    );\n  };\n\n  const renderServicesChips = (services: Array<{ id: string; name: string }>) => {\n    if (!services || services.length === 0) {\n      return <span className=\"text-muted-foreground text-xs\">-</span>;\n    }\n\n    const displayServices = services.slice(0, 3);\n    const overflowCount = services.length - 3;\n\n    return (\n      <div className=\"flex flex-wrap gap-1\">\n        {displayServices.map((service) => (\n          <Badge key={service.id} variant=\"outline\" className=\"text-xs\">\n            {service.name}\n          </Badge>\n        ))}\n        {overflowCount > 0 && (\n          <Badge variant=\"secondary\" className=\"text-xs\">\n            +{overflowCount}\n          </Badge>\n        )}\n      </div>\n    );\n  };\n\n  const handleViewChange = (view: 'board' | 'list' | 'archived') => {\n    setViewMode(view);\n    \n    // Track tutorial interactions\n    if (view === 'list') {\n      setHasClickedListView(true);\n    } else if (view === 'archived') {\n      setHasClickedArchivedView(true);\n    }\n  };\n\n  const handleProjectUpdate = (updatedProject: Project) => {\n    setProjects(prev => prev.map(p => \n      p.id === updatedProject.id ? updatedProject : p\n    ));\n    \n    // Track project movement for tutorial\n    setHasMovedProject(true);\n  };\n\n  // Tutorial steps\n  const tutorialSteps = [\n    {\n      id: 1,\n      title: tForms('projects.welcomeTutorialTitle'),\n      description: tForms('projects.welcomeTutorialDescription'),\n      content: <div className=\"space-y-4\">\n        <p className=\"text-sm text-muted-foreground\">\n          In this tutorial, you'll master the art of project management for photographers:\n        </p>\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-2 h-2 bg-primary rounded-full flex-shrink-0\"></div>\n            <span className=\"text-sm\">{t('projects.board_view_benefit')}</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-2 h-2 bg-primary rounded-full flex-shrink-0\"></div>\n            <span className=\"text-sm\">{t('projects.list_view_benefit')}</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-2 h-2 bg-primary rounded-full flex-shrink-0\"></div>\n            <span className=\"text-sm\">{t('projects.archived_view_benefit')}</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-2 h-2 bg-primary rounded-full flex-shrink-0\"></div>\n            <span className=\"text-sm\">{t('projects.status_management_benefit')}</span>\n          </div>\n        </div>\n        <div className=\"p-3 bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-lg mt-4\">\n          <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n            ðŸ’¡ Each view serves a different purpose to help you stay organized and efficient with your photography projects.\n          </p>\n        </div>\n      </div>,\n      canProceed: true,\n      mode: \"modal\" as const,\n    },\n    {\n      id: 2,\n      title: \"Board View (Kanban Style)\",\n      description: isMobile ? \"The board view shows your projects organized by stages in columns.\" : \"Try moving a project between stages by dragging and dropping to continue.\",\n      content: isMobile \n        ? \"This visual workflow shows projects in different stages. On mobile devices, tap on a project to change its status instead of dragging.\"\n        : \"The board view is perfect for visual project management. You can drag projects between columns to update their status. Try moving at least one project to a different stage to continue the tutorial.\",\n      canProceed: isMobile || hasMovedProject,\n      requiresAction: !isMobile,\n      disabledTooltip: isMobile ? undefined : tForms('projects.boardViewTooltip'),\n      mode: \"floating\" as const,\n    },\n    {\n      id: 3,\n      title: tForms('projects.listViewTitle'),\n      description: tForms('projects.listViewDescription'),\n      content: tForms('projects.listViewContent'),\n      canProceed: hasClickedListView,\n      requiresAction: true,\n      disabledTooltip: tForms('projects.listViewTooltip'),\n      mode: \"floating\" as const,\n    },\n    {\n      id: 4,\n      title: tForms('projects.archivedTitle'),\n      description: tForms('projects.archivedDescription'),\n      content: tForms('projects.archivedContent'),\n      canProceed: hasClickedArchivedView,\n      requiresAction: true,\n      disabledTooltip: tForms('projects.archivedTooltip'),\n      mode: \"floating\" as const,\n    },\n    {\n      id: 5,\n      title: tForms('projects.completionTitle'),\n      description: \"Congratulations! You now understand all three project views and how to use them effectively.\",\n      content: <div className=\"space-y-4\">\n        <p className=\"text-sm text-muted-foreground\">\n          You've successfully learned how to navigate between different project views:\n        </p>\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-2 h-2 bg-green-500 rounded-full flex-shrink-0\"></div>\n            <span className=\"text-sm\">{t('projects.board_view_summary')}</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-2 h-2 bg-green-500 rounded-full flex-shrink-0\"></div>\n            <span className=\"text-sm\">{t('projects.list_view_summary')}</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-2 h-2 bg-green-500 rounded-full flex-shrink-0\"></div>\n            <span className=\"text-sm\">{t('projects.archived_view_summary')}</span>\n          </div>\n        </div>\n        <div className=\"p-3 bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-800 rounded-lg\">\n          <p className=\"text-sm text-green-700 dark:text-green-300\">\n            ðŸŽ‰ You're ready to continue setting up your photography business and schedule your first session!\n          </p>\n        </div>\n      </div>,\n      canProceed: true,\n      mode: \"modal\" as const,\n    }\n  ];\n\n  const handleTutorialComplete = async () => {\n    try {\n      await completeCurrentStep();\n      setShowTutorial(false);\n      navigate('/getting-started');\n    } catch (error) {\n      console.error('Error completing tutorial:', error);\n      setShowTutorial(false);\n    }\n  };\n\n  const handleTutorialExit = () => {\n    setShowTutorial(false);\n  };\n\n  const formatCurrency = (amount: string | number | null) => {\n    const value = Number(amount || 0);\n    try {\n      return new Intl.NumberFormat('tr-TR', { style: 'currency', currency: 'TRY' }).format(value);\n    } catch {\n      return `${value.toFixed(2)} TRY`;\n    }\n  };\n\n  return (\n    <>\n      <ProjectCreationWizardSheet\n        isOpen={isProjectWizardOpen}\n        onOpenChange={setProjectWizardOpen}\n        entrySource=\"legacy\"\n        onProjectCreated={fetchProjects}\n      />\n      <div className=\"flex flex-col h-screen overflow-x-hidden\">\n      {/* Header */}\n      <div className=\"flex-shrink-0\">\n        <PageHeader\n          title={tForms('projects.pageTitle')}\n          subtitle={tForms('projects.pageSubtitle')}\n        >\n          <PageHeaderSearch>\n            <div className=\"flex items-center gap-2 w-full\">\n              <div className=\"flex-1 min-w-0\">\n                <GlobalSearch />\n              </div>\n              <Button \n                size=\"sm\"\n                className=\"h-10 flex items-center gap-2 whitespace-nowrap flex-shrink-0 px-3 sm:px-4\"\n                data-testid=\"add-project-button\"\n                onClick={() => setProjectWizardOpen(true)}\n              >\n                <Plus className=\"h-4 w-4\" />\n                <span className=\"hidden sm:inline\">{t('common:buttons.add_project')}</span>\n              </Button>\n            </div>\n          </PageHeaderSearch>\n        </PageHeader>\n      </div>\n\n      {/* View Toggle - mobile friendly tabs */}\n      <div className=\"flex-shrink-0 px-4 sm:px-6 pb-2\">\n        <div className=\"border-b border-border\">\n          <div className=\"flex items-center justify-between pb-0 overflow-x-auto\">\n            <div className=\"flex items-center gap-0\">\n              <button\n                onClick={() => handleViewChange('board')}\n                className={`flex items-center gap-2 px-3 py-2 text-sm font-medium whitespace-nowrap border-b-2 transition-colors ${\n                  viewMode === 'board'\n                    ? 'border-primary text-primary' \n                    : 'border-transparent text-muted-foreground hover:text-foreground'\n                }`}\n              >\n                <LayoutGrid className=\"h-4 w-4\" />\n                <span className=\"hidden sm:inline\">{tForms('projects.board')}</span>\n              </button>\n              <button\n                onClick={() => handleViewChange('list')}\n                className={`flex items-center gap-2 px-3 py-2 text-sm font-medium whitespace-nowrap border-b-2 transition-colors ${\n                  viewMode === 'list' \n                    ? 'border-primary text-primary' \n                    : 'border-transparent text-muted-foreground hover:text-foreground'\n                }`}\n              >\n                <List className=\"h-4 w-4\" />\n                <span className=\"hidden sm:inline\">{tForms('projects.list')}</span>\n              </button>\n              <button\n                onClick={() => handleViewChange('archived')}\n                className={`flex items-center gap-2 px-3 py-2 text-sm font-medium whitespace-nowrap border-b-2 transition-colors ${\n                  viewMode === 'archived' \n                    ? 'border-primary text-primary' \n                    : 'border-transparent text-muted-foreground hover:text-foreground'\n                }`}\n              >\n                <Archive className=\"h-4 w-4\" />\n                <span className=\"hidden sm:inline\">{tForms('projects.archived')}</span>\n                <span className=\"text-xs bg-muted text-muted-foreground px-1.5 py-0.5 rounded ml-1\">\n                  {archivedProjects.length}\n                </span>\n              </button>\n            </div>\n            \n            {viewMode === 'board' && (\n              <KanbanSettingsSheet>\n                <Button variant=\"ghost\" size=\"sm\" className=\"flex items-center gap-2 h-8 px-2 text-muted-foreground hover:bg-accent/5 hover:text-accent\">\n                  <Settings className=\"h-4 w-4\" />\n                  <span className=\"hidden md:inline text-sm\">{tForms('projects.boardSettings')}</span>\n                </Button>\n              </KanbanSettingsSheet>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Content area - board manages its own scroll, lists get contained scroll */}\n      <div className=\"flex-1 min-h-0\">\n        {viewMode === 'board' ? (\n          <ProjectKanbanBoard \n            projects={projects} \n            projectStatuses={projectStatuses}\n            onProjectsChange={fetchProjects}\n            onProjectUpdate={handleProjectUpdate}\n            onQuickView={handleQuickView}\n          />\n        ) : (\n          <div className=\"h-full overflow-y-auto p-4 sm:p-6\">\n            <Card className=\"w-full max-w-full\">\n              <CardContent className=\"pt-6 p-0 w-full max-w-full\">\n                {/* Table wrapper with horizontal scroll - headers stay outside */}\n                <div className=\"w-full overflow-x-auto overflow-y-hidden\" style={{ maxWidth: '100vw' }}>\n                  <div className=\"min-w-max\">\n                    <Table style={{ minWidth: '800px' }}>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead \n                            className=\"cursor-pointer hover:bg-muted/50 whitespace-nowrap\"\n                            onClick={() => handleSort('lead_name')}\n                          >\n                            <div className=\"flex items-center gap-2\">\n                              {tForms('projects.table_columns.client')}\n                              {getSortIcon('lead_name')}\n                            </div>\n                          </TableHead>\n                          <TableHead \n                            className=\"cursor-pointer hover:bg-muted/50 whitespace-nowrap\"\n                            onClick={() => handleSort('name')}\n                          >\n                            <div className=\"flex items-center gap-2\">\n                              {tForms('projects.table_columns.project_name')}\n                              {getSortIcon('name')}\n                            </div>\n                          </TableHead>\n                          <TableHead \n                            className=\"cursor-pointer hover:bg-muted/50 whitespace-nowrap\"\n                            onClick={() => handleSort('project_type')}\n                          >\n                            <div className=\"flex items-center gap-2\">\n                              {tForms('projects.table_columns.project_type')}\n                              {getSortIcon('project_type')}\n                            </div>\n                          </TableHead>\n                          {viewMode !== 'archived' ? (\n                            <>\n                              <TableHead \n                                className=\"cursor-pointer hover:bg-muted/50\"\n                                onClick={() => handleSort('status')}\n                              >\n                                <div className=\"flex items-center gap-2\">\n                                  {tForms('projects.table_columns.status')}\n                                  {getSortIcon('status')}\n                                </div>\n                              </TableHead>\n                              <TableHead className=\"whitespace-nowrap\">{tForms('projects.table_columns.sessions')}</TableHead>\n                              <TableHead className=\"whitespace-nowrap\">{tForms('projects.table_columns.progress')}</TableHead>\n                              <TableHead className=\"whitespace-nowrap\">{tForms('projects.table_columns.services')}</TableHead>\n                            </>\n                           ) : (\n                            <>\n                              <TableHead className=\"whitespace-nowrap\">{tForms('projects.table_columns.paid')}</TableHead>\n                              <TableHead className=\"whitespace-nowrap\">{tForms('projects.table_columns.remaining')}</TableHead>\n                               <TableHead \n                                 className=\"cursor-pointer hover:bg-muted/50 whitespace-nowrap\"\n                                 onClick={() => handleSort('updated_at')}\n                               >\n                                 <div className=\"flex items-center gap-2\">\n                                   {tForms('projects.table_columns.last_update')}\n                                   {getSortIcon('updated_at')}\n                                 </div>\n                               </TableHead>\n                             </>\n                           )}\n                           {viewMode !== 'archived' && (\n                             <TableHead \n                               className=\"cursor-pointer hover:bg-muted/50 whitespace-nowrap\"\n                               onClick={() => handleSort('created_at')}\n                             >\n                               <div className=\"flex items-center gap-2\">\n                                 {tForms('projects.table_columns.created')}\n                                 {getSortIcon('created_at')}\n                               </div>\n                             </TableHead>\n                           )}\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {sortedProjects.length > 0 ? (\n                          sortedProjects.map((project) => (\n                            <TableRow key={project.id} className=\"hover:bg-muted/50\">\n                               <TableCell>\n                                 <button\n                                   onClick={() => project.lead?.id && handleLeadClick(project.lead.id)}\n                                   className=\"font-medium text-left hover:underline cursor-pointer\"\n                                   disabled={!project.lead?.id}\n                                 >\n                                   {project.lead?.name || 'No Lead'}\n                                 </button>\n                               </TableCell>\n                                <TableCell>\n                                  <button\n                                    onClick={() => handleQuickView(project)}\n                                    className=\"font-medium text-left hover:underline cursor-pointer\"\n                                  >\n                                    {project.name}\n                                  </button>\n                                </TableCell>\n                              <TableCell>\n                                {project.project_type ? (\n                                  <Badge variant=\"outline\" className=\"text-xs\">\n                                    {project.project_type.name}\n                                  </Badge>\n                                ) : (\n                                  <span className=\"text-muted-foreground\">-</span>\n                                )}\n                               </TableCell>\n                               {viewMode !== 'archived' && (\n                               <TableCell>\n                                  <ProjectStatusBadge\n                                    projectId={project.id}\n                                    currentStatusId={project.status_id ?? undefined}\n                                    editable={true}\n                                    size=\"sm\"\n                                    onStatusChange={fetchProjects}\n                                    statuses={projectStatuses}\n                                    statusesLoading={projectStatusesLoading}\n                                  />\n                                </TableCell>\n                              )}\n                               {viewMode !== 'archived' ? (\n                                 <>\n                                     <TableCell>\n                                       <div className=\"text-sm\">\n                                         <div>{project.session_count || 0} {tForms('projects.table_columns.sessions_planned')}</div>\n                                       </div>\n                                     </TableCell>\n                                   <TableCell>\n                                     {getProgressBadge(project.completed_todo_count || 0, project.todo_count || 0)}\n                                   </TableCell>\n                                     <TableCell>\n                                       {renderServicesChips(project.services || [])}\n                                     </TableCell>\n                                   </>\n                                 ) : (\n                                 <>\n                                   <TableCell>\n                                     <span className=\"font-medium text-green-600\">\n                                       {formatCurrency(project.paid_amount || 0)}\n                                     </span>\n                                   </TableCell>\n                                   <TableCell>\n                                     <span className={project.remaining_amount && project.remaining_amount > 0 ? \"font-medium text-orange-600\" : \"text-muted-foreground\"}>\n                                       {formatCurrency(project.remaining_amount || 0)}\n                                     </span>\n                                   </TableCell>\n                                   <TableCell>\n                                     {formatDate(project.updated_at)}\n                                   </TableCell>\n                                 </>\n                                )}\n                                {viewMode !== 'archived' && (\n                                  <TableCell>\n                                    {formatDate(project.created_at)}\n                                  </TableCell>\n                                )}\n                            </TableRow>\n                           ))\n                        ) : (\n                           <TableRow>\n                             <TableCell colSpan={8} className=\"text-center py-8 text-muted-foreground\">\n                              {t('projects.table_columns.no_projects_found')}\n                            </TableCell>\n                          </TableRow>\n                        )}\n                      </TableBody>\n                     </Table>\n                   </div>\n                 </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n      </div>\n\n      {/* Project Sheet View */}\n      <ProjectSheetView\n        project={quickViewProject}\n        open={showQuickView}\n        onOpenChange={setShowQuickView}\n        onProjectUpdated={fetchProjects}\n        leadName={quickViewProject?.lead?.name || \"\"}\n        mode=\"sheet\"\n        onViewFullDetails={handleViewFullDetails}\n      />\n\n      {/* View Project Dialog */}\n      <ViewProjectDialog\n        project={viewingProject}\n        open={showViewDialog}\n        onOpenChange={setShowViewDialog}\n        onProjectUpdated={fetchProjects}\n        onActivityUpdated={() => {}} // Not needed in this context\n        leadName={viewingProject?.lead?.name || \"\"}\n      />\n\n      {/* Tutorial Component - positioned to not block view selector */}\n      {showTutorial && (\n        <div className=\"fixed inset-0 z-[100] pointer-events-none\">\n          <div className=\"pointer-events-auto\">\n            <OnboardingTutorial\n              steps={tutorialSteps}\n              isVisible={showTutorial}\n              onComplete={handleTutorialComplete}\n              onExit={handleTutorialExit}\n              initialStepIndex={currentTutorialStep}\n            />\n          </div>\n        </div>\n      )}\n      </div>\n    </>\n  );\n};\n\nexport default AllProjects;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/ProjectDetailLegacy.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/components/common/EntityDetailLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/components/common/EntityFilters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/components/common/EntityForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1306,1309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1306,1309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1831,1834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1831,1834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useCallback } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { AlertTriangle, Save, X } from 'lucide-react';\nimport { FormField } from './FormField';\nimport { validateEntityForm, ValidationRule } from '@/utils/validationUtils';\n\nexport interface EntityFormField {\n  key: string;\n  type: 'text' | 'textarea' | 'email' | 'phone' | 'date' | 'time' | 'number' | 'select' | 'checkbox';\n  label: string;\n  placeholder?: string;\n  required?: boolean;\n  validation?: ValidationRule[];\n  options?: Array<{ value: string; label: string }>;\n  rows?: number; // for textarea\n  min?: number; // for number/date\n  max?: number; // for number/date\n  step?: number; // for number\n  disabled?: boolean;\n  helpText?: string;\n}\n\nexport interface EntityFormProps<T> {\n  title?: string;\n  fields: EntityFormField[];\n  initialData?: Partial<T>;\n  onSubmit: (data: T) => Promise<void>;\n  onCancel?: () => void;\n  submitLabel?: string;\n  cancelLabel?: string;\n  loading?: boolean;\n  error?: string | null;\n  className?: string;\n  showCard?: boolean;\n  validateOnChange?: boolean;\n}\n\nexport function EntityForm<T extends Record<string, any>>({\n  title,\n  fields,\n  initialData = {},\n  onSubmit,\n  onCancel,\n  submitLabel = 'Save',\n  cancelLabel = 'Cancel',\n  loading = false,\n  error = null,\n  className,\n  showCard = true,\n  validateOnChange = false\n}: EntityFormProps<T>) {\n  const [formData, setFormData] = useState<Partial<T>>(initialData);\n  const [fieldErrors, setFieldErrors] = useState<Record<string, string>>({});\n  const [touched, setTouched] = useState<Record<string, boolean>>({});\n\n  const handleFieldChange = useCallback((fieldKey: string, value: any) => {\n    setFormData(prev => ({ ...prev, [fieldKey]: value }));\n    setTouched(prev => ({ ...prev, [fieldKey]: true }));\n\n    // Clear field error when user starts typing\n    if (fieldErrors[fieldKey]) {\n      setFieldErrors(prev => {\n        const newErrors = { ...prev };\n        delete newErrors[fieldKey];\n        return newErrors;\n      });\n    }\n\n    // Validate on change if enabled\n    if (validateOnChange) {\n      const field = fields.find(f => f.key === fieldKey);\n      if (field && field.validation) {\n        const fieldError = validateEntityForm({ [fieldKey]: value }, [field]);\n        if (fieldError[fieldKey]) {\n          setFieldErrors(prev => ({ ...prev, [fieldKey]: fieldError[fieldKey] }));\n        }\n      }\n    }\n  }, [fieldErrors, fields, validateOnChange]);\n\n  const handleSubmit = useCallback(async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    // Validate all fields\n    const errors = validateEntityForm(formData, fields);\n    setFieldErrors(errors);\n\n    // Mark all fields as touched to show errors\n    const touchedFields = fields.reduce((acc, field) => {\n      acc[field.key] = true;\n      return acc;\n    }, {} as Record<string, boolean>);\n    setTouched(touchedFields);\n\n    // Don't submit if there are validation errors\n    if (Object.keys(errors).length > 0) {\n      return;\n    }\n\n    try {\n      await onSubmit(formData as T);\n    } catch (error) {\n      // Error is handled by the parent component\n      console.error('Form submission error:', error);\n    }\n  }, [formData, fields, onSubmit]);\n\n  const handleCancel = useCallback(() => {\n    setFormData(initialData);\n    setFieldErrors({});\n    setTouched({});\n    onCancel?.();\n  }, [initialData, onCancel]);\n\n  const isValid = Object.keys(fieldErrors).length === 0;\n  const hasRequiredFields = fields.some(field => field.required);\n  const canSubmit = hasRequiredFields ? isValid && Object.keys(touched).length > 0 : isValid;\n\n  const content = (\n    <form onSubmit={handleSubmit} className={className}>\n      {title && !showCard && <h2 className=\"text-xl font-semibold mb-6\">{title}</h2>}\n      \n      {error && (\n        <Alert variant=\"destructive\" className=\"mb-6\">\n          <AlertTriangle className=\"h-4 w-4\" />\n          <AlertDescription>{error}</AlertDescription>\n        </Alert>\n      )}\n\n      <div className=\"space-y-4\">\n        {fields.map((field) => (\n          <FormField\n            key={field.key}\n            field={field}\n            value={formData[field.key]}\n            onChange={(value) => handleFieldChange(field.key, value)}\n            error={touched[field.key] ? fieldErrors[field.key] : undefined}\n            disabled={loading || field.disabled}\n          />\n        ))}\n      </div>\n\n      <div className=\"flex flex-col sm:flex-row gap-3 pt-6\">\n        <Button\n          type=\"submit\"\n          disabled={loading || !canSubmit}\n          className=\"flex-1 sm:flex-none\"\n        >\n          <Save className=\"h-4 w-4 mr-2\" />\n          {loading ? 'Saving...' : submitLabel}\n        </Button>\n        \n        {onCancel && (\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={handleCancel}\n            disabled={loading}\n            className=\"flex-1 sm:flex-none\"\n          >\n            <X className=\"h-4 w-4 mr-2\" />\n            {cancelLabel}\n          </Button>\n        )}\n      </div>\n    </form>\n  );\n\n  if (!showCard) {\n    return content;\n  }\n\n  return (\n    <Card>\n      {title && (\n        <CardHeader>\n          <CardTitle>{title}</CardTitle>\n        </CardHeader>\n      )}\n      <CardContent>\n        {content}\n      </CardContent>\n    </Card>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/components/common/EntityListView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/components/common/FormField.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[650,653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[650,653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[675,678],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[675,678],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Label } from '@/components/ui/label';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { HelpCircle } from 'lucide-react';\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\nimport { EntityFormField } from './EntityForm';\n\ninterface FormFieldProps {\n  field: EntityFormField;\n  value: any;\n  onChange: (value: any) => void;\n  error?: string;\n  disabled?: boolean;\n}\n\nexport function FormField({\n  field,\n  value,\n  onChange,\n  error,\n  disabled = false\n}: FormFieldProps) {\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n    const newValue = field.type === 'number' ? parseFloat(e.target.value) : e.target.value;\n    onChange(newValue);\n  };\n\n  const handleSelectChange = (newValue: string) => {\n    onChange(newValue);\n  };\n\n  const handleCheckboxChange = (checked: boolean) => {\n    onChange(checked);\n  };\n\n  const renderInput = () => {\n    const baseProps = {\n      id: field.key,\n      value: value || '',\n      disabled,\n      className: error ? 'border-destructive' : '',\n    };\n\n    switch (field.type) {\n      case 'textarea':\n        return (\n          <Textarea\n            {...baseProps}\n            placeholder={field.placeholder}\n            rows={field.rows || 3}\n            onChange={handleInputChange}\n          />\n        );\n\n      case 'select':\n        return (\n          <Select value={value || ''} onValueChange={handleSelectChange} disabled={disabled}>\n            <SelectTrigger className={error ? 'border-destructive' : ''}>\n              <SelectValue placeholder={field.placeholder} />\n            </SelectTrigger>\n            <SelectContent>\n              {field.options?.map((option) => (\n                <SelectItem key={option.value} value={option.value}>\n                  {option.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        );\n\n      case 'checkbox':\n        return (\n          <div className=\"flex items-center space-x-2\">\n            <Checkbox\n              id={field.key}\n              checked={value || false}\n              onCheckedChange={handleCheckboxChange}\n              disabled={disabled}\n            />\n            <Label\n              htmlFor={field.key}\n              className={`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ${\n                error ? 'text-destructive' : ''\n              }`}\n            >\n              {field.label}\n              {field.required && <span className=\"text-destructive ml-1\">*</span>}\n            </Label>\n          </div>\n        );\n\n      case 'number':\n        return (\n          <Input\n            {...baseProps}\n            type=\"number\"\n            placeholder={field.placeholder}\n            min={field.min}\n            max={field.max}\n            step={field.step}\n            onChange={handleInputChange}\n          />\n        );\n\n      case 'date':\n        return (\n          <Input\n            {...baseProps}\n            type=\"date\"\n            min={field.min}\n            max={field.max}\n            onChange={handleInputChange}\n          />\n        );\n\n      case 'time':\n        return (\n          <Input\n            {...baseProps}\n            type=\"time\"\n            step={field.step}\n            onChange={handleInputChange}\n          />\n        );\n\n      case 'email':\n        return (\n          <Input\n            {...baseProps}\n            type=\"email\"\n            placeholder={field.placeholder}\n            onChange={handleInputChange}\n          />\n        );\n\n      case 'phone':\n        return (\n          <Input\n            {...baseProps}\n            type=\"tel\"\n            placeholder={field.placeholder}\n            onChange={handleInputChange}\n          />\n        );\n\n      default:\n        return (\n          <Input\n            {...baseProps}\n            type=\"text\"\n            placeholder={field.placeholder}\n            onChange={handleInputChange}\n          />\n        );\n    }\n  };\n\n  if (field.type === 'checkbox') {\n    return (\n      <div className=\"space-y-2\">\n        {renderInput()}\n        {field.helpText && (\n          <p className=\"text-xs text-muted-foreground\">{field.helpText}</p>\n        )}\n        {error && (\n          <Alert variant=\"destructive\">\n            <AlertDescription className=\"text-xs\">{error}</AlertDescription>\n          </Alert>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      <div className=\"flex items-center gap-2\">\n        <Label\n          htmlFor={field.key}\n          className={`text-sm font-medium ${error ? 'text-destructive' : ''}`}\n        >\n          {field.label}\n          {field.required && <span className=\"text-destructive ml-1\">*</span>}\n        </Label>\n        \n        {field.helpText && (\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <HelpCircle className=\"h-4 w-4 text-muted-foreground cursor-help\" />\n              </TooltipTrigger>\n              <TooltipContent>\n                <p className=\"max-w-xs text-xs\">{field.helpText}</p>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        )}\n      </div>\n      \n      {renderInput()}\n      \n      {error && (\n        <Alert variant=\"destructive\">\n          <AlertDescription className=\"text-xs\">{error}</AlertDescription>\n        </Alert>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/components/common/LoadingStates.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/components/optimized/AccessibleGlobalSearch.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'handleResultClick'. Either include it or remove the dependency array.","line":42,"column":8,"nodeType":"ArrayExpression","endLine":42,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [handleResultClick]","fix":{"range":[1522,1524],"text":"[handleResultClick]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2739,2742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2739,2742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef, useMemo, useCallback } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Input } from \"@/components/ui/input\";\nimport { Search, X } from \"lucide-react\";\nimport { SearchLoadingSkeleton } from \"@/components/ui/loading-presets\";\nimport { useNavigate } from \"react-router-dom\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { useKeyboardNavigation, useScreenReader } from '@/hooks/useAccessibility';\nimport { performanceMonitor } from '@/utils/performance';\n\ninterface SearchResult {\n  id: string;\n  leadId?: string;\n  leadName?: string;\n  projectId?: string;\n  projectName?: string;\n  type: 'lead' | 'note' | 'reminder' | 'session' | 'project';\n  matchedContent: string;\n  status: string;\n  icon: React.ReactNode;\n}\n\n/**\n * Accessible Global Search with keyboard navigation and screen reader support\n */\nexport const AccessibleGlobalSearch = React.memo(() => {\n  const [query, setQuery] = useState(\"\");\n  const [results, setResults] = useState<SearchResult[]>([]);\n  const [isOpen, setIsOpen] = useState(false);\n  const [loading, setLoading] = useState(false);\n  \n  const searchRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const navigate = useNavigate();\n  \n  // Accessibility hooks\n  const { announce } = useScreenReader();\n  const { activeIndex, handleKeyDown, containerRef } = useKeyboardNavigation(\n    results,\n    useCallback((result: SearchResult) => {\n      handleResultClick(result);\n    }, [])\n  );\n\n  // Memoized search function for performance\n  const performSearch = useCallback(async (searchQuery: string) => {\n    performanceMonitor.startTiming('GlobalSearch.performSearch');\n    setLoading(true);\n    \n    try {\n      // Simplified search for demonstration - would include full search logic\n      const { data: leads } = await supabase\n        .from('leads')\n        .select('id, name, email, phone, status, status_id')\n        .or(`name.ilike.%${searchQuery}%,email.ilike.%${searchQuery}%`);\n\n      const searchResults: SearchResult[] = (leads || []).map(lead => ({\n        id: lead.id,\n        leadId: lead.id,\n        leadName: lead.name,\n        type: 'lead' as const,\n        matchedContent: lead.email ? `Email: ${lead.email}` : '',\n        status: lead.status,\n        icon: <Search className=\"h-4 w-4\" />\n      }));\n\n      setResults(searchResults);\n      setIsOpen(true);\n      \n      // Announce results to screen readers\n      const resultCount = searchResults.length;\n      announce(\n        resultCount === 0 \n          ? \"No search results found\"\n          : `${resultCount} search ${resultCount === 1 ? 'result' : 'results'} found`,\n        'polite'\n      );\n      \n    } catch (error: any) {\n      toast({\n        title: \"Search error\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n      announce(\"Search failed\", 'assertive');\n    } finally {\n      setLoading(false);\n      performanceMonitor.endTiming('GlobalSearch.performSearch');\n    }\n  }, [announce]);\n\n  // Debounced search effect\n  useEffect(() => {\n    const delayedSearch = setTimeout(() => {\n      if (query.trim().length > 2) {\n        performSearch(query.trim());\n      } else {\n        setResults([]);\n        setIsOpen(false);\n      }\n    }, 300);\n\n    return () => clearTimeout(delayedSearch);\n  }, [query, performSearch]);\n\n  const handleResultClick = useCallback((result: SearchResult) => {\n    if (result.type === 'project' && result.leadId) {\n      navigate(`/leads/${result.leadId}`);\n    } else if (result.leadId) {\n      navigate(`/leads/${result.leadId}`);\n    }\n    \n    // Clear search and announce navigation\n    setQuery(\"\");\n    setResults([]);\n    setIsOpen(false);\n    announce(`Navigating to ${result.leadName || result.projectName}`, 'polite');\n  }, [navigate, announce]);\n\n  const handleClearSearch = useCallback(() => {\n    setQuery(\"\");\n    setResults([]);\n    setIsOpen(false);\n    announce(\"Search cleared\", 'polite');\n    // Keep focus in the search bar\n    setTimeout(() => inputRef.current?.focus(), 0);\n  }, [announce]);\n\n  // Combined keyboard handler\n  const handleInputKeyDown = useCallback((e: React.KeyboardEvent) => {\n    if (e.key === 'Escape') {\n      setIsOpen(false);\n      announce(\"Search closed\", 'polite');\n      return;\n    }\n    \n    if (isOpen && results.length > 0) {\n      handleKeyDown(e);\n    }\n  }, [isOpen, results.length, handleKeyDown, announce]);\n\n  return (\n    <div className=\"relative w-full min-w-0\" ref={searchRef}>\n      <div className=\"relative\">\n        <Search \n          className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground z-10 pointer-events-none\" \n          aria-hidden=\"true\"\n        />\n        <Input\n          ref={inputRef}\n          placeholder=\"Search everything...\"\n          value={query}\n          onChange={(e) => setQuery(e.target.value)}\n          onKeyDown={handleInputKeyDown}\n          onFocus={() => {\n            if (results.length > 0) setIsOpen(true);\n          }}\n          className=\"pl-10 pr-10 w-full truncate\"\n          role=\"combobox\"\n          aria-expanded={isOpen}\n          aria-haspopup=\"listbox\"\n          aria-autocomplete=\"list\"\n          aria-describedby=\"search-instructions\"\n        />\n        \n        {/* Screen reader instructions */}\n        <div id=\"search-instructions\" className=\"sr-only\">\n          Type to search. Use arrow keys to navigate results, Enter to select, Escape to close.\n        </div>\n        \n        {query && (\n          <button\n            onClick={handleClearSearch}\n            className=\"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors\"\n            aria-label=\"Clear search\"\n            tabIndex={0}\n          >\n            <X className=\"h-4 w-4\" />\n          </button>\n        )}\n      </div>\n\n      {isOpen && (\n        <div\n          className=\"absolute top-full mt-2 left-0 right-0 bg-background border border-slate-200 dark:border-slate-700 rounded-lg shadow-xl backdrop-blur-sm z-[9999] max-h-96 overflow-y-auto\"\n          role=\"listbox\"\n          aria-label=\"Search results\"\n        >\n          {loading ? (\n            <SearchLoadingSkeleton rows={3} />\n          ) : results.length === 0 ? (\n            <div className=\"p-6 text-center text-muted-foreground\">\n              <Search className=\"h-10 w-10 mx-auto mb-3 opacity-50\" aria-hidden=\"true\" />\n              <p className=\"text-sm font-medium\" role=\"status\">No results found</p>\n              <p className=\"text-xs mt-2 opacity-75\">Try different keywords or check your spelling</p>\n            </div>\n          ) : (\n            <div className=\"py-3\">\n              {results.map((result, index) => (\n                <button\n                  key={`${result.type}-${result.id}`}\n                  id={`search-result-${index}`}\n                  data-index={index}\n                  onClick={() => handleResultClick(result)}\n                  className={`w-full text-left px-4 py-3 transition-colors group ${\n                    index === activeIndex ? 'bg-muted/50' : 'hover:bg-muted/30'\n                  }`}\n                  role=\"option\"\n                  aria-selected={index === activeIndex}\n                  aria-describedby={`result-description-${index}`}\n                >\n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"flex-shrink-0 mt-0.5 text-muted-foreground\" aria-hidden=\"true\">\n                      {result.icon}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"font-medium text-sm truncate\">\n                        {result.type === 'project' ? result.projectName : result.leadName}\n                      </p>\n                      {result.matchedContent && (\n                        <p \n                          id={`result-description-${index}`}\n                          className=\"text-xs text-muted-foreground truncate mt-1\"\n                        >\n                          {result.matchedContent}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                </button>\n              ))}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n});\n\nAccessibleGlobalSearch.displayName = 'AccessibleGlobalSearch';\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/components/optimized/MemoizedKanbanCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/components/optimized/OptimizedProjectsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/components/optimized/VirtualizedList.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":150,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":150,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef, useMemo, useCallback } from 'react';\nimport { performanceMonitor } from '@/utils/performance';\n\ninterface VirtualizedListProps<T> {\n  items: T[];\n  renderItem: (item: T, index: number) => React.ReactNode;\n  itemHeight: number;\n  containerHeight: number;\n  overscan?: number;\n  className?: string;\n  'aria-label'?: string;\n}\n\n/**\n * High-performance virtualized list component\n * Only renders items that are currently visible\n */\nexport function VirtualizedList<T>({\n  items,\n  renderItem,\n  itemHeight,\n  containerHeight,\n  overscan = 5,\n  className = '',\n  'aria-label': ariaLabel = 'Virtual list'\n}: VirtualizedListProps<T>) {\n  const [scrollTop, setScrollTop] = useState(0);\n  const scrollElementRef = useRef<HTMLDivElement>(null);\n\n  // Calculate visible range with memoization\n  const { startIndex, endIndex, visibleItems } = useMemo(() => {\n    performanceMonitor.startTiming('VirtualizedList.calculateRange');\n    \n    const start = Math.max(0, Math.floor(scrollTop / itemHeight) - overscan);\n    const end = Math.min(\n      items.length - 1,\n      Math.ceil((scrollTop + containerHeight) / itemHeight) + overscan\n    );\n    \n    const visible = items.slice(start, end + 1);\n    \n    performanceMonitor.endTiming('VirtualizedList.calculateRange');\n    \n    return {\n      startIndex: start,\n      endIndex: end,\n      visibleItems: visible\n    };\n  }, [scrollTop, itemHeight, containerHeight, overscan, items]);\n\n  // Optimized scroll handler with requestAnimationFrame\n  const handleScroll = useCallback((e: React.UIEvent<HTMLDivElement>) => {\n    const target = e.currentTarget;\n    requestAnimationFrame(() => {\n      setScrollTop(target.scrollTop);\n    });\n  }, []);\n\n  // Keyboard navigation support\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n    if (!scrollElementRef.current) return;\n\n    const container = scrollElementRef.current;\n    let newScrollTop = scrollTop;\n\n    switch (e.key) {\n      case 'ArrowDown':\n        e.preventDefault();\n        newScrollTop = Math.min(\n          (items.length - 1) * itemHeight,\n          scrollTop + itemHeight\n        );\n        break;\n      case 'ArrowUp':\n        e.preventDefault();\n        newScrollTop = Math.max(0, scrollTop - itemHeight);\n        break;\n      case 'PageDown':\n        e.preventDefault();\n        newScrollTop = Math.min(\n          (items.length - 1) * itemHeight,\n          scrollTop + containerHeight\n        );\n        break;\n      case 'PageUp':\n        e.preventDefault();\n        newScrollTop = Math.max(0, scrollTop - containerHeight);\n        break;\n      case 'Home':\n        if (e.ctrlKey) {\n          e.preventDefault();\n          newScrollTop = 0;\n        }\n        break;\n      case 'End':\n        if (e.ctrlKey) {\n          e.preventDefault();\n          newScrollTop = (items.length - 1) * itemHeight;\n        }\n        break;\n    }\n\n    if (newScrollTop !== scrollTop) {\n      container.scrollTop = newScrollTop;\n    }\n  }, [scrollTop, itemHeight, containerHeight, items.length]);\n\n  // Total height for scrollbar\n  const totalHeight = items.length * itemHeight;\n\n  return (\n    <div\n      ref={scrollElementRef}\n      className={`overflow-auto ${className}`}\n      style={{ height: containerHeight }}\n      onScroll={handleScroll}\n      onKeyDown={handleKeyDown}\n      tabIndex={0}\n      role=\"list\"\n      aria-label={ariaLabel}\n      aria-rowcount={items.length}\n    >\n      <div style={{ height: totalHeight, position: 'relative' }}>\n        <div\n          style={{\n            transform: `translateY(${startIndex * itemHeight}px)`,\n            position: 'absolute',\n            width: '100%'\n          }}\n        >\n          {visibleItems.map((item, index) => (\n            <div\n              key={startIndex + index}\n              style={{ height: itemHeight }}\n              role=\"listitem\"\n              aria-rowindex={startIndex + index + 1}\n            >\n              {renderItem(item, startIndex + index)}\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n/**\n * Hook for managing virtualized list state\n */\nexport function useVirtualizedList<T>(\n  items: T[],\n  itemHeight: number,\n  containerHeight: number\n) {\n  const [scrollTop, setScrollTop] = useState(0);\n\n  const scrollToIndex = useCallback((index: number) => {\n    const targetScrollTop = Math.max(0, Math.min(\n      index * itemHeight,\n      (items.length - 1) * itemHeight\n    ));\n    setScrollTop(targetScrollTop);\n  }, [itemHeight, items.length]);\n\n  const scrollToTop = useCallback(() => {\n    setScrollTop(0);\n  }, []);\n\n  const scrollToBottom = useCallback(() => {\n    setScrollTop((items.length - 1) * itemHeight);\n  }, [items.length, itemHeight]);\n\n  return {\n    scrollTop,\n    scrollToIndex,\n    scrollToTop,\n    scrollToBottom\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/components/template-builder/ImageManager.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadAssets'. Either include it or remove the dependency array.","line":76,"column":6,"nodeType":"ArrayExpression","endLine":76,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [activeOrganization.id, loadAssets]","fix":{"range":[2330,2354],"text":"[activeOrganization.id, loadAssets]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Image as ImageIcon, Trash2, Edit3, Copy } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { useToast } from '@/hooks/use-toast';\nimport { supabase } from '@/integrations/supabase/client';\nimport { useOrganization } from '@/contexts/OrganizationContext';\nimport { useMessagesTranslation } from '@/hooks/useTypedTranslation';\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from '@/components/ui/alert-dialog';\nimport { useTranslation } from 'react-i18next';\n\ninterface TemplateAsset {\n  id: string;\n  file_name: string;\n  file_path: string;\n  content_type: string;\n  file_size: number;\n  alt_text: string | null;\n  created_at: string;\n}\n\ninterface ImageManagerProps {\n  onImageSelect: (imageUrl: string, altText?: string) => void;\n  templateId?: string;\n  className?: string;\n}\n\nexport function ImageManager({ onImageSelect, templateId, className }: ImageManagerProps) {\n  const [assets, setAssets] = useState<TemplateAsset[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [editingAlt, setEditingAlt] = useState<string | null>(null);\n  const [altText, setAltText] = useState('');\n  const { toast } = useToast();\n  const { t: tMessages } = useMessagesTranslation();\n  const { activeOrganization } = useOrganization();\n  const { t } = useTranslation(\"pages\");\n  const { t: tCommon } = useTranslation(\"common\");\n\n  const loadAssets = async () => {\n    if (!activeOrganization?.id) return;\n\n    try {\n      setLoading(true);\n      const { data, error } = await supabase\n        .from('template_assets')\n        .select('*')\n        .eq('organization_id', activeOrganization.id)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setAssets(data || []);\n    } catch (error) {\n      console.error('Error loading assets:', error);\n      toast({\n        title: tCommon('toast.error'),\n        description: t('templateBuilder.imageManager.messages.loadError'),\n        variant: 'destructive',\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    loadAssets();\n  }, [activeOrganization?.id]);\n\n  const deleteAsset = async (asset: TemplateAsset) => {\n    try {\n      // Delete from storage\n      const { error: storageError } = await supabase.storage\n        .from('template-images')\n        .remove([asset.file_path]);\n\n      if (storageError) throw storageError;\n\n      // Delete from database\n      const { error: dbError } = await supabase\n        .from('template_assets')\n        .delete()\n        .eq('id', asset.id);\n\n      if (dbError) throw dbError;\n\n      setAssets(prev => prev.filter(a => a.id !== asset.id));\n      \n      toast({\n        title: tCommon('toast.success'),\n        description: t('templateBuilder.imageManager.messages.deleteSuccess'),\n      });\n    } catch (error) {\n      console.error('Error deleting asset:', error);\n      toast({\n        title: tCommon('toast.error'),\n        description: t('templateBuilder.imageManager.messages.deleteError'),\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const updateAltText = async (assetId: string, newAltText: string) => {\n    try {\n      const { error } = await supabase\n        .from('template_assets')\n        .update({ alt_text: newAltText })\n        .eq('id', assetId);\n\n      if (error) throw error;\n\n      setAssets(prev => prev.map(asset => \n        asset.id === assetId ? { ...asset, alt_text: newAltText } : asset\n      ));\n\n      toast({\n        title: tCommon('toast.success'),\n        description: t('templateBuilder.imageManager.messages.altSuccess'),\n      });\n    } catch (error) {\n      console.error('Error updating alt text:', error);\n      toast({\n        title: tCommon('toast.error'),\n        description: t('templateBuilder.imageManager.messages.altError'),\n        variant: 'destructive',\n      });\n    }\n  };\n\n  const getImageUrl = (filePath: string) => {\n    const { data: { publicUrl } } = supabase.storage\n      .from('template-images')\n      .getPublicUrl(filePath);\n    return publicUrl;\n  };\n\n  const copyImageUrl = (filePath: string) => {\n    const url = getImageUrl(filePath);\n    navigator.clipboard.writeText(url);\n    toast({\n      title: tCommon('toast.success'),\n      description: t('templateBuilder.imageManager.messages.copySuccess'),\n    });\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  if (loading) {\n    return (\n      <div className={`space-y-4 ${className}`}>\n        <div className=\"flex items-center gap-2\">\n          <ImageIcon className=\"w-5 h-5\" />\n          <h3 className=\"font-medium\">{t('templateBuilder.imageManager.loading')}</h3>\n        </div>\n        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\n          {[...Array(6)].map((_, i) => (\n            <div key={i} className=\"aspect-square bg-muted animate-pulse rounded-lg\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`space-y-4 ${className}`}>\n      <div className=\"flex items-center gap-2\">\n        <ImageIcon className=\"w-5 h-5\" />\n        <h3 className=\"font-medium\">{t('templateBuilder.imageManager.titleWithCount', { count: assets.length })}</h3>\n      </div>\n\n      {assets.length === 0 ? (\n        <div className=\"text-center py-8 text-muted-foreground\">\n          <ImageIcon className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n          <p>{t('templateBuilder.imageManager.empty.title')}</p>\n          <p className=\"text-sm\">{t('templateBuilder.imageManager.empty.description')}</p>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\n          {assets.map((asset) => (\n            <div key={asset.id} className=\"group relative bg-card border rounded-lg overflow-hidden\">\n              <div className=\"aspect-square relative\">\n                <img\n                  src={getImageUrl(asset.file_path)}\n                  alt={asset.alt_text || asset.file_name}\n                  className=\"w-full h-full object-cover cursor-pointer hover:scale-105 transition-transform\"\n                  onClick={() => onImageSelect(getImageUrl(asset.file_path), asset.alt_text || undefined)}\n                />\n                \n                {/* Overlay with actions */}\n                <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2\">\n                  <Button\n                    size=\"sm\"\n                    variant=\"secondary\"\n                    onClick={() => onImageSelect(getImageUrl(asset.file_path), asset.alt_text || undefined)}\n                  >\n                    {t('templateBuilder.imageManager.actions.insert')}\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => copyImageUrl(asset.file_path)}\n                  >\n                    <Copy className=\"w-4 h-4\" />\n                  </Button>\n                  <AlertDialog>\n                    <AlertDialogTrigger asChild>\n                      <Button size=\"sm\" variant=\"destructive\">\n                        <Trash2 className=\"w-4 h-4\" />\n                      </Button>\n                    </AlertDialogTrigger>\n                    <AlertDialogContent>\n                      <AlertDialogHeader>\n                        <AlertDialogTitle>{t('templateBuilder.imageManager.actions.deleteTitle')}</AlertDialogTitle>\n                        <AlertDialogDescription>\n                          {tMessages('confirm.deleteImage')} {tMessages('confirm.cannotUndo')}\n                        </AlertDialogDescription>\n                      </AlertDialogHeader>\n                      <AlertDialogFooter>\n                        <AlertDialogCancel>{tCommon('buttons.cancel')}</AlertDialogCancel>\n                        <AlertDialogAction onClick={() => deleteAsset(asset)}>\n                          {tCommon('buttons.delete')}\n                        </AlertDialogAction>\n                      </AlertDialogFooter>\n                    </AlertDialogContent>\n                  </AlertDialog>\n                </div>\n              </div>\n\n              {/* Image info */}\n              <div className=\"p-3 space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <p className=\"text-sm font-medium truncate\">{asset.file_name}</p>\n                  <Button\n                    size=\"sm\"\n                    variant=\"ghost\"\n                    onClick={() => {\n                      setEditingAlt(asset.id);\n                      setAltText(asset.alt_text || '');\n                    }}\n                  >\n                    <Edit3 className=\"w-3 h-3\" />\n                  </Button>\n                </div>\n                \n                {editingAlt === asset.id ? (\n                  <div className=\"flex gap-1\">\n                    <Input\n                      value={altText}\n                      onChange={(e) => setAltText(e.target.value)}\n                      placeholder={t('templateBuilder.imageManager.actions.altPlaceholder')}\n                      className=\"text-xs h-7\"\n                      onKeyDown={(e) => {\n                        if (e.key === 'Enter') {\n                          updateAltText(asset.id, altText);\n                          setEditingAlt(null);\n                        }\n                        if (e.key === 'Escape') {\n                          setEditingAlt(null);\n                        }\n                      }}\n                      autoFocus\n                    />\n                    <Button\n                      size=\"sm\"\n                      onClick={() => {\n                        updateAltText(asset.id, altText);\n                        setEditingAlt(null);\n                      }}\n                      className=\"h-7 px-2\"\n                    >\n                      {tCommon('buttons.save')}\n                    </Button>\n                  </div>\n                ) : (\n                  <p className=\"text-xs text-muted-foreground truncate\">\n                    {asset.alt_text || t('templateBuilder.imageManager.messages.noAltText')}\n                  </p>\n                )}\n                \n                <p className=\"text-xs text-muted-foreground\">\n                  {formatFileSize(asset.file_size)}\n                </p>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/components/template-builder/TemplateEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2285,2288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2285,2288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":285,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":285,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10308,10311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10308,10311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Plus, GripVertical, Eye, EyeOff, Trash2 } from \"lucide-react\";\nimport { TemplateBlock, BlockData, TextBlockData, SessionDetailsBlockData, CTABlockData, ImageBlockData, FooterBlockData } from \"@/types/templateBuilder\";\nimport { BlockEditor } from \"./BlockEditor\";\nimport { AddBlockSheet } from \"./AddBlockSheet\";\nimport { cn } from \"@/lib/utils\";\nimport { DragDropContext, Droppable, Draggable, DropResult } from \"@hello-pangea/dnd\";\nimport { useTranslation } from 'react-i18next';\n\ninterface TemplateEditorProps {\n  blocks: TemplateBlock[];\n  onBlocksChange: (blocks: TemplateBlock[]) => void;\n}\n\nexport function TemplateEditor({ blocks, onBlocksChange }: TemplateEditorProps) {\n  const { t } = useTranslation('pages');\n  const [activeBlock, setActiveBlock] = useState<string | null>(null);\n  const [showAddBlock, setShowAddBlock] = useState(false);\n\n  const getBlockTitle = (type: TemplateBlock[\"type\"]) => {\n    switch (type) {\n      case \"text\": return t('templateBuilder.blockTitles.text');\n      case \"session-details\": return t('templateBuilder.blockTitles.sessionDetails');\n      case \"cta\": return t('templateBuilder.blockTitles.cta');\n      case \"image\": return t('templateBuilder.blockTitles.image');\n      case \"footer\": return t('templateBuilder.blockTitles.footer');\n      case \"divider\": return t('templateBuilder.blockTitles.divider');\n      case \"columns\": return t('templateBuilder.blockTitles.columns');\n      case \"social-links\": return t('templateBuilder.blockTitles.socialLinks');\n      case \"header\": return t('templateBuilder.blockTitles.header');\n      case \"raw-html\": return t('templateBuilder.blockTitles.rawHtml');\n      default: return t('templateBuilder.blockTitles.unknown');\n    }\n  };\n\n  const addBlock = (type: TemplateBlock[\"type\"]) => {\n    const newBlock: TemplateBlock = {\n      id: `block-${Date.now()}`,\n      type,\n      data: getDefaultBlockData(type),\n      visible: true,\n      order: blocks.length,\n    };\n    \n    onBlocksChange([...blocks, newBlock]);\n    setActiveBlock(newBlock.id);\n    setShowAddBlock(false);\n  };\n\n  const updateBlock = (blockId: string, data: any) => {\n    onBlocksChange(\n      blocks.map(block => \n        block.id === blockId ? { ...block, data } : block\n      )\n    );\n  };\n\n  const toggleBlockVisibility = (blockId: string) => {\n    onBlocksChange(\n      blocks.map(block => \n        block.id === blockId ? { ...block, visible: !block.visible } : block\n      )\n    );\n  };\n\n  const removeBlock = (blockId: string) => {\n    onBlocksChange(blocks.filter(block => block.id !== blockId));\n    if (activeBlock === blockId) {\n      setActiveBlock(null);\n    }\n  };\n\n  const moveBlock = (blockId: string, direction: \"up\" | \"down\") => {\n    const blockIndex = blocks.findIndex(b => b.id === blockId);\n    if (blockIndex === -1) return;\n    \n    const newIndex = direction === \"up\" ? blockIndex - 1 : blockIndex + 1;\n    if (newIndex < 0 || newIndex >= blocks.length) return;\n    \n    const newBlocks = [...blocks];\n    [newBlocks[blockIndex], newBlocks[newIndex]] = [newBlocks[newIndex], newBlocks[blockIndex]];\n    \n    // Update order values\n    newBlocks.forEach((block, index) => {\n      block.order = index;\n    });\n    \n    onBlocksChange(newBlocks);\n  };\n\n  const onDragEnd = (result: DropResult) => {\n    if (!result.destination) return;\n\n    const items = Array.from(blocks);\n    const [reorderedItem] = items.splice(result.source.index, 1);\n    items.splice(result.destination.index, 0, reorderedItem);\n\n    // Update order values\n    const updatedItems = items.map((item, index) => ({\n      ...item,\n      order: index\n    }));\n\n    onBlocksChange(updatedItems);\n  };\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* Header */}\n      <div className=\"border-b px-6 py-4\">\n        <h2 className=\"font-semibold\">{t('templateBuilder.editor.title')}</h2>\n        <p className=\"text-sm text-muted-foreground\">{t('templateBuilder.editor.description')}</p>\n      </div>\n\n      {/* Blocks List */}\n      <div className=\"flex-1 overflow-y-auto p-6 space-y-4\">\n        <DragDropContext onDragEnd={onDragEnd}>\n          <Droppable droppableId=\"template-blocks\">\n            {(provided) => (\n              <div\n                {...provided.droppableProps}\n                ref={provided.innerRef}\n                className=\"space-y-4\"\n              >\n                {blocks.map((block, index) => (\n                  <Draggable key={block.id} draggableId={block.id} index={index}>\n                    {(provided, snapshot) => (\n                      <Card\n                        ref={provided.innerRef}\n                        {...provided.draggableProps}\n                        className={cn(\n                          \"cursor-pointer transition-all duration-200\",\n                          activeBlock === block.id && \"ring-2 ring-primary\",\n                          !block.visible && \"opacity-50\",\n                          snapshot.isDragging && \"shadow-lg\"\n                        )}\n                        onClick={() => setActiveBlock(activeBlock === block.id ? null : block.id)}\n                      >\n                        <CardHeader className=\"pb-2\">\n                          <div className=\"flex items-center justify-between\">\n                            <CardTitle className=\"text-sm flex items-center gap-2\">\n                              <div \n                                {...provided.dragHandleProps}\n                                className=\"cursor-grab active:cursor-grabbing\"\n                              >\n                                <GripVertical className=\"h-4 w-4 text-muted-foreground\" />\n                              </div>\n                              {getBlockTitle(block.type)}\n                            </CardTitle>\n                            <div className=\"flex items-center gap-1\">\n                              <Button\n                                size=\"sm\"\n                                variant=\"ghost\"\n                                onClick={(e) => {\n                                  e.stopPropagation();\n                                  toggleBlockVisibility(block.id);\n                                }}\n                              >\n                                {block.visible ? (\n                                  <Eye className=\"h-3 w-3\" />\n                                ) : (\n                                  <EyeOff className=\"h-3 w-3\" />\n                                )}\n                              </Button>\n                              <Button\n                                size=\"sm\"\n                                variant=\"ghost\"\n                                className=\"text-destructive hover:text-destructive hover:bg-destructive/10\"\n                                onClick={(e) => {\n                                  e.stopPropagation();\n                                  removeBlock(block.id);\n                                }}\n                              >\n                                <Trash2 className=\"h-3 w-3\" />\n                              </Button>\n                            </div>\n                          </div>\n                        </CardHeader>\n                        {activeBlock === block.id && (\n                          <CardContent className=\"pt-0 overflow-hidden animate-in slide-in-from-top-2 duration-200\">\n                            <BlockEditor\n                              block={block}\n                              onUpdate={(data) => updateBlock(block.id, data)}\n                              onRemove={() => removeBlock(block.id)}\n                              onMoveUp={() => moveBlock(block.id, \"up\")}\n                              onMoveDown={() => moveBlock(block.id, \"down\")}\n                              canMoveUp={index > 0}\n                              canMoveDown={index < blocks.length - 1}\n                            />\n                          </CardContent>\n                        )}\n                      </Card>\n                    )}\n                  </Draggable>\n                ))}\n                {provided.placeholder}\n              </div>\n            )}\n          </Droppable>\n        </DragDropContext>\n\n        {/* Add Block Button */}\n        <Button\n          variant=\"outline\"\n          className=\"w-full h-12 border-dashed\"\n          onClick={() => setShowAddBlock(true)}\n        >\n          <Plus className=\"h-4 w-4 mr-2\" />\n          {t('templateBuilder.editor.addBlock')}\n        </Button>\n      </div>\n\n      {/* Add Block Sheet */}\n      <AddBlockSheet\n        open={showAddBlock}\n        onOpenChange={setShowAddBlock}\n        onAddBlock={addBlock}\n      />\n    </div>\n  );\n}\n\nfunction getDefaultBlockData(type: TemplateBlock[\"type\"]): BlockData {\n  switch (type) {\n    case \"text\":\n      return {\n        content: \"Enter your text here...\",\n        formatting: {\n          fontSize: \"p\" as const,\n          fontFamily: \"Arial\",\n          alignment: \"left\" as const,\n        },\n      } as TextBlockData;\n    case \"session-details\":\n      return {\n        showDate: true,\n        showTime: true,\n        showLocation: true,\n        showNotes: false,\n      } as SessionDetailsBlockData;\n    case \"cta\":\n      return {\n        text: \"Book Now\",\n        variant: \"primary\" as const,\n      } as CTABlockData;\n    case \"image\":\n      return {\n        placeholder: true,\n        alt: \"Image\",\n      } as ImageBlockData;\n    case \"footer\":\n      return {\n        showLogo: true,\n        showStudioName: true,\n        showContactInfo: true,\n      } as FooterBlockData;\n    case \"divider\":\n      return {\n        style: \"line\" as const,\n        color: \"#e5e5e5\",\n      };\n    case \"columns\":\n      return {\n        columns: 2,\n        content: [\"Column 1 content...\", \"Column 2 content...\"],\n      };\n    case \"social-links\":\n      return {\n        channelVisibility: {},\n      };\n    case \"header\":\n      return {\n        showLogo: true,\n        tagline: \"Professional Photography\",\n        backgroundColor: \"#ffffff\",\n      };\n    case \"raw-html\":\n      return {\n        html: \"<div>Your custom HTML here...</div>\",\n        sanitized: false,\n      };\n    default:\n      return {} as any;\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/components/template-builder/TemplateEditorWithTest.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2307,2310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2307,2310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":279,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9686,9689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9686,9689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Plus, GripVertical, Eye, EyeOff } from \"lucide-react\";\nimport { TemplateBlock, BlockData, TextBlockData, SessionDetailsBlockData, CTABlockData, ImageBlockData, FooterBlockData } from \"@/types/templateBuilder\";\nimport { BlockEditor } from \"./BlockEditor\";\nimport { AddBlockSheet } from \"./AddBlockSheet\";\nimport { cn } from \"@/lib/utils\";\nimport { DragDropContext, Droppable, Draggable, DropResult } from \"@hello-pangea/dnd\";\nimport { useTranslation } from 'react-i18next';\n\ninterface TemplateEditorWithTestProps {\n  blocks: TemplateBlock[];\n  onBlocksChange: (blocks: TemplateBlock[]) => void;\n}\n\nexport function TemplateEditorWithTest({ \n  blocks, \n  onBlocksChange\n}: TemplateEditorWithTestProps) {\n  const { t } = useTranslation('pages');\n  const [activeBlock, setActiveBlock] = useState<string | null>(null);\n  const [showAddBlock, setShowAddBlock] = useState(false);\n\n  const getBlockTitle = (type: TemplateBlock[\"type\"]) => {\n    switch (type) {\n      case \"text\": return t('templateBuilder.blockTitles.text');\n      case \"session-details\": return t('templateBuilder.blockTitles.sessionDetails');\n      case \"cta\": return t('templateBuilder.blockTitles.cta');\n      case \"image\": return t('templateBuilder.blockTitles.image');\n      case \"footer\": return t('templateBuilder.blockTitles.footer');\n      case \"divider\": return t('templateBuilder.blockTitles.divider');\n      case \"columns\": return t('templateBuilder.blockTitles.columns');\n      case \"social-links\": return t('templateBuilder.blockTitles.socialLinks');\n      case \"header\": return t('templateBuilder.blockTitles.header');\n      case \"raw-html\": return t('templateBuilder.blockTitles.rawHtml');\n      default: return t('templateBuilder.blockTitles.unknown');\n    }\n  };\n\n  const addBlock = (type: TemplateBlock[\"type\"]) => {\n    const newBlock: TemplateBlock = {\n      id: `block-${Date.now()}`,\n      type,\n      data: getDefaultBlockData(type),\n      visible: true,\n      order: blocks.length,\n    };\n    \n    onBlocksChange([...blocks, newBlock]);\n    setActiveBlock(newBlock.id);\n    setShowAddBlock(false);\n  };\n\n  const updateBlock = (blockId: string, data: any) => {\n    onBlocksChange(\n      blocks.map(block => \n        block.id === blockId ? { ...block, data } : block\n      )\n    );\n  };\n\n  const toggleBlockVisibility = (blockId: string) => {\n    onBlocksChange(\n      blocks.map(block => \n        block.id === blockId ? { ...block, visible: !block.visible } : block\n      )\n    );\n  };\n\n  const removeBlock = (blockId: string) => {\n    onBlocksChange(blocks.filter(block => block.id !== blockId));\n    if (activeBlock === blockId) {\n      setActiveBlock(null);\n    }\n  };\n\n  const moveBlock = (blockId: string, direction: \"up\" | \"down\") => {\n    const blockIndex = blocks.findIndex(b => b.id === blockId);\n    if (blockIndex === -1) return;\n    \n    const newIndex = direction === \"up\" ? blockIndex - 1 : blockIndex + 1;\n    if (newIndex < 0 || newIndex >= blocks.length) return;\n    \n    const newBlocks = [...blocks];\n    [newBlocks[blockIndex], newBlocks[newIndex]] = [newBlocks[newIndex], newBlocks[blockIndex]];\n    \n    // Update order values\n    newBlocks.forEach((block, index) => {\n      block.order = index;\n    });\n    \n    onBlocksChange(newBlocks);\n  };\n\n  const onDragEnd = (result: DropResult) => {\n    if (!result.destination) return;\n\n    const items = Array.from(blocks);\n    const [reorderedItem] = items.splice(result.source.index, 1);\n    items.splice(result.destination.index, 0, reorderedItem);\n\n    // Update order values\n    const updatedItems = items.map((item, index) => ({\n      ...item,\n      order: index\n    }));\n\n    onBlocksChange(updatedItems);\n  };\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* Header */}\n      <div className=\"border-b px-6 py-4\">\n        <div>\n          <h2 className=\"font-semibold\">{t('templateBuilder.editor.title')}</h2>\n          <p className=\"text-sm text-muted-foreground\">{t('templateBuilder.editor.description')}</p>\n        </div>\n      </div>\n\n      {/* Blocks List */}\n      <div className=\"flex-1 overflow-y-auto p-6 space-y-4\">\n        <DragDropContext onDragEnd={onDragEnd}>\n          <Droppable droppableId=\"template-blocks\">\n            {(provided) => (\n              <div\n                {...provided.droppableProps}\n                ref={provided.innerRef}\n                className=\"space-y-4\"\n              >\n                {blocks.map((block, index) => (\n                  <Draggable key={block.id} draggableId={block.id} index={index}>\n                    {(provided, snapshot) => (\n                      <Card\n                        ref={provided.innerRef}\n                        {...provided.draggableProps}\n                        className={cn(\n                          \"cursor-pointer transition-colors\",\n                          activeBlock === block.id && \"ring-2 ring-primary\",\n                          !block.visible && \"opacity-50\",\n                          snapshot.isDragging && \"shadow-lg\"\n                        )}\n                        onClick={() => setActiveBlock(block.id)}\n                      >\n                        <CardHeader className=\"pb-2\">\n                          <div className=\"flex items-center justify-between\">\n                            <CardTitle className=\"text-sm flex items-center gap-2\">\n                              <div \n                                {...provided.dragHandleProps}\n                                className=\"cursor-grab active:cursor-grabbing\"\n                              >\n                                <GripVertical className=\"h-4 w-4 text-muted-foreground\" />\n                              </div>\n                              {getBlockTitle(block.type)}\n                            </CardTitle>\n                            <div className=\"flex items-center gap-1\">\n                              <Button\n                                size=\"sm\"\n                                variant=\"ghost\"\n                                onClick={(e) => {\n                                  e.stopPropagation();\n                                  toggleBlockVisibility(block.id);\n                                }}\n                              >\n                                {block.visible ? (\n                                  <Eye className=\"h-3 w-3\" />\n                                ) : (\n                                  <EyeOff className=\"h-3 w-3\" />\n                                )}\n                              </Button>\n                            </div>\n                          </div>\n                        </CardHeader>\n                        {activeBlock === block.id && (\n                          <CardContent className=\"pt-0\">\n                            <BlockEditor\n                              block={block}\n                              onUpdate={(data) => updateBlock(block.id, data)}\n                              onRemove={() => removeBlock(block.id)}\n                              onMoveUp={() => moveBlock(block.id, \"up\")}\n                              onMoveDown={() => moveBlock(block.id, \"down\")}\n                              canMoveUp={index > 0}\n                              canMoveDown={index < blocks.length - 1}\n                            />\n                          </CardContent>\n                        )}\n                      </Card>\n                    )}\n                  </Draggable>\n                ))}\n                {provided.placeholder}\n              </div>\n            )}\n          </Droppable>\n        </DragDropContext>\n\n        {/* Add Block Button */}\n        <Button\n          variant=\"outline\"\n          className=\"w-full h-12 border-dashed\"\n          onClick={() => setShowAddBlock(true)}\n        >\n          <Plus className=\"h-4 w-4\" />\n          {t('templateBuilder.editor.addBlock')}\n        </Button>\n      </div>\n\n      {/* Add Block Sheet */}\n      <AddBlockSheet\n        open={showAddBlock}\n        onOpenChange={setShowAddBlock}\n        onAddBlock={addBlock}\n      />\n    </div>\n  );\n}\n\nfunction getDefaultBlockData(type: TemplateBlock[\"type\"]): BlockData {\n  switch (type) {\n    case \"text\":\n      return {\n        content: \"Enter your text here...\",\n        formatting: {\n          fontSize: \"p\" as const,\n          fontFamily: \"Arial\",\n          alignment: \"left\" as const,\n        },\n      } as TextBlockData;\n    case \"session-details\":\n      return {\n        showDate: true,\n        showTime: true,\n        showLocation: true,\n        showNotes: false,\n      } as SessionDetailsBlockData;\n    case \"cta\":\n      return {\n        text: \"Book Now\",\n        variant: \"primary\" as const,\n      } as CTABlockData;\n    case \"image\":\n      return {\n        placeholder: true,\n        alt: \"Image\",\n      } as ImageBlockData;\n    case \"footer\":\n      return {\n        showLogo: true,\n        showStudioName: true,\n        showContactInfo: true,\n      } as FooterBlockData;\n    case \"divider\":\n      return {\n        style: \"line\" as const,\n        color: \"#e5e5e5\",\n      };\n    case \"columns\":\n      return {\n        columns: 2,\n        content: [\"Column 1 content...\", \"Column 2 content...\"],\n      };\n    case \"social-links\":\n      return {\n        channelVisibility: {},\n      };\n    case \"header\":\n      return {\n        showLogo: true,\n        tagline: \"Professional Photography\",\n        backgroundColor: \"#ffffff\",\n      };\n    case \"raw-html\":\n      return {\n        html: \"<div>Your custom HTML here...</div>\",\n        sanitized: false,\n      };\n    default:\n      return {} as any;\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/pages/AllLeadsRefactored.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1190,1193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1190,1193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":228,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8041,8044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8041,8044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":256,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":256,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8821,8824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8821,8824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { EntityListView } from \"@/legacy/components/common/EntityListView\";\nimport { EntityFilters } from \"@/legacy/components/common/EntityFilters\";\nimport { ErrorBoundary } from \"@/components/common/ErrorBoundary\";\nimport { EnhancedAddLeadDialog } from \"@/components/EnhancedAddLeadDialog\";\nimport { OnboardingTutorial, TutorialStep } from \"@/components/shared/OnboardingTutorial\";\nimport { useOnboarding } from \"@/contexts/OnboardingContext\";\nimport { LeadService, LeadWithCustomFields } from \"@/services/LeadService\";\nimport { useEntityData } from \"@/hooks/useEntityData\";\nimport { useLeadTableColumns } from \"@/hooks/useLeadTableColumns\";\nimport { Calendar, MessageSquare, Users, FileText, Filter } from \"lucide-react\";\nimport { LEAD_STATUS } from \"@/constants/entityConstants\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\n\nconst AllLeadsRefactored = () => {\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [leadStatuses, setLeadStatuses] = useState<any[]>([]);\n  const [leadStatusesLoading, setLeadStatusesLoading] = useState(true);\n  const [addLeadDialogOpen, setAddLeadDialogOpen] = useState(false);\n  const [showTutorial, setShowTutorial] = useState(false);\n  const [currentTutorialStep, setCurrentTutorialStep] = useState(0);\n  const [isSchedulingTutorial, setIsSchedulingTutorial] = useState(false);\n  const navigate = useNavigate();\n  const { currentStep, completeCurrentStep } = useOnboarding();\n  const { t } = useTranslation(\"pages\");\n\n  // Services\n  const leadService = new LeadService();\n\n  // Data hooks\n  const { \n    data: leads, \n    loading: leadsLoading, \n    refetch: refetchLeads \n  } = useEntityData<LeadWithCustomFields>({\n    fetchFn: () => leadService.fetchLeadsWithCustomFields()\n  });\n\n  // Refetch data when page becomes visible (e.g., when navigating back from lead detail)\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      if (document.visibilityState === 'visible') {\n        refetchLeads();\n      }\n    };\n\n    const handleFocus = () => {\n      refetchLeads();\n    };\n\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    window.addEventListener('focus', handleFocus);\n\n    return () => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n      window.removeEventListener('focus', handleFocus);\n    };\n  }, [refetchLeads]);\n\n  const {\n    columns,\n    loading: columnsLoading,\n  } = useLeadTableColumns({\n    leadStatuses,\n    leadStatusesLoading,\n  });\n\n  const loading = leadsLoading || columnsLoading;\n\n  // Tutorial steps\n  const leadsTutorialSteps: TutorialStep[] = [\n    {\n      id: 1,\n      title: t(\"leads.tutorial.welcome.title\"),\n      description: t(\"leads.tutorial.welcome.description\"),\n      content: (\n        <div className=\"space-y-4\">\n          <div className=\"flex items-start gap-3\">\n            <Users className=\"w-5 h-5 text-primary mt-0.5\" />\n            <div>\n              <h4 className=\"font-medium\">{t(\"leads.tutorial.welcome.trackLeads.title\")}</h4>\n              <p className=\"text-sm text-muted-foreground\">\n                {t(\"leads.tutorial.welcome.trackLeads.description\")}\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-start gap-3\">\n            <Filter className=\"w-5 h-5 text-primary mt-0.5\" />\n            <div>\n              <h4 className=\"font-medium\">{t(\"leads.tutorial.welcome.filterSort.title\")}</h4>\n              <p className=\"text-sm text-muted-foreground\">\n                {t(\"leads.tutorial.welcome.filterSort.description\")}\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-start gap-3\">\n            <FileText className=\"w-5 h-5 text-primary mt-0.5\" />\n            <div>\n              <h4 className=\"font-medium\">{t(\"leads.tutorial.welcome.customizeColumns.title\")}</h4>\n              <p className=\"text-sm text-muted-foreground\">\n                {t(\"leads.tutorial.welcome.customizeColumns.description\")}\n              </p>\n            </div>\n          </div>\n        </div>\n      ),\n      mode: \"modal\",\n      canProceed: true\n    },\n    {\n      id: 2,\n      title: t(\"leads.tutorial.addFirstLead.title\"),\n      description: t(\"leads.tutorial.addFirstLead.description\"),\n      content: null,\n      mode: \"floating\",\n      canProceed: leads.length > 0,\n      requiresAction: leads.length === 0,\n      disabledTooltip: t(\"leads.tutorial.addFirstLead.disabledTooltip\")\n    },\n    {\n      id: 3,\n      title: t(\"leads.tutorial.exploreDetails.title\"),\n      description: t(\"leads.tutorial.exploreDetails.description\"),\n      content: null,\n      mode: \"floating\",\n      canProceed: false,\n      requiresAction: true,\n      disabledTooltip: t(\"leads.tutorial.exploreDetails.disabledTooltip\")\n    }\n  ];\n\n  const schedulingTutorialSteps: TutorialStep[] = [\n    {\n      id: 1,\n      title: t(\"leads.tutorial.scheduling.title\"),\n      description: t(\"leads.tutorial.scheduling.description\"),\n      content: (\n        <div className=\"space-y-4\">\n          <div className=\"flex items-start gap-3\">\n            <Calendar className=\"w-5 h-5 text-primary mt-0.5\" />\n            <div>\n              <h4 className=\"font-medium\">\n                {t(\"leads.tutorial.scheduling.chooseDateTime.title\")}\n              </h4>\n              <p className=\"text-sm text-muted-foreground\">\n                {t(\"leads.tutorial.scheduling.chooseDateTime.description\")}\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-start gap-3\">\n            <Users className=\"w-5 h-5 text-primary mt-0.5\" />\n            <div>\n              <h4 className=\"font-medium\">\n                {t(\"leads.tutorial.scheduling.selectClient.title\")}\n              </h4>\n              <p className=\"text-sm text-muted-foreground\">\n                {t(\"leads.tutorial.scheduling.selectClient.description\")}\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-start gap-3\">\n            <MessageSquare className=\"w-5 h-5 text-primary mt-0.5\" />\n            <div>\n              <h4 className=\"font-medium\">\n                {t(\"leads.tutorial.scheduling.addDetails.title\")}\n              </h4>\n              <p className=\"text-sm text-muted-foreground\">\n                {t(\"leads.tutorial.scheduling.addDetails.description\")}\n              </p>\n            </div>\n          </div>\n        </div>\n      ),\n      mode: \"modal\",\n      canProceed: true\n    },\n    {\n      id: 2,\n      title: t(\"leads.tutorial.selectLeadForSession.title\"),\n      description: t(\"leads.tutorial.selectLeadForSession.description\"),\n      content: null,\n      mode: \"floating\",\n      canProceed: false,\n      requiresAction: true,\n      disabledTooltip: t(\"leads.tutorial.selectLeadForSession.disabledTooltip\")\n    }\n  ];\n\n  // Effects\n  useEffect(() => {\n    fetchLeadStatuses();\n  }, []);\n\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const isSchedulingTutorialParam = urlParams.get('tutorial') === 'scheduling';\n    \n    if (isSchedulingTutorialParam) {\n      setIsSchedulingTutorial(true);\n      setShowTutorial(true);\n      setCurrentTutorialStep(0);\n    } else if (currentStep === 2) {\n      setShowTutorial(true);\n      setCurrentTutorialStep(0);\n    }\n  }, [currentStep]);\n\n  useEffect(() => {\n    if (showTutorial && !addLeadDialogOpen && currentTutorialStep === 1) {\n      setCurrentTutorialStep(2);\n    }\n  }, [addLeadDialogOpen, showTutorial, currentTutorialStep]);\n\n  // Functions\n  const fetchLeadStatuses = async () => {\n    try {\n      setLeadStatusesLoading(true);\n      const { data, error } = await supabase\n        .from('lead_statuses')\n        .select('*')\n        .order('sort_order', { ascending: true });\n\n      if (error) throw error;\n      setLeadStatuses(data || []);\n    } catch (error: any) {\n      console.error('Error fetching lead statuses:', error);\n    } finally {\n      setLeadStatusesLoading(false);\n    }\n  };\n\n  const handleTutorialComplete = async () => {\n    try {\n      await completeCurrentStep();\n      setShowTutorial(false);\n      console.log('ðŸŽ‰ Lead tutorial completed! Step 2 completed, navigating back to getting-started');\n      navigate('/getting-started');\n    } catch (error) {\n      console.error('Error completing tutorial:', error);\n      toast({\n        title: \"Error\", \n        description: \"Failed to save progress. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const handleTutorialExit = () => {\n    setShowTutorial(false);\n  };\n\n  const handleRowClick = (lead: LeadWithCustomFields) => {\n    const state: any = { from: 'all-leads' };\n    \n    if (showTutorial) {\n      if (isSchedulingTutorial && currentTutorialStep === 1) {\n        state.continueTutorial = true;\n        state.tutorialType = 'scheduling';\n        state.tutorialStep = 3;\n      } else if (currentTutorialStep === 2) {\n        state.continueTutorial = true;\n        state.tutorialStep = 4;\n      }\n    }\n    \n    navigate(`/leads/${lead.id}`, { state });\n  };\n\n  // Filter and prepare data\n  const filteredLeads = useMemo(() => {\n    if (statusFilter === \"all\") return leads;\n    return leads.filter(lead => lead.lead_statuses?.name === statusFilter);\n  }, [leads, statusFilter]);\n\n  const statusOptions = [\n    { value: \"all\", label: \"All Statuses\" },\n    ...leadStatuses.map(status => ({\n      value: status.name,\n      label: status.name\n    }))\n  ];\n\n  const clearFilters = () => {\n    setStatusFilter(\"all\");\n  };\n\n  const emptyState = (\n    <div className=\"text-center py-8 text-muted-foreground\">\n      {statusFilter === \"all\" \n        ? \"No leads found. Add your first lead to get started!\"\n        : `No leads found with status \"${statusFilter}\".`\n      }\n    </div>\n  );\n\n  const filters = (\n    <EntityFilters\n      filters={[\n        {\n          label: \"Filter by status\",\n          value: statusFilter,\n          options: statusOptions,\n          onValueChange: setStatusFilter,\n          placeholder: \"Select status\"\n        }\n      ]}\n      onClearFilters={statusFilter !== \"all\" ? clearFilters : undefined}\n    />\n  );\n\n  return (\n    <ErrorBoundary>\n      <EntityListView\n        title=\"Leads\"\n        subtitle=\"Track and manage your potential clients\"\n        data={filteredLeads}\n        columns={columns}\n        loading={loading}\n        onRowClick={handleRowClick}\n        onAddClick={() => setAddLeadDialogOpen(true)}\n        addButtonText=\"Add Lead\"\n        emptyState={emptyState}\n        filters={filters}\n        itemsPerPage={20}\n      />\n      \n      <EnhancedAddLeadDialog \n        onSuccess={() => refetchLeads()} \n        open={addLeadDialogOpen}\n        onOpenChange={setAddLeadDialogOpen}\n        onClose={() => setAddLeadDialogOpen(false)}\n      />\n\n      <OnboardingTutorial\n        steps={isSchedulingTutorial ? schedulingTutorialSteps : leadsTutorialSteps}\n        isVisible={showTutorial}\n        onComplete={handleTutorialComplete}\n        onExit={handleTutorialExit}\n        initialStepIndex={currentTutorialStep}\n      />\n    </ErrorBoundary>\n  );\n};\n\nexport default AllLeadsRefactored;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/pages/AllProjectsRefactored.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3743,3746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3743,3746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo, useCallback } from \"react\";\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\nimport { Button } from \"@/components/ui/button\";\nimport { LayoutGrid, List, Archive, Settings, Plus } from \"lucide-react\";\nimport { EntityListView } from \"@/legacy/components/common/EntityListView\";\nimport { ErrorBoundary } from \"@/components/common/ErrorBoundary\";\nimport { TableLoadingState } from \"@/legacy/components/common/LoadingStates\";\nimport { ProjectService, ProjectWithDetails } from \"@/services/ProjectService\";\nimport { useEntityData } from \"@/hooks/useEntityData\";\nimport { ViewProjectDialog } from \"@/components/ViewProjectDialog\";\nimport { ProjectSheetView } from \"@/components/ProjectSheetView\";\nimport ProjectKanbanBoard from \"@/components/ProjectKanbanBoard\";\nimport { ProjectStatusBadge } from \"@/components/ProjectStatusBadge\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { KanbanSettingsSheet } from \"@/components/KanbanSettingsSheet\";\nimport { PROJECT_STATUS } from \"@/constants/entityConstants\";\nimport { formatDate } from \"@/lib/utils\";\nimport { useTranslation } from \"react-i18next\";\nimport { ProjectCreationWizardSheet } from \"@/features/project-creation\";\n\ntype ViewMode = 'board' | 'list' | 'archived';\n\nconst AllProjectsRefactored = () => {\n  const [viewMode, setViewMode] = useState<ViewMode>('board');\n  const [viewingProject, setViewingProject] = useState<ProjectWithDetails | null>(null);\n  const [showViewDialog, setShowViewDialog] = useState(false);\n  const [quickViewProject, setQuickViewProject] = useState<ProjectWithDetails | null>(null);\n  const [showQuickView, setShowQuickView] = useState(false);\n  const [isProjectWizardOpen, setProjectWizardOpen] = useState(false);\n  const navigate = useNavigate();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const isMobile = useIsMobile();\n  const { t } = useTranslation([\"pages\", \"navigation\"]);\n\n  // Tutorial state\n  const [showTutorial, setShowTutorial] = useState(false);\n  const [currentTutorialStep, setCurrentTutorialStep] = useState(0);\n  \n  // Services\n  const projectService = useMemo(() => new ProjectService(), []);\n  const fetchProjects = useCallback(() => projectService.fetchProjectsWithDetails(), [projectService]);\n\n  // Data hooks\n  const { \n    data: allProjects, \n    loading, \n    refetch: refetchProjects \n  } = useEntityData<ProjectWithDetails>({\n    fetchFn: fetchProjects\n  });\n\n  // Separate projects and archived projects\n  const { projects, archivedProjects } = useMemo(() => {\n    const archived = allProjects.filter(p => \n      p.project_status?.name.toLowerCase() === PROJECT_STATUS.ARCHIVED\n    );\n    const active = allProjects.filter(p => \n      p.project_status?.name.toLowerCase() !== PROJECT_STATUS.ARCHIVED\n    );\n    \n    return {\n      projects: active,\n      archivedProjects: archived\n    };\n  }, [allProjects]);\n\n  const displayProjects = viewMode === 'archived' ? archivedProjects : projects;\n\n  useEffect(() => {\n    const tutorial = searchParams.get('tutorial');\n    if (tutorial?.includes('true')) {\n      setShowTutorial(true);\n      const url = new URL(window.location.href);\n      url.searchParams.delete('tutorial');\n      window.history.replaceState({}, '', url.toString());\n    }\n  }, [searchParams]);\n\n  const handleProjectClick = (project: ProjectWithDetails) => {\n    navigate(`/projects/${project.id}`);\n  };\n\n  const handleQuickView = (project: ProjectWithDetails) => {\n    setQuickViewProject(project);\n    setShowQuickView(true);\n  };\n\n  const handleViewFullDetails = () => {\n    if (quickViewProject) {\n      navigate(`/projects/${quickViewProject.id}`);\n      setShowQuickView(false);\n    }\n  };\n\n  const handleSearchResult = (result: any) => {\n    if (result.type === 'project') {\n      navigate(`/projects/${result.id}`);\n    } else if (result.type === 'lead') {\n      navigate(`/leads/${result.id}`);\n    }\n  };\n\n  const handleViewChange = (view: ViewMode) => {\n    setViewMode(view);\n  };\n\n  const handleProjectUpdate = (updatedProject: ProjectWithDetails) => {\n    refetchProjects();\n  };\n\n  // Create columns for list view\n  const projectColumns = [\n    {\n      key: 'name',\n      header: 'Project Name',\n      sortable: true,\n      render: (project: ProjectWithDetails) => (\n        <div className=\"font-medium\">{project.name}</div>\n      )\n    },\n    {\n      key: 'lead_name',\n      header: 'Client',\n      sortable: true,\n      render: (project: ProjectWithDetails) => (\n        <div>{project.lead?.name || '-'}</div>\n      )\n    },\n    {\n      key: 'project_type',\n      header: 'Type',\n      sortable: true,\n      render: (project: ProjectWithDetails) => (\n        <div>{project.project_type?.name || '-'}</div>\n      )\n    },\n    {\n      key: 'status',\n      header: 'Status',\n      sortable: true,\n      render: (project: ProjectWithDetails) => (\n        <ProjectStatusBadge \n          projectId={project.id}\n          currentStatusId={project.status_id}\n          onStatusChange={() => refetchProjects()}\n          editable={false}\n          className=\"text-sm\"\n        />\n      )\n    },\n    {\n      key: 'sessions',\n      header: 'Sessions',\n      render: (project: ProjectWithDetails) => (\n        <div className=\"text-sm\">\n          {project.session_count || 0} sessions\n        </div>\n      )\n    },\n    {\n      key: 'created_at',\n      header: 'Created',\n      sortable: true,\n      render: (project: ProjectWithDetails) => (\n        <div className=\"text-sm text-muted-foreground\">\n          {formatDate(project.created_at)}\n        </div>\n      )\n    }\n  ];\n\n  const viewModeButtons = (\n    <div className=\"flex items-center gap-1\">\n      <Button\n        variant={viewMode === 'board' ? 'default' : 'outline'}\n        size=\"sm\"\n        onClick={() => handleViewChange('board')}\n        className=\"flex items-center gap-2\"\n      >\n        <LayoutGrid className=\"h-4 w-4\" />\n        {t(\"projects.board_view\")}\n      </Button>\n      <Button\n        variant={viewMode === 'list' ? 'default' : 'outline'}\n        size=\"sm\"\n        onClick={() => handleViewChange('list')}\n        className=\"flex items-center gap-2\"\n      >\n        <List className=\"h-4 w-4\" />\n        {t(\"projects.list_view\")}\n      </Button>\n      <Button\n        variant={viewMode === 'archived' ? 'default' : 'outline'}\n        size=\"sm\"\n        onClick={() => handleViewChange('archived')}\n        className=\"flex items-center gap-2\"\n      >\n        <Archive className=\"h-4 w-4\" />\n        {t(\"projects.archived_view\")} ({archivedProjects.length})\n      </Button>\n      <Button\n        variant=\"default\"\n        size=\"sm\"\n        onClick={() => setProjectWizardOpen(true)}\n        className=\"flex items-center gap-2\"\n      >\n        <Plus className=\"h-4 w-4\" />\n        {t(\"common:buttons.add_project\")}\n      </Button>\n      <KanbanSettingsSheet>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"flex items-center gap-2\"\n        >\n          <Settings className=\"h-4 w-4\" />\n          <span className=\"hidden sm:inline\">{t(\"navigation:settings\")}</span>\n        </Button>\n      </KanbanSettingsSheet>\n    </div>\n  );\n\n  if (loading) {\n    return <TableLoadingState />;\n  }\n\n  // Board/Kanban view\n  if (viewMode === 'board') {\n    return (\n      <>\n        <ProjectCreationWizardSheet\n          isOpen={isProjectWizardOpen}\n          onOpenChange={setProjectWizardOpen}\n          entrySource=\"legacy_board\"\n          onProjectCreated={refetchProjects}\n        />\n        <ErrorBoundary>\n        <div className=\"min-h-screen p-4 sm:p-6\">\n          <div className=\"mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\n            <div>\n              <h1 className=\"text-2xl font-bold\">{t(\"projects.title\")}</h1>\n              <p className=\"text-muted-foreground\">{t(\"projects.page_subtitle\")}</p>\n            </div>\n            {viewModeButtons}\n          </div>\n          \n        <ProjectKanbanBoard\n          projects={projects}\n          onProjectsChange={refetchProjects}\n          onProjectUpdate={handleProjectUpdate}\n          onQuickView={handleQuickView}\n        />\n        </div>\n\n        <ViewProjectDialog \n          project={viewingProject}\n          open={showViewDialog}\n          onOpenChange={setShowViewDialog}\n          onProjectUpdated={refetchProjects}\n          leadName={viewingProject?.lead?.name || \"\"}\n        />\n        <ProjectSheetView \n          project={quickViewProject}\n          open={showQuickView}\n          onOpenChange={setShowQuickView}\n          onProjectUpdated={refetchProjects}\n          leadName={quickViewProject?.lead?.name || \"\"}\n          onViewFullDetails={handleViewFullDetails}\n        />\n        </ErrorBoundary>\n      </>\n    );\n  }\n\n  // List view\n  return (\n    <>\n      <ProjectCreationWizardSheet\n        isOpen={isProjectWizardOpen}\n        onOpenChange={setProjectWizardOpen}\n        entrySource=\"legacy_list\"\n        onProjectCreated={refetchProjects}\n      />\n      <ErrorBoundary>\n      <EntityListView\n        title=\"Projects\"\n        subtitle={viewMode === 'archived' ? \"Archived projects\" : \"Manage your photography projects\"}\n        data={displayProjects}\n        columns={projectColumns}\n        loading={loading}\n        onRowClick={handleProjectClick}\n        onAddClick={() => setProjectWizardOpen(true)}\n        addButtonText={t(\"common:buttons.add_project\")}\n        headerActions={viewModeButtons}\n        itemsPerPage={20}\n      />\n\n      <ViewProjectDialog \n        project={viewingProject}\n        open={showViewDialog}\n        onOpenChange={setShowViewDialog}\n        onProjectUpdated={refetchProjects}\n        leadName={viewingProject?.lead?.name || \"\"}\n      />\n      <ProjectSheetView \n        project={quickViewProject}\n        open={showQuickView}\n        onOpenChange={setShowQuickView}\n        onProjectUpdated={refetchProjects}\n        leadName={quickViewProject?.lead?.name || \"\"}\n        onViewFullDetails={handleViewFullDetails}\n      />\n      </ErrorBoundary>\n    </>\n  );\n};\n\nexport default AllProjectsRefactored;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/pages/AllProjectsSimplified.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/pages/LeadFormExample.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/pages/ProjectDetailRefactored.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1753,1756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1753,1756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1780,1783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1780,1783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo, useCallback } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { Archive, ArchiveRestore, Trash2 } from \"lucide-react\";\nimport { EntityDetailLayout } from \"@/legacy/components/common/EntityDetailLayout\";\nimport { ErrorBoundary, EntityErrorState } from \"@/components/common/ErrorBoundary\";\nimport { DetailLoadingState } from \"@/legacy/components/common/LoadingStates\";\nimport { ProjectService, ProjectWithDetails } from \"@/services/ProjectService\";\nimport { useEntityActions } from \"@/hooks/useEntityActions\";\nimport { ProjectActivitySection } from \"@/components/ProjectActivitySection\";\nimport { ProjectTodoListEnhanced } from \"@/components/ProjectTodoListEnhanced\";\nimport { ProjectServicesSection } from \"@/components/ProjectServicesSection\";\nimport { SessionsSection } from \"@/components/SessionsSection\";\nimport { ProjectStatusBadge } from \"@/components/ProjectStatusBadge\";\nimport { SimpleProjectTypeSelect } from \"@/components/SimpleProjectTypeSelect\";\nimport { ProjectPaymentsSection } from \"@/components/ProjectPaymentsSection\";\nimport ProjectDetailsLayout from \"@/components/project-details/ProjectDetailsLayout\";\nimport { UnifiedClientDetails } from \"@/components/UnifiedClientDetails\";\nimport { PROJECT_STATUS } from \"@/constants/entityConstants\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface ProjectDetailState {\n  project: ProjectWithDetails | null;\n  lead: any | null;\n  projectType: any | null;\n  isArchived: boolean;\n}\n\nexport default function ProjectDetailRefactored() {\n  const { t } = useTranslation(\"pages\");\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  \n  const [isEditing, setIsEditing] = useState(false);\n  const [editName, setEditName] = useState(\"\");\n  const [editDescription, setEditDescription] = useState(\"\");\n  const [editProjectTypeId, setEditProjectTypeId] = useState(\"\");\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n\n  // Services\n  const projectService = useMemo(() => new ProjectService(), []);\n  const { executeAction, getActionState } = useEntityActions();\n\n  // Data state management\n  const [projectDetailData, setProjectDetailData] = useState<ProjectDetailState>({\n    project: null,\n    lead: null, \n    projectType: null,\n    isArchived: false\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const fetchProjectData = useCallback(async () => {\n    if (!id) return;\n    \n    try {\n      setLoading(true);\n      setError(null);\n      const project = await projectService.fetchProjectById(id);\n      const lead = project.lead_id ? await projectService.fetchLeadById(project.lead_id) : null;\n      const projectType = project.project_type_id ? await projectService.fetchProjectTypeById(project.project_type_id) : null;\n      const isArchived = project.project_status?.name.toLowerCase() === PROJECT_STATUS.ARCHIVED;\n      \n      setProjectDetailData({ project, lead, projectType, isArchived });\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : t(\"projectDetail.errors.loadFailed\");\n      setError(errorMessage);\n    } finally {\n      setLoading(false);\n    }\n  }, [id, projectService, t]);\n\n  useEffect(() => {\n    fetchProjectData();\n  }, [fetchProjectData]);\n\n  const project = projectDetailData.project;\n  const lead = projectDetailData.lead;\n  const projectType = projectDetailData.projectType;\n  const isArchived = projectDetailData.isArchived;\n\n  const saveState = getActionState('save');\n  const deleteState = getActionState('delete');\n  const archiveState = getActionState('archive');\n\n  useEffect(() => {\n    if (project) {\n      setEditName(project.name);\n      setEditDescription(project.description || \"\");\n      setEditProjectTypeId(project.project_type_id || \"\");\n    }\n  }, [project]);\n\n  const handleSave = async () => {\n    if (!project || !editName.trim() || !editProjectTypeId) return;\n    \n    const result = await executeAction(\n      'save',\n      () => projectService.updateProject(project.id, {\n        name: editName.trim(),\n        description: editDescription.trim() || null,\n        project_type_id: editProjectTypeId\n      }),\n      {\n        successMessage: t(\"projectDetail.toast.updateSuccess\"),\n        onSuccess: () => {\n          setIsEditing(false);\n          fetchProjectData();\n        }\n      }\n    );\n  };\n\n  const handleDelete = async () => {\n    if (!project) return;\n    \n    const result = await executeAction(\n      'delete',\n      () => projectService.deleteProject(project.id),\n      {\n        successMessage: t(\"projectDetail.toast.deleteSuccess\"),\n        onSuccess: () => navigate('/projects')\n      }\n    );\n    \n    if (result) {\n      setShowDeleteDialog(false);\n    }\n  };\n\n  const handleArchive = async () => {\n    if (!project) return;\n    \n    const successMessage = isArchived\n      ? t(\"projectDetail.toast.restoreSuccess\")\n      : t(\"projectDetail.toast.archiveSuccess\");\n    const result = await executeAction(\n      'archive',\n      () => projectService.toggleArchiveStatus(project.id, isArchived),\n      {\n        successMessage,\n        onSuccess: () => fetchProjectData()\n      }\n    );\n  };\n\n  const handleCancel = () => {\n    setIsEditing(false);\n    if (project) {\n      setEditName(project.name);\n      setEditDescription(project.description || \"\");\n      setEditProjectTypeId(project.project_type_id || \"\");\n    }\n  };\n\n  const handleStatusChange = () => {\n    fetchProjectData();\n  };\n\n  if (loading) {\n    return <DetailLoadingState />;\n  }\n\n  if (error || !project) {\n    return (\n      <EntityErrorState \n        error={error || t(\"projectDetail.errors.notFound\")}\n        onRetry={fetchProjectData}\n        title={t(\"projectDetail.errors.loadFailed\")}\n      />\n    );\n  }\n\n  const badges = [\n    {\n      label: project.project_status?.name || t(\"projectDetail.badges.noStatus\"),\n      variant: 'outline' as const,\n      className: 'text-sm'\n    }\n  ];\n\n  if (projectType) {\n    badges.push({\n      label: projectType.name.toUpperCase(),\n      variant: 'outline' as const,\n      className: 'text-sm'\n    });\n  }\n\n  const editForm = (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center gap-3\">\n        <Input \n          value={editName} \n          onChange={e => setEditName(e.target.value)} \n          placeholder={t(\"projectDetail.placeholders.name\")}\n          className=\"text-3xl font-bold border rounded-md px-4 py-3 h-auto flex-1\" \n        />\n      </div>\n      <Textarea \n        value={editDescription} \n        onChange={e => setEditDescription(e.target.value)} \n        placeholder={t(\"projectDetail.placeholders.description\")}\n        className=\"text-lg border rounded-md px-4 py-3 resize-none\" \n        rows={3} \n      />\n      <SimpleProjectTypeSelect \n        value={editProjectTypeId} \n        onValueChange={setEditProjectTypeId} \n        disabled={saveState.loading} \n        required \n      />\n    </div>\n  );\n\n  const actions = [\n    {\n      label: isArchived ? t(\"projectDetail.actions.restore\") : t(\"projectDetail.actions.archive\"),\n      onClick: handleArchive,\n      icon: isArchived ? <ArchiveRestore className=\"h-4 w-4\" /> : <Archive className=\"h-4 w-4\" />,\n      variant: 'outline' as const\n    },\n    {\n      label: t(\"projectDetail.actions.delete\"),\n      onClick: () => setShowDeleteDialog(true),\n      icon: <Trash2 className=\"h-4 w-4\" />,\n      variant: 'destructive' as const\n    }\n  ];\n\n  return (\n    <ErrorBoundary>\n      <EntityDetailLayout\n        title={project.name}\n        description={project.description}\n        badges={badges}\n        onBack={() => navigate('/projects')}\n        onEdit={() => setIsEditing(true)}\n        onSave={handleSave}\n        onCancel={handleCancel}\n        isEditing={isEditing}\n        isSaving={saveState.loading}\n        canEdit={!isArchived}\n        editForm={editForm}\n        actions={actions}\n      >\n        <ProjectDetailsLayout \n          header={\n            <div className=\"space-y-2\">\n              <h2 className=\"text-lg font-semibold\">{t(\"projectDetail.sections.overview\")}</h2>\n              <UnifiedClientDetails \n                lead={lead}\n              />\n            </div>\n          }\n          left={\n            <div className=\"space-y-4\">\n              <ProjectStatusBadge \n                projectId={project.id}\n                currentStatusId={project.status_id}\n                onStatusChange={handleStatusChange}\n                editable={!isArchived}\n                className=\"text-sm w-full justify-center\"\n              />\n            </div>\n          }\n          sections={[\n            {\n              id: \"activities\",\n              title: t(\"projectDetail.sections.activities\"),\n              content: (\n                <ProjectActivitySection\n                  projectId={project.id}\n                  leadId={project.lead_id}\n                  leadName={lead?.name || \"\"}\n                  projectName={project.name}\n                  onActivityUpdated={fetchProjectData}\n                />\n              )\n            },\n            {\n              id: \"todos\", \n              title: t(\"projectDetail.sections.todos\"),\n              content: (\n                <ProjectTodoListEnhanced\n                  projectId={project.id}\n                />\n              )\n            },\n            {\n              id: \"services\",\n              title: t(\"projectDetail.sections.services\"), \n              content: (\n                <ProjectServicesSection\n                  projectId={project.id}\n                  onServicesUpdated={fetchProjectData}\n                />\n              )\n            },\n            {\n              id: \"sessions\",\n              title: t(\"projectDetail.sections.sessions\"),\n              content: (\n                <SessionsSection\n                  sessions={[]}\n                  loading={false}\n                  leadId={project.lead_id}\n                  projectId={project.id}\n                  leadName={lead?.name || \"\"}\n                  projectName={project.name}\n                  onSessionUpdated={fetchProjectData}\n                  onDeleteSession={async (sessionId: string) => {\n                    // Handle session deletion\n                    fetchProjectData();\n                  }}\n                />\n              )\n            },\n            {\n              id: \"payments\",\n              title: t(\"projectDetail.sections.payments\"),\n              content: (\n                <ProjectPaymentsSection\n                  projectId={project.id}\n                  onPaymentsUpdated={fetchProjectData}\n                />\n              )\n            }\n          ]}\n        />\n      </EntityDetailLayout>\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{t(\"projectDetail.dialogs.deleteTitle\")}</AlertDialogTitle>\n            <AlertDialogDescription>\n              {t(\"projectDetail.dialogs.deleteDescription\")}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel disabled={deleteState.loading}>\n              {t(\"projectDetail.actions.cancel\")}\n            </AlertDialogCancel>\n            <AlertDialogAction \n              onClick={handleDelete}\n              disabled={deleteState.loading}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {deleteState.loading ? t(\"projectDetail.actions.deleting\") : t(\"projectDetail.actions.delete\")}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </ErrorBoundary>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/pages/Settings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/legacy/utils/validationUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/__tests__/organizationSettingsCache.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/accounting/__tests__/vat.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/accounting/vat.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/auditLog.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/dateFormatUtils.test.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":78,"column":7,"severity":1,"nodeType":null,"fix":{"range":[2285,2347],"text":" "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2462,2465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2462,2465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":90,"column":7,"severity":1,"nodeType":null,"fix":{"range":[2682,2744],"text":" "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2838,2841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2838,2841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":2,"source":"import * as dateFnsTz from \"date-fns-tz\";\n\nimport {\n  formatDateWithOrgSettings,\n  formatTimeWithOrgSettings,\n  detectBrowserTimezone,\n  getSupportedTimezones,\n  formatDateTimeInTimezone,\n  convertToOrgTimezone,\n  convertFromOrgTimezone,\n  formatDateInTimezone,\n  formatTimeInTimezone,\n} from \"./dateFormatUtils\";\n\nprocess.env.TZ = \"UTC\";\n\nafterEach(() => {\n  jest.restoreAllMocks();\n});\n\ndescribe(\"formatDateWithOrgSettings\", () => {\n  const dateString = \"2024-05-15T00:00:00Z\";\n\n  it(\"supports common organization date formats\", () => {\n    const date = new Date(dateString);\n\n    expect(\n      formatDateWithOrgSettings(dateString, { dateFormat: \"MM/DD/YYYY\" })\n    ).toBe(date.toLocaleDateString(\"en-US\"));\n\n    expect(\n      formatDateWithOrgSettings(dateString, { dateFormat: \"DD/MM/YYYY\" })\n    ).toBe(date.toLocaleDateString(\"en-GB\"));\n\n    expect(\n      formatDateWithOrgSettings(dateString, { dateFormat: \"YYYY-MM-DD\" })\n    ).toBe(\"2024-05-15\");\n\n    expect(\n      formatDateWithOrgSettings(dateString, { dateFormat: \"DD-MM-YYYY\" })\n    ).toBe(date.toLocaleDateString(\"en-GB\").replace(/\\//g, \"-\"));\n\n    expect(\n      formatDateWithOrgSettings(dateString, { dateFormat: \"MM-DD-YYYY\" })\n    ).toBe(date.toLocaleDateString(\"en-US\").replace(/\\//g, \"-\"));\n  });\n\n  it(\"falls back to locale-aware formatting for custom formats\", () => {\n    const result = formatDateWithOrgSettings(dateString, {\n      dateFormat: \"CUSTOM\",\n      locale: \"tr-TR\",\n    });\n\n    expect(result).toBe(\"15.05.2024\");\n  });\n});\n\ndescribe(\"formatTimeWithOrgSettings\", () => {\n  it(\"returns 24 hour time when requested\", () => {\n    expect(formatTimeWithOrgSettings(\"15:30\", \"24-hour\")).toBe(\"15:30\");\n  });\n\n  it(\"converts to 12 hour format with AM/PM markers\", () => {\n    expect(formatTimeWithOrgSettings(\"00:05\", \"12-hour\")).toBe(\"12:05 AM\");\n    expect(formatTimeWithOrgSettings(\"12:00\", \"12-hour\")).toBe(\"12:00 PM\");\n    expect(formatTimeWithOrgSettings(\"23:15\", \"12-hour\")).toBe(\"11:15 PM\");\n  });\n\n  it(\"returns an empty string for missing input\", () => {\n    expect(formatTimeWithOrgSettings(\"\", \"12-hour\")).toBe(\"\");\n  });\n});\n\ndescribe(\"detectBrowserTimezone\", () => {\n  it(\"returns the timezone reported by Intl APIs\", () => {\n    const mock = jest\n      .spyOn(Intl, \"DateTimeFormat\")\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      .mockImplementation(() => ({\n        resolvedOptions: () => ({ timeZone: \"America/New_York\" }),\n      }) as any);\n\n    expect(detectBrowserTimezone()).toBe(\"America/New_York\");\n    mock.mockRestore();\n  });\n\n  it(\"falls back to UTC when detection fails\", () => {\n    const mock = jest\n      .spyOn(Intl, \"DateTimeFormat\")\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      .mockImplementation(() => {\n        throw new Error(\"Intl not available\");\n      }) as any;\n\n    expect(detectBrowserTimezone()).toBe(\"UTC\");\n    mock.mockRestore();\n  });\n});\n\ndescribe(\"getSupportedTimezones\", () => {\n  it(\"returns alphabetically sorted timezone metadata\", () => {\n    const supported = getSupportedTimezones();\n    const labels = supported.map((entry) => entry.label);\n    const sortedLabels = [...labels].sort((a, b) => a.localeCompare(b));\n\n    expect(labels).toEqual(sortedLabels);\n    expect(supported).toEqual(\n      expect.arrayContaining([\n        expect.objectContaining({\n          value: \"Europe/Istanbul\",\n          label: \"Istanbul (Europe/Istanbul)\",\n          region: \"Europe\",\n        }),\n      ])\n    );\n  });\n});\n\ndescribe(\"formatDateTimeInTimezone\", () => {\n  const baseDate = \"2024-05-15T15:30:00Z\";\n\n  it(\"formats date and time in 24 hour mode for the requested timezone\", () => {\n    const formatted = formatDateTimeInTimezone(baseDate, \"America/New_York\", {\n      dateFormat: \"MM/DD/YYYY\",\n      timeFormat: \"24-hour\",\n    });\n\n    expect(formatted).toBe(\"05/15/2024 11:30\");\n  });\n\n  it(\"formats date and time in 12 hour mode with localized date\", () => {\n    const formatted = formatDateTimeInTimezone(baseDate, \"Europe/Istanbul\", {\n      dateFormat: \"DD/MM/YYYY\",\n      timeFormat: \"12-hour\",\n    });\n\n    expect(formatted).toBe(\"15/05/2024 6:30 PM\");\n  });\n\n  it(\"falls back to date formatting when timezone formatting fails\", () => {\n    const spy = jest\n      .spyOn(dateFnsTz, \"formatInTimeZone\")\n      .mockImplementationOnce(() => {\n        throw new Error(\"formatting failed\");\n      });\n\n    const formatted = formatDateTimeInTimezone(baseDate, \"UTC\", {\n      dateFormat: \"MM/DD/YYYY\",\n    });\n\n    expect(formatted).toBe(new Date(baseDate).toLocaleDateString(\"en-US\"));\n    spy.mockRestore();\n  });\n});\n\ndescribe(\"convertToOrgTimezone\", () => {\n  const baseDate = \"2024-05-15T15:30:00Z\";\n\n  it(\"shifts a UTC date into the chosen organization timezone\", () => {\n    const zoned = convertToOrgTimezone(baseDate, \"America/Los_Angeles\");\n\n    const roundTripped = convertFromOrgTimezone(zoned, \"America/Los_Angeles\");\n    expect(roundTripped.toISOString()).toBe(new Date(baseDate).toISOString());\n  });\n\n  it(\"returns the original value when conversion fails\", () => {\n    const spy = jest\n      .spyOn(dateFnsTz, \"toZonedTime\")\n      .mockImplementationOnce(() => {\n        throw new Error(\"conversion failed\");\n      });\n\n    const result = convertToOrgTimezone(baseDate, \"Invalid/Timezone\");\n    expect(result.toISOString()).toBe(new Date(baseDate).toISOString());\n    spy.mockRestore();\n  });\n});\n\ndescribe(\"convertFromOrgTimezone\", () => {\n  const utcDate = new Date(\"2024-05-15T15:30:00Z\");\n  const localDate = dateFnsTz.toZonedTime(utcDate, \"America/New_York\");\n\n  it(\"converts a local timezone date back to UTC\", () => {\n    const converted = convertFromOrgTimezone(localDate, \"America/New_York\");\n\n    expect(converted.toISOString()).toBe(\"2024-05-15T15:30:00.000Z\");\n  });\n\n  it(\"returns the original value when reverse conversion fails\", () => {\n    const spy = jest\n      .spyOn(dateFnsTz, \"fromZonedTime\")\n      .mockImplementationOnce(() => {\n        throw new Error(\"conversion failed\");\n      });\n\n    const result = convertFromOrgTimezone(localDate, \"Invalid/Timezone\");\n    expect(result).toBe(localDate);\n    spy.mockRestore();\n  });\n});\n\ndescribe(\"formatDateInTimezone\", () => {\n  it(\"formats a date in the requested timezone and format\", () => {\n    const formatted = formatDateInTimezone(\n      \"2024-01-01T01:30:00Z\",\n      \"America/Los_Angeles\",\n      \"MM/DD/YYYY\"\n    );\n\n    expect(formatted).toBe(\"12/31/2023\");\n  });\n\n  it(\"falls back to organization date formatting when conversion fails\", () => {\n    const spy = jest\n      .spyOn(dateFnsTz, \"formatInTimeZone\")\n      .mockImplementationOnce(() => {\n        throw new Error(\"formatting failed\");\n      });\n\n    const formatted = formatDateInTimezone(\"2024-05-15T00:00:00Z\", \"UTC\", \"DD/MM/YYYY\");\n    expect(formatted).toBe(\n      new Date(\"2024-05-15T00:00:00Z\").toLocaleDateString(\"en-GB\")\n    );\n    spy.mockRestore();\n  });\n});\n\ndescribe(\"formatTimeInTimezone\", () => {\n  it(\"returns formatted output for time-only entries\", () => {\n    expect(formatTimeInTimezone(\"09:15\", \"UTC\", \"12-hour\")).toBe(\"9:15 AM\");\n    expect(formatTimeInTimezone(\"09:15\", \"UTC\", \"24-hour\")).toBe(\"09:15\");\n  });\n\n  it(\"formats date strings in the requested timezone\", () => {\n    const baseDate = \"2024-05-15T15:30:00Z\";\n\n    expect(\n      formatTimeInTimezone(baseDate, \"America/New_York\", \"24-hour\")\n    ).toBe(\"11:30\");\n\n    expect(\n      formatTimeInTimezone(baseDate, \"America/New_York\", \"12-hour\")\n    ).toBe(\"11:30 AM\");\n  });\n\n  it(\"returns an empty string for invalid inputs\", () => {\n    expect(formatTimeInTimezone(\"not-a-date\", \"UTC\", \"12-hour\")).toBe(\"\");\n  });\n\n  it(\"falls back to an empty string when timezone formatting fails\", () => {\n    const spy = jest\n      .spyOn(dateFnsTz, \"formatInTimeZone\")\n      .mockImplementationOnce(() => {\n        throw new Error(\"formatting failed\");\n      });\n\n    expect(\n      formatTimeInTimezone(\"2024-05-15T15:30:00Z\", \"UTC\", \"24-hour\")\n    ).toBe(\"\");\n    spy.mockRestore();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/dateFormatUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/dateUtils.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[470,473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[470,473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[531,534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[531,534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getRelativeDate, getDateDisplayClasses, isOverdueSession } from \"./dateUtils\";\nimport { formatDate } from \"@/lib/utils\";\n\njest.mock(\"@/lib/utils\", () => ({\n  formatDate: jest.fn(),\n  formatTime: jest.fn(),\n}));\n\nconst mockFormatDate = formatDate as jest.MockedFunction<typeof formatDate>;\nconst RealDate = Date;\n\nfunction setCurrentDate(isoDate: string) {\n  const fixedDate = new RealDate(isoDate);\n\n  class MockDate extends RealDate {\n    constructor(...args: any[]) {\n      if (args.length) {\n        super(...(args as [any]));\n        return;\n      }\n      super(fixedDate.valueOf());\n    }\n  }\n\n  const MockDateCtor = MockDate as unknown as DateConstructor;\n  MockDateCtor.UTC = RealDate.UTC;\n  MockDateCtor.parse = RealDate.parse;\n  MockDateCtor.now = () => fixedDate.valueOf();\n\n  globalThis.Date = MockDateCtor;\n}\n\ndescribe(\"dateUtils\", () => {\n  beforeAll(() => {\n    setCurrentDate(\"2025-01-15T10:00:00\");\n  });\n\n  afterAll(() => {\n    globalThis.Date = RealDate;\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe(\"getRelativeDate\", () => {\n    it(\"returns fallback English labels for today, tomorrow, and yesterday\", () => {\n      expect(getRelativeDate(\"2025-01-15\")).toBe(\"Today\");\n      expect(getRelativeDate(\"2025-01-16\")).toBe(\"Tomorrow\");\n      expect(getRelativeDate(\"2025-01-14\")).toBe(\"Yesterday\");\n      expect(mockFormatDate).not.toHaveBeenCalled();\n    });\n\n    it(\"returns localized labels when translator is provided\", () => {\n      const translations: Record<string, string> = {\n        \"relativeDates.today\": \"Bugun\",\n        \"relativeDates.tomorrow\": \"Yarin\",\n        \"relativeDates.yesterday\": \"Dun\",\n      };\n      const t = (key: string) => translations[key] ?? key;\n\n      expect(getRelativeDate(\"2025-01-15\", t)).toBe(\"Bugun\");\n      expect(getRelativeDate(\"2025-01-16\", t)).toBe(\"Yarin\");\n      expect(getRelativeDate(\"2025-01-14\", t)).toBe(\"Dun\");\n    });\n\n    it(\"falls back to formatDate for other dates\", () => {\n      mockFormatDate.mockReturnValueOnce(\"Jan 20\");\n\n      const result = getRelativeDate(\"2025-01-20\");\n\n      expect(result).toBe(\"Jan 20\");\n      expect(mockFormatDate).toHaveBeenCalledWith(\"2025-01-20\");\n    });\n  });\n\n  describe(\"isOverdueSession\", () => {\n    it(\"returns true when session is before today and still planned\", () => {\n      expect(isOverdueSession(\"2025-01-10\", \"planned\")).toBe(true);\n    });\n\n    it(\"returns false when session is today or later\", () => {\n      expect(isOverdueSession(\"2025-01-15\", \"planned\")).toBe(false);\n      expect(isOverdueSession(\"2025-01-17\", \"planned\")).toBe(false);\n    });\n\n    it(\"returns false when status is not planned\", () => {\n      expect(isOverdueSession(\"2025-01-10\", \"completed\")).toBe(false);\n    });\n  });\n\n  describe(\"getDateDisplayClasses\", () => {\n    const translations: Record<string, string> = {\n      \"relativeDates.today\": \"Bugun\",\n      \"relativeDates.tomorrow\": \"Yarin\",\n    };\n    const t = (key: string) => translations[key] ?? key;\n\n    it(\"returns highlight classes for today and tomorrow labels\", () => {\n      expect(getDateDisplayClasses(\"2025-01-15\", t)).toBe(\n        \"text-primary font-medium\"\n      );\n      expect(getDateDisplayClasses(\"2025-01-16\", t)).toBe(\n        \"text-primary font-medium\"\n      );\n    });\n\n    it(\"returns default classes for other dates\", () => {\n      mockFormatDate.mockReturnValueOnce(\"Jan 18\");\n      expect(getDateDisplayClasses(\"2025-01-18\", t)).toBe(\n        \"text-foreground\"\n      );\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/dateUtils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[159,162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[159,162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1771,1774],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1771,1774],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { formatDate, formatTime } from \"@/lib/utils\";\nimport { useTranslation } from \"react-i18next\";\n\nexport const getRelativeDate = (dateString: string, t?: any): string => {\n  const sessionDate = new Date(dateString);\n  const today = new Date();\n  const tomorrow = new Date(today);\n  tomorrow.setDate(today.getDate() + 1);\n  const yesterday = new Date(today);\n  yesterday.setDate(today.getDate() - 1);\n\n  // Reset time to compare just dates\n  const sessionDateOnly = new Date(sessionDate.getFullYear(), sessionDate.getMonth(), sessionDate.getDate());\n  const todayOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());\n  const tomorrowOnly = new Date(tomorrow.getFullYear(), tomorrow.getMonth(), tomorrow.getDate());\n  const yesterdayOnly = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate());\n\n  if (sessionDateOnly.getTime() === todayOnly.getTime()) {\n    return t ? t('relativeDates.today') : \"Today\";\n  } else if (sessionDateOnly.getTime() === tomorrowOnly.getTime()) {\n    return t ? t('relativeDates.tomorrow') : \"Tomorrow\";\n  } else if (sessionDateOnly.getTime() === yesterdayOnly.getTime()) {\n    return t ? t('relativeDates.yesterday') : \"Yesterday\";\n  }\n\n  return formatDate(dateString);\n};\n\nexport const isOverdueSession = (dateString: string, status: string): boolean => {\n  const sessionDate = new Date(dateString);\n  const today = new Date();\n  \n  // Reset time to compare just dates\n  const sessionDateOnly = new Date(sessionDate.getFullYear(), sessionDate.getMonth(), sessionDate.getDate());\n  const todayOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());\n  \n  return sessionDateOnly < todayOnly && status === 'planned';\n};\n\nexport const getDateDisplayClasses = (dateString: string, t?: any): string => {\n  const relativeDate = getRelativeDate(dateString, t);\n  \n  const todayText = t ? t('relativeDates.today') : \"Today\";\n  const tomorrowText = t ? t('relativeDates.tomorrow') : \"Tomorrow\";\n  \n  if (relativeDate === todayText || relativeDate === tomorrowText) {\n    return \"text-primary font-medium\";\n  }\n  \n  return \"text-foreground\";\n};","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/debug.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/featureFlags.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'no-eval').","line":11,"column":5,"severity":1,"nodeType":null,"fix":{"range":[363,398],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"const FEATURE_FLAG_PREFIX = \"VITE_FEATURE_\";\n\nconst toEnvKey = (flag: string) => {\n  const normalized = flag.replace(/[^a-z0-9]/gi, \"_\").toUpperCase();\n  return `${FEATURE_FLAG_PREFIX}${normalized}`;\n};\n\nconst resolveEnv = (): Record<string, string | undefined> => {\n  // Accessing import.meta breaks under Jest (CommonJS). Eval keeps bundlers happy.\n  try {\n    // eslint-disable-next-line no-eval\n    const meta = (0, eval)(\"import.meta\");\n    if (meta && typeof meta === \"object\" && \"env\" in meta) {\n      return (meta as Record<string, unknown>).env as Record<string, string | undefined>;\n    }\n  } catch {\n    // ignore, fall back to process.env below\n  }\n\n  if (typeof process !== \"undefined\" && process.env) {\n    return process.env as Record<string, string | undefined>;\n  }\n\n  return {};\n};\n\nexport const isFeatureEnabled = (flag: string, defaultValue = false): boolean => {\n  const key = toEnvKey(flag);\n  const env = resolveEnv();\n  const raw = env[key];\n\n  if (raw === \"true\") return true;\n  if (raw === \"false\") return false;\n\n  if (typeof window !== \"undefined\") {\n    try {\n      const override = window.localStorage.getItem(`flag:${flag}`);\n      if (override === \"true\") return true;\n      if (override === \"false\") return false;\n    } catch (error) {\n      console.warn(\"Feature flag localStorage lookup failed\", error);\n    }\n  }\n\n  return defaultValue;\n};\n\nexport const FEATURE_FLAGS = {\n  sessionWizardV1: \"session_wizard_v1\",\n} as const;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/inputUtils.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[711,714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[711,714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1021,1024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1021,1024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n  trimAndNormalizeSpaces,\n  createTrimmedInputHandler,\n  createTrimmedBlurHandler,\n} from \"./inputUtils\";\n\ndescribe(\"inputUtils\", () => {\n  describe(\"trimAndNormalizeSpaces\", () => {\n    it(\"trims leading/trailing whitespace and collapses inner spacing\", () => {\n      expect(trimAndNormalizeSpaces(\"  hello   world  \")).toBe(\"hello world\");\n      expect(trimAndNormalizeSpaces(\"\\t spaced \\n out \\t\")).toBe(\"spaced out\");\n    });\n  });\n\n  describe(\"createTrimmedInputHandler\", () => {\n    it(\"passes raw value when trimOnChange is false\", () => {\n      const setValue = jest.fn();\n      const handler = createTrimmedInputHandler(setValue);\n\n      handler({ target: { value: \"  keep   spacing  \" } } as any);\n\n      expect(setValue).toHaveBeenCalledWith(\"  keep   spacing  \");\n    });\n\n    it(\"trims and normalizes value when trimOnChange is true\", () => {\n      const setValue = jest.fn();\n      const handler = createTrimmedInputHandler(setValue, true);\n\n      handler({ target: { value: \"  trim   me  \" } } as any);\n\n      expect(setValue).toHaveBeenCalledWith(\"trim me\");\n    });\n  });\n\n  describe(\"createTrimmedBlurHandler\", () => {\n    it(\"trims value on blur when it contains excess whitespace\", () => {\n      const setValue = jest.fn();\n      const blurHandler = createTrimmedBlurHandler(\"  spaced   value  \", setValue);\n\n      blurHandler();\n\n      expect(setValue).toHaveBeenCalledWith(\"spaced value\");\n    });\n\n    it(\"avoids setting state when value is already trimmed\", () => {\n      const setValue = jest.fn();\n      const blurHandler = createTrimmedBlurHandler(\"clean value\", setValue);\n\n      blurHandler();\n\n      expect(setValue).not.toHaveBeenCalled();\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/inputUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/leadFieldValidation.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/leadFieldValidation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/leadStatusColors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/organizationSettingsCache.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/organizationUtils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/organizationUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/paymentColors.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/paymentColors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/projects/buildProjectSummaryItems.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[652,655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[652,655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[713,716],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[713,716],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { buildProjectSummaryItems } from \"./buildProjectSummaryItems\";\nimport type { ProjectHeaderPaymentSummary, ProjectHeaderServicesSummary, ProjectHeaderTodoSummary } from \"@/hooks/useProjectHeaderSummary\";\nimport type { ProjectSessionsSummary } from \"@/hooks/useProjectSessionsSummary\";\n\njest.mock(\"@/lib/utils\", () => ({\n  formatDate: jest.fn((value: string) => `date(${value})`),\n  formatTime: jest.fn((value: string) => `time(${value})`),\n}));\n\nconst RealDate = Date;\n\nfunction setCurrentDate(isoDate: string) {\n  const fixedDate = new RealDate(isoDate);\n\n  class MockDate extends RealDate {\n    constructor(...args: any[]) {\n      if (args.length) {\n        super(...(args as [any]));\n        return;\n      }\n      super(fixedDate.valueOf());\n    }\n  }\n\n  const MockDateCtor = MockDate as unknown as DateConstructor;\n  MockDateCtor.UTC = RealDate.UTC;\n  MockDateCtor.parse = RealDate.parse;\n  MockDateCtor.now = () => fixedDate.valueOf();\n\n  globalThis.Date = MockDateCtor;\n}\n\nconst emptySessions: ProjectSessionsSummary = {\n  total: 0,\n  activeCount: 0,\n  completedCount: 0,\n  cancelledCount: 0,\n  overdueCount: 0,\n  overdueNext: null,\n  todayCount: 0,\n  todayNext: null,\n  nextUpcoming: null,\n  latestCompleted: null,\n};\n\ndescribe(\"buildProjectSummaryItems\", () => {\n  beforeAll(() => {\n    setCurrentDate(\"2025-01-15T10:00:00Z\");\n  });\n\n  afterAll(() => {\n    globalThis.Date = RealDate;\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  const createTranslator = () =>\n    jest.fn((key: string, options?: Record<string, unknown>) =>\n      options ? `${key}|${JSON.stringify(options)}` : key\n    );\n\n  const basePayments: ProjectHeaderPaymentSummary = {\n    totalPaid: 0,\n    total: 0,\n    remaining: 0,\n    currency: \"TRY\",\n  };\n\n  const baseTodos: ProjectHeaderTodoSummary = {\n    total: 0,\n    completed: 0,\n  };\n\n  const baseServices: ProjectHeaderServicesSummary = {\n    total: 0,\n    names: [],\n    totalValue: 0,\n  };\n\n  it(\"returns default messaging when there is no activity data\", () => {\n    const t = createTranslator();\n\n    const items = buildProjectSummaryItems({\n      t,\n      payments: basePayments,\n      todos: baseTodos,\n      services: baseServices,\n      sessionsSummary: emptySessions,\n    });\n\n    expect(items).toHaveLength(4);\n\n    expect(items[0]).toMatchObject({\n      key: \"payments\",\n      primary: \"projectDetail.header.payments.primaryZero\",\n      secondary: \"projectDetail.header.payments.secondaryZero\",\n      secondaryClassName: undefined,\n    });\n\n    expect(items[1]).toMatchObject({\n      key: \"sessions\",\n      primary: \"projectDetail.header.sessions.none\",\n      secondary: \"projectDetail.header.sessions.hint\",\n      secondaryClassName: \"text-muted-foreground\",\n    });\n\n    expect(items[2]).toMatchObject({\n      key: \"todos\",\n      primary: \"projectDetail.header.todos.none\",\n      secondary: \"projectDetail.header.todos.hint\",\n    });\n\n    expect(items[3]).toMatchObject({\n      key: \"services\",\n      primary: \"projectDetail.header.services.none\",\n      secondary: \"projectDetail.header.services.hint\",\n      info: undefined,\n    });\n  });\n\n  it(\"builds rich summary information when activity data exists\", () => {\n    const t = createTranslator();\n\n    const payments: ProjectHeaderPaymentSummary = {\n      totalPaid: 500,\n      total: 500,\n      remaining: 0,\n      currency: \"USD\",\n    };\n\n    const todos: ProjectHeaderTodoSummary = {\n      total: 4,\n      completed: 1,\n    };\n\n    const services: ProjectHeaderServicesSummary = {\n      total: 2,\n      names: [\"Album Design\", \"Print Package\"],\n      totalValue: 250,\n    };\n\n    const sessionsSummary: ProjectSessionsSummary = {\n      total: 5,\n      activeCount: 3,\n      completedCount: 1,\n      cancelledCount: 1,\n      overdueCount: 1,\n      overdueNext: {\n        id: \"overdue-1\",\n        session_date: \"2025-01-10\",\n        session_time: \"10:00:00\",\n        status: \"planned\",\n      },\n      todayCount: 2,\n      todayNext: {\n        id: \"today-1\",\n        session_date: \"2025-01-15\",\n        session_time: \"14:30:00\",\n        status: \"planned\",\n      },\n      nextUpcoming: {\n        id: \"upcoming-1\",\n        session_date: \"2025-01-16\",\n        session_time: \"09:00:00\",\n        status: \"planned\",\n      },\n      latestCompleted: null,\n    };\n\n    const items = buildProjectSummaryItems({\n      t,\n      payments,\n      todos,\n      services,\n      sessionsSummary,\n    });\n\n    expect(items[0].primary).toContain(\"projectDetail.header.payments.primary|\");\n    expect(items[0].secondary).toContain(\"projectDetail.header.payments.paidInFull\");\n    expect(items[0].secondaryClassName).toBe(\"text-emerald-600\");\n\n    expect(items[1].primary).toContain(\"projectDetail.header.sessions.count|\");\n    const sessionContainer = items[1].secondary as React.ReactElement;\n    const chipTexts = React.Children.toArray(sessionContainer.props.children as React.ReactNode[])\n      .map(child => {\n        if (!React.isValidElement(child)) {\n          return String(child);\n        }\n        return React.Children.toArray(child.props.children).join(\"\");\n      });\n\n    expect(chipTexts.join(\"|\")).toContain(\"projectDetail.header.sessions.chips.overdue|\");\n    expect(chipTexts.join(\"|\")).toContain(\"projectDetail.header.sessions.chips.todayMultiple|\");\n    expect(chipTexts.join(\"|\")).toContain(\"projectDetail.header.sessions.chips.tomorrow|\");\n    expect(items[1].secondaryClassName).toBeUndefined();\n\n    expect(items[2].primary).toBe(\"projectDetail.header.todos.primary|{\\\"completed\\\":1,\\\"total\\\":4}\");\n    expect(items[2].secondary).toBe(\"projectDetail.header.todos.secondary|{\\\"progress\\\":25}\");\n\n    expect(items[3].primary).toBe(\"projectDetail.header.services.primary|{\\\"count\\\":2}\");\n    expect(items[3].secondary).toBe(\"projectDetail.header.services.viewList\");\n    expect(items[3].info).toBeDefined();\n    const infoContent = items[3].info?.content as React.ReactElement;\n    const infoChildren = React.Children.toArray(infoContent.props.children);\n    const listElement = infoChildren.find(\n      child => React.isValidElement(child) && child.type === \"ul\"\n    ) as React.ReactElement | undefined;\n    const listItems = listElement\n      ? React.Children.toArray(listElement.props.children)\n      : [];\n    const listTexts = listItems.map(item =>\n      React.isValidElement(item) ? React.Children.toArray(item.props.children).join(\"\") : String(item)\n    );\n\n    expect(listTexts).toContain(\"Album Design\");\n    expect(listTexts).toContain(\"Print Package\");\n\n    const translationKeys = t.mock.calls.map(([key]) => key);\n    expect(translationKeys).toContain(\"projectDetail.header.sessions.chips.todayMultiple\");\n    expect(translationKeys).toContain(\"projectDetail.header.sessions.chips.tomorrow\");\n    expect(translationKeys).not.toContain(\"projectDetail.header.sessions.hint\");\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/projects/buildProjectSummaryItems.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/projects/sortOrder.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/services/units.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/sessionSorting.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/sessionSorting.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/sessionUtils.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1054,1057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1054,1057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getDisplaySessionName, generateSessionName } from \"./sessionUtils\";\n\ndescribe(\"sessionUtils\", () => {\n  describe(\"getDisplaySessionName\", () => {\n    it(\"returns trimmed session name when provided\", () => {\n      expect(\n        getDisplaySessionName({\n          session_name: \"  Sunset Shoot \",\n        })\n      ).toBe(\"Sunset Shoot\");\n    });\n\n    it(\"falls back to project type when session name missing\", () => {\n      expect(\n        getDisplaySessionName({\n          projects: {\n            project_types: {\n              name: \"Engagement\",\n            },\n          },\n        })\n      ).toBe(\"Engagement Session\");\n    });\n\n    it(\"uses lead name when project type unavailable\", () => {\n      expect(\n        getDisplaySessionName({\n          leads: {\n            name: \"Taylor Swift\",\n          },\n        })\n      ).toBe(\"Taylor Swift Session\");\n    });\n\n    it(\"returns generic fallback when no contextual data present\", () => {\n      expect(getDisplaySessionName({})).toBe(\"Session\");\n      expect(getDisplaySessionName(undefined as any)).toBe(\"Session\");\n    });\n  });\n\n  describe(\"generateSessionName\", () => {\n    it(\"returns default label when project name is empty or whitespace\", () => {\n      expect(generateSessionName(\"\")).toBe(\"New Session\");\n      expect(generateSessionName(\"   \")).toBe(\"New Session\");\n    });\n\n    it(\"returns trimmed project name with Session suffix\", () => {\n      expect(generateSessionName(\"  Family Portraits \")).toBe(\n        \"Family Portraits Session\"\n      );\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/sessionUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/sessions/buildSessionSummaryItems.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/sessions/buildSessionSummaryItems.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/settingsHelpContent.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/statusBadgeStyles.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/telemetry.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[225,228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[225,228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[411,414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[411,414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'no-console').","line":20,"column":7,"severity":1,"nodeType":null,"fix":{"range":[597,635],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'no-console').","line":24,"column":5,"severity":1,"nodeType":null,"fix":{"range":[724,762],"text":" "}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":2,"source":"type TelemetryPayload = Record<string, unknown> | undefined;\n\nexport const trackEvent = (eventName: string, payload?: TelemetryPayload) => {\n  try {\n    if (typeof window !== \"undefined\") {\n      const analytics = (window as any).analytics;\n      if (analytics && typeof analytics.track === \"function\") {\n        analytics.track(eventName, payload ?? {});\n        return;\n      }\n\n      const gtag = (window as any).gtag;\n      if (typeof gtag === \"function\") {\n        gtag(\"event\", eventName, payload ?? {});\n        return;\n      }\n    }\n\n    if (process.env.NODE_ENV !== \"production\") {\n      // eslint-disable-next-line no-console\n      console.debug(`[telemetry] ${eventName}`, payload);\n    }\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(\"Telemetry tracking failed\", error);\n  }\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/templateBlockUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/templateUtils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/templateUtils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1120,1123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1120,1123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":40,"column":35,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":40,"endColumn":66}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Template utility functions for variable replacement, validation, etc.\n\nexport function replacePlaceholders(text: string, data: Record<string, string>, allowFallbacks = true): string {\n  if (!allowFallbacks) {\n    return text.replace(/\\{(\\w+)\\}/g, (match, key) => data[key] || match);\n  }\n  \n  // Support fallback syntax: {variable|fallback}\n  return text.replace(/\\{(\\w+)(?:\\|([^}]*))?\\}/g, (match, key, fallback) => {\n    return data[key] || fallback || match;\n  });\n}\n\nexport function getCharacterCount(text: string): number {\n  return text.length;\n}\n\nexport function checkSpamWords(text: string): string[] {\n  const spamWords = [\n    'free', 'urgent', 'limited time', 'act now', 'click here', \n    'guaranteed', 'make money', 'no cost', 'risk free', 'winner'\n  ];\n  \n  const foundWords: string[] = [];\n  const lowerText = text.toLowerCase();\n  \n  spamWords.forEach(word => {\n    if (lowerText.includes(word)) {\n      foundWords.push(word);\n    }\n  });\n  \n  return foundWords;\n}\n\n// Plain text generation - use blocks if available, fallback to simple text processing\nexport function generatePlainText(blocksOrText: any[] | string, mockData: Record<string, string> = {}): string {\n  // If it's an array of blocks, use the new block-to-plaintext converter\n  if (Array.isArray(blocksOrText)) {\n    const { blocksToPlainText } = require('./templateBlockUtils');\n    return blocksToPlainText(blocksOrText, mockData);\n  }\n  \n  // Legacy fallback for simple text processing\n  if (typeof blocksOrText === 'string') {\n    return replacePlaceholders(blocksOrText, mockData);\n  }\n  \n  return 'No content available';\n}\n\n// Get preview data sets based on language\nexport function getPreviewDataSets(language: string = 'en') {\n  if (language === 'tr') {\n    return [\n      {\n        name: \"Tam Veri\",\n        data: {\n          customer_name: \"Elif & Mert\",\n          session_date: \"15 Mart 2024\",\n          session_time: \"14:00\",\n          session_location: \"Merkez StÃ¼dyo\",\n          business_name: \"Parlak FotoÄŸrafÃ§Ä±lÄ±k\",\n          business_phone: \"(555) 123-4567\",\n          customer_email: \"elif.mert@example.com\",\n          business_email: \"merhaba@parlakfotografcilik.com\"\n        }\n      },\n      {\n        name: \"Eksik Alanlar\",\n        data: {\n          customer_name: \"AyÅŸe YÄ±lmaz\",\n          session_date: \"20 Mart 2024\",\n          business_name: \"Parlak FotoÄŸrafÃ§Ä±lÄ±k\",\n          business_phone: \"(555) 123-4567\"\n          // Missing time, location, emails\n        }\n      },\n      {\n        name: \"Uzun Ä°simler\",\n        data: {\n          customer_name: \"Zeynep Nur Kaya-Demir\",\n          session_date: \"25 Mart 2024\", \n          session_time: \"10:30\",\n          session_location: \"Merkez Park FotoÄŸraf StÃ¼dyosu ve Etkinlik AlanÄ±\",\n          business_name: \"Profesyonel DÃ¼ÄŸÃ¼n ve Portre FotoÄŸraf StÃ¼dyosu\",\n          business_phone: \"(555) 987-6543\",\n          customer_email: \"zeynep.nur.kaya.demir@example.com\",\n          business_email: \"iletisim@profesyoneldugÃ¼nportre.com\"\n        }\n      }\n    ];\n  }\n  \n  // Default English data\n  return [\n    {\n      name: \"Complete Data\",\n      data: {\n        customer_name: \"Sarah Johnson\",\n        session_date: \"March 15, 2024\",\n        session_time: \"2:00 PM\",\n        session_location: \"Studio Downtown\",\n        business_name: \"Radiant Photography\",\n        business_phone: \"(555) 123-4567\",\n        customer_email: \"sarah@example.com\",\n        business_email: \"hello@radiantphotography.com\"\n      }\n    },\n    {\n      name: \"Missing Fields\",\n      data: {\n        customer_name: \"John Doe\",\n        session_date: \"March 20, 2024\",\n        business_name: \"Radiant Photography\",\n        business_phone: \"(555) 123-4567\"\n        // Missing time, location, emails\n      }\n    },\n    {\n      name: \"Long Names\",\n      data: {\n        customer_name: \"Alexandra Thompson-Williams\",\n        session_date: \"March 25, 2024\", \n        session_time: \"10:30 AM\",\n        session_location: \"Central Park Photography Studio & Event Space\",\n        business_name: \"Professional Wedding & Portrait Photography Studio\",\n        business_phone: \"(555) 987-6543\",\n        customer_email: \"alexandra.thompson.williams@example.com\",\n        business_email: \"contact@professionalweddingportraitstudio.com\"\n      }\n    }\n  ];\n}\n\n// Backward compatibility\nexport const previewDataSets = getPreviewDataSets('en');\n\nexport const emojis = [\n  'ðŸ“¸', 'ðŸ’', 'âœ¨', 'ðŸŽ‰', 'ðŸ’•', 'ðŸ‘‹', 'ðŸ“…', 'â°', 'ðŸ“', 'ðŸ’«',\n  'ðŸŒŸ', 'ðŸ’Ž', 'ðŸŽŠ', 'ðŸ’–', 'ðŸ“§', 'ðŸ’¬', 'ðŸ“±', 'ðŸ”¥', 'ðŸ’¯', 'â­'\n];","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/toastHelpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/utils.test.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[726,729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[726,729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/validation.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/lib/validation.ts","messages":[{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\+.","line":20,"column":13,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":20,"endColumn":14,"suggestions":[{"messageId":"removeEscape","fix":{"range":[521,522],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[521,521],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":28,"column":28,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":28,"endColumn":29,"suggestions":[{"messageId":"removeEscape","fix":{"range":[765,766],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[765,765],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { z } from \"zod\";\n\n// Input validation schemas\nexport const emailSchema = z\n  .string()\n  .email(\"Please enter a valid email address\")\n  .max(254, \"Email address is too long\");\n\nexport const passwordSchema = z\n  .string()\n  .min(8, \"Password must be at least 8 characters\")\n  .max(128, \"Password is too long\")\n  .regex(\n    /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)/,\n    \"Password must contain at least one uppercase letter, one lowercase letter, and one number\"\n  );\n\nexport const phoneSchema = z\n  .string()\n  .regex(/^[\\+]?[1-9][\\d]{0,15}$/, \"Please enter a valid phone number\")\n  .max(20, \"Phone number is too long\")\n  .optional();\n\nexport const nameSchema = z\n  .string()\n  .min(1, \"Name is required\")\n  .max(100, \"Name is too long\")\n  .regex(/^[\\p{L}\\p{M}\\s\\-'\\.]+$/u, \"Name contains invalid characters\");\n\nexport const notesSchema = z\n  .string()\n  .max(1000, \"Notes are too long\")\n  .optional();\n\n// Auth schemas\nexport const signInSchema = z.object({\n  email: emailSchema,\n  password: z.string().min(1, \"Password is required\")\n});\n\nexport const signUpSchema = z.object({\n  email: emailSchema,\n  password: passwordSchema\n});\n\n// Lead schemas\nexport const leadSchema = z.object({\n  name: nameSchema,\n  email: emailSchema.optional(),\n  phone: phoneSchema,\n  notes: notesSchema\n});\n\n// Session schemas\nexport const sessionSchema = z.object({\n  session_date: z.string().min(1, \"Date is required\"),\n  session_time: z.string().min(1, \"Time is required\"),\n  notes: notesSchema\n});\n\n// Sanitization utility\nexport const sanitizeInput = (input: string): string => {\n  return input.trim().replace(/[<>]/g, \"\");\n};\n\nexport const sanitizeHtml = async (input: string): Promise<string> => {\n  try {\n    const DOMPurify = await import(\"dompurify\");\n    return DOMPurify.default.sanitize(input);\n  } catch {\n    // Fallback if DOMPurify fails to load\n    return sanitizeInput(input);\n  }\n};","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/AllLeads.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":238,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7633,7636],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7633,7636],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'sortState'. Either include it or remove the dependency array.","line":655,"column":6,"nodeType":"ArrayExpression","endLine":655,"endColumn":77,"suggestions":[{"desc":"Update the dependencies array to be: [filteredLeads, sortAccessors, sortState]","fix":{"range":[21053,21124],"text":"[filteredLeads, sortAccessors, sortState]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":712,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":712,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23099,23102],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23099,23102],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'exportColumns'. Either include it or remove the dependency array.","line":752,"column":6,"nodeType":"ArrayExpression","endLine":752,"endColumn":74,"suggestions":[{"desc":"Update the dependencies array to be: [exportColumns, exporting, fetchLeadsData, t, totalCount]","fix":{"range":[24295,24363],"text":"[exportColumns, exporting, fetchLeadsData, t, totalCount]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo, useCallback } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Plus, Filter, FileDown, Loader2 } from \"lucide-react\";\nimport { EnhancedAddLeadDialog } from \"@/components/EnhancedAddLeadDialog\";\nimport { useNavigate } from \"react-router-dom\";\nimport GlobalSearch from \"@/components/GlobalSearch\";\nimport { PageHeader, PageHeaderSearch } from \"@/components/ui/page-header\";\nimport { OnboardingTutorial, TutorialStep } from \"@/components/shared/OnboardingTutorial\";\nimport { useOnboarding } from \"@/contexts/OnboardingContext\";\nimport {\n  Calendar,\n  MessageSquare,\n  Users,\n  FileText,\n  TrendingUp,\n  AlertCircle,\n  XCircle,\n} from \"lucide-react\";\nimport { type LeadWithCustomFields } from \"@/hooks/useLeadsWithCustomFields\";\nimport { useLeadsData } from \"@/pages/leads/hooks/useLeadsData\";\nimport { useLeadTableColumns } from \"@/hooks/useLeadTableColumns\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { TableLoadingSkeleton } from \"@/components/ui/loading-presets\";\nimport { useTranslation } from \"react-i18next\";\nimport { writeFileXLSX, utils as XLSXUtils } from \"xlsx/xlsx.mjs\";\nimport {\n  AdvancedDataTable,\n  type AdvancedDataTableSortState,\n} from \"@/components/data-table\";\nimport { useLeadsFilters, type CustomFieldFilterValue } from \"@/pages/leads/hooks/useLeadsFilters\";\nimport type { LeadFieldDefinition } from \"@/types/leadFields\";\nimport { formatDate, getStartOfWeek } from \"@/lib/utils\";\nimport { format } from \"date-fns\";\nimport { KpiCard } from \"@/components/ui/kpi-card\";\nimport { getKpiIconPreset } from \"@/components/ui/kpi-presets\";\nimport { useThrottledRefetchOnFocus } from \"@/hooks/useThrottledRefetchOnFocus\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\n\ntype LeadStatusOption = {\n  id: string;\n  name: string;\n  color: string;\n  is_system_final?: boolean;\n};\n\ntype LeadNavigationState = {\n  from: string;\n  continueTutorial?: boolean;\n  tutorialType?: \"scheduling\";\n  tutorialStep?: number;\n};\n\nconst parseBooleanFilterValue = (\n  value: string | null | undefined\n): boolean | null => {\n  if (value == null) return null;\n  const normalized = value.toString().trim().toLowerCase();\n  if ([\"true\", \"1\", \"yes\", \"y\"].includes(normalized)) return true;\n  if ([\"false\", \"0\", \"no\", \"n\"].includes(normalized)) return false;\n  return null;\n};\n\nconst normalizeFilterText = (value: string | undefined) =>\n  (value ?? \"\").toLowerCase();\n\nconst splitCommaValues = (value: string | null | undefined) =>\n  (value ?? \"\")\n    .split(\",\")\n    .map((entry) => entry.trim())\n    .filter(Boolean);\n\nconst isCustomFilterValueEmpty = (value?: CustomFieldFilterValue): boolean => {\n  if (!value) return true;\n  switch (value.type) {\n    case \"text\":\n      return value.value.trim() === \"\";\n    case \"number\":\n      return (value.min ?? \"\").trim() === \"\" && (value.max ?? \"\").trim() === \"\";\n    case \"date\":\n      return (value.start ?? \"\").trim() === \"\" && (value.end ?? \"\").trim() === \"\";\n    case \"select\":\n      return value.values.length === 0;\n    case \"checkbox\":\n      return value.value === \"any\";\n    default:\n      return true;\n  }\n};\n\ninterface FilterChipDetail {\n  label: string;\n  value: string;\n}\n\nconst formatNumericBoundary = (\n  label: string,\n  min?: string,\n  max?: string\n): FilterChipDetail | null => {\n  const trimmedMin = (min ?? \"\").trim();\n  const trimmedMax = (max ?? \"\").trim();\n  if (trimmedMin && trimmedMax) {\n    return { label, value: `${trimmedMin} â€“ ${trimmedMax}` };\n  }\n  if (trimmedMin) {\n    return { label, value: `â‰¥ ${trimmedMin}` };\n  }\n  if (trimmedMax) {\n    return { label, value: `â‰¤ ${trimmedMax}` };\n  }\n  return null;\n};\n\nconst formatDateBoundary = (\n  label: string,\n  start?: string,\n  end?: string\n): FilterChipDetail | null => {\n  const trimmedStart = (start ?? \"\").trim();\n  const trimmedEnd = (end ?? \"\").trim();\n  if (trimmedStart && trimmedEnd) {\n    return {\n      label,\n      value: `${formatDate(trimmedStart)} â€“ ${formatDate(trimmedEnd)}`,\n    };\n  }\n  if (trimmedStart) {\n    return { label, value: `â‰¥ ${formatDate(trimmedStart)}` };\n  }\n  if (trimmedEnd) {\n    return { label, value: `â‰¤ ${formatDate(trimmedEnd)}` };\n  }\n  return null;\n};\n\nconst describeCustomFieldFilterChip = (\n  field: LeadFieldDefinition,\n  filter: CustomFieldFilterValue,\n  tPages: (key: string, options?: Record<string, unknown>) => string\n): FilterChipDetail | null => {\n  switch (filter.type) {\n    case \"text\": {\n      const trimmed = filter.value.trim();\n      return trimmed ? { label: field.label, value: trimmed } : null;\n    }\n    case \"number\":\n      return formatNumericBoundary(field.label, filter.min, filter.max);\n    case \"date\":\n      return formatDateBoundary(field.label, filter.start, filter.end);\n    case \"select\": {\n      const values = filter.values.filter(Boolean);\n      return values.length\n        ? { label: field.label, value: values.join(\", \") }\n        : null;\n    }\n    case \"checkbox\": {\n      if (filter.value === \"any\") return null;\n      const checkboxLabel = tPages(`leads.checkboxFilter.${filter.value}`);\n      return { label: field.label, value: checkboxLabel };\n    }\n    default:\n      return null;\n  }\n};\n\nconst AllLeadsNew = () => {\n  const [leadStatuses, setLeadStatuses] = useState<LeadStatusOption[]>([]);\n  const [leadStatusesLoading, setLeadStatusesLoading] = useState(true);\n  const [addLeadDialogOpen, setAddLeadDialogOpen] = useState(false);\n  const [showTutorial, setShowTutorial] = useState(false);\n  const [currentTutorialStep, setCurrentTutorialStep] = useState(0);\n  const [isSchedulingTutorial, setIsSchedulingTutorial] = useState(false);\n  const [exporting, setExporting] = useState(false);\n  const navigate = useNavigate();\n  const { currentStep, completeCurrentStep } = useOnboarding();\n  const { t } = useTranslation('pages');\n  const { t: tCommon } = useTranslation('common');\n  const { activeOrganizationId } = useOrganization();\n\n  // Server-side paginated leads (scalable like payments)\n  const [sortState, setSortState] = useState<AdvancedDataTableSortState>({\n    columnId: \"updated_at\",\n    direction: \"desc\",\n  });\n\n  const sortFieldForServer = useMemo(() => {\n    if (sortState.columnId === \"name\") return \"name\" as const;\n    if (sortState.columnId === \"created_at\") return \"created_at\" as const;\n    return \"updated_at\" as const;\n  }, [sortState.columnId]);\n\n  const {\n    advancedColumns,\n    fieldDefinitions,\n    sortAccessors,\n    loading: columnsLoading,\n  } = useLeadTableColumns({\n    leadStatuses,\n    leadStatusesLoading,\n  });\n\n  const {\n    state: filtersState,\n    filtersConfig,\n    activeCount: activeFilterCount,\n  } = useLeadsFilters({\n    statuses: leadStatuses,\n    fieldDefinitions,\n  });\n\n  const [page, setPage] = useState(1);\n  const pageSize = 25;\n\n  // Map selected status names to IDs for server-side filtering\n  const selectedStatusIds = useMemo(() => {\n    if (!filtersState.status.length) return undefined;\n    const byName = new Map(leadStatuses.map((s) => [s.name, s.id]));\n    return filtersState.status\n      .map((name) => byName.get(name))\n      .filter(Boolean) as string[];\n  }, [filtersState.status, leadStatuses]);\n\n  // Fetch serverâ€‘side paginated data based on filters and sort\n  const {\n    pageLeads,\n    metricsLeads,\n    totalCount,\n    initialLoading: leadsInitialLoading,\n    tableLoading: leadsTableLoading,\n    refetch: refetchLeads,\n    fetchLeadsData,\n  } = useLeadsData({\n    page,\n    pageSize,\n    sortField: sortFieldForServer,\n    sortDirection: sortState.direction as any,\n    statusIds: selectedStatusIds,\n    customFieldFilters: filtersState.customFields,\n  });\n\n  const fieldDefinitionMap = useMemo(() => {\n    const map = new Map<string, (typeof fieldDefinitions)[number]>();\n    fieldDefinitions.forEach((definition) => {\n      map.set(definition.field_key, definition);\n    });\n    return map;\n  }, [fieldDefinitions]);\n\n  const totalIconPreset = useMemo(() => getKpiIconPreset(\"sky\"), []);\n  const conversionIconPreset = useMemo(() => getKpiIconPreset(\"emerald\"), []);\n  const inactivityIconPreset = useMemo(() => getKpiIconPreset(\"amber\"), []);\n  const closedIconPreset = useMemo(() => getKpiIconPreset(\"rose\"), []);\n\n  const formatNumber = (value: number) =>\n    value.toLocaleString(undefined, { maximumFractionDigits: 0 });\n\n  const formatPercent = (value: number) =>\n    `${value.toLocaleString(undefined, {\n      minimumFractionDigits: value > 0 && value < 10 ? 1 : 0,\n      maximumFractionDigits: 1,\n    })}%`;\n\n  const formatSignedNumber = (value: number) => {\n    if (value === 0) return \"0\";\n    const formatted = formatNumber(Math.abs(value));\n    return value > 0 ? `+${formatted}` : `-${formatted}`;\n  };\n\n  const formatSignedPercent = (value: number) => {\n    if (value === 0) return \"0%\";\n    const abs = Math.abs(value);\n    const formatted = abs.toLocaleString(undefined, {\n      minimumFractionDigits: abs > 0 && abs < 10 ? 1 : 0,\n      maximumFractionDigits: 1,\n    });\n    return value > 0 ? `+${formatted}%` : `-${formatted}%`;\n  };\n\n  const getTrendDirection = (value: number): \"up\" | \"down\" | \"flat\" => {\n    if (value > 0) return \"up\";\n    if (value < 0) return \"down\";\n    return \"flat\";\n  };\n\n  const leadKpiMetrics = useMemo(() => {\n    const nowDate = new Date();\n    const now = nowDate.getTime();\n    const dayInMs = 1000 * 60 * 60 * 24;\n\n    // Locale-aware week boundaries for \"this week\" vs \"last week\"\n    const startOfThisWeek = getStartOfWeek(nowDate).getTime();\n    const startOfLastWeek = startOfThisWeek - 7 * dayInMs;\n\n    const last30Start = now - 30 * dayInMs;\n    const previous30Start = now - 60 * dayInMs;\n    const inactiveThreshold = now - 14 * dayInMs;\n    const inactivePreviousThreshold = now - 21 * dayInMs;\n\n    const normalizeStatus = (status: string | null | undefined) =>\n      (status ?? \"\").toLowerCase();\n\n    const toMs = (value: string | null | undefined) => {\n      if (!value) return null;\n      const date = new Date(value);\n      const ms = date.getTime();\n      return Number.isNaN(ms) ? null : ms;\n    };\n\n    const convertedKeywords = [\n      \"booked\",\n      \"completed\",\n      \"won\",\n      \"converted\",\n      \"signed\",\n    ];\n    const lostKeywords = [\"lost\", \"canceled\", \"cancelled\"];\n    const closedKeywords = [\"closed\", \"finished\"];\n\n    let newCurrent = 0;\n    let newPrevious = 0;\n    let currentEligible = 0;\n    let currentConverted = 0;\n    let previousEligible = 0;\n    let previousConverted = 0;\n    let inactiveCurrent = 0;\n    let inactivePrevious = 0;\n    let closedCurrent = 0;\n    let closedPrevious = 0;\n\n    metricsLeads.forEach((lead) => {\n      const createdMs = toMs(lead.created_at);\n      if (createdMs != null) {\n        if (createdMs >= startOfThisWeek) {\n          newCurrent += 1;\n        } else if (createdMs >= startOfLastWeek && createdMs < startOfThisWeek) {\n          newPrevious += 1;\n        }\n      }\n\n      const updatedMs = toMs(lead.updated_at) ?? createdMs;\n      if (updatedMs == null) {\n        return;\n      }\n\n      const statusName = normalizeStatus(lead.lead_statuses?.name ?? lead.status);\n      const isLost = lostKeywords.some((keyword) => statusName.includes(keyword));\n      const isCompleted = statusName.includes(\"completed\");\n      const isConverted = convertedKeywords.some((keyword) =>\n        statusName.includes(keyword),\n      );\n      const isClosed =\n        Boolean(lead.lead_statuses?.is_system_final) ||\n        isLost ||\n        isCompleted ||\n        closedKeywords.some((keyword) => statusName.includes(keyword)) ||\n        isConverted;\n\n      if (updatedMs >= last30Start) {\n        if (!isLost) {\n          currentEligible += 1;\n          if (isConverted) {\n            currentConverted += 1;\n          }\n        }\n        if (isClosed) {\n          closedCurrent += 1;\n        }\n      } else if (updatedMs >= previous30Start) {\n        if (!isLost) {\n          previousEligible += 1;\n          if (isConverted) {\n            previousConverted += 1;\n          }\n        }\n        if (isClosed) {\n          closedPrevious += 1;\n        }\n      }\n\n      if (!isCompleted && !isLost) {\n        if (updatedMs < inactiveThreshold) {\n          inactiveCurrent += 1;\n          if (updatedMs < inactivePreviousThreshold) {\n            inactivePrevious += 1;\n          }\n        }\n      }\n    });\n\n    const currentRate =\n      currentEligible > 0 ? (currentConverted / currentEligible) * 100 : 0;\n    const previousRate =\n      previousEligible > 0 ? (previousConverted / previousEligible) * 100 : 0;\n\n    return {\n      totals: {\n        total: totalCount,\n        newCurrent,\n        newPrevious,\n        delta: newCurrent - newPrevious,\n      },\n      conversion: {\n        currentRate,\n        previousRate,\n        delta: currentRate - previousRate,\n      },\n      inactivity: {\n        current: inactiveCurrent,\n        previous: inactivePrevious,\n        delta: inactiveCurrent - inactivePrevious,\n      },\n      closed: {\n        current: closedCurrent,\n        previous: closedPrevious,\n        delta: closedCurrent - closedPrevious,\n      },\n    };\n  }, [metricsLeads, totalCount]);\n\n  // Throttle refresh on focus/visibility to avoid request storms\n  const refreshLeads = useCallback(async () => {\n    if (typeof window !== \"undefined\" && activeOrganizationId) {\n      window.localStorage.removeItem(`prefetch:leads:first:${activeOrganizationId}`);\n      window.localStorage.removeItem(`prefetch:leads:metrics:${activeOrganizationId}`);\n    }\n    setPage(1);\n    await refetchLeads();\n  }, [activeOrganizationId, refetchLeads]);\n\n  useThrottledRefetchOnFocus(refreshLeads, 30_000);\n\n  const leadsTutorialSteps: TutorialStep[] = [\n    {\n      id: 1,\n      title: t('leads.tutorial.welcome.title'),\n      description: t('leads.tutorial.welcome.description'),\n      content: (\n        <div className=\"space-y-4\">\n          <div className=\"flex items-start gap-3\">\n            <Users className=\"w-5 h-5 text-primary mt-0.5\" />\n            <div>\n              <h4 className=\"font-medium\">{t('leads.tutorial.welcome.trackLeads.title')}</h4>\n              <p className=\"text-sm text-muted-foreground\">{t('leads.tutorial.welcome.trackLeads.description')}</p>\n            </div>\n          </div>\n          <div className=\"flex items-start gap-3\">\n            <Filter className=\"w-5 h-5 text-primary mt-0.5\" />\n            <div>\n              <h4 className=\"font-medium\">{t('leads.tutorial.welcome.filterSort.title')}</h4>\n              <p className=\"text-sm text-muted-foreground\">{t('leads.tutorial.welcome.filterSort.description')}</p>\n            </div>\n          </div>\n          <div className=\"flex items-start gap-3\">\n            <FileText className=\"w-5 h-5 text-primary mt-0.5\" />\n            <div>\n              <h4 className=\"font-medium\">{t('leads.tutorial.welcome.customizeColumns.title')}</h4>\n              <p className=\"text-sm text-muted-foreground\">{t('leads.tutorial.welcome.customizeColumns.description')}</p>\n            </div>\n          </div>\n        </div>\n      ),\n      mode: \"modal\",\n      canProceed: true\n    },\n    {\n      id: 2,\n      title: t('leads.tutorial.addFirstLead.title'),\n      description: t('leads.tutorial.addFirstLead.description'),\n      content: null,\n      mode: \"floating\",\n      canProceed: totalCount > 0,\n      requiresAction: totalCount === 0,\n      disabledTooltip: t('leads.tutorial.addFirstLead.disabledTooltip')\n    },\n    {\n      id: 3,\n      title: t('leads.tutorial.exploreDetails.title'),\n      description: t('leads.tutorial.exploreDetails.description'),\n      content: null,\n      mode: \"floating\",\n      canProceed: false,\n      requiresAction: true,\n      disabledTooltip: t('leads.tutorial.exploreDetails.disabledTooltip')\n    }\n  ];\n\n  const schedulingTutorialSteps: TutorialStep[] = [\n    {\n      id: 1,\n      title: t('leads.tutorial.scheduling.title'),\n      description: t('leads.tutorial.scheduling.description'),\n      content: (\n        <div className=\"space-y-4\">\n          <div className=\"flex items-start gap-3\">\n            <Calendar className=\"w-5 h-5 text-primary mt-0.5\" />\n            <div>\n              <h4 className=\"font-medium\">{t('leads.tutorial.scheduling.chooseDateTime.title')}</h4>\n              <p className=\"text-sm text-muted-foreground\">{t('leads.tutorial.scheduling.chooseDateTime.description')}</p>\n            </div>\n          </div>\n          <div className=\"flex items-start gap-3\">\n            <Users className=\"w-5 h-5 text-primary mt-0.5\" />\n            <div>\n              <h4 className=\"font-medium\">{t('leads.tutorial.scheduling.selectClient.title')}</h4>\n              <p className=\"text-sm text-muted-foreground\">{t('leads.tutorial.scheduling.selectClient.description')}</p>\n            </div>\n          </div>\n          <div className=\"flex items-start gap-3\">\n            <MessageSquare className=\"w-5 h-5 text-primary mt-0.5\" />\n            <div>\n              <h4 className=\"font-medium\">{t('leads.tutorial.scheduling.addDetails.title')}</h4>\n              <p className=\"text-sm text-muted-foreground\">{t('leads.tutorial.scheduling.addDetails.description')}</p>\n            </div>\n          </div>\n        </div>\n      ),\n      mode: \"modal\",\n      canProceed: true\n    },\n    {\n      id: 2,\n      title: t('leads.tutorial.selectLeadForSession.title'),\n      description: t('leads.tutorial.selectLeadForSession.description'),\n      content: null,\n      mode: \"floating\",\n      canProceed: false,\n      requiresAction: true,\n      disabledTooltip: t('leads.tutorial.selectLeadForSession.disabledTooltip')\n    }\n  ];\n\n  // Check if we should show tutorial when component mounts\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const isSchedulingTutorialParam = urlParams.get('tutorial') === 'scheduling';\n    \n    if (isSchedulingTutorialParam) {\n      setIsSchedulingTutorial(true);\n      setShowTutorial(true);\n      setCurrentTutorialStep(0);\n    } else if (currentStep === 2) {\n      setShowTutorial(true);\n      setCurrentTutorialStep(0);\n    }\n  }, [currentStep]);\n\n  // Update tutorial step when needed\n  useEffect(() => {\n    if (showTutorial && !addLeadDialogOpen && currentTutorialStep === 1) {\n      setCurrentTutorialStep(2);\n    }\n  }, [addLeadDialogOpen, showTutorial, currentTutorialStep]);\n\n  // Handle tutorial completion\n  const handleTutorialComplete = async () => {\n    try {\n      // Complete Step 2 (leads) since this tutorial was accessed from leads page\n      await completeCurrentStep();\n      setShowTutorial(false);\n      console.log(t('leads.messages.tutorialCompleted'));\n      navigate('/getting-started');\n    } catch (error) {\n      console.error(t('leads.messages.errorCompletingTutorial'), error);\n      toast({\n        title: \"Error\", \n        description: t('leads.messages.failedToSaveProgress'),\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const handleTutorialExit = () => {\n    setShowTutorial(false);\n  };\n\n  const handleAddLeadDialogChange = (open: boolean) => {\n    setAddLeadDialogOpen(open);\n  };\n\n  const fetchLeadStatuses = useCallback(async () => {\n    try {\n      setLeadStatusesLoading(true);\n      const { data, error } = await supabase\n        .from('lead_statuses')\n        .select('*')\n        .order('sort_order', { ascending: true });\n\n      if (error) throw error;\n      setLeadStatuses((data as LeadStatusOption[]) || []);\n    } catch (error) {\n      console.error(t('leads.messages.errorFetchingStatuses'), error);\n    } finally {\n      setLeadStatusesLoading(false);\n    }\n  }, [t]);\n\n  useEffect(() => {\n    fetchLeadStatuses();\n  }, [fetchLeadStatuses]);\n\n  const handleSortChange = useCallback(\n    (next: AdvancedDataTableSortState) => {\n      setSortState(next);\n    },\n    []\n  );\n\n  // All custom-field filtering is applied server-side; no client fallback\n  const filteredLeads = useMemo(() => pageLeads, [pageLeads]);\n\n  const sortedLeads = useMemo(() => {\n    const { columnId, direction } = sortState;\n    if (!columnId) {\n      return filteredLeads;\n    }\n\n    const accessor = sortAccessors[columnId];\n    if (!accessor) {\n      return filteredLeads;\n    }\n\n    const sorted = [...filteredLeads].sort((a, b) => {\n      const aValue = accessor(a);\n      const bValue = accessor(b);\n\n      if (typeof aValue === \"number\" && typeof bValue === \"number\") {\n        const aValid = Number.isFinite(aValue);\n        const bValid = Number.isFinite(bValue);\n        if (!aValid && !bValid) return 0;\n        if (!aValid) return 1;\n        if (!bValid) return -1;\n        return aValue - bValue;\n      }\n\n      const aString = (aValue ?? \"\").toString();\n      const bString = (bValue ?? \"\").toString();\n\n      const aEmpty = aString.length === 0;\n      const bEmpty = bString.length === 0;\n\n      if (aEmpty && bEmpty) return 0;\n      if (aEmpty) return 1;\n      if (bEmpty) return -1;\n\n      return aString.localeCompare(bString);\n    });\n\n    if (direction === \"desc\") {\n      sorted.reverse();\n    }\n\n    return sorted;\n  }, [filteredLeads, sortAccessors, sortState.columnId, sortState.direction]);\n\n  useEffect(() => {\n    const totalPages = Math.max(1, Math.ceil(totalCount / pageSize));\n    if (page > totalPages) {\n      setPage(totalPages);\n    }\n  }, [page, pageSize, totalCount]);\n\n  useEffect(() => {\n    setPage(1);\n  }, [filtersState.status, filtersState.customFields]);\n\n  const paginatedLeads = sortedLeads; // already server-paginated\n\n  const hasMoreLeads = paginatedLeads.length < totalCount;\n  const isLoadingMoreLeads = leadsTableLoading && page > 1;\n\n  const handleLoadMoreLeads = useCallback(() => {\n    if (leadsTableLoading || !hasMoreLeads) return;\n    const totalPages = totalCount > 0 ? Math.ceil(totalCount / pageSize) : 0;\n    if (totalPages && page >= totalPages) return;\n    setPage((prev) => prev + 1);\n  }, [hasMoreLeads, leadsTableLoading, page, pageSize, totalCount]);\n\n  const exportColumns = useMemo(() => advancedColumns, [advancedColumns]);\n\n  const handleExportLeads = useCallback(async () => {\n    if (exporting) return;\n\n    if (totalCount === 0) {\n      toast({\n        title: t(\"leads.export.noDataTitle\"),\n        description: t(\"leads.export.noDataDescription\"),\n      });\n      return;\n    }\n\n    try {\n      setExporting(true);\n\n      // Fetch all filtered leads in chunks from the server to avoid loading everything at once\n      const CHUNK = 500;\n      const collected: LeadWithCustomFields[] = [];\n      for (let from = 0; from < totalCount; from += CHUNK) {\n        const to = Math.min(from + CHUNK - 1, totalCount - 1);\n        const { leads: chunk } = await fetchLeadsData({ from, to, includeCount: false });\n        collected.push(...chunk);\n      }\n\n      const rows = collected.map((lead) => {\n        const row: Record<string, string | number> = {};\n        exportColumns.forEach((column) => {\n          const header =\n            typeof column.label === \"string\" ? column.label : String(column.label);\n          let value: unknown = \"\";\n          if (column.accessor) {\n            value = column.accessor(lead as any);\n          } else if (typeof column.accessorKey === \"string\") {\n            value = (lead as Record<string, unknown>)[column.accessorKey];\n          }\n\n          if (value == null) {\n            row[header] = \"\";\n          } else if (typeof value === \"number\") {\n            row[header] = value;\n          } else {\n            row[header] = String(value);\n          }\n        });\n        return row;\n      });\n\n      const worksheet = XLSXUtils.json_to_sheet(rows);\n      const workbook = XLSXUtils.book_new();\n      XLSXUtils.book_append_sheet(workbook, worksheet, \"Leads\");\n\n      const timestamp = format(new Date(), \"yyyy-MM-dd_HHmm\");\n      writeFileXLSX(workbook, `leads-${timestamp}.xlsx`);\n\n      toast({\n        title: t(\"leads.export.successTitle\"),\n        description: t(\"leads.export.successDescription\"),\n      });\n    } catch (error) {\n      console.error(\"Error exporting leads\", error);\n      toast({\n        title: t(\"leads.export.errorTitle\"),\n        description:\n          error instanceof Error\n            ? error.message\n            : t(\"leads.export.errorDescription\"),\n        variant: \"destructive\",\n      });\n    } finally {\n      setExporting(false);\n    }\n  }, [advancedColumns, exporting, fetchLeadsData, t, tCommon, totalCount]);\n\n  const exportActions = useMemo(\n    () => (\n      <Button\n        type=\"button\"\n        variant=\"outline\"\n        size=\"sm\"\n        onClick={handleExportLeads}\n        disabled={exporting || leadsTableLoading || sortedLeads.length === 0}\n        className=\"hidden sm:inline-flex\"\n      >\n        {exporting ? (\n          <Loader2 className=\"h-4 w-4 animate-spin\" />\n        ) : (\n          <FileDown className=\"h-4 w-4\" />\n        )}\n        <span>{t(\"leads.export.button\")}</span>\n      </Button>\n    ),\n    [exporting, handleExportLeads, leadsTableLoading, sortedLeads.length, t]\n  );\n\n  const tableSummaryText = useMemo(() => {\n    if (activeFilterCount === 0) return undefined;\n    return t(\"leads.tableSummaryFiltered\", { visible: sortedLeads.length, total: totalCount });\n  }, [activeFilterCount, sortedLeads.length, t, totalCount]);\n\n  const filtersSummaryText = useMemo(() => {\n    if (activeFilterCount === 0) {\n      return t(\"leads.tableNoActiveFilters\");\n    }\n    return t(\"leads.tableActiveFilters\", { count: activeFilterCount });\n  }, [activeFilterCount, t]);\n\n  const activeFilterChips = useMemo(() => {\n    const chips: { id: string; label: React.ReactNode }[] = [];\n\n    if (filtersState.status.length > 0) {\n      filtersState.status.forEach((statusName, index) => {\n        chips.push({\n          id: `status-${statusName}-${index}`,\n          label: (\n            <span>\n              <span className=\"mr-1 text-xs uppercase tracking-wide text-muted-foreground\">\n                {t(\"leads.filterChip.statusLabel\")}:\n              </span>\n              {statusName}\n            </span>\n          ),\n        });\n      });\n    }\n\n    fieldDefinitions.forEach((field) => {\n      const filterValue = filtersState.customFields[field.field_key];\n      if (!filterValue || isCustomFilterValueEmpty(filterValue)) {\n        return;\n      }\n      const detail = describeCustomFieldFilterChip(field, filterValue, t);\n      if (detail) {\n        chips.push({\n          id: `custom-${field.field_key}`,\n          label: (\n            <span>\n              <span className=\"mr-1 text-xs uppercase tracking-wide text-muted-foreground\">\n                {detail.label}:\n              </span>\n              {detail.value}\n            </span>\n          ),\n        });\n      }\n    });\n\n    return chips;\n  }, [fieldDefinitions, filtersState, t]);\n\n  const resetFilters = filtersConfig.onReset;\n\n  const handleToolbarReset = useCallback(() => {\n    resetFilters?.();\n  }, [resetFilters]);\n\n  const leadsHeaderSummary = useMemo(\n    () => ({ text: tableSummaryText, chips: activeFilterChips }),\n    [activeFilterChips, tableSummaryText]\n  );\n\n  const handleRowClick = (lead: LeadWithCustomFields) => {\n    const state: LeadNavigationState = { from: \"all-leads\" };\n    \n    if (showTutorial) {\n      if (isSchedulingTutorial && currentTutorialStep === 1) {\n        state.continueTutorial = true;\n        state.tutorialType = 'scheduling';\n        state.tutorialStep = 3;\n      } else if (currentTutorialStep === 2) {\n        state.continueTutorial = true;\n        state.tutorialStep = 4;\n      }\n    }\n    \n    navigate(`/leads/${lead.id}`, { state });\n  };\n\n  const hasCustomFieldFilters =\n    Object.values(filtersState.customFields).some((value) => !isCustomFilterValueEmpty(value));\n  const hasAnyFilters = activeFilterCount > 0;\n  const hasStatusOnly =\n    filtersState.status.length > 0 && hasAnyFilters && !hasCustomFieldFilters;\n  const emptyStateMessage = hasStatusOnly\n    ? filtersState.status.length === 1\n      ? t(\"leads.noLeadsWithStatus\", { status: filtersState.status[0] })\n      : t(\"leads.noLeadsWithStatuses\", { statuses: filtersState.status.join(\", \") })\n    : hasAnyFilters\n    ? t(\"leads.noLeadsWithFilters\")\n    : t(\"leads.noLeadsAllStatuses\");\n\n  const emptyState = (\n    <div className=\"py-8 text-center text-muted-foreground\">\n      {emptyStateMessage}\n    </div>\n  );\n\n  const { totals, conversion: conversionMetrics, inactivity, closed } =\n    leadKpiMetrics;\n\n  const buildInfoLabel = (metricKey: string) =>\n    t('leads.kpis.infoLabel', {\n      metric: t(`leads.kpis.${metricKey}.title`),\n    });\n\n  const timeframeNew = t('leads.kpis.timeframes.newLast7Days');\n  const timeframe30 = t('leads.kpis.timeframes.recent30Days');\n  const timeframeInactive = t('leads.kpis.timeframes.inactive14Days');\n\n  return (\n    <div className=\"min-h-screen\">\n      <PageHeader\n        title={t('leads.title')}\n        subtitle={t('leads.description')}\n      >\n        <PageHeaderSearch>\n          <div className=\"flex items-center gap-2 w-full\">\n            <div className=\"flex-1 min-w-0\">\n              <GlobalSearch />\n            </div>\n            <Button \n              size=\"sm\"\n              onClick={() => setAddLeadDialogOpen(true)}\n              className=\"h-10 flex items-center gap-2 whitespace-nowrap flex-shrink-0 px-3 sm:px-4\"\n              data-testid=\"add-lead-button\"\n            >\n              <Plus className=\"h-4 w-4\" />\n              <span className=\"hidden sm:inline\">{t('leads.addLead')}</span>\n            </Button>\n          </div>\n        </PageHeaderSearch>\n      </PageHeader>\n      \n      <div className=\"space-y-6 p-4 sm:p-6\">\n        <section className=\"space-y-4\">\n          {(leadsInitialLoading || leadsTableLoading) ? (\n            <div className=\"grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-4\">\n              {Array.from({ length: 4 }).map((_, index) => (\n                <div\n                  key={index}\n                  className=\"h-full rounded-2xl border border-border/60 bg-muted/40 p-4 sm:p-5\"\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <Skeleton className=\"h-10 w-10 rounded-xl\" />\n                    <Skeleton className=\"h-4 w-16\" />\n                  </div>\n                  <div className=\"mt-6 space-y-3\">\n                    <Skeleton className=\"h-3 w-24\" />\n                    <Skeleton className=\"h-7 w-20\" />\n                    <Skeleton className=\"h-4 w-16\" />\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-4\">\n              <KpiCard\n                className=\"h-full\"\n                density=\"compact\"\n                icon={Users}\n                {...totalIconPreset}\n                subtitle={timeframeNew}\n                title={t('leads.kpis.totalLeads.title')}\n                value={formatNumber(totals.total)}\n                trend={{\n                  label: t('leads.kpis.totalLeads.trendLabel', {\n                    count: formatNumber(totals.newCurrent),\n                  }),\n                  value: totals.delta,\n                  direction: getTrendDirection(totals.delta),\n                  valueFormat: \"number\",\n                  showSign: true,\n                  ariaLabel: t('leads.kpis.totalLeads.trendAria', {\n                    delta: formatSignedNumber(totals.delta),\n                    current: formatNumber(totals.newCurrent),\n                    previous: formatNumber(totals.newPrevious),\n                  }),\n                }}\n                info={{\n                  content: t('leads.kpis.totalLeads.tooltip'),\n                  ariaLabel: buildInfoLabel('totalLeads'),\n                }}\n              />\n              <KpiCard\n                className=\"h-full\"\n                density=\"compact\"\n                icon={TrendingUp}\n                {...conversionIconPreset}\n                subtitle={timeframe30}\n                title={t('leads.kpis.conversionRate.title')}\n                value={formatPercent(conversionMetrics.currentRate)}\n                trend={{\n                  value: conversionMetrics.delta,\n                  direction: getTrendDirection(conversionMetrics.delta),\n                  valueFormat: \"percent\",\n                  decimals: 1,\n                  showSign: true,\n                  ariaLabel: t('leads.kpis.conversionRate.trendAria', {\n                    delta: formatSignedPercent(conversionMetrics.delta),\n                    current: formatPercent(conversionMetrics.currentRate),\n                    previous: formatPercent(conversionMetrics.previousRate),\n                  }),\n                }}\n                info={{\n                  content: t('leads.kpis.conversionRate.tooltip'),\n                  ariaLabel: buildInfoLabel('conversionRate'),\n                }}\n              />\n              <KpiCard\n                className=\"h-full\"\n                density=\"compact\"\n                icon={AlertCircle}\n                {...inactivityIconPreset}\n                subtitle={timeframeInactive}\n                title={t('leads.kpis.noActivity.title')}\n                value={formatNumber(inactivity.current)}\n                trend={{\n                  value: inactivity.delta,\n                  direction: getTrendDirection(inactivity.delta),\n                  valueFormat: \"number\",\n                  showSign: true,\n                  invert: true,\n                  ariaLabel: t('leads.kpis.noActivity.trendAria', {\n                    delta: formatSignedNumber(inactivity.delta),\n                    current: formatNumber(inactivity.current),\n                    previous: formatNumber(inactivity.previous),\n                  }),\n                }}\n                info={{\n                  content: t('leads.kpis.noActivity.tooltip'),\n                  ariaLabel: buildInfoLabel('noActivity'),\n                }}\n              />\n              <KpiCard\n                className=\"h-full\"\n                density=\"compact\"\n                icon={XCircle}\n                {...closedIconPreset}\n                subtitle={timeframe30}\n                title={t('leads.kpis.lost.title')}\n                value={formatNumber(closed.current)}\n                trend={{\n                  value: closed.delta,\n                  direction: getTrendDirection(closed.delta),\n                  valueFormat: \"number\",\n                  showSign: true,\n                  ariaLabel: t('leads.kpis.lost.trendAria', {\n                    delta: formatSignedNumber(closed.delta),\n                    current: formatNumber(closed.current),\n                    previous: formatNumber(closed.previous),\n                  }),\n                }}\n                info={{\n                  content: t('leads.kpis.lost.tooltip'),\n                  ariaLabel: buildInfoLabel('lost'),\n                }}\n              />\n            </div>\n          )}\n        </section>\n\n        <section>\n          {columnsLoading ? (\n            <TableLoadingSkeleton />\n          ) : (\n          <AdvancedDataTable\n              title={t('leads.tableTitle')}\n              data={paginatedLeads}\n              columns={advancedColumns}\n              rowKey={(lead) => lead.id}\n              onRowClick={handleRowClick}\n              isLoading={leadsTableLoading && page === 1 && paginatedLeads.length === 0}\n              loadingState={<TableLoadingSkeleton />}\n              filters={filtersConfig}\n              emptyState={emptyState}\n              sortState={sortState}\n              onSortChange={handleSortChange}\n              actions={exportActions}\n              summary={leadsHeaderSummary}\n              onLoadMore={hasMoreLeads ? handleLoadMoreLeads : undefined}\n              hasMore={hasMoreLeads}\n              isLoadingMore={isLoadingMoreLeads}\n            />\n          )}\n        </section>\n      </div>\n      \n      <EnhancedAddLeadDialog \n        onSuccess={() => refreshLeads()} \n        open={addLeadDialogOpen}\n        onOpenChange={handleAddLeadDialogChange}\n        onClose={() => handleAddLeadDialogChange(false)}\n      />\n\n      <OnboardingTutorial\n        steps={isSchedulingTutorial ? schedulingTutorialSteps : leadsTutorialSteps}\n        isVisible={showTutorial}\n        onComplete={handleTutorialComplete}\n        onExit={handleTutorialExit}\n        initialStepIndex={currentTutorialStep}\n      />\n    </div>\n  );\n};\n\nexport default AllLeadsNew;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/AllProjects.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/Analytics.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAnalyticsData'. Either include it or remove the dependency array.","line":59,"column":6,"nodeType":"ArrayExpression","endLine":59,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAnalyticsData]","fix":{"range":[1751,1753],"text":"[fetchAnalyticsData]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchSessionsPerDay' and 'loading'. Either include them or remove the dependency array.","line":65,"column":6,"nodeType":"ArrayExpression","endLine":65,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSessionsPerDay, loading, sessionDateMode]","fix":{"range":[1837,1854],"text":"[fetchSessionsPerDay, loading, sessionDateMode]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2060,2063],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2060,2063],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { toast } from \"@/hooks/use-toast\";\nimport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n} from \"@/components/ui/chart\";\nimport {\n  LineChart,\n  Line,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  ResponsiveContainer,\n  PieChart,\n  Pie,\n  Cell,\n  BarChart,\n  Bar,\n} from \"recharts\";\nimport { format, subDays, subMonths, startOfMonth, endOfMonth, eachDayOfInterval, eachMonthOfInterval, addDays } from \"date-fns\";\nimport { getDateFnsLocale } from \"@/lib/utils\";\nimport { ToggleGroup, ToggleGroupItem } from \"@/components/ui/toggle-group\";\nimport GlobalSearch from \"@/components/GlobalSearch\";\nimport { PageHeader, PageHeaderSearch } from \"@/components/ui/page-header\";\nimport { PageLoadingSkeleton } from \"@/components/ui/loading-presets\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface SessionsByDayData {\n  date: string;\n  sessions: number;\n}\n\ninterface SessionsByStatusData {\n  status: string;\n  count: number;\n  fill: string;\n}\n\ninterface LeadsByMonthData {\n  month: string;\n  leads: number;\n}\n\nconst Analytics = () => {\n  const { t } = useTranslation(\"pages\");\n  const [sessionsPerDay, setSessionsPerDay] = useState<SessionsByDayData[]>([]);\n  const [sessionsByStatus, setSessionsByStatus] = useState<SessionsByStatusData[]>([]);\n  const [leadsByMonth, setLeadsByMonth] = useState<LeadsByMonthData[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [sessionDateMode, setSessionDateMode] = useState<'scheduled' | 'created'>('scheduled');\n\n  useEffect(() => {\n    fetchAnalyticsData();\n  }, []);\n\n  useEffect(() => {\n    if (!loading) {\n      fetchSessionsPerDay();\n    }\n  }, [sessionDateMode]);\n\n  const fetchAnalyticsData = async () => {\n    try {\n      await Promise.all([\n        fetchSessionsPerDay(),\n        fetchSessionsByStatus(),\n        fetchLeadsByMonth(),\n      ]);\n    } catch (error: any) {\n      toast({\n        title: t(\"analytics.errorFetching\"),\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchSessionsPerDay = async () => {\n    const today = new Date();\n    \n    if (sessionDateMode === 'scheduled') {\n      // Next 30 days for scheduled sessions\n      const startDate = today;\n      const endDate = addDays(today, 29);\n\n      const { data, error } = await supabase\n        .from('sessions')\n        .select('session_date')\n        .gte('session_date', format(startDate, 'yyyy-MM-dd'))\n        .lte('session_date', format(endDate, 'yyyy-MM-dd'));\n\n      if (error) throw error;\n\n      // Create array of all days in the range\n      const days = eachDayOfInterval({ start: startDate, end: endDate });\n      \n      // Count sessions per day\n      const sessionCounts = days.map(day => {\n        const dayStr = format(day, 'yyyy-MM-dd');\n        const count = data?.filter(session => \n          session.session_date === dayStr\n        ).length || 0;\n        \n        return {\n          date: format(day, 'MMM dd'),\n          sessions: count\n        };\n      });\n\n      setSessionsPerDay(sessionCounts);\n    } else {\n      // Last 30 days for created sessions\n      const endDate = today;\n      const startDate = subDays(endDate, 29);\n\n      const { data, error } = await supabase\n        .from('sessions')\n        .select('created_at')\n        .gte('created_at', startDate.toISOString())\n        .lte('created_at', endDate.toISOString());\n\n      if (error) throw error;\n\n      // Create array of all days in the range\n      const days = eachDayOfInterval({ start: startDate, end: endDate });\n      \n      // Count sessions per day\n      const sessionCounts = days.map(day => {\n        const dayStr = format(day, 'yyyy-MM-dd');\n        const count = data?.filter(session => \n          format(new Date(session.created_at), 'yyyy-MM-dd') === dayStr\n        ).length || 0;\n        \n        return {\n          date: format(day, 'MMM dd'),\n          sessions: count\n        };\n      });\n\n      setSessionsPerDay(sessionCounts);\n    }\n  };\n\n  const fetchSessionsByStatus = async () => {\n    const { data, error } = await supabase\n      .from('sessions')\n      .select('status');\n\n    if (error) throw error;\n\n    const statusColors = {\n      planned: '#3b82f6',      // blue\n      completed: '#22c55e',    // green\n      cancelled: '#ef4444',    // red\n      delivered: '#8b5cf6',    // purple\n      in_post_processing: '#f59e0b' // amber\n    };\n\n    const statusCounts = data?.reduce((acc: Record<string, number>, session) => {\n      acc[session.status] = (acc[session.status] || 0) + 1;\n      return acc;\n    }, {}) || {};\n\n    const statusData = Object.entries(statusCounts).map(([status, count]) => ({\n      status: status === 'in_post_processing' ? 'In Post-Processing' : \n              status.charAt(0).toUpperCase() + status.slice(1),\n      count: count as number,\n      fill: statusColors[status as keyof typeof statusColors] || '#6b7280'\n    }));\n\n    setSessionsByStatus(statusData);\n  };\n\n  const fetchLeadsByMonth = async () => {\n    const endDate = new Date();\n    const startDate = subMonths(endDate, 5); // Last 6 months\n\n    const { data, error } = await supabase\n      .from('leads')\n      .select('created_at')\n      .gte('created_at', startOfMonth(startDate).toISOString())\n      .lte('created_at', endOfMonth(endDate).toISOString());\n\n    if (error) throw error;\n\n    // Create array of the last 6 months\n    const months = eachMonthOfInterval({ start: startDate, end: endDate });\n    \n    // Count leads per month\n    const leadCounts = months.map(month => {\n      const monthStart = startOfMonth(month);\n      const monthEnd = endOfMonth(month);\n      \n      const count = data?.filter(lead => {\n        const leadDate = new Date(lead.created_at);\n        return leadDate >= monthStart && leadDate <= monthEnd;\n      }).length || 0;\n      \n      return {\n        month: format(month, 'MMM', { locale: getDateFnsLocale() }),\n        leads: count\n      };\n    });\n\n    setLeadsByMonth(leadCounts);\n  };\n\n  const chartConfig = {\n    sessions: {\n      label: t(\"analytics.chartLabels.sessions\"),\n      color: \"#3b82f6\",\n    },\n    leads: {\n      label: t(\"analytics.chartLabels.leads\"),\n      color: \"#22c55e\",\n    },\n  };\n\n  return (\n    <div className=\"min-h-screen overflow-x-hidden\">\n      <PageHeader\n        title={t(\"analytics.title\")}\n        subtitle={t(\"analytics.subtitle\")}\n      >\n        <PageHeaderSearch>\n          <GlobalSearch />\n        </PageHeaderSearch>\n      </PageHeader>\n\n      <div className=\"p-4 sm:p-6 space-y-6\">\n        {loading ? (\n          <PageLoadingSkeleton />\n        ) : (\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            {/* Sessions per Day Chart */}\n            <Card>\n              <CardHeader className=\"flex flex-row items-start justify-between space-y-0 pb-2\">\n                <div className=\"space-y-1\">\n                  <CardTitle>{t(\"analytics.sessionsPerDay.title\")}</CardTitle>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {sessionDateMode === 'scheduled' \n                      ? t(\"analytics.sessionsPerDay.scheduled\")\n                      : t(\"analytics.sessionsPerDay.created\")\n                    }\n                  </p>\n                </div>\n                <ToggleGroup\n                  type=\"single\"\n                  value={sessionDateMode}\n                  onValueChange={(value) => value && setSessionDateMode(value as 'scheduled' | 'created')}\n                  className=\"border rounded-md\"\n                  size=\"sm\"\n                >\n                  <ToggleGroupItem value=\"scheduled\" className=\"text-xs px-3\">\n                    {t(\"analytics.toggle.scheduled\")}\n                  </ToggleGroupItem>\n                  <ToggleGroupItem value=\"created\" className=\"text-xs px-3\">\n                    {t(\"analytics.toggle.created\")}\n                  </ToggleGroupItem>\n                </ToggleGroup>\n              </CardHeader>\n              <CardContent>\n                <ChartContainer config={chartConfig} className=\"h-[300px]\">\n                  <LineChart data={sessionsPerDay}>\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis \n                      dataKey=\"date\" \n                      tick={{ fontSize: 12 }}\n                      interval=\"preserveStartEnd\"\n                    />\n                    <YAxis />\n                    <ChartTooltip content={<ChartTooltipContent />} />\n                    <Line \n                      type=\"monotone\" \n                      dataKey=\"sessions\" \n                      stroke={chartConfig.sessions.color}\n                      strokeWidth={2}\n                      dot={{ fill: chartConfig.sessions.color, strokeWidth: 2, r: 4 }}\n                    />\n                  </LineChart>\n                </ChartContainer>\n              </CardContent>\n            </Card>\n\n            {/* Sessions by Status Chart */}\n        <Card>\n          <CardHeader>\n            <CardTitle>{t(\"analytics.sessionsByStatus.title\")}</CardTitle>\n          </CardHeader>\n              <CardContent>\n                <ChartContainer config={chartConfig} className=\"h-[300px]\">\n                  <PieChart>\n                    <Pie\n                      data={sessionsByStatus}\n                      cx=\"50%\"\n                      cy=\"50%\"\n                      labelLine={false}\n                      label={({ status, count, percent }) => \n                        `${status}: ${count} (${(percent * 100).toFixed(1)}%)`\n                      }\n                      outerRadius={80}\n                      fill=\"#8884d8\"\n                      dataKey=\"count\"\n                    >\n                      {sessionsByStatus.map((entry, index) => (\n                        <Cell key={`cell-${index}`} fill={entry.fill} />\n                      ))}\n                    </Pie>\n                    <ChartTooltip content={<ChartTooltipContent />} />\n                  </PieChart>\n                </ChartContainer>\n              </CardContent>\n            </Card>\n\n            {/* New Leads per Month Chart */}\n            <Card className=\"lg:col-span-2\">\n              <CardHeader>\n                <CardTitle>{t(\"analytics.leadsByMonth.title\")}</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <ChartContainer config={chartConfig} className=\"h-[300px]\">\n                  <BarChart data={leadsByMonth}>\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis dataKey=\"month\" />\n                    <YAxis />\n                    <ChartTooltip content={<ChartTooltipContent />} />\n                    <Bar \n                      dataKey=\"leads\" \n                      fill={chartConfig.leads.color}\n                      radius={[4, 4, 0, 0]}\n                    />\n                  </BarChart>\n                </ChartContainer>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Analytics;","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/Auth.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":188,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7103,7106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7103,7106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":212,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7753,7756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7753,7756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":244,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":244,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8642,8645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8642,8645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Eye, EyeOff, ChevronLeft, ChevronRight, CheckCircle2, Circle } from \"lucide-react\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\nimport { useFormsTranslation, useMessagesTranslation } from \"@/hooks/useTypedTranslation\";\nimport { useI18nToast } from \"@/lib/toastHelpers\";\nimport { useTranslation } from \"react-i18next\";\n\nconst normalizeAuthPath = (pathname: string) => {\n  const trimmed = pathname.endsWith(\"/\") && pathname !== \"/\" ? pathname.slice(0, -1) : pathname;\n  return trimmed.toLowerCase();\n};\n\nconst getModeFromLocation = (pathname: string, search: string): \"signin\" | \"signup\" => {\n  const params = new URLSearchParams(search);\n  const queryMode = (params.get(\"view\") || params.get(\"mode\") || \"\").toLowerCase();\n\n  if (queryMode === \"signup\" || queryMode === \"sign-up\") return \"signup\";\n  if (queryMode === \"signin\" || queryMode === \"sign-in\" || queryMode === \"login\") return \"signin\";\n\n  const normalized = normalizeAuthPath(pathname || \"\");\n  if (normalized.endsWith(\"/auth/signup\") || normalized.endsWith(\"/auth/sign-up\")) {\n    return \"signup\";\n  }\n\n  return \"signin\";\n};\n\nconst Auth = () => {\n  const location = useLocation();\n  const navigate = useNavigate();\n  const { user } = useAuth();\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [isSignUp, setIsSignUp] = useState(() => getModeFromLocation(location.pathname, location.search) === \"signup\");\n  const [loading, setLoading] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n  const [isPasswordResetMode, setIsPasswordResetMode] = useState(false);\n  const [isPasswordResetRequestMode, setIsPasswordResetRequestMode] = useState(false);\n  const [newPassword, setNewPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [resettingPassword, setResettingPassword] = useState(false);\n  const [updatingPassword, setUpdatingPassword] = useState(false);\n  const [activeFeatureIndex, setActiveFeatureIndex] = useState(0);\n  const [progress, setProgress] = useState(0);\n  const [prevFeatureIndex, setPrevFeatureIndex] = useState<number | null>(null);\n  const { t: tForm } = useFormsTranslation();\n  const { t: tMsg } = useMessagesTranslation();\n  const { t: tPages } = useTranslation('pages');\n  const { t: tCommon } = useTranslation('common');\n  const toast = useI18nToast();\n\n  // Password strength helpers (sign-up only UI)\n  const getPasswordStrength = (pwd: string) => {\n    let score = 0;\n    if (pwd.length >= 8) score++;\n    if (/[A-Z]/.test(pwd)) score++;\n    if (/[a-z]/.test(pwd)) score++;\n    if (/[0-9]/.test(pwd)) score++;\n    if (/[^A-Za-z0-9]/.test(pwd)) score++;\n    if (pwd.length >= 12) score++;\n    const percent = Math.min(100, Math.round((score / 6) * 100));\n    let color = \"bg-red-500\";\n    let label: 'weak' | 'fair' | 'good' | 'strong' = 'weak';\n    if (percent >= 66) { color = 'bg-emerald-500'; label = 'strong'; }\n    else if (percent >= 50) { color = 'bg-yellow-500'; label = 'good'; }\n    else if (percent >= 33) { color = 'bg-orange-500'; label = 'fair'; }\n    return { percent, color, label };\n  };\n  const pwdStrength = getPasswordStrength(password);\n  const resetPwdStrength = getPasswordStrength(newPassword);\n\n  useEffect(() => {\n    const derivedMode = (isPasswordResetMode || isPasswordResetRequestMode)\n      ? \"signin\"\n      : getModeFromLocation(location.pathname, location.search);\n    const shouldSignUp = derivedMode === \"signup\";\n\n    setIsSignUp((prev) => (prev === shouldSignUp ? prev : shouldSignUp));\n  }, [location.pathname, location.search, isPasswordResetMode, isPasswordResetRequestMode]);\n\n  // Redirect if already logged in\n  useEffect(() => {\n    if (user) {\n      navigate(\"/\");\n    }\n  }, [user, navigate]);\n\n  const clearAuthState = () => {\n    // Clear all auth related storage\n    Object.keys(localStorage).forEach((key) => {\n      if (key.startsWith('supabase.auth.') || key.includes('sb-')) {\n        localStorage.removeItem(key);\n      }\n    });\n  };\n\n  const featureSlides = [\n    {\n      title: tPages('auth.features.0.title', 'Streamline every client interaction'),\n      description: tPages(\n        'auth.features.0.description',\n        'Centralize your communication, notes, and deal status in one intuitive workspace designed for modern agencies.'\n      ),\n    },\n    {\n      title: tPages('auth.features.1.title', 'Forecast revenue with confidence'),\n      description: tPages(\n        'auth.features.1.description',\n        \"Track conversion insights, build predictable pipelines, and unlock powerful reporting without leaving Lumiso.\"\n      ),\n    },\n    {\n      title: tPages('auth.features.2.title', 'Automate onboarding with ease'),\n      description: tPages(\n        'auth.features.2.description',\n        'Launch tailored workflows, automate reminders, and deliver delightful client experiences from day one.'\n      ),\n    },\n  ];\n\n  // Animate progress for feature slides and auto-advance\n  useEffect(() => {\n    const SLIDE_DURATION = 7000; // At least 5s per image\n    const start = Date.now();\n    setProgress(0);\n\n    const interval = window.setInterval(() => {\n      const elapsed = Date.now() - start;\n      const pct = Math.min((elapsed / SLIDE_DURATION) * 100, 100);\n      setProgress(pct);\n      if (pct >= 100) {\n        window.clearInterval(interval);\n        setPrevFeatureIndex(activeFeatureIndex);\n        setActiveFeatureIndex((prev) => (prev + 1) % featureSlides.length);\n      }\n    }, 50);\n\n    return () => window.clearInterval(interval);\n  }, [activeFeatureIndex, featureSlides.length]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      // Always clear previous state first\n      clearAuthState();\n      await supabase.auth.signOut({ scope: 'global' });\n\n      if (isSignUp) {\n        const { data, error } = await supabase.auth.signUp({\n          email,\n          password,\n          options: {\n            emailRedirectTo: `${window.location.origin}/`\n          }\n        });\n\n        if (error) throw error;\n\n        if (data.user && !data.user.email_confirmed_at) {\n          toast.success(tMsg('auth.email_confirmation'));\n          setLoading(false);\n        } else if (data.user) {\n          toast.success(tMsg('auth.account_created'));\n          // Navigate to home\n          setTimeout(() => navigate(\"/\"), 1000);\n        }\n      } else {\n        const { data, error } = await supabase.auth.signInWithPassword({\n          email,\n          password,\n        });\n\n        if (error) throw error;\n\n        console.log(\"Sign in successful:\", data.user?.id);\n        toast.success(tMsg('auth.signed_in'));\n        \n        // Navigate to home\n        setTimeout(() => navigate(\"/\"), 1000);\n      }\n    } catch (error: any) {\n      console.error(\"Auth error:\", error);\n      toast.error(error.message || tMsg('auth.auth_error'));\n      setLoading(false);\n    }\n  };\n\n  const handlePasswordResetRequest = async (event?: React.FormEvent) => {\n    event?.preventDefault();\n\n    if (!email) {\n      toast.error(tMsg('auth.reset_email_missing'));\n      return;\n    }\n\n    setResettingPassword(true);\n    try {\n      const { error } = await supabase.auth.resetPasswordForEmail(email, {\n        redirectTo: `${window.location.origin}/auth/signin?type=recovery`,\n      });\n\n      if (error) throw error;\n\n      toast.success(tMsg('auth.reset_email_sent'));\n    } catch (error: any) {\n      console.error(\"Reset password error:\", error);\n      toast.error(error.message || tMsg('auth.reset_email_error'));\n    } finally {\n      setResettingPassword(false);\n    }\n  };\n\n  const handlePasswordUpdate = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (newPassword.length < 8) {\n      toast.error(tMsg('auth.password_too_short'));\n      return;\n    }\n\n    if (newPassword !== confirmPassword) {\n      toast.error(tMsg('auth.password_mismatch'));\n      return;\n    }\n\n    setUpdatingPassword(true);\n    try {\n      const { error } = await supabase.auth.updateUser({ password: newPassword });\n      if (error) throw error;\n\n      toast.success(tMsg('auth.password_updated'));\n      setIsPasswordResetMode(false);\n      setNewPassword(\"\");\n      setConfirmPassword(\"\");\n      setPassword(\"\");\n      setTimeout(() => navigate(\"/\"), 1000);\n    } catch (error: any) {\n      console.error(\"Password update error:\", error);\n      toast.error(error.message || tMsg('auth.password_update_error'));\n    } finally {\n      setUpdatingPassword(false);\n    }\n  };\n\n  useEffect(() => {\n    const hashParams = new URLSearchParams(location.hash.replace(/^#/, \"\"));\n    const searchParams = new URLSearchParams(location.search);\n\n    if (hashParams.get(\"type\") === \"recovery\" || searchParams.get(\"type\") === \"recovery\") {\n      if (getModeFromLocation(location.pathname, location.search) === \"signup\") {\n        navigate(\"/auth/signin\", { replace: true });\n      }\n      setIsSignUp(false);\n      setIsPasswordResetRequestMode(false);\n      setIsPasswordResetMode(true);\n      setShowPassword(false);\n    }\n  }, [location, navigate]);\n\n  const authLabel = isPasswordResetMode\n    ? tForm('auth.password_reset.title')\n    : isPasswordResetRequestMode\n    ? tForm('auth.password_reset.request_title')\n    : isSignUp\n    ? tForm('auth.sign_up.title')\n    : tForm('auth.sign_in.title');\n\n  const welcomeText = isPasswordResetMode\n    ? tPages('auth.welcome.recovery', 'Reset your password ðŸ”')\n    : isPasswordResetRequestMode\n    ? tPages('auth.welcome.recoveryRequest', 'Reset your password ðŸ”')\n    : isSignUp\n    ? tPages('auth.welcome.signUp', \"Let's get started ðŸš€\")\n    : tPages('auth.welcome.signIn', 'Welcome back ðŸ‘‹ðŸ»');\n\n  const copyText = isPasswordResetMode\n    ? tPages('auth.copy.recovery', 'Set a new password to regain access to your workspace.')\n    : isPasswordResetRequestMode\n    ? tPages('auth.copy.recoveryRequest', \"We'll email you a secure link so you can choose a new password.\")\n    : isSignUp\n    ? tPages('auth.copy.signUp', 'Create your Lumiso account to unlock collaborative workflows and beautiful client experiences.')\n    : tPages('auth.copy.signIn', 'Sign in with your credentials to pick up exactly where your team left off.');\n\n  const viewKey = isPasswordResetMode\n    ? 'reset-update'\n    : isPasswordResetRequestMode\n    ? 'reset-request'\n    : isSignUp\n    ? 'signup'\n    : 'signin';\n\n  return (\n    <div className=\"flex min-h-screen w-full bg-white\">\n      <div className=\"relative flex min-h-screen w-full flex-col overflow-hidden lg:flex-row\">\n        <div className=\"relative flex w-full flex-col px-6 py-8 sm:px-10 lg:w-1/2 lg:px-12\">\n          <div className=\"absolute inset-x-0 top-0 h-24 bg-gradient-to-br from-primary/10 via-white to-transparent\" aria-hidden=\"true\" />\n\n          {/* Logo pinned to top-left */}\n          <div className=\"absolute left-6 top-6 sm:left-10\">\n            <img src=\"/lumiso-logo.png\" alt={tCommon('branding.app_name', 'Lumiso')} className=\"h-10 w-auto\" loading=\"eager\" />\n          </div>\n\n          {/* Centered form area */}\n          <div className=\"flex flex-1 items-center pt-24 sm:pt-16 lg:pt-0\">\n            <div key={viewKey} className=\"relative mx-auto w-full max-w-md fade-in-up\">\n              <div className=\"mb-8 space-y-3\">\n                <div className=\"inline-flex items-center rounded-full bg-primary/10 px-3 py-1.5 text-xs font-medium text-primary\">\n                  {authLabel}\n                </div>\n                <h1 className=\"text-3xl font-semibold text-slate-900 sm:text-4xl\">\n                  {welcomeText}\n                </h1>\n                <p className=\"text-base text-slate-500\">{copyText}</p>\n              </div>\n\n              {isPasswordResetMode ? (\n                <form onSubmit={handlePasswordUpdate} className=\"space-y-6\">\n                  <p className=\"text-sm text-slate-500\">{tForm('auth.password_reset.instructions')}</p>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"new-password\" className=\"text-sm font-medium text-slate-600\">\n                      {tForm('labels.password')}\n                    </Label>\n                    <div className=\"relative\">\n                      <Input\n                        id=\"new-password\"\n                        type={showPassword ? \"text\" : \"password\"}\n                        placeholder={tForm('placeholders.enter_password')}\n                        value={newPassword}\n                        onChange={(e) => setNewPassword(e.target.value)}\n                        required\n                        disabled={updatingPassword}\n                        className=\"h-12 rounded-xl border-slate-200 bg-slate-50/60 px-4 pr-12 text-base shadow-inner transition focus:border-primary/60 focus:bg-white focus:ring-2 focus:ring-primary/20\"\n                      />\n                      <Button\n                        type=\"button\"\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"absolute inset-y-0 right-1 my-1 flex h-10 w-10 items-center justify-center rounded-lg text-slate-400 hover:bg-primary/10 hover:text-primary\"\n                        onClick={() => setShowPassword(!showPassword)}\n                        disabled={updatingPassword}\n                      >\n                        {showPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\n                      </Button>\n                    </div>\n                    <div className=\"mt-2\">\n                      <div\n                        className=\"h-1.5 w-full overflow-hidden rounded-full bg-slate-200/70\"\n                        role=\"progressbar\"\n                        aria-valuemin={0}\n                        aria-valuemax={100}\n                        aria-valuenow={resetPwdStrength.percent}\n                        aria-label={tForm('password_tips.strength', 'Password strength')}\n                      >\n                        <div\n                          className={`h-full rounded-full transition-[width,background-color] duration-300 ease-out ${resetPwdStrength.color}`}\n                          style={{ width: `${resetPwdStrength.percent}%` }}\n                        />\n                      </div>\n                      <div className=\"mt-1 flex justify-between text-[10px] text-slate-500\">\n                        <span>{tForm('password_tips.strength', 'Password strength')}</span>\n                        <span>\n                          {resetPwdStrength.label === 'weak' && tForm('password_tips.weak', 'Weak')}\n                          {resetPwdStrength.label === 'fair' && tForm('password_tips.fair', 'Fair')}\n                          {resetPwdStrength.label === 'good' && tForm('password_tips.good', 'Good')}\n                          {resetPwdStrength.label === 'strong' && tForm('password_tips.strong', 'Strong')}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"confirm-password\" className=\"text-sm font-medium text-slate-600\">\n                      {tForm('labels.confirm_password')}\n                    </Label>\n                    <Input\n                      id=\"confirm-password\"\n                      type=\"password\"\n                      placeholder={tForm('placeholders.confirm_password')}\n                      value={confirmPassword}\n                      onChange={(e) => setConfirmPassword(e.target.value)}\n                      required\n                      disabled={updatingPassword}\n                      className=\"h-12 rounded-xl border-slate-200 bg-slate-50/60 px-4 text-base shadow-inner transition focus:border-primary/60 focus:bg-white focus:ring-2 focus:ring-primary/20\"\n                    />\n                  </div>\n                  <Button\n                    type=\"submit\"\n                    className=\"group flex h-12 w-full items-center justify-center rounded-xl bg-primary text-base font-semibold text-white shadow-lg shadow-primary/20 transition hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/30\"\n                    disabled={updatingPassword}\n                  >\n                    {updatingPassword ? `${tMsg('info.loading')}...` : tForm('auth.password_reset.button')}\n                  </Button>\n                </form>\n              ) : isPasswordResetRequestMode ? (\n                <form onSubmit={handlePasswordResetRequest} className=\"space-y-6\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"reset-email\" className=\"text-sm font-medium text-slate-600\">\n                      {tForm('labels.email')}\n                    </Label>\n                    <Input\n                      id=\"reset-email\"\n                      type=\"email\"\n                      placeholder={tForm('placeholders.enter_email')}\n                      value={email}\n                      onChange={(e) => setEmail(e.target.value)}\n                      required\n                      disabled={resettingPassword}\n                      className=\"h-12 rounded-xl border-slate-200 bg-slate-50/60 px-4 text-base shadow-inner transition focus:border-primary/60 focus:bg-white focus:ring-2 focus:ring-primary/20\"\n                    />\n                  </div>\n                  <Button\n                    type=\"submit\"\n                    className=\"group flex h-12 w-full items-center justify-center rounded-xl bg-primary text-base font-semibold text-white shadow-lg shadow-primary/20 transition hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/30\"\n                    disabled={resettingPassword}\n                  >\n                    {resettingPassword ? `${tMsg('info.loading')}...` : tForm('auth.password_reset.request_button', 'Send reset link')}\n                  </Button>\n                </form>\n              ) : (\n                <>\n                  <form onSubmit={handleSubmit} className=\"space-y-6\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"email\" className=\"text-sm font-medium text-slate-600\">\n                        {tForm('labels.email')}\n                      </Label>\n                      <Input\n                        id=\"email\"\n                        type=\"email\"\n                        placeholder={tForm('placeholders.enter_email')}\n                        value={email}\n                        onChange={(e) => setEmail(e.target.value)}\n                        required\n                        disabled={loading}\n                        className=\"h-12 rounded-xl border-slate-200 bg-slate-50/60 px-4 text-base shadow-inner transition focus:border-primary/60 focus:bg-white focus:ring-2 focus:ring-primary/20\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"password\" className=\"text-sm font-medium text-slate-600\">\n                        {tForm('labels.password')}\n                      </Label>\n                      <div className=\"relative\">\n                        <Input\n                          id=\"password\"\n                          type={showPassword ? \"text\" : \"password\"}\n                          placeholder={tForm('placeholders.enter_password')}\n                          value={password}\n                          onChange={(e) => setPassword(e.target.value)}\n                          required\n                          disabled={loading}\n                          className=\"h-12 rounded-xl border-slate-200 bg-slate-50/60 px-4 pr-12 text-base shadow-inner transition focus:border-primary/60 focus:bg-white focus:ring-2 focus:ring-primary/20\"\n                        />\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"absolute inset-y-0 right-1 my-1 flex h-10 w-10 items-center justify-center rounded-lg text-slate-400 hover:bg-primary/10 hover:text-primary\"\n                          onClick={() => setShowPassword(!showPassword)}\n                          disabled={loading}\n                        >\n                          {showPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\n                        </Button>\n                      </div>\n                      {!isSignUp && (\n                        <div className=\"flex justify-end pt-1\">\n                          <Button\n                            type=\"button\"\n                            variant=\"link\"\n                            onClick={() => {\n                              setIsSignUp(false);\n                              setIsPasswordResetMode(false);\n                              setIsPasswordResetRequestMode(true);\n                              setShowPassword(false);\n                              navigate(\"/auth/signin\");\n                            }}\n                            disabled={loading}\n                            className=\"px-0 text-sm font-semibold text-primary hover:text-primary/80\"\n                          >\n                            {tForm('auth.sign_in.forgot_password')}\n                          </Button>\n                        </div>\n                      )}\n                      {isSignUp && (\n                        <div className=\"mt-2\">\n                          <div\n                            className=\"h-1.5 w-full overflow-hidden rounded-full bg-slate-200/70\"\n                            role=\"progressbar\"\n                            aria-valuemin={0}\n                            aria-valuemax={100}\n                            aria-valuenow={pwdStrength.percent}\n                            aria-label={tForm('password_tips.strength', 'Password strength')}\n                          >\n                            <div\n                              className={`h-full rounded-full transition-[width,background-color] duration-300 ease-out ${pwdStrength.color}`}\n                              style={{ width: `${pwdStrength.percent}%` }}\n                            />\n                          </div>\n                          <div className=\"mt-1 flex justify-between text-[10px] text-slate-500\">\n                            <span>{tForm('password_tips.strength', 'Password strength')}</span>\n                            <span>\n                              {pwdStrength.label === 'weak' && tForm('password_tips.weak', 'Weak')}\n                              {pwdStrength.label === 'fair' && tForm('password_tips.fair', 'Fair')}\n                              {pwdStrength.label === 'good' && tForm('password_tips.good', 'Good')}\n                              {pwdStrength.label === 'strong' && tForm('password_tips.strong', 'Strong')}\n                            </span>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                    {/* Password recommendations (optional, sign-up only) */}\n                    {isSignUp && (\n                      <div className=\"mt-3\">\n                        <p className=\"mb-1 text-xs font-medium text-slate-500\">{tForm('password_tips.title', 'For a stronger password')}</p>\n                        <div className=\"grid grid-cols-1 gap-1 text-xs text-slate-500\">\n                          {[\n                            { key: 'length', label: tForm('password_tips.eight_chars', 'At least 8 characters'), valid: password.length >= 8 },\n                            { key: 'uppercase', label: tForm('password_tips.uppercase', 'At least 1 uppercase letter'), valid: /[A-Z]/.test(password) },\n                            { key: 'special', label: tForm('password_tips.special', 'At least 1 special character'), valid: /[^A-Za-z0-9]/.test(password) },\n                          ].map((item) => (\n                            <div key={item.key} className=\"flex items-center gap-2\">\n                              {item.valid ? (\n                                <CheckCircle2 className=\"h-4 w-4 text-emerald-500\" />\n                              ) : (\n                                <Circle className=\"h-4 w-4 text-slate-300\" />\n                              )}\n                              <span>{item.label}</span>\n                            </div>\n                          ))}\n                        </div>\n                        <p className=\"mt-1 text-[10px] text-slate-400\">{tForm('password_tips.optional', 'Optional recommendations, not required')}</p>\n                      </div>\n                    )}\n                    <Button\n                      type=\"submit\"\n                      className=\"group flex h-12 w-full items-center justify-center rounded-xl bg-primary text-base font-semibold text-white shadow-lg shadow-primary/20 transition hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/30\"\n                      disabled={loading}\n                    >\n                      {loading\n                        ? `${tMsg('info.loading')}...`\n                        : isSignUp\n                        ? tForm('auth.sign_up.button')\n                        : tForm('auth.sign_in.button')}\n                    </Button>\n                  </form>\n\n                  <div className=\"mt-8 flex flex-wrap items-center gap-x-2 text-sm text-slate-500\">\n                    <span>\n                      {isSignUp\n                        ? tPages('auth.toggle.existingAccount', 'Already have an account?')\n                        : tPages('auth.toggle.newToBrand', { brand: tCommon('branding.app_name', 'Lumiso') })}\n                    </span>\n                    <Button\n                      variant=\"link\"\n                      onClick={() => {\n                        const nextIsSignUp = !isSignUp;\n                        setIsSignUp(nextIsSignUp);\n                        setIsPasswordResetMode(false);\n                        setIsPasswordResetRequestMode(false);\n                        setShowPassword(false);\n                        navigate(nextIsSignUp ? \"/auth/signup\" : \"/auth/signin\");\n                      }}\n                      disabled={loading}\n                      className=\"px-0 text-sm font-semibold text-primary hover:text-primary/80\"\n                    >\n                      {isSignUp ? tForm('auth.sign_in.button') : tForm('auth.sign_up.button')}\n                    </Button>\n                  </div>\n                </>\n              )}\n              {(isPasswordResetMode || isPasswordResetRequestMode) && (\n                <div className=\"mt-8 flex flex-wrap items-center gap-x-2 text-sm text-slate-500\">\n                  <Button\n                    variant=\"link\"\n                    onClick={() => {\n                      setIsPasswordResetRequestMode(false);\n                      setIsPasswordResetMode(false);\n                      setNewPassword(\"\");\n                      setConfirmPassword(\"\");\n                      setShowPassword(false);\n                      setIsSignUp(false);\n                      navigate(\"/auth/signin\");\n                    }}\n                    disabled={updatingPassword || resettingPassword}\n                    className=\"px-0 text-sm font-semibold text-primary hover:text-primary/80\"\n                  >\n                    {tForm('auth.password_reset.back_to_sign_in')}\n                  </Button>\n                </div>\n              )}\n            </div>\n          </div>\n\n          <div className=\"absolute bottom-6 left-6 hidden text-xs text-slate-400 sm:flex\">\n            <span>Â© {new Date().getFullYear()} {tCommon('branding.app_name', 'Lumiso')}. {tCommon('legal.all_rights_reserved', 'All rights reserved.')}</span>\n          </div>\n        </div>\n\n        <div className=\"relative hidden min-h-full flex-1 flex-col justify-between overflow-hidden bg-slate-900 text-white lg:flex\">\n          {/* Aurora gradient background with floating blobs */}\n          <div className=\"pointer-events-none absolute inset-0 overflow-hidden\" aria-hidden=\"true\">\n            <div className=\"absolute -inset-24 opacity-80 blur-3xl aurora-bg\" />\n            <div className=\"absolute -bottom-20 left-10 h-72 w-72 rounded-full bg-emerald-400/25 blur-3xl float-slow\" />\n            <div className=\"absolute top-16 right-10 h-80 w-80 rounded-full bg-cyan-400/25 blur-3xl float-slow [animation-delay:1.2s]\" />\n            <div className=\"absolute -top-10 left-1/2 h-64 w-64 -translate-x-1/2 rounded-full bg-fuchsia-400/15 blur-3xl float-slow [animation-delay:2.4s]\" />\n          </div>\n\n          <div className=\"relative flex flex-1 flex-col px-12 py-14\">\n            <div className=\"mb-12 flex flex-col gap-3\">\n              <span className=\"w-fit rounded-full bg-white/15 px-4 py-1 text-sm font-medium text-white/85 backdrop-blur\">\n                {tPages('auth.platformHighlights', 'Platform highlights')}\n              </span>\n              <div className=\"relative h-[96px] max-w-xl\">\n                {featureSlides.map((slide, index) => (\n                  <div\n                    key={`title-${index}`}\n                    className={`absolute inset-0 transition-all duration-700 ${\n                      index === activeFeatureIndex\n                        ? 'opacity-100 translate-y-0'\n                        : 'pointer-events-none opacity-0 translate-y-3'\n                    }`}\n                  >\n                    <h2 className=\"text-3xl font-semibold leading-tight fade-in-up\">\n                      {slide.title}\n                    </h2>\n                    <p className=\"mt-2 max-w-xl text-base text-white/80\">\n                      {slide.description}\n                    </p>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            <div className=\"relative mt-auto flex flex-1 items-center\">\n              <div key={activeFeatureIndex} className=\"relative w-full transition-transform duration-700 will-change-transform fade-in-up\">\n                <img\n                  src=\"/placeholder.svg\"\n                  alt=\"Showcase placeholder\"\n                  className=\"h-[520px] w-full rounded-[28px] object-cover\"\n                  loading=\"lazy\"\n                />\n              </div>\n            </div>\n          </div>\n\n          <div className=\"relative flex items-center justify-between px-12 pb-10\">\n            <div className=\"flex items-center gap-3\">\n              <button\n                type=\"button\"\n                onClick={() => {\n                  setPrevFeatureIndex(activeFeatureIndex);\n                  setActiveFeatureIndex((prev) => (prev - 1 + featureSlides.length) % featureSlides.length);\n                }}\n                className=\"flex h-8 w-8 items-center justify-center rounded-full border border-white/20 text-white/80 hover:bg-white/10 hover:text-white transition\"\n                aria-label={tPages('auth.controls.prev', 'Previous feature')}\n              >\n                <ChevronLeft className=\"h-4 w-4\" />\n              </button>\n              {featureSlides.map((_, index) => {\n                const segmentPct = index < activeFeatureIndex ? 100 : index === activeFeatureIndex ? progress : 0;\n                return (\n                  <button\n                    key={index}\n                    type=\"button\"\n                    onClick={() => {\n                      setPrevFeatureIndex(activeFeatureIndex);\n                      setActiveFeatureIndex(index);\n                    }}\n                    className=\"group relative h-2 w-24 overflow-hidden rounded-full bg-white/25\"\n                    aria-label={tPages('auth.controls.showFeature', { index: index + 1, defaultValue: `Show feature ${index + 1}` }) as string}\n                  >\n                    <span\n                      className=\"absolute left-0 top-0 h-full bg-white transition-[width] duration-100 ease-linear\"\n                      style={{ width: `${segmentPct}%` }}\n                    />\n                    <span className=\"sr-only\">{tPages('auth.controls.progress', { index: index + 1, defaultValue: `Progress for feature ${index + 1}` }) as string}</span>\n                  </button>\n                );\n              })}\n              <button\n                type=\"button\"\n                onClick={() => {\n                  setPrevFeatureIndex(activeFeatureIndex);\n                  setActiveFeatureIndex((prev) => (prev + 1) % featureSlides.length);\n                }}\n                className=\"flex h-8 w-8 items-center justify-center rounded-full border border-white/20 text-white/80 hover:bg-white/10 hover:text-white transition\"\n                aria-label={tPages('auth.controls.next', 'Next feature')}\n              >\n                <ChevronRight className=\"h-4 w-4\" />\n              </button>\n            </div>\n            <span className=\"text-sm font-medium text-white/80\">\n              {String(activeFeatureIndex + 1).padStart(2, \"0\")} / {String(featureSlides.length).padStart(2, \"0\")}\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Auth;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/Calendar.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'startQueryTiming'. Either include it or remove the dependency array.","line":121,"column":6,"nodeType":"ArrayExpression","endLine":121,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [startQueryTiming]","fix":{"range":[4323,4325],"text":"[startQueryTiming]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":141,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4741,4744],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4741,4744],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo, useEffect, useCallback } from \"react\";\nimport { useQueryClient } from \"@tanstack/react-query\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\nimport { ProjectSheetView } from \"@/components/ProjectSheetView\";\nimport { formatDate, formatTime, getUserLocale } from \"@/lib/utils\";\nimport { isToday } from \"date-fns\";\nimport {\n  PageHeader,\n  PageHeaderSearch,\n  PageHeaderActions,\n} from \"@/components/ui/page-header\";\nimport SessionSheetView from \"@/components/SessionSheetView\";\nimport { useOptimizedCalendarData } from \"@/hooks/useOptimizedCalendarData\";\nimport { useOptimizedCalendarEvents } from \"@/hooks/useOptimizedCalendarEvents\";\nimport { CalendarErrorWrapper } from \"@/components/calendar/CalendarErrorBoundary\";\nimport {\n  CalendarSkeleton,\n  CalendarWeekSkeleton,\n  CalendarDaySkeleton,\n} from \"@/components/calendar/CalendarSkeleton\";\nimport { CalendarWeek } from \"@/components/calendar/CalendarWeek\";\nimport { CalendarMonthView } from \"@/components/calendar/CalendarMonthView\";\nimport { CalendarDayView } from \"@/components/calendar/CalendarDayView\";\nimport { useOptimizedCalendarViewport } from \"@/hooks/useOptimizedCalendarViewport\";\nimport { useOptimizedCalendarNavigation } from \"@/hooks/useOptimizedCalendarNavigation\";\nimport { useOptimizedTouchHandlers } from \"@/hooks/useOptimizedTouchHandlers\";\nimport { useCalendarPerformanceMonitor } from \"@/hooks/useCalendarPerformanceMonitor\";\nimport { useOrganizationSettings } from \"@/hooks/useOrganizationSettings\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useTranslation } from \"react-i18next\";\nimport { useThrottledRefetchOnFocus } from \"@/hooks/useThrottledRefetchOnFocus\";\nimport { SegmentedControl } from \"@/components/ui/segmented-control\";\n\ntype ViewMode = \"day\" | \"week\" | \"month\";\n\ninterface Session {\n  id: string;\n  session_date: string;\n  session_time: string;\n  status: string;\n  notes?: string;\n  lead_id: string;\n  project_id?: string | null;\n}\n\ninterface Activity {\n  id: string;\n  content: string;\n  reminder_date: string;\n  reminder_time?: string;\n  type: string;\n  lead_id: string;\n  project_id?: string | null;\n  completed?: boolean;\n}\n\nexport default function Calendar() {\n  const [currentDate, setCurrentDate] = useState(new Date());\n  const [viewMode, setViewMode] = useState<ViewMode>(() => {\n    // Default to 'day' on mobile, 'month' on desktop\n    const saved = localStorage.getItem(\"calendar:viewMode\") as ViewMode;\n    if (saved) return saved;\n    return window.innerWidth <= 768 ? \"day\" : \"month\";\n  });\n  const { t } = useTranslation(\"pages\");\n\n  const location = useLocation();\n  const viewModeOptions = useMemo(\n    () => [\n      { value: \"day\", label: t(\"calendar.viewModes.day\") },\n      { value: \"week\", label: t(\"calendar.viewModes.week\") },\n      { value: \"month\", label: t(\"calendar.viewModes.month\") },\n    ],\n    [t],\n  );\n\n  // Use optimized hooks for performance and interaction\n  const { isMobile, isTablet, isDesktop, viewConfig, handleDayClick } =\n    useOptimizedCalendarViewport(viewMode, setViewMode, setCurrentDate);\n\n  const {\n    navigatePrevious,\n    navigateNext,\n    goToToday,\n    viewTitle,\n    handleKeyboardNavigation,\n  } = useOptimizedCalendarNavigation(currentDate, viewMode, setCurrentDate);\n\n  // Performance monitoring\n  const {\n    startRenderTiming,\n    endRenderTiming,\n    startQueryTiming,\n    endQueryTiming,\n    startEventProcessing,\n    endEventProcessing,\n    getPerformanceSummary,\n  } = useCalendarPerformanceMonitor();\n\n  // Organization settings to prevent time format switching during load\n  const { loading: orgSettingsLoading } = useOrganizationSettings();\n\n  // Optimized touch handlers using event delegation\n  const touchHandlers = useOptimizedTouchHandlers({\n    onSwipeLeft: navigateNext,\n    onSwipeRight: navigatePrevious,\n    enabled: viewConfig.enableSwipeNavigation,\n  });\n\n  useEffect(() => {\n    localStorage.setItem(\"calendar:viewMode\", viewMode);\n  }, [viewMode]);\n\n  // Use optimized calendar data hook with performance monitoring\n  useEffect(() => {\n    startQueryTiming();\n  }, []);\n\n  const {\n    sessions,\n    activities,\n    projects,\n    leads,\n    projectsMap,\n    leadsMap,\n    isLoading,\n    error,\n  } = useOptimizedCalendarData(currentDate, viewMode);\n\n  useEffect(() => {\n    if (!isLoading) {\n      endQueryTiming();\n    }\n  }, [isLoading, endQueryTiming]);\n\n  const [projectDialogOpen, setProjectDialogOpen] = useState(false);\n  const [selectedProject, setSelectedProject] = useState<any | null>(null);\n  const [selectedProjectLeadName, setSelectedProjectLeadName] = useState(\"\");\n  const [sessionSheetOpen, setSessionSheetOpen] = useState(false);\n  const [selectedSessionId, setSelectedSessionId] = useState<string | null>(\n    null\n  );\n  const navigate = useNavigate();\n  const queryClient = useQueryClient();\n  const userLocale = getUserLocale();\n\n  const refreshCalendar = () => {\n    queryClient.invalidateQueries({ queryKey: [\"optimized-sessions\"] });\n    queryClient.invalidateQueries({ queryKey: [\"optimized-activities\"] });\n    queryClient.invalidateQueries({ queryKey: [\"calendar-reference-data\"] });\n  };\n\n  // Throttle refresh on window focus/visibility to avoid request bursts\n  useThrottledRefetchOnFocus(refreshCalendar, 30_000);\n\n  const [showSessions, setShowSessions] = useState<boolean>(\n    () => localStorage.getItem(\"calendar:showSessions\") !== \"false\"\n  );\n  const [showReminders, setShowReminders] = useState<boolean>(\n    () => localStorage.getItem(\"calendar:showReminders\") !== \"false\"\n  );\n  useEffect(() => {\n    localStorage.setItem(\"calendar:showSessions\", String(showSessions));\n    localStorage.setItem(\"calendar:showReminders\", String(showReminders));\n  }, [showSessions, showReminders]);\n\n  // Use optimized events processing with performance monitoring\n  const { getEventsForDate, eventStats } = useOptimizedCalendarEvents(\n    sessions,\n    activities,\n    showSessions,\n    showReminders\n  );\n\n  // Monitor event processing performance\n  useEffect(() => {\n    if (sessions.length > 0 || activities.length > 0) {\n      startEventProcessing();\n      // Processing happens in the hook, so we end timing after a tick\n      const timeout = setTimeout(() => {\n        endEventProcessing(eventStats.totalEvents);\n      }, 0);\n      return () => clearTimeout(timeout);\n    }\n  }, [\n    sessions,\n    activities,\n    startEventProcessing,\n    endEventProcessing,\n    eventStats.totalEvents,\n  ]);\n\n  // Memoized event handlers for better performance\n  const openProjectById = useCallback(\n    async (projectId?: string | null) => {\n      if (!projectId) return;\n      if (isMobile) {\n        navigate(`/projects/${projectId}`);\n        return;\n      }\n      const { data, error } = await supabase\n        .from(\"projects\")\n        .select(\"*\")\n        .eq(\"id\", projectId)\n        .maybeSingle();\n      if (!error && data) {\n        setSelectedProject(data);\n        setSelectedProjectLeadName(leadsMap[data.lead_id]?.name || \"\");\n        setProjectDialogOpen(true);\n      }\n    },\n    [isMobile, leadsMap, navigate]\n  );\n\n  const handleViewFullDetails = useCallback(() => {\n    if (selectedProject) {\n      navigate(`/projects/${selectedProject.id}`);\n      setProjectDialogOpen(false);\n    }\n  }, [selectedProject, navigate]);\n\n  const handleSessionClick = useCallback(\n    (session: Session) => {\n      if (isMobile) {\n        navigate(`/sessions/${session.id}`);\n        return;\n      }\n      setSelectedSessionId(session.id);\n      setSessionSheetOpen(true);\n    },\n    [isMobile, navigate]\n  );\n\n  const handleActivityClick = useCallback(\n    (activity: Activity) => {\n      if (activity.project_id) {\n        openProjectById(activity.project_id);\n      } else {\n        navigate(`/leads/${activity.lead_id}`);\n      }\n    },\n    [openProjectById, navigate]\n  );\n\n  // Performance monitoring for renders\n  useEffect(() => {\n    startRenderTiming();\n\n    return () => {\n      endRenderTiming();\n    };\n  });\n\n  // Keyboard navigation support\n  useEffect(() => {\n    document.addEventListener(\"keydown\", handleKeyboardNavigation);\n    return () =>\n      document.removeEventListener(\"keydown\", handleKeyboardNavigation);\n  }, [handleKeyboardNavigation]);\n\n  // Render month view using optimized components\n  const renderMonthView = () => {\n    return (\n      <CalendarMonthView\n        currentDate={currentDate}\n        getEventsForDate={getEventsForDate}\n        showSessions={showSessions}\n        showReminders={showReminders}\n        leadsMap={leadsMap}\n        projectsMap={projectsMap}\n        onSessionClick={handleSessionClick}\n        onActivityClick={handleActivityClick}\n        onDayClick={\n          isMobile\n            ? (date) => {\n                setCurrentDate(date);\n                setViewMode(\"day\");\n              }\n            : undefined\n        }\n        isMobile={isMobile}\n        touchHandlers={touchHandlers}\n      />\n    );\n  };\n\n  // Render week view using optimized CalendarWeek component\n  const renderWeekView = () => {\n    return (\n      <CalendarWeek\n        currentDate={currentDate}\n        sessions={sessions}\n        activities={activities}\n        showSessions={showSessions}\n        showReminders={showReminders}\n        leadsMap={leadsMap}\n        projectsMap={projectsMap}\n        onSessionClick={handleSessionClick}\n        onActivityClick={handleActivityClick}\n        onDayClick={\n          isMobile\n            ? (date) => {\n                setCurrentDate(date);\n              }\n            : undefined\n        }\n        isMobile={isMobile}\n        getEventsForDate={getEventsForDate}\n      />\n    );\n  };\n\n  // Render day view using optimized component\n  const renderDayView = () => {\n    return (\n      <CalendarDayView\n        currentDate={currentDate}\n        getEventsForDate={getEventsForDate}\n        showSessions={showSessions}\n        showReminders={showReminders}\n        leadsMap={leadsMap}\n        projectsMap={projectsMap}\n        onSessionClick={handleSessionClick}\n        onActivityClick={handleActivityClick}\n        touchHandlers={touchHandlers}\n      />\n    );\n  };\n\n  const getViewTitle = () => {\n    return viewTitle; // Use optimized viewTitle from hook\n  };\n\n  // Show loading state while data is being fetched OR organization settings are loading\n  if (isLoading || orgSettingsLoading) {\n    return (\n      <CalendarErrorWrapper error={error} retry={refreshCalendar}>\n        <>\n          <PageHeader\n            title={t(\"calendar.title\")}\n            subtitle={t(\"calendar.description\")}\n          />\n\n          {/* Desktop controls in separate row */}\n          <div className=\"hidden lg:block px-4 sm:px-6 lg:px-6\">\n            <div className=\"flex items-center gap-4 justify-between w-full pb-4\">\n              {/* Filter chips skeleton */}\n              <div className=\"flex items-center gap-2\">\n                <Skeleton className=\"h-8 w-20\" />\n                <Skeleton className=\"h-8 w-24\" />\n              </div>\n\n              {/* Navigation skeleton */}\n              <div className=\"flex items-center gap-2\">\n                <Skeleton className=\"h-8 w-8\" />\n                <Skeleton className=\"h-8 w-32\" />\n                <Skeleton className=\"h-8 w-8\" />\n              </div>\n\n              {/* View mode skeleton */}\n              <div className=\"flex items-center gap-1\">\n                <Skeleton className=\"h-8 w-16\" />\n                <Skeleton className=\"h-8 w-16\" />\n                <Skeleton className=\"h-8 w-16\" />\n              </div>\n            </div>\n          </div>\n\n          {/* Calendar content skeleton */}\n          <div className=\"flex-1 px-4 sm:px-6 lg:px-6 pb-4\">\n            {viewMode === \"month\" && <CalendarSkeleton />}\n            {viewMode === \"week\" && <CalendarWeekSkeleton />}\n            {viewMode === \"day\" && <CalendarDaySkeleton />}\n          </div>\n        </>\n      </CalendarErrorWrapper>\n    );\n  }\n\n  return (\n    <CalendarErrorWrapper error={error} retry={refreshCalendar}>\n      <>\n        <PageHeader\n          title={t(\"calendar.title\")}\n          subtitle={t(\"calendar.description\")}\n        />\n\n        {/* Desktop controls in separate row */}\n        <div className=\"hidden lg:block px-4 sm:px-6 lg:px-6\">\n          <div className=\"flex items-center gap-4 justify-between w-full pb-4\">\n            {/* Filter chips */}\n            <div className=\"flex items-center gap-2\">\n              <button\n                type=\"button\"\n                aria-pressed={showSessions}\n                onClick={() => setShowSessions((v) => !v)}\n                className={`inline-flex items-center gap-2 px-3 py-2 rounded-md border text-sm font-medium transition-colors\n                  ${\n                    showSessions\n                      ? \"bg-primary/10 border-primary/30 text-foreground\"\n                      : \"bg-muted border-border text-muted-foreground hover:bg-accent\"\n                  }`}\n              >\n                <span\n                  className={`h-2.5 w-2.5 rounded-full ${\n                    showSessions ? \"bg-primary\" : \"bg-muted-foreground/40\"\n                  }`}\n                />\n                <span>{t(\"calendar.filters.sessions\")}</span>\n              </button>\n              <button\n                type=\"button\"\n                aria-pressed={showReminders}\n                onClick={() => setShowReminders((v) => !v)}\n                className={`inline-flex items-center gap-2 px-3 py-2 rounded-md border text-sm font-medium transition-colors\n                  ${\n                    showReminders\n                      ? \"bg-primary/10 border-primary/30 text-foreground\"\n                      : \"bg-muted border-border text-muted-foreground hover:bg-accent\"\n                  }`}\n              >\n                <span\n                  className={`h-2.5 w-2.5 rounded-full ${\n                    showReminders\n                      ? \"bg-muted-foreground/60\"\n                      : \"bg-muted-foreground/40\"\n                  }`}\n                />\n                <span>{t(\"calendar.filters.reminders\")}</span>\n              </button>\n            </div>\n\n            {/* Navigation controls with title */}\n            <div className=\"flex items-center gap-2\">\n              <Button variant=\"outline\" size=\"sm\" onClick={navigatePrevious}>\n                <ChevronLeft className=\"h-4 w-4\" />\n              </Button>\n              <Button variant=\"outline\" size=\"sm\" onClick={goToToday}>\n                {t(\"calendar.navigation.today\")}\n              </Button>\n              <Button variant=\"outline\" size=\"sm\" onClick={navigateNext}>\n                <ChevronRight className=\"h-4 w-4\" />\n              </Button>\n              <div className=\"text-lg font-semibold ml-2\">{getViewTitle()}</div>\n            </div>\n\n            {/* View mode toggle */}\n            <SegmentedControl\n              size=\"md\"\n              value={viewMode}\n              onValueChange={(value) => setViewMode(value as ViewMode)}\n              options={viewModeOptions}\n            />\n          </div>\n        </div>\n\n        {/* Mobile controls */}\n        <div className=\"lg:hidden px-4 sm:px-6\">\n          <div className=\"flex items-center justify-between gap-4 pb-4\">\n            {/* View mode toggle for mobile */}\n            <SegmentedControl\n              size=\"md\"\n              value={viewMode}\n              onValueChange={(value) => setViewMode(value as ViewMode)}\n              options={viewModeOptions}\n            />\n\n            {/* Navigation for mobile */}\n            <div className=\"flex items-center gap-2\">\n              <Button variant=\"outline\" size=\"sm\" onClick={navigatePrevious}>\n                <ChevronLeft className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={goToToday}\n                className=\"text-xs\"\n              >\n                {t(\"calendar.navigation.today\")}\n              </Button>\n              <Button variant=\"outline\" size=\"sm\" onClick={navigateNext}>\n                <ChevronRight className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n\n          {/* Title for mobile */}\n          <div className=\"text-center pb-2\">\n            <div className=\"text-lg font-semibold\">{getViewTitle()}</div>\n          </div>\n\n          {/* Filter chips for mobile */}\n          <div className=\"flex items-center gap-2 pb-4\">\n            <button\n              type=\"button\"\n              aria-pressed={showSessions}\n              onClick={() => setShowSessions((v) => !v)}\n              className={`inline-flex items-center gap-2 px-3 py-2 rounded-md border text-sm font-medium transition-colors\n                ${\n                  showSessions\n                    ? \"bg-primary/10 border-primary/30 text-foreground\"\n                    : \"bg-muted border-border text-muted-foreground hover:bg-accent\"\n                }`}\n            >\n              <span\n                className={`h-2.5 w-2.5 rounded-full ${\n                  showSessions ? \"bg-primary\" : \"bg-muted-foreground/40\"\n                }`}\n              />\n              <span>{t(\"calendar.filters.sessions\")}</span>\n            </button>\n            <button\n              type=\"button\"\n              aria-pressed={showReminders}\n              onClick={() => setShowReminders((v) => !v)}\n              className={`inline-flex items-center gap-2 px-3 py-2 rounded-md border text-sm font-medium transition-colors\n                ${\n                  showReminders\n                    ? \"bg-primary/10 border-primary/30 text-foreground\"\n                    : \"bg-muted border-border text-muted-foreground hover:bg-accent\"\n                }`}\n            >\n              <span\n                className={`h-2.5 w-2.5 rounded-full ${\n                  showReminders\n                    ? \"bg-muted-foreground/60\"\n                    : \"bg-muted-foreground/40\"\n                }`}\n              />\n              <span>{t(\"calendar.filters.reminders\")}</span>\n            </button>\n          </div>\n        </div>\n\n        {/* Main calendar container with proper structure */}\n        <div className=\"flex-1 px-4 sm:px-6 lg:px-6 pb-4\">\n          {/* Calendar content */}\n          <div\n            className=\"min-h-96\"\n            onTouchStart={\n              viewMode !== \"month\" ? touchHandlers.handleTouchStart : undefined\n            }\n            onTouchMove={\n              viewMode !== \"month\" ? touchHandlers.handleTouchMove : undefined\n            }\n            onTouchEnd={\n              viewMode !== \"month\" ? touchHandlers.handleTouchEnd : undefined\n            }\n          >\n            {viewMode === \"month\" && renderMonthView()}\n            {viewMode === \"week\" && renderWeekView()}\n            {viewMode === \"day\" && renderDayView()}\n          </div>\n\n          {/* Dialogs and modals */}\n          {selectedProject && (\n            <ProjectSheetView\n              project={selectedProject}\n              leadName={selectedProjectLeadName}\n              open={projectDialogOpen}\n              onOpenChange={(open) => {\n                setProjectDialogOpen(open);\n                if (!open) {\n                  refreshCalendar();\n                }\n              }}\n              onProjectUpdated={refreshCalendar}\n              onActivityUpdated={refreshCalendar}\n              mode=\"sheet\"\n              onViewFullDetails={handleViewFullDetails}\n            />\n          )}\n\n          {selectedSessionId && (\n            <SessionSheetView\n              sessionId={selectedSessionId}\n              isOpen={sessionSheetOpen}\n              onOpenChange={(open) => {\n                setSessionSheetOpen(open);\n                if (!open) {\n                  refreshCalendar();\n                }\n              }}\n              onViewFullDetails={() => {\n                const currentPath = `${location.pathname}${location.search}${location.hash}`;\n                navigate(`/sessions/${selectedSessionId}`, { state: { from: currentPath } });\n                setSessionSheetOpen(false);\n              }}\n              onNavigateToLead={(leadId) => navigate(`/leads/${leadId}`)}\n              onNavigateToProject={(projectId) => openProjectById(projectId)}\n              onSessionUpdated={refreshCalendar}\n            />\n          )}\n        </div>\n      </>\n    </CalendarErrorWrapper>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/GettingStarted.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2144,2147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2144,2147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";  \nimport { HelpCircle, ArrowRight, CheckCircle, Clock } from \"lucide-react\";\nimport { SampleDataModal } from \"@/components/SampleDataModal\";\nimport { RestartGuidedModeButton } from \"@/components/RestartGuidedModeButton\";\nimport { ExitGuidanceModeButton } from \"@/components/ExitGuidanceModeButton\";\nimport { GuidedStepProgress } from \"@/components/GuidedStepProgress\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useOnboarding } from \"@/contexts/OnboardingContext\";\nimport { useTranslation } from \"react-i18next\";\n\n// Remove duplicate step definitions - now using centralized ones from hook\n\nconst GettingStarted = () => {\n  const { t } = useTranslation('pages');\n  const { user } = useAuth();\n  const navigate = useNavigate();\n  const [showSampleDataModal, setShowSampleDataModal] = useState(false);\n  const [isAnimating, setIsAnimating] = useState(false);\n  const { \n    loading, \n    isInGuidedSetup, \n    isOnboardingComplete,\n    currentStepInfo,\n    nextStepInfo,\n    completedSteps,\n    isAllStepsComplete,\n    totalSteps,\n    currentStep,\n    completeOnboarding\n  } = useOnboarding();\n\n  // If guided setup is complete, redirect to dashboard\n  useEffect(() => {\n    if (!loading && (!isInGuidedSetup || isOnboardingComplete)) {\n      navigate('/', { replace: true });\n    }\n  }, [loading, isInGuidedSetup, isOnboardingComplete, navigate]);\n  \n  // Handle completion\n  const handleComplete = async () => {\n    try {\n      await completeOnboarding();\n      navigate('/', { replace: true });\n    } catch (error) {\n      console.error('Error completing onboarding:', error);\n    }\n  };\n\n  // Animation on mount and when currentStep changes\n  useEffect(() => {\n    if (!loading) {\n      setIsAnimating(true);\n      const timer = setTimeout(() => setIsAnimating(false), 300);\n      return () => clearTimeout(timer);\n    }\n  }, [currentStep, loading]);\n\n  const handleStepAction = (step: any) => {\n    if (step.id === 1 || step.id === 4 || step.id === 5) {\n      navigate(`${step.route}${step.route.includes('?') ? '' : '?tutorial=true'}`);\n    } else {\n      navigate(step.route);\n    }\n  };\n\n  if (loading) {\n    return <div className=\"min-h-screen bg-background flex items-center justify-center\">{t('onboarding.getting_started.loading')}</div>;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"bg-card border-b border-border\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center py-6 gap-6\">\n            <div className=\"text-center sm:text-left\">\n              <h1 className=\"text-xl sm:text-2xl font-bold text-foreground\">{t('onboarding.getting_started.welcome_title')}</h1>\n              <p className=\"text-sm text-muted-foreground mt-2\">{t('onboarding.getting_started.welcome_subtitle')}</p>\n            </div>\n            <div className=\"flex items-center justify-center sm:justify-end gap-3\">\n              <Button variant=\"outline\" size=\"sm\">\n                <HelpCircle className=\"w-4 h-4 mr-2\" />\n                {t('onboarding.getting_started.need_help')}\n              </Button>\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={() => setShowSampleDataModal(true)}\n              >\n                {t('onboarding.getting_started.skip_setup')}\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 pb-safe\">\n        {/* Progress Section */}\n        <div className={`mb-6 sm:mb-8 ${isAnimating ? 'animate-fade-in' : ''}`}>\n          <Card>\n            <CardHeader className=\"pb-4\">\n              <CardTitle className=\"flex items-center gap-2 text-lg sm:text-xl\">\n                {t('onboarding.getting_started.setup_progress')}\n                {completedSteps.length > 0 && (\n                  <CheckCircle className=\"w-5 h-5 text-green-500\" />\n                )}\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <GuidedStepProgress \n                  currentValue={currentStep - 1}\n                  targetValue={currentStep - 1}\n                  totalSteps={totalSteps}\n                  animate={true}\n                />\n                <div className=\"flex flex-col gap-2 text-sm text-muted-foreground\">\n                  <div className=\"font-medium\">\n                    <span className=\"text-foreground\">{t('onboarding.getting_started.now_label')}</span> {currentStepInfo ? t(`onboarding.steps.step_${currentStepInfo.id}.title`) : t('onboarding.getting_started.all_tasks_complete')}\n                  </div>\n                  {nextStepInfo && (\n                    <div>\n                      <span className=\"text-foreground\">{t('onboarding.getting_started.next_label')}</span> {t(`onboarding.steps.step_${nextStepInfo.id}.title`)}\n                    </div>\n                  )}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Learning Path Header */}\n        <div className=\"mb-6 sm:mb-8 text-center\">\n          <h2 className=\"text-xl sm:text-2xl font-semibold text-foreground mb-2\">\n            {t('onboarding.getting_started.your_learning_path')}\n          </h2>\n          <p className=\"text-sm sm:text-base text-muted-foreground\">\n            {t('onboarding.getting_started.learning_path_subtitle')}\n          </p>\n        </div>\n\n        {/* Completed Steps */}\n        {completedSteps.length > 0 && (\n          <div className={`mb-4 ${isAnimating ? 'animate-scale-in' : ''}`}>\n            <div className=\"space-y-2\">\n              {completedSteps.map((step, index) => (\n                <div key={step.id} className=\"flex items-center gap-3 py-2 px-3 rounded-lg bg-muted/30 border border-border/50\">\n                  <div className=\"flex items-center justify-center w-6 h-6 rounded-full bg-green-500 text-white flex-shrink-0\">\n                    <CheckCircle className=\"w-3 h-3\" />\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-sm font-medium text-muted-foreground truncate\">\n                      {t(`onboarding.steps.step_${step.id}.title`)}\n                    </p>\n                  </div>\n                  <div className=\"text-xs text-green-600 dark:text-green-400 font-medium flex-shrink-0\">\n                    âœ“\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Current Task */}\n        {currentStepInfo && (\n          <div className={`mb-6 sm:mb-8 ${isAnimating ? 'animate-fade-in' : ''}`}>\n            <Card className=\"border-primary/20 bg-gradient-to-r from-primary/5 to-accent/5\">\n              <CardContent className=\"p-4 md:p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-4 mb-3\">\n                      <div className=\"flex items-center justify-center w-10 h-10 rounded-full bg-primary text-primary-foreground text-lg font-bold animate-pulse\">\n                        {currentStepInfo.id}\n                      </div>\n                      <div className=\"flex items-center gap-3\">\n                        <CardTitle className=\"text-xl\">\n                          {t(`onboarding.steps.step_${currentStepInfo.id}.title`)}\n                        </CardTitle>\n                        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-muted text-muted-foreground\">\n                          <Clock className=\"w-3 h-3 mr-1\" />\n                          {t(`onboarding.steps.step_${currentStepInfo.id}.duration`)}\n                        </span>\n                      </div>\n                    </div>\n                    <CardDescription className=\"text-base text-muted-foreground ml-14\">\n                      {t(`onboarding.steps.step_${currentStepInfo.id}.description`)}\n                    </CardDescription>\n                  </div>\n                  <div className=\"ml-8\">\n                    <Button \n                      size=\"lg\" \n                      onClick={() => handleStepAction(currentStepInfo)}\n                      className=\"hover-scale\"\n                    >\n                      {t(`onboarding.steps.step_${currentStepInfo.id}.button`)}\n                      <ArrowRight className=\"w-4 h-4 ml-2\" />\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        {/* Next Step Preview */}\n        {nextStepInfo && (\n          <div className=\"mb-6 sm:mb-8\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <div className=\"h-px bg-border flex-1\"></div>\n              <span className=\"text-xs text-muted-foreground uppercase tracking-wide px-3\">{t('onboarding.getting_started.coming_next')}</span>\n              <div className=\"h-px bg-border flex-1\"></div>\n            </div>\n            \n            <Card className=\"opacity-50 pointer-events-none grayscale-[0.3] hover:opacity-60 transition-opacity\">\n              <CardContent className=\"p-4 md:p-6\">\n                {/* Mobile-first responsive layout for next step preview */}\n                <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex flex-col sm:flex-row sm:items-center gap-3 mb-3\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"flex items-center justify-center w-10 h-10 rounded-full border-2 border-muted-foreground/30 text-muted-foreground text-lg font-bold flex-shrink-0\">\n                          {nextStepInfo.id}\n                        </div>\n                        <CardTitle className=\"text-lg sm:text-xl text-muted-foreground leading-tight\">\n                          {t(`onboarding.steps.step_${nextStepInfo.id}.title`)}\n                        </CardTitle>\n                      </div>\n                      <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-muted/50 text-muted-foreground/80 w-fit\">\n                        <Clock className=\"w-3 h-3 mr-1\" />\n                        {t(`onboarding.steps.step_${nextStepInfo.id}.duration`)}\n                      </span>\n                    </div>\n                    <CardDescription className=\"text-sm sm:text-base text-muted-foreground/80 pl-0 sm:pl-13\">\n                      {t(`onboarding.steps.step_${nextStepInfo.id}.description`)}\n                    </CardDescription>\n                  </div>\n                  <div className=\"flex-shrink-0\">\n                    <Button \n                      size=\"lg\"\n                      variant=\"outline\"\n                      disabled\n                      className=\"opacity-50 w-full sm:w-auto\"\n                    >\n                      {t(`onboarding.steps.step_${nextStepInfo.id}.button`)}\n                      <ArrowRight className=\"w-4 h-4 ml-2\" />\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        {/* Completion */}\n        {isAllStepsComplete && (\n          <div className={`text-center ${isAnimating ? 'animate-scale-in' : ''}`}>\n            <Card className=\"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-950/20\">\n              <CardContent className=\"py-12\">\n                <CheckCircle className=\"w-16 h-16 text-green-500 mx-auto mb-4 animate-pulse\" />\n                <h2 className=\"text-2xl font-bold text-green-700 dark:text-green-400 mb-2\">\n                  {t('onboarding.getting_started.congratulations')}\n                </h2>\n                <p className=\"text-green-600 dark:text-green-300 mb-6\">\n                  {t('onboarding.getting_started.setup_complete')}\n                </p>\n                <Button \n                  size=\"lg\" \n                  className=\"bg-green-600 hover:bg-green-700 hover-scale\"\n                  onClick={handleComplete}\n                >\n                  {t('onboarding.getting_started.go_to_dashboard')}\n                  <ArrowRight className=\"w-4 h-4 ml-2\" />\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n      </div>\n\n      <SampleDataModal \n        open={showSampleDataModal}\n        onClose={() => setShowSampleDataModal(false)}\n      />\n\n      <RestartGuidedModeButton />\n      <ExitGuidanceModeButton />\n    </div>\n  );\n};\n\nexport default GettingStarted;","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/Index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/LeadDetail.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":489,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":489,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18730,18733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18730,18733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'aggregatedPayments.remaining' and 'aggregatedPayments.total'. Either include them or remove the dependency array.","line":759,"column":6,"nodeType":"ArrayExpression","endLine":768,"endColumn":4,"suggestions":[{"desc":"Update the dependencies array to be: [aggregatedPayments.total, aggregatedPayments.remaining, sessionsSecondary, tPages, projectPrimary, projectSecondary, paymentsPrimary, paymentsSecondary, sessionsPrimary, activitySummary.primary, activitySummary.secondary]","fix":{"range":[28225,28392],"text":"[aggregatedPayments.total, aggregatedPayments.remaining, sessionsSecondary, tPages, projectPrimary, projectSecondary, paymentsPrimary, paymentsSecondary, sessionsPrimary, activitySummary.primary, activitySummary.secondary]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo, useRef, useCallback, type ReactNode } from \"react\";\nimport { useParams, useNavigate, useLocation } from \"react-router-dom\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle\n} from \"@/components/ui/alert-dialog\";\nimport { Calendar, CheckCircle, FolderPlus, User, Activity, CheckSquare, CreditCard } from \"lucide-react\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { UnifiedClientDetails } from \"@/components/UnifiedClientDetails\";\nimport ScheduleSessionDialog from \"@/components/ScheduleSessionDialog\";\nimport EditSessionDialog from \"@/components/EditSessionDialog\";\nimport { LeadActivitySection } from \"@/components/LeadActivitySection\";\nimport { ProjectsSection } from \"@/components/ProjectsSection\";\nimport { LeadStatusBadge } from \"@/components/LeadStatusBadge\";\nimport ProjectDetailsLayout from \"@/components/project-details/ProjectDetailsLayout\";\n// AssigneesList removed - single user organization\nimport { formatDate, formatTime, getDateFnsLocale } from \"@/lib/utils\";\nimport { useOrganizationQuickSettings } from \"@/hooks/useOrganizationQuickSettings\";\nimport { useLeadStatusActions } from \"@/hooks/useLeadStatusActions\";\n// Permissions removed for single photographer mode\nimport { OnboardingTutorial, TutorialStep } from \"@/components/shared/OnboardingTutorial\";\nimport { useOnboarding } from \"@/contexts/OnboardingContext\";\nimport { DetailPageLoadingSkeleton } from \"@/components/ui/loading-presets\";\nimport { useMessagesTranslation, useFormsTranslation, useCommonTranslation } from \"@/hooks/useTypedTranslation\";\nimport { useSessionActions } from \"@/hooks/useSessionActions\";\nimport { useTranslation } from \"react-i18next\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { EntityHeader, type EntitySummaryItem } from \"@/components/EntityHeader\";\nimport { useLeadDetailData } from \"@/hooks/useLeadDetailData\";\n\nconst getDateKey = (value?: string | null) => (value ? value.slice(0, 10) : null);\nconst safeFormatDate = (value?: string | null) => {\n  if (!value) return null;\n  try {\n    return formatDate(value);\n  } catch {\n    return null;\n  }\n};\nconst safeFormatTime = (value?: string | null) => {\n  if (!value) return null;\n  try {\n    return formatTime(value);\n  } catch {\n    return null;\n  }\n};\nconst LeadDetail = () => {\n  const {\n    id\n  } = useParams<{\n    id: string;\n  }>();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const { t: tMessages } = useMessagesTranslation();\n  const { t: tForms } = useFormsTranslation();\n  const { t: tCommon } = useCommonTranslation();\n  const { t: tPages } = useTranslation(\"pages\");\n  const {\n    lead,\n    leadQuery,\n    sessions,\n    sessionsQuery,\n    projectSummary,\n    aggregatedPayments,\n    summaryQuery,\n    latestLeadActivity,\n    latestActivityQuery,\n    leadStatuses,\n    sessionMetrics,\n    latestSessionUpdate,\n    hasProjects,\n    isLoading: detailLoading,\n    refetchAll\n  } = useLeadDetailData(id);\n  const handledMissingLeadRef = useRef(false);\n\n  useEffect(() => {\n    if (!id) {\n      navigate(\"/leads\");\n    }\n  }, [id, navigate]);\n\n  useEffect(() => {\n    if (!id || detailLoading || handledMissingLeadRef.current) {\n      return;\n    }\n\n    if (leadQuery.isError) {\n      handledMissingLeadRef.current = true;\n      const message =\n        leadQuery.error && leadQuery.error instanceof Error\n          ? leadQuery.error.message\n          : tPages(\"leadDetail.toast.fetchLeadDescription\");\n\n      toast({\n        title: tPages(\"leadDetail.toast.fetchLeadTitle\"),\n        description: message,\n        variant: \"destructive\"\n      });\n      navigate(\"/leads\");\n      return;\n    }\n\n    if (leadQuery.isSuccess && !lead) {\n      handledMissingLeadRef.current = true;\n      toast({\n        title: tPages(\"leadDetail.toast.leadNotFoundTitle\"),\n        description: tPages(\"leadDetail.toast.leadNotFoundDescription\"),\n        variant: \"destructive\"\n      });\n      navigate(\"/leads\");\n    }\n  }, [id, detailLoading, leadQuery.isError, leadQuery.error, leadQuery.isSuccess, lead, navigate, tPages]);\n  const [deleting, setDeleting] = useState(false);\n  const [deletingSessionId, setDeletingSessionId] = useState<string | null>(null);\n  const [editingSessionId, setEditingSessionId] = useState<string | null>(null);\n\n  // User settings and status actions\n  const {\n    settings: userSettings,\n    loading: settingsLoading\n  } = useOrganizationQuickSettings();\n  const {\n    markAsCompleted,\n    markAsLost,\n    isUpdating\n  } = useLeadStatusActions({\n    leadId: lead?.id || '',\n    onStatusChange: () => {\n      refetchAll();\n    }\n  });\n\n  const { deleteSession } = useSessionActions();\n\n  const {\n    currentStep,\n    completeCurrentStep,\n    completeMultipleSteps // BULLETPROOF: For combined tutorials\n  } = useOnboarding();\n  const [showTutorial, setShowTutorial] = useState(false);\n  const [currentTutorialStep, setCurrentTutorialStep] = useState(0);\n  const [hasViewedProject, setHasViewedProject] = useState(false);\n  const [isSchedulingTutorial, setIsSchedulingTutorial] = useState(false);\n  const [hasScheduledSession, setHasScheduledSession] = useState(false);\n  const {\n    todayCount,\n    todayNext,\n    nextUpcoming,\n    overdueCount\n  } = sessionMetrics;\n\n  // Dynamically update tutorial steps based on hasProjects\n  const leadDetailsTutorialSteps: TutorialStep[] = useMemo(() => {\n    const introSections = tPages(\"leadDetail.tutorial.intro.sections\", { returnObjects: true }) as Array<{ title: string; description: string }>;\n    const introIcons = [User, FolderPlus, Activity];\n    const explorePoints = tPages(\"leadDetail.tutorial.exploreProjects.points\", { returnObjects: true }) as string[];\n\n    return [\n      {\n        id: 4,\n        title: tPages(\"leadDetail.tutorial.intro.title\"),\n        description: tPages(\"leadDetail.tutorial.intro.description\"),\n        content: (\n          <div className=\"space-y-4\">\n            {introSections.map((section, index) => {\n              const Icon = introIcons[index] ?? User;\n              return (\n                <div key={section.title} className=\"flex items-start gap-3\">\n                  <Icon className=\"w-5 h-5 text-primary mt-0.5\" />\n                  <div>\n                    <h4 className=\"font-medium\">{section.title}</h4>\n                    <p className=\"text-sm text-muted-foreground\">{section.description}</p>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        ),\n        mode: \"modal\",\n        canProceed: true,\n      },\n      {\n        id: 5,\n        title: tPages(\"leadDetail.tutorial.createProject.title\"),\n        description: tPages(\"leadDetail.tutorial.createProject.description\"),\n        content: null,\n        mode: \"floating\",\n        canProceed: hasProjects,\n        requiresAction: true,\n        disabledTooltip: tPages(\"leadDetail.tutorial.createProject.disabledTooltip\"),\n      },\n      {\n        id: 6,\n        title: tPages(\"leadDetail.tutorial.exploreProjects.title\"),\n        description: tPages(\"leadDetail.tutorial.exploreProjects.description\"),\n        content: (\n          <div className=\"text-sm space-y-2\">\n            {explorePoints.map(point => (\n              <div key={point} className=\"flex items-center gap-2\">\n                <span className=\"w-2 h-2 bg-primary rounded-full\"></span>\n                <span>{point}</span>\n              </div>\n            ))}\n          </div>\n        ),\n        mode: \"floating\",\n        canProceed: hasViewedProject,\n        requiresAction: !hasViewedProject,\n        disabledTooltip: hasViewedProject ? undefined : tPages(\"leadDetail.tooltips.viewProject\"),\n      },\n      {\n        id: 7,\n        title: tPages(\"leadDetail.tutorial.complete.title\"),\n        description: tPages(\"leadDetail.tutorial.complete.description\"),\n        content: (\n          <div className=\"p-3 bg-blue-50 border border-blue-200 rounded-lg\">\n            <p className=\"text-sm font-medium text-blue-800\">\n              {tPages(\"leadDetail.tutorial.complete.projectsShortcut\")}\n            </p>\n          </div>\n        ),\n        mode: \"modal\",\n        canProceed: true,\n      },\n    ];\n  }, [hasProjects, hasViewedProject, tPages]);\n\n  // Scheduling tutorial steps\n  const schedulingTutorialSteps: TutorialStep[] = useMemo(() => {\n    const schedulingSections = tPages(\"leadDetail.scheduling.scheduleSession.sections\", { returnObjects: true }) as Array<{ title: string; description: string }>;\n    const schedulingIcons = [Calendar, CheckSquare];\n    const scheduledTips = tPages(\"leadDetail.scheduling.sessionScheduled.tips\", { returnObjects: true }) as string[];\n\n    return [\n      {\n        id: 3,\n        title: tPages(\"leadDetail.scheduling.scheduleSession.title\"),\n        description: tPages(\"leadDetail.scheduling.scheduleSession.description\"),\n        content: (\n          <div className=\"space-y-4\">\n            {schedulingSections.map((section, index) => {\n              const Icon = schedulingIcons[index] ?? Calendar;\n              return (\n                <div key={section.title} className=\"flex items-start gap-3\">\n                  <Icon className=\"w-5 h-5 text-primary mt-0.5\" />\n                  <div>\n                    <h4 className=\"font-medium\">{section.title}</h4>\n                    <p className=\"text-sm text-muted-foreground\">{section.description}</p>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        ),\n        mode: \"floating\",\n        canProceed: hasScheduledSession,\n        requiresAction: !hasScheduledSession,\n        disabledTooltip: tPages(\"leadDetail.scheduling.scheduleSession.disabledTooltip\"),\n      },\n      {\n        id: 4,\n        title: tPages(\"leadDetail.scheduling.sessionScheduled.title\"),\n        description: tPages(\"leadDetail.scheduling.sessionScheduled.description\"),\n        content: (\n          <div className=\"space-y-3\">\n            <div className=\"p-3 bg-green-50 border border-green-200 rounded-lg\">\n              <p className=\"text-sm font-medium text-green-800\">\n                {tPages(\"leadDetail.scheduling.sessionScheduled.banner\")}\n              </p>\n            </div>\n            <div className=\"text-sm space-y-2\">\n              {scheduledTips.map(tip => (\n                <div key={tip} className=\"flex items-center gap-2\">\n                  <span className=\"w-2 h-2 bg-primary rounded-full\"></span>\n                  <span>{tip}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        ),\n        mode: \"modal\",\n        canProceed: true,\n      },\n    ];\n  }, [hasScheduledSession, tPages]);\n\n  // Check if we should show tutorial when component mounts\n  useEffect(() => {\n    const continueTutorial = location.state?.continueTutorial;\n    const tutorialStep = location.state?.tutorialStep;\n    const tutorialType = location.state?.tutorialType;\n    \n    // Check if we should show tutorial either from navigation state OR onboarding progress\n    const shouldShowFromState = continueTutorial && tutorialStep;\n    const shouldShowFromProgress = currentStep === 2; // User completed first step, now on leads\n\n    if (shouldShowFromState) {\n      if (tutorialType === 'scheduling') {\n        setIsSchedulingTutorial(true);\n        setShowTutorial(true);\n        setCurrentTutorialStep(tutorialStep - 3); // Convert to 0-based index for scheduling steps\n      } else {\n        setShowTutorial(true);\n        setCurrentTutorialStep(tutorialStep - 4); // Convert to 0-based index for our steps array\n      }\n    } else if (shouldShowFromProgress) {\n      setShowTutorial(true);\n      setCurrentTutorialStep(0); // Start with first lead details step\n    }\n  }, [location.state?.continueTutorial, location.state?.tutorialStep, location.state?.tutorialType, currentStep]);\n\n  // Auto-start scheduling tutorial when currentStep is 5 (after step 4, now on step 5)\n  useEffect(() => {\n    if (currentStep === 5 && !showTutorial && !location.state?.continueTutorial) {\n      console.log('ðŸš€ Auto-starting scheduling tutorial for step 5');\n      setIsSchedulingTutorial(true);\n      setShowTutorial(true);\n      setCurrentTutorialStep(0); // Start with first scheduling step\n    }\n  }, [currentStep, showTutorial, location.state?.continueTutorial]);\n\n  // Handle tutorial completion with BULLETPROOF step completion\n  const handleTutorialComplete = async () => {\n    try {\n      if (isSchedulingTutorial) {\n        // For scheduling tutorial, complete step 5 (scheduling step)\n        console.log('ðŸŽ¯ BULLETPROOF LeadDetail: Completing scheduling tutorial (Step 5)');\n        await completeCurrentStep();\n        setShowTutorial(false);\n        console.log('ðŸŽ‰ BULLETPROOF LeadDetail: Scheduling tutorial completed! Navigating back to getting-started');\n        navigate('/getting-started');\n      } else {\n        // For regular lead details tutorial that includes project creation\n        // Complete BOTH Step 2 (leads) and Step 3 (projects) in one atomic operation\n        console.log('ðŸŽ¯ BULLETPROOF LeadDetail: Completing combined tutorial (Steps 2 & 3) atomically');\n        await completeMultipleSteps(2); // Complete 2 steps at once: current + next\n        \n        setShowTutorial(false);\n        console.log('ðŸŽ‰ BULLETPROOF LeadDetail: Combined tutorial completed! Both Step 2 & 3 completed atomically, navigating back to getting-started');\n        navigate('/getting-started');\n      }\n    } catch (error) {\n      console.error('âŒ BULLETPROOF LeadDetail: Error completing tutorial:', error);\n      toast({\n        title: tCommon(\"toast.error\"),\n        description: tPages(\"leadDetail.toast.saveProgressFailed\"),\n        variant: \"destructive\"\n      });\n    }\n  };\n  const handleTutorialExit = () => {\n    setShowTutorial(false);\n  };\n\n  // Handle project clicked during tutorial\n  const handleProjectClicked = () => {\n    setHasViewedProject(true);\n  };\n\n  const handleSessionScheduled = () => {\n    setHasScheduledSession(true);\n    void refetchAll();\n  };\n\n  useEffect(() => {\n    if (!hasScheduledSession && sessions.length > 0) {\n      setHasScheduledSession(true);\n    }\n  }, [hasScheduledSession, sessions.length]);\n\n  // Debug tutorial step changes\n  useEffect(() => {\n    // Development only debug logging would go here if needed\n  }, [currentTutorialStep, showTutorial]);\n\n  // UI state for Lead Information card\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n  const [confirmDeleteText, setConfirmDeleteText] = useState(\"\");\n\n  // Get system status labels for buttons (refresh when leadStatuses changes)\n  const completedStatus = leadStatuses.find(s => s.is_system_final && (s.name.toLowerCase().includes('completed') || s.name.toLowerCase().includes('delivered'))) || leadStatuses.find(s => s.name === 'Completed');\n  const lostStatus = leadStatuses.find(s => s.is_system_final && (s.name.toLowerCase().includes('lost') || s.name.toLowerCase().includes('not interested'))) || leadStatuses.find(s => s.name === 'Lost');\n\n\n  const formatRelativeTime = (dateString?: string | null) => {\n    if (!dateString) return null;\n    const date = new Date(dateString);\n    if (Number.isNaN(date.getTime())) return null;\n    try {\n      return formatDistanceToNow(date, {\n        addSuffix: true,\n        locale: getDateFnsLocale()\n      });\n    } catch (error) {\n      console.error(\"Error formatting relative time:\", error);\n      return null;\n    }\n  };\n\n  const formatCurrency = useCallback((amount: number) => {\n    try {\n      return new Intl.NumberFormat(\"tr-TR\", {\n        style: \"currency\",\n        currency: aggregatedPayments.currency || \"TRY\",\n        minimumFractionDigits: 0\n      }).format(amount);\n    } catch (error) {\n      console.error(\"Error formatting currency:\", error);\n      return `${Number.isFinite(amount) ? Math.round(amount) : 0} ${aggregatedPayments.currency || \"TRY\"}`;\n    }\n  }, [aggregatedPayments.currency]);\n\n  const handleDelete = async () => {\n    if (!lead) return;\n    setDeleting(true);\n    try {\n      // 1) Fetch all project IDs for this lead\n      const {\n        data: leadProjects,\n        error: projectsFetchError\n      } = await supabase.from('projects').select('id').eq('lead_id', lead.id);\n      if (projectsFetchError) throw projectsFetchError;\n      const projectIds = (leadProjects || []).map(p => p.id);\n      if (projectIds.length > 0) {\n        // Delete related project data in safe order\n        const {\n          error: servicesError\n        } = await supabase.from('project_services').delete().in('project_id', projectIds);\n        if (servicesError) throw servicesError;\n        const {\n          error: todosError\n        } = await supabase.from('todos').delete().in('project_id', projectIds);\n        if (todosError) throw todosError;\n        const {\n          error: projSessionsError\n        } = await supabase.from('sessions').delete().in('project_id', projectIds);\n        if (projSessionsError) throw projSessionsError;\n        const {\n          error: projActivitiesError\n        } = await supabase.from('activities').delete().in('project_id', projectIds);\n        if (projActivitiesError) throw projActivitiesError;\n        const {\n          error: paymentsError\n        } = await supabase.from('payments').delete().in('project_id', projectIds);\n        if (paymentsError) throw paymentsError;\n\n        // Finally delete projects\n        const {\n          error: deleteProjectsError\n        } = await supabase.from('projects').delete().in('id', projectIds);\n        if (deleteProjectsError) throw deleteProjectsError;\n      }\n\n      // 2) Delete sessions associated directly with this lead (not tied to a project)\n      const {\n        error: leadSessionsError\n      } = await supabase.from('sessions').delete().eq('lead_id', lead.id);\n      if (leadSessionsError) throw leadSessionsError;\n\n      // 3) Delete activities/reminders/notes for this lead\n      const {\n        error: leadActivitiesError\n      } = await supabase.from('activities').delete().eq('lead_id', lead.id);\n      if (leadActivitiesError) throw leadActivitiesError;\n\n      // 4) Finally delete the lead\n      const {\n        error: deleteLeadError\n      } = await supabase.from('leads').delete().eq('id', lead.id);\n      if (deleteLeadError) throw deleteLeadError;\n      toast({\n        title: tMessages('success.deleted'),\n        description: tForms('deleteLeadDialog.successDescription')\n      });\n      navigate('/leads');\n    } catch (error: any) {\n      toast({\n        title: tMessages('error.generic'),\n        description: error.message,\n        variant: 'destructive'\n      });\n    } finally {\n      setDeleting(false);\n      setShowDeleteDialog(false);\n      setConfirmDeleteText('');\n    }\n  };\n  const handleDeleteSession = async (sessionId: string) => {\n    const success = await deleteSession(sessionId);\n    if (success) {\n      void sessionsQuery.refetch();\n      void latestActivityQuery.refetch();\n    }\n  };\n  const handleSessionUpdated = () => {\n    void sessionsQuery.refetch();\n    void latestActivityQuery.refetch();\n  };\n\n  const handleProjectUpdated = () => {\n    // Refresh sessions and activities when project changes (archive/restore should affect visibility)\n    void sessionsQuery.refetch();\n    void summaryQuery.refetch();\n    void latestActivityQuery.refetch();\n\n    // If tutorial is active and we're on the project creation step (Step 5 = index 1), advance to project exploration step\n    if (showTutorial && currentTutorialStep === 1) {\n      // Use setTimeout to ensure state update happens after component re-render\n      setTimeout(() => {\n        setCurrentTutorialStep(2); // Move to \"Now Explore Your Project\" step (Step 6)\n      }, 100);\n    }\n  };\n  const handleActivityUpdated = () => {\n    // Force activity section to refresh when activities are updated in project modal\n    void latestActivityQuery.refetch();\n  };\n  const handleBack = () => {\n    const from = location.state?.from;\n    if (from === 'dashboard') {\n      navigate('/');\n    } else if (from === 'all-leads') {\n      navigate('/leads');\n    } else if (from === 'all-sessions') {\n      navigate('/sessions');\n    } else {\n      // Default fallback - go back in history if possible, otherwise to all leads\n      if (window.history.length > 1) {\n        navigate(-1);\n      } else {\n        navigate('/leads');\n      }\n    }\n  };\n  const handleMarkAsCompleted = () => {\n    if (!lead || !completedStatus) return;\n    markAsCompleted(lead.status, completedStatus.name);\n  };\n  const handleMarkAsLost = () => {\n    if (!lead || !lostStatus) return;\n    markAsLost(lead.status, lostStatus.name);\n  };\n  const activitySummary = useMemo(() => {\n    const timeline: Array<{ type: \"lead\" | \"project\" | \"session\" | \"note\"; timestamp: string }> = [];\n\n    if (lead?.updated_at) {\n      timeline.push({ type: \"lead\", timestamp: lead.updated_at });\n    }\n\n    if (projectSummary.latestUpdate) {\n      timeline.push({ type: \"project\", timestamp: projectSummary.latestUpdate });\n    }\n\n    if (latestSessionUpdate) {\n      timeline.push({ type: \"session\", timestamp: latestSessionUpdate });\n    }\n\n    if (latestLeadActivity) {\n      timeline.push({ type: \"note\", timestamp: latestLeadActivity });\n    }\n\n    if (timeline.length === 0) {\n      return {\n        primary: tPages(\"leadDetail.header.activity.none\"),\n        secondary: tPages(\"leadDetail.header.activity.hint\")\n      };\n    }\n\n    const latest = timeline.reduce((currentLatest, entry) => {\n      if (!currentLatest) return entry;\n      return new Date(entry.timestamp).getTime() > new Date(currentLatest.timestamp).getTime() ? entry : currentLatest;\n    });\n\n    const relative = formatRelativeTime(latest.timestamp);\n    const primary = relative\n      ? tPages(\"leadDetail.header.activity.last\", { time: relative })\n      : tPages(\"leadDetail.header.activity.lastFallback\");\n    const secondary = tPages(`leadDetail.header.activity.sources.${latest.type}`);\n\n    return {\n      primary,\n      secondary\n    };\n  }, [lead?.updated_at, projectSummary.latestUpdate, latestSessionUpdate, latestLeadActivity, tPages]);\n\n  const projectUpdateRelative = formatRelativeTime(projectSummary.latestUpdate);\n  const projectPrimary = projectSummary.count\n    ? tPages(\"leadDetail.header.projects.count\", { count: projectSummary.count })\n    : tPages(\"leadDetail.header.projects.none\");\n  const projectSecondary = projectSummary.count\n    ? projectUpdateRelative\n      ? tPages(\"leadDetail.header.projects.updated\", { time: projectUpdateRelative })\n      : tPages(\"leadDetail.header.projects.updatedFallback\")\n    : tPages(\"leadDetail.header.projects.hint\");\n\n  const sessionsCount = sessions.length;\n  const sessionsPrimary = sessionsCount\n    ? tPages(\"leadDetail.header.sessions.count\", { count: sessionsCount })\n    : tPages(\"leadDetail.header.sessions.none\");\n  const sessionsSecondary = useMemo<ReactNode>(() => {\n    if (sessionsCount === 0) {\n      return tPages(\"leadDetail.header.sessions.hint\");\n    }\n\n    const chips: ReactNode[] = [];\n\n    if (overdueCount > 0) {\n      chips.push(\n        <span\n          key=\"overdue\"\n          className=\"inline-flex items-center rounded-md border border-orange-200 bg-orange-50 px-2 py-1 text-[11px] font-semibold text-orange-700\"\n        >\n          {tPages(\"leadDetail.header.sessions.chips.overdue\", { count: overdueCount })}\n        </span>\n      );\n    }\n\n    if (todayCount > 0) {\n      const todayTime = safeFormatTime(todayNext?.session_time);\n      const label = todayTime\n        ? todayCount > 1\n          ? tPages(\"leadDetail.header.sessions.chips.todayMultiple\", { count: todayCount, time: todayTime })\n          : tPages(\"leadDetail.header.sessions.chips.todaySingle\", { time: todayTime })\n        : tPages(\"leadDetail.header.sessions.chips.todayMultipleNoTime\", { count: todayCount });\n\n      chips.push(\n        <span\n          key=\"today\"\n          className=\"inline-flex items-center rounded-md border border-blue-200 bg-blue-50 px-2 py-1 text-[11px] font-semibold text-blue-700\"\n        >\n          {label}\n        </span>\n      );\n    }\n\n    if (nextUpcoming?.session_date) {\n      const upcomingDateLabel = safeFormatDate(nextUpcoming.session_date);\n      const upcomingTime = safeFormatTime(nextUpcoming.session_time);\n\n      if (upcomingDateLabel) {\n        const today = new Date();\n        today.setHours(0, 0, 0, 0);\n        const tomorrow = new Date(today);\n        tomorrow.setDate(tomorrow.getDate() + 1);\n        const tomorrowKey = `${tomorrow.getFullYear()}-${String(tomorrow.getMonth() + 1).padStart(2, \"0\")}-${String(\n          tomorrow.getDate()\n        ).padStart(2, \"0\")}`;\n        const upcomingDateKey = getDateKey(nextUpcoming.session_date);\n\n        const label = upcomingDateKey && upcomingDateKey === tomorrowKey && upcomingTime\n          ? tPages(\"leadDetail.header.sessions.chips.tomorrow\", { time: upcomingTime })\n          : upcomingTime\n            ? tPages(\"leadDetail.header.sessions.chips.upcomingWithTime\", {\n                date: upcomingDateLabel,\n                time: upcomingTime\n              })\n            : tPages(\"leadDetail.header.sessions.chips.upcoming\", { date: upcomingDateLabel });\n\n        chips.push(\n          <span\n            key=\"upcoming\"\n            className=\"inline-flex items-center rounded-md border border-emerald-200 bg-emerald-50 px-2 py-1 text-[11px] font-semibold text-emerald-700\"\n          >\n            {label}\n          </span>\n        );\n      }\n    }\n\n    if (chips.length === 0) {\n      return tPages(\"leadDetail.header.sessions.hint\");\n    }\n\n    return (\n      <div className=\"flex flex-wrap items-center gap-1.5\">\n        {chips}\n      </div>\n    );\n  }, [\n    sessionsCount,\n    overdueCount,\n    todayCount,\n    todayNext?.session_time,\n    nextUpcoming?.session_date,\n    nextUpcoming?.session_time,\n    tPages\n  ]);\n\n  const paymentsPrimary = aggregatedPayments.total > 0 || aggregatedPayments.totalPaid > 0\n    ? tPages(\"leadDetail.header.payments.primary\", { paid: formatCurrency(aggregatedPayments.totalPaid) })\n    : tPages(\"leadDetail.header.payments.primaryZero\");\n  const paymentsSecondary = aggregatedPayments.total > 0\n    ? aggregatedPayments.remaining > 0\n      ? tPages(\"leadDetail.header.payments.secondary\", {\n          remaining: formatCurrency(aggregatedPayments.remaining),\n          total: formatCurrency(aggregatedPayments.total)\n        })\n      : tPages(\"leadDetail.header.payments.paidInFull\")\n    : tPages(\"leadDetail.header.payments.secondaryZero\");\n\n  const summaryItems: EntitySummaryItem[] = useMemo(() => {\n    const paymentsSecondaryClass = aggregatedPayments.total > 0 && aggregatedPayments.remaining <= 0\n      ? \"text-emerald-600\"\n      : undefined;\n    const sessionsSecondaryClass =\n      typeof sessionsSecondary === \"string\" || typeof sessionsSecondary === \"number\"\n        ? \"text-muted-foreground\"\n        : undefined;\n\n    return [\n      {\n        key: \"projects\",\n        icon: FolderPlus,\n        label: tPages(\"leadDetail.header.projects.label\"),\n        primary: projectPrimary,\n        secondary: projectSecondary\n      },\n      {\n        key: \"payments\",\n        icon: CreditCard,\n        label: tPages(\"leadDetail.header.payments.label\"),\n        primary: paymentsPrimary,\n        secondary: paymentsSecondary,\n        secondaryClassName: paymentsSecondaryClass\n      },\n      {\n        key: \"sessions\",\n        icon: Calendar,\n        label: tPages(\"leadDetail.header.sessions.label\"),\n        primary: sessionsPrimary,\n        secondary: sessionsSecondary,\n        secondaryClassName: sessionsSecondaryClass\n      },\n      {\n        key: \"activity\",\n        icon: Activity,\n        label: tPages(\"leadDetail.header.activity.label\"),\n        primary: activitySummary.primary,\n        secondary: activitySummary.secondary,\n        info: {\n          content: tPages(\"leadDetail.header.activity.info\"),\n          ariaLabel: tPages(\"leadDetail.header.activity.infoLabel\")\n        }\n      }\n    ];\n  }, [\n    projectPrimary,\n    projectSecondary,\n    paymentsPrimary,\n    paymentsSecondary,\n    sessionsPrimary,\n    sessionsSecondary,\n    activitySummary,\n    tPages\n  ]);\n  if (detailLoading) {\n    return <DetailPageLoadingSkeleton />;\n  }\n  if (!lead) {\n    return null;\n  }\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"mx-auto max-w-full px-4 py-4 md:px-8 md:py-8\">\n        <div className=\"space-y-6 md:space-y-8\">\n          <EntityHeader\n            className=\"mb-0\"\n            name={lead.name || \"\"}\n            title={lead.name || tPages(\"leadDetail.defaultTitle\")}\n            onBack={handleBack}\n            backLabel={tPages(\"leadDetail.header.back\")}\n            statusBadge={\n              <LeadStatusBadge\n                leadId={lead.id}\n                currentStatusId={lead.status_id}\n                currentStatus={lead.status}\n                onStatusChange={() => {\n                  void refetchAll();\n                }}\n                editable={true}\n                statuses={leadStatuses}\n              />\n            }\n            summaryItems={summaryItems}\n            fallbackInitials=\"LD\"\n            actions={\n              <>\n                <ScheduleSessionDialog\n                  leadId={lead.id}\n                  leadName={lead.name}\n                  onSessionScheduled={handleSessionScheduled}\n                  disabled={sessions.some(s => (s.status || \"\").toLowerCase() === \"planned\")}\n                  disabledTooltip={tPages(\"leadDetail.tooltips.sessionAlreadyPlanned\")}\n                />\n\n                {!settingsLoading &&\n                  userSettings.show_quick_status_buttons &&\n                  completedStatus &&\n                  lead.status !== completedStatus.name && (\n                    <Button\n                      onClick={handleMarkAsCompleted}\n                      disabled={isUpdating}\n                      className=\"h-10 bg-green-600 text-white hover:bg-green-700\"\n                      size=\"sm\"\n                    >\n                      <CheckCircle className=\"mr-2 h-4 w-4\" />\n                      {isUpdating ? \"Updating...\" : completedStatus.name}\n                    </Button>\n                  )}\n\n                {!settingsLoading &&\n                  userSettings.show_quick_status_buttons &&\n                  lostStatus &&\n                  lead.status !== lostStatus.name && (\n                    <Button onClick={handleMarkAsLost} disabled={isUpdating} variant=\"destructive\" size=\"sm\" className=\"h-10\">\n                      {isUpdating ? \"Updating...\" : lostStatus.name}\n                    </Button>\n                  )}\n              </>\n            }\n          />\n\n          <ProjectDetailsLayout\n            header={null}\n            left={\n              <div className=\"space-y-6\">\n                <UnifiedClientDetails\n                  lead={lead}\n                  createdAt={lead.created_at}\n                  showQuickActions={true}\n                  showLeadNameInHeader={false}\n                  onLeadUpdated={() => {\n                    void refetchAll();\n                  }}\n                />\n              </div>\n            }\n            sections={[\n              {\n                id: \"lead-projects\",\n                title: tPages(\"leadDetail.header.projects.label\"),\n                content: (\n                  <ProjectsSection\n                    leadId={lead.id}\n                    leadName={lead.name}\n                    onProjectUpdated={handleProjectUpdated}\n                    onActivityUpdated={handleActivityUpdated}\n                    onProjectClicked={handleProjectClicked}\n                  />\n                )\n              },\n              {\n                id: \"lead-activity\",\n                title: tPages(\"leadDetail.header.activity.label\"),\n                content: (\n                  <LeadActivitySection\n                    leadId={lead.id}\n                    leadName={lead.name}\n                    onActivityUpdated={() => {\n                      void latestActivityQuery.refetch();\n                    }}\n                  />\n                )\n              }\n            ]}\n            overviewNavId=\"lead-detail-overview\"\n            overviewLabel={tForms(\"project_sheet.overview_tab\")}\n            rightFooter={\n              <div className=\"border border-destructive/20 bg-destructive/5 rounded-md p-4 max-w-full text-center\">\n                <div className=\"space-y-3\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => setShowDeleteDialog(true)}\n                    className=\"w-full max-w-xs border-destructive text-destructive hover:bg-destructive hover:text-destructive-foreground\"\n                  >\n                    {tForms(\"leadDangerZone.deleteLead\")}\n                  </Button>\n                  <p className=\"text-xs text-muted-foreground break-words\">\n                    {tForms(\"leadDangerZone.deleteWarning\")}\n                  </p>\n                </div>\n              </div>\n            }\n          />\n        </div>\n      </div>\n\n      {/* Edit Session Dialog */}\n      {editingSessionId && (() => {\n        const session = sessions.find(s => s.id === editingSessionId);\n        return session ? (\n          <EditSessionDialog\n            sessionId={session.id}\n            leadId={lead.id}\n            currentDate={session.session_date}\n            currentTime={session.session_time}\n            currentNotes={session.notes}\n            currentProjectId={session.project_id}\n            currentSessionName={session.session_name ?? undefined}\n            leadName={lead.name}\n            open={!!editingSessionId}\n            onOpenChange={open => {\n              if (!open) {\n                setEditingSessionId(null);\n              }\n            }}\n            onSessionUpdated={() => {\n              handleSessionUpdated();\n              setEditingSessionId(null);\n            }}\n          />\n        ) : null;\n      })()}\n\n      {/* Delete Session Dialog */}\n      <AlertDialog open={!!deletingSessionId} onOpenChange={(open) => !open && setDeletingSessionId(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Session?</AlertDialogTitle>\n            <AlertDialogDescription>\n              {tMessages(\"confirm.deleteSession\")} {tMessages(\"confirm.cannotUndo\")}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => {\n                if (deletingSessionId) {\n                  handleDeleteSession(deletingSessionId);\n                  setDeletingSessionId(null);\n                }\n              }}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              Delete Session\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* Delete Lead Confirmation Dialog */}\n      <AlertDialog\n        open={showDeleteDialog}\n        onOpenChange={(open) => {\n          setShowDeleteDialog(open);\n          if (!open) setConfirmDeleteText(\"\");\n        }}\n      >\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{tForms(\"deleteLeadDialog.title\")}</AlertDialogTitle>\n            <AlertDialogDescription>\n              {tForms(\"deleteLeadDialog.description\", { name: lead.name })}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <div className=\"py-2\">\n            <Label htmlFor=\"confirm-delete\" className=\"sr-only\">\n              Confirmation\n            </Label>\n            <Input\n              id=\"confirm-delete\"\n              placeholder={tForms(\"deleteLeadDialog.placeholder\", { name: lead.name })}\n              value={confirmDeleteText}\n              onChange={(e) => setConfirmDeleteText(e.target.value)}\n            />\n            <p className=\"text-xs text-muted-foreground mt-2\">\n              {tForms(\"deleteLeadDialog.cannotUndo\")}\n            </p>\n          </div>\n          <AlertDialogFooter>\n            <AlertDialogCancel disabled={deleting}>{tCommon('buttons.cancel')}</AlertDialogCancel>\n            <AlertDialogAction onClick={handleDelete} disabled={deleting || ![lead.name, 'DELETE'].includes(confirmDeleteText.trim())} className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\">\n              {deleting ? tForms('deleteLeadDialog.deleting') : tForms('deleteLeadDialog.deleteLead')}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n      \n      <OnboardingTutorial\n        key={`tutorial-${currentTutorialStep}`}\n        steps={isSchedulingTutorial ? schedulingTutorialSteps : leadDetailsTutorialSteps}\n        isVisible={showTutorial}\n        onComplete={handleTutorialComplete}\n        onExit={handleTutorialExit}\n        initialStepIndex={currentTutorialStep}\n      />\n    </div>\n  );\n};\nexport default LeadDetail;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/NotFound.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/Payments.tsx","messages":[{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":175,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":175,"endColumn":45,"suggestions":[{"messageId":"addBrackets","fix":{"range":[6031,6197],"text":"{ const lastMonth = subMonths(now, 1);\n        return {\n          start: startOfDay(startOfMonth(lastMonth)),\n          end: endOfDay(endOfMonth(lastMonth)),\n        }; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":334,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10747,10750],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10747,10750],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":343,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":343,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11010,11013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11010,11013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":361,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":361,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11640,11643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11640,11643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo, useCallback, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { DateRangePicker } from \"@/components/DateRangePicker\";\nimport { ProjectSheetView } from \"@/components/ProjectSheetView\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport {\n  format,\n  subDays,\n  subMonths,\n  startOfMonth,\n  startOfQuarter,\n  startOfYear,\n  endOfMonth,\n  eachDayOfInterval,\n  eachWeekOfInterval,\n  eachMonthOfInterval,\n  startOfDay,\n  endOfDay,\n  isSameDay,\n  startOfWeek,\n  endOfWeek,\n} from \"date-fns\";\nimport type { DateRange } from \"react-day-picker\";\nimport { cn, formatDate, getDateFnsLocale } from \"@/lib/utils\";\nimport GlobalSearch from \"@/components/GlobalSearch\";\nimport { PageHeader, PageHeaderSearch } from \"@/components/ui/page-header\";\nimport { TableLoadingSkeleton } from \"@/components/ui/loading-presets\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  type ChartConfig,\n} from \"@/components/ui/chart\";\nimport { Line, LineChart, CartesianGrid, XAxis, YAxis } from \"recharts\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { FileDown, Loader2 } from \"lucide-react\";\nimport { writeFileXLSX, utils as XLSXUtils } from \"xlsx/xlsx.mjs\";\nimport { PAYMENT_COLORS } from \"@/lib/paymentColors\";\nimport {\n  AdvancedDataTable,\n  type AdvancedDataTableSortState,\n} from \"@/components/data-table\";\nimport { PAGE_SIZE, SEARCH_MIN_CHARS } from \"@/pages/payments/constants\";\nimport {\n  DateFilterType,\n  Payment,\n  PaymentMetrics,\n  PaymentTrendPoint,\n  ProjectDetails,\n  SortDirection,\n  SortField,\n  TrendGrouping,\n} from \"@/pages/payments/types\";\nimport { usePaymentsData } from \"@/pages/payments/hooks/usePaymentsData\";\nimport { usePaymentsFilters } from \"@/pages/payments/hooks/usePaymentsFilters\";\nimport { usePaymentsTableColumns } from \"@/pages/payments/hooks/usePaymentsTableColumns\";\nimport { PaymentsDateControls } from \"@/pages/payments/components/PaymentsDateControls\";\nimport { PaymentsTrendChart } from \"@/pages/payments/components/PaymentsTrendChart\";\nimport { PaymentsMetricsSummary } from \"@/pages/payments/components/PaymentsMetricsSummary\";\nimport { PaymentsTableSection } from \"@/pages/payments/components/PaymentsTableSection\";\nimport { useThrottledRefetchOnFocus } from \"@/hooks/useThrottledRefetchOnFocus\";\n\nconst Payments = () => {\n  const { t } = useTranslation(\"pages\");\nconst [page, setPage] = useState(1);\nconst pageSize = PAGE_SIZE;\n  const [exporting, setExporting] = useState(false);\n  const [selectedFilter, setSelectedFilter] = useState<DateFilterType>('allTime');\n  const [customDateRange, setCustomDateRange] = useState<DateRange | undefined>();\n  const [sortField, setSortField] = useState<SortField>(\"date_paid\");\n  const [sortDirection, setSortDirection] = useState<SortDirection>(\"desc\");\n  const [selectedProject, setSelectedProject] = useState<ProjectDetails | null>(null);\n  const [projectSheetOpen, setProjectSheetOpen] = useState(false);\n  const [trendGrouping, setTrendGrouping] = useState<TrendGrouping>(\"month\");\n  const sheetCloseTimeoutRef = useRef<number | null>(null);\n  const navigate = useNavigate();\n  const isMobile = useIsMobile();\n  const dateLocale = useMemo(() => getDateFnsLocale(), []);\n  const handleDataError = useCallback((error: Error) => {\n    toast({\n      title: t(\"payments.errorFetching\"),\n      description: error.message,\n      variant: \"destructive\",\n    });\n  }, [t]);\n  const {\n    state: filtersState,\n    filtersConfig,\n    searchValue,\n    onSearchChange,\n    activeFilterCount,\n  } = usePaymentsFilters({\n    onStateChange: () => {\n      setPage(1);\n    },\n  });\n  const compactCurrencyFormatter = useMemo(\n    () =>\n      new Intl.NumberFormat(\"tr-TR\", {\n        notation: \"compact\",\n        maximumFractionDigits: 1,\n      }),\n    []\n  );\n\n  const currencyFormatter = useMemo(\n    () =>\n      new Intl.NumberFormat(\"tr-TR\", {\n        style: \"currency\",\n        currency: \"TRY\",\n        minimumFractionDigits: 0,\n      }),\n    []\n  );\n\n  const formatCurrency = useCallback(\n    (amount: number) => currencyFormatter.format(amount),\n    [currencyFormatter]\n  );\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    const stored = window.localStorage.getItem(\"paymentsTrendGrouping\") as TrendGrouping | null;\n    if (stored === \"day\" || stored === \"week\" || stored === \"month\") {\n      setTrendGrouping(stored);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") {\n      return;\n    }\n\n    window.localStorage.setItem(\"paymentsTrendGrouping\", trendGrouping);\n  }, [trendGrouping]);\n\n  useEffect(() => {\n    setPage(1);\n  }, [selectedFilter, customDateRange]);\n\n  useEffect(() => {\n    return () => {\n      if (sheetCloseTimeoutRef.current) {\n        window.clearTimeout(sheetCloseTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  const getDateRangeForFilter = useCallback((filter: DateFilterType): { start: Date; end: Date } | null => {\n    const now = new Date();\n    const endToday = endOfDay(now);\n    switch (filter) {\n      case 'last7days':\n        return { start: startOfDay(subDays(endToday, 6)), end: endToday };\n      case 'last4weeks':\n        return { start: startOfDay(subDays(endToday, 27)), end: endToday };\n      case 'last3months':\n        return { start: startOfDay(subMonths(endToday, 3)), end: endToday };\n      case 'last12months':\n        return { start: startOfDay(subMonths(endToday, 12)), end: endToday };\n      case 'monthToDate':\n        return { start: startOfDay(startOfMonth(now)), end: endToday };\n      case 'quarterToDate':\n        return { start: startOfDay(startOfQuarter(now)), end: endToday };\n      case 'yearToDate':\n        return { start: startOfDay(startOfYear(now)), end: endToday };\n      case 'lastMonth':\n        const lastMonth = subMonths(now, 1);\n        return {\n          start: startOfDay(startOfMonth(lastMonth)),\n          end: endOfDay(endOfMonth(lastMonth)),\n        };\n      case 'allTime':\n      case 'custom':\n        if (customDateRange?.from) {\n          return {\n            start: startOfDay(customDateRange.from),\n            end: endOfDay(customDateRange.to ?? customDateRange.from),\n          };\n        }\n        return null;\n      default:\n        return null;\n    }\n  }, [customDateRange]);\n\n  const activeDateRange = useMemo(\n    () => getDateRangeForFilter(selectedFilter),\n    [getDateRangeForFilter, selectedFilter]\n  );\n\n  const {\n    paginatedPayments,\n    metricsPayments,\n    totalCount,\n    initialLoading,\n    tableLoading,\n    fetchPayments,\n    fetchPaymentsData,\n  } = usePaymentsData({\n    page,\n    pageSize,\n    sortField,\n    sortDirection,\n    statusFilters: filtersState.status,\n    typeFilters: filtersState.type,\n    amountMinFilter: filtersState.amountMin,\n    amountMaxFilter: filtersState.amountMax,\n    searchTerm: filtersState.search,\n    activeDateRange,\n    onError: handleDataError,\n  });\n\n  // Throttle data refresh on window focus / visibility changes\n  const refreshPayments = useCallback(async () => {\n    setPage(1);\n    await fetchPayments();\n  }, [fetchPayments]);\n\n  useThrottledRefetchOnFocus(refreshPayments, 30_000);\n\n  useEffect(() => {\n    const computedTotalPages = Math.max(1, Math.ceil(totalCount / pageSize));\n    if (page > computedTotalPages) {\n      setPage(computedTotalPages);\n    }\n  }, [totalCount, page, pageSize]);\n\n  // Project row open/close handlers (define before columns so columns can reference them)\n  const handleProjectSheetOpenChange = useCallback((open: boolean) => {\n    if (sheetCloseTimeoutRef.current) {\n      window.clearTimeout(sheetCloseTimeoutRef.current);\n      sheetCloseTimeoutRef.current = null;\n    }\n    setProjectSheetOpen(open);\n    if (!open) {\n      sheetCloseTimeoutRef.current = window.setTimeout(() => {\n        setSelectedProject(null);\n        sheetCloseTimeoutRef.current = null;\n      }, 300);\n    }\n  }, []);\n\n  const handleProjectOpen = useCallback(\n    (payment: Payment) => {\n      if (!payment.project_id || !payment.projects) {\n        return;\n      }\n      if (isMobile) {\n        navigate(`/projects/${payment.project_id}`);\n        return;\n      }\n      setSelectedProject(payment.projects);\n      handleProjectSheetOpenChange(true);\n    },\n    [handleProjectSheetOpenChange, isMobile, navigate]\n  );\n\n  const handleNavigateToLead = useCallback(\n    (leadId: string) => {\n      navigate(`/leads/${leadId}`);\n    },\n    [navigate]\n  );\n\n  // Columns are needed for export mapping; define before handleExport\n  const tableColumns = usePaymentsTableColumns({\n    onProjectSelect: handleProjectOpen,\n    onNavigateToLead: handleNavigateToLead,\n    formatAmount: formatCurrency,\n  });\n\n  const handleExport = useCallback(async () => {\n    if (exporting) return;\n\n    const totalRecords = totalCount || paginatedPayments.length;\n    if (totalRecords === 0) {\n      toast({\n        title: t(\"payments.export.noDataTitle\"),\n        description: t(\"payments.export.noDataDescription\"),\n      });\n      return;\n    }\n\n    try {\n      setExporting(true);\n      const range = { from: 0, to: totalRecords - 1 };\n      const { payments: exportPayments } = await fetchPaymentsData({\n        range,\n        includeMetrics: false,\n        includeCount: false,\n      });\n\n      if (!exportPayments.length) {\n        toast({\n          title: t(\"payments.export.noDataTitle\"),\n          description: t(\"payments.export.noDataDescription\"),\n        });\n        return;\n      }\n\n      const visibleOrderedColumns = [...tableColumns];\n\n      const valueForColumn = (payment: Payment, columnId: string) => {\n        switch (columnId) {\n          case \"date_paid\":\n            return formatDate(payment.date_paid || payment.created_at);\n          case \"project\":\n            return payment.projects?.name ?? \"\";\n          case \"lead\":\n            return payment.projects?.leads?.name ?? \"\";\n          case \"amount\":\n            return Number(payment.amount);\n          case \"description\":\n            return payment.description?.trim() ?? \"\";\n          case \"status\": {\n            const isPaid = (payment.status || \"\").toLowerCase() === \"paid\";\n            return isPaid ? t(\"payments.status.paid\") : t(\"payments.status.due\");\n          }\n          case \"type\":\n            return payment.type === \"base_price\"\n              ? t(\"payments.type.base\")\n              : payment.type === \"extra\"\n                ? t(\"payments.type.extra\")\n                : t(\"payments.type.manual\");\n          default:\n            return (payment as any)[columnId] ?? \"\";\n        }\n      };\n\n      const columnLabels = visibleOrderedColumns.map((c) =>\n        typeof c.label === \"string\" ? c.label : String(c.label)\n      );\n\n      const rows = exportPayments.map((payment) => {\n        const obj: Record<string, any> = {};\n        visibleOrderedColumns.forEach((col, index) => {\n          obj[columnLabels[index]] = valueForColumn(payment, col.id);\n        });\n        return obj;\n      });\n\n      const worksheet = XLSXUtils.json_to_sheet(rows);\n      const workbook = XLSXUtils.book_new();\n      XLSXUtils.book_append_sheet(workbook, worksheet, \"Payments\");\n\n      const timestamp = format(new Date(), \"yyyy-MM-dd_HHmm\");\n      writeFileXLSX(workbook, `payments-${timestamp}.xlsx`);\n\n      toast({\n        title: t(\"payments.export.successTitle\"),\n        description: t(\"payments.export.successDescription\"),\n      });\n    } catch (error: any) {\n      toast({\n        title: t(\"payments.export.errorTitle\"),\n        description: error.message ?? t(\"payments.export.errorDescription\"),\n        variant: \"destructive\",\n      });\n    } finally {\n      setExporting(false);\n    }\n  }, [\n    exporting,\n    fetchPaymentsData,\n    paginatedPayments.length,\n    tableColumns,\n    t,\n    totalCount,\n  ]);\n\n  const selectedDateRange = useMemo(() => {\n    if (activeDateRange) {\n      return activeDateRange;\n    }\n\n    const sortedDates = metricsPayments\n      .map((payment) => new Date(payment.date_paid || payment.created_at))\n      .filter((date) => !Number.isNaN(date.getTime()))\n      .sort((a, b) => a.getTime() - b.getTime());\n\n    if (!sortedDates.length) {\n      return null;\n    }\n\n    const earliest = startOfDay(sortedDates[0]);\n    const latest =\n      selectedFilter === \"allTime\"\n        ? endOfDay(new Date())\n        : endOfDay(sortedDates[sortedDates.length - 1]);\n\n    return {\n      start: earliest,\n      end: latest,\n    };\n  }, [activeDateRange, metricsPayments, selectedFilter]);\n\n  const isCustomRangeMissing = selectedFilter === 'custom' && !customDateRange?.from;\n\n  const rangeLabel = useMemo(() => {\n    if (!selectedDateRange) {\n      return \"\";\n    }\n\n    if (isSameDay(selectedDateRange.start, selectedDateRange.end)) {\n      return format(selectedDateRange.start, \"PP\", { locale: dateLocale });\n    }\n\n    return `${format(selectedDateRange.start, \"PP\", { locale: dateLocale })} â€“ ${format(selectedDateRange.end, \"PP\", { locale: dateLocale })}`;\n  }, [selectedDateRange, dateLocale]);\n\n  const rangeNotice = useMemo(() => {\n    if (isCustomRangeMissing) {\n      return t(\"payments.range.noSelection\");\n    }\n\n    if (!rangeLabel) {\n      return t(\"payments.range.noData\");\n    }\n\n    return \"\";\n  }, [isCustomRangeMissing, rangeLabel, t]);\n\n  const chartConfig = useMemo<ChartConfig>(\n    () => ({\n      paid: {\n        label: t(\"payments.chart.legend.paid\"),\n        color: PAYMENT_COLORS.paid.hex,\n      },\n      due: {\n        label: t(\"payments.chart.legend.due\"),\n        color: PAYMENT_COLORS.due.hex,\n      },\n    }),\n    [t]\n  );\n\n  const chartLegendLabels = useMemo(\n    () => ({\n      paid: t(\"payments.chart.legend.paid\"),\n      due: t(\"payments.chart.legend.due\"),\n    }),\n    [t]\n  );\n\n  const paymentsTrend = useMemo<PaymentTrendPoint[]>(() => {\n    if (!selectedDateRange) {\n      return [];\n    }\n\n    const { start, end } = selectedDateRange;\n\n    if (start > end) {\n      return [];\n    }\n\n    const interval =\n      trendGrouping === \"day\"\n        ? eachDayOfInterval({ start, end })\n        : trendGrouping === \"week\"\n        ? eachWeekOfInterval({ start, end }, { locale: dateLocale })\n        : eachMonthOfInterval({ start, end });\n\n    if (!interval.length) {\n      return [];\n    }\n\n    type Bucket = {\n      paid: number;\n      due: number;\n      labelStart: Date;\n      labelEnd: Date;\n    };\n\n    const getBucketDescriptor = (date: Date) => {\n      switch (trendGrouping) {\n        case \"day\": {\n          const labelStart = startOfDay(date);\n          const labelEnd = endOfDay(date);\n          return {\n            key: format(labelStart, \"yyyy-MM-dd\"),\n            labelStart,\n            labelEnd,\n          };\n        }\n        case \"week\": {\n          const weekStart = startOfWeek(date, { locale: dateLocale });\n          const weekEnd = endOfWeek(weekStart, { locale: dateLocale });\n          return {\n            key: format(weekStart, \"yyyy-MM-dd\"),\n            labelStart: weekStart,\n            labelEnd: weekEnd,\n          };\n        }\n        default: {\n          const monthStart = startOfMonth(date);\n          const monthEnd = endOfMonth(monthStart);\n          return {\n            key: format(monthStart, \"yyyy-MM\"),\n            labelStart: monthStart,\n            labelEnd: monthEnd,\n          };\n        }\n      }\n    };\n\n    const buckets = new Map<string, Bucket>();\n\n    interval.forEach((date) => {\n      const { key, labelStart, labelEnd } = getBucketDescriptor(date);\n      if (!buckets.has(key)) {\n        buckets.set(key, { paid: 0, due: 0, labelStart, labelEnd });\n      }\n    });\n\n    metricsPayments.forEach((payment) => {\n      const paymentDate = new Date(payment.date_paid || payment.created_at);\n      if (Number.isNaN(paymentDate.getTime())) {\n        return;\n      }\n\n      if (paymentDate < start || paymentDate > end) {\n        return;\n      }\n\n      const { key } = getBucketDescriptor(paymentDate);\n      const bucket = buckets.get(key);\n      if (!bucket) {\n        return;\n      }\n\n      const amount = Number(payment.amount) || 0;\n      const isPaid = (payment.status || \"\").toLowerCase() === \"paid\";\n\n      if (isPaid) {\n        bucket.paid += amount;\n      } else {\n        bucket.due += amount;\n      }\n    });\n\n    const clampToRange = (date: Date) => {\n      if (date < start) return start;\n      if (date > end) return end;\n      return date;\n    };\n\n    const formatLabel = (bucket: Bucket) => {\n      const labelStart = clampToRange(bucket.labelStart);\n      const labelEnd = clampToRange(bucket.labelEnd);\n\n      if (trendGrouping === \"day\") {\n        return format(labelStart, \"dd MMM\", { locale: dateLocale });\n      }\n\n      if (trendGrouping === \"week\") {\n        const startLabel = format(labelStart, \"dd MMM\", { locale: dateLocale });\n        const endLabel = format(labelEnd, \"dd MMM\", { locale: dateLocale });\n        return startLabel === endLabel ? startLabel : `${startLabel} â€“ ${endLabel}`;\n      }\n\n      return format(labelStart, \"LLL yy\", { locale: dateLocale });\n    };\n\n    return Array.from(buckets.entries())\n      .sort(([keyA], [keyB]) => keyA.localeCompare(keyB))\n      .map(([, bucket]) => ({\n        period: formatLabel(bucket),\n        paid: bucket.paid,\n        due: bucket.due,\n      }));\n  }, [metricsPayments, selectedDateRange, trendGrouping, dateLocale]);\n\n  const metrics = useMemo((): PaymentMetrics => {\n    const totalInvoiced = metricsPayments.reduce(\n      (sum, p) => sum + Number(p.amount),\n      0\n    );\n\n    const totalPaid = metricsPayments\n      .filter((p) => (p.status || \"\").toLowerCase() === \"paid\")\n      .reduce((sum, p) => sum + Number(p.amount), 0);\n\n    const remainingBalance = metricsPayments\n      .filter((p) => (p.status || \"\").toLowerCase() !== \"paid\")\n      .reduce((sum, p) => sum + Number(p.amount), 0);\n\n    const collectionRate =\n      totalInvoiced > 0 ? totalPaid / totalInvoiced : 0;\n\n    return {\n      totalPaid,\n      totalInvoiced,\n      remainingBalance,\n      collectionRate,\n    };\n  }, [metricsPayments]);\n\n  const formatPercent = (value: number) => {\n    return new Intl.NumberFormat(\"tr-TR\", {\n      style: \"percent\",\n      maximumFractionDigits: 0,\n    }).format(value);\n  };\n\n  const hasTrendData = paymentsTrend.some(\n    (point) => Math.abs(point.paid) > 0 || Math.abs(point.due) > 0\n  );\n\n  const hasSearchTerm = filtersState.search.trim().length >= SEARCH_MIN_CHARS;\n  const hasAnyResults = totalCount > 0 || paginatedPayments.length > 0;\n\n  const hasMorePayments = paginatedPayments.length < totalCount;\n  const isLoadingMorePayments = tableLoading && page > 1;\n\n  const handleLoadMorePayments = useCallback(() => {\n    if (tableLoading || !hasMorePayments) return;\n    const totalPages = totalCount > 0 ? Math.ceil(totalCount / pageSize) : 0;\n    if (totalPages && page >= totalPages) return;\n    setPage((prev) => prev + 1);\n  }, [hasMorePayments, page, pageSize, tableLoading, totalCount]);\n\n  const exportActions = useMemo(\n    () => (\n      <Button\n        type=\"button\"\n        variant=\"outline\"\n        size=\"sm\"\n        onClick={handleExport}\n        disabled={!hasAnyResults || tableLoading || exporting}\n        className=\"hidden sm:inline-flex\"\n      >\n        {exporting ? (\n          <Loader2 className=\"h-4 w-4 animate-spin\" />\n        ) : (\n          <FileDown className=\"h-4 w-4\" />\n        )}\n        <span>{t(\"payments.export.button\")}</span>\n      </Button>\n    ),\n    [exporting, handleExport, hasAnyResults, tableLoading, t]\n  );\n\n  // Use AdvancedDataTable's built-in header search instead of toolbar\n\n  const emptyStateMessage =\n    hasSearchTerm || activeFilterCount > 0\n      ? t(\"payments.emptyState.noPaymentsWithFilters\")\n      : t(\"payments.emptyState.noPaymentsForPeriod\");\n\n  // Build filter summary chips similar to leads/projects\n  const filterSummaryChips = useMemo(() => {\n    const chips: { id: string; label: React.ReactNode }[] = [];\n\n    const renderLabel = (\n      heading: string,\n      value: string\n    ) => (\n      <span>\n        <span className=\"mr-1 text-xs uppercase tracking-wide text-muted-foreground\">\n          {heading}:\n        </span>\n        {value}\n      </span>\n    );\n\n    if (filtersState.status.length) {\n      const statusLabel = filtersState.status\n        .map((value) =>\n          value === \"paid\"\n            ? t(\"payments.status.paid\")\n            : t(\"payments.status.due\")\n        )\n        .join(\", \");\n\n      chips.push({\n        id: \"status\",\n        label: renderLabel(t(\"payments.filters.statusHeading\"), statusLabel),\n      });\n    }\n\n    if (filtersState.type.length) {\n      const typeLabel = filtersState.type\n        .map((value) => {\n          switch (value) {\n            case \"base_price\":\n              return t(\"payments.type.base\");\n            case \"extra\":\n              return t(\"payments.type.extra\");\n            default:\n              return t(\"payments.type.manual\");\n          }\n        })\n        .join(\", \");\n\n      chips.push({\n        id: \"type\",\n        label: renderLabel(t(\"payments.filters.typeHeading\"), typeLabel),\n      });\n    }\n\n    if (filtersState.amountMin != null || filtersState.amountMax != null) {\n      const amountParts: string[] = [];\n      if (filtersState.amountMin != null) {\n        amountParts.push(\n          `${t(\"payments.filters.amountMinPlaceholder\")}: ${formatCurrency(filtersState.amountMin)}`\n        );\n      }\n      if (filtersState.amountMax != null) {\n        amountParts.push(\n          `${t(\"payments.filters.amountMaxPlaceholder\")}: ${formatCurrency(filtersState.amountMax)}`\n        );\n      }\n\n      chips.push({\n        id: \"amount\",\n        label: renderLabel(\n          t(\"payments.filters.amountHeading\"),\n          amountParts.join(\" â€¢ \")\n        ),\n      });\n    }\n\n    return chips;\n  }, [\n    filtersState.amountMax,\n    filtersState.amountMin,\n    filtersState.status,\n    filtersState.type,\n    formatCurrency,\n    t,\n  ]);\n\n  // (moved up above columns)\n\n  const handleViewFullDetails = useCallback(() => {\n    if (!selectedProject) return;\n    navigate(`/projects/${selectedProject.id}`);\n    handleProjectSheetOpenChange(false);\n  }, [handleProjectSheetOpenChange, navigate, selectedProject]);\n\n  // tableColumns defined above (before handleExport)\n\n  const sortStateForTable = useMemo<AdvancedDataTableSortState>(\n    () => ({ columnId: sortField, direction: sortDirection }),\n    [sortField, sortDirection]\n  );\n\n  const handleTableSortChange = useCallback(\n    (next: AdvancedDataTableSortState) => {\n      if (!next.columnId) return;\n      setSortField(next.columnId as SortField);\n      setSortDirection(next.direction as SortDirection);\n      setPage(1);\n    },\n    []\n  );\n\n  return (\n    <div className=\"min-h-screen overflow-x-hidden\">\n      <PageHeader\n        title={t(\"payments.title\")}\n        subtitle={t(\"payments.subtitle\")}\n      >\n        <PageHeaderSearch>\n          <GlobalSearch />\n        </PageHeaderSearch>\n      </PageHeader>\n\n      <div className=\"p-4 sm:p-6\">\n        {initialLoading ? (\n          <TableLoadingSkeleton />\n        ) : (\n          <>\n\n      {/* Date Filter */}\n      <PaymentsDateControls\n        rangeLabel={rangeLabel}\n        rangeNotice={rangeNotice}\n        selectedFilter={selectedFilter}\n        onSelectedFilterChange={setSelectedFilter}\n        customDateRange={customDateRange}\n        onCustomDateRangeChange={setCustomDateRange}\n      />\n\n      {/* Metrics Cards */}\n      <div className=\"grid gap-6 mb-8 lg:grid-cols-[minmax(0,2fr),minmax(0,1fr)]\">\n        <PaymentsTrendChart\n          hasTrendData={hasTrendData}\n          chartConfig={chartConfig}\n          chartLegendLabels={chartLegendLabels}\n          paymentsTrend={paymentsTrend}\n          trendGrouping={trendGrouping}\n          onTrendGroupingChange={setTrendGrouping}\n          rangeLabel={rangeLabel}\n          compactCurrencyFormatter={compactCurrencyFormatter}\n          formatCurrency={formatCurrency}\n        />\n        <PaymentsMetricsSummary\n          metrics={metrics}\n          formatCurrency={formatCurrency}\n          formatPercent={formatPercent}\n        />\n      </div>\n\n      {/* Payments Table */}\n      <PaymentsTableSection\n        title={t(\"payments.tableTitle\")}\n        data={paginatedPayments}\n        columns={tableColumns}\n        filters={filtersConfig}\n        toolbar={undefined}\n        summary={{ text: undefined, chips: filterSummaryChips }}\n        actions={exportActions}\n        sortState={sortStateForTable}\n        onSortChange={handleTableSortChange}\n        searchValue={searchValue}\n        onSearchChange={onSearchChange}\n        searchPlaceholder={t(\"payments.searchPlaceholder\")}\n        searchLoading={tableLoading}\n        searchMinChars={SEARCH_MIN_CHARS}\n        emptyState={<div className=\"text-muted-foreground\">{emptyStateMessage}</div>}\n        onRowClick={handleProjectOpen}\n        isLoading={tableLoading && page === 1 && paginatedPayments.length === 0}\n        onLoadMore={hasMorePayments ? handleLoadMorePayments : undefined}\n        hasMore={hasMorePayments}\n        isLoadingMore={isLoadingMorePayments}\n      />\n\n      {/* Project Details Dialog */}\n      <ProjectSheetView\n        project={selectedProject}\n        open={projectSheetOpen}\n        onOpenChange={handleProjectSheetOpenChange}\n        onProjectUpdated={refreshPayments}\n        leadName={selectedProject?.leads?.name ?? \"\"}\n        mode=\"sheet\"\n        onViewFullDetails={handleViewFullDetails}\n      />\n          </>\n        )}\n      </div>\n\n    </div>\n  );\n};\n\nexport default Payments;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/ProjectDetail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/ReminderDetails.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":309,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10253,10256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10253,10256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchReminders'. Either include it or remove the dependency array.","line":314,"column":6,"nodeType":"ArrayExpression","endLine":314,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchReminders]","fix":{"range":[10387,10389],"text":"[fetchReminders]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":345,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11436,11439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11436,11439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":624,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":624,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22395,22398],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22395,22398],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":661,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":661,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23642,23645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23642,23645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo, useCallback } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useTranslation } from \"react-i18next\";\nimport { useFormsTranslation } from \"@/hooks/useTypedTranslation\";\nimport { useThrottledRefetchOnFocus } from \"@/hooks/useThrottledRefetchOnFocus\";\nimport { Button } from \"@/components/ui/button\";\nimport { KpiCard } from \"@/components/ui/kpi-card\";\nimport { getKpiIconPreset } from \"@/components/ui/kpi-presets\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { PageHeader, PageHeaderSearch } from \"@/components/ui/page-header\";\nimport GlobalSearch from \"@/components/GlobalSearch\";\nimport { FilterBar } from \"@/components/FilterBar\";\nimport { ListLoadingSkeleton } from \"@/components/ui/loading-presets\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { useNavigate } from \"react-router-dom\";\nimport { ViewProjectDialog } from \"@/components/ViewProjectDialog\";\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger\n} from \"@/components/ui/accordion\";\nimport {\n  ArrowUpRight,\n  Bell,\n  BellRing,\n  CalendarRange,\n  CheckCircle2,\n  Clock,\n  RotateCcw,\n  SunMedium,\n  UserCircle\n} from \"lucide-react\";\nimport { cn, formatGroupDate, formatTime, getWeekRange } from \"@/lib/utils\";\n\ninterface Activity {\n  id: string;\n  content: string;\n  reminder_date: string;\n  reminder_time: string | null;\n  type: string;\n  lead_id: string;\n  project_id?: string | null;\n  created_at: string;\n  updated_at: string;\n  completed?: boolean;\n}\n\ninterface Lead {\n  id: string;\n  name: string;\n  status: string;\n}\n\ntype FilterType = \"all\" | \"overdue\" | \"today\" | \"tomorrow\" | \"thisWeek\" | \"nextWeek\" | \"thisMonth\";\n\n\n\ninterface ReminderTimelineLabels {\n  lead: string;\n  markComplete: string;\n  markIncomplete: string;\n  openLead: string;\n  openProject: string;\n  noTime: string;\n  overdue: string;\n  today: string;\n  tomorrow: string;\n  completed: string;\n}\n\ninterface ReminderTimelineItemProps {\n  activity: Activity;\n  leadName: string;\n  onToggleCompletion: (activityId: string, completed: boolean) => void;\n  onNavigate: () => void;\n  onNavigateProject?: () => void;\n  isOverdue: boolean;\n  isToday: boolean;\n  isTomorrow: boolean;\n  labels: ReminderTimelineLabels;\n  hasProject?: boolean;\n}\n\nconst filterPillBaseClasses =\n  \"h-9 rounded-full px-3 border border-border/60 bg-background text-sm font-medium text-muted-foreground transition-colors hover:border-primary/30 hover:bg-primary/5 hover:text-foreground focus-visible:ring-2 focus-visible:ring-primary/30 focus-visible:ring-offset-0\";\nconst filterPillActiveClasses =\n  \"bg-primary/10 text-primary border-primary/40 shadow-sm hover:bg-primary/15\";\nconst filterPillBadgeBaseClasses =\n  \"ml-2 h-5 min-w-[2rem] rounded-full border border-border/50 bg-muted/40 px-2 text-xs font-medium text-muted-foreground transition-colors\";\nconst filterPillBadgeActiveClasses =\n  \"border-primary/30 bg-primary/15 text-primary\";\n\n// Legacy summary card removed in favor of shared <KpiCard /> component used across the app\n\nconst parseTimeValue = (time?: string | null, direction: \"asc\" | \"desc\" = \"asc\") => {\n  if (!time) {\n    return direction === \"desc\" ? -1 : Number.MAX_SAFE_INTEGER;\n  }\n\n  const [hours, minutes] = time.split(\":\").map(Number);\n  return hours * 60 + minutes;\n};\n\nconst groupActivitiesByDate = (\n  activities: Activity[],\n  order: \"asc\" | \"desc\" = \"asc\"\n) => {\n  const groups = new Map<string, Activity[]>();\n\n  activities.forEach((activity) => {\n    if (!activity.reminder_date) return;\n    const existing = groups.get(activity.reminder_date);\n    if (existing) {\n      existing.push(activity);\n    } else {\n      groups.set(activity.reminder_date, [activity]);\n    }\n  });\n\n  const sortedEntries = Array.from(groups.entries()).sort((a, b) => {\n    const dateA = new Date(a[0]).getTime();\n    const dateB = new Date(b[0]).getTime();\n    return dateA - dateB;\n  });\n\n  if (order === \"desc\") {\n    sortedEntries.reverse();\n  }\n\n  return sortedEntries.map(([date, items]) => ({\n    date,\n    items: items.sort((first, second) => {\n      const firstValue = parseTimeValue(first.reminder_time, order);\n      const secondValue = parseTimeValue(second.reminder_time, order);\n      return order === \"desc\" ? secondValue - firstValue : firstValue - secondValue;\n    })\n  }));\n};\n\nconst ReminderTimelineItem = ({\n  activity,\n  leadName,\n  onToggleCompletion,\n  onNavigate,\n  onNavigateProject,\n  isOverdue,\n  isToday,\n  isTomorrow,\n  labels\n}: ReminderTimelineItemProps) => {\n  const statusConfig = (() => {\n    if (activity.completed) {\n      return {\n        label: labels.completed,\n        className:\n          \"bg-emerald-100 text-emerald-700 border-emerald-200 dark:bg-emerald-950/60 dark:text-emerald-300 dark:border-emerald-900\",\n        indicatorClassName: \"border-emerald-300 bg-emerald-400/90\"\n      };\n    }\n\n    if (isOverdue) {\n      return {\n        label: labels.overdue,\n        className:\n          \"bg-destructive/10 text-destructive border-destructive/20\",\n        indicatorClassName: \"border-destructive/50 bg-destructive\"\n      };\n    }\n\n    if (isToday) {\n      return {\n        label: labels.today,\n        className:\n          \"bg-primary/10 text-primary border-primary/20\",\n        indicatorClassName: \"border-primary/40 bg-primary/80\"\n      };\n    }\n\n    if (isTomorrow) {\n      return {\n        label: labels.tomorrow,\n        className:\n          \"bg-amber-100 text-amber-700 border-amber-200 dark:bg-amber-500/20 dark:text-amber-200 dark:border-amber-400/30\",\n        indicatorClassName: \"border-amber-300 bg-amber-400\"\n      };\n    }\n\n    return null;\n  })();\n\n  const indicatorClassName = statusConfig\n    ? statusConfig.indicatorClassName\n    : \"border-border/70 bg-muted-foreground/70\";\n\n  return (\n    <div className=\"relative pl-8\">\n      <span\n        className={cn(\n          \"absolute left-[6px] top-5 h-2.5 w-2.5 rounded-full border-2 bg-background\",\n          indicatorClassName\n        )}\n        aria-hidden=\"true\"\n      />\n      <div className=\"rounded-xl border border-border/70 bg-card/80 p-4 shadow-sm transition-all hover:border-primary/30 hover:shadow-md\">\n        <div className=\"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between\">\n          <div className=\"space-y-3\">\n            <div className=\"flex flex-wrap items-center gap-2\">\n              {statusConfig && (\n                <Badge className={cn(\"text-xs\", statusConfig.className)}>{statusConfig.label}</Badge>\n              )}\n            </div>\n            <div>\n              <h3\n                className={cn(\n                  \"text-base font-medium text-foreground\",\n                  activity.completed && \"line-through text-muted-foreground\"\n                )}\n              >\n                {activity.content}\n              </h3>\n              <div className=\"mt-2 flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-muted-foreground\">\n                <div className=\"flex items-center gap-1.5\">\n                  <UserCircle className=\"h-4 w-4\" aria-hidden=\"true\" />\n                  <span className=\"font-medium text-foreground\">{labels.lead}:</span>\n                  <span className=\"text-muted-foreground\">{leadName}</span>\n                </div>\n                <div className=\"flex items-center gap-1.5\">\n                  <Clock className=\"h-4 w-4\" aria-hidden=\"true\" />\n                  <span>\n                    {activity.reminder_time ? formatTime(activity.reminder_time) : labels.noTime}\n                  </span>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div className=\"flex flex-col gap-2 sm:items-end\">\n            <Button\n              variant={activity.completed ? \"outline\" : \"secondary\"}\n              size=\"sm\"\n              className=\"flex items-center gap-2\"\n              onClick={(event) => {\n                event.preventDefault();\n                event.stopPropagation();\n                onToggleCompletion(activity.id, !activity.completed);\n              }}\n            >\n              {activity.completed ? (\n                <>\n                  <RotateCcw className=\"h-4 w-4\" aria-hidden=\"true\" />\n                  {labels.markIncomplete}\n                </>\n              ) : (\n                <>\n                  <CheckCircle2 className=\"h-4 w-4\" aria-hidden=\"true\" />\n                  {labels.markComplete}\n                </>\n              )}\n            </Button>\n            <div className=\"flex flex-wrap items-center gap-2 justify-end\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"flex items-center gap-2 text-primary\"\n                onClick={(event) => {\n                  event.preventDefault();\n                  event.stopPropagation();\n                  onNavigate();\n                }}\n              >\n                {labels.openLead}\n                <ArrowUpRight className=\"h-4 w-4\" aria-hidden=\"true\" />\n              </Button>\n              {typeof onNavigateProject === 'function' && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"flex items-center gap-2 text-primary\"\n                  onClick={(event) => {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    onNavigateProject?.();\n                  }}\n                >\n                  {labels.openProject}\n                  <ArrowUpRight className=\"h-4 w-4\" aria-hidden=\"true\" />\n                </Button>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n  );\n};\n\nconst ReminderDetails = () => {\n  const { t } = useTranslation(\"pages\");\n  const { t: tForms } = useFormsTranslation();\n  const [activities, setActivities] = useState<Activity[]>([]);\n  const [leads, setLeads] = useState<Lead[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedFilter, setSelectedFilter] = useState<FilterType>(\"today\");\n  const [showCompleted, setShowCompleted] = useState(false);\n  const [hideOverdue, setHideOverdue] = useState(false);\n  const navigate = useNavigate();\n  const [viewingProject, setViewingProject] = useState<any>(null);\n  const [showProjectDialog, setShowProjectDialog] = useState(false);\n\n  useEffect(() => {\n    void fetchReminders();\n  }, []);\n\n  // Throttled refresh on focus/visibility\n  useThrottledRefetchOnFocus(() => { void fetchReminders(); }, 30_000);\n\n  const fetchReminders = useCallback(async () => {\n    setLoading(true);\n    try {\n      const { data: activitiesData, error: activitiesError } = await supabase\n        .from(\"activities\")\n        .select(\"*\")\n        .not(\"reminder_date\", \"is\", null)\n        .order(\"reminder_date\", { ascending: true })\n        .order(\"reminder_time\", { ascending: true });\n\n      if (activitiesError) throw activitiesError;\n\n      if (activitiesData && activitiesData.length > 0) {\n        const leadIds = [...new Set(activitiesData.map((activity) => activity.lead_id))];\n        if (leadIds.length > 0) {\n          const { data: leadsData, error: leadsError } = await supabase\n            .from(\"leads\")\n            .select(\"id, name, status\")\n            .in(\"id\", leadIds);\n\n          if (leadsError) throw leadsError;\n          setLeads(leadsData || []);\n        }\n      }\n\n      setActivities(activitiesData || []);\n    } catch (error: any) {\n      toast({\n        title: \"Error fetching reminders\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  const getLeadName = useCallback(\n    (leadId: string) => {\n      const lead = leads.find((item) => item.id === leadId);\n      return lead?.name || \"Unknown Lead\";\n    },\n    [leads]\n  );\n\n  const isOverdue = useCallback((reminderDate: string) => {\n    const today = new Date();\n    const reminder = new Date(reminderDate);\n    today.setHours(0, 0, 0, 0);\n    reminder.setHours(0, 0, 0, 0);\n    return reminder.getTime() < today.getTime();\n  }, []);\n\n  const isToday = useCallback((reminderDate: string) => {\n    const today = new Date();\n    const reminder = new Date(reminderDate);\n    today.setHours(0, 0, 0, 0);\n    reminder.setHours(0, 0, 0, 0);\n    return reminder.getTime() === today.getTime();\n  }, []);\n\n  const isTomorrow = useCallback((reminderDate: string) => {\n    const tomorrow = new Date();\n    tomorrow.setDate(tomorrow.getDate() + 1);\n    const reminder = new Date(reminderDate);\n    tomorrow.setHours(0, 0, 0, 0);\n    reminder.setHours(0, 0, 0, 0);\n    return reminder.getTime() === tomorrow.getTime();\n  }, []);\n\n  const isThisWeek = useCallback((reminderDate: string) => {\n    const today = new Date();\n    const reminder = new Date(reminderDate);\n    const { start: startOfWeek, end: endOfWeek } = getWeekRange(today);\n    reminder.setHours(0, 0, 0, 0);\n    return reminder.getTime() >= startOfWeek.getTime() && reminder.getTime() <= endOfWeek.getTime();\n  }, []);\n\n  const isNextWeek = useCallback((reminderDate: string) => {\n    const today = new Date();\n    const reminder = new Date(reminderDate);\n    const nextWeekDate = new Date(today);\n    nextWeekDate.setDate(today.getDate() + 7);\n    const { start: startOfNextWeek, end: endOfNextWeek } = getWeekRange(nextWeekDate);\n    startOfNextWeek.setHours(0, 0, 0, 0);\n    endOfNextWeek.setHours(23, 59, 59, 999);\n    reminder.setHours(0, 0, 0, 0);\n    return reminder.getTime() >= startOfNextWeek.getTime() && reminder.getTime() <= endOfNextWeek.getTime();\n  }, []);\n\n  const isThisMonth = useCallback((reminderDate: string) => {\n    const today = new Date();\n    const reminder = new Date(reminderDate);\n    return today.getFullYear() === reminder.getFullYear() && today.getMonth() === reminder.getMonth();\n  }, []);\n\n  const getReminderCountForFilter = useCallback(\n    (filterType: FilterType) => {\n      const baseActivities = showCompleted ? activities : activities.filter((activity) => !activity.completed);\n\n      switch (filterType) {\n        case \"all\":\n          return baseActivities.length;\n        case \"overdue\":\n          return baseActivities.filter((activity) => isOverdue(activity.reminder_date)).length;\n        case \"today\":\n          return baseActivities.filter((activity) => isToday(activity.reminder_date)).length;\n        case \"tomorrow\":\n          return baseActivities.filter((activity) => isTomorrow(activity.reminder_date)).length;\n        case \"thisWeek\":\n          return baseActivities.filter((activity) => isThisWeek(activity.reminder_date)).length;\n        case \"nextWeek\":\n          return baseActivities.filter((activity) => isNextWeek(activity.reminder_date)).length;\n        case \"thisMonth\":\n          return baseActivities.filter((activity) => isThisMonth(activity.reminder_date)).length;\n        default:\n          return baseActivities.length;\n      }\n    },\n    [activities, showCompleted, isOverdue, isToday, isTomorrow, isThisWeek, isNextWeek, isThisMonth]\n  );\n\n  const quickFilters = useMemo(\n    () => [\n      { key: \"all\", label: t(\"reminders.filters.all\"), count: getReminderCountForFilter(\"all\") },\n      { key: \"today\", label: t(\"reminders.filters.today\"), count: getReminderCountForFilter(\"today\") },\n      { key: \"tomorrow\", label: t(\"reminders.filters.tomorrow\"), count: getReminderCountForFilter(\"tomorrow\") }\n    ],\n    [getReminderCountForFilter, t]\n  );\n\n  const allDateFilters = useMemo(\n    () => [\n      { key: \"all\", label: t(\"reminders.filters.all\"), count: getReminderCountForFilter(\"all\") },\n      { key: \"overdue\", label: t(\"reminders.filters.overdue\"), count: getReminderCountForFilter(\"overdue\") },\n      { key: \"today\", label: t(\"reminders.filters.today\"), count: getReminderCountForFilter(\"today\") },\n      { key: \"tomorrow\", label: t(\"reminders.filters.tomorrow\"), count: getReminderCountForFilter(\"tomorrow\") },\n      { key: \"thisWeek\", label: t(\"reminders.filters.thisWeek\"), count: getReminderCountForFilter(\"thisWeek\") },\n      { key: \"nextWeek\", label: t(\"reminders.filters.nextWeek\"), count: getReminderCountForFilter(\"nextWeek\") },\n      { key: \"thisMonth\", label: t(\"reminders.filters.thisMonth\"), count: getReminderCountForFilter(\"thisMonth\") }\n    ],\n    [getReminderCountForFilter, t]\n  );\n\n  const stats = useMemo(() => {\n    const active = activities.filter((activity) => !activity.completed);\n    const overdue = active.filter((activity) => isOverdue(activity.reminder_date)).length;\n    const todayCount = active.filter((activity) => isToday(activity.reminder_date)).length;\n    const tomorrowCount = active.filter((activity) => isTomorrow(activity.reminder_date)).length;\n    const upcoming = active.filter(\n      (activity) => !isOverdue(activity.reminder_date) && !isToday(activity.reminder_date)\n    ).length;\n    const completed = activities.filter((activity) => activity.completed).length;\n\n    return {\n      overdue,\n      today: todayCount,\n      tomorrow: tomorrowCount,\n      upcoming,\n      completed\n    };\n  }, [activities, isOverdue, isToday, isTomorrow]);\n\n  // Upcoming breakdown for CTA buttons and main figure\n  const upcomingBreakdown = useMemo(() => {\n    const active = activities.filter((a) => !a.completed);\n    const tomorrow = active.filter((a) => isTomorrow(a.reminder_date)).length;\n    const thisWeek = active.filter(\n      (a) => isThisWeek(a.reminder_date) && !isToday(a.reminder_date) && !isTomorrow(a.reminder_date)\n    ).length;\n    const nextWeek = active.filter((a) => isNextWeek(a.reminder_date)).length;\n    const total = tomorrow + thisWeek + nextWeek;\n    return { tomorrow, thisWeek, nextWeek, total };\n  }, [activities, isThisWeek, isNextWeek, isToday, isTomorrow]);\n\n  // Completion details\n  const completedToday = useMemo(\n    () => activities.filter((a) => a.completed && isToday(a.reminder_date)).length,\n    [activities, isToday]\n  );\n\n  const { activeActivities, completedActivities } = useMemo(() => {\n    const active = activities.filter((activity) => !activity.completed);\n    const completed = activities.filter((activity) => activity.completed);\n\n    let filteredActive: Activity[] = [];\n    let filteredCompleted: Activity[] = [];\n\n    switch (selectedFilter) {\n      case \"all\":\n        filteredActive = active;\n        filteredCompleted = completed;\n        break;\n      case \"overdue\":\n        filteredActive = active.filter((activity) => isOverdue(activity.reminder_date));\n        filteredCompleted = completed.filter((activity) => isOverdue(activity.reminder_date));\n        break;\n      case \"today\":\n        filteredActive = active.filter((activity) => isToday(activity.reminder_date));\n        filteredCompleted = completed.filter((activity) => isToday(activity.reminder_date));\n        break;\n      case \"tomorrow\":\n        filteredActive = active.filter((activity) => isTomorrow(activity.reminder_date));\n        filteredCompleted = completed.filter((activity) => isTomorrow(activity.reminder_date));\n        break;\n      case \"thisWeek\":\n        filteredActive = active.filter((activity) => isThisWeek(activity.reminder_date));\n        filteredCompleted = completed.filter((activity) => isThisWeek(activity.reminder_date));\n        break;\n      case \"nextWeek\":\n        filteredActive = active.filter((activity) => isNextWeek(activity.reminder_date));\n        filteredCompleted = completed.filter((activity) => isNextWeek(activity.reminder_date));\n        break;\n      case \"thisMonth\":\n        filteredActive = active.filter((activity) => isThisMonth(activity.reminder_date));\n        filteredCompleted = completed.filter((activity) => isThisMonth(activity.reminder_date));\n        break;\n      default:\n        filteredActive = active;\n        filteredCompleted = completed;\n        break;\n    }\n\n    let finalActive = filteredActive;\n\n    if (selectedFilter !== \"overdue\") {\n      const overdueActivities = active.filter((activity) => isOverdue(activity.reminder_date));\n      const nonOverdue = filteredActive.filter((activity) => !isOverdue(activity.reminder_date));\n      finalActive = [...overdueActivities, ...nonOverdue];\n    }\n\n    if (hideOverdue) {\n      finalActive = finalActive.filter((activity) => !isOverdue(activity.reminder_date));\n    }\n\n    const visibleCompleted = (showCompleted || selectedFilter === \"all\") ? filteredCompleted : [];\n\n    return {\n      activeActivities: finalActive,\n      completedActivities: visibleCompleted\n    };\n  }, [\n    activities,\n    selectedFilter,\n    showCompleted,\n    hideOverdue,\n    isOverdue,\n    isToday,\n    isTomorrow,\n    isThisWeek,\n    isNextWeek,\n    isThisMonth\n  ]);\n\n  const groupedActiveActivities = useMemo(\n    () => groupActivitiesByDate(activeActivities, \"asc\"),\n    [activeActivities]\n  );\n\n  const groupedCompletedActivities = useMemo(\n    () => groupActivitiesByDate(completedActivities, \"desc\"),\n    [completedActivities]\n  );\n\n  const labels = useMemo<ReminderTimelineLabels>(\n    () => ({\n      lead: tForms(\"reminders.lead\"),\n      markComplete: tForms(\"reminders.markComplete\"),\n      markIncomplete: tForms(\"reminders.markIncomplete\"),\n      openLead: t(\"reminders.timeline.openLead\"),\n      openProject: t(\"reminders.timeline.openProject\"),\n      noTime: tForms(\"reminders.noTime\"),\n      overdue: tForms(\"reminders.overdue\"),\n      today: tForms(\"reminders.today\"),\n      tomorrow: tForms(\"reminders.tomorrow\"),\n      completed: tForms(\"reminders.completed\")\n    }),\n    [t, tForms]\n  );\n\n  // Icon presets to match shared KPI card design\n  const overdueIconPreset = useMemo(() => getKpiIconPreset('red'), []);\n  const todayIconPreset = useMemo(() => getKpiIconPreset('yellow'), []);\n  const upcomingIconPreset = useMemo(() => getKpiIconPreset('sky'), []);\n  const completedIconPreset = useMemo(() => getKpiIconPreset('emerald'), []);\n\n  const toggleCompletion = async (activityId: string, completed: boolean) => {\n    try {\n      const { error } = await supabase\n        .from(\"activities\")\n        .update({ completed })\n        .eq(\"id\", activityId);\n\n      if (error) throw error;\n\n      setActivities((prev) =>\n        prev.map((activity) =>\n          activity.id === activityId ? { ...activity, completed } : activity\n        )\n      );\n\n      toast({\n        title: completed ? \"Reminder marked as completed\" : \"Reminder marked as not completed\",\n        description: \"Reminder status updated successfully.\"\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Error updating reminder\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const handleReminderClick = (leadId: string) => {\n    navigate(`/leads/${leadId}`);\n  };\n\n  const handleProjectClick = useCallback(async (projectId?: string | null) => {\n    if (!projectId) return;\n    try {\n      const { data, error } = await supabase\n        .from('projects')\n        .select('id, name, description, lead_id, user_id, created_at, updated_at, status_id, previous_status_id, project_type_id')\n        .eq('id', projectId)\n        .single();\n      if (error) throw error;\n\n      const { data: leadData, error: leadError } = await supabase\n        .from('leads')\n        .select('id, name, status')\n        .eq('id', data.lead_id)\n        .single();\n      if (leadError) throw leadError;\n\n      setViewingProject(data);\n      setShowProjectDialog(true);\n      // Ensure leads map has the project's lead name for the dialog\n      setLeads((prev) => {\n        const exists = prev.some((l) => l.id === data.lead_id);\n        return exists ? prev : [...prev, { id: data.lead_id, name: leadData?.name || 'Unknown Lead', status: leadData?.status || '' }];\n      });\n    } catch (err: any) {\n      toast({ title: 'Unable to open project', description: err.message, variant: 'destructive' });\n    }\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <PageHeader title={t(\"reminders.title\")} subtitle={t(\"reminders.description\")}> \n        <PageHeaderSearch>\n          <div className=\"flex items-center gap-2 w-full\">\n            <div className=\"flex-1 min-w-0\">\n              <GlobalSearch />\n            </div>\n          </div>\n        </PageHeaderSearch>\n      </PageHeader>\n\n      <div className=\"p-4 sm:p-6 space-y-6\">\n        {loading ? (\n          <ListLoadingSkeleton />\n        ) : (\n          <>\n            <div className=\"grid gap-4 md:grid-cols-2 xl:grid-cols-4\">\n              <KpiCard\n                className=\"h-full\"\n                density=\"compact\"\n                icon={BellRing}\n                {...overdueIconPreset}\n                title={t('reminders.stats.overdue')}\n                value={stats.overdue}\n                info={{\n                  content: t('reminders.statsDescriptions.overdue'),\n                  ariaLabel: t('reminders.stats.overdue'),\n                }}\n              />\n\n              <KpiCard\n                className=\"h-full\"\n                density=\"compact\"\n                icon={SunMedium}\n                {...todayIconPreset}\n                iconForeground=\"text-white\"\n                title={t('reminders.stats.today')}\n                value={stats.today}\n                info={{\n                  content: t('reminders.statsDescriptions.today'),\n                  ariaLabel: t('reminders.stats.today'),\n                }}\n              />\n\n              <KpiCard\n                className=\"h-full\"\n                density=\"compact\"\n                icon={CalendarRange}\n                {...upcomingIconPreset}\n                title={t('reminders.stats.upcoming')}\n                value={upcomingBreakdown.total}\n                info={{\n                  content: t('reminders.statsDescriptions.upcoming', { tomorrow: upcomingBreakdown.tomorrow, later: upcomingBreakdown.thisWeek + upcomingBreakdown.nextWeek }),\n                  ariaLabel: t('reminders.stats.upcoming'),\n                }}\n              />\n\n              <KpiCard\n                className=\"h-full\"\n                density=\"compact\"\n                icon={CheckCircle2}\n                {...completedIconPreset}\n                title={t('reminders.stats.completed')}\n                value={stats.completed}\n                info={{\n                  content: t('reminders.kpis.completedInfo', { today: completedToday, allTime: stats.completed }),\n                  ariaLabel: t('reminders.stats.completed')\n                }}\n              />\n            </div>\n\n            <div className=\"md:hidden\">\n              <FilterBar\n                quickFilters={quickFilters}\n                activeQuickFilter={selectedFilter}\n                onQuickFilterChange={(filter) => setSelectedFilter(filter as FilterType)}\n                allDateFilters={allDateFilters}\n                activeDateFilter={selectedFilter}\n                onDateFilterChange={(filter) => setSelectedFilter(filter as FilterType)}\n                showCompleted={showCompleted}\n                onShowCompletedChange={setShowCompleted}\n                showCompletedLabel={t(\"reminders.showCompleted\")}\n                hideOverdue={hideOverdue}\n                onHideOverdueChange={setHideOverdue}\n                hideOverdueLabel={t('reminders.hideOverdue')}\n                isSticky\n              />\n            </div>\n\n            <div className=\"hidden md:block rounded-2xl border border-border/60 bg-card/70 p-5 shadow-sm\">\n              <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                <div className=\"flex flex-wrap items-center gap-2\">\n                  {allDateFilters.map((option) => (\n                    <Button\n                      key={option.key}\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className={cn(\n                        filterPillBaseClasses,\n                        selectedFilter === option.key && filterPillActiveClasses\n                      )}\n                      onClick={() => setSelectedFilter(option.key as FilterType)}\n                    >\n                      <span>{option.label}</span>\n                      <Badge\n                        variant=\"outline\"\n                        className={cn(\n                          filterPillBadgeBaseClasses,\n                          selectedFilter === option.key && filterPillBadgeActiveClasses\n                        )}\n                      >\n                        {option.count}\n                      </Badge>\n                    </Button>\n                  ))}\n                </div>\n                <div className=\"flex items-center gap-4\">\n                  <span className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                    {t(\"reminders.showCompleted\")}\n                  </span>\n                  <Switch checked={showCompleted} onCheckedChange={setShowCompleted} />\n                  <span className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                    {t('reminders.hideOverdue')}\n                  </span>\n                  <Switch checked={hideOverdue} onCheckedChange={setHideOverdue} />\n                </div>\n              </div>\n            </div>\n\n            {groupedActiveActivities.length === 0 ? (\n              <div className=\"rounded-2xl border border-dashed border-border/70 bg-card/50 p-12 text-center text-muted-foreground\">\n                <Bell className=\"mx-auto mb-4 h-12 w-12 opacity-60\" aria-hidden=\"true\" />\n                <h3 className=\"text-lg font-medium text-foreground\">{t(\"reminders.emptyState.title\")}</h3>\n                <p className=\"mt-2 text-sm text-muted-foreground\">{t(\"reminders.emptyState.description\")}</p>\n              </div>\n            ) : (\n              <div className=\"space-y-6\">\n                {groupedActiveActivities.map((group) => {\n                  const relativeLabel = (() => {\n                    if (isToday(group.date)) return t(\"reminders.filters.today\");\n                    if (isTomorrow(group.date)) return t(\"reminders.filters.tomorrow\");\n                    if (isOverdue(group.date)) return t(\"reminders.filters.overdue\");\n                    if (isThisWeek(group.date)) return t(\"reminders.filters.thisWeek\");\n                    if (isNextWeek(group.date)) return t(\"reminders.filters.nextWeek\");\n                    if (isThisMonth(group.date)) return t(\"reminders.filters.thisMonth\");\n                    return null;\n                  })();\n\n                  return (\n                    <div key={group.date} className=\"rounded-2xl border border-border/60 bg-card/70 p-5 shadow-sm\">\n                      <div className=\"flex flex-wrap items-start justify-between gap-3\">\n                        <div>\n                          {relativeLabel && (\n                            <span className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground/70\">\n                              {relativeLabel}\n                            </span>\n                          )}\n                          <h2 className=\"mt-1 text-xl font-semibold text-foreground\">\n                            {formatGroupDate(group.date)}\n                          </h2>\n                        </div>\n                        <Badge variant=\"outline\" className=\"rounded-full\">\n                          {group.items.length}\n                          <span className=\"sr-only\">{t(\"reminders.title\")}</span>\n                        </Badge>\n                      </div>\n                      <div className=\"relative mt-6 space-y-6\">\n                        <div className=\"absolute left-[11px] top-0 bottom-0 w-px bg-border/60\" aria-hidden=\"true\" />\n                        {group.items.map((activity) => (\n                          <ReminderTimelineItem\n                            key={activity.id}\n                            activity={activity}\n                            leadName={getLeadName(activity.lead_id)}\n                            onToggleCompletion={toggleCompletion}\n                            onNavigate={() => handleReminderClick(activity.lead_id)}\n                            onNavigateProject={activity.project_id ? () => handleProjectClick(activity.project_id) : undefined}\n                            isOverdue={isOverdue(activity.reminder_date)}\n                            isToday={isToday(activity.reminder_date)}\n                            isTomorrow={isTomorrow(activity.reminder_date)}\n                            labels={labels}\n                            hasProject={!!activity.project_id}\n                          />\n                        ))}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            )}\n\n            {groupedCompletedActivities.length > 0 && (\n              <div className=\"rounded-2xl border border-border/70 bg-card/60 shadow-sm\">\n                <Accordion type=\"single\" collapsible>\n                  <AccordionItem value=\"completed\" className=\"border-b-0\">\n                    <AccordionTrigger className=\"px-5 text-left text-base font-semibold\">\n                      {t(\"reminders.timeline.completedTitle\")} ({groupedCompletedActivities.reduce((acc, group) => acc + group.items.length, 0)})\n                    </AccordionTrigger>\n                    <AccordionContent className=\"px-5\">\n                      <p className=\"pb-4 text-sm text-muted-foreground\">\n                        {t(\"reminders.timeline.completedDescription\")}\n                      </p>\n                      <div className=\"space-y-4\">\n                        {groupedCompletedActivities.map((group) => (\n                          <div key={`completed-${group.date}`} className=\"space-y-4\">\n                            <div className=\"text-sm font-medium text-muted-foreground\">\n                              {formatGroupDate(group.date)}\n                            </div>\n                            <div className=\"relative space-y-4\">\n                              <div className=\"absolute left-[11px] top-0 bottom-0 w-px bg-border/60\" aria-hidden=\"true\" />\n                              {group.items.map((activity) => (\n                                <ReminderTimelineItem\n                                  key={activity.id}\n                                  activity={activity}\n                                  leadName={getLeadName(activity.lead_id)}\n                                  onToggleCompletion={toggleCompletion}\n                                  onNavigate={() => handleReminderClick(activity.lead_id)}\n                                  onNavigateProject={activity.project_id ? () => handleProjectClick(activity.project_id) : undefined}\n                                  isOverdue={isOverdue(activity.reminder_date)}\n                                  isToday={isToday(activity.reminder_date)}\n                                  isTomorrow={isTomorrow(activity.reminder_date)}\n                                  labels={labels}\n                                  hasProject={!!activity.project_id}\n                                />\n                              ))}\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </AccordionContent>\n                  </AccordionItem>\n                </Accordion>\n              </div>\n            )}\n          </>\n        )}\n      </div>\n      {viewingProject && (\n        <ViewProjectDialog\n          project={viewingProject}\n          open={showProjectDialog}\n          onOpenChange={setShowProjectDialog}\n          onProjectUpdated={fetchReminders}\n          leadName={getLeadName(viewingProject?.lead_id || '')}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default ReminderDetails;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/SessionDetail.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3894,3897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3894,3897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchSession'. Either include it or remove the dependency array.","line":138,"column":6,"nodeType":"ArrayExpression","endLine":138,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchSession, id]","fix":{"range":[4307,4311],"text":"[fetchSession, id]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":371,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":371,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11556,11559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11556,11559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo, useCallback } from \"react\";\nimport { useParams, useNavigate, useLocation } from \"react-router-dom\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Edit, AlertTriangle, Calendar as CalendarIcon } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport SessionStatusBadge from \"@/components/SessionStatusBadge\";\nimport { isOverdueSession } from \"@/lib/dateUtils\";\nimport EditSessionDialog from \"@/components/EditSessionDialog\";\nimport type { SessionPlanningStepId } from \"@/features/session-planning\";\nimport { ErrorBoundary } from \"@/components/ErrorBoundary\";\nimport { useSessionActions } from \"@/hooks/useSessionActions\";\nimport ProjectDetailsLayout from \"@/components/project-details/ProjectDetailsLayout\";\nimport { UnifiedClientDetails } from \"@/components/UnifiedClientDetails\";\nimport SessionGallery from \"@/components/SessionGallery\";\nimport { getDisplaySessionName } from \"@/lib/sessionUtils\";\nimport {\n  useMessagesTranslation,\n  useCommonTranslation,\n  useFormsTranslation,\n} from \"@/hooks/useTypedTranslation\";\nimport { useTranslation } from \"react-i18next\";\nimport { EntityHeader } from \"@/components/EntityHeader\";\nimport { buildSessionSummaryItems } from \"@/lib/sessions/buildSessionSummaryItems\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { cn } from \"@/lib/utils\";\n\ninterface SessionData {\n  id: string;\n  session_name: string | null;\n  session_date: string;\n  session_time: string;\n  notes: string | null;\n  location: string | null;\n  status: string;\n  lead_id: string;\n  project_id: string | null;\n  user_id: string;\n  google_event_id?: string | null; // Make optional since it's not always returned\n  leads?: {\n    id: string;\n    name: string;\n    email?: string | null;\n    phone?: string | null;\n    notes?: string | null;\n  };\n  projects?: {\n    id: string;\n    name: string;\n    project_types?: {\n      name: string;\n    };\n  };\n}\n\nexport default function SessionDetail() {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const location = useLocation<{ from?: string }>();\n  const { toast } = useToast();\n  const { deleteSession } = useSessionActions();\n  const { t: tMessages } = useMessagesTranslation();\n  const { t: tCommon } = useCommonTranslation();\n  const { t: tForms } = useFormsTranslation();\n  const { t: tPages } = useTranslation(\"pages\");\n  const isMobile = useIsMobile();\n\n  const [session, setSession] = useState<SessionData | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [editStartStep, setEditStartStep] = useState<\n    SessionPlanningStepId | undefined\n  >(undefined);\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\n\n  const fetchSession = async () => {\n    if (!id) return;\n\n    console.log(\"SessionDetail: Starting to fetch session data for ID:\", id);\n    const startTime = performance.now();\n\n    try {\n      const { data, error } = await supabase\n        .from(\"sessions\")\n        .select(\n          `\n          *,\n          leads:lead_id (\n            id,\n            name,\n            email,\n            phone,\n            notes\n          ),\n          projects:project_id (\n            id,\n            name,\n            project_types (\n              name\n            )\n          )\n        `\n        )\n        .eq(\"id\", id)\n        .single();\n\n      if (error) throw error;\n\n      const endTime = performance.now();\n      console.log(`SessionDetail: Fetch completed in ${endTime - startTime}ms`);\n\n      setSession(data);\n    } catch (error: any) {\n      console.error(\"SessionDetail: Error fetching session:\", error);\n      toast({\n        title: tCommon(\"toast.error\"),\n        description: tPages(\"sessionDetail.toast.loadErrorDescription\"),\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    console.log(\"SessionDetail: Component mounted, session ID:\", id);\n    fetchSession();\n  }, [id]);\n\n  const handleEdit = () => {\n    setEditStartStep(undefined);\n    setIsEditDialogOpen(true);\n  };\n\n  const backTarget = location.state?.from;\n  const getFallbackRoute = useCallback(() => {\n    if (backTarget) {\n      return backTarget;\n    }\n    if (typeof window !== \"undefined\" && window.history.length > 1) {\n      return -1;\n    }\n    return \"/sessions\";\n  }, [backTarget]);\n\n  const handleBack = useCallback(() => {\n    const fallback = getFallbackRoute();\n    if (typeof fallback === \"number\") {\n      navigate(fallback);\n    } else {\n      navigate(fallback);\n    }\n  }, [getFallbackRoute, navigate]);\n\n  const handleDelete = async () => {\n    if (!session) return;\n\n    const success = await deleteSession(session.id);\n    if (success) {\n      const fallback = backTarget ?? \"/sessions\";\n      navigate(fallback);\n    }\n  };\n\n  const handleSessionUpdated = () => {\n    fetchSession();\n    setIsEditDialogOpen(false);\n    setEditStartStep(undefined);\n  };\n\n  const handleStatusChange = () => {\n    fetchSession();\n  };\n\n  const handleLeadClick = useCallback(() => {\n    if (session?.lead_id) {\n      navigate(`/leads/${session.lead_id}`);\n    }\n  }, [navigate, session?.lead_id]);\n\n  const handleProjectClick = useCallback(() => {\n    if (session?.project_id) {\n      navigate(`/projects/${session.project_id}`);\n    }\n  }, [navigate, session?.project_id]);\n\n  const sessionTypeLabel =\n    session?.projects?.project_types?.name || tForms(\"sessionBanner.session\");\n  const sessionNameDisplay = session ? getDisplaySessionName(session) : \"\";\n\n  const openEditStep = useCallback(\n    (step: SessionPlanningStepId) => {\n      setEditStartStep(step);\n      setIsEditDialogOpen(true);\n    },\n    [setEditStartStep, setIsEditDialogOpen]\n  );\n\n  const summaryItems = useMemo(\n    () =>\n      session\n        ? buildSessionSummaryItems({\n            session,\n            labels: {\n              dateTime: tPages(\"sessionDetail.labels.dateTime\"),\n              project: tPages(\"sessionDetail.labels.project\"),\n              notes: tPages(\"sessionDetail.labels.notes\"),\n              location: tPages(\"sessionDetail.labels.location\"),\n            },\n            placeholders: {\n              project: tPages(\"sessionDetail.summary.placeholders.project\"),\n              notes: tPages(\"sessionDetail.summary.placeholders.notes\"),\n              location: tPages(\"sessionDetail.summary.placeholders.location\"),\n            },\n            actions: {\n              editSchedule: tPages(\n                \"sessionDetail.summary.actions.editSchedule\"\n              ),\n              connectProject: tPages(\n                \"sessionDetail.summary.actions.connectProject\"\n              ),\n              addNotes: tPages(\"sessionDetail.summary.actions.addNotes\"),\n              addLocation: tPages(\"sessionDetail.summary.actions.addLocation\"),\n            },\n            onProjectClick: session.project_id ? handleProjectClick : undefined,\n            onEditSchedule: () => openEditStep(\"schedule\"),\n            onConnectProject: () => openEditStep(\"project\"),\n            onAddNotes: () => openEditStep(\"notes\"),\n            onAddLocation: () => openEditStep(\"location\"),\n          })\n        : [],\n    [session, tPages, handleProjectClick, openEditStep]\n  );\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <div className=\"border-b\">\n          <div className=\"container mx-auto px-4 py-6\">\n            <div className=\"animate-pulse\">\n              <div className=\"h-8 bg-muted rounded w-1/3 mb-2\"></div>\n              <div className=\"h-4 bg-muted rounded w-1/4\"></div>\n            </div>\n          </div>\n        </div>\n        <div className=\"container mx-auto px-4 py-6\">\n          <div className=\"animate-pulse space-y-4\">\n            <div className=\"h-32 bg-muted rounded\"></div>\n            <div className=\"h-48 bg-muted rounded\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!session) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h2 className=\"text-xl font-semibold mb-2\">\n            {tPages(\"sessionDetail.emptyState.title\")}\n          </h2>\n          <p className=\"text-muted-foreground mb-4\">\n            {tPages(\"sessionDetail.emptyState.description\")}\n          </p>\n          <Button onClick={() => navigate(\"/sessions\")}>\n            {tPages(\"sessionDetail.emptyState.cta\")}\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  const leftContent = session.leads && (\n    <UnifiedClientDetails\n      lead={{\n        id: session.leads.id,\n        name: session.leads.name,\n        email: session.leads.email,\n        phone: session.leads.phone,\n        notes: session.leads.notes,\n      }}\n      title={tPages(\"sessionDetail.cards.clientDetails\")}\n      showQuickActions={true}\n      showClickableNames={true}\n      defaultExpanded={false}\n      onNavigateToLead={handleLeadClick}\n    />\n  );\n\n  const sections = [\n    {\n      id: \"session-gallery\",\n      title: tPages(\"sessionDetail.gallery.title\"),\n      content: <SessionGallery sessionId={session.id} />,\n    },\n  ];\n\n  const dangerZone = (\n    <div className=\"border border-destructive/20 bg-destructive/5 rounded-lg p-6\">\n      <div className=\"space-y-4\">\n        <h3 className=\"font-medium text-destructive\">\n          {tPages(\"sessionDetail.dangerZone.title\")}\n        </h3>\n        <Button\n          variant=\"outline\"\n          onClick={() => setIsDeleteDialogOpen(true)}\n          className=\"w-full border-destructive text-destructive hover:bg-destructive hover:text-destructive-foreground\"\n          size=\"lg\"\n        >\n          {tPages(\"sessionDetail.dangerZone.button\")}\n        </Button>\n        <p className=\"text-sm text-muted-foreground text-center\">\n          {tPages(\"sessionDetail.dangerZone.description\")}\n        </p>\n      </div>\n    </div>\n  );\n\n  const isOverdue = session\n    ? isOverdueSession(session.session_date, session.status)\n    : false;\n\n  const overdueBanner = isOverdue ? (\n    <div className=\"space-y-3 rounded-xl border border-orange-200 bg-orange-50 px-4 py-3 text-sm leading-relaxed text-orange-800\">\n      <div className=\"flex items-start gap-3\">\n        <AlertTriangle\n          className=\"mt-0.5 h-4 w-4 text-orange-600\"\n          aria-hidden=\"true\"\n        />\n        <div className=\"space-y-1\">\n          <p className=\"font-semibold text-orange-900\">\n            {tPages(\"sessionDetail.overdue.title\")}\n          </p>\n          <p>{tPages(\"sessionDetail.overdue.description\")}</p>\n        </div>\n      </div>\n      <div className=\"pl-7\">\n        <Button\n          size=\"sm\"\n          variant=\"outline\"\n          className=\"border-orange-300 text-orange-700 hover:bg-orange-100 hover:text-orange-700\"\n          onClick={() => {\n            setEditStartStep(\"schedule\");\n            setIsEditDialogOpen(true);\n          }}\n        >\n          {tPages(\"sessionDetail.overdue.reschedule\")}\n        </Button>\n      </div>\n    </div>\n  ) : undefined;\n\n  const renderSessionStatusBadge = (\n    className?: string,\n    size: \"sm\" | \"default\" = \"default\"\n  ) =>\n    session ? (\n      <SessionStatusBadge\n        sessionId={session.id}\n        currentStatus={session.status as any}\n        editable={true}\n        onStatusChange={handleStatusChange}\n        size={size}\n        className={className}\n      />\n    ) : null;\n\n  const renderEditButton = (className?: string) => (\n    <Button\n      variant=\"outline\"\n      size=\"sm\"\n      onClick={handleEdit}\n      className={cn(\"gap-2 text-sm font-medium\", className)}\n    >\n      <Edit className=\"h-4 w-4\" />\n      <span>{tForms(\"sessions.editSession\")}</span>\n    </Button>\n  );\n\n  const headerActions = session ? (\n    isMobile ? (\n      <div className=\"flex w-full flex-wrap items-center gap-2\">\n        <div className=\"flex-1 min-w-[160px]\">\n          {renderSessionStatusBadge(\"w-full h-9 justify-center\")}\n        </div>\n        {renderEditButton(\"min-w-[120px] justify-center\")}\n      </div>\n    ) : (\n      renderEditButton()\n    )\n  ) : undefined;\n\n  const headerTitle = session ? (\n    <span className=\"flex flex-col\">\n      <span className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\">\n        {sessionTypeLabel}\n      </span>\n      <span className=\"flex flex-wrap items-center gap-2 text-foreground\">\n        <span className=\"break-words text-pretty leading-tight\">\n          {sessionNameDisplay}\n        </span>\n        {!isMobile && renderSessionStatusBadge(\"text-xs sm:text-sm\")}\n      </span>\n    </span>\n  ) : undefined;\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"mx-auto max-w-full px-6 py-6\">\n        {session && (\n          <EntityHeader\n            name={sessionNameDisplay}\n            title={headerTitle}\n            onBack={handleBack}\n            backLabel={tCommon(\"buttons.back\")}\n            summaryItems={summaryItems}\n            banner={overdueBanner}\n            actions={headerActions}\n            avatarClassName=\"bg-gradient-to-br from-amber-300 via-orange-400 to-orange-500 text-white ring-0\"\n            avatarContent={\n              <CalendarIcon className=\"h-5 w-5 text-white\" aria-hidden=\"true\" />\n            }\n            fallbackInitials=\"SE\"\n          />\n        )}\n      </div>\n\n      <div className=\"mx-auto max-w-full px-6 pb-6\">\n        <ProjectDetailsLayout\n          header={<></>}\n          left={leftContent}\n          sections={sections}\n          overviewNavId=\"session-detail-overview\"\n          overviewLabel={tForms(\"project_sheet.overview_tab\")}\n          rightFooter={dangerZone}\n        />\n      </div>\n\n      {/* Edit Dialog */}\n      {isEditDialogOpen && (\n        <ErrorBoundary\n          onError={(error) => {\n            console.error(\"Error in EditSessionDialog:\", error);\n            setIsEditDialogOpen(false);\n          }}\n        >\n          <EditSessionDialog\n            open={isEditDialogOpen}\n            onOpenChange={(open) => {\n              if (!open) {\n                setEditStartStep(undefined);\n              }\n              setIsEditDialogOpen(open);\n            }}\n            sessionId={session.id}\n            leadId={session.lead_id}\n            currentSessionName={session.session_name || \"\"}\n            currentDate={session.session_date}\n            currentTime={session.session_time}\n            currentNotes={session.notes || \"\"}\n            currentLocation={session.location || \"\"}\n            currentProjectId={session.project_id}\n            leadName={session.leads?.name || \"\"}\n            onSessionUpdated={handleSessionUpdated}\n            startStep={editStartStep}\n          />\n        </ErrorBoundary>\n      )}\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog\n        open={isDeleteDialogOpen}\n        onOpenChange={setIsDeleteDialogOpen}\n      >\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>\n              {tPages(\"sessionDetail.modal.deleteTitle\")}\n            </AlertDialogTitle>\n            <AlertDialogDescription>\n              {tMessages(\"confirm.deleteSession\")}{\" \"}\n              {tMessages(\"confirm.cannotUndo\")}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>{tCommon(\"buttons.cancel\")}</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleDelete}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {tPages(\"sessionDetail.dangerZone.button\")}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/TemplateBuilder.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'blocks' logical expression could make the dependencies of useCallback Hook (at line 141) change on every render. To fix this, wrap the initialization of 'blocks' in its own useMemo() Hook.","line":51,"column":9,"nodeType":"VariableDeclarator","endLine":51,"endColumn":40},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'blocks' logical expression could make the dependencies of useCallback Hook (at line 176) change on every render. To fix this, wrap the initialization of 'blocks' in its own useMemo() Hook.","line":51,"column":9,"nodeType":"VariableDeclarator","endLine":51,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\nimport { ArrowLeft, Save, Eye, Edit } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/hooks/use-toast';\nimport { OptimizedTemplateEditor } from '@/components/template-builder/OptimizedTemplateEditor';\nimport { OptimizedTemplatePreview } from '@/components/template-builder/OptimizedTemplatePreview';\nimport { TemplateBlock } from '@/types/templateBuilder';\nimport { InlineSubjectEditor } from '@/components/template-builder/InlineSubjectEditor';\nimport { InlinePreheaderEditor } from '@/components/template-builder/InlinePreheaderEditor';\nimport { useTemplateBuilder } from '@/hooks/useTemplateBuilder';\nimport { useTemplateVariables } from '@/hooks/useTemplateVariables';\nimport { getCharacterCount, checkSpamWords, getPreviewDataSets } from '@/lib/templateUtils';\nimport { NavigationGuardDialog } from '@/components/settings/NavigationGuardDialog';\nimport { useSettingsNavigation } from '@/hooks/useSettingsNavigation';\nimport { TemplateNameDialog } from '@/components/template-builder/TemplateNameDialog';\nimport { supabase } from '@/integrations/supabase/client';\nimport { TemplateErrorBoundary } from \"@/components/template-builder/TemplateErrorBoundary\";\nimport { useTranslation } from \"react-i18next\";\n\n// Optimized TemplateBuilder component\nconst OptimizedTemplateBuilderContent = React.memo(() => {\n  const { t, i18n } = useTranslation(\"pages\");\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const [searchParams] = useSearchParams();\n  const templateId = searchParams.get('id');\n\n  // Backend hooks\n  const { template, loading, saving, lastSaved, isDirty, saveTemplate, publishTemplate, updateTemplate, resetDirtyState } = useTemplateBuilder(templateId || undefined);\n  const { getVariableValue } = useTemplateVariables();\n\n  // Local state for UI\n  const [activeChannel, setActiveChannel] = useState<'email' | 'whatsapp' | 'sms' | 'plain'>('email');\n  const [selectedPreviewData, setSelectedPreviewData] = useState(0);\n  const [isEditingName, setIsEditingName] = useState(false);\n  const [editingName, setEditingName] = useState('');\n  const [isEditingSubject, setIsEditingSubject] = useState(false);\n  const [isEditingPreheader, setIsEditingPreheader] = useState(false);\n  const [showNameDialog, setShowNameDialog] = useState(false);\n  const [pendingAction, setPendingAction] = useState<'save' | 'publish' | null>(null);\n  const [existingTemplateNames, setExistingTemplateNames] = useState<string[]>([]);\n\n  // Template data from backend or defaults\n  const templateName = template?.name || t(\"templateBuilder.untitledTemplate\");\n  const subject = template?.subject || '';\n  const preheader = template?.preheader || '';\n  const blocks = template?.blocks || [];\n  const isDraft = template?.status === 'draft' || !template;\n\n  // Fetch existing template names for validation\n  useEffect(() => {\n    const fetchTemplateNames = async () => {\n      try {\n        const { data, error } = await supabase\n          .from('message_templates')\n          .select('name')\n          .neq('id', templateId || '');\n        \n        if (error) {\n          console.error('Error fetching template names:', error);\n          return;\n        }\n\n        setExistingTemplateNames(data?.map(t => t.name) || []);\n      } catch (error) {\n        console.error('Error fetching template names:', error);\n      }\n    };\n\n    fetchTemplateNames();\n  }, [templateId]);\n\n  // Helper function to check if template name is untitled\n  const isUntitledTemplate = (name: string) => {\n    const normalizedName = name.toLowerCase().trim();\n    return normalizedName === 'untitled template' || \n           normalizedName.includes('untitled') ||\n           normalizedName === '' ||\n           normalizedName === 'new template' ||\n           normalizedName === 'template';\n  };\n\n  // Navigation guard\n  const {\n    showGuard,\n    message: guardMessage,\n    handleNavigationAttempt,\n    handleDiscardChanges,\n    handleStayOnPage,\n    handleSaveAndExit\n  } = useSettingsNavigation({\n    isDirty,\n    onDiscard: () => {\n      resetDirtyState();\n    },\n    onSaveAndExit: async () => {\n      await handleSaveTemplate();\n    },\n    message: t(\"templateBuilder.navigationGuard.unsavedChanges\")\n  });\n\n  const handleSaveTemplate = useCallback(async (customName?: string) => {\n    const nameToUse = customName || templateName;\n    \n    // Check if template needs a name\n    if (isUntitledTemplate(nameToUse)) {\n      setPendingAction('save');\n      setShowNameDialog(true);\n      return;\n    }\n\n    if (!template) {\n      // Create new template\n      const newTemplate = await saveTemplate({\n        name: nameToUse,\n        subject,\n        preheader,\n        blocks,\n        status: 'draft',\n        category: 'general',\n      });\n      \n      if (newTemplate) {\n        // Update URL to include template ID\n        navigate(`/template-builder?id=${newTemplate.id}`, { replace: true });\n      }\n    } else {\n      // Update existing template\n      await saveTemplate({\n        ...template,\n        name: nameToUse,\n        subject,\n        preheader,\n        blocks,\n      });\n    }\n  }, [template, saveTemplate, templateName, subject, preheader, blocks, navigate]);\n\n  const handleNavigateBack = useCallback(() => {\n    if (isDirty) {\n      if (!handleNavigationAttempt('/templates')) {\n        return; // Navigation blocked by guard\n      }\n    }\n    navigate('/templates');\n  }, [isDirty, handleNavigationAttempt, navigate]);\n\n\n  const handlePublishTemplate = useCallback(async (customName?: string) => {\n    const nameToUse = customName || templateName;\n    \n    // Check if template needs a name\n    if (isUntitledTemplate(nameToUse)) {\n      setPendingAction('publish');\n      setShowNameDialog(true);\n      return;\n    }\n\n    // Directly publish with all current data (atomic operation)\n    const publishedTemplate = await publishTemplate({\n      name: nameToUse,\n      subject,\n      preheader,\n      blocks,\n      category: template?.category || 'general',\n    });\n\n    // Update URL if it's a new template\n    if (publishedTemplate && !templateId) {\n      navigate(`/template-builder?id=${publishedTemplate.id}`, { replace: true });\n    }\n  }, [templateName, subject, preheader, blocks, template?.category, publishTemplate, templateId, navigate]);\n\n  const handleSubjectSave = async (newSubject: string) => {\n    updateTemplate({ subject: newSubject });\n    setIsEditingSubject(false);\n  };\n\n  const handlePreheaderSave = async (newPreheader: string) => {\n    updateTemplate({ preheader: newPreheader });\n    setIsEditingPreheader(false);\n  };\n\n  const handleNameEdit = () => {\n    setEditingName(templateName);\n    setIsEditingName(true);\n  };\n\n  const handleNameBlur = () => {\n    setIsEditingName(false);\n    if (editingName !== templateName) {\n      updateTemplate({ name: editingName });\n    }\n  };\n\n  const handleNameKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      handleNameBlur();\n    }\n  };\n\n\n  const handleBlocksChange = useCallback((newBlocks: TemplateBlock[]) => {\n    updateTemplate({ blocks: newBlocks });\n  }, [updateTemplate]);\n\n  // Handle name dialog confirmation\n  const handleNameDialogConfirm = async (name: string) => {\n    setShowNameDialog(false);\n    \n    // Update the template name in local state first\n    updateTemplate({ name });\n    \n    // Perform the pending action with the new name\n    if (pendingAction === 'save') {\n      await handleSaveTemplate(name);\n    } else if (pendingAction === 'publish') {\n      await handlePublishTemplate(name);\n    }\n    \n    setPendingAction(null);\n  };\n\n  // Handle name dialog cancel\n  const handleNameDialogCancel = () => {\n    setShowNameDialog(false);\n    setPendingAction(null);\n  };\n\n  // Memoize expensive calculations\n  const subjectCharCount = useMemo(() => getCharacterCount(subject), [subject]);\n  const spamWords = useMemo(() => checkSpamWords(subject), [subject]);\n  const previewDataSets = useMemo(() => getPreviewDataSets(i18n.language), [i18n.language]);\n  const selectedData = useMemo(() => previewDataSets[selectedPreviewData], [selectedPreviewData, previewDataSets]);\n\n  if (loading) {\n    return (\n      <div className=\"h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"text-lg font-semibold\">{t(\"templateBuilder.loading\")}</div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-screen flex flex-col\">\n      {/* Header */}\n      <div className=\"border-b bg-background px-6 py-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <ArrowLeft \n              className=\"h-6 w-6 cursor-pointer text-foreground hover:text-[hsl(var(--accent-foreground))] transition-colors\" \n              strokeWidth={2.5}\n              onClick={handleNavigateBack}\n            />\n            <div className=\"flex items-center gap-2\">\n              {isEditingName ? (\n                <Input\n                  value={editingName}\n                  onChange={(e) => setEditingName(e.target.value)}\n                  onBlur={handleNameBlur}\n                  onKeyDown={handleNameKeyDown}\n                  className=\"font-semibold text-lg border bg-background px-2 py-1 h-auto focus-visible:ring-1\"\n                  autoFocus\n                />\n              ) : (\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"font-semibold text-lg\">{templateName}</span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={handleNameEdit}\n                    className=\"h-6 w-6 p-0\"\n                  >\n                    <Edit className=\"h-3 w-3\" />\n                  </Button>\n                </div>\n              )}\n            </div>\n          </div>\n          \n          <div className=\"flex items-center gap-2\">\n            <div className=\"flex items-center gap-2\">\n              <Badge variant={isDraft ? \"secondary\" : \"default\"}>\n                {isDraft ? t(\"templateBuilder.badges.draft\") : t(\"templateBuilder.badges.published\")}\n              </Badge>\n              {isDirty && (\n                <Badge variant=\"outline\" className=\"text-amber-600 border-amber-600\">\n                  {t(\"templateBuilder.badges.unsavedChanges\")}\n                </Badge>\n              )}\n              {lastSaved && !isDirty && (\n                <span className=\"text-xs text-muted-foreground\">\n                  {t(\"templateBuilder.saved\", { time: lastSaved.toLocaleTimeString() })}\n                </span>\n              )}\n            </div>\n            <Button variant=\"outline\" onClick={() => handleSaveTemplate()} disabled={saving}>\n              <Save className=\"h-4 w-4\" />\n              {saving ? t(\"templateBuilder.buttons.saving\") : t(\"templateBuilder.buttons.saveDraft\")}\n            </Button>\n            <Button onClick={() => handlePublishTemplate()} disabled={saving}>\n              <Eye className=\"h-4 w-4\" />\n              {isDraft ? t(\"templateBuilder.buttons.publish\") : t(\"templateBuilder.buttons.published\")}\n            </Button>\n          </div>\n        </div>\n\n        {/* Compact Email Settings */}\n        {activeChannel === \"email\" && (\n          <div className=\"mt-3 pt-3 border-t space-y-3\">\n            {/* Subject Line - Side by Side */}\n            <div className=\"space-y-1\">\n              {isEditingSubject ? (\n                <InlineSubjectEditor\n                  value={subject}\n                  onSave={handleSubjectSave}\n                  onCancel={() => setIsEditingSubject(false)}\n                />\n              ) : (\n                <div className=\"flex items-center gap-3 pl-1\">\n                  <Label className=\"text-sm text-muted-foreground w-20 flex-shrink-0\">\n                    {t(\"templateBuilder.email.subject\")}\n                  </Label>\n                  <button\n                    onClick={() => setIsEditingSubject(true)}\n                    className=\"flex-1 flex items-center gap-2 text-left hover:bg-muted/50 rounded px-2 py-1 -mx-2 -my-1 cursor-pointer group\"\n                  >\n                    <span className={`text-sm flex-1 ${!subject ? 'text-muted-foreground' : 'text-foreground'}`}>\n                      {subject || t(\"templateBuilder.email.addSubject\")}\n                    </span>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"h-6 w-6 p-0 opacity-100\"\n                    >\n                      <Edit className=\"h-3 w-3\" />\n                    </Button>\n                  </button>\n                </div>\n              )}\n              \n              {/* Character count and spam warnings for subject */}\n              {!isEditingSubject && subject && (subjectCharCount > 60 || spamWords.length > 0) && (\n                <div className=\"flex items-center gap-2 text-xs text-muted-foreground ml-24\">\n                  {subjectCharCount > 60 && (\n                    <div className=\"flex items-center gap-1\">\n                      <span className=\"text-amber-600\">âš ï¸</span>\n                      <span className=\"text-amber-600\">\n                        {t(\"templateBuilder.warnings.tooLong\", { count: subjectCharCount })}\n                      </span>\n                    </div>\n                  )}\n                  {spamWords.length > 0 && (\n                    <div className=\"flex items-center gap-1\">\n                      <span className=\"text-amber-600\">âš ï¸</span>\n                      <span>{t(\"templateBuilder.warnings.spamWords\")}</span>\n                      <div className=\"flex gap-1\">\n                        {spamWords.slice(0, 2).map(word => (\n                          <Badge key={word} variant=\"secondary\" className=\"text-xs px-1 py-0\">\n                            {word}\n                          </Badge>\n                        ))}\n                        {spamWords.length > 2 && (\n                          <span className=\"text-amber-600\">\n                            {t(\"templateBuilder.warnings.moreSpamWords\", { count: spamWords.length - 2 })}\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n\n            {/* Preheader - Side by Side */}\n            <div>\n              {isEditingPreheader ? (\n                <InlinePreheaderEditor\n                  value={preheader}\n                  onSave={handlePreheaderSave}\n                  onCancel={() => setIsEditingPreheader(false)}\n                />\n              ) : (\n                <div className=\"flex items-center gap-3 pl-1\">\n                  <Label className=\"text-sm text-muted-foreground w-20 flex-shrink-0\">\n                    {t(\"templateBuilder.email.preheader\")}\n                  </Label>\n                  <button\n                    onClick={() => setIsEditingPreheader(true)}\n                    className=\"flex-1 flex items-center gap-2 text-left hover:bg-muted/50 rounded px-2 py-1 -mx-2 -my-1 cursor-pointer group\"\n                  >\n                    <span className={`text-sm flex-1 ${!preheader ? 'text-muted-foreground' : 'text-foreground'}`}>\n                      {preheader || t(\"templateBuilder.email.addPreheader\")}\n                    </span>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"h-6 w-6 p-0 opacity-100\"\n                    >\n                      <Edit className=\"h-3 w-3\" />\n                    </Button>\n                  </button>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Main Content */}\n      <div className=\"flex-1 flex min-h-0\">\n        {/* Left Side - Template Editor */}\n        <div className=\"w-1/2 border-r\">\n          <OptimizedTemplateEditor\n            blocks={blocks}\n            onBlocksChange={handleBlocksChange}\n          />\n        </div>\n\n        {/* Right Side - Live Preview */}\n        <div className=\"w-1/2\">\n          <OptimizedTemplatePreview\n            blocks={blocks}\n            activeChannel={activeChannel as 'email' | 'whatsapp' | 'sms' | 'plaintext'}\n            onChannelChange={(channel) => setActiveChannel(channel as 'email' | 'whatsapp' | 'sms' | 'plain')}\n            emailSubject={subject}\n            preheader={preheader}\n            previewData={selectedData.data}\n          />\n        </div>\n      </div>\n\n      {/* Navigation Guard Dialog */}\n      <NavigationGuardDialog\n        open={showGuard}\n        onDiscard={handleDiscardChanges}\n        onStay={handleStayOnPage}\n        onSaveAndExit={handleSaveAndExit}\n        message={guardMessage}\n      />\n\n      {/* Template Name Dialog */}\n      <TemplateNameDialog\n        open={showNameDialog}\n        onClose={handleNameDialogCancel}\n        onConfirm={handleNameDialogConfirm}\n        currentName={templateName}\n        existingNames={existingTemplateNames}\n        action={pendingAction || 'save'}\n        loading={saving}\n      />\n    </div>\n  );\n});\n\nOptimizedTemplateBuilderContent.displayName = 'OptimizedTemplateBuilderContent';\n\nexport default function TemplateBuilder() {\n  return (\n    <TemplateErrorBoundary>\n      <OptimizedTemplateBuilderContent />\n    </TemplateErrorBoundary>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/Templates.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1455,1458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1455,1458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1680,1683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1680,1683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2404,2407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2404,2407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo, useCallback } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { PageHeader } from \"@/components/ui/page-header\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  AdvancedDataTable,\n  type AdvancedTableColumn,\n} from \"@/components/data-table\";\nimport { TableLoadingSkeleton } from \"@/components/ui/loading-presets\";\nimport { Plus, Edit, Trash2, Copy, MessageSquare } from \"lucide-react\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { enUS, tr } from 'date-fns/locale';\nimport { DeleteTemplateDialog } from \"@/components/template-builder/DeleteTemplateDialog\";\nimport { useTemplateOperations } from \"@/hooks/useTemplateOperations\";\nimport { TemplateErrorBoundary } from \"@/components/template-builder/TemplateErrorBoundary\";\nimport { Template } from \"@/types/template\";\nimport { useTranslation } from \"react-i18next\";\n\n// Optimized Templates component with memoization and error handling\nconst OptimizedTemplatesContent = React.memo(() => {\n  const { t, i18n } = useTranslation(\"pages\");\n  const navigate = useNavigate();\n  const dateLocale = i18n.language === 'tr' ? tr : enUS;\n  const {\n    loading,\n    error,\n    searchTerm,\n    setSearchTerm,\n    filteredTemplates,\n    deleteTemplate,\n    duplicateTemplate,\n  } = useTemplateOperations();\n\n  const [deleteDialog, setDeleteDialog] = useState<{\n    open: boolean;\n    template: any | null;\n  }>({ open: false, template: null });\n  const [deleting, setDeleting] = useState(false);\n  const [page, setPage] = useState(1);\n  const pageSize = 25;\n\n  const handleDeleteTemplate = React.useCallback((template: any) => {\n    setDeleteDialog({ open: true, template });\n  }, []);\n\n  const confirmDeleteTemplate = React.useCallback(async () => {\n    if (!deleteDialog.template) return;\n\n    const { id: templateId, name: templateName } = deleteDialog.template;\n    \n    try {\n      setDeleting(true);\n      const success = await deleteTemplate(templateId);\n      \n      if (success) {\n        setDeleteDialog({ open: false, template: null });\n      }\n    } finally {\n      setDeleting(false);\n    }\n  }, [deleteDialog.template, deleteTemplate]);\n\n  const cancelDeleteTemplate = React.useCallback(() => {\n    setDeleteDialog({ open: false, template: null });\n  }, []);\n\n  const handleDuplicateTemplate = React.useCallback(async (template: any) => {\n    await duplicateTemplate(template);\n  }, [duplicateTemplate]);\n\n  // Helper function to extract preview text from template\n  const extractPreviewText = React.useCallback((template: Template): string => {\n    // First priority: email subject from channel views\n    if (template.channels?.email?.subject?.trim()) {\n      return template.channels.email.subject.trim();\n    }\n    \n    // Second priority: master subject\n    if (template.master_subject?.trim()) {\n      return template.master_subject.trim();\n    }\n    \n    // Third priority: email content from channel views\n    if (template.channels?.email?.content?.trim()) {\n      const plainText = template.channels.email.content.replace(/<[^>]*>/g, '').trim();\n      if (plainText) {\n        return plainText.length > 60 ? `${plainText.substring(0, 60)}...` : plainText;\n      }\n    }\n    \n    // Fallback: master content\n    if (template.master_content?.trim()) {\n      const plainText = template.master_content.replace(/<[^>]*>/g, '').trim();\n      return plainText.length > 60 ? `${plainText.substring(0, 60)}...` : plainText;\n    }\n    \n    return t(\"templates.preview.noPreview\", { defaultValue: \"No preview available\" });\n  }, [t]);\n\n  const columns = useMemo<AdvancedTableColumn<Template>[]>(\n    () => [\n      {\n        id: \"name\",\n        label: t(\"templates.table.templateName\"),\n        sortable: true,\n        hideable: false,\n        minWidth: \"200px\",\n        render: (template) => (\n          <div className=\"min-w-0\">\n            <div className=\"font-medium text-foreground truncate\">{template.name}</div>\n            {template.master_content && (\n              <div className=\"text-sm text-muted-foreground truncate mt-1\">\n                {template.master_content.length > 60\n                  ? `${template.master_content.substring(0, 60)}...`\n                  : template.master_content}\n              </div>\n            )}\n          </div>\n        ),\n      },\n      {\n        id: \"preview\",\n        label: t(\"templates.table.preview\"),\n        sortable: false,\n        hideable: true,\n        minWidth: \"240px\",\n        render: (template) => (\n          <div className=\"max-w-xs min-w-0\">\n            <div className=\"text-sm text-muted-foreground line-clamp-2\">\n              {extractPreviewText(template)}\n            </div>\n          </div>\n        ),\n      },\n      {\n        id: \"status\",\n        label: t(\"templates.table.status\"),\n        sortable: true,\n        hideable: true,\n        minWidth: \"120px\",\n        render: (template) => (\n          <Badge variant={template.is_active ? \"default\" : \"secondary\"}>\n            {template.is_active\n              ? t(\"templates.status.published\")\n              : t(\"templates.status.draft\")}\n          </Badge>\n        ),\n      },\n      {\n        id: \"updated_at\",\n        label: t(\"templates.table.lastUpdated\"),\n        sortable: true,\n        hideable: true,\n        minWidth: \"160px\",\n        render: (template) => (\n          <div className=\"text-sm text-muted-foreground whitespace-nowrap\">\n            {formatDistanceToNow(new Date(template.updated_at), {\n              addSuffix: true,\n              locale: dateLocale,\n            })}\n          </div>\n        ),\n      },\n    ],\n    [dateLocale, extractPreviewText, t]\n  );\n\n  const emptyState = useMemo(() => (\n    <div className=\"text-center py-12\">\n      <MessageSquare className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n      <h3 className=\"text-lg font-medium mb-2\">\n        {searchTerm ? t(\"templates.emptyState.noTemplatesFound\") : t(\"templates.emptyState.noTemplatesYet\")}\n      </h3>\n      <p className=\"text-muted-foreground mb-6\">\n        {searchTerm \n          ? t(\"templates.emptyState.adjustSearch\")\n          : t(\"templates.emptyState.createFirstMessage\")\n        }\n      </p>\n      {!searchTerm && (\n        <Button onClick={() => navigate('/template-builder')}>\n          <Plus className=\"h-4 w-4 mr-2\" />\n          {t(\"templates.buttons.createFirstTemplate\")}\n        </Button>\n      )}\n    </div>\n  ), [searchTerm, navigate, t]);\n\n  const totalCount = filteredTemplates.length;\n\n  const paginatedTemplates = useMemo(\n    () => filteredTemplates.slice(0, page * pageSize),\n    [filteredTemplates, page, pageSize]\n  );\n\n  const hasMoreTemplates = paginatedTemplates.length < totalCount;\n  const handleLoadMoreTemplates = useCallback(() => {\n    if (!hasMoreTemplates) return;\n    setPage((prev) => prev + 1);\n  }, [hasMoreTemplates]);\n\n  React.useEffect(() => {\n    setPage(1);\n  }, [searchTerm]);\n\n  React.useEffect(() => {\n    const maxPage = Math.max(1, Math.ceil(totalCount / pageSize));\n    if (page > maxPage) {\n      setPage(maxPage);\n    }\n  }, [page, pageSize, totalCount]);\n\n  const headerActions = useMemo(\n    () => (\n      <Button onClick={() => navigate('/template-builder')} className=\"flex items-center gap-2 whitespace-nowrap\">\n        <Plus className=\"h-4 w-4\" />\n        {t(\"templates.buttons.newTemplate\")}\n      </Button>\n    ),\n    [navigate, t]\n  );\n\n  const handleRowClick = useCallback(\n    (template: Template) => {\n      navigate(`/template-builder?id=${template.id}`);\n    },\n    [navigate]\n  );\n\n  const renderRowActions = useCallback(\n    (template: Template) => (\n      <div className=\"flex items-center gap-2\">\n        <Button\n          size=\"sm\"\n          variant=\"outline\"\n          onClick={(event) => {\n            event.stopPropagation();\n            navigate(`/template-builder?id=${template.id}`);\n          }}\n        >\n          <Edit className=\"h-4 w-4 mr-1\" />\n          {t(\"templates.buttons.edit\")}\n        </Button>\n        <Button\n          size=\"sm\"\n          variant=\"outline\"\n          onClick={(event) => {\n            event.stopPropagation();\n            handleDuplicateTemplate(template);\n          }}\n          title={t(\"templates.buttons.duplicate\")}\n        >\n          <Copy className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          size=\"sm\"\n          variant=\"outline\"\n          onClick={(event) => {\n            event.stopPropagation();\n            handleDeleteTemplate(template);\n          }}\n          className=\"text-destructive hover:text-destructive border-destructive/20 hover:bg-destructive/10\"\n          title={t(\"templates.buttons.delete\")}\n        >\n          <Trash2 className=\"h-4 w-4\" />\n        </Button>\n      </div>\n    ),\n    [handleDeleteTemplate, handleDuplicateTemplate, navigate, t]\n  );\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"text-lg font-semibold text-destructive mb-2\">{t(\"templates.error.loadingTemplates\")}</div>\n          <p className=\"text-muted-foreground\">{error}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen\">\n      <PageHeader \n        title={t(\"templates.title\")}\n        subtitle={t(\"templates.subtitle\")}\n      />\n      \n      <div className=\"p-4 sm:p-6 space-y-6\">\n        <AdvancedDataTable\n          title={t(\"templates.table.title\", { defaultValue: t(\"templates.title\") })}\n          data={paginatedTemplates}\n          columns={columns}\n          rowKey={(template) => template.id}\n          isLoading={loading}\n          loadingState={<TableLoadingSkeleton />}\n          actions={headerActions}\n          searchValue={searchTerm}\n          onSearchChange={setSearchTerm}\n          searchPlaceholder={t(\"templates.search\")}\n          searchLoading={loading}\n          searchDelay={0}\n          emptyState={emptyState}\n          onRowClick={handleRowClick}\n          rowActions={renderRowActions}\n          onLoadMore={hasMoreTemplates ? handleLoadMoreTemplates : undefined}\n          hasMore={hasMoreTemplates}\n        />\n      </div>\n\n      {/* Delete Template Dialog */}\n      <DeleteTemplateDialog\n        open={deleteDialog.open}\n        onClose={cancelDeleteTemplate}\n        onConfirm={confirmDeleteTemplate}\n        templateName={deleteDialog.template?.name || ''}\n        loading={deleting}\n      />\n    </div>\n  );\n});\n\nOptimizedTemplatesContent.displayName = 'OptimizedTemplatesContent';\n\nexport default function Templates() {\n  return (\n    <TemplateErrorBoundary>\n      <OptimizedTemplatesContent />\n    </TemplateErrorBoundary>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/UpcomingSessions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/Workflows.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":244,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":244,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7846,7849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7846,7849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getChannelIcons'. Either include it or remove the dependency array.","line":292,"column":5,"nodeType":"ArrayExpression","endLine":292,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [dateLocale, getChannelIcons, getTriggerLabel, t]","fix":{"range":[9181,9213],"text":"[dateLocale, getChannelIcons, getTriggerLabel, t]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo, useEffect, useCallback } from \"react\";\nimport { PageHeader } from \"@/components/ui/page-header\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  AdvancedDataTable,\n  type AdvancedTableColumn,\n  type AdvancedDataTableSortState,\n} from \"@/components/data-table\";\nimport { PageLoadingSkeleton } from \"@/components/ui/loading-presets\";\nimport { useWorkflows } from \"@/hooks/useWorkflows\";\nimport { CreateWorkflowSheet } from \"@/components/CreateWorkflowSheet\";\nimport { WorkflowDeleteDialog } from \"@/components/WorkflowDeleteDialog\";\nimport { Workflow } from \"@/types/workflow\";\nimport { Plus, Zap, CheckCircle, Clock, AlertTriangle, Edit, Trash2, Mail, MessageCircle, Phone } from \"lucide-react\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { enUS, tr } from 'date-fns/locale';\nimport { useTranslation } from \"react-i18next\";\nimport { KpiCard } from \"@/components/ui/kpi-card\";\nimport {\n  KPI_ACTION_BUTTON_CLASS,\n  getKpiIconPreset,\n} from \"@/components/ui/kpi-presets\";\nimport { SegmentedControl } from \"@/components/ui/segmented-control\";\n\nexport default function Workflows() {\n  const { t, i18n } = useTranslation(\"pages\");\n  const { workflows, loading, createWorkflow, updateWorkflow, deleteWorkflow, toggleWorkflowStatus } = useWorkflows();\n  const dateLocale = i18n.language === 'tr' ? tr : enUS;\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<\"all\" | \"active\" | \"paused\">(\"all\");\n  const [page, setPage] = useState(1);\n  const pageSize = 25;\n  const [sortState, setSortState] = useState<AdvancedDataTableSortState>({\n    columnId: \"name\",\n    direction: \"asc\",\n  });\n\n  const filteredWorkflows = useMemo(() => {\n    const query = searchQuery.trim().toLowerCase();\n    return workflows.filter((workflow) => {\n      const matchesSearch =\n        query.length === 0 ||\n        workflow.name.toLowerCase().includes(query) ||\n        workflow.description?.toLowerCase().includes(query);\n      const matchesStatus =\n        statusFilter === \"all\" ||\n        (statusFilter === \"active\" && workflow.is_active) ||\n        (statusFilter === \"paused\" && !workflow.is_active);\n      return matchesSearch && matchesStatus;\n    });\n  }, [workflows, searchQuery, statusFilter]);\n\n  const getTriggerLabel = useCallback((triggerType: string) => {\n    const triggerKey = `workflows.triggers.${triggerType}` as const;\n    return t(triggerKey, { defaultValue: triggerType });\n  }, [t]);\n\n  const getChannelIcons = useCallback((channels: string[]) => {\n    const iconMap = {\n      email: Mail,\n      sms: Phone,\n      whatsapp: MessageCircle,\n    };\n\n    return (\n      channels?.map((channel) => {\n        const IconComponent = iconMap[channel as keyof typeof iconMap];\n        if (!IconComponent) return null;\n\n        return (\n          <div key={channel} className=\"p-1 bg-muted rounded\">\n            <IconComponent className=\"h-3 w-3\" />\n          </div>\n        );\n      }).filter(Boolean) || []\n    );\n  }, []);\n\n  const sortedWorkflows = useMemo(() => {\n    const data = [...filteredWorkflows];\n    const { columnId, direction } = sortState;\n    if (!columnId) {\n      return data;\n    }\n\n    const multiplier = direction === \"asc\" ? 1 : -1;\n\n    data.sort((a, b) => {\n      switch (columnId) {\n        case \"name\":\n          return multiplier * a.name.localeCompare(b.name);\n        case \"trigger_type\":\n          return multiplier * getTriggerLabel(a.trigger_type).localeCompare(\n            getTriggerLabel(b.trigger_type)\n          );\n        case \"status\":\n          return multiplier * ((a.is_active === b.is_active) ? 0 : a.is_active ? -1 : 1);\n        case \"created_at\":\n          return multiplier * (\n            new Date(a.created_at).getTime() - new Date(b.created_at).getTime()\n          );\n        default:\n          return 0;\n      }\n    });\n\n    return data;\n  }, [filteredWorkflows, getTriggerLabel, sortState]);\n\n  const totalCount = sortedWorkflows.length;\n\n  const paginatedWorkflows = useMemo(\n    () => sortedWorkflows.slice(0, page * pageSize),\n    [page, pageSize, sortedWorkflows]\n  );\n\n  const hasMoreWorkflows = paginatedWorkflows.length < totalCount;\n  const handleLoadMoreWorkflows = useCallback(() => {\n    if (!hasMoreWorkflows) return;\n    setPage((prev) => prev + 1);\n  }, [hasMoreWorkflows]);\n\n  useEffect(() => {\n    setPage(1);\n  }, [searchQuery, statusFilter]);\n\n  useEffect(() => {\n    const maxPage = Math.max(1, Math.ceil(totalCount / pageSize));\n    if (page > maxPage) {\n      setPage(maxPage);\n    }\n  }, [page, pageSize, totalCount]);\n\n  const [editingWorkflow, setEditingWorkflow] = useState<Workflow | null>(null);\n  const [deletingWorkflow, setDeletingWorkflow] = useState<Workflow | null>(null);\n  const [isDeleting, setIsDeleting] = useState(false);\n\n  const handleSearchChange = useCallback((value: string) => {\n    setSearchQuery(value);\n    setPage(1);\n  }, []);\n\n  const handleStatusFilterChange = useCallback((value: string) => {\n    const normalized = (value as \"all\" | \"active\" | \"paused\") || \"all\";\n    setStatusFilter(normalized);\n    setPage(1);\n  }, []);\n\n  const handleEditWorkflow = useCallback((workflow: Workflow) => {\n    setEditingWorkflow(workflow);\n  }, []);\n\n  const handleDeleteWorkflow = useCallback((workflow: Workflow) => {\n    setDeletingWorkflow(workflow);\n  }, []);\n\n  const confirmDeleteWorkflow = async () => {\n    if (!deletingWorkflow) return;\n    \n    setIsDeleting(true);\n    try {\n      await deleteWorkflow(deletingWorkflow.id);\n      setDeletingWorkflow(null);\n    } catch (error) {\n      console.error('Failed to delete workflow:', error);\n    } finally {\n      setIsDeleting(false);\n    }\n  };\n\n  const cancelDeleteWorkflow = () => {\n    if (!isDeleting) {\n      setDeletingWorkflow(null);\n    }\n  };\n\n  const stats = useMemo(\n    () => ({\n      total: workflows.length,\n      active: workflows.filter((w) => w.is_active).length,\n      paused: workflows.filter((w) => !w.is_active).length,\n    }),\n    [workflows]\n  );\n\n  const totalSummary = useMemo(\n    () =>\n      t(\"workflows.stats.summary\", {\n        active: stats.active,\n        paused: stats.paused,\n      }),\n    [stats.active, stats.paused, t]\n  );\n\n  const activeCoverage = stats.total > 0 ? (stats.active / stats.total) * 100 : 0;\n  const pausedShare = stats.total > 0 ? (stats.paused / stats.total) * 100 : 0;\n  // Prefab icon style sets for KPI cards (shared across the app)\n  const iconIndigo = getKpiIconPreset(\"indigo\");\n  const iconSky = getKpiIconPreset(\"sky\");\n  const iconEmerald = getKpiIconPreset(\"emerald\");\n\n  const workflowColumns: AdvancedTableColumn<Workflow>[] = useMemo(\n    () => [\n      {\n        id: \"name\",\n        label: t(\"workflows.table.workflowName\"),\n        sortable: true,\n        sortId: \"name\",\n        hideable: false,\n        minWidth: \"200px\",\n        render: (workflow) => (\n          <div>\n            <div className=\"font-medium\">{workflow.name}</div>\n            {workflow.description && (\n              <div className=\"text-sm text-muted-foreground truncate max-w-[200px]\">\n                {workflow.description}\n              </div>\n            )}\n          </div>\n        ),\n      },\n      {\n        id: \"trigger_type\",\n        label: t(\"workflows.table.trigger\"),\n        sortable: true,\n        sortId: \"trigger_type\",\n        hideable: true,\n        minWidth: \"160px\",\n        render: (workflow) => (\n          <div className=\"text-sm\">\n            {getTriggerLabel(workflow.trigger_type)}\n          </div>\n        ),\n      },\n      {\n        id: \"channels\",\n        label: t(\"workflows.table.channels\"),\n        sortable: false,\n        hideable: true,\n        minWidth: \"120px\",\n        render: (workflow) => {\n          const channels = (workflow as any).channels || [];\n          const icons = getChannelIcons(channels);\n\n          return (\n            <div className=\"flex gap-1\">\n              {icons.length > 0 ? (\n                icons\n              ) : (\n                <span className=\"text-muted-foreground text-xs\">\n                  {t(\"workflows.channels.noChannels\")}\n                </span>\n              )}\n            </div>\n          );\n        },\n      },\n      {\n        id: \"status\",\n        label: t(\"workflows.table.status\"),\n        sortable: true,\n        sortId: \"status\",\n        hideable: true,\n        minWidth: \"120px\",\n        render: (workflow) => (\n          <Badge variant={workflow.is_active ? \"default\" : \"secondary\"}>\n            {workflow.is_active\n              ? t(\"workflows.status.active\")\n              : t(\"workflows.status.paused\")}\n          </Badge>\n        ),\n      },\n      {\n        id: \"created_at\",\n        label: t(\"workflows.table.created\"),\n        sortable: true,\n        sortId: \"created_at\",\n        hideable: true,\n        minWidth: \"160px\",\n        render: (workflow) => (\n          <div className=\"text-sm text-muted-foreground\">\n            {formatDistanceToNow(new Date(workflow.created_at), {\n              addSuffix: true,\n              locale: dateLocale,\n            })}\n          </div>\n        ),\n      },\n    ],\n    [dateLocale, getTriggerLabel, t]\n  );\n\n  const headerActions = useMemo(\n    () => (\n      <div className=\"flex flex-wrap items-center justify-end gap-3\">\n        <SegmentedControl\n          size=\"md\"\n          value={statusFilter}\n          onValueChange={(value) => handleStatusFilterChange(value as typeof statusFilter)}\n          options={[\n            { value: \"all\", label: t(\"workflows.tabs.all\") },\n            { value: \"active\", label: t(\"workflows.tabs.active\") },\n            { value: \"paused\", label: t(\"workflows.tabs.paused\") },\n          ]}\n        />\n        <CreateWorkflowSheet\n          onCreateWorkflow={createWorkflow}\n          editWorkflow={editingWorkflow}\n          onUpdateWorkflow={updateWorkflow}\n          setEditingWorkflow={setEditingWorkflow}\n        >\n          <Button className=\"flex items-center gap-2 whitespace-nowrap\">\n            <Plus className=\"h-4 w-4\" />\n            {t(\"workflows.buttons.createWorkflow\")}\n          </Button>\n        </CreateWorkflowSheet>\n      </div>\n    ),\n    [\n      createWorkflow,\n      editingWorkflow,\n      handleStatusFilterChange,\n      statusFilter,\n      setEditingWorkflow,\n      t,\n      updateWorkflow,\n    ]\n  );\n\n  const renderRowActions = useCallback(\n    (workflow: Workflow) => (\n      <div className=\"flex items-center gap-2\">\n        <Switch\n          checked={workflow.is_active}\n          onCheckedChange={(checked) => toggleWorkflowStatus(workflow.id, checked)}\n        />\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => handleEditWorkflow(workflow)}\n          className=\"h-8 w-8 p-0\"\n        >\n          <Edit className=\"h-4 w-4\" />\n        </Button>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => handleDeleteWorkflow(workflow)}\n          className=\"h-8 w-8 p-0 text-destructive hover:text-destructive\"\n        >\n          <Trash2 className=\"h-4 w-4\" />\n        </Button>\n      </div>\n    ),\n    [handleDeleteWorkflow, handleEditWorkflow, toggleWorkflowStatus]\n  );\n\n  const handleTableSortChange = useCallback((next: AdvancedDataTableSortState) => {\n    if (!next.columnId) {\n      setSortState({ columnId: null, direction: next.direction });\n    } else {\n      setSortState(next);\n    }\n    setPage(1);\n  }, []);\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen overflow-x-hidden\">\n        <PageHeader \n          title={t(\"workflows.title\")}\n          subtitle={t(\"workflows.subtitle\")}\n        />\n        <PageLoadingSkeleton />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen overflow-x-hidden\">\n      <PageHeader \n        title={t(\"workflows.title\")}\n        subtitle={t(\"workflows.subtitle\")}\n      />\n      \n      <div className=\"p-4 space-y-6\">\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-1 gap-4 lg:grid-cols-3\">\n          <KpiCard\n            icon={Zap}\n            {...iconIndigo}\n            title={t(\"workflows.stats.totalWorkflows\")}\n            value={stats.total}\n            description={totalSummary}\n            footer={\n              <Button\n                size=\"xs\"\n                variant=\"outline\"\n                className={KPI_ACTION_BUTTON_CLASS}\n                onClick={() => handleStatusFilterChange(\"all\")}\n              >\n                {t(\"workflows.stats.viewAll\")}\n              </Button>\n            }\n          />\n          <KpiCard\n            icon={CheckCircle}\n            {...iconSky}\n            title={t(\"workflows.stats.active\")}\n            value={stats.active}\n            description={t(\"workflows.stats.activeDescription\")}\n            progress={{\n              value: activeCoverage,\n              label: t(\"workflows.stats.coverageLabel\"),\n              ariaLabel: t(\"workflows.stats.coverageAriaLabel\"),\n              action: (\n                <Button\n                  size=\"xs\"\n                  variant=\"outline\"\n                  className={KPI_ACTION_BUTTON_CLASS}\n                  onClick={() => handleStatusFilterChange(\"active\")}\n                >\n                  {t(\"workflows.stats.quickFilterActive\")}\n                </Button>\n              ),\n            }}\n          />\n          <KpiCard\n            icon={Clock}\n            {...iconEmerald}\n            title={t(\"workflows.stats.paused\")}\n            value={stats.paused}\n            description={t(\"workflows.stats.pausedDescription\")}\n            progress={{\n              value: pausedShare,\n              label: t(\"workflows.stats.pausedShareLabel\"),\n              ariaLabel: t(\"workflows.stats.pausedShareAriaLabel\"),\n              action: (\n                <Button\n                  size=\"xs\"\n                  variant=\"outline\"\n                  className={KPI_ACTION_BUTTON_CLASS}\n                  onClick={() => handleStatusFilterChange(\"paused\")}\n                >\n                  {t(\"workflows.stats.quickFilterPaused\")}\n                </Button>\n              ),\n            }}\n          />\n        </div>\n\n        <AdvancedDataTable\n          title={t(\"workflows.table.header\", { defaultValue: t(\"workflows.title\") })}\n          data={paginatedWorkflows}\n          columns={workflowColumns}\n          rowKey={(workflow) => workflow.id}\n          isLoading={loading}\n          zebra\n          actions={headerActions}\n          searchValue={searchQuery}\n          onSearchChange={handleSearchChange}\n          searchPlaceholder={t(\"workflows.search\")}\n          searchLoading={loading}\n          searchDelay={0}\n          sortState={sortState}\n          onSortChange={handleTableSortChange}\n          onLoadMore={hasMoreWorkflows ? handleLoadMoreWorkflows : undefined}\n          hasMore={hasMoreWorkflows}\n          emptyState={\n            workflows.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center p-12 text-center\">\n                <div className=\"p-4 bg-primary/10 rounded-full mb-4\">\n                  <Zap className=\"h-8 w-8 text-primary\" />\n                </div>\n                <h3 className=\"text-lg font-semibold mb-2\">\n                  {t(\"workflows.emptyState.noWorkflowsYet\")}\n                </h3>\n                <p className=\"text-muted-foreground mb-6 max-w-sm\">\n                  {t(\"workflows.emptyState.createFirstMessage\")}\n                </p>\n                <CreateWorkflowSheet\n                  onCreateWorkflow={createWorkflow}\n                  editWorkflow={editingWorkflow}\n                  onUpdateWorkflow={updateWorkflow}\n                  setEditingWorkflow={setEditingWorkflow}\n                >\n                  <Button>\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    {t(\"workflows.buttons.createFirstWorkflow\")}\n                  </Button>\n                </CreateWorkflowSheet>\n              </div>\n            ) : (\n              <div className=\"flex flex-col items-center justify-center p-8 text-center\">\n                <AlertTriangle className=\"h-8 w-8 text-muted-foreground mb-4\" />\n                <h3 className=\"text-lg font-semibold mb-2\">\n                  {t(\"workflows.emptyState.noMatchingFilters\")}\n                </h3>\n                <p className=\"text-muted-foreground\">\n                  {t(\"workflows.emptyState.adjustFilters\")}\n                </p>\n              </div>\n            )\n          }\n          rowActions={renderRowActions}\n        />\n      </div>\n\n      {/* Delete Confirmation Dialog */}\n      <WorkflowDeleteDialog\n        open={!!deletingWorkflow}\n        workflow={deletingWorkflow}\n        onConfirm={confirmDeleteWorkflow}\n        onCancel={cancelDeleteWorkflow}\n        isDeleting={isDeleting}\n      />\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/AllLeads.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/AllProjects.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":63,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":63,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3021,3024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3021,3024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3171,3174],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3171,3174],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":212,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6357,6360],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6357,6360],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-non-null-assertion').","line":302,"column":3,"severity":1,"nodeType":null,"fix":{"range":[8973,9041],"text":" "}}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import React from \"react\";\nimport { act, fireEvent, render, screen, waitFor } from \"@/utils/testUtils\";\nimport AllProjects from \"../AllProjects\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { useProjectsListFilters, useProjectsArchivedFilters } from \"@/pages/projects/hooks/useProjectsFilters\";\nimport { useProjectsData } from \"@/pages/projects/hooks/useProjectsData\";\nimport { useOnboarding } from \"@/contexts/OnboardingContext\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\nimport { useConnectivity } from \"@/contexts/ConnectivityContext\";\nimport { useProjectTypes, useProjectStatuses, useServices } from \"@/hooks/useOrganizationData\";\nimport { useThrottledRefetchOnFocus } from \"@/hooks/useThrottledRefetchOnFocus\";\n\njest.mock(\"@/features/project-creation\", () => ({\n  ProjectCreationWizardSheet: ({ isOpen, onOpenChange }: { isOpen: boolean; onOpenChange: (open: boolean) => void }) => (\n    <button\n      type=\"button\"\n      data-testid=\"project-wizard-sheet\"\n      data-open={String(isOpen)}\n      onClick={() => onOpenChange(false)}\n    >\n      Wizard\n    </button>\n  ),\n}));\n\njest.mock(\"@/components/ViewProjectDialog\", () => ({\n  ViewProjectDialog: () => null,\n}));\n\njest.mock(\"@/components/ProjectSheetView\", () => ({\n  ProjectSheetView: () => null,\n}));\n\njest.mock(\"@/components/ProjectKanbanBoard\", () => ({\n  __esModule: true,\n  default: ({ projects }: { projects: Array<{ id: string; name: string }> }) => (\n    <div data-testid=\"kanban-board\">\n      {projects.map((project) => (\n        <div key={project.id}>{project.name}</div>\n      ))}\n    </div>\n  ),\n}));\n\njest.mock(\"@/components/GlobalSearch\", () => ({\n  __esModule: true,\n  default: () => <div data-testid=\"global-search\" />,\n}));\n\njest.mock(\"@/components/ui/page-header\", () => ({\n  PageHeader: ({ children }: { children: React.ReactNode }) => (\n    <div data-testid=\"page-header\">{children}</div>\n  ),\n  PageHeaderSearch: ({ children }: { children: React.ReactNode }) => (\n    <div data-testid=\"page-header-search\">{children}</div>\n  ),\n  PageHeaderActions: ({ children }: { children: React.ReactNode }) => (\n    <div data-testid=\"page-header-actions\">{children}</div>\n  ),\n}));\n\njest.mock(\"@/components/ui/button\", () => {\n  const React = require(\"react\");\n  const Button = React.forwardRef<HTMLButtonElement, React.ButtonHTMLAttributes<HTMLButtonElement>>(\n    ({ children, ...props }, ref) => (\n      <button ref={ref} {...props}>\n        {children}\n      </button>\n    )\n  );\n  Button.displayName = \"Button\";\n  return {\n    __esModule: true,\n    Button,\n  };\n});\n\njest.mock(\"@/components/ProjectStatusBadge\", () => ({\n  ProjectStatusBadge: ({ currentStatusId }: { currentStatusId?: string }) => (\n    <span data-testid=\"project-status\">{currentStatusId}</span>\n  ),\n}));\n\njest.mock(\"@/components/KanbanSettingsSheet\", () => ({\n  KanbanSettingsSheet: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n}));\n\njest.mock(\"@/components/data-table\", () => ({\n  AdvancedDataTable: ({ data, actions }: any) => (\n    <div data-testid=\"advanced-data-table\">\n      <div data-testid=\"data-table-actions\">{actions}</div>\n      <div>\n        {data.map((row: any) => (\n          <div key={row.id}>{row.name}</div>\n        ))}\n      </div>\n    </div>\n  ),\n}));\n\njest.mock(\"@/components/shared/OnboardingTutorial\", () => ({\n  OnboardingTutorial: () => <div data-testid=\"onboarding-tutorial\" />,\n}));\n\njest.mock(\"@/hooks/use-mobile\", () => ({\n  useIsMobile: () => false,\n}));\n\njest.mock(\"@/hooks/useTypedTranslation\", () => ({\n  useFormsTranslation: () => ({\n    t: (key: string, options?: Record<string, unknown>) => {\n      if (options && \"visible\" in options && \"total\" in options) {\n        return `${key}:${options.visible}/${options.total}`;\n      }\n      return key;\n    },\n  }),\n  useDashboardTranslation: () => ({\n    t: (key: string) => key,\n  }),\n}));\n\njest.mock(\"@/hooks/useOrganizationData\", () => ({\n  useProjectTypes: jest.fn(),\n  useProjectStatuses: jest.fn(),\n  useServices: jest.fn(),\n}));\n\njest.mock(\"@/pages/projects/hooks/useProjectsFilters\", () => ({\n  useProjectsListFilters: jest.fn(),\n  useProjectsArchivedFilters: jest.fn(),\n}));\n\njest.mock(\"@/pages/projects/hooks/useProjectsData\", () => ({\n  useProjectsData: jest.fn(),\n}));\n\njest.mock(\"@/contexts/OnboardingContext\", () => ({\n  useOnboarding: jest.fn(),\n}));\n\njest.mock(\"@/contexts/OrganizationContext\", () => ({\n  useOrganization: jest.fn(),\n}));\n\njest.mock(\"@/contexts/ConnectivityContext\", () => ({\n  useConnectivity: jest.fn(),\n}));\n\njest.mock(\"@/hooks/useThrottledRefetchOnFocus\", () => ({\n  useThrottledRefetchOnFocus: jest.fn(),\n}));\n\njest.mock(\"@/hooks/use-toast\", () => ({\n  toast: jest.fn(),\n}));\n\njest.mock(\"@/lib/utils\", () => ({\n  formatDate: (value: string | null) => value ?? \"\",\n  isNetworkError: () => false,\n}));\n\njest.mock(\"@/lib/debug\", () => ({\n  startTimer: () => ({ end: jest.fn() }),\n}));\n\njest.mock(\"xlsx/xlsx.mjs\", () => ({\n  writeFileXLSX: jest.fn(),\n  utils: {\n    json_to_sheet: jest.fn(() => ({})),\n    book_new: jest.fn(() => ({})),\n    book_append_sheet: jest.fn(),\n  },\n}));\n\njest.mock(\"date-fns\", () => ({\n  format: () => \"2024-01-01_0100\",\n}));\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string, options?: Record<string, unknown>) => {\n      if (options && \"visible\" in options && \"total\" in options) {\n        return `${key}:${options.visible}/${options.total}`;\n      }\n      return key;\n    },\n  }),\n}));\n\nconst mockUseProjectsListFilters = useProjectsListFilters as jest.Mock;\nconst mockUseProjectsArchivedFilters = useProjectsArchivedFilters as jest.Mock;\nconst mockUseProjectsData = useProjectsData as jest.Mock;\nconst mockUseOnboarding = useOnboarding as jest.Mock;\nconst mockUseOrganization = useOrganization as jest.Mock;\nconst mockUseConnectivity = useConnectivity as jest.Mock;\nconst mockUseProjectTypes = useProjectTypes as jest.Mock;\nconst mockUseProjectStatuses = useProjectStatuses as jest.Mock;\nconst mockUseServices = useServices as jest.Mock;\nconst mockUseThrottledRefetchOnFocus = useThrottledRefetchOnFocus as jest.Mock;\n\nconst mockNavigate = jest.fn();\n\njest.mock(\"react-router-dom\", () => {\n  const actual = jest.requireActual(\"react-router-dom\");\n  return {\n    ...actual,\n    useNavigate: () => mockNavigate,\n  };\n});\n\nconst createProject = (overrides: Partial<Record<string, any>> = {}) => ({\n  id: \"project-1\",\n  name: \"Sample Project\",\n  description: \"Description\",\n  status_id: \"status-1\",\n  lead: { id: \"lead-1\", name: \"Client\" },\n  project_type: { id: \"type-1\", name: \"Wedding\" },\n  project_status: { id: \"status-1\", name: \"In Progress\" },\n  session_count: 2,\n  services: [{ id: \"service-1\", name: \"Photography\" }],\n  completed_todo_count: 1,\n  todo_count: 3,\n  open_todos: [],\n  created_at: \"2024-01-01T00:00:00Z\",\n  updated_at: \"2024-01-02T00:00:00Z\",\n  paid_amount: 0,\n  remaining_amount: 0,\n  ...overrides,\n});\n\nconst defaultFilters = {\n  state: {},\n  filtersConfig: [],\n  activeCount: 0,\n  summaryChips: [],\n  reset: jest.fn(),\n};\n\nconst connectivity = {\n  reportNetworkError: jest.fn(),\n  reportRecovery: jest.fn(),\n  registerRetry: jest.fn(() => () => {}),\n};\n\nconst onboarding = {\n  completeCurrentStep: jest.fn().mockResolvedValue(undefined),\n  shouldLockNavigation: false,\n  currentStepInfo: null,\n};\n\nconst setupDefaults = (overrides?: {\n  projects?: ReturnType<typeof createProject>[];\n  listTotal?: number;\n  archivedTotal?: number;\n}) => {\n  const projects = overrides?.projects ?? [createProject()];\n  mockUseProjectsListFilters.mockReturnValue({ ...defaultFilters });\n  mockUseProjectsArchivedFilters.mockReturnValue({ ...defaultFilters });\n  mockUseProjectTypes.mockReturnValue({ data: [] });\n  mockUseProjectStatuses.mockReturnValue({ data: [], isLoading: false });\n  mockUseServices.mockReturnValue({ data: [] });\n  mockUseOnboarding.mockReturnValue(onboarding);\n  mockUseOrganization.mockReturnValue({ activeOrganizationId: \"org-1\" });\n  mockUseConnectivity.mockReturnValue(connectivity);\n  mockUseThrottledRefetchOnFocus.mockImplementation(() => {});\n\n  mockUseProjectsData.mockReturnValue({\n    listProjects: projects,\n    archivedProjects: [],\n    listTotalCount: overrides?.listTotal ?? projects.length,\n    archivedTotalCount: overrides?.archivedTotal ?? 0,\n    initialLoading: false,\n    listLoading: false,\n    archivedLoading: false,\n    refetch: jest.fn().mockResolvedValue(undefined),\n    fetchProjectsData: jest.fn().mockResolvedValue({\n      projects,\n      count: projects.length,\n      source: \"network\",\n    }),\n    getCachedProjects: jest.fn(() => []),\n    getCacheStatus: jest.fn(() => ({\n      total: 0,\n      cached: 0,\n      contiguous: 0,\n      hasFull: false,\n      key: null,\n      lastFetched: 0,\n    })),\n  });\n};\n\nconst renderAllProjects = async () => {\n  let renderResult: ReturnType<typeof render>;\n  await act(async () => {\n    renderResult = render(<AllProjects />);\n  });\n  await act(async () => {\n    await Promise.resolve();\n  });\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  return renderResult!;\n};\n\nbeforeEach(() => {\n  jest.clearAllMocks();\n  setupDefaults();\n  window.localStorage.clear();\n  window.history.pushState({}, \"\", \"http://localhost/projects\");\n});\n\nafterEach(() => {\n  jest.clearAllMocks();\n});\n\nit(\"persists view mode selection to localStorage and url\", async () => {\n  window.history.pushState({}, \"\", \"http://localhost/projects\");\n  await renderAllProjects();\n\n  const boardButton = screen.getByRole(\"button\", { name: \"projects.board\" });\n  fireEvent.click(boardButton);\n\n  expect(window.localStorage.getItem(\"projects:viewMode\")).toBe(\"board\");\n  expect(window.location.search).toBe(\"?view=board\");\n});\n\nit(\"loads board projects and keeps list view data in sync when toggling views\", async () => {\n  const boardProjects = [createProject({ id: \"project-2\", name: \"Board Project\" })];\n  const fetchProjectsData = jest.fn().mockResolvedValue({\n    projects: boardProjects,\n    count: boardProjects.length,\n    source: \"network\",\n  });\n\n  mockUseProjectsData.mockReturnValue({\n    listProjects: boardProjects,\n    archivedProjects: [],\n    listTotalCount: boardProjects.length,\n    archivedTotalCount: 0,\n    initialLoading: false,\n    listLoading: false,\n    archivedLoading: false,\n    refetch: jest.fn().mockResolvedValue(undefined),\n    fetchProjectsData,\n    getCachedProjects: jest.fn(() => []),\n    getCacheStatus: jest.fn(() => ({\n      total: 0,\n      cached: 0,\n      contiguous: 0,\n      hasFull: false,\n      key: null,\n      lastFetched: 0,\n    })),\n  });\n\n  window.history.pushState({}, \"\", \"http://localhost/projects?view=board\");\n\n  await renderAllProjects();\n\n  await waitFor(() => {\n    expect(screen.getByTestId(\"kanban-board\")).toHaveTextContent(\"Board Project\");\n  });\n\n  expect(fetchProjectsData).toHaveBeenCalledWith(\"active\", expect.objectContaining({ includeCount: true }));\n\n  const listButton = screen.getByRole(\"button\", { name: \"projects.list\" });\n  fireEvent.click(listButton);\n\n  await waitFor(() => {\n    expect(screen.getByTestId(\"advanced-data-table\")).toHaveTextContent(\"Board Project\");\n  });\n});\n\nit(\"shows an error toast when exporting projects fails\", async () => {\n  const projects = [createProject({ id: \"project-3\", name: \"Export Project\" })];\n  const fetchProjectsData = jest.fn().mockRejectedValue(new Error(\"export failed\"));\n\n  mockUseProjectsData.mockReturnValue({\n    listProjects: projects,\n    archivedProjects: [],\n    listTotalCount: projects.length,\n    archivedTotalCount: 0,\n    initialLoading: false,\n    listLoading: false,\n    archivedLoading: false,\n    refetch: jest.fn().mockResolvedValue(undefined),\n    fetchProjectsData,\n    getCachedProjects: jest.fn(() => []),\n    getCacheStatus: jest.fn(() => ({\n      total: 0,\n      cached: 0,\n      contiguous: 0,\n      hasFull: false,\n      key: null,\n      lastFetched: 0,\n    })),\n  });\n\n  window.history.pushState({}, \"\", \"http://localhost/projects?view=list\");\n\n  await renderAllProjects();\n\n  const exportButton = screen.getByRole(\"button\", { name: /projects.export.button/i });\n  await act(async () => {\n    fireEvent.click(exportButton);\n  });\n\n  await waitFor(() => {\n    expect(toast).toHaveBeenCalledWith(expect.objectContaining({\n      title: \"projects.export.errorTitle\",\n      variant: \"destructive\",\n      description: \"export failed\",\n    }));\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/Analytics.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/Auth.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/Calendar.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/GettingStarted.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[687,690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[687,690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1192,1195],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1192,1195],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import userEvent from \"@testing-library/user-event\";\nimport { render, screen, waitFor } from \"@/utils/testUtils\";\nimport GettingStarted from \"../GettingStarted\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useOnboarding } from \"@/contexts/OnboardingContext\";\nimport { useNavigate } from \"react-router-dom\";\n\njest.mock(\"react-router-dom\", () => ({\n  ...jest.requireActual(\"react-router-dom\"),\n  useNavigate: jest.fn(),\n}));\n\njest.mock(\"@/contexts/AuthContext\", () => ({\n  useAuth: jest.fn(),\n}));\n\njest.mock(\"@/contexts/OnboardingContext\", () => ({\n  useOnboarding: jest.fn(),\n}));\n\njest.mock(\"@/components/SampleDataModal\", () => ({\n  SampleDataModal: ({ open, onClose }: any) =>\n    open ? (\n      <div data-testid=\"sample-data-modal\">\n        <button onClick={onClose}>close-sample</button>\n      </div>\n    ) : null,\n}));\n\njest.mock(\"@/components/RestartGuidedModeButton\", () => ({\n  RestartGuidedModeButton: () => <div data-testid=\"restart-guided\" />,\n}));\n\njest.mock(\"@/components/ExitGuidanceModeButton\", () => ({\n  ExitGuidanceModeButton: () => <div data-testid=\"exit-guided\" />,\n}));\n\njest.mock(\"@/components/GuidedStepProgress\", () => ({\n  GuidedStepProgress: (props: any) => (\n    <div data-testid=\"guided-progress\" data-props={JSON.stringify(props)} />\n  ),\n}));\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string) => key,\n  }),\n}));\n\nconst mockUseAuth = useAuth as jest.Mock;\nconst mockUseOnboarding = useOnboarding as jest.Mock;\nconst mockUseNavigate = useNavigate as jest.Mock;\n\nconst buildOnboardingState = (overrides: Partial<ReturnType<typeof mockUseOnboarding>> = {}) => ({\n  loading: false,\n  isInGuidedSetup: true,\n  isOnboardingComplete: false,\n  currentStepInfo: { id: 1, route: \"/leads\", title: \"Lead\" },\n  nextStepInfo: { id: 2, route: \"/projects\", title: \"Project\" },\n  completedSteps: [],\n  isAllStepsComplete: false,\n  totalSteps: 5,\n  currentStep: 1,\n  completeOnboarding: jest.fn().mockResolvedValue(undefined),\n  ...overrides,\n});\n\ndescribe(\"GettingStarted page\", () => {\n  const navigate = jest.fn();\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockUseAuth.mockReturnValue({ user: { id: \"user-1\" } });\n    mockUseNavigate.mockReturnValue(navigate);\n  });\n\n  it(\"shows loading state while onboarding data is fetching\", () => {\n    mockUseOnboarding.mockReturnValue(\n      buildOnboardingState({\n        loading: true,\n        completedSteps: [],\n        currentStepInfo: null,\n        nextStepInfo: null,\n      })\n    );\n\n    render(<GettingStarted />);\n\n    expect(\n      screen.getByText(\"onboarding.getting_started.loading\")\n    ).toBeInTheDocument();\n  });\n\n  it(\"redirects to dashboard when onboarding already complete\", () => {\n    const completeState = buildOnboardingState({\n      loading: false,\n      isInGuidedSetup: false,\n      isOnboardingComplete: true,\n    });\n    mockUseOnboarding.mockReturnValue(completeState);\n\n    render(<GettingStarted />);\n\n    expect(navigate).toHaveBeenCalledWith(\"/\", { replace: true });\n  });\n\n  it(\"renders current step info and allows navigation to tutorial routes\", async () => {\n    const state = buildOnboardingState({\n      completedSteps: [\n        { id: 99, route: \"/completed\" },\n      ],\n      currentStepInfo: { id: 1, route: \"/projects\", title: \"Projects\" },\n      nextStepInfo: { id: 3, route: \"/calendar\", title: \"Calendar\" },\n      currentStep: 2,\n    });\n    mockUseOnboarding.mockReturnValue(state);\n\n    render(<GettingStarted />);\n\n    const progress = screen.getByTestId(\"guided-progress\");\n    expect(progress).toHaveAttribute(\n      \"data-props\",\n      expect.stringContaining('\"currentValue\":1')\n    );\n\n    const user = userEvent.setup();\n    const primaryButton = screen.getByRole(\"button\", {\n      name: \"onboarding.steps.step_1.button\",\n    });\n    await user.click(primaryButton);\n\n    expect(navigate).toHaveBeenCalledWith(\"/projects?tutorial=true\");\n\n    expect(screen.queryByTestId(\"sample-data-modal\")).not.toBeInTheDocument();\n    const skipButton = screen.getByRole(\"button\", {\n      name: \"onboarding.getting_started.skip_setup\",\n    });\n    await user.click(skipButton);\n    expect(screen.getByTestId(\"sample-data-modal\")).toBeInTheDocument();\n\n    await user.click(screen.getByText(\"close-sample\"));\n    await waitFor(() =>\n      expect(screen.queryByTestId(\"sample-data-modal\")).not.toBeInTheDocument()\n    );\n  });\n\n  it(\"completes onboarding when finishing guided steps\", async () => {\n    const completeOnboarding = jest.fn().mockResolvedValue(undefined);\n    const state = buildOnboardingState({\n      isAllStepsComplete: true,\n      completeOnboarding,\n    });\n    mockUseOnboarding.mockReturnValue(state);\n\n    render(<GettingStarted />);\n\n    const user = userEvent.setup();\n    const finishButton = screen.getByRole(\"button\", {\n      name: \"onboarding.getting_started.go_to_dashboard\",\n    });\n\n    await user.click(finishButton);\n\n    await waitFor(() => expect(completeOnboarding).toHaveBeenCalledTimes(1));\n    expect(navigate).toHaveBeenCalledWith(\"/\", { replace: true });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/Index.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1354,1357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1354,1357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1440,1443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1440,1443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1958,1961],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1958,1961],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2454,2457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2454,2457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { act } from \"react\";\nimport { render, screen } from \"@/utils/testUtils\";\nimport Index from \"../Index\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useNavigate } from \"react-router-dom\";\n\njest.mock(\"@/integrations/supabase/client\", () => {\n  const onAuthStateChange = jest.fn();\n  const getSession = jest.fn();\n  return {\n    supabase: {\n      auth: {\n        onAuthStateChange,\n        getSession,\n      },\n    },\n  };\n});\n\njest.mock(\"react-router-dom\", () => ({\n  ...jest.requireActual(\"react-router-dom\"),\n  useNavigate: jest.fn(),\n}));\n\njest.mock(\"@/components/CrmDashboard\", () => ({\n  __esModule: true,\n  default: () => <div data-testid=\"crm-dashboard\" />,\n}));\n\njest.mock(\"@/components/ui/loading-presets\", () => ({\n  PageLoadingSkeleton: () => <div data-testid=\"page-loading\" />,\n}));\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string) => key,\n  }),\n}));\n\nconst mockUseNavigate = useNavigate as jest.Mock;\nconst mockAuth = supabase.auth as unknown as {\n  onAuthStateChange: jest.Mock;\n  getSession: jest.Mock;\n};\n\ndescribe(\"Index page\", () => {\n  const navigate = jest.fn();\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockUseNavigate.mockReturnValue(navigate);\n  });\n\n  it(\"shows loading skeleton while session is resolving\", async () => {\n    let resolveSession: (value: any) => void = () => {};\n    mockAuth.onAuthStateChange.mockImplementation((_handler: any) => ({\n      data: { subscription: { unsubscribe: jest.fn() } },\n    }));\n    mockAuth.getSession.mockReturnValue(\n      new Promise((resolve) => {\n        resolveSession = resolve;\n      })\n    );\n\n    render(<Index />);\n\n    expect(screen.getByTestId(\"page-loading\")).toBeInTheDocument();\n\n    await act(async () => {\n      resolveSession({ data: { session: null } });\n    });\n  });\n\n  it(\"renders dashboard when a user session exists\", async () => {\n    mockAuth.onAuthStateChange.mockImplementation((_handler: any) => ({\n      data: { subscription: { unsubscribe: jest.fn() } },\n    }));\n    mockAuth.getSession.mockResolvedValue({\n      data: { session: { user: { id: \"user-1\" } } },\n    });\n\n    render(<Index />);\n\n    await act(async () => {\n      await Promise.resolve();\n    });\n\n    expect(screen.getByTestId(\"crm-dashboard\")).toBeInTheDocument();\n  });\n\n  it(\"renders marketing hero and navigates to auth when CTA clicked\", async () => {\n    mockAuth.onAuthStateChange.mockImplementation((handler: any) => {\n      handler(\"SIGNED_OUT\", null);\n      return { data: { subscription: { unsubscribe: jest.fn() } } };\n    });\n    mockAuth.getSession.mockResolvedValue({ data: { session: null } });\n\n    render(<Index />);\n\n    await act(async () => {\n      await Promise.resolve();\n    });\n\n    const cta = screen.getByRole(\"button\", { name: \"buttons.get_started\" });\n    cta.click();\n\n    expect(navigate).toHaveBeenCalledWith(\"/auth\");\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/LeadDetail.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/NotFound.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/Payments.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/ProjectDetail.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/ReminderDetails.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/SessionDetail.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/TemplateBuilder.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/Templates.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":51,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":51,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":6,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":9,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2209,2212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2209,2212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2522,2525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2522,2525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2716,2719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2716,2719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { fireEvent, render, screen, waitFor } from \"@/utils/testUtils\";\nimport Templates from \"../Templates\";\nimport { useTemplateOperations } from \"@/hooks/useTemplateOperations\";\nimport { Template } from \"@/types/template\";\n\njest.mock(\"@/components/template-builder/TemplateErrorBoundary\", () => ({\n  TemplateErrorBoundary: ({ children }: { children: React.ReactNode }) => (\n    <div data-testid=\"template-error-boundary\">{children}</div>\n  ),\n}));\n\njest.mock(\"@/components/template-builder/DeleteTemplateDialog\", () => ({\n  DeleteTemplateDialog: ({\n    open,\n    onClose,\n    onConfirm,\n    templateName,\n    loading,\n  }: {\n    open: boolean;\n    onClose: () => void;\n    onConfirm: () => Promise<void> | void;\n    templateName: string;\n    loading?: boolean;\n  }) =>\n    open ? (\n      <div data-testid=\"delete-template-dialog\">\n        <span>{templateName}</span>\n        {loading && <span data-testid=\"delete-loading\">loading</span>}\n        <button type=\"button\" onClick={onConfirm}>\n          confirm delete\n        </button>\n        <button type=\"button\" onClick={onClose}>\n          cancel\n        </button>\n      </div>\n    ) : null,\n}));\n\njest.mock(\"@/components/ui/page-header\", () => ({\n  PageHeader: ({ title, subtitle }: { title: string; subtitle?: string }) => (\n    <header data-testid=\"page-header\">\n      <h1>{title}</h1>\n      {subtitle && <p>{subtitle}</p>}\n    </header>\n  ),\n}));\n\njest.mock(\"@/components/ui/button\", () => {\n  const React = require(\"react\");\n  const Button = React.forwardRef<HTMLButtonElement, React.ButtonHTMLAttributes<HTMLButtonElement>>(\n    ({ children, ...props }, ref) => (\n      <button ref={ref} {...props}>\n        {children}\n      </button>\n    )\n  );\n  Button.displayName = \"Button\";\n  return {\n    __esModule: true,\n    Button,\n  };\n});\n\njest.mock(\"@/components/ui/badge\", () => ({\n  Badge: ({ children }: { children: React.ReactNode }) => (\n    <span data-testid=\"badge\">{children}</span>\n  ),\n}));\n\njest.mock(\"@/components/data-table\", () => ({\n  AdvancedDataTable: ({\n    data,\n    columns,\n    actions,\n    searchValue,\n    onSearchChange,\n    emptyState,\n    onRowClick,\n    rowActions,\n    onLoadMore,\n    hasMore,\n  }: any) => (\n    <div data-testid=\"advanced-data-table\">\n      <div data-testid=\"table-actions\">{actions}</div>\n      <input\n        data-testid=\"table-search\"\n        value={searchValue ?? \"\"}\n        onChange={(event) => onSearchChange?.(event.target.value)}\n      />\n      {data.length ? (\n        data.map((row: any) => (\n          <div\n            key={row.id}\n            data-testid={`template-row-${row.id}`}\n            onClick={() => onRowClick?.(row)}\n          >\n            {columns?.map((column: any) => (\n              <div key={column.id} data-testid={`template-${row.id}-${column.id}`}>\n                {column.render?.(row)}\n              </div>\n            ))}\n            <div data-testid={`template-actions-${row.id}`}>\n              {rowActions?.(row)}\n            </div>\n          </div>\n        ))\n      ) : (\n        <div data-testid=\"empty-state\">{emptyState}</div>\n      )}\n      {onLoadMore && hasMore && (\n        <button data-testid=\"load-more\" type=\"button\" onClick={() => onLoadMore?.()}>\n          Load more\n        </button>\n      )}\n    </div>\n  ),\n}));\n\nconst mockNavigate = jest.fn();\n\njest.mock(\"react-router-dom\", () => {\n  const actual = jest.requireActual(\"react-router-dom\");\n  return {\n    ...actual,\n    useNavigate: () => mockNavigate,\n  };\n});\n\njest.mock(\"date-fns\", () => ({\n  formatDistanceToNow: () => \"3 days ago\",\n}));\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string, options?: Record<string, unknown>) => {\n      const map: Record<string, string> = {\n        \"templates.title\": \"Message Templates\",\n        \"templates.subtitle\": \"Design and manage reusable email templates\",\n        \"templates.table.title\": \"Templates Table\",\n        \"templates.table.templateName\": \"Template Name\",\n        \"templates.table.preview\": \"Preview\",\n        \"templates.table.status\": \"Status\",\n        \"templates.table.lastUpdated\": \"Last Updated\",\n        \"templates.status.published\": \"Published\",\n        \"templates.status.draft\": \"Draft\",\n        \"templates.buttons.newTemplate\": \"New Template\",\n        \"templates.buttons.createFirstTemplate\": \"Create Your First Template\",\n        \"templates.buttons.edit\": \"Edit\",\n        \"templates.buttons.duplicate\": \"Duplicate template\",\n        \"templates.buttons.delete\": \"Delete template\",\n        \"templates.search\": \"Search templates...\",\n        \"templates.emptyState.noTemplatesFound\": \"No templates found\",\n        \"templates.emptyState.noTemplatesYet\": \"No templates created yet\",\n        \"templates.emptyState.adjustSearch\": \"Try adjusting your search terms to find what you're looking for.\",\n        \"templates.emptyState.createFirstMessage\": \"Create your first email template to get started with automated communications.\",\n        \"templates.error.loadingTemplates\": \"Error Loading Templates\",\n        \"templates.preview.noPreview\": \"No preview available translation\",\n      };\n\n      if (key === \"templates.table.title\" && options && \"defaultValue\" in options) {\n        return map[key] ?? String(options.defaultValue);\n      }\n\n      return map[key] ?? key;\n    },\n    i18n: { language: \"en\" },\n  }),\n}));\n\njest.mock(\"@/hooks/useTemplateOperations\");\n\nconst mockUseTemplateOperations = useTemplateOperations as jest.Mock<TemplateOperationsMock, []>;\n\nconst baseTemplate: Template = {\n  id: \"template-1\",\n  name: \"Welcome Email\",\n  category: \"email\",\n  master_content: \"\",\n  master_subject: \"\",\n  placeholders: [],\n  is_active: true,\n  created_at: \"2024-01-01T00:00:00.000Z\",\n  updated_at: \"2024-01-02T00:00:00.000Z\",\n  user_id: \"user-1\",\n  organization_id: \"org-1\",\n  channels: {},\n};\n\ntype TemplateOperationsMock = {\n  templates: Template[];\n  filteredTemplates: Template[];\n  loading: boolean;\n  error: string | null;\n  searchTerm: string;\n  setSearchTerm: jest.Mock<void, [string]>;\n  refreshTemplates: jest.Mock<Promise<void>, []>;\n  deleteTemplate: jest.Mock<Promise<boolean>, [string]>;\n  duplicateTemplate: jest.Mock<Promise<boolean>, [Template]>;\n};\n\nconst createOperations = (overrides: Partial<TemplateOperationsMock> = {}): TemplateOperationsMock => ({\n  templates: [baseTemplate],\n  filteredTemplates: [baseTemplate],\n  loading: false,\n  error: null,\n  searchTerm: \"\",\n  setSearchTerm: jest.fn<void, [string]>(),\n  refreshTemplates: jest.fn<Promise<void>, []>().mockResolvedValue(undefined),\n  deleteTemplate: jest.fn<Promise<boolean>, [string]>().mockResolvedValue(true),\n  duplicateTemplate: jest.fn<Promise<boolean>, [Template]>().mockResolvedValue(true),\n  ...overrides,\n});\n\nconst setupMockOperations = (overrides: Partial<TemplateOperationsMock> = {}) => {\n  const value = createOperations(overrides);\n  mockUseTemplateOperations.mockReturnValue(value);\n  return value;\n};\n\nbeforeEach(() => {\n  jest.clearAllMocks();\n  mockUseTemplateOperations.mockReset();\n  mockNavigate.mockReset();\n});\n\nconst renderTemplates = () => render(<Templates />);\n\ndescribe(\"Templates page\", () => {\n  it(\"renders template rows with translated preview fallback\", () => {\n    setupMockOperations();\n\n    renderTemplates();\n\n    expect(screen.getByText(\"Message Templates\")).toBeInTheDocument();\n    expect(screen.getByText(\"No preview available translation\")).toBeInTheDocument();\n    expect(screen.getByText(\"Published\")).toBeInTheDocument();\n  });\n\n  it(\"navigates to builder when clicking new template action or row\", () => {\n    setupMockOperations({\n      filteredTemplates: [\n        {\n          ...baseTemplate,\n          channels: {\n            email: { subject: \"Preview subject\" },\n          },\n        },\n      ],\n    });\n\n    renderTemplates();\n\n    fireEvent.click(screen.getByRole(\"button\", { name: \"New Template\" }));\n    expect(mockNavigate).toHaveBeenCalledWith(\"/template-builder\");\n\n    fireEvent.click(screen.getByTestId(\"template-row-template-1\"));\n    expect(mockNavigate).toHaveBeenCalledWith(\"/template-builder?id=template-1\");\n  });\n\n  it(\"shows empty state with create action when there are no templates and no search\", () => {\n    setupMockOperations({\n      filteredTemplates: [],\n      templates: [],\n      searchTerm: \"\",\n    });\n\n    renderTemplates();\n\n    expect(screen.getByText(\"No templates created yet\")).toBeInTheDocument();\n    expect(screen.getByText(\"Create your first email template to get started with automated communications.\")).toBeInTheDocument();\n    expect(screen.getByRole(\"button\", { name: \"Create Your First Template\" })).toBeInTheDocument();\n  });\n\n  it(\"shows search empty state when a search term yields no results\", () => {\n    const setSearchTerm = jest.fn<void, [string]>();\n    setupMockOperations({\n      filteredTemplates: [],\n      templates: [],\n      searchTerm: \"welcome\",\n      setSearchTerm,\n    });\n\n    renderTemplates();\n\n    expect(screen.getByText(\"No templates found\")).toBeInTheDocument();\n    expect(\n      screen.getByText(\"Try adjusting your search terms to find what you're looking for.\")\n    ).toBeInTheDocument();\n    expect(screen.queryByRole(\"button\", { name: \"Create Your First Template\" })).not.toBeInTheDocument();\n\n    fireEvent.change(screen.getByTestId(\"table-search\"), { target: { value: \"follow up\" } });\n    expect(setSearchTerm).toHaveBeenCalledWith(\"follow up\");\n  });\n\n  it(\"duplicates and deletes templates via row actions\", async () => {\n    const deleteTemplate = jest.fn<Promise<boolean>, [string]>().mockResolvedValue(true);\n    const duplicateTemplate = jest.fn<Promise<boolean>, [Template]>().mockResolvedValue(true);\n    setupMockOperations({ deleteTemplate, duplicateTemplate });\n\n    renderTemplates();\n\n    fireEvent.click(screen.getByTitle(\"Duplicate template\"));\n    expect(duplicateTemplate).toHaveBeenCalledWith(expect.objectContaining({ id: \"template-1\" }));\n\n    fireEvent.click(screen.getByTitle(\"Delete template\"));\n    expect(screen.getByTestId(\"delete-template-dialog\")).toBeInTheDocument();\n\n    fireEvent.click(screen.getByText(\"confirm delete\"));\n\n    await waitFor(() => {\n      expect(deleteTemplate).toHaveBeenCalledWith(\"template-1\");\n    });\n\n    await waitFor(() => {\n      expect(screen.queryByTestId(\"delete-template-dialog\")).not.toBeInTheDocument();\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/UpcomingSessions.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/__tests__/Workflows.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/admin/Localization.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'i18n.language'. Either exclude it or remove the dependency array.","line":43,"column":5,"nodeType":"ArrayExpression","endLine":43,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [t]","fix":{"range":[1955,1973],"text":"[t]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":48,"column":6,"nodeType":"ArrayExpression","endLine":48,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadData]","fix":{"range":[2021,2023],"text":"[loadData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef, useMemo } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { toast } from \"@/hooks/use-toast\";\nimport { Language } from \"@/i18n/types\";\nimport { useTranslationFiles } from \"@/hooks/useTranslationFiles\";\nimport { Globe, FileText, Upload, Download, Edit, Info, FileDown, Package } from \"lucide-react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useCommonTranslation } from \"@/hooks/useTypedTranslation\";\nimport { SegmentedControl } from \"@/components/ui/segmented-control\";\n\ntype SegmentValue = \"json-manager\" | \"languages\";\n\nexport default function AdminLocalization() {\n  const [languages, setLanguages] = useState<Language[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [activeSegment, setActiveSegment] = useState<SegmentValue>(\"json-manager\");\n\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const {\n    downloadLanguageFile,\n    downloadLanguagePack,\n    downloadAllTranslations,\n    uploadTranslationFile,\n    getAvailableLanguages,\n    getNamespacesForLanguage,\n    getTranslationStats,\n    isProcessing,\n  } = useTranslationFiles();\n  const { t: tCommon } = useCommonTranslation();\n  const { t, i18n } = useTranslation(\"pages\");\n  const workflowSteps = useMemo(\n    () =>\n      t(\"admin.localization.cards.workflow.steps\", {\n        returnObjects: true,\n      }) as Array<{ title: string; description: string }>,\n    [t, i18n.language]\n  );\n\n  useEffect(() => {\n    loadData();\n  }, []);\n\n  const loadData = async () => {\n    try {\n      setIsLoading(true);\n      \n      // Load languages\n      const { data: languagesData } = await supabase\n        .from('languages')\n        .select('*')\n        .order('sort_order');\n      setLanguages(languagesData || []);\n    } catch (error) {\n      console.error('Error loading data:', error);\n      toast({\n        title: tCommon(\"toast.error\"),\n        description: t(\"admin.localization.toast.loadError\"),\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const toggleLanguage = async (languageId: string, isActive: boolean) => {\n    try {\n      const { error } = await supabase\n        .from('languages')\n        .update({ is_active: isActive })\n        .eq('id', languageId);\n\n      if (error) throw error;\n\n      setLanguages(prev => prev.map(lang => \n        lang.id === languageId ? { ...lang, is_active: isActive } : lang\n      ));\n\n      toast({\n        title: tCommon(\"toast.success\"),\n        description: isActive\n          ? t(\"admin.localization.toast.languageActivated\")\n          : t(\"admin.localization.toast.languageDeactivated\"),\n      });\n    } catch (error) {\n      console.error('Error updating language:', error);\n      toast({\n        title: tCommon(\"toast.error\"),\n        description: t(\"admin.localization.toast.languageUpdateError\"),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = event.target.files;\n    if (!files || files.length === 0) return;\n\n    // Process files with file writing capability\n    const results = await Promise.all(\n      Array.from(files).map(async (file) => {\n        // Create a file writer function that will write files immediately\n        const fileWriter = async (filePath: string, content: string) => {\n          // Create a promise that will be resolved when the file is written\n          await writeTranslationFile(filePath, content);\n        };\n        \n        return uploadTranslationFile(file, fileWriter);\n      })\n    );\n\n    const successCount = results.filter(Boolean).length;\n    const totalCount = results.length;\n\n    if (successCount === totalCount) {\n      toast({\n        title: tCommon(\"toast.success\"),\n        description: t(\"admin.localization.toast.uploadSuccess\", { count: successCount }),\n      });\n    } else {\n      toast({\n        title: tCommon(\"toast.warning\"),\n        description: t(\"admin.localization.toast.uploadPartial\", { success: successCount, total: totalCount }),\n        variant: \"destructive\",\n      });\n    }\n\n    // Reset the input and reload data\n    event.target.value = '';\n    await loadData();\n  };\n\n  // Function to handle actual file writing\n  const writeTranslationFile = async (filePath: string, content: string) => {\n    // Store the file write request for batch processing\n    const pendingWrites = JSON.parse(localStorage.getItem('pendingTranslationWrites') || '[]');\n    pendingWrites.push({ filePath, content, timestamp: Date.now() });\n    localStorage.setItem('pendingTranslationWrites', JSON.stringify(pendingWrites));\n    \n    // Trigger immediate processing\n    processPendingWrites();\n  };\n\n  // Process pending file writes\n  const processPendingWrites = () => {\n    const pendingWrites = JSON.parse(localStorage.getItem('pendingTranslationWrites') || '[]');\n    if (pendingWrites.length > 0) {\n      // Emit custom event that parent component can listen to\n      window.dispatchEvent(new CustomEvent('processPendingTranslationWrites', {\n        detail: { writes: pendingWrites }\n      }));\n      // Clear pending writes\n      localStorage.removeItem('pendingTranslationWrites');\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto py-6 space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold tracking-tight\">{t(\"admin.localization.title\")}</h1>\n            <p className=\"text-muted-foreground\">{t(\"admin.localization.loading\")}</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto py-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold tracking-tight\">{t(\"admin.localization.title\")}</h1>\n          <p className=\"text-muted-foreground\">\n            {t(\"admin.localization.subtitle\")}\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept=\".json\"\n            multiple\n            onChange={handleFileUpload}\n            className=\"hidden\"\n          />\n          <Button \n            variant=\"outline\" \n            size=\"sm\"\n            onClick={() => fileInputRef.current?.click()}\n            disabled={isProcessing}\n          >\n            <Upload className=\"w-4 h-4 mr-2\" />\n            {isProcessing ? t(\"admin.localization.buttons.processing\") : t(\"admin.localization.buttons.upload\")}\n          </Button>\n          <Dialog>\n            <DialogTrigger asChild>\n              <Button variant=\"outline\" size=\"sm\">\n                <Download className=\"w-4 h-4 mr-2\" />\n                {t(\"admin.localization.buttons.download\")}\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-md\">\n              <DialogHeader>\n                <DialogTitle>{t(\"admin.localization.dialog.title\")}</DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <h4 className=\"font-medium\">{t(\"admin.localization.dialog.individual\")}</h4>\n                  <div className=\"grid grid-cols-2 gap-2\">\n                    {getAvailableLanguages().flatMap(lang =>\n                      getNamespacesForLanguage(lang).map(ns => (\n                        <Button\n                          key={`${lang}-${ns}`}\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => downloadLanguageFile(lang, ns)}\n                          className=\"text-xs\"\n                        >\n                          <FileDown className=\"w-3 h-3 mr-1\" />\n                          {lang}/{ns}\n                        </Button>\n                      ))\n                    )}\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <h4 className=\"font-medium\">{t(\"admin.localization.dialog.packs\")}</h4>\n                  <div className=\"space-y-1\">\n                    {getAvailableLanguages().map(lang => (\n                      <Button\n                        key={lang}\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => downloadLanguagePack(lang)}\n                        className=\"w-full justify-start\"\n                      >\n                        <Package className=\"w-4 h-4 mr-2\" />\n                        {t(\"admin.localization.dialog.completePack\", { code: lang.toUpperCase() })}\n                      </Button>\n                    ))}\n                  </div>\n                </div>\n                <Button\n                  variant=\"default\"\n                  onClick={downloadAllTranslations}\n                  className=\"w-full\"\n                >\n                  <Download className=\"w-4 h-4 mr-2\" />\n                  {t(\"admin.localization.buttons.downloadAll\")}\n                </Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      <Alert className=\"mb-6\">\n        <Info className=\"h-4 w-4\" />\n        <AlertDescription>\n          <strong>{t(\"admin.localization.alert.title\")}</strong>{\" \"}\n          {t(\"admin.localization.alert.description\")}\n          <div className=\"mt-2\">\n            <span>{t(\"admin.localization.alert.formatLabel\")} </span>\n            <code className=\"bg-muted px-1 rounded\">\n              {t(\"admin.localization.alert.formatCode\")}\n            </code>\n          </div>\n        </AlertDescription>\n      </Alert>\n\n      <div className=\"space-y-4\">\n        <SegmentedControl\n          value={activeSegment}\n          onValueChange={(value) => setActiveSegment(value as SegmentValue)}\n          options={[\n            {\n              value: \"json-manager\",\n              label: (\n                <span className=\"flex items-center gap-2\">\n                  <FileText className=\"h-3.5 w-3.5\" />\n                  {t(\"admin.localization.tabs.jsonManager\")}\n                </span>\n              ),\n            },\n            {\n              value: \"languages\",\n              label: (\n                <span className=\"flex items-center gap-2\">\n                  <Globe className=\"h-3.5 w-3.5\" />\n                  {t(\"admin.localization.tabs.languages\")}\n                </span>\n              ),\n            },\n          ]}\n        />\n\n        {activeSegment === \"json-manager\" && (\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>{t(\"admin.localization.cards.status.title\")}</CardTitle>\n                  <CardDescription>{t(\"admin.localization.cards.status.description\")}</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    {Object.entries(getTranslationStats()).map(([lang, namespaces]) => (\n                      <div key={lang} className=\"border rounded-lg p-3\">\n                        <div className=\"flex items-center justify-between mb-2\">\n                          <h4 className=\"font-medium\">{lang.toUpperCase()}</h4>\n                          <Badge variant=\"outline\">\n                            {t(\"admin.localization.cards.status.keysBadge\", {\n                              count: Object.values(namespaces).reduce((a, b) => a + b, 0),\n                            })}\n                          </Badge>\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-2 text-sm\">\n                          {Object.entries(namespaces).map(([ns, count]) => (\n                            <div key={ns} className=\"flex justify-between\">\n                              <span className=\"text-muted-foreground\">{ns}:</span>\n                              <span>{count}</span>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle>{t(\"admin.localization.cards.quickActions.title\")}</CardTitle>\n                  <CardDescription>{t(\"admin.localization.cards.quickActions.description\")}</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  <div className=\"space-y-4\">\n                    <h4 className=\"font-medium text-sm\">{t(\"admin.localization.cards.quickActions.downloadIndividual\")}</h4>\n                    <div className=\"space-y-3\">\n                      {getAvailableLanguages().map(lang => (\n                        <div key={lang} className=\"space-y-2\">\n                          <div className=\"text-xs font-medium text-muted-foreground\">\n                            {lang.toUpperCase()}\n                          </div>\n                          <div className=\"grid grid-cols-2 gap-2\">\n                            {getNamespacesForLanguage(lang).map(ns => (\n                              <Button\n                                key={`${lang}-${ns}`}\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => downloadLanguageFile(lang, ns)}\n                                className=\"text-xs justify-start\"\n                              >\n                                <FileDown className=\"w-3 h-3 mr-1\" />\n                                {lang}/{ns}\n                              </Button>\n                            ))}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <h4 className=\"font-medium text-sm\">{t(\"admin.localization.cards.quickActions.downloadPacks\")}</h4>\n                    {getAvailableLanguages().map(lang => (\n                      <Button\n                        key={lang}\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => downloadLanguagePack(lang)}\n                        className=\"w-full justify-start\"\n                      >\n                        <Package className=\"w-4 h-4 mr-2\" />\n                        {t(\"admin.localization.dialog.completePack\", { code: lang.toUpperCase() })}\n                      </Button>\n                    ))}\n                  </div>\n\n                  <Button\n                    onClick={downloadAllTranslations}\n                    className=\"w-full\"\n                  >\n                    <Download className=\"w-4 h-4 mr-2\" />\n                    {t(\"admin.localization.buttons.downloadAll\")}\n                  </Button>\n                </CardContent>\n              </Card>\n            </div>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>{t(\"admin.localization.cards.workflow.title\")}</CardTitle>\n                <CardDescription>{t(\"admin.localization.cards.workflow.description\")}</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                    {workflowSteps.map((step, index) => (\n                      <div key={step.title} className=\"border rounded-lg p-4\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                          <div className=\"w-6 h-6 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-sm font-bold\">\n                            {index + 1}\n                          </div>\n                          <h4 className=\"font-medium\">{step.title}</h4>\n                        </div>\n                        <p className=\"text-sm text-muted-foreground\">{step.description}</p>\n                      </div>\n                    ))}\n                  </div>\n\n                  <div className=\"border-l-4 border-primary pl-4\">\n                    <h4 className=\"font-medium mb-2\">{t(\"admin.localization.cards.workflow.exampleTitle\")}</h4>\n                    <pre className=\"bg-muted p-3 rounded text-sm overflow-x-auto\">\n{t(\"admin.localization.cards.workflow.exampleCode\")}\n                    </pre>\n                  </div>\n\n                  <Alert>\n                    <Info className=\"h-4 w-4\" />\n                    <AlertDescription>\n                      <strong>{t(\"admin.localization.cards.workflow.alertTitle\")}</strong> {t(\"admin.localization.alert.proTipsDescription\")}\n                    </AlertDescription>\n                  </Alert>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        {activeSegment === \"languages\" && (\n          <div className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <CardTitle>{t(\"admin.localization.languagesTable.title\")}</CardTitle>\n                <CardDescription>\n                  {t(\"admin.localization.languagesTable.description\")}\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>{t(\"admin.localization.languagesTable.headers.language\")}</TableHead>\n                      <TableHead>{t(\"admin.localization.languagesTable.headers.code\")}</TableHead>\n                      <TableHead>{t(\"admin.localization.languagesTable.headers.nativeName\")}</TableHead>\n                      <TableHead>{t(\"admin.localization.languagesTable.headers.default\")}</TableHead>\n                      <TableHead>{t(\"admin.localization.languagesTable.headers.status\")}</TableHead>\n                      <TableHead>{t(\"admin.localization.languagesTable.headers.actions\")}</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {languages.map((language) => (\n                      <TableRow key={language.id}>\n                        <TableCell className=\"font-medium\">{language.name}</TableCell>\n                        <TableCell>\n                          <Badge variant=\"outline\">{language.code.toUpperCase()}</Badge>\n                        </TableCell>\n                        <TableCell>{language.native_name}</TableCell>\n                        <TableCell>\n                          {language.is_default && (\n                            <Badge variant=\"secondary\">{t(\"admin.localization.languagesTable.badges.default\")}</Badge>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          <Switch\n                            checked={language.is_active}\n                            onCheckedChange={(checked) => toggleLanguage(language.id, checked)}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Button variant=\"ghost\" size=\"sm\">\n                            <Edit className=\"w-4 h-4\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/admin/System.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/admin/Users.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/admin/__tests__/Localization.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":46,"column":17,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":46,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2754,2757],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2754,2757],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2802,2805],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2802,2805],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":143,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4949,4952],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4949,4952],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":219,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7620,7623],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7620,7623],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { fireEvent, render, screen, waitFor } from \"@/utils/testUtils\";\nimport AdminLocalization from \"../Localization\";\nimport { useTranslationFiles } from \"@/hooks/useTranslationFiles\";\nimport { mockSupabaseClient } from \"@/utils/testUtils\";\n\njest.mock(\"@/integrations/supabase/client\", () => ({\n  supabase: mockSupabaseClient,\n}));\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string, options?: { returnObjects?: boolean }) =>\n      options?.returnObjects ? [] : key,\n    i18n: { language: \"en\" },\n  }),\n}));\n\njest.mock(\"@/hooks/useTypedTranslation\", () => ({\n  useCommonTranslation: () => ({\n    t: (key: string) => key,\n  }),\n}));\n\njest.mock(\"@/hooks/use-toast\", () => ({\n  toast: jest.fn(),\n}));\n\njest.mock(\"@/hooks/useTranslationFiles\", () => ({\n  useTranslationFiles: jest.fn(),\n}));\n\njest.mock(\"@/components/ui/card\", () => ({\n  Card: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n  CardHeader: ({ children }: { children: React.ReactNode }) => <header>{children}</header>,\n  CardTitle: ({ children }: { children: React.ReactNode }) => <h2>{children}</h2>,\n  CardDescription: ({ children }: { children: React.ReactNode }) => <p>{children}</p>,\n  CardContent: ({ children }: { children: React.ReactNode }) => <section>{children}</section>,\n}));\n\njest.mock(\"@/components/ui/badge\", () => ({\n  Badge: ({ children }: { children: React.ReactNode }) => <span>{children}</span>,\n}));\n\njest.mock(\"@/components/ui/button\", () => {\n  const React = require(\"react\");\n  const Button = React.forwardRef<HTMLButtonElement, React.ButtonHTMLAttributes<HTMLButtonElement>>(\n    ({ children, ...props }, ref) => (\n      <button ref={ref} {...props}>\n        {children}\n      </button>\n    )\n  );\n  Button.displayName = \"Button\";\n  return {\n    __esModule: true,\n    Button,\n  };\n});\n\njest.mock(\"@/components/ui/dialog\", () => ({\n  Dialog: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n  DialogTrigger: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n  DialogContent: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n  DialogHeader: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n  DialogTitle: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,\n}));\n\njest.mock(\"@/components/ui/switch\", () => ({\n  Switch: ({ checked, onCheckedChange }: { checked: boolean; onCheckedChange: (value: boolean) => void }) => (\n    <button onClick={() => onCheckedChange(!checked)} data-testid=\"language-toggle\">\n      {checked ? \"on\" : \"off\"}\n    </button>\n  ),\n}));\n\njest.mock(\"@/components/ui/segmented-control\", () => ({\n  SegmentedControl: ({ value, onValueChange, options }: any) => (\n    <div>\n      {options.map((option: any) => (\n        <button\n          key={option.value}\n          data-testid={`segment-${option.value}`}\n          aria-pressed={option.value === value}\n          onClick={() => onValueChange(option.value)}\n        >\n          {option.label}\n        </button>\n      ))}\n    </div>\n  ),\n}));\n\njest.mock(\"@/components/ui/table\", () => ({\n  Table: ({ children }: { children: React.ReactNode }) => <table>{children}</table>,\n  TableHeader: ({ children }: { children: React.ReactNode }) => <thead>{children}</thead>,\n  TableHead: ({ children }: { children: React.ReactNode }) => <th>{children}</th>,\n  TableBody: ({ children }: { children: React.ReactNode }) => <tbody>{children}</tbody>,\n  TableRow: ({ children }: { children: React.ReactNode }) => <tr>{children}</tr>,\n  TableCell: ({ children }: { children: React.ReactNode }) => <td>{children}</td>,\n}));\n\njest.mock(\"lucide-react\", () => ({\n  Globe: () => <span>globe</span>,\n  Languages: () => <span>languages</span>,\n  FileText: () => <span>filetext</span>,\n  Upload: () => <span>upload</span>,\n  Download: () => <span>download</span>,\n  Plus: () => <span>plus</span>,\n  Edit: () => <span>edit</span>,\n  Trash: () => <span>trash</span>,\n  Info: () => <span>info</span>,\n  FileDown: () => <span>filedown</span>,\n  Package: () => <span>package</span>,\n}));\n\nconst supabaseMock = mockSupabaseClient as unknown as {\n  from: jest.Mock;\n};\n\nconst mockUseTranslationFiles = useTranslationFiles as jest.MockedFunction<typeof useTranslationFiles>;\n\nconst languagesData = [\n  { id: \"en\", name: \"English\", code: \"en\", native_name: \"English\", is_active: true, is_default: true },\n  { id: \"tr\", name: \"Turkish\", code: \"tr\", native_name: \"TÃ¼rkÃ§e\", is_active: false, is_default: false },\n];\n\nconst namespacesData = [\n  { id: \"pages\", name: \"pages\" },\n  { id: \"common\", name: \"common\" },\n];\n\nconst translationKeysData = [\n  { id: \"key1\", namespace_id: \"pages\", key_name: \"welcome\" },\n  { id: \"key2\", namespace_id: \"common\", key_name: \"hello\" },\n];\n\nconst translationsData = [\n  { id: \"t1\", key_id: \"key1\", language_code: \"en\", value: \"Welcome\" },\n];\n\nconst createQueryChain = (table: string) => {\n  const chain: any = {\n    select: jest.fn().mockReturnThis(),\n    order: jest.fn(),\n    eq: jest.fn().mockReturnThis(),\n    update: jest.fn(),\n    maybeSingle: jest.fn(),\n    insert: jest.fn(),\n  };\n\n  if (table === \"languages\") {\n    chain.order.mockResolvedValue({ data: languagesData });\n    chain.update.mockImplementation(() => ({\n      eq: jest.fn().mockResolvedValue({ error: null }),\n    }));\n  } else if (table === \"translation_namespaces\") {\n    chain.order.mockResolvedValue({ data: namespacesData });\n  } else if (table === \"translation_keys\") {\n    chain.order.mockResolvedValue({ data: translationKeysData });\n  } else if (table === \"translations\") {\n    chain.select.mockResolvedValue({ data: translationsData });\n  }\n\n  return chain;\n};\n\ndescribe(\"Admin Localization page\", () => {\n  beforeEach(() => {\n    mockUseTranslationFiles.mockReturnValue({\n      downloadLanguageFile: jest.fn(),\n      downloadLanguagePack: jest.fn(),\n      downloadAllTranslations: jest.fn(),\n      uploadTranslationFile: jest.fn(),\n      getAvailableLanguages: jest.fn(() => languagesData.map((language) => language.code)),\n      getAvailableNamespaces: jest.fn(() => namespacesData.map((namespace) => namespace.name)),\n      getNamespacesForLanguage: jest.fn(() => namespacesData.map((namespace) => namespace.name)),\n      getTranslationStats: jest.fn(() => ({\n        en: Object.fromEntries(namespacesData.map((namespace) => [namespace.name, 1])),\n        tr: Object.fromEntries(namespacesData.map((namespace) => [namespace.name, 0])),\n      })),\n      isProcessing: false,\n    });\n\n    supabaseMock.from = jest.fn((table: string) => createQueryChain(table));\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it(\"loads languages when the languages segment is selected\", async () => {\n    render(<AdminLocalization />);\n\n    const languagesSegment = await screen.findByTestId(\"segment-languages\");\n    fireEvent.click(languagesSegment);\n\n    await waitFor(() => {\n      expect(supabaseMock.from).toHaveBeenCalledWith(\"languages\");\n    });\n\n    expect(await screen.findAllByText(\"English\")).not.toHaveLength(0);\n    expect(await screen.findAllByText(\"Turkish\")).not.toHaveLength(0);\n  });\n\n  it(\"updates a language when toggled\", async () => {\n    render(<AdminLocalization />);\n\n    const languagesSegment = await screen.findByTestId(\"segment-languages\");\n    fireEvent.click(languagesSegment);\n\n    await screen.findAllByText(\"English\");\n\n    const toggleButtons = screen.getAllByTestId(\"language-toggle\");\n    fireEvent.click(toggleButtons[1]);\n\n    const languagesQuery = (supabaseMock.from as jest.Mock).mock.results\n      .map((result) => result.value)\n      .find((value: any) => value?.update?.mock?.calls?.length);\n\n    await waitFor(() => {\n      expect(languagesQuery?.update).toHaveBeenCalledWith({ is_active: true });\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/admin/__tests__/System.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/admin/__tests__/Users.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/leads/hooks/__tests__/useLeadsFilters.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/leads/hooks/useLeadsData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/leads/hooks/useLeadsFilters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/payments/components/PaymentsDateControls.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/payments/components/PaymentsMetricsSummary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/payments/components/PaymentsTableSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/payments/components/PaymentsTrendChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/payments/components/__tests__/PaymentsDateControls.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/payments/components/__tests__/PaymentsMetricsSummary.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/payments/components/__tests__/PaymentsTableSection.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[792,795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[792,795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[853,856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[853,856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render } from \"@/utils/testUtils\";\nimport { PaymentsTableSection } from \"../PaymentsTableSection\";\nimport type { AdvancedDataTableSortState } from \"@/components/data-table\";\n\njest.mock(\"@/components/data-table\", () => {\n  const AdvancedDataTable = jest.fn(() => <div data-testid=\"advanced-data-table\" />);\n  return { AdvancedDataTable };\n});\n\ndescribe(\"PaymentsTableSection\", () => {\n  const tableModule = jest.requireMock(\"@/components/data-table\") as {\n    AdvancedDataTable: jest.Mock;\n  };\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it(\"forwards props to AdvancedDataTable\", () => {\n    const handleSortChange = jest.fn();\n    const handleRowClick = jest.fn();\n\n    render(\n      <PaymentsTableSection\n        title=\"Payments\"\n        data={[{ id: \"payment-1\" } as any]}\n        columns={[{ id: \"amount\", label: \"Amount\" } as any]}\n        filters={{ groups: [] }}\n        toolbar={<div>Toolbar</div>}\n        actions={<button type=\"button\">Export</button>}\n        summary={{ text: \"Summary\", chips: [{ id: \"status\", label: \"Paid\" }] }}\n        sortState={{ columnId: \"date_paid\", direction: \"desc\" }}\n        onSortChange={handleSortChange}\n        emptyState={<div>No data</div>}\n        onRowClick={handleRowClick}\n        isLoading\n        searchValue=\"query\"\n        onSearchChange={jest.fn()}\n        searchPlaceholder=\"Search\"\n        searchLoading={false}\n        searchMinChars={2}\n        onLoadMore={jest.fn()}\n        hasMore\n        isLoadingMore\n      />\n    );\n\n    expect(tableModule.AdvancedDataTable).toHaveBeenCalledTimes(1);\n    const tableProps = tableModule.AdvancedDataTable.mock.calls[0][0];\n    expect(tableProps.title).toBe(\"Payments\");\n    expect(tableProps.data).toHaveLength(1);\n    expect(tableProps.columns[0].id).toBe(\"amount\");\n    expect(tableProps.summary.chips).toHaveLength(1);\n    expect(tableProps.isLoading).toBe(true);\n\n    const sortState: AdvancedDataTableSortState = { columnId: \"amount\", direction: \"asc\" };\n    tableProps.onSortChange(sortState);\n    expect(handleSortChange).toHaveBeenCalledWith(sortState);\n\n    tableProps.onRowClick?.({ id: \"payment-1\" });\n    expect(handleRowClick).toHaveBeenCalledWith({ id: \"payment-1\" });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/payments/components/__tests__/PaymentsTrendChart.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/payments/constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/payments/hooks/__tests__/usePaymentsData.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[845,848],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[845,848],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { act, renderHook, waitFor } from \"@testing-library/react\";\n\njest.mock(\"@/integrations/supabase/client\", () => {\n  const from = jest.fn();\n  return {\n    supabase: {\n      from,\n      rpc: jest.fn(),\n      auth: {\n        getUser: jest.fn(),\n        signIn: jest.fn(),\n        signOut: jest.fn(),\n      },\n    },\n  };\n});\n\nimport { supabase } from \"@/integrations/supabase/client\";\nimport type {\n  Payment,\n  PaymentStatusFilter,\n  PaymentTypeFilter,\n  SortDirection,\n  SortField,\n} from \"../../types\";\nimport { PROJECT_SELECT_FIELDS } from \"../../constants\";\nimport { usePaymentsData } from \"../usePaymentsData\";\n\nconst supabaseFromMock = supabase.from as jest.Mock;\n\ntype QueryResult = {\n  data: unknown;\n  error: unknown;\n  count?: number | null;\n};\n\nconst createQueryBuilder = <T extends QueryResult>(result: T) => {\n  const builder: any = {\n    select: jest.fn(() => builder),\n    ilike: jest.fn(() => builder),\n    in: jest.fn(() => builder),\n    or: jest.fn(() => builder),\n    gte: jest.fn(() => builder),\n    lte: jest.fn(() => builder),\n    order: jest.fn(() => builder),\n    range: jest.fn(() => builder),\n    eq: jest.fn(() => builder),\n  };\n\n  builder.then = (onFulfilled?: (value: T) => unknown, onRejected?: (reason: unknown) => unknown) =>\n    Promise.resolve(result).then(onFulfilled, onRejected);\n  builder.catch = (onRejected?: (reason: unknown) => unknown) =>\n    Promise.resolve(result).catch(onRejected);\n  builder[Symbol.toStringTag] = \"Promise\";\n  return builder;\n};\n\ntype QueryBuilder = ReturnType<typeof createQueryBuilder>;\n\ntype QueueMap = Record<\"payments\" | \"projects\" | \"leads\", QueryBuilder[]>;\n\ndescribe(\"usePaymentsData\", () => {\n  const baseProps = {\n    page: 1,\n    pageSize: 2,\n    sortField: \"project_name\" as SortField,\n    sortDirection: \"asc\" as SortDirection,\n    statusFilters: [] as PaymentStatusFilter[],\n    typeFilters: [] as PaymentTypeFilter[],\n    amountMinFilter: null,\n    amountMaxFilter: null,\n    searchTerm: \"\",\n    activeDateRange: null,\n  };\n\n  let queues: QueueMap;\n  let onError: jest.Mock;\n\n  const enqueue = (table: keyof QueueMap, builder: QueryBuilder) => {\n    queues[table].push(builder);\n    return builder;\n  };\n\n  beforeEach(() => {\n    queues = {\n      payments: [],\n      projects: [],\n      leads: [],\n    };\n    onError = jest.fn();\n    supabaseFromMock.mockReset();\n    supabaseFromMock.mockImplementation((table: string) => {\n      const key = table as keyof QueueMap;\n      const queue = queues[key];\n      if (!queue?.length) {\n        throw new Error(`No mock registered for table ${table}`);\n      }\n      return queue.shift()!;\n    });\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it(\"fetches payments, hydrates related entities, and appends subsequent pages\", async () => {\n    const tablePayments: Payment[] = [\n      {\n        id: \"payment-b\",\n        amount: 220,\n        date_paid: \"2024-04-10T00:00:00Z\",\n        status: \"paid\",\n        description: \"Second\",\n        type: \"extra\",\n        project_id: \"project-b\",\n        created_at: \"2024-04-01T00:00:00Z\",\n        projects: null,\n      },\n      {\n        id: \"payment-a\",\n        amount: 120,\n        date_paid: \"2024-04-08T00:00:00Z\",\n        status: \"due\",\n        description: \"First\",\n        type: \"base_price\",\n        project_id: \"project-a\",\n        created_at: \"2024-03-01T00:00:00Z\",\n        projects: null,\n      },\n    ];\n\n    const metricsPayments: Payment[] = [\n      {\n        id: \"metric-1\",\n        amount: 220,\n        date_paid: \"2024-04-10T00:00:00Z\",\n        status: \"paid\",\n        description: null,\n        type: \"extra\",\n        project_id: \"project-b\",\n        created_at: \"2024-04-01T00:00:00Z\",\n        projects: null,\n      },\n    ];\n\n    const projectsResult = [\n      {\n        id: \"project-a\",\n        name: \"Alpha Project\",\n        base_price: 100,\n        lead_id: \"lead-a\",\n        status_id: null,\n        previous_status_id: null,\n        project_type_id: null,\n        description: null,\n        updated_at: \"2024-03-05T00:00:00Z\",\n        created_at: \"2024-02-01T00:00:00Z\",\n        user_id: \"user-a\",\n      },\n      {\n        id: \"project-b\",\n        name: \"Beta Project\",\n        base_price: 200,\n        lead_id: \"lead-b\",\n        status_id: null,\n        previous_status_id: null,\n        project_type_id: null,\n        description: null,\n        updated_at: \"2024-04-09T00:00:00Z\",\n        created_at: \"2024-02-15T00:00:00Z\",\n        user_id: \"user-b\",\n      },\n    ];\n\n    const leadsResult = [\n      { id: \"lead-a\", name: \"Alice\" },\n      { id: \"lead-b\", name: \"Bob\" },\n    ];\n\n    const tableBuilder = enqueue(\n      \"payments\",\n      createQueryBuilder({ data: tablePayments, error: null, count: 2 })\n    );\n    const metricsBuilder = enqueue(\n      \"payments\",\n      createQueryBuilder({ data: metricsPayments, error: null })\n    );\n    const hydrationProjectsBuilder = enqueue(\n      \"projects\",\n      createQueryBuilder({ data: projectsResult, error: null })\n    );\n    const hydrationLeadsBuilder = enqueue(\n      \"leads\",\n      createQueryBuilder({ data: leadsResult, error: null })\n    );\n\n    const { result, rerender } = renderHook(\n      (props: typeof baseProps & { onError: (error: Error) => void }) =>\n        usePaymentsData(props),\n      {\n        initialProps: { ...baseProps, onError },\n      }\n    );\n\n    await waitFor(() => expect(result.current.initialLoading).toBe(false));\n    await waitFor(() => expect(result.current.tableLoading).toBe(false));\n\n    expect(result.current.totalCount).toBe(2);\n    expect(result.current.metricsPayments).toEqual(metricsPayments);\n    expect(result.current.paginatedPayments.map((payment) => payment.projects?.name)).toEqual([\n      \"Alpha Project\",\n      \"Beta Project\",\n    ]);\n    expect(result.current.paginatedPayments[0]?.projects?.leads?.name).toBe(\"Alice\");\n    expect(result.current.paginatedPayments[1]?.projects?.leads?.name).toBe(\"Bob\");\n\n    expect(tableBuilder.select).toHaveBeenCalledWith(\"*\", { count: \"exact\" });\n    expect(tableBuilder.range).toHaveBeenCalledWith(0, 1);\n    expect(tableBuilder.order).toHaveBeenCalledWith(\"created_at\", { ascending: false });\n    expect(metricsBuilder.select).toHaveBeenCalledWith(\n      \"id, amount, status, type, date_paid, created_at, project_id\"\n    );\n    expect(hydrationProjectsBuilder.select).toHaveBeenCalledWith(PROJECT_SELECT_FIELDS);\n    expect(hydrationProjectsBuilder.in).toHaveBeenCalledWith(\"id\", [\n      \"project-b\",\n      \"project-a\",\n    ]);\n    expect(hydrationLeadsBuilder.select).toHaveBeenCalledWith(\"id, name\");\n    expect(hydrationLeadsBuilder.in).toHaveBeenCalledWith(\"id\", [\"lead-a\", \"lead-b\"]);\n\n    const nextPayments: Payment[] = [\n      {\n        id: \"payment-c\",\n        amount: 320,\n        date_paid: \"2024-04-12T00:00:00Z\",\n        status: \"paid\",\n        description: \"Third\",\n        type: \"manual\",\n        project_id: \"project-c\",\n        created_at: \"2024-04-11T00:00:00Z\",\n        projects: null,\n      },\n    ];\n\n    const nextMetrics: Payment[] = [\n      {\n        id: \"metric-2\",\n        amount: 320,\n        date_paid: \"2024-04-12T00:00:00Z\",\n        status: \"paid\",\n        description: null,\n        type: \"manual\",\n        project_id: \"project-c\",\n        created_at: \"2024-04-11T00:00:00Z\",\n        projects: null,\n      },\n    ];\n\n    const nextTableBuilder = enqueue(\n      \"payments\",\n      createQueryBuilder({ data: nextPayments, error: null, count: 3 })\n    );\n    const nextMetricsBuilder = enqueue(\n      \"payments\",\n      createQueryBuilder({ data: nextMetrics, error: null })\n    );\n    enqueue(\n      \"projects\",\n      createQueryBuilder({\n        data: [\n          {\n            id: \"project-c\",\n            name: \"Delta Project\",\n            base_price: 300,\n            lead_id: \"lead-c\",\n            status_id: null,\n            previous_status_id: null,\n            project_type_id: null,\n            description: null,\n            updated_at: \"2024-04-12T00:00:00Z\",\n            created_at: \"2024-04-10T00:00:00Z\",\n            user_id: \"user-c\",\n          },\n        ],\n        error: null,\n      })\n    );\n    enqueue(\n      \"leads\",\n      createQueryBuilder({ data: [{ id: \"lead-c\", name: \"Charlie\" }], error: null })\n    );\n\n    rerender({ ...baseProps, page: 2, onError });\n\n    await waitFor(() => expect(result.current.tableLoading).toBe(false));\n    await waitFor(() => expect(result.current.paginatedPayments).toHaveLength(1));\n\n    expect(result.current.paginatedPayments[0]?.projects?.name).toBe(\"Delta Project\");\n    expect(result.current.paginatedPayments[0]?.projects?.leads?.name).toBe(\"Charlie\");\n    expect(result.current.totalCount).toBe(3);\n    expect(result.current.metricsPayments).toEqual(nextMetrics);\n    expect(nextMetricsBuilder.select).toHaveBeenCalledWith(\n      \"id, amount, status, type, date_paid, created_at, project_id\"\n    );\n    expect(nextTableBuilder.range).toHaveBeenCalledWith(2, 3);\n    expect(queues.payments).toHaveLength(0);\n  });\n\n  it(\"applies search, type, and amount filters when fetching data\", async () => {\n    const searchProjectsBuilder = enqueue(\n      \"projects\",\n      createQueryBuilder({\n        data: [\n          {\n            id: \"project-30\",\n            name: \"Omega\",\n            base_price: 100,\n            lead_id: \"lead-30\",\n            status_id: null,\n            previous_status_id: null,\n            project_type_id: null,\n            description: null,\n            updated_at: \"2024-03-01T00:00:00Z\",\n            created_at: \"2024-02-01T00:00:00Z\",\n            user_id: \"user-30\",\n          },\n          {\n            id: \"project-40\",\n            name: \"Sigma\",\n            base_price: 120,\n            lead_id: \"lead-40\",\n            status_id: null,\n            previous_status_id: null,\n            project_type_id: null,\n            description: null,\n            updated_at: \"2024-03-02T00:00:00Z\",\n            created_at: \"2024-02-02T00:00:00Z\",\n            user_id: \"user-40\",\n          },\n        ],\n        error: null,\n      })\n    );\n    const searchLeadsBuilder = enqueue(\n      \"leads\",\n      createQueryBuilder({\n        data: [\n          { id: \"lead-30\", name: \"Olive\" },\n          { id: \"lead-40\", name: \"Orion\" },\n        ],\n        error: null,\n      })\n    );\n    const projectsForLeadsBuilder = enqueue(\n      \"projects\",\n      createQueryBuilder({\n        data: [\n          {\n            id: \"project-50\",\n            name: \"Tau\",\n            base_price: 200,\n            lead_id: \"lead-50\",\n            status_id: null,\n            previous_status_id: null,\n            project_type_id: null,\n            description: null,\n            updated_at: \"2024-03-03T00:00:00Z\",\n            created_at: \"2024-02-03T00:00:00Z\",\n            user_id: \"user-50\",\n          },\n        ],\n        error: null,\n      })\n    );\n    const hydrationSearchLeadsBuilder = enqueue(\n      \"leads\",\n      createQueryBuilder({\n        data: [{ id: \"lead-50\", name: \"Tessa\" }],\n        error: null,\n      })\n    );\n\n    const tableBuilder = enqueue(\n      \"payments\",\n      createQueryBuilder({\n        data: [\n          {\n            id: \"payment-newer\",\n            amount: 400,\n            date_paid: \"2024-05-05T00:00:00Z\",\n            status: \"paid\",\n            description: \"Newest\",\n            type: \"extra\",\n            project_id: \"project-40\",\n            created_at: \"2024-05-01T00:00:00Z\",\n            projects: null,\n          },\n          {\n            id: \"payment-older\",\n            amount: 80,\n            date_paid: \"2024-04-01T00:00:00Z\",\n            status: \"paid\",\n            description: \"Older\",\n            type: \"extra\",\n            project_id: \"project-30\",\n            created_at: \"2024-03-01T00:00:00Z\",\n            projects: null,\n          },\n        ],\n        error: null,\n        count: 2,\n      })\n    );\n\n    const metricsBuilder = enqueue(\n      \"payments\",\n      createQueryBuilder({\n        data: [\n          {\n            id: \"payment-metric\",\n            amount: 400,\n            date_paid: \"2024-05-05T00:00:00Z\",\n            status: \"paid\",\n            description: null,\n            type: \"extra\",\n            project_id: \"project-40\",\n            created_at: \"2024-05-01T00:00:00Z\",\n            projects: null,\n          },\n        ],\n        error: null,\n      })\n    );\n\n    const { result } = renderHook(\n      (props: typeof baseProps & { onError: (error: Error) => void }) =>\n        usePaymentsData(props),\n      {\n        initialProps: {\n          ...baseProps,\n          pageSize: 25,\n          sortField: \"date_paid\",\n          sortDirection: \"desc\",\n          statusFilters: [\"paid\"],\n          typeFilters: [\"extra\"],\n          amountMinFilter: 50,\n          amountMaxFilter: 500,\n          searchTerm: 'Pro \"Alpha\"',\n          onError,\n        },\n      }\n    );\n\n    await waitFor(() => expect(result.current.initialLoading).toBe(false));\n    await waitFor(() => expect(result.current.tableLoading).toBe(false));\n\n    expect(searchProjectsBuilder.select).toHaveBeenCalledWith(PROJECT_SELECT_FIELDS);\n    expect(searchProjectsBuilder.ilike).toHaveBeenCalledWith(\"name\", \"%Pro \\\"Alpha\\\"%\");\n    expect(searchLeadsBuilder.select).toHaveBeenCalledWith(\"id, name\");\n    expect(searchLeadsBuilder.ilike).toHaveBeenCalledWith(\"name\", \"%Pro \\\"Alpha\\\"%\");\n    expect(projectsForLeadsBuilder.select).toHaveBeenCalledWith(PROJECT_SELECT_FIELDS);\n    expect(projectsForLeadsBuilder.in).toHaveBeenCalledWith(\"lead_id\", [\"lead-30\", \"lead-40\"]);\n    expect(hydrationSearchLeadsBuilder.select).toHaveBeenCalledWith(\"id, name\");\n    expect(hydrationSearchLeadsBuilder.in).toHaveBeenCalledWith(\"id\", [\"lead-50\"]);\n\n    expect(tableBuilder.select).toHaveBeenCalledWith(\"*\", { count: \"exact\" });\n    expect(tableBuilder.ilike).toHaveBeenCalledWith(\"status\", \"paid\");\n    expect(tableBuilder.in).toHaveBeenCalledWith(\"type\", [\"extra\"]);\n    expect(tableBuilder.gte).toHaveBeenCalledWith(\"amount\", 50);\n    expect(tableBuilder.lte).toHaveBeenCalledWith(\"amount\", 500);\n    expect(tableBuilder.or).toHaveBeenCalledWith(\n      expect.stringContaining(\"project_id.in.(project-30,project-40,project-50)\")\n    );\n    expect(tableBuilder.or).toHaveBeenCalledWith(\n      expect.stringContaining('description.ilike.\"%Pro \"\"Alpha\"\"%\"')\n    );\n    expect(tableBuilder.order).toHaveBeenNthCalledWith(1, \"date_paid\", {\n      ascending: false,\n      nullsLast: true,\n    });\n    expect(tableBuilder.order).toHaveBeenNthCalledWith(2, \"created_at\", {\n      ascending: false,\n    });\n    expect(tableBuilder.range).toHaveBeenCalledWith(0, 24);\n\n    expect(metricsBuilder.select).toHaveBeenCalledWith(\n      \"id, amount, status, type, date_paid, created_at, project_id\"\n    );\n    expect(metricsBuilder.ilike).toHaveBeenCalledWith(\"status\", \"paid\");\n    expect(metricsBuilder.in).toHaveBeenCalledWith(\"type\", [\"extra\"]);\n    expect(metricsBuilder.gte).toHaveBeenCalledWith(\"amount\", 50);\n    expect(metricsBuilder.lte).toHaveBeenCalledWith(\"amount\", 500);\n    expect(metricsBuilder.or).toHaveBeenCalledWith(\n      expect.stringContaining(\"project_id.in.(project-30,project-40,project-50)\")\n    );\n\n    await waitFor(() => expect(result.current.paginatedPayments).toHaveLength(2));\n    expect(result.current.paginatedPayments[0]?.id).toBe(\"payment-newer\");\n    expect(result.current.totalCount).toBe(2);\n  });\n\n  it(\"surfaces Supabase errors through the provided handler\", async () => {\n    const failingBuilder = enqueue(\n      \"payments\",\n      createQueryBuilder({\n        data: null,\n        error: new Error(\"payments fetch failed\"),\n      })\n    );\n\n    const { result } = renderHook(\n      (props: typeof baseProps & { onError: (error: Error) => void }) =>\n        usePaymentsData(props),\n      {\n        initialProps: { ...baseProps, onError },\n      }\n    );\n\n    await waitFor(() => expect(onError).toHaveBeenCalled());\n\n    expect(onError).toHaveBeenCalledWith(expect.objectContaining({ message: \"payments fetch failed\" }));\n    expect(result.current.initialLoading).toBe(false);\n    expect(result.current.tableLoading).toBe(false);\n    expect(result.current.paginatedPayments).toHaveLength(0);\n    expect(failingBuilder.range).toHaveBeenCalledWith(0, 1);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/payments/hooks/__tests__/usePaymentsFilters.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/payments/hooks/__tests__/usePaymentsTableColumns.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/payments/hooks/usePaymentsData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/payments/hooks/usePaymentsFilters.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'amountDirty'. Either include it or remove the dependency array.","line":350,"column":5,"nodeType":"ArrayExpression","endLine":364,"endColumn":6,"suggestions":[{"desc":"Update the dependencies array to be: [amountDirty, amountMaxDraft, amountMinDraft, filtersState.status, filtersState.type, handleAmountMaxDraftChange, handleAmountMinDraftChange, handleApplyAmountFilters, handleStatusChange, handleTypeChange, statusFilterOptions, t, typeFilterOptions]","fix":{"range":[11222,11561],"text":"[amountDirty, amountMaxDraft, amountMinDraft, filtersState.status, filtersState.type, handleAmountMaxDraftChange, handleAmountMinDraftChange, handleApplyAmountFilters, handleStatusChange, handleTypeChange, statusFilterOptions, t, typeFilterOptions]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useMemo, useState, useEffect } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Button } from \"@/components/ui/button\";\nimport { Check } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { ToggleGroup, ToggleGroupItem } from \"@/components/ui/toggle-group\";\nimport type { AdvancedDataTableFiltersConfig } from \"@/components/data-table\";\nimport {\n  SEARCH_MIN_CHARS,\n  STATUS_FILTER_OPTIONS,\n  TYPE_FILTER_OPTIONS,\n} from \"../constants\";\nimport type {\n  PaymentStatusFilter,\n  PaymentTypeFilter,\n} from \"../types\";\n\nexport type PaymentsFiltersState = {\n  status: PaymentStatusFilter[];\n  type: PaymentTypeFilter[];\n  amountMin: number | null;\n  amountMax: number | null;\n  search: string;\n};\n\nexport type PaymentsFiltersChangeReason = \"apply\" | \"reset\" | \"search\";\n\ninterface UsePaymentsFiltersOptions {\n  onStateChange?: (\n    next: PaymentsFiltersState,\n    meta: { reason: PaymentsFiltersChangeReason }\n  ) => void;\n  initialState?: PaymentsFiltersState;\n}\n\ninterface UsePaymentsFiltersResult {\n  state: PaymentsFiltersState;\n  filtersConfig: AdvancedDataTableFiltersConfig;\n  searchValue: string;\n  onSearchChange: (value: string) => void;\n  onSearchClear: () => void;\n  activeFilterCount: number;\n}\n\nconst defaultState: PaymentsFiltersState = {\n  status: [],\n  type: [],\n  amountMin: null,\n  amountMax: null,\n  search: \"\",\n};\n\nconst arraysMatch = (a: string[], b: string[]) => {\n  if (a.length !== b.length) return false;\n  const sortedA = [...a].sort();\n  const sortedB = [...b].sort();\n  return sortedA.every((value, index) => value === sortedB[index]);\n};\n\nexport function usePaymentsFilters({\n  onStateChange,\n  initialState = defaultState,\n}: UsePaymentsFiltersOptions = {}): UsePaymentsFiltersResult {\n  const { t } = useTranslation(\"pages\");\n\n  const normalizedInitialState = useMemo(\n    () => ({ ...defaultState, ...initialState }),\n    [initialState]\n  );\n\n  const [filtersState, setFiltersState] = useState<PaymentsFiltersState>(\n    normalizedInitialState\n  );\n  const [searchDraft, setSearchDraft] = useState<string>(\n    normalizedInitialState.search\n  );\n  const [amountMinDraft, setAmountMinDraft] = useState<string>(\n    normalizedInitialState.amountMin != null\n      ? String(normalizedInitialState.amountMin)\n      : \"\"\n  );\n  const [amountMaxDraft, setAmountMaxDraft] = useState<string>(\n    normalizedInitialState.amountMax != null\n      ? String(normalizedInitialState.amountMax)\n      : \"\"\n  );\n\n  useEffect(() => {\n    setFiltersState(normalizedInitialState);\n    setSearchDraft(normalizedInitialState.search);\n    setAmountMinDraft(\n      normalizedInitialState.amountMin != null\n        ? String(normalizedInitialState.amountMin)\n        : \"\"\n    );\n    setAmountMaxDraft(\n      normalizedInitialState.amountMax != null\n        ? String(normalizedInitialState.amountMax)\n        : \"\"\n    );\n  }, [normalizedInitialState]);\n\n  const parseAmountInputValue = useCallback((value: string): number | null => {\n    const trimmed = value.trim();\n    if (trimmed === \"\") return null;\n    const parsed = Number(trimmed);\n    return Number.isFinite(parsed) ? parsed : null;\n  }, []);\n\n  useEffect(() => {\n    setAmountMinDraft(\n      filtersState.amountMin != null ? String(filtersState.amountMin) : \"\"\n    );\n  }, [filtersState.amountMin]);\n\n  useEffect(() => {\n    setAmountMaxDraft(\n      filtersState.amountMax != null ? String(filtersState.amountMax) : \"\"\n    );\n  }, [filtersState.amountMax]);\n\n  const updateState = useCallback(\n    (\n      updater: (prev: PaymentsFiltersState) => PaymentsFiltersState,\n      reason: PaymentsFiltersChangeReason = \"apply\"\n    ) => {\n      setFiltersState((prev) => {\n        const next = updater(prev);\n        const unchanged =\n          arraysMatch(prev.status, next.status) &&\n          arraysMatch(prev.type, next.type) &&\n          prev.amountMin === next.amountMin &&\n          prev.amountMax === next.amountMax &&\n          prev.search === next.search;\n        if (unchanged) {\n          return prev;\n        }\n        onStateChange?.(next, { reason });\n        return next;\n      });\n    },\n    [onStateChange]\n  );\n\n  const activeFilterCount = useMemo(() => {\n    const hasStatus =\n      filtersState.status.length > 0 &&\n      filtersState.status.length < STATUS_FILTER_OPTIONS.length;\n    const hasType =\n      filtersState.type.length > 0 &&\n      filtersState.type.length < TYPE_FILTER_OPTIONS.length;\n    const hasMin = filtersState.amountMin !== null;\n    const hasMax = filtersState.amountMax !== null;\n    return [hasStatus, hasType, hasMin, hasMax].filter(Boolean).length;\n  }, [filtersState]);\n\n  const handleResetFilters = useCallback(() => {\n    const resetState: PaymentsFiltersState = {\n      ...normalizedInitialState,\n      search: \"\",\n    };\n    setFiltersState(resetState);\n    setSearchDraft(\"\");\n    setAmountMinDraft(\n      resetState.amountMin != null ? String(resetState.amountMin) : \"\"\n    );\n    setAmountMaxDraft(\n      resetState.amountMax != null ? String(resetState.amountMax) : \"\"\n    );\n    onStateChange?.(resetState, { reason: \"reset\" });\n  }, [normalizedInitialState, onStateChange]);\n\n  const handleStatusChange = useCallback(\n    (values: PaymentStatusFilter[]) => {\n      updateState((prev) => ({ ...prev, status: values }));\n    },\n    [updateState]\n  );\n\n  const handleTypeChange = useCallback(\n    (values: PaymentTypeFilter[]) => {\n      updateState((prev) => ({ ...prev, type: values }));\n    },\n    [updateState]\n  );\n\n  const handleAmountMinDraftChange = useCallback((value: string) => {\n    setAmountMinDraft(value);\n  }, []);\n\n  const handleAmountMaxDraftChange = useCallback((value: string) => {\n    setAmountMaxDraft(value);\n  }, []);\n\n  const handleApplyAmountFilters = useCallback(() => {\n    const nextMin = parseAmountInputValue(amountMinDraft);\n    const nextMax = parseAmountInputValue(amountMaxDraft);\n    updateState(\n      (prev) => ({ ...prev, amountMin: nextMin, amountMax: nextMax })\n    );\n  }, [amountMaxDraft, amountMinDraft, parseAmountInputValue, updateState]);\n\n  const amountDirty = useMemo(() => {\n    const parsedMin = parseAmountInputValue(amountMinDraft);\n    const parsedMax = parseAmountInputValue(amountMaxDraft);\n    return (\n      parsedMin !== filtersState.amountMin || parsedMax !== filtersState.amountMax\n    );\n  }, [\n    amountMaxDraft,\n    amountMinDraft,\n    filtersState.amountMax,\n    filtersState.amountMin,\n    parseAmountInputValue,\n  ]);\n\n  const handleSearchDraftChange = useCallback(\n    (value: string) => {\n      setSearchDraft(value);\n      const trimmed = value.trim();\n      if (trimmed.length >= SEARCH_MIN_CHARS || trimmed.length === 0) {\n        updateState((prev) => ({ ...prev, search: trimmed }), \"search\");\n      }\n    },\n    [updateState]\n  );\n\n  const handleClearSearchDraft = useCallback(() => {\n    setSearchDraft(\"\");\n    updateState((prev) => ({ ...prev, search: \"\" }), \"search\");\n  }, [updateState]);\n\n  const statusFilterOptions = useMemo(\n    () =>\n      STATUS_FILTER_OPTIONS.map((value) => ({\n        value,\n        label: value === \"paid\" ? t(\"payments.status.paid\") : t(\"payments.status.due\"),\n      })),\n    [t]\n  );\n\n  const typeFilterOptions = useMemo(\n    () =>\n      TYPE_FILTER_OPTIONS.map((value) => ({\n        value,\n        label:\n          value === \"base_price\"\n            ? t(\"payments.type.base\")\n            : value === \"extra\"\n              ? t(\"payments.type.extra\")\n              : t(\"payments.type.manual\"),\n      })),\n    [t]\n  );\n\n  const toggleItemClasses =\n    \"rounded-full border border-border/60 bg-background px-3 py-1 text-sm font-medium transition-colors hover:border-border hover:bg-muted/20 data-[state=on]:bg-primary/10 data-[state=on]:text-primary data-[state=on]:border-primary/40\";\n\n  const filtersContent = useMemo(\n    () => (\n      <div className=\"space-y-6\">\n        <div className=\"space-y-2\">\n          <p className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\">\n            {t(\"payments.filters.statusHeading\")}\n          </p>\n          <ToggleGroup\n            type=\"multiple\"\n            value={filtersState.status}\n            onValueChange={(values) => handleStatusChange(values as PaymentStatusFilter[])}\n            className=\"flex flex-wrap justify-start gap-2\"\n            size=\"sm\"\n          >\n            {statusFilterOptions.map((option) => (\n              <ToggleGroupItem key={option.value} value={option.value} className={toggleItemClasses}>\n                {option.label}\n              </ToggleGroupItem>\n            ))}\n          </ToggleGroup>\n        </div>\n        <div className=\"space-y-2\">\n          <p className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\">\n            {t(\"payments.filters.typeHeading\")}\n          </p>\n          <ToggleGroup\n            type=\"multiple\"\n            value={filtersState.type}\n            onValueChange={(values) => handleTypeChange(values as PaymentTypeFilter[])}\n            className=\"flex flex-wrap justify-start gap-2\"\n            size=\"sm\"\n          >\n            {typeFilterOptions.map((option) => (\n              <ToggleGroupItem key={option.value} value={option.value} className={toggleItemClasses}>\n                {option.label}\n              </ToggleGroupItem>\n            ))}\n          </ToggleGroup>\n        </div>\n        <div className=\"space-y-2\">\n          <p className=\"text-xs font-semibold uppercase tracking-wide text-muted-foreground\">\n            {t(\"payments.filters.amountHeading\")}\n          </p>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"grid flex-1 gap-2 sm:grid-cols-2\">\n              <Input\n                type=\"number\"\n                inputMode=\"decimal\"\n                step=\"0.01\"\n                min=\"0\"\n                value={amountMinDraft}\n                onChange={(event) => handleAmountMinDraftChange(event.target.value)}\n                onKeyDown={(event) => {\n                  if (event.key === \"Enter\") {\n                    event.preventDefault();\n                    handleApplyAmountFilters();\n                  }\n                }}\n              placeholder={t(\"payments.filters.amountMinPlaceholder\")}\n              className=\"h-9 rounded-full\"\n              />\n              <Input\n                type=\"number\"\n                inputMode=\"decimal\"\n                step=\"0.01\"\n                min=\"0\"\n                value={amountMaxDraft}\n                onChange={(event) => handleAmountMaxDraftChange(event.target.value)}\n                onKeyDown={(event) => {\n                  if (event.key === \"Enter\") {\n                    event.preventDefault();\n                    handleApplyAmountFilters();\n                  }\n                }}\n              placeholder={t(\"payments.filters.amountMaxPlaceholder\")}\n              className=\"h-9 rounded-full\"\n              />\n            </div>\n            <Button\n              type=\"button\"\n              size=\"icon\"\n              className=\"h-9 w-9 shrink-0\"\n              onClick={handleApplyAmountFilters}\n              disabled={!amountDirty}\n            >\n              <Check className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n    ),\n    [\n      amountMaxDraft,\n      amountMinDraft,\n      filtersState.status,\n      filtersState.type,\n      handleAmountMaxDraftChange,\n      handleAmountMinDraftChange,\n      handleApplyAmountFilters,\n      handleStatusChange,\n      handleTypeChange,\n      statusFilterOptions,\n      t,\n      toggleItemClasses,\n      typeFilterOptions,\n    ]\n  );\n\n  const filtersConfig: AdvancedDataTableFiltersConfig = useMemo(\n    () => ({\n      title: t(\"payments.filterPanel.title\"),\n      triggerLabel: t(\"payments.filterPanel.title\"),\n      content: filtersContent,\n      activeCount: activeFilterCount,\n      onReset: activeFilterCount ? handleResetFilters : undefined,\n      // Keep the filter rail closed by default; it will auto-open when\n      // there are active filters due to AdvancedDataTable logic.\n      collapsedByDefault: true,\n    }),\n    [activeFilterCount, filtersContent, handleResetFilters, t]\n  );\n\n  return {\n    state: filtersState,\n    filtersConfig,\n    searchValue: searchDraft,\n    onSearchChange: handleSearchDraftChange,\n    onSearchClear: handleClearSearchDraft,\n    activeFilterCount,\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/payments/hooks/usePaymentsTableColumns.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/payments/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/projects/hooks/__tests__/useProjectsFilters.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/projects/hooks/useProjectsData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/projects/hooks/useProjectsFilters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/projects/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/Account_old.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'profileSection'. Either include it or remove the dependency array.","line":106,"column":6,"nodeType":"ArrayExpression","endLine":106,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [profile, profileLoading, profileSection]","fix":{"range":[4903,4928],"text":"[profile, profileLoading, profileSection]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'workingHoursSection'. Either include it or remove the dependency array.","line":116,"column":6,"nodeType":"ArrayExpression","endLine":116,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [workingHours, workingHoursSection]","fix":{"range":[5182,5196],"text":"[workingHours, workingHoursSection]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5282,5285],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5282,5285],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport SettingsPageWrapper from \"@/components/settings/SettingsPageWrapper\";\nimport SettingsHeader from \"@/components/settings/SettingsHeader\";\nimport EnhancedSettingsSection from \"@/components/settings/EnhancedSettingsSection\";\nimport { CategorySettingsSection } from \"@/components/settings/CategorySettingsSection\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { Upload, ChevronDown, Loader2, X, Copy, Check } from \"lucide-react\";\nimport { useProfile } from \"@/contexts/ProfileContext\";\nimport { useWorkingHours } from \"@/hooks/useWorkingHours\";\nimport { useTranslation } from \"react-i18next\";\nimport { useMessagesTranslation } from \"@/hooks/useTypedTranslation\";\n// Team management removed for single photographer mode\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useSettingsCategorySection } from \"@/hooks/useSettingsCategorySection\";\nimport { trimAndNormalizeSpaces, createTrimmedBlurHandler } from \"@/lib/inputUtils\";\n\nexport default function Account() {\n  const [inviteEmail, setInviteEmail] = useState(\"\");\n  const [emailAddress, setEmailAddress] = useState(\"\");\n  const [isProfilePhotoModalOpen, setIsProfilePhotoModalOpen] = useState(false);\n  const [copiedStates, setCopiedStates] = useState<{ [key: string]: boolean }>({});\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  \n  const { profile, loading: profileLoading, uploading, updateProfile, uploadProfilePhoto, deleteProfilePhoto } = useProfile();\n  const { workingHours, loading: workingHoursLoading, updateWorkingHour } = useWorkingHours();\n  // Team management removed for single photographer mode - provide default values\n  const teamMembers = [];\n  const invitations = [];\n  const teamLoading = false;\n  const currentUserRole = 'Owner';\n  const sendInvitation = async () => ({ success: false, error: 'Team management disabled' });\n  const cancelInvitation = async () => ({ success: false, error: 'Team management disabled' });\n  const removeMember = async () => ({ success: false, error: 'Team management disabled' });\n  const updateMemberRole = async () => ({ success: false, error: 'Team management disabled' });\n  const { toast } = useToast();\n  const { t } = useTranslation(['pages']);\n  const { t: tMessages } = useMessagesTranslation();\n\n  // Profile section state\n  const profileSection = useSettingsCategorySection({\n    sectionId: \"profile\",\n    sectionName: \"Profile\",\n    initialValues: {\n      fullName: profile?.full_name || \"\",\n      phoneNumber: profile?.phone_number || \"\",\n    },\n    onSave: async (values) => {\n      const result = await updateProfile({\n        full_name: trimAndNormalizeSpaces(values.fullName),\n        phone_number: trimAndNormalizeSpaces(values.phoneNumber),\n      });\n      \n      if (!result.success) {\n        throw new Error(\"Failed to save profile\");\n      }\n    }\n  });\n\n  // Working hours section state\n  const workingHoursSection = useSettingsCategorySection({\n    sectionId: \"working-hours\",\n    sectionName: \"Working Hours\",\n    initialValues: {\n      workingHours: workingHours\n    },\n    onSave: async (values) => {\n      // Working hours are saved immediately on change, so nothing to do here\n      return values;\n    }\n  });\n\n  const days = [1, 2, 3, 4, 5, 6, 0]; // Monday=1, Sunday=0\n  const dayLabels = [\"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\", \"Sunday\"];\n\n  // Get current user info\n  const getCurrentUser = async () => {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (user?.email) setEmailAddress(user.email);\n    return user;\n  };\n\n  // Load profile data when component mounts\n  useEffect(() => {\n    getCurrentUser();\n  }, []);\n\n  // Update form fields when profile loads\n  useEffect(() => {\n    if (profile && !profileLoading) {\n      profileSection.setValues({\n        fullName: profile.full_name || \"\",\n        phoneNumber: profile.phone_number || \"\",\n      });\n    }\n  }, [profile, profileLoading]);\n\n  // Update working hours form when data loads\n  useEffect(() => {\n    console.log(\"Working hours data:\", workingHours);\n    if (workingHours.length > 0) {\n      workingHoursSection.setValues({\n        workingHours: workingHours\n      });\n    }\n  }, [workingHours]);\n\n  const handleWorkingHourUpdate = async (dayOfWeek: number, field: string, value: any) => {\n    console.log(`Updating working hour for day ${dayOfWeek}, field ${field}, value ${value}`);\n    const workingHour = workingHours.find(wh => wh.day_of_week === dayOfWeek);\n    if (workingHour) {\n      const result = await updateWorkingHour(dayOfWeek, { [field]: value });\n      if (result.success) {\n        toast({\n          title: \"Success\",\n          description: \"Working hours updated successfully\",\n        });\n      }\n      // Mark working hours section as dirty to show save button\n      workingHoursSection.updateValue(\"workingHours\", workingHours);\n    }\n  };\n\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      await uploadProfilePhoto(file);\n    }\n  };\n\n  const handleDeleteProfilePhoto = async () => {\n    const result = await deleteProfilePhoto();\n    if (result.success) {\n      // The toast is handled in the hook\n    }\n  };\n\n  const handleSendInvitation = async () => {\n    if (!inviteEmail.trim()) return;\n    \n    // Team invitations disabled in single photographer mode\n    const result = await sendInvitation();\n    if (result.success) {\n      setInviteEmail(\"\");\n    }\n  };\n\n  const handleCopyInvitationLink = async (invitationId: string) => {\n    try {\n      // Generate invitation link\n      const invitationLink = `${window.location.origin}/accept-invitation?id=${invitationId}`;\n      \n      await navigator.clipboard.writeText(invitationLink);\n      \n      // Set copied state for this specific invitation\n      setCopiedStates(prev => ({ ...prev, [invitationId]: true }));\n      \n      toast({\n        title: \"Invitation link copied!\",\n        description: \"You can now share this link with your team member.\",\n      });\n      \n      // Reset copied state after 2 seconds\n      setTimeout(() => {\n        setCopiedStates(prev => ({ ...prev, [invitationId]: false }));\n      }, 2000);\n    } catch (error) {\n      toast({\n        title: \"Copy failed\",\n        description: \"Could not copy invitation link to clipboard.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const getWorkingHourByDay = (dayOfWeek: number) => {\n    const workingHour = workingHours.find(wh => wh.day_of_week === dayOfWeek);\n    if (workingHour) {\n      return {\n        ...workingHour,\n        // Convert \"09:00:00\" to \"09:00\"\n        start_time: workingHour.start_time ? workingHour.start_time.substring(0, 5) : \"09:00\",\n        end_time: workingHour.end_time ? workingHour.end_time.substring(0, 5) : \"17:00\"\n      };\n    }\n    return {\n      enabled: false,\n      start_time: \"09:00\",\n      end_time: \"17:00\"\n    };\n  };\n\n  // Get current user ID for comparison\n  const getCurrentUserId = async () => {\n    const { data: { user } } = await supabase.auth.getUser();\n    return user?.id;\n  };\n\n  // Generate time options from 06:00 to 22:00\n  const generateTimeOptions = () => {\n    const times = [];\n    for (let hour = 6; hour <= 22; hour++) {\n      const timeString = `${hour.toString().padStart(2, '0')}:00`;\n      times.push(timeString);\n    }\n    return times;\n  };\n\n  const timeOptions = generateTimeOptions();\n\n  // Show loading state until all data is loaded\n  if (profileLoading || workingHoursLoading || teamLoading) {\n    return (\n      <SettingsPageWrapper>\n        <SettingsHeader\n          title=\"Account & Users\"\n          description=\"Manage your account settings and user permissions\"\n        />\n        <div className=\"flex items-center justify-center h-48\">\n          <Loader2 className=\"h-8 w-8 animate-spin\" />\n        </div>\n      </SettingsPageWrapper>\n    );\n  }\n\n  return (\n    <SettingsPageWrapper>\n      <SettingsHeader\n        title=\"Account & Users\"\n        description=\"Manage your account settings and user permissions\"\n      />\n      \n      <div className=\"space-y-8\">\n        <CategorySettingsSection\n          title=\"Profile\"\n          description=\"Update your personal information and photo.\"\n          sectionId=\"profile\"\n        >\n          <div className=\"space-y-6\">\n            {/* Avatar Upload */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"avatar-upload\">Profile Photo</Label>\n              \n              {/* Current Photo Preview - Always show container to prevent layout shift */}\n              <div className=\"flex flex-col sm:flex-row sm:items-center gap-4 p-4 border rounded-lg bg-muted/30 max-w-md min-h-[80px]\">\n                {profile?.profile_photo_url ? (\n                  <>\n                    {/* Mobile Layout */}\n                    <div className=\"flex items-center gap-3 sm:hidden\">\n                      <div className=\"relative cursor-pointer\" onClick={() => setIsProfilePhotoModalOpen(true)}>\n                        <img \n                          src={profile.profile_photo_url} \n                          alt=\"Current profile photo - click to enlarge\" \n                          className=\"w-12 h-12 object-cover bg-white border rounded-full hover:opacity-80 transition-opacity\"\n                          title=\"Click to view full size\"\n                        />\n                      </div>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-medium\">Current Photo</p>\n                        <p className=\"text-xs text-muted-foreground\">Photo is currently set</p>\n                      </div>\n                    </div>\n                    \n                    {/* Desktop/Tablet Layout */}\n                    <div className=\"hidden sm:flex sm:items-center sm:gap-4 sm:flex-1\">\n                      <div className=\"relative cursor-pointer\" onClick={() => setIsProfilePhotoModalOpen(true)}>\n                        <img \n                          src={profile.profile_photo_url} \n                          alt=\"Current profile photo - click to enlarge\" \n                          className=\"w-16 h-16 object-cover bg-white border rounded-full hover:opacity-80 transition-opacity\"\n                          title=\"Click to view full size\"\n                        />\n                      </div>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-medium\">Current Photo</p>\n                        <p className=\"text-xs text-muted-foreground\">Photo is currently set</p>\n                      </div>\n                    </div>\n\n                    {/* Delete Button - Full width on mobile, inline on larger screens */}\n                    <div className=\"w-full sm:w-auto\">\n                      <AlertDialog>\n                        <AlertDialogTrigger asChild>\n                          <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"w-full sm:w-auto flex items-center justify-center gap-2 text-destructive hover:text-destructive\"\n                          >\n                            <X className=\"h-4 w-4\" />\n                            Delete\n                          </Button>\n                        </AlertDialogTrigger>\n                        <AlertDialogContent>\n                          <AlertDialogHeader>\n                            <AlertDialogTitle>Delete Profile Photo</AlertDialogTitle>\n                            <AlertDialogDescription>\n                              {tMessages('confirm.deleteProfilePhoto')} {tMessages('confirm.cannotUndo')}\n                            </AlertDialogDescription>\n                          </AlertDialogHeader>\n                          <AlertDialogFooter>\n                            <AlertDialogCancel>Cancel</AlertDialogCancel>\n                            <AlertDialogAction\n                              onClick={handleDeleteProfilePhoto}\n                              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                            >\n                              Delete Photo\n                            </AlertDialogAction>\n                          </AlertDialogFooter>\n                        </AlertDialogContent>\n                      </AlertDialog>\n                    </div>\n                  </>\n                ) : (\n                  <>\n                    {/* Mobile Layout - Placeholder */}\n                    <div className=\"flex items-center gap-3 sm:hidden\">\n                      <Avatar className=\"w-12 h-12\">\n                        <AvatarFallback className=\"bg-primary/10 text-primary font-semibold\">\n                          {profileSection.values.fullName \n                            ? profileSection.values.fullName.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase()\n                            : 'U'\n                          }\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-medium\">Default Avatar</p>\n                        <p className=\"text-xs text-muted-foreground\">Used in admin views and client messages</p>\n                      </div>\n                    </div>\n                    \n                    {/* Desktop/Tablet Layout - Placeholder */}\n                    <div className=\"hidden sm:flex sm:items-center sm:gap-4 sm:flex-1\">\n                      <Avatar className=\"w-16 h-16\">\n                        <AvatarFallback className=\"bg-primary/10 text-primary font-semibold text-lg\">\n                          {profileSection.values.fullName \n                            ? profileSection.values.fullName.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase()\n                            : 'U'\n                          }\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-medium\">Default Avatar</p>\n                        <p className=\"text-xs text-muted-foreground\">Used in admin views and client messages when no photo is uploaded</p>\n                      </div>\n                    </div>\n                  </>\n                )}\n              </div>\n\n              {/* File Upload Button */}\n              <div className=\"flex flex-col gap-2\">\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleFileUpload}\n                  className=\"hidden\"\n                />\n                <Button \n                  variant=\"outline\" \n                  className=\"flex items-center gap-2 w-full sm:w-fit\"\n                  onClick={() => fileInputRef.current?.click()}\n                  disabled={uploading}\n                >\n                  {uploading ? (\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\n                  ) : (\n                    <Upload className=\"h-4 w-4\" />\n                  )}\n                  {uploading ? \"Uploading...\" : profile?.profile_photo_url ? \"Choose New File\" : \"Choose File\"}\n                </Button>\n              </div>\n\n              <p className=\"text-sm text-muted-foreground\">\n                Used in admin views and client messages. Accepts JPG, PNG, SVG. Max file size: 2 MB\n              </p>\n            </div>\n\n            {/* Full Name */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"full-name\">Full Name</Label>\n              <Input\n                id=\"full-name\"\n                placeholder=\"Enter your full name\"\n                value={profileSection.values.fullName}\n                onChange={(e) => profileSection.updateValue(\"fullName\", e.target.value)}\n                onBlur={createTrimmedBlurHandler(profileSection.values.fullName, (value) => profileSection.updateValue(\"fullName\", value))}\n                className=\"max-w-md\"\n              />\n            </div>\n\n            {/* Phone Number */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"phone\">Phone Number</Label>\n              <Input\n                id=\"phone\"\n                type=\"tel\"\n                placeholder=\"Enter your phone number\"\n                value={profileSection.values.phoneNumber}\n                onChange={(e) => profileSection.updateValue(\"phoneNumber\", e.target.value)}\n                onBlur={createTrimmedBlurHandler(profileSection.values.phoneNumber, (value) => profileSection.updateValue(\"phoneNumber\", value))}\n                className=\"max-w-md\"\n              />\n            </div>\n\n            {/* Email Address */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email Address</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                value={emailAddress}\n                disabled\n                className=\"max-w-md\"\n              />\n              <p className=\"text-sm text-muted-foreground\">\n                Contact support to change your email address\n              </p>\n            </div>\n          </div>\n        </CategorySettingsSection>\n\n        <CategorySettingsSection\n          title=\"Working Hours\"\n          description=\"Define your available times for bookings and scheduling.\"\n          sectionId=\"working-hours\"\n        >\n          <div className=\"space-y-4\">\n            {days.map((dayOfWeek, index) => {\n              const workingHour = getWorkingHourByDay(dayOfWeek);\n              return (\n                <div key={dayOfWeek} className=\"space-y-2 sm:space-y-0\">\n                  {/* Desktop layout: single row */}\n                  <div className=\"hidden sm:flex sm:items-center sm:gap-4 py-2\">\n                    <Switch\n                      checked={workingHour.enabled}\n                      onCheckedChange={(enabled) => handleWorkingHourUpdate(dayOfWeek, \"enabled\", enabled)}\n                    />\n                    <Label className=\"text-sm font-medium min-w-[80px]\">{dayLabels[index]}</Label>\n                    \n                    <div className=\"flex items-center gap-3\">\n                      <Select\n                        value={workingHour.start_time || \"09:00\"}\n                        onValueChange={(value) => handleWorkingHourUpdate(dayOfWeek, \"start_time\", value)}\n                        disabled={!workingHour.enabled}\n                      >\n                        <SelectTrigger className=\"w-24\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {timeOptions.map(time => (\n                            <SelectItem key={time} value={time}>{time}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      \n                      <span className=\"text-sm text-muted-foreground\">to</span>\n                      \n                      <Select\n                        value={workingHour.end_time || \"17:00\"}\n                        onValueChange={(value) => handleWorkingHourUpdate(dayOfWeek, \"end_time\", value)}\n                        disabled={!workingHour.enabled}\n                      >\n                        <SelectTrigger className=\"w-24\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {timeOptions.map(time => (\n                            <SelectItem key={time} value={time}>{time}</SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n\n                  {/* Mobile layout: stacked */}\n                  <div className=\"sm:hidden space-y-2 py-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <Label className=\"text-sm font-medium\">{dayLabels[index]}</Label>\n                      <Switch\n                        checked={workingHour.enabled}\n                        onCheckedChange={(enabled) => handleWorkingHourUpdate(dayOfWeek, \"enabled\", enabled)}\n                      />\n                    </div>\n                    \n                    {workingHour.enabled && (\n                      <div className=\"flex items-center gap-2\">\n                        <Select\n                          value={workingHour.start_time || \"09:00\"}\n                          onValueChange={(value) => handleWorkingHourUpdate(dayOfWeek, \"start_time\", value)}\n                        >\n                          <SelectTrigger className=\"flex-1\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {timeOptions.map(time => (\n                              <SelectItem key={time} value={time}>{time}</SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        \n                        <Select\n                          value={workingHour.end_time || \"17:00\"}\n                          onValueChange={(value) => handleWorkingHourUpdate(dayOfWeek, \"end_time\", value)}\n                        >\n                          <SelectTrigger className=\"flex-1\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {timeOptions.map(time => (\n                              <SelectItem key={time} value={time}>{time}</SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </CategorySettingsSection>\n\n        <EnhancedSettingsSection\n          title=\"Team Management\"\n          description=\"Manage your team members and their roles.\"\n        >\n          <div className=\"space-y-6\">\n            {/* User List */}\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Name</TableHead>\n                    <TableHead>Email</TableHead>\n                    <TableHead>Role</TableHead>\n                    <TableHead>Last Active</TableHead>\n                    <TableHead className=\"w-24\"></TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {teamMembers.map((member) => {\n                    const currentUser = member.user_id === member.organization_id;\n                    const displayName = currentUser && profileSection.values.fullName \n                      ? profileSection.values.fullName \n                      : currentUser && profile?.full_name \n                      ? profile.full_name\n                      : member.full_name\n                      ? member.full_name\n                      : \"(Name not set)\";\n                    \n                    const displayEmail = currentUser && emailAddress \n                      ? emailAddress \n                      : member.email \n                      ? member.email\n                      : \"(Email not available)\";\n                    \n                    return (\n                      <TableRow key={member.id}>\n                        <TableCell className=\"font-medium\">\n                          <div className=\"flex items-center gap-2\">\n                            {displayName}\n                            {member.is_online && (\n                              <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\" title=\"Online\"></div>\n                            )}\n                            {currentUser && (\n                              <span className=\"text-sm text-muted-foreground ml-2\">(You)</span>\n                            )}\n                          </div>\n                        </TableCell>\n                        <TableCell>{displayEmail}</TableCell>\n                        <TableCell>\n                          {currentUser || currentUserRole !== \"Owner\" ? (\n                            <Badge variant={member.system_role === \"Owner\" ? \"default\" : \"secondary\"}>\n                              {member.system_role}\n                            </Badge>\n                          ) : (\n                            <DropdownMenu>\n                              <DropdownMenuTrigger asChild>\n                                <Button \n                                  variant=\"ghost\" \n                                  size=\"sm\" \n                                  className=\"h-auto p-1 bg-secondary/50 hover:bg-secondary rounded-full\"\n                                >\n                                  <Badge variant={member.system_role === \"Owner\" ? \"default\" : \"secondary\"} className=\"border-0 bg-transparent hover:bg-transparent\">\n                                    {member.system_role}\n                                  </Badge>\n                                  <ChevronDown className=\"h-3 w-3 ml-1\" />\n                                </Button>\n                              </DropdownMenuTrigger>\n                              <DropdownMenuContent align=\"start\">\n                                <DropdownMenuItem onClick={() => updateMemberRole()}>\n                                  Owner\n                                </DropdownMenuItem>\n                                <DropdownMenuItem onClick={() => updateMemberRole()}>\n                                  Member\n                                </DropdownMenuItem>\n                              </DropdownMenuContent>\n                            </DropdownMenu>\n                          )}\n                        </TableCell>\n                         <TableCell className=\"text-sm\">\n                           <div className=\"flex items-center gap-2\">\n                             {member.is_online ? (\n                               <>\n                                 <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n                                 <span className=\"text-green-600 font-medium\">Online</span>\n                               </>\n                             ) : member.last_active ? (\n                               <span className=\"text-muted-foreground\">\n                                 {new Date(member.last_active).toLocaleDateString()}\n                               </span>\n                             ) : (\n                               <span className=\"text-muted-foreground\">Never</span>\n                             )}\n                           </div>\n                         </TableCell>\n                        <TableCell>\n                          {!currentUser && currentUserRole === \"Owner\" && (\n                            <Button \n                              variant=\"outline\" \n                              size=\"sm\" \n                              className=\"text-destructive border-destructive/20 hover:bg-destructive/10\"\n                              onClick={() => removeMember()}\n                            >\n                              Remove\n                            </Button>\n                          )}\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                  {invitations.map((invite) => (\n                    <TableRow key={invite.id}>\n                      <TableCell className=\"font-medium text-muted-foreground\">\n                        Pending invite\n                      </TableCell>\n                      <TableCell>{invite.email}</TableCell>\n                      <TableCell>\n                        <Badge variant=\"outline\" className=\"text-muted-foreground\">\n                          Pending\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-sm text-muted-foreground\">\n                        {new Date(invite.expires_at).toLocaleDateString()}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleCopyInvitationLink(invite.id)}\n                            className=\"flex items-center gap-1\"\n                          >\n                            {copiedStates[invite.id] ? (\n                              <Check className=\"h-3 w-3\" />\n                            ) : (\n                              <Copy className=\"h-3 w-3\" />\n                            )}\n                            {copiedStates[invite.id] ? \"Copied!\" : \"Copy Link\"}\n                          </Button>\n                          <Button \n                            variant=\"outline\" \n                            size=\"sm\" \n                            className=\"text-muted-foreground\"\n                            onClick={() => cancelInvitation()}\n                          >\n                            Cancel\n                          </Button>\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n\n            {/* Invite New Member */}\n            <div className=\"space-y-4 pt-4 border-t\">\n              <div>\n                <Label htmlFor=\"invite-email\">Invite New Member</Label>\n                <div className=\"flex flex-col sm:flex-row gap-2 mt-2\">\n                  <Input\n                    id=\"invite-email\"\n                    type=\"email\"\n                    placeholder=\"Enter email address\"\n                    value={inviteEmail}\n                    onChange={(e) => setInviteEmail(e.target.value)}\n                    onBlur={createTrimmedBlurHandler(inviteEmail, setInviteEmail)}\n                    onKeyPress={(e) => {\n                      if (e.key === 'Enter') {\n                        e.preventDefault();\n                        handleSendInvitation();\n                      }\n                    }}\n                    className=\"flex-1 min-w-0\"\n                  />\n                  <Button \n                    className=\"shrink-0 sm:w-auto\"\n                    onClick={handleSendInvitation}\n                    disabled={!inviteEmail.trim() || currentUserRole !== \"Owner\"}\n                  >\n                    Send Invite\n                  </Button>\n                </div>\n              </div>\n              \n              {invitations.length === 0 && (\n                <p className=\"text-sm text-muted-foreground\">\n                  No pending invites yet\n                </p>\n              )}\n            </div>\n          </div>\n        </EnhancedSettingsSection>\n      </div>\n\n      {/* Profile Photo Preview Modal */}\n      <Dialog open={isProfilePhotoModalOpen} onOpenChange={setIsProfilePhotoModalOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Profile Photo Preview</DialogTitle>\n          </DialogHeader>\n          <div className=\"flex justify-center p-6\">\n            {profile?.profile_photo_url && (\n              <img \n                src={profile.profile_photo_url} \n                alt=\"Profile photo full size preview\" \n                className=\"max-w-full max-h-96 object-contain bg-white border rounded shadow-sm\"\n              />\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n    </SettingsPageWrapper>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/Billing.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5945,5948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5945,5948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useEffect, useMemo, useState } from \"react\";\nimport SettingsPageWrapper from \"@/components/settings/SettingsPageWrapper\";\nimport { TaxBillingSection, TaxProfileFormState, TaxProfileFormErrors } from \"@/components/settings/TaxBillingSection\";\nimport { useOrganizationSettings } from \"@/hooks/useOrganizationSettings\";\nimport { DEFAULT_ORGANIZATION_TAX_PROFILE, OrganizationTaxProfile } from \"@/lib/organizationSettingsCache\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\n\nconst clampVatRate = (value: number) => {\n  if (!Number.isFinite(value)) return 0;\n  return Math.min(99.99, Math.max(0, value));\n};\n\nconst profileToFormState = (profile: OrganizationTaxProfile): TaxProfileFormState => ({\n  legalEntityType: profile.legalEntityType ?? \"individual\",\n  companyName: profile.companyName ?? \"\",\n  taxOffice: profile.taxOffice ?? \"\",\n  taxNumber: profile.taxNumber ?? \"\",\n  billingAddress: profile.billingAddress ?? \"\",\n  defaultVatRate:\n    profile.defaultVatRate != null && Number.isFinite(profile.defaultVatRate)\n      ? String(profile.defaultVatRate)\n      : String(DEFAULT_ORGANIZATION_TAX_PROFILE.defaultVatRate),\n  defaultVatMode: profile.defaultVatMode ?? \"exclusive\",\n  pricesIncludeVat: profile.pricesIncludeVat ?? false,\n});\n\nconst normalizeProfile = (profile: OrganizationTaxProfile): OrganizationTaxProfile => {\n  const numericVatRate = Number(profile.defaultVatRate);\n\n  return {\n    ...DEFAULT_ORGANIZATION_TAX_PROFILE,\n    ...profile,\n    legalEntityType: profile.legalEntityType === \"company\" ? \"company\" : \"individual\",\n    defaultVatMode: profile.defaultVatMode === \"inclusive\" ? \"inclusive\" : \"exclusive\",\n    defaultVatRate: clampVatRate(Number.isFinite(numericVatRate) ? numericVatRate : DEFAULT_ORGANIZATION_TAX_PROFILE.defaultVatRate),\n    pricesIncludeVat: Boolean(profile.pricesIncludeVat),\n    companyName: typeof profile.companyName === \"string\" ? profile.companyName.trim() || null : null,\n    taxOffice: typeof profile.taxOffice === \"string\" ? profile.taxOffice.trim() || null : null,\n    taxNumber: typeof profile.taxNumber === \"string\" ? profile.taxNumber.trim() || null : null,\n    billingAddress: typeof profile.billingAddress === \"string\" ? profile.billingAddress.trim() || null : null,\n  };\n};\n\nconst formToProfile = (form: TaxProfileFormState): OrganizationTaxProfile => {\n  const parsedRate = parseFloat(form.defaultVatRate.replace(\",\", \".\"));\n  return normalizeProfile({\n    legalEntityType: form.legalEntityType,\n    companyName: form.companyName.trim() || null,\n    taxOffice: form.taxOffice.trim() || null,\n    taxNumber: form.taxNumber.trim() || null,\n    billingAddress: form.billingAddress.trim() || null,\n    defaultVatRate: Number.isFinite(parsedRate) ? parsedRate : DEFAULT_ORGANIZATION_TAX_PROFILE.defaultVatRate,\n    defaultVatMode: form.defaultVatMode,\n    pricesIncludeVat: form.pricesIncludeVat,\n  });\n};\n\nconst isEqualProfile = (a: OrganizationTaxProfile, b: OrganizationTaxProfile) =>\n  JSON.stringify(normalizeProfile(a)) === JSON.stringify(normalizeProfile(b));\n\nexport default function Billing() {\n  const { t } = useTranslation([\"pages\", \"forms\", \"common\"]);\n  const { toast } = useToast();\n  const { settings, loading, updateSettings } = useOrganizationSettings();\n\n  const normalizedProfile = useMemo(() => {\n    const source = settings?.taxProfile as OrganizationTaxProfile | null;\n    const merged = normalizeProfile({\n      ...DEFAULT_ORGANIZATION_TAX_PROFILE,\n      ...(source ?? {}),\n      companyName: (source?.companyName ?? settings?.photography_business_name ?? null) || null,\n    });\n    return merged;\n  }, [settings]);\n\n  const [formState, setFormState] = useState<TaxProfileFormState>(() => profileToFormState(normalizedProfile));\n  const [errors, setErrors] = useState<TaxProfileFormErrors>({});\n  const [saving, setSaving] = useState(false);\n\n  useEffect(() => {\n    setFormState(profileToFormState(normalizedProfile));\n    setErrors({});\n  }, [normalizedProfile]);\n\n  const handleChange = useCallback((updates: Partial<TaxProfileFormState>) => {\n    setFormState((prev) => ({\n      ...prev,\n      ...updates,\n    }));\n  }, []);\n\n  const validate = useCallback((): boolean => {\n    const nextErrors: TaxProfileFormErrors = {};\n\n    if (formState.legalEntityType === \"company\" && !formState.companyName.trim()) {\n      nextErrors.companyName = t(\"taxBilling.validation.companyNameRequired\", { ns: \"forms\" });\n    }\n\n    const vatRateValue = parseFloat(formState.defaultVatRate.replace(\",\", \".\"));\n    if (formState.defaultVatRate.trim() === \"\" || Number.isNaN(vatRateValue)) {\n      nextErrors.defaultVatRate = t(\"taxBilling.validation.vatRateInvalid\", { ns: \"forms\" });\n    } else if (vatRateValue < 0 || vatRateValue > 99.99) {\n      nextErrors.defaultVatRate = t(\"taxBilling.validation.vatRateRange\", { ns: \"forms\" });\n    }\n\n    setErrors(nextErrors);\n    return Object.keys(nextErrors).length === 0;\n  }, [formState, t]);\n\n  const draftProfile = useMemo(() => formToProfile(formState), [formState]);\n  const isDirty = useMemo(() => !isEqualProfile(draftProfile, normalizedProfile), [draftProfile, normalizedProfile]);\n\n  const handleReset = useCallback(() => {\n    setFormState(profileToFormState(normalizedProfile));\n    setErrors({});\n  }, [normalizedProfile]);\n\n  const handleSave = useCallback(async () => {\n    if (!validate()) return;\n    setSaving(true);\n    try {\n      const result = await updateSettings({ taxProfile: draftProfile });\n      if (result.success) {\n        toast({\n          title: t(\"toast.success\", { ns: \"common\" }),\n          description: t(\"taxBilling.notifications.saved\", { ns: \"forms\" }),\n        });\n        setErrors({});\n      } else {\n        toast({\n          title: t(\"toast.error\", { ns: \"common\" }),\n          description: t(\"taxBilling.notifications.saveFailed\", { ns: \"forms\" }),\n          variant: \"destructive\",\n        });\n      }\n    } catch (error: any) {\n      toast({\n        title: t(\"toast.error\", { ns: \"common\" }),\n        description: error?.message ?? t(\"taxBilling.notifications.saveFailed\", { ns: \"forms\" }),\n        variant: \"destructive\",\n      });\n    } finally {\n      setSaving(false);\n    }\n  }, [draftProfile, toast, t, updateSettings, validate]);\n\n  return (\n    <SettingsPageWrapper>\n      <div className=\"space-y-6\">\n        <TaxBillingSection\n          profile={formState}\n          errors={errors}\n          dirty={isDirty}\n          loading={loading}\n          saving={saving}\n          onChange={handleChange}\n          onSave={handleSave}\n          onReset={handleReset}\n        />\n      </div>\n    </SettingsPageWrapper>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/Contracts.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/DangerZone.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/General.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":109,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5222,5225],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5222,5225],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'brandingSection' and 'regionalSection'. Either include them or remove the dependency array.","line":162,"column":6,"nodeType":"ArrayExpression","endLine":162,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [brandingSection, regionalSection, settings]","fix":{"range":[6871,6881],"text":"[brandingSection, regionalSection, settings]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useRef, useState } from \"react\";\nimport { useSearchParams, useNavigate } from \"react-router-dom\";\nimport SettingsPageWrapper from \"@/components/settings/SettingsPageWrapper\";\nimport { CategorySettingsSection } from \"@/components/settings/CategorySettingsSection\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Upload, Loader2, X, Building, Settings, CheckCircle } from \"lucide-react\";\n\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { useSettingsCategorySection } from \"@/hooks/useSettingsCategorySection\";\nimport { useOrganizationSettings } from \"@/hooks/useOrganizationSettings\";\nimport { useOnboarding } from \"@/contexts/OnboardingContext\";\nimport { OnboardingTutorial, TutorialStep } from \"@/components/shared/OnboardingTutorial\";\nimport { SocialChannelsSection } from \"@/components/settings/SocialChannelsSection\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\nimport { SettingsLoadingSkeleton } from \"@/components/ui/loading-presets\";\nimport { TimezoneSelector } from \"@/components/TimezoneSelector\";\nimport { detectBrowserTimezone } from \"@/lib/dateFormatUtils\";\nimport { emailSchema, phoneSchema } from \"@/lib/validation\";\nimport { LanguageSwitcher } from \"@/components/LanguageSwitcher\";\nimport { useTranslation } from \"react-i18next\";\n\nexport default function General() {\n  const { settings, loading, uploading, updateSettings, uploadLogo, deleteLogo } = useOrganizationSettings();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [isLogoModalOpen, setIsLogoModalOpen] = useState(false);\n  const [searchParams] = useSearchParams();\n  const navigate = useNavigate();\n  const { completeCurrentStep } = useOnboarding();\n  const { t } = useTranslation(['pages', 'common']);\n\n  // Check if we're in tutorial mode from Profile onboarding\n  const isInTutorial = searchParams.get('tutorial') === 'true';\n  const [showTutorial, setShowTutorial] = useState(isInTutorial);\n  \n  // Create tutorial steps for General page (steps 3, 4, and 5 from Profile)\n  const tutorialSteps: TutorialStep[] = [\n    {\n      id: 3,\n      title: t(\"settings.general.tutorial.businessInfo.title\"),\n      description: t(\"settings.general.tutorial.businessInfo.description\"),\n      content: (\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center gap-2 text-sm\">\n            <Building className=\"h-4 w-4 text-primary\" />\n            <span>{t(\"settings.general.tutorial.businessInfo.setBusinessName\")}</span>\n          </div>\n          <div className=\"flex items-center gap-2 text-sm\">\n            <Upload className=\"h-4 w-4 text-primary\" />\n            <span>{t(\"settings.general.tutorial.businessInfo.uploadLogo\")}</span>\n          </div>\n          <div className=\"flex items-center gap-2 text-sm\">\n            <Settings className=\"h-4 w-4 text-primary\" />\n            <span>{t(\"settings.general.tutorial.businessInfo.chooseBrandColors\")}</span>\n          </div>\n          <div className=\"text-xs text-muted-foreground mt-2\">\n            {t(\"settings.general.tutorial.businessInfo.help\")}\n          </div>\n        </div>\n      ),\n      canProceed: true,\n      mode: 'modal'\n    },\n    {\n      id: 4,\n      title: t(\"settings.general.tutorial.addBusinessName.title\"),\n      description: t(\"settings.general.tutorial.addBusinessName.description\"),\n      content: (\n        <div className=\"space-y-2 text-sm text-muted-foreground\">\n          <p>â€¢ {t(\"settings.general.tutorial.addBusinessName.required\")}</p>\n          <p>â€¢ {t(\"settings.general.tutorial.addBusinessName.appearsOn\")}</p>\n          <p>â€¢ {t(\"settings.general.tutorial.addBusinessName.canChange\")}</p>\n        </div>\n      ),\n      canProceed: !!settings?.photography_business_name?.trim(),\n      mode: 'floating'\n    },\n    {\n      id: 5,\n      title: (\n        <div className=\"flex items-center gap-2\">\n          <CheckCircle className=\"h-5 w-5 text-green-600\" />\n          <span>{t(\"settings.general.tutorial.setupComplete.title\")}</span>\n        </div>\n      ),\n      description: t(\"settings.general.tutorial.setupComplete.description\"),\n      content: null,\n      canProceed: true,\n      mode: 'modal'\n    }\n  ];\n\n  // Branding section state\n  const brandingSection = useSettingsCategorySection({\n    sectionId: \"branding\",\n    sectionName: t(\"settings.general.branding.title\"),\n    initialValues: {\n      companyName: settings?.photography_business_name || \"\",\n      businessEmail: settings?.email || \"\",\n      businessPhone: settings?.phone || \"\",\n      brandColor: settings?.primary_brand_color || \"#1EB29F\"\n    },\n    onSave: async (values) => {\n      // Save branding settings (logo uploads automatically on selection)\n      const updates: any = {\n        photography_business_name: values.companyName,\n        email: values.businessEmail,\n        phone: values.businessPhone,\n        primary_brand_color: values.brandColor\n      };\n\n      const result = await updateSettings(updates);\n      if (!result.success) {\n        throw new Error(\"Failed to save branding settings\");\n      }\n    }\n  });\n\n  // Regional settings section state\n  const regionalSection = useSettingsCategorySection({\n    sectionId: \"regional\",\n    sectionName: t(\"settings.general.regional.title\"),\n    initialValues: {\n      dateFormat: settings?.date_format || \"DD/MM/YYYY\",\n      timeFormat: settings?.time_format || \"12-hour\",\n      timezone: settings?.timezone || detectBrowserTimezone()\n    },\n    onSave: async (values) => {\n      const updates = {\n        date_format: values.dateFormat,\n        time_format: values.timeFormat,\n        timezone: values.timezone\n      };\n\n      const result = await updateSettings(updates);\n      if (!result.success) {\n        throw new Error(\"Failed to save regional settings\");\n      }\n    }\n  });\n\n  // Update form values when settings load\n  useEffect(() => {\n    if (settings) {\n      brandingSection.setValues({\n        companyName: settings.photography_business_name || \"\",\n        businessEmail: settings.email || \"\",\n        businessPhone: settings.phone || \"\",\n        brandColor: settings.primary_brand_color || \"#1EB29F\"\n      });\n\n      regionalSection.setValues({\n        dateFormat: settings.date_format || \"DD/MM/YYYY\",\n        timeFormat: settings.time_format || \"12-hour\",\n        timezone: settings.timezone || detectBrowserTimezone()\n      });\n    }\n  }, [settings]);\n\n  // Remove the old hardcoded tutorial steps - using dynamic ones above\n  const handleTutorialComplete = async () => {\n    // Settings tutorial completed successfully\n    try {\n      await completeCurrentStep();\n      // Navigating to next tutorial step\n      setShowTutorial(false);\n      navigate('/getting-started');\n    } catch (error) {\n      console.error('âŒ Error completing step:', error);\n    }\n  };\n\n  const handleTutorialExit = async () => {\n    setShowTutorial(false);\n  };\n\n  const handleLogoUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    // Validate file before uploading\n    if (!file.type.startsWith('image/')) {\n      alert('Please select an image file');\n      return;\n    }\n\n    if (file.size > 2 * 1024 * 1024) {\n      alert('File size must be less than 2MB');\n      return;\n    }\n\n    // Upload immediately like profile photo\n    await uploadLogo(file);\n    \n    // Reset input value to allow selecting the same file again\n    event.target.value = '';\n  };\n\n  const handleFileButtonClick = () => {\n    fileInputRef.current?.click();\n  };\n\n  const validateBrandColor = (color: string) => {\n    return /^#[0-9A-F]{6}$/i.test(color);\n  };\n\n  const handleBrandColorChange = (value: string) => {\n    // Allow any input while typing, validate only for final color picker sync\n    brandingSection.updateValue(\"brandColor\", value);\n  };\n\n  const handleDeleteLogo = async () => {\n    try {\n      // Clear the logo URL in settings\n      await updateSettings({ logo_url: null });\n      // Reset file input\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    } catch (error) {\n      console.error(\"Failed to delete logo:\", error);\n    }\n  };\n\n  if (loading) {\n    return (\n      <SettingsPageWrapper>\n        <SettingsLoadingSkeleton rows={4} />\n      </SettingsPageWrapper>\n    );\n  }\n\n  return (\n    <SettingsPageWrapper>\n      <div className=\"space-y-8\">\n        <CategorySettingsSection\n          title={t(\"settings.general.branding.title\")}\n          description={t(\"settings.general.branding.description\")}\n          sectionId=\"branding\"\n          data-walkthrough=\"business-form\"\n        >\n          <div className=\"space-y-6\">\n            {/* Company Name */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"company-name\">{t(\"settings.general.branding.company_name\")}</Label>\n              <Input\n                id=\"company-name\"\n                value={brandingSection.values.companyName}\n                onChange={(e) => brandingSection.updateValue(\"companyName\", e.target.value)}\n                placeholder={t(\"settings.general.branding.company_name_placeholder\")}\n                className=\"max-w-md\"\n              />\n              <p className=\"text-sm text-muted-foreground\">\n                {t(\"settings.general.branding.company_name_help\")}\n              </p>\n            </div>\n\n            {/* Business Email */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"business-email\">{t(\"settings.general.branding.business_email\")}</Label>\n              <Input\n                id=\"business-email\"\n                type=\"email\"\n                value={brandingSection.values.businessEmail}\n                onChange={(e) => {\n                  const value = e.target.value;\n                  brandingSection.updateValue(\"businessEmail\", value);\n                  // Validate email format\n                  if (value && !emailSchema.safeParse(value).success) {\n                    e.target.setCustomValidity(\"Please enter a valid email address\");\n                  } else {\n                    e.target.setCustomValidity(\"\");\n                  }\n                }}\n                placeholder={t(\"settings.general.branding.business_email_placeholder\")}\n                className=\"max-w-md\"\n              />\n              <p className=\"text-sm text-muted-foreground\">\n                {t(\"settings.general.branding.business_email_help\")}\n              </p>\n            </div>\n\n            {/* Business Phone */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"business-phone\">{t(\"settings.general.branding.business_phone\")}</Label>\n              <Input\n                id=\"business-phone\"\n                type=\"tel\"\n                value={brandingSection.values.businessPhone}\n                onChange={(e) => {\n                  const value = e.target.value;\n                  brandingSection.updateValue(\"businessPhone\", value);\n                  // Validate phone format (optional)\n                  if (value && !phoneSchema.safeParse(value).success) {\n                    e.target.setCustomValidity(\"Please enter a valid phone number\");\n                  } else {\n                    e.target.setCustomValidity(\"\");\n                  }\n                }}\n                placeholder={t(\"settings.general.branding.business_phone_placeholder\")}\n                className=\"max-w-md\"\n              />\n              <p className=\"text-sm text-muted-foreground\">\n                {t(\"settings.general.branding.business_phone_help\")}\n              </p>\n            </div>\n\n            {/* Logo Upload */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"logo-upload\">{t(\"settings.general.branding.logo_upload\")}</Label>\n              \n              {/* Current Logo Preview - Always show container to prevent layout shift */}\n              <div className=\"flex flex-col sm:flex-row sm:items-center gap-4 p-4 border rounded-lg bg-muted/30 max-w-md min-h-[80px]\">\n                {settings?.logo_url ? (\n                  <>\n                    {/* Mobile Layout */}\n                    <div className=\"flex items-center gap-3 sm:hidden\">\n                      <div className=\"relative cursor-pointer\" onClick={() => setIsLogoModalOpen(true)}>\n                        <img \n                          src={settings.logo_url} \n                          alt={t(\"settings.general.branding.logo_preview_alt\")}\n                          className=\"w-12 h-12 object-contain bg-white border rounded hover:opacity-80 transition-opacity\"\n                          title={t(\"settings.general.branding.logo_preview_tooltip\")}\n                        />\n                      </div>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-medium\">{t(\"settings.general.branding.current_logo\")}</p>\n                        <p className=\"text-xs text-muted-foreground\">{t(\"settings.general.branding.logo_set\")}</p>\n                      </div>\n                    </div>\n                    \n                    {/* Desktop/Tablet Layout */}\n                    <div className=\"hidden sm:flex sm:items-center sm:gap-4 sm:flex-1\">\n                      <div className=\"relative cursor-pointer\" onClick={() => setIsLogoModalOpen(true)}>\n                        <img \n                          src={settings.logo_url} \n                          alt={t(\"settings.general.branding.logo_preview_alt\")}\n                          className=\"w-16 h-16 object-contain bg-white border rounded hover:opacity-80 transition-opacity\"\n                          title={t(\"settings.general.branding.logo_preview_tooltip\")}\n                        />\n                      </div>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-medium\">{t(\"settings.general.branding.current_logo\")}</p>\n                        <p className=\"text-xs text-muted-foreground\">{t(\"settings.general.branding.logo_set\")}</p>\n                      </div>\n                    </div>\n\n                    {/* Delete Button - Full width on mobile, inline on larger screens */}\n                    <div className=\"w-full sm:w-auto\">\n                      <AlertDialog>\n                        <AlertDialogTrigger asChild>\n                          <Button\n                            type=\"button\"\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"w-full sm:w-auto flex items-center justify-center gap-2 text-destructive hover:text-destructive\"\n                          >\n                            <X className=\"h-4 w-4\" />\n                            {t('buttons.delete', { ns: 'common' })}\n                          </Button>\n                        </AlertDialogTrigger>\n                        <AlertDialogContent>\n                          <AlertDialogHeader>\n                            <AlertDialogTitle>{t('settings.general.branding.deleteLogo')}</AlertDialogTitle>\n                            <AlertDialogDescription>\n                              {t('settings.general.branding.deleteLogoConfirm')}\n                            </AlertDialogDescription>\n                          </AlertDialogHeader>\n                          <AlertDialogFooter>\n                            <AlertDialogCancel>{t('buttons.cancel', { ns: 'common' })}</AlertDialogCancel>\n                            <AlertDialogAction\n                              onClick={handleDeleteLogo}\n                              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                            >\n                              {t('settings.general.branding.deleteLogoButton')}\n                            </AlertDialogAction>\n                          </AlertDialogFooter>\n                        </AlertDialogContent>\n                      </AlertDialog>\n                    </div>\n                  </>\n                ) : (\n                  <div className=\"flex items-center justify-center\">\n                    <p className=\"text-sm text-muted-foreground\">{t('settings.general.branding.noLogoSet')}</p>\n                  </div>\n                )}\n              </div>\n\n              {/* File Selection */}\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center gap-3\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={handleFileButtonClick}\n                    disabled={uploading}\n                    className=\"flex items-center gap-2\"\n                  >\n                    {uploading ? (\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    ) : (\n                      <Upload className=\"h-4 w-4\" />\n                    )}\n                    {uploading ? t(\"settings.general.branding.uploading\") : t(\"settings.general.branding.choose_new_logo\")}\n                  </Button>\n                </div>\n\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleLogoUpload}\n                  className=\"hidden\"\n                />\n              </div>\n              \n              <p className=\"text-sm text-muted-foreground\">\n                {t(\"settings.general.branding.logo_formats\")}\n              </p>\n            </div>\n\n            {/* Brand Color */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"brand-color\">{t(\"settings.general.branding.primaryBrandColor\")}</Label>\n              <div className=\"flex items-center gap-4\">\n                <Input\n                  id=\"brand-color\"\n                  type=\"color\"\n                  value={brandingSection.values.brandColor}\n                  onChange={(e) => brandingSection.updateValue(\"brandColor\", e.target.value)}\n                  className=\"w-16 h-10 p-1 border rounded\"\n                />\n                <Input\n                  value={brandingSection.values.brandColor}\n                  onChange={(e) => handleBrandColorChange(e.target.value)}\n                  className=\"flex-1 max-w-xs\"\n                  placeholder=\"#1EB29F\"\n                  pattern=\"^#[0-9A-Fa-f]{6}$\"\n                />\n              </div>\n              <p className=\"text-sm text-muted-foreground\">\n                {t(\"settings.general.branding.brandColorHelp\")}\n              </p>\n            </div>\n          </div>\n        </CategorySettingsSection>\n\n        {/* Social Channels Section */}\n        {settings && (\n          <SocialChannelsSection\n            socialChannels={settings.social_channels || {}}\n            onUpdate={(channels) => updateSettings({ social_channels: channels })}\n            isDirty={false}\n          />\n        )}\n\n        <CategorySettingsSection\n          title={t(\"settings.general.regional.title\")}\n          description={t(\"settings.general.regional.description\")}\n          sectionId=\"regional\"\n        >\n          <div className=\"space-y-6\">\n            {/* Date Format */}\n            <div className=\"space-y-2\">\n              <Label>{t(\"settings.general.regional.dateFormat\")}</Label>\n              <Select \n                value={regionalSection.values.dateFormat} \n                onValueChange={(value) => regionalSection.updateValue(\"dateFormat\", value)}\n              >\n                <SelectTrigger className=\"w-48\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"DD/MM/YYYY\">{t(\"date_formats.DD/MM/YYYY\", { ns: \"forms\" })}</SelectItem>\n                  <SelectItem value=\"MM/DD/YYYY\">{t(\"date_formats.MM/DD/YYYY\", { ns: \"forms\" })}</SelectItem>\n                  <SelectItem value=\"YYYY-MM-DD\">{t(\"date_formats.YYYY-MM-DD\", { ns: \"forms\" })}</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Time Format */}\n            <div className=\"space-y-3\">\n              <Label>{t(\"settings.general.regional.timeFormat\")}</Label>\n              <RadioGroup \n                value={regionalSection.values.timeFormat} \n                onValueChange={(value) => regionalSection.updateValue(\"timeFormat\", value)}\n              >\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"12-hour\" id=\"12-hour\" />\n                  <Label htmlFor=\"12-hour\">{t(\"settings.general.regional.timeFormat12Hour\")}</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"24-hour\" id=\"24-hour\" />\n                  <Label htmlFor=\"24-hour\">{t(\"settings.general.regional.timeFormat24Hour\")}</Label>\n                </div>\n              </RadioGroup>\n            </div>\n\n            {/* Timezone */}\n            <TimezoneSelector\n              value={regionalSection.values.timezone}\n              onValueChange={(value) => regionalSection.updateValue(\"timezone\", value)}\n            />\n\n            {/* Language Preference */}\n            <div className=\"space-y-2\">\n              <Label>{t(\"settings.general.language.title\")}</Label>\n              <div className=\"max-w-xs\">\n                <LanguageSwitcher variant=\"button\" className=\"w-full justify-start\" />\n              </div>\n              <p className=\"text-sm text-muted-foreground\">\n                {t(\"settings.general.language.description\")}\n              </p>\n            </div>\n          </div>\n        </CategorySettingsSection>\n      </div>\n\n      {/* Logo Preview Modal */}\n      <Dialog open={isLogoModalOpen} onOpenChange={setIsLogoModalOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>{t(\"settings.general.branding.logoUpload\")}</DialogTitle>\n          </DialogHeader>\n          <div className=\"flex justify-center p-6\">\n            {settings?.logo_url && (\n              <img \n                src={settings.logo_url} \n                alt=\"Logo full size preview\" \n                className=\"max-w-full max-h-96 object-contain bg-white border rounded shadow-sm\"\n              />\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Tutorial */}\n      <OnboardingTutorial\n        steps={tutorialSteps}\n        onComplete={handleTutorialComplete}\n        onExit={handleTutorialExit}\n        isVisible={showTutorial}\n        initialStepIndex={0}\n      />\n    </SettingsPageWrapper>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/Leads.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/Notifications.tsx","messages":[{"ruleId":"prefer-const","severity":2,"message":"'requestBody' is never reassigned. Use 'const' instead.","line":187,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":187,"endColumn":27,"fix":{"range":[6365,6435],"text":"const requestBody: any = { \n        type,\n        isTest: true \n      };"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":187,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6382,6385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6382,6385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport SettingsPageWrapper from \"@/components/settings/SettingsPageWrapper\";\nimport { CategorySettingsSection } from \"@/components/settings/CategorySettingsSection\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Loader2, TestTube, Power, PowerOff, Clock, Zap } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { SettingsLoadingSkeleton } from \"@/components/ui/loading-presets\";\nimport { useTranslation } from \"react-i18next\";\n\n\ninterface NotificationSettings {\n  // Master Controls\n  globalEnabled: boolean;\n  scheduledTime: string;\n  \n  // Scheduled Notifications  \n  dailySummaryEnabled: boolean;\n  \n  // Immediate Notifications\n  projectMilestoneEnabled: boolean;\n}\n\nexport default function Notifications() {\n  const { toast } = useToast();\n  const { t } = useTranslation('pages');\n  const [loading, setLoading] = useState(true);\n  const [settings, setSettings] = useState<NotificationSettings>({\n    globalEnabled: true,\n    scheduledTime: \"09:00\",\n    dailySummaryEnabled: true,\n    projectMilestoneEnabled: true,\n  });\n\n  const [autoSaveStates, setAutoSaveStates] = useState<{[key: string]: 'idle' | 'saving'}>({});\n\n  // Generate time options every 30 minutes in 24h format\n  const generateTimeOptions = () => {\n    const options = [];\n    for (let hour = 0; hour < 24; hour++) {\n      for (let minute = 0; minute < 60; minute += 30) {\n        const timeValue = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;\n        options.push(timeValue);\n      }\n    }\n    return options;\n  };\n\n  const timeOptions = generateTimeOptions();\n\n  // Load settings from database\n  useEffect(() => {\n    loadSettings();\n  }, []);\n\n  const loadSettings = async () => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n\n      const { data, error } = await supabase\n        .from('user_settings')\n        .select('*')\n        .eq('user_id', user.id)\n        .maybeSingle();\n\n      if (error) {\n        console.error('Error loading settings:', error);\n        return;\n      }\n\n      if (data) {\n        const loadedSettings: NotificationSettings = {\n          globalEnabled: data.notification_global_enabled ?? true,\n          scheduledTime: data.notification_scheduled_time ?? \"09:00\",\n          dailySummaryEnabled: data.notification_daily_summary_enabled ?? true,\n          projectMilestoneEnabled: data.notification_project_milestone_enabled ?? true,\n        };\n        setSettings(loadedSettings);\n      }\n    } catch (error) {\n      console.error('Error loading notification settings:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Master toggle for all notifications\n  const handleToggleAllNotifications = async (enabled: boolean) => {\n    setAutoSaveStates(prev => ({ ...prev, globalEnabled: 'saving' }));\n    \n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('No user found');\n\n      // Update global setting and all individual settings\n      const updates = {\n        notification_global_enabled: enabled,\n        notification_daily_summary_enabled: enabled,\n        notification_project_milestone_enabled: enabled,\n      };\n\n      const { error } = await supabase\n        .from('user_settings')\n        .update(updates)\n        .eq('user_id', user.id);\n\n      if (error) throw error;\n\n      setSettings(prev => ({\n        ...prev,\n        globalEnabled: enabled,\n        dailySummaryEnabled: enabled,\n        projectMilestoneEnabled: enabled,\n      }));\n      \n      setAutoSaveStates(prev => ({ ...prev, globalEnabled: 'idle' }));\n      \n      toast({\n        title: enabled ? t('settings.notifications.toasts.allEnabled') : t('settings.notifications.toasts.allDisabled'),\n        description: `${t('settings.notifications.toasts.' + (enabled ? 'allEnabledDesc' : 'allDisabledDesc'))}`,\n      });\n    } catch (error) {\n      console.error('Error toggling all notifications:', error);\n      setAutoSaveStates(prev => ({ ...prev, globalEnabled: 'idle' }));\n      toast({\n        title: t('settings.notifications.toasts.error'),\n        description: t('settings.notifications.toasts.errorDesc'),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Auto-save function for individual settings\n  const handleAutoSave = async (field: keyof NotificationSettings, value: boolean | string) => {\n    setAutoSaveStates(prev => ({ ...prev, [field]: 'saving' }));\n    \n    const fieldMap: {[key in keyof NotificationSettings]: string} = {\n      globalEnabled: 'notification_global_enabled',\n      scheduledTime: 'notification_scheduled_time',\n      dailySummaryEnabled: 'notification_daily_summary_enabled',\n      projectMilestoneEnabled: 'notification_project_milestone_enabled',\n    };\n\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('No user found');\n\n      const dbField = fieldMap[field];\n      if (!dbField) throw new Error('Invalid field');\n\n      const { error } = await supabase\n        .from('user_settings')\n        .update({ [dbField]: value })\n        .eq('user_id', user.id);\n\n      if (error) throw error;\n\n      setSettings(prev => ({ ...prev, [field]: value }));\n      setAutoSaveStates(prev => ({ ...prev, [field]: 'idle' }));\n      \n      toast({\n        title: t('settings.notifications.toasts.updated'),\n        description: t('settings.notifications.toasts.updatedDesc'),\n      });\n    } catch (error) {\n      console.error('Error saving setting:', error);\n      setAutoSaveStates(prev => ({ ...prev, [field]: 'idle' }));\n      toast({\n        title: t('settings.notifications.toasts.error'),\n        description: t('settings.notifications.toasts.errorDesc'),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Test notification function\n  const [testingNotification, setTestingNotification] = useState<string | null>(null);\n  \n  const testNotification = async (type: string) => {\n    setTestingNotification(type);\n    try {\n      let requestBody: any = { \n        type,\n        isTest: true \n      };\n\n\n      const { data, error } = await supabase.functions.invoke('send-reminder-notifications', {\n        body: requestBody\n      });\n\n      if (error) throw error;\n      if (data?.error) {\n        throw new Error(typeof data.error === 'string' ? data.error : JSON.stringify(data.error));\n      }\n\n      toast({\n        title: t('settings.notifications.toasts.testSent'),\n        description: `${type} ${t('settings.notifications.toasts.testSentDesc')}`,\n      });\n    } catch (error) {\n      console.error('Error testing notification:', error);\n      toast({\n        title: t('settings.notifications.toasts.testFailed'),\n        description: error instanceof Error\n          ? error.message\n          : t('settings.notifications.toasts.testFailedDesc'),\n        variant: \"destructive\",\n      });\n    } finally {\n      setTestingNotification(null);\n    }\n  };\n\n  // Show loading state until all data is loaded\n  if (loading) {\n    return (\n      <SettingsPageWrapper>\n        <SettingsLoadingSkeleton rows={4} />\n      </SettingsPageWrapper>\n    );\n  }\n\n  return (\n    <SettingsPageWrapper>\n      <div className=\"space-y-8\">\n        {/* Master Controls */}\n        <CategorySettingsSection\n          title={t('settings.notifications.masterControls.title')}\n          description={t('settings.notifications.masterControls.description')}\n          sectionId=\"master-controls\"\n        >\n          <div className=\"space-y-6\">\n            {/* Master Toggle */}\n            <div className=\"flex flex-col gap-4 rounded-lg border-2 border-primary/20 bg-primary/5 p-4 sm:flex-row sm:items-start sm:justify-between\">\n              <div className=\"flex-1\">\n                <Label htmlFor=\"global-notifications\" className=\"text-base font-medium flex items-center gap-2\">\n                  {settings.globalEnabled ? <Power className=\"h-4 w-4\" /> : <PowerOff className=\"h-4 w-4\" />}\n                  {t('settings.notifications.masterControls.allNotifications')}\n                </Label>\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  {t('settings.notifications.masterControls.allNotificationsHelp')}\n                </p>\n              </div>\n              <Switch\n                id=\"global-notifications\"\n                checked={settings.globalEnabled}\n                onCheckedChange={handleToggleAllNotifications}\n                disabled={autoSaveStates.globalEnabled === 'saving'}\n                className=\"self-end sm:self-auto\"\n              />\n            </div>\n\n            {/* Scheduled Time Setting */}\n            <div className=\"flex flex-col gap-4 rounded-lg border p-4 sm:flex-row sm:items-start sm:justify-between\">\n              <div className=\"flex-1\">\n                <Label htmlFor=\"scheduled-time\" className=\"text-base font-medium flex items-center gap-2\">\n                  <Clock className=\"h-4 w-4\" />\n                  {t('settings.notifications.masterControls.scheduledTime')}\n                </Label>\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  {t('settings.notifications.masterControls.scheduledTimeHelp')}\n                </p>\n              </div>\n              <Select\n                value={settings.scheduledTime}\n                onValueChange={(value) => handleAutoSave('scheduledTime', value)}\n                disabled={autoSaveStates.scheduledTime === 'saving'}\n              >\n                <SelectTrigger className=\"w-full sm:w-32\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent className=\"max-h-60\">\n                  {timeOptions.map((time) => (\n                    <SelectItem key={time} value={time}>\n                      {time}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CategorySettingsSection>\n\n        {/* Scheduled Notifications */}\n        <CategorySettingsSection\n          title={t('settings.notifications.scheduled.title')}\n          description={`${t('settings.notifications.scheduled.description')} ${settings.scheduledTime}`}\n          sectionId=\"scheduled\"\n        >\n          <div className=\"space-y-6\">\n\n            {/* Daily Summary */}\n            <div className=\"flex flex-col gap-4 rounded-lg border p-4 sm:flex-row sm:items-start sm:justify-between\">\n              <div className=\"flex-1\">\n                <Label htmlFor=\"daily-summary\" className=\"text-base font-medium\">\n                  {t('settings.notifications.scheduled.dailySummary')}\n                </Label>\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  {t('settings.notifications.scheduled.dailySummaryHelp')}\n                </p>\n              </div>\n              <div className=\"flex w-full flex-col gap-3 sm:w-auto sm:flex-row sm:items-center sm:justify-end\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => testNotification('daily-summary-empty')}\n                  disabled={testingNotification === 'daily-summary-empty'}\n                  className=\"text-muted-foreground hover:text-muted-foreground/80 hover:bg-transparent p-0 h-auto font-medium text-sm\"\n                >\n                  {testingNotification === 'daily-summary-empty' ? (\n                    <>\n                      <Loader2 className=\"h-3 w-3 mr-1 animate-spin\" />\n                      {t('settings.notifications.testing')}\n                    </>\n                  ) : (\n                    t('settings.notifications.sendEmptyTest')\n                  )}\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => testNotification('daily-summary')}\n                  disabled={testingNotification === 'daily-summary'}\n                  className=\"text-primary hover:text-primary/80 hover:bg-transparent p-0 h-auto font-medium text-sm\"\n                >\n                  {testingNotification === 'daily-summary' ? (\n                    <>\n                      <Loader2 className=\"h-3 w-3 mr-1 animate-spin\" />\n                      {t('settings.notifications.testing')}\n                    </>\n                  ) : (\n                    t('settings.notifications.sendTest')\n                  )}\n                </Button>\n                <Switch\n                  id=\"daily-summary\"\n                  checked={settings.dailySummaryEnabled}\n                  onCheckedChange={(checked) => handleAutoSave('dailySummaryEnabled', checked)}\n                  disabled={autoSaveStates.dailySummaryEnabled === 'saving'}\n                  className=\"self-end sm:self-auto\"\n                />\n              </div>\n            </div>\n\n          </div>\n        </CategorySettingsSection>\n\n        {/* Immediate Notifications */}\n        <CategorySettingsSection\n          title={t('settings.notifications.immediate.title')}\n          description={t('settings.notifications.immediate.description')}\n          sectionId=\"immediate\"\n        >\n          <div className=\"space-y-6\">\n\n\n            {/* Project Milestone */}\n            <div className=\"flex flex-col gap-4 rounded-lg border p-4 sm:flex-row sm:items-start sm:justify-between\">\n              <div className=\"flex-1\">\n                <Label htmlFor=\"project-milestone\" className=\"text-base font-medium\">\n                  {t('settings.notifications.immediate.projectMilestone')}\n                </Label>\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  {t('settings.notifications.immediate.projectMilestoneHelp')}\n                </p>\n              </div>\n              <div className=\"flex w-full flex-col gap-3 sm:w-auto sm:flex-row sm:items-center sm:justify-end\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => testNotification('project-milestone')}\n                  disabled={testingNotification === 'project-milestone'}\n                  className=\"text-primary hover:text-primary/80 hover:bg-transparent p-0 h-auto font-medium text-sm\"\n                >\n                  {testingNotification === 'project-milestone' ? (\n                    <>\n                      <Loader2 className=\"h-3 w-3 mr-1 animate-spin\" />\n                      {t('settings.notifications.testing')}\n                    </>\n                  ) : (\n                    t('settings.notifications.sendTest')\n                  )}\n                </Button>\n                <Switch\n                  id=\"project-milestone\"\n                  checked={settings.projectMilestoneEnabled}\n                  onCheckedChange={(checked) => handleAutoSave('projectMilestoneEnabled', checked)}\n                  disabled={autoSaveStates.projectMilestoneEnabled === 'saving'}\n                  className=\"self-end sm:self-auto\"\n                />\n              </div>\n            </div>\n          </div>\n        </CategorySettingsSection>\n\n      </div>\n    </SettingsPageWrapper>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/Profile.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'profileSection'. Either include it or remove the dependency array.","line":113,"column":6,"nodeType":"ArrayExpression","endLine":113,"endColumn":31,"suggestions":[{"desc":"Update the dependencies array to be: [profile, profileLoading, profileSection]","fix":{"range":[4798,4823],"text":"[profile, profileLoading, profileSection]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'workingHoursSection'. Either include it or remove the dependency array.","line":122,"column":6,"nodeType":"ArrayExpression","endLine":122,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [workingHours, workingHoursSection]","fix":{"range":[5023,5037],"text":"[workingHours, workingHoursSection]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":124,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5123,5126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5123,5126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useEffect } from \"react\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useSearchParams, useNavigate } from \"react-router-dom\";\nimport SettingsPageWrapper from \"@/components/settings/SettingsPageWrapper\";\nimport { CategorySettingsSection } from \"@/components/settings/CategorySettingsSection\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { Upload, Loader2, X, User, Settings, CheckCircle } from \"lucide-react\";\nimport { useProfile } from \"@/contexts/ProfileContext\";\nimport { SettingsLoadingSkeleton } from \"@/components/ui/loading-presets\";\nimport { useWorkingHours } from \"@/hooks/useWorkingHours\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useSettingsCategorySection } from \"@/hooks/useSettingsCategorySection\";\nimport { useOrganization } from \"@/contexts/OrganizationContext\";\nimport { trimAndNormalizeSpaces, createTrimmedBlurHandler } from \"@/lib/inputUtils\";\nimport { OnboardingTutorial, TutorialStep } from \"@/components/shared/OnboardingTutorial\";\nimport { useOnboarding } from \"@/contexts/OnboardingContext\";\nimport { useTranslation } from \"react-i18next\";\n\nexport default function Profile() {\n  const [emailAddress, setEmailAddress] = useState(\"\");\n  const [isProfilePhotoModalOpen, setIsProfilePhotoModalOpen] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [searchParams] = useSearchParams();\n  const navigate = useNavigate();\n  \n  const { profile, loading: profileLoading, uploading, updateProfile, uploadProfilePhoto, deleteProfilePhoto } = useProfile();\n  const { workingHours, loading: workingHoursLoading, updateWorkingHour } = useWorkingHours();\n  const { activeOrganization } = useOrganization();\n  const { completeCurrentStep } = useOnboarding();\n  const { toast } = useToast();\n  const { t } = useTranslation(['pages', 'common']);\n\n  // Check if we're in tutorial mode\n  const isInTutorial = searchParams.get('tutorial') === 'true';\n  const stepParam = searchParams.get('step');\n  const [showTutorial, setShowTutorial] = useState(isInTutorial);\n  const [tutorialStepIndex, setTutorialStepIndex] = useState(() => {\n    if (stepParam) return parseInt(stepParam) - 1;\n    return 0;\n  });\n\n  // Profile section state\n  const profileSection = useSettingsCategorySection({\n    sectionId: \"profile\",\n    sectionName: t('settings.profile.title'),\n    initialValues: {\n      fullName: profile?.full_name || \"\",\n      phoneNumber: profile?.phone_number || \"\",\n    },\n    onSave: async (values) => {\n      const result = await updateProfile({\n        full_name: trimAndNormalizeSpaces(values.fullName),\n        phone_number: trimAndNormalizeSpaces(values.phoneNumber),\n      });\n      \n      if (!result.success) {\n        throw new Error(\"Failed to save profile\");\n      }\n    }\n  });\n\n  // Working hours section state\n  const workingHoursSection = useSettingsCategorySection({\n    sectionId: \"working-hours\",\n    sectionName: t('settings.profile.workingHours.title'),\n    initialValues: {\n      workingHours: workingHours\n    },\n    onSave: async (values) => {\n      // Working hours are saved immediately on change, so nothing to do here\n      return values;\n    }\n  });\n\n  const days = [1, 2, 3, 4, 5, 6, 0]; // Monday=1, Sunday=0\n  const dayLabels = [\n    t('settings.profile.workingHours.monday'),\n    t('settings.profile.workingHours.tuesday'),\n    t('settings.profile.workingHours.wednesday'),\n    t('settings.profile.workingHours.thursday'),\n    t('settings.profile.workingHours.friday'),\n    t('settings.profile.workingHours.saturday'),\n    t('settings.profile.workingHours.sunday')\n  ];\n\n  // Get current user info\n  const getCurrentUser = async () => {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (user?.email) setEmailAddress(user.email);\n    return user;\n  };\n\n  // Load profile data when component mounts\n  useEffect(() => {\n    getCurrentUser();\n  }, []);\n\n  // Update form fields when profile loads\n  useEffect(() => {\n    if (profile && !profileLoading) {\n      profileSection.setValues({\n        fullName: profile.full_name || \"\",\n        phoneNumber: profile.phone_number || \"\",\n      });\n    }\n  }, [profile, profileLoading]);\n\n  // Update working hours form when data loads\n  useEffect(() => {\n    if (workingHours.length > 0) {\n      workingHoursSection.setValues({\n        workingHours: workingHours\n      });\n    }\n  }, [workingHours]);\n\n  const handleWorkingHourUpdate = async (dayOfWeek: number, field: string, value: any) => {\n    const workingHour = workingHours.find(wh => wh.day_of_week === dayOfWeek);\n    if (workingHour) {\n      const result = await updateWorkingHour(dayOfWeek, { [field]: value });\n      if (result.success) {\n        toast({\n          title: t('settings.profile.toasts.success'),\n          description: t('settings.profile.toasts.workingHoursUpdated'),\n        });\n      }\n      // Mark working hours section as dirty to show save button\n      workingHoursSection.updateValue(\"workingHours\", workingHours);\n    }\n  };\n\n  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      await uploadProfilePhoto(file);\n    }\n  };\n\n  const handleDeleteProfilePhoto = async () => {\n    const result = await deleteProfilePhoto();\n    if (result.success) {\n      // The toast is handled in the hook\n    }\n  };\n\n  const getWorkingHourByDay = (dayOfWeek: number) => {\n    const workingHour = workingHours.find(wh => wh.day_of_week === dayOfWeek);\n    if (workingHour) {\n      return {\n        ...workingHour,\n        // Convert \"09:00:00\" to \"09:00\"\n        start_time: workingHour.start_time ? workingHour.start_time.substring(0, 5) : \"09:00\",\n        end_time: workingHour.end_time ? workingHour.end_time.substring(0, 5) : \"17:00\"\n      };\n    }\n    return {\n      enabled: false,\n      start_time: \"09:00\",\n      end_time: \"17:00\"\n    };\n  };\n\n  // Generate time options from 06:00 to 22:00\n  const generateTimeOptions = () => {\n    const times = [];\n    for (let hour = 6; hour <= 22; hour++) {\n      const timeString = `${hour.toString().padStart(2, '0')}:00`;\n      times.push(timeString);\n    }\n    return times;\n  };\n\n  const timeOptions = generateTimeOptions();\n\n  // Tutorial steps\n  const tutorialSteps: TutorialStep[] = [\n    {\n      id: 1,\n      title: t('settings.profile.tutorial.welcome.title'),\n      description: t('settings.profile.tutorial.welcome.description'),\n      content: (\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center gap-2 text-sm\">\n            <User className=\"h-4 w-4 text-primary\" />\n            <span>{t('settings.profile.tutorial.welcome.updateInfo')}</span>\n          </div>\n          <div className=\"flex items-center gap-2 text-sm\">\n            <Settings className=\"h-4 w-4 text-primary\" />\n            <span>{t('settings.profile.tutorial.welcome.configureHours')}</span>\n          </div>\n        </div>\n      ),\n      canProceed: true,\n      mode: 'modal'\n    },\n    {\n      id: 2,\n      title: t('settings.profile.tutorial.completeInfo.title'),\n      description: t('settings.profile.tutorial.completeInfo.description'),\n      content: (\n        <div className=\"space-y-2 text-sm text-muted-foreground\">\n          <p>{t('settings.profile.tutorial.completeInfo.fullNameRequired')}</p>\n          <p>{t('settings.profile.tutorial.completeInfo.phoneOptional')}</p>\n          <p>{t('settings.profile.tutorial.completeInfo.profilePhoto')}</p>\n        </div>\n      ),\n      canProceed: !!profileSection.values.fullName?.trim(),\n      mode: 'floating'\n    },\n    {\n      id: 3,\n      title: t('settings.profile.tutorial.businessInfo.title'),\n      description: t('settings.profile.tutorial.businessInfo.description'),\n      content: (\n        <div className=\"space-y-2 text-sm text-muted-foreground\">\n          <p>{t('settings.profile.tutorial.businessInfo.businessNameRequired')}</p>\n          <p>{t('settings.profile.tutorial.businessInfo.usedIn')}</p>\n          <p>{t('settings.profile.tutorial.businessInfo.canChange')}</p>\n        </div>\n      ),\n      route: \"/settings/general\",\n      canProceed: !!activeOrganization?.name?.trim(),\n      mode: 'floating'\n    },\n    {\n      id: 4,\n      title: t('settings.profile.tutorial.setupComplete.title'),\n      description: t('settings.profile.tutorial.setupComplete.description'),\n      content: (\n        <div className=\"flex items-center gap-2 text-green-600\">\n          <CheckCircle className=\"h-5 w-5\" />\n          <span className=\"font-medium\">{t('settings.profile.tutorial.setupComplete.success')}</span>\n        </div>\n      ),\n      canProceed: true,\n      mode: 'modal'\n    }\n  ];\n\n  const handleTutorialComplete = async () => {\n    // Profile tutorial completed, moving to general settings\n    // Navigate to General tutorial instead of completing step\n    setShowTutorial(false);\n    navigate('/settings/general?tutorial=true');\n  };\n\n  const handleTutorialExit = async () => {\n    setShowTutorial(false);\n  };\n\n  // Show loading state until all data is loaded\n  if (profileLoading || workingHoursLoading) {\n    return (\n      <SettingsPageWrapper>\n        <SettingsLoadingSkeleton rows={4} />\n      </SettingsPageWrapper>\n    );\n  }\n\n  return (\n    <SettingsPageWrapper>\n      <div className=\"space-y-8\">\n        <CategorySettingsSection\n          title={t('settings.profile.profileInfo.title')}\n          description={t('settings.profile.profileInfo.description')}\n          sectionId=\"profile\"\n          data-walkthrough=\"profile-form\"\n        >\n          <div className=\"space-y-6\">\n            {/* Avatar Upload */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"avatar-upload\">{t('settings.profile.profileInfo.profilePhoto')}</Label>\n              \n              {/* Current Photo Preview - Always show container to prevent layout shift */}\n              <div className=\"flex flex-col sm:flex-row sm:items-center gap-4 p-4 border rounded-lg bg-muted/30 max-w-md min-h-[80px]\">\n                {profile?.profile_photo_url ? (\n                  <>\n                    {/* Mobile Layout */}\n                    <div className=\"flex items-center gap-3 sm:hidden\">\n                      <div className=\"relative cursor-pointer\" onClick={() => setIsProfilePhotoModalOpen(true)}>\n                        <img \n                          src={profile.profile_photo_url} \n                          alt=\"Current profile photo - click to enlarge\" \n                          className=\"w-12 h-12 object-cover bg-white border rounded-full hover:opacity-80 transition-opacity\"\n                          title=\"Click to view full size\"\n                        />\n                      </div>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-medium\">{t('settings.profile.profileInfo.currentPhoto')}</p>\n                        <p className=\"text-xs text-muted-foreground\">{t('settings.profile.profileInfo.photoCurrentlySet')}</p>\n                      </div>\n                    </div>\n                    \n                    {/* Desktop/Tablet Layout */}\n                    <div className=\"hidden sm:flex sm:items-center sm:gap-4 sm:flex-1\">\n                      <div className=\"relative cursor-pointer\" onClick={() => setIsProfilePhotoModalOpen(true)}>\n                        <img \n                          src={profile.profile_photo_url} \n                          alt=\"Current profile photo - click to enlarge\" \n                          className=\"w-16 h-16 object-cover bg-white border rounded-full hover:opacity-80 transition-opacity\"\n                          title=\"Click to view full size\"\n                        />\n                      </div>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-medium\">{t('settings.profile.profileInfo.currentPhoto')}</p>\n                        <p className=\"text-xs text-muted-foreground\">{t('settings.profile.profileInfo.photoCurrentlySet')}</p>\n                      </div>\n                    </div>\n\n                    {/* Delete Button - Full width on mobile, inline on larger screens */}\n                    <div className=\"w-full sm:w-auto\">\n                      <AlertDialog>\n                        <AlertDialogTrigger asChild>\n                            <Button\n                              type=\"button\"\n                              variant=\"outline\"\n                              size=\"sm\"\n                              className=\"w-full sm:w-auto flex items-center justify-center gap-2 text-destructive hover:text-destructive\"\n                            >\n                              <X className=\"h-4 w-4\" />\n                              {t('common.delete')}\n                            </Button>\n                        </AlertDialogTrigger>\n                        <AlertDialogContent>\n                          <AlertDialogHeader>\n                            <AlertDialogTitle>{t('settings.profile.profileInfo.deletePhoto')}</AlertDialogTitle>\n                            <AlertDialogDescription>\n                              {t('settings.profile.profileInfo.deletePhotoConfirm')}\n                            </AlertDialogDescription>\n                          </AlertDialogHeader>\n                          <AlertDialogFooter>\n                            <AlertDialogCancel>{t('common.cancel')}</AlertDialogCancel>\n                            <AlertDialogAction\n                              onClick={handleDeleteProfilePhoto}\n                              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                            >\n                              {t('settings.profile.profileInfo.deletePhotoButton')}\n                            </AlertDialogAction>\n                          </AlertDialogFooter>\n                        </AlertDialogContent>\n                      </AlertDialog>\n                    </div>\n                  </>\n                ) : (\n                  <>\n                    {/* Mobile Layout - Placeholder */}\n                    <div className=\"flex items-center gap-3 sm:hidden\">\n                      <Avatar className=\"w-12 h-12\">\n                        <AvatarFallback className=\"bg-primary/10 text-primary font-semibold\">\n                          {profileSection.values.fullName \n                            ? profileSection.values.fullName.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase()\n                            : 'U'\n                          }\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-medium\">{t('settings.profile.profileInfo.defaultAvatar')}</p>\n                        <p className=\"text-xs text-muted-foreground\">{t('settings.profile.profileInfo.defaultAvatarHelp')}</p>\n                      </div>\n                    </div>\n                    \n                    {/* Desktop/Tablet Layout - Placeholder */}\n                    <div className=\"hidden sm:flex sm:items-center sm:gap-4 sm:flex-1\">\n                      <Avatar className=\"w-16 h-16\">\n                        <AvatarFallback className=\"bg-primary/10 text-primary font-semibold text-lg\">\n                          {profileSection.values.fullName \n                            ? profileSection.values.fullName.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase()\n                            : 'U'\n                          }\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-medium\">{t('settings.profile.profileInfo.defaultAvatar')}</p>\n                        <p className=\"text-xs text-muted-foreground\">{t('settings.profile.profileInfo.defaultAvatarLongHelp')}</p>\n                      </div>\n                    </div>\n                  </>\n                )}\n              </div>\n\n              {/* File Upload Button */}\n              <div className=\"flex flex-col gap-2\">\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleFileUpload}\n                  className=\"hidden\"\n                />\n                <Button \n                  variant=\"outline\" \n                  className=\"flex items-center gap-2 w-full sm:w-fit\"\n                  onClick={() => fileInputRef.current?.click()}\n                  disabled={uploading}\n                >\n                  {uploading ? (\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\n                  ) : (\n                    <Upload className=\"h-4 w-4\" />\n                  )}\n                  {uploading ? t('settings.profile.profileInfo.uploading') : profile?.profile_photo_url ? t('settings.profile.profileInfo.chooseNewFile') : t('settings.profile.profileInfo.chooseFile')}\n                </Button>\n              </div>\n\n              <p className=\"text-sm text-muted-foreground\">\n                {t('settings.profile.profileInfo.fileFormatsHelp')}\n              </p>\n            </div>\n\n            {/* Full Name */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"full-name\">{t('settings.profile.profileInfo.fullName')}</Label>\n              <Input\n                id=\"full-name\"\n                placeholder={t('settings.profile.profileInfo.fullNamePlaceholder')}\n                value={profileSection.values.fullName}\n                onChange={(e) => profileSection.updateValue(\"fullName\", e.target.value)}\n                onBlur={createTrimmedBlurHandler(profileSection.values.fullName, (value) => profileSection.updateValue(\"fullName\", value))}\n                className=\"max-w-md\"\n              />\n            </div>\n\n            {/* Phone Number */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"phone\">{t('settings.profile.profileInfo.phoneNumber')}</Label>\n              <Input\n                id=\"phone\"\n                type=\"tel\"\n                placeholder={t('settings.profile.profileInfo.phoneNumberPlaceholder')}\n                value={profileSection.values.phoneNumber}\n                onChange={(e) => profileSection.updateValue(\"phoneNumber\", e.target.value)}\n                onBlur={createTrimmedBlurHandler(profileSection.values.phoneNumber, (value) => profileSection.updateValue(\"phoneNumber\", value))}\n                className=\"max-w-md\"\n              />\n            </div>\n\n            {/* Email Address */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">{t('settings.profile.profileInfo.emailAddress')}</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                value={emailAddress}\n                disabled\n                className=\"max-w-md\"\n              />\n              <p className=\"text-sm text-muted-foreground\">\n                {t('settings.profile.profileInfo.emailHelp')}\n              </p>\n            </div>\n          </div>\n        </CategorySettingsSection>\n\n        <CategorySettingsSection\n          title={t('settings.profile.workingHours.title')}\n          description={t('settings.profile.workingHours.helpText')}\n          sectionId=\"working-hours\"\n        >\n          <div className=\"space-y-4\">\n            {days.map((dayOfWeek, index) => {\n              const workingHour = getWorkingHourByDay(dayOfWeek);\n              return (\n                <div key={dayOfWeek} className=\"flex flex-col sm:flex-row sm:items-center gap-4 p-4 border rounded-lg\">\n                  {/* Mobile/Tablet - keep original order */}\n                  <div className=\"flex items-center justify-between sm:hidden gap-3\">\n                    <Label className=\"font-medium text-sm\">\n                      {dayLabels[index]}\n                    </Label>\n                    <Switch\n                      checked={workingHour.enabled}\n                      onCheckedChange={(checked) => handleWorkingHourUpdate(dayOfWeek, 'enabled', checked)}\n                    />\n                  </div>\n                  \n                  {/* Desktop - LTR layout: Switch first, then day name */}\n                  <div className=\"hidden sm:flex sm:items-center sm:w-32 gap-3\">\n                    <Switch\n                      checked={workingHour.enabled}\n                      onCheckedChange={(checked) => handleWorkingHourUpdate(dayOfWeek, 'enabled', checked)}\n                    />\n                    <Label className=\"font-medium text-sm\">\n                      {dayLabels[index]}\n                    </Label>\n                  </div>\n                  \n                  {workingHour.enabled && (\n                    <div className=\"flex flex-col sm:flex-row gap-3 sm:gap-4 flex-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <Label className=\"text-sm text-muted-foreground min-w-20\">{t('labels.from', { ns: 'common' })}</Label>\n                        <Select\n                          value={workingHour.start_time} \n                          onValueChange={(value) => handleWorkingHourUpdate(dayOfWeek, 'start_time', value)}\n                        >\n                          <SelectTrigger className=\"w-28\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {timeOptions.map((time) => (\n                              <SelectItem key={time} value={time}>\n                                {time}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      \n                      <div className=\"flex items-center gap-2\">\n                        <Label className=\"text-sm text-muted-foreground min-w-20\">{t('labels.to', { ns: 'common' })}</Label>\n                        <Select\n                          value={workingHour.end_time} \n                          onValueChange={(value) => handleWorkingHourUpdate(dayOfWeek, 'end_time', value)}\n                        >\n                          <SelectTrigger className=\"w-28\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {timeOptions.map((time) => (\n                              <SelectItem key={time} value={time}>\n                                {time}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </CategorySettingsSection>\n      </div>\n\n      {/* Profile Photo Modal */}\n      <Dialog open={isProfilePhotoModalOpen} onOpenChange={setIsProfilePhotoModalOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>{t('settings.profile.profileInfo.profilePhoto')}</DialogTitle>\n          </DialogHeader>\n          <div className=\"flex justify-center\">\n            {profile?.profile_photo_url && (\n              <img \n                src={profile.profile_photo_url} \n                alt=\"Profile photo\" \n                className=\"max-w-full max-h-96 object-contain rounded-lg\"\n              />\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Onboarding Tutorial - stays visible even when navigating to other pages */}\n      {showTutorial && (\n        <OnboardingTutorial\n          steps={tutorialSteps}\n          onComplete={handleTutorialComplete}\n          onExit={handleTutorialExit}\n          isVisible={showTutorial}\n          initialStepIndex={tutorialStepIndex}\n        />\n      )}\n    </SettingsPageWrapper>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/Projects.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/Services.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/__tests__/Account_old.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/__tests__/Billing.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/__tests__/Contracts.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[472,475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[472,475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { ReactNode } from \"react\";\nimport { render, screen } from \"@/utils/testUtils\";\nimport Contracts from \"../Contracts\";\nconst mockHeader = jest.fn();\n\njest.mock(\"@/components/settings/SettingsPageWrapper\", () => ({\n  __esModule: true,\n  default: ({ children }: { children: ReactNode }) => (\n    <div data-testid=\"settings-page-wrapper\">{children}</div>\n  ),\n}));\n\njest.mock(\"@/components/settings/SettingsHeader\", () => ({\n  __esModule: true,\n  default: (props: any) => {\n    mockHeader(props);\n    return null;\n  },\n}));\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string) => key,\n  }),\n}));\n\ndescribe(\"Contracts settings page\", () => {\n  beforeEach(() => {\n    mockHeader.mockClear();\n  });\n\n  it(\"renders the contracts content\", () => {\n    render(<Contracts />);\n\n    expect(screen.getByTestId(\"settings-page-wrapper\")).toBeInTheDocument();\n    expect(screen.getByText(\"settings.contracts.comingSoon\")).toBeInTheDocument();\n  });\n\n  it(\"does not render the legacy header\", () => {\n    render(<Contracts />);\n    expect(mockHeader).not.toHaveBeenCalled();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/__tests__/DangerZone.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/__tests__/General.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":109,"column":16,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":109,"endColumn":43},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":110,"column":16,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":110,"endColumn":43},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":159,"column":16,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":159,"endColumn":43},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":161,"column":16,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":161,"endColumn":43}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { render, screen, fireEvent, waitFor } from \"@/utils/testUtils\";\nimport General from \"../General\";\nimport { useOrganizationSettings } from \"@/hooks/useOrganizationSettings\";\nimport { useSettingsCategorySection } from \"@/hooks/useSettingsCategorySection\";\n\njest.mock(\"@/components/settings/SettingsPageWrapper\", () => ({\n  __esModule: true,\n  default: ({ children }: { children: React.ReactNode }) => (\n    <div data-testid=\"settings-page-wrapper\">{children}</div>\n  ),\n}));\n\njest.mock(\"@/components/settings/SettingsHeader\", () => ({\n  __esModule: true,\n  default: () => null,\n}));\n\njest.mock(\"@/components/settings/CategorySettingsSection\", () => ({\n  CategorySettingsSection: ({ title, children }: { title: string; children: React.ReactNode }) => (\n    <section data-testid={`settings-section-${title}`}>\n      <h2>{title}</h2>\n      {children}\n    </section>\n  ),\n}));\n\njest.mock(\"@/components/LanguageSwitcher\", () => ({\n  __esModule: true,\n  LanguageSwitcher: () => <div data-testid=\"language-switcher\" />,\n}));\n\njest.mock(\"@/components/TimezoneSelector\", () => ({\n  TimezoneSelector: ({ value, onValueChange }: { value: string; onValueChange: (val: string) => void }) => (\n    <select\n      data-testid=\"timezone-selector\"\n      value={value}\n      onChange={(event) => onValueChange(event.target.value)}\n    >\n      <option value=\"UTC\">UTC</option>\n      <option value=\"Europe/Istanbul\">Europe/Istanbul</option>\n    </select>\n  ),\n}));\n\nconst mockCompleteStep = jest.fn();\n\njest.mock(\"@/components/shared/OnboardingTutorial\", () => ({\n  OnboardingTutorial: ({ onComplete, onExit }: { onComplete: () => void; onExit: () => void }) => (\n    <div data-testid=\"onboarding-tutorial\">\n      <button type=\"button\" onClick={onComplete}>\n        complete tutorial\n      </button>\n      <button type=\"button\" onClick={onExit}>\n        exit tutorial\n      </button>\n    </div>\n  ),\n}));\n\njest.mock(\"@/components/ui/loading-presets\", () => ({\n  SettingsLoadingSkeleton: ({ rows }: { rows: number }) => (\n    <div data-testid=\"settings-loading-skeleton\">loading {rows}</div>\n  ),\n}));\n\njest.mock(\"@/hooks/useOrganizationSettings\");\njest.mock(\"@/hooks/useSettingsCategorySection\");\njest.mock(\"@/contexts/OnboardingContext\", () => ({\n  useOnboarding: jest.fn(() => ({\n    completeCurrentStep: mockCompleteStep,\n  })),\n}));\n\njest.mock(\"@/lib/dateFormatUtils\", () => ({\n  detectBrowserTimezone: () => \"UTC\",\n}));\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string) => key,\n  }),\n}));\n\nconst mockUseOrganizationSettings = useOrganizationSettings as jest.MockedFunction<typeof useOrganizationSettings>;\nconst mockUseSettingsCategorySection = useSettingsCategorySection as jest.MockedFunction<typeof useSettingsCategorySection>;\n\nconst createSectionMock = () => ({\n  values: {\n    companyName: \"\",\n    businessEmail: \"\",\n    businessPhone: \"\",\n    brandColor: \"#1EB29F\",\n    dateFormat: \"DD/MM/YYYY\",\n    timeFormat: \"12-hour\",\n    timezone: \"UTC\",\n  },\n  setValues: jest.fn(),\n  updateValue: jest.fn(),\n  handleSave: jest.fn(),\n  handleCancel: jest.fn(),\n  isDirty: false,\n});\n\nconst renderGeneral = () => render(<General />);\n\ndescribe(\"General settings page\", () => {\n  beforeEach(() => {\n    jest.spyOn(require(\"react-router-dom\"), \"useSearchParams\").mockReturnValue([new URLSearchParams(), jest.fn()]);\n    jest.spyOn(require(\"react-router-dom\"), \"useNavigate\").mockReturnValue(jest.fn());\n\n    const brandingSectionMock = createSectionMock();\n    const regionalSectionMock = createSectionMock();\n\n    mockUseSettingsCategorySection.mockImplementation(({ sectionId }) =>\n      sectionId === \"branding\" ? brandingSectionMock : regionalSectionMock\n    );\n\n    mockUseOrganizationSettings.mockReturnValue({\n      settings: {\n        photography_business_name: \"Studio\",\n        email: \"studio@example.com\",\n        phone: \"+123456789\",\n        primary_brand_color: \"#ff0000\",\n        date_format: \"MM/DD/YYYY\",\n        time_format: \"24-hour\",\n        timezone: \"Europe/Istanbul\",\n        logo_url: null,\n      },\n      loading: false,\n      uploading: false,\n      updateSettings: jest.fn().mockResolvedValue({ success: true }),\n      uploadLogo: jest.fn(),\n      deleteLogo: jest.fn(),\n    });\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n    jest.restoreAllMocks();\n  });\n\n  it(\"renders a loading skeleton when data is loading\", () => {\n    mockUseOrganizationSettings.mockReturnValueOnce({\n      settings: null,\n      loading: true,\n      uploading: false,\n      updateSettings: jest.fn(),\n      uploadLogo: jest.fn(),\n      deleteLogo: jest.fn(),\n    });\n\n    renderGeneral();\n\n    expect(screen.getByTestId(\"settings-loading-skeleton\")).toBeInTheDocument();\n  });\n\n  it(\"starts the onboarding tutorial when the tutorial query parameter is present\", async () => {\n    jest.spyOn(require(\"react-router-dom\"), \"useSearchParams\").mockReturnValue([new URLSearchParams(\"tutorial=true\"), jest.fn()]);\n    const mockNavigate = jest.fn();\n    jest.spyOn(require(\"react-router-dom\"), \"useNavigate\").mockReturnValue(mockNavigate);\n\n    renderGeneral();\n\n    fireEvent.click(screen.getByText(\"complete tutorial\"));\n\n    await waitFor(() => {\n      expect(mockCompleteStep).toHaveBeenCalled();\n      expect(mockNavigate).toHaveBeenCalledWith(\"/getting-started\");\n    });\n  });\n\n  it(\"preloads settings into section state when data is available\", () => {\n    const brandingSectionMock = createSectionMock();\n    const regionalSectionMock = createSectionMock();\n\n    mockUseSettingsCategorySection.mockImplementation(({ sectionId }) =>\n      sectionId === \"branding\" ? brandingSectionMock : regionalSectionMock\n    );\n\n    renderGeneral();\n\n    expect(brandingSectionMock.setValues).toHaveBeenCalledWith({\n      companyName: \"Studio\",\n      businessEmail: \"studio@example.com\",\n      businessPhone: \"+123456789\",\n      brandColor: \"#ff0000\",\n    });\n\n    expect(regionalSectionMock.setValues).toHaveBeenCalledWith({\n      dateFormat: \"MM/DD/YYYY\",\n      timeFormat: \"24-hour\",\n      timezone: \"Europe/Istanbul\",\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/__tests__/Leads.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[464,467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[464,467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { ReactNode } from \"react\";\nimport { render, screen } from \"@/utils/testUtils\";\nimport Leads from \"../Leads\";\nconst mockHeader = jest.fn();\n\njest.mock(\"@/components/settings/SettingsPageWrapper\", () => ({\n  __esModule: true,\n  default: ({ children }: { children: ReactNode }) => (\n    <div data-testid=\"settings-page-wrapper\">{children}</div>\n  ),\n}));\n\njest.mock(\"@/components/settings/SettingsHeader\", () => ({\n  __esModule: true,\n  default: (props: any) => {\n    mockHeader(props);\n    return null;\n  },\n}));\n\njest.mock(\"@/components/LeadStatusesSection\", () => ({\n  __esModule: true,\n  default: () => <section data-testid=\"lead-statuses-section\">lead statuses</section>,\n}));\n\njest.mock(\"@/components/LeadFieldsSection\", () => ({\n  __esModule: true,\n  LeadFieldsSection: () => <section data-testid=\"lead-fields-section\">lead fields</section>,\n}));\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string) => key,\n  }),\n}));\n\ndescribe(\"Leads settings page\", () => {\n  beforeEach(() => {\n    mockHeader.mockClear();\n  });\n\n  it(\"renders both lead settings sections\", () => {\n    render(<Leads />);\n\n    expect(screen.getByTestId(\"lead-statuses-section\")).toBeInTheDocument();\n    expect(screen.getByTestId(\"lead-fields-section\")).toBeInTheDocument();\n  });\n\n  it(\"does not render the legacy header\", () => {\n    render(<Leads />);\n    expect(mockHeader).not.toHaveBeenCalled();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/__tests__/Notifications.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/__tests__/Profile.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/__tests__/Projects.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[356,359],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[356,359],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { render, screen } from \"@/utils/testUtils\";\nimport Projects from \"../Projects\";\nconst mockSettingsHeader = jest.fn();\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string) => key,\n  }),\n}));\n\njest.mock(\"@/components/settings/SettingsHeader\", () => ({\n  __esModule: true,\n  default: (props: any) => {\n    mockSettingsHeader(props);\n    return null;\n  },\n}));\n\njest.mock(\"@/components/settings/SettingsPageWrapper\", () => ({\n  __esModule: true,\n  default: ({ children }: { children: React.ReactNode }) => (\n    <div data-testid=\"settings-page-wrapper\">{children}</div>\n  ),\n}));\n\njest.mock(\"@/components/ProjectStatusesSection\", () => ({\n  __esModule: true,\n  default: () => <div data-testid=\"project-statuses-section\" />,\n}));\n\njest.mock(\"@/components/ProjectTypesSection\", () => ({\n  __esModule: true,\n  default: () => <div data-testid=\"project-types-section\" />,\n}));\n\njest.mock(\"@/components/SessionStatusesSection\", () => ({\n  __esModule: true,\n  default: () => <div data-testid=\"session-statuses-section\" />,\n}));\n\ndescribe(\"Projects settings page\", () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  it(\"renders all project-related settings sections\", () => {\n    render(<Projects />);\n\n    expect(screen.getByTestId(\"settings-page-wrapper\")).toBeInTheDocument();\n    expect(screen.getByTestId(\"project-statuses-section\")).toBeInTheDocument();\n    expect(screen.getByTestId(\"project-types-section\")).toBeInTheDocument();\n    expect(screen.getByTestId(\"session-statuses-section\")).toBeInTheDocument();\n\n    expect(mockSettingsHeader).not.toHaveBeenCalled();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/pages/settings/__tests__/Services.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[676,679],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[676,679],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1453,1456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1453,1456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1860,1863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1860,1863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { act, fireEvent, render, screen, waitFor } from \"@/utils/testUtils\";\nimport Services from \"../Services\";\nconst mockSettingsHeader = jest.fn();\nconst mockUseOnboarding = jest.fn();\nconst mockNavigate = jest.fn();\n\njest.mock(\"react-i18next\", () => ({\n  useTranslation: () => ({\n    t: (key: string) => key,\n  }),\n}));\n\njest.mock(\"@/contexts/OnboardingContext\", () => ({\n  useOnboarding: () => mockUseOnboarding(),\n}));\n\njest.mock(\"react-router-dom\", () => ({\n  ...jest.requireActual(\"react-router-dom\"),\n  useNavigate: () => mockNavigate,\n}));\n\njest.mock(\"@/components/settings/SettingsHeader\", () => ({\n  __esModule: true,\n  default: (props: any) => {\n    mockSettingsHeader(props);\n    return null;\n  },\n}));\n\njest.mock(\"@/components/settings/SettingsPageWrapper\", () => ({\n  __esModule: true,\n  default: ({ children }: { children: React.ReactNode }) => (\n    <div data-testid=\"settings-page-wrapper\">{children}</div>\n  ),\n}));\n\njest.mock(\"@/components/SessionTypesSection\", () => ({\n  __esModule: true,\n  default: () => <div data-testid=\"session-types-section\" />,\n}));\n\njest.mock(\"@/components/PackagesSection\", () => ({\n  __esModule: true,\n  default: () => <div data-testid=\"packages-section\" />,\n}));\n\njest.mock(\"@/components/ServicesSection\", () => ({\n  __esModule: true,\n  default: () => <div data-testid=\"services-section\" />,\n}));\n\nconst mockOnboardingTutorial = jest.fn(\n  ({ isVisible, onComplete, onExit }: any) => (\n    <div data-testid=\"onboarding-tutorial\" data-visible={isVisible}>\n      <button type=\"button\" data-testid=\"complete-tutorial\" onClick={onComplete}>\n        complete\n      </button>\n      <button type=\"button\" data-testid=\"exit-tutorial\" onClick={onExit}>\n        exit\n      </button>\n    </div>\n  )\n);\n\njest.mock(\"@/components/shared/OnboardingTutorial\", () => ({\n  OnboardingTutorial: (props: any) => mockOnboardingTutorial(props),\n}));\n\ndescribe(\"Services settings page\", () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockUseOnboarding.mockReturnValue({\n      currentStep: 6,\n      completeCurrentStep: jest.fn().mockResolvedValue(undefined),\n    });\n  });\n\n  afterEach(() => {\n    jest.useRealTimers();\n  });\n\n  it(\"shows all service management sections and starts the tutorial when on step six\", () => {\n    render(<Services />);\n\n    expect(screen.getByTestId(\"settings-page-wrapper\")).toBeInTheDocument();\n    expect(screen.getByTestId(\"session-types-section\")).toBeInTheDocument();\n    expect(screen.getByTestId(\"packages-section\")).toBeInTheDocument();\n    expect(screen.getByTestId(\"services-section\")).toBeInTheDocument();\n\n    expect(mockSettingsHeader).not.toHaveBeenCalled();\n\n    expect(mockOnboardingTutorial).toHaveBeenCalledWith(\n      expect.objectContaining({ isVisible: true }),\n    );\n    expect(screen.getByTestId(\"onboarding-tutorial\")).toHaveAttribute(\n      \"data-visible\",\n      \"true\"\n    );\n  });\n\n  it(\"completes the tutorial and navigates to getting started\", async () => {\n    jest.useFakeTimers({ doNotFake: [\"performance\"] });\n    const completeCurrentStep = jest\n      .fn()\n      .mockResolvedValue(undefined);\n\n    mockUseOnboarding.mockReturnValue({\n      currentStep: 6,\n      completeCurrentStep,\n    });\n\n    render(<Services />);\n\n    await act(async () => {\n      fireEvent.click(screen.getByTestId(\"complete-tutorial\"));\n    });\n\n    await waitFor(() => expect(completeCurrentStep).toHaveBeenCalled());\n\n    expect(mockOnboardingTutorial).toHaveBeenCalledWith(\n      expect.objectContaining({ isVisible: false })\n    );\n\n    await act(async () => {\n      jest.advanceTimersByTime(500);\n    });\n\n    expect(mockNavigate).toHaveBeenCalledWith(\"/getting-started\");\n  });\n\n  it(\"hides the tutorial without completing when exiting\", async () => {\n    const completeCurrentStep = jest\n      .fn()\n      .mockResolvedValue(undefined);\n\n    mockUseOnboarding.mockReturnValue({\n      currentStep: 6,\n      completeCurrentStep,\n    });\n\n    render(<Services />);\n\n    await act(async () => {\n      fireEvent.click(screen.getByTestId(\"exit-tutorial\"));\n    });\n\n    await waitFor(() =>\n      expect(mockOnboardingTutorial).toHaveBeenCalledWith(\n        expect.objectContaining({ isVisible: false })\n      )\n    );\n    expect(completeCurrentStep).not.toHaveBeenCalled();\n    expect(mockNavigate).not.toHaveBeenCalled();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/services/BaseEntityService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/services/LeadDetailService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/services/LeadService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4016,4019],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4016,4019],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4057,4060],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4057,4060],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from '@/integrations/supabase/client';\nimport { BaseEntityService } from './BaseEntityService';\n\nexport interface LeadWithCustomFields {\n  id: string;\n  name: string;\n  email: string;\n  phone: string;\n  status: string;\n  status_id: string;\n  updated_at: string;\n  created_at: string;\n  due_date?: string;\n  notes?: string;\n  custom_fields: Record<string, string | null>;\n  lead_statuses?: {\n    id: string;\n    name: string;\n    color: string;\n    is_system_final: boolean;\n  };\n}\n\nexport interface CreateLeadData {\n  name: string;\n  email?: string;\n  phone?: string;\n  notes?: string;\n  status_id?: string;\n  due_date?: string;\n  custom_fields?: Record<string, string | null>;\n}\n\nexport interface UpdateLeadData {\n  name?: string;\n  email?: string;\n  phone?: string;\n  notes?: string;\n  status_id?: string;\n  due_date?: string;\n}\n\nexport interface LeadFilters {\n  status?: string;\n  statusId?: string;\n  search?: string;\n  dueDateFrom?: string;\n  dueDateTo?: string;\n}\n\nexport interface LeadSort {\n  field: 'name' | 'email' | 'phone' | 'status' | 'due_date' | 'created_at' | 'updated_at';\n  direction: 'asc' | 'desc';\n}\n\n/**\n * Service for lead-related operations\n */\nexport class LeadService extends BaseEntityService {\n  constructor() {\n    super();\n  }\n\n  /**\n   * Fetch leads with custom fields and status information\n   */\n  async fetchLeadsWithCustomFields(): Promise<LeadWithCustomFields[]> {\n    const organizationId = await this.getOrganizationId();\n    if (!organizationId) return [];\n\n    // Fetch leads with status information\n    const { data: leadsData, error: leadsError } = await supabase\n      .from('leads')\n      .select(`\n        *,\n        lead_statuses(id, name, color, is_system_final)\n      `)\n      .eq('organization_id', organizationId)\n      .order('updated_at', { ascending: false });\n\n    if (leadsError) throw leadsError;\n\n    // Fetch all custom field values for these leads\n    const leadIds = leadsData?.map(lead => lead.id) || [];\n    if (leadIds.length === 0) return [];\n\n    const { data: fieldValues, error: fieldValuesError } = await supabase\n      .from('lead_field_values')\n      .select('lead_id, field_key, value')\n      .in('lead_id', leadIds);\n\n    if (fieldValuesError) throw fieldValuesError;\n\n    // Group field values by lead_id\n    const fieldValuesByLead = (fieldValues || []).reduce((acc, fv) => {\n      if (!acc[fv.lead_id]) {\n        acc[fv.lead_id] = {};\n      }\n      acc[fv.lead_id][fv.field_key] = fv.value;\n      return acc;\n    }, {} as Record<string, Record<string, string | null>>);\n\n  // Combine leads with their custom field values\n  return (leadsData || []).map(lead => ({\n    ...lead,\n    custom_fields: fieldValuesByLead[lead.id] || {},\n  }));\n}\n\n  /**\n   * Fetch filtered and sorted leads\n   */\n  async fetchLeads(filters?: LeadFilters, sort?: LeadSort): Promise<LeadWithCustomFields[]> {\n    let leads = await this.fetchLeadsWithCustomFields();\n\n    // Apply filters\n    if (filters) {\n      if (filters.status && filters.status !== 'all') {\n        leads = leads.filter(lead => lead.lead_statuses?.name === filters.status);\n      }\n      if (filters.statusId) {\n        leads = leads.filter(lead => lead.status_id === filters.statusId);\n      }\n      if (filters.search) {\n        const searchLower = filters.search.toLowerCase();\n        leads = leads.filter(lead => \n          lead.name.toLowerCase().includes(searchLower) ||\n          lead.email?.toLowerCase().includes(searchLower) ||\n          lead.phone?.toLowerCase().includes(searchLower) ||\n          lead.notes?.toLowerCase().includes(searchLower)\n        );\n      }\n      if (filters.dueDateFrom) {\n        leads = leads.filter(lead => \n          lead.due_date && lead.due_date >= filters.dueDateFrom!\n        );\n      }\n      if (filters.dueDateTo) {\n        leads = leads.filter(lead => \n          lead.due_date && lead.due_date <= filters.dueDateTo!\n        );\n      }\n    }\n\n    // Apply sorting\n    if (sort) {\n      leads.sort((a, b) => {\n        let aValue: any = a[sort.field];\n        let bValue: any = b[sort.field];\n\n        // Handle special cases\n        if (sort.field === 'status') {\n          aValue = a.lead_statuses?.name || '';\n          bValue = b.lead_statuses?.name || '';\n        }\n\n        if (typeof aValue === 'string' && typeof bValue === 'string') {\n          aValue = aValue.toLowerCase();\n          bValue = bValue.toLowerCase();\n        }\n\n        if (sort.field === 'created_at' || sort.field === 'updated_at' || sort.field === 'due_date') {\n          aValue = aValue ? new Date(aValue).getTime() : 0;\n          bValue = bValue ? new Date(bValue).getTime() : 0;\n        }\n\n        if (aValue < bValue) return sort.direction === 'asc' ? -1 : 1;\n        if (aValue > bValue) return sort.direction === 'asc' ? 1 : -1;\n        return 0;\n      });\n    }\n\n    return leads;\n  }\n\n  /**\n   * Create a new lead\n   */\n  async createLead(data: CreateLeadData): Promise<LeadWithCustomFields> {\n    const organizationId = await this.getOrganizationId();\n    if (!organizationId) throw new Error('No organization ID found');\n\n    const user = await this.getAuthenticatedUser();\n\n    // Create the lead first\n    const { data: leadData, error } = await supabase\n      .from('leads')\n      .insert({\n        name: data.name,\n        email: data.email,\n        phone: data.phone,\n        notes: data.notes,\n        status_id: data.status_id,\n        due_date: data.due_date,\n        organization_id: organizationId,\n        user_id: user.id,\n      })\n      .select()\n      .single();\n\n    if (error || !leadData) throw new Error('Failed to create lead');\n\n    // Handle custom fields if provided\n    if (data.custom_fields) {\n      const fieldValues = Object.entries(data.custom_fields)\n        .filter(([_, value]) => value !== null && value !== undefined && value !== '')\n        .map(([field_key, value]) => ({\n          lead_id: leadData.id,\n          field_key,\n          value,\n        }));\n\n      if (fieldValues.length > 0) {\n        const { error } = await supabase\n          .from('lead_field_values')\n          .insert(fieldValues);\n\n        if (error) throw error;\n      }\n    }\n\n    // Return the created lead with custom fields\n    const leads = await this.fetchLeadsWithCustomFields();\n    const createdLead = leads.find(lead => lead.id === leadData.id);\n    if (!createdLead) throw new Error('Failed to fetch created lead');\n    return createdLead;\n  }\n\n  /**\n   * Update an existing lead\n   */\n  async updateLead(id: string, data: UpdateLeadData): Promise<LeadWithCustomFields | null> {\n    const { data: result, error } = await supabase\n      .from('leads')\n      .update(data)\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error || !result) return null;\n\n    // Fetch and return updated lead with custom fields\n    const leads = await this.fetchLeadsWithCustomFields();\n    return leads.find(lead => lead.id === id) || null;\n  }\n\n  /**\n   * Delete a lead\n   */\n  async deleteLead(id: string): Promise<boolean> {\n    const { error } = await supabase\n      .from('leads')\n      .delete()\n      .eq('id', id);\n\n    if (error) throw error;\n    return true;\n  }\n\n  /**\n   * Update custom field value for a lead\n   */\n  async updateCustomField(leadId: string, fieldKey: string, value: string | null): Promise<void> {\n    const { error } = await supabase\n      .from('lead_field_values')\n      .upsert(\n        { lead_id: leadId, field_key: fieldKey, value },\n        { onConflict: 'lead_id,field_key' }\n      );\n\n    if (error) throw error;\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/services/ProjectService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/services/SessionService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":204,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5879,5882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5879,5882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":205,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5920,5923],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5920,5923],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from '@/integrations/supabase/client';\nimport { BaseEntityService } from './BaseEntityService';\n\nexport interface Session {\n  id: string;\n  lead_id: string;\n  session_date: string;\n  session_time: string;\n  notes: string;\n  status: string;\n  created_at: string;\n  project_id?: string | null;\n  session_name?: string | null;\n  location?: string | null;\n  google_event_id?: string | null;\n  organization_id: string;\n  user_id: string;\n  project_name?: string;\n  lead_name?: string;\n  lead_status?: string;\n  lead?: {\n    id: string;\n    name: string;\n    status: string;\n    email?: string;\n    phone?: string;\n  };\n  project?: {\n    id: string;\n    name: string;\n    status_id?: string;\n  };\n}\n\nexport interface CreateSessionData {\n  lead_id: string;\n  session_date: string;\n  session_time: string;\n  notes?: string;\n  status?: string;\n  project_id?: string;\n  session_name?: string;\n  location?: string;\n}\n\nexport interface UpdateSessionData {\n  session_date?: string;\n  session_time?: string;\n  notes?: string;\n  status?: string;\n  project_id?: string;\n  session_name?: string;\n  location?: string;\n}\n\nexport interface SessionFilters {\n  status?: string;\n  dateRange?: {\n    start: Date;\n    end: Date;\n  };\n  leadId?: string;\n  projectId?: string;\n  search?: string;\n}\n\nexport interface SessionSort {\n  field: 'session_date' | 'session_time' | 'status' | 'lead_name' | 'created_at';\n  direction: 'asc' | 'desc';\n}\n\n/**\n * Service for session-related operations\n */\nexport class SessionService extends BaseEntityService {\n  constructor() {\n    super();\n  }\n\n  /**\n   * Fetch sessions with all related data\n   */\n  async fetchSessions(): Promise<Session[]> {\n    const organizationId = await this.getOrganizationId();\n    if (!organizationId) return [];\n\n    // Get sessions with proper validation using inner joins\n    const { data: sessionsData, error: sessionsError } = await supabase\n      .from('sessions')\n      .select(`\n        *,\n        leads!inner(id, name, status, email, phone),\n        projects(id, name, status_id)\n      `)\n      .eq('organization_id', organizationId)\n      .order('session_date', { ascending: false })\n      .order('session_time', { ascending: false });\n\n    if (sessionsError) throw sessionsError;\n\n    // Filter out sessions with invalid references or archived projects\n    const { data: userData } = await supabase.auth.getUser();\n    const userId = userData.user?.id;\n    let filteredSessions = sessionsData || [];\n    \n    if (userId && organizationId) {\n      // Get archived status for filtering\n      const { data: archivedStatus } = await supabase\n        .from('project_statuses')\n        .select('id, name')\n        .eq('organization_id', organizationId)\n        .ilike('name', 'archived')\n        .maybeSingle();\n        \n      filteredSessions = filteredSessions.filter(session => {\n        // Must have valid lead (inner join ensures this)\n        if (!session.leads) return false;\n        \n        // If session has a project, check if it's archived\n        if (session.project_id && session.projects) {\n          if (archivedStatus?.id && session.projects.status_id === archivedStatus.id) {\n            return false;\n          }\n        }\n        \n        return true;\n      });\n    }\n\n    // Process sessions with enhanced data validation\n    return filteredSessions.map(session => ({\n      ...session,\n      lead_name: session.leads?.name || 'Unknown Lead',\n      lead_status: session.leads?.status || 'unknown',\n      project_name: session.projects?.name || undefined,\n      lead: session.leads,\n      project: session.projects\n    }));\n  }\n\n  /**\n   * Fetch filtered and sorted sessions\n   */\n  async fetchFilteredSessions(\n    filters?: SessionFilters,\n    sort?: SessionSort\n  ): Promise<Session[]> {\n    let sessions = await this.fetchSessions();\n\n    // Apply filters\n    if (filters) {\n      if (filters.status && filters.status !== 'all') {\n        sessions = sessions.filter(session => session.status === filters.status);\n      }\n      \n      if (filters.dateRange) {\n        sessions = sessions.filter(session => {\n          const sessionDate = new Date(session.session_date);\n          return sessionDate >= filters.dateRange!.start && \n                 sessionDate < filters.dateRange!.end;\n        });\n      }\n      \n      if (filters.leadId) {\n        sessions = sessions.filter(session => session.lead_id === filters.leadId);\n      }\n      \n      if (filters.projectId) {\n        sessions = sessions.filter(session => session.project_id === filters.projectId);\n      }\n      \n      if (filters.search) {\n        const searchLower = filters.search.toLowerCase();\n        sessions = sessions.filter(session => \n          session.lead_name?.toLowerCase().includes(searchLower) ||\n          session.project_name?.toLowerCase().includes(searchLower) ||\n          session.notes?.toLowerCase().includes(searchLower) ||\n          session.location?.toLowerCase().includes(searchLower) ||\n          session.session_name?.toLowerCase().includes(searchLower)\n        );\n      }\n    }\n\n    // Apply sorting\n    if (sort) {\n      sessions.sort((a, b) => {\n        // For date sorting, always add secondary sort by time\n        if (sort.field === 'session_date') {\n          const aDate = a.session_date ? new Date(a.session_date).getTime() : 0;\n          const bDate = b.session_date ? new Date(b.session_date).getTime() : 0;\n          \n          // First compare dates\n          if (aDate !== bDate) {\n            return sort.direction === 'asc' ? aDate - bDate : bDate - aDate;\n          }\n          \n          // If dates are equal, sort by time (always ascending for better UX)\n          const aTime = a.session_time || '';\n          const bTime = b.session_time || '';\n          return aTime.localeCompare(bTime);\n        }\n        \n        // For other fields, use regular sorting\n        let aValue: any = a[sort.field];\n        let bValue: any = b[sort.field];\n\n        // Handle date values\n        if (sort.field === 'created_at') {\n          aValue = aValue ? new Date(aValue).getTime() : 0;\n          bValue = bValue ? new Date(bValue).getTime() : 0;\n        }\n\n        // Handle time values\n        if (sort.field === 'session_time') {\n          aValue = aValue ? aValue : '';\n          bValue = bValue ? bValue : '';\n        }\n\n        // Handle string values\n        if (typeof aValue === 'string' && typeof bValue === 'string') {\n          aValue = aValue.toLowerCase();\n          bValue = bValue.toLowerCase();\n        }\n\n        if (aValue < bValue) return sort.direction === 'asc' ? -1 : 1;\n        if (aValue > bValue) return sort.direction === 'asc' ? 1 : -1;\n        return 0;\n      });\n    }\n\n    return sessions;\n  }\n\n  /**\n   * Create a new session\n   */\n  async createSession(data: CreateSessionData): Promise<Session> {\n    const organizationId = await this.getOrganizationId();\n    if (!organizationId) throw new Error('No organization ID found');\n\n    const user = await this.getAuthenticatedUser();\n\n    const { data: sessionData, error } = await supabase\n      .from('sessions')\n      .insert({\n        ...data,\n        organization_id: organizationId,\n        user_id: user.id,\n      })\n      .select()\n      .single();\n\n    if (error || !sessionData) throw new Error('Failed to create session');\n\n    // Fetch and return the created session with all related data\n    const sessions = await this.fetchSessions();\n    const createdSession = sessions.find(s => s.id === sessionData.id);\n    if (!createdSession) throw new Error('Failed to fetch created session');\n    \n    return createdSession;\n  }\n\n  /**\n   * Update an existing session\n   */\n  async updateSession(id: string, data: UpdateSessionData): Promise<Session | null> {\n    const { data: result, error } = await supabase\n      .from('sessions')\n      .update(data)\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error || !result) return null;\n\n    // Fetch and return updated session with all related data\n    const sessions = await this.fetchSessions();\n    return sessions.find(session => session.id === id) || null;\n  }\n\n  /**\n   * Delete a session\n   */\n  async deleteSession(id: string): Promise<boolean> {\n    const { error } = await supabase\n      .from('sessions')\n      .delete()\n      .eq('id', id);\n\n    if (error) throw error;\n    return true;\n  }\n\n  /**\n   * Get sessions by date range\n   */\n  async getSessionsByDateRange(startDate: Date, endDate: Date): Promise<Session[]> {\n    return this.fetchFilteredSessions({\n      dateRange: { start: startDate, end: endDate }\n    });\n  }\n\n  /**\n   * Get upcoming sessions\n   */\n  async getUpcomingSessions(daysAhead: number = 30): Promise<Session[]> {\n    const today = new Date();\n    const futureDate = new Date(today.getTime() + (daysAhead * 24 * 60 * 60 * 1000));\n    \n    return this.fetchFilteredSessions({\n      dateRange: { start: today, end: futureDate }\n    }, {\n      field: 'session_date',\n      direction: 'asc'\n    });\n  }\n\n  /**\n   * Get sessions for a specific lead\n   */\n  async getSessionsForLead(leadId: string): Promise<Session[]> {\n    return this.fetchFilteredSessions({ leadId });\n  }\n\n  /**\n   * Get sessions for a specific project\n   */\n  async getSessionsForProject(projectId: string): Promise<Session[]> {\n    return this.fetchFilteredSessions({ projectId });\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/services/__tests__/BaseEntityService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/services/__tests__/LeadDetailService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/services/__tests__/LeadService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1723,1726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1723,1726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2138,2141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2138,2141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3119,3122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3119,3122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { LeadService } from \"../LeadService\";\n\nconst supabaseFromMock = jest.fn();\nconst supabaseAuthGetUserMock = jest.fn();\n\njest.mock(\"@/integrations/supabase/client\", () => ({\n  supabase: {\n    from: (...args: unknown[]) => supabaseFromMock(...args),\n    auth: {\n      getUser: (...args: unknown[]) => supabaseAuthGetUserMock(...args),\n    },\n  },\n}));\n\nbeforeEach(() => {\n  supabaseFromMock.mockReset();\n  supabaseAuthGetUserMock.mockReset();\n});\n\ndescribe(\"LeadService.fetchLeadsWithCustomFields\", () => {\n  it(\"returns leads merged with custom fields\", async () => {\n    const leadsData = {\n      data: [\n        {\n          id: \"lead-1\",\n          name: \"Alice\",\n          email: \"a@example.com\",\n          phone: \"123\",\n          status: \"active\",\n          status_id: \"status-1\",\n          organization_id: \"org-1\",\n          lead_statuses: { id: \"status-1\", name: \"New\", color: \"blue\", is_system_final: false },\n        },\n      ],\n      error: null,\n    };\n\n    const fieldValues = {\n      data: [\n        { lead_id: \"lead-1\", field_key: \"source\", value: \"Instagram\" },\n      ],\n      error: null,\n    };\n\n    supabaseFromMock.mockImplementation((table: string) => {\n      switch (table) {\n        case \"leads\":\n          return {\n            select: jest.fn(() => ({\n              eq: jest.fn(() => ({\n                order: jest.fn(() => Promise.resolve(leadsData)),\n              })),\n            })),\n          };\n        case \"lead_field_values\":\n          return {\n            select: jest.fn(() => ({\n              in: jest.fn(() => Promise.resolve(fieldValues)),\n            })),\n          };\n        default:\n          return {};\n      }\n    });\n\n    const service = new LeadService();\n    (service as any).getOrganizationId = jest.fn().mockResolvedValue(\"org-1\");\n\n    const leads = await service.fetchLeadsWithCustomFields();\n\n    expect(leads).toHaveLength(1);\n    expect(leads[0].custom_fields).toEqual({ source: \"Instagram\" });\n    expect(leads[0].lead_statuses?.name).toBe(\"New\");\n  });\n\n  it(\"returns empty array when organization missing\", async () => {\n    const service = new LeadService();\n    (service as any).getOrganizationId = jest.fn().mockResolvedValue(null);\n\n    const leads = await service.fetchLeadsWithCustomFields();\n    expect(leads).toEqual([]);\n    expect(supabaseFromMock).not.toHaveBeenCalled();\n  });\n});\n\ndescribe(\"LeadService.fetchLeads\", () => {\n  it(\"applies filters and sorting\", async () => {\n    const service = new LeadService();\n    jest.spyOn(service, \"fetchLeadsWithCustomFields\").mockResolvedValue([\n      {\n        id: \"lead-1\",\n        name: \"Alice\",\n        email: \"alice@example.com\",\n        phone: \"123\",\n        status: \"active\",\n        status_id: \"status-1\",\n        due_date: \"2024-05-10\",\n        lead_statuses: { name: \"Open\" },\n        notes: \"VIP\",\n      },\n      {\n        id: \"lead-2\",\n        name: \"Bob\",\n        email: \"bob@example.com\",\n        phone: \"456\",\n        status: \"active\",\n        status_id: \"status-2\",\n        due_date: \"2024-05-12\",\n        lead_statuses: { name: \"Closed\" },\n        notes: \"Follow up\",\n      },\n    ] as any);\n\n    const filtered = await service.fetchLeads({ status: \"Open\", search: \"alice\" });\n    expect(filtered).toHaveLength(1);\n    expect(filtered[0].id).toBe(\"lead-1\");\n\n    const sorted = await service.fetchLeads(undefined, { field: \"name\", direction: \"desc\" });\n    expect(sorted[0].name).toBe(\"Bob\");\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/services/__tests__/ProjectService.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/services/__tests__/SessionService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2572,2575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2572,2575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":96,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3014,3017],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3014,3017],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":132,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4075,4078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4075,4078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { SessionService } from \"../SessionService\";\n\nconst supabaseFromMock = jest.fn();\nconst supabaseAuthGetUserMock = jest.fn();\n\njest.mock(\"@/integrations/supabase/client\", () => ({\n  supabase: {\n    from: (...args: unknown[]) => supabaseFromMock(...args),\n    auth: {\n      getUser: (...args: unknown[]) => supabaseAuthGetUserMock(...args),\n    },\n  },\n}));\n\nbeforeEach(() => {\n  supabaseFromMock.mockReset();\n  supabaseAuthGetUserMock.mockReset();\n});\n\ndescribe(\"SessionService.fetchSessions\", () => {\n  it(\"retrieves sessions and filters archived projects\", async () => {\n    const sessionsData = {\n      data: [\n        {\n          id: \"session-1\",\n          lead_id: \"lead-1\",\n          project_id: \"project-1\",\n          session_date: \"2024-05-01\",\n          session_time: \"10:00\",\n          notes: \"Morning session\",\n          status: \"planned\",\n          created_at: \"2024-04-01\",\n          organization_id: \"org-1\",\n          user_id: \"user-1\",\n          leads: { id: \"lead-1\", name: \"Alice\", status: \"active\" },\n          projects: { id: \"project-1\", name: \"Main Project\", status_id: \"status-active\" },\n        },\n        {\n          id: \"session-2\",\n          lead_id: \"lead-2\",\n          project_id: \"project-2\",\n          session_date: \"2024-05-02\",\n          session_time: \"12:00\",\n          notes: \"Midday\",\n          status: \"planned\",\n          created_at: \"2024-04-02\",\n          organization_id: \"org-1\",\n          user_id: \"user-1\",\n          leads: { id: \"lead-2\", name: \"Bob\", status: \"active\" },\n          projects: { id: \"project-2\", name: \"Archived Project\", status_id: \"status-archived\" },\n        },\n      ],\n      error: null,\n    };\n\n    supabaseFromMock.mockImplementation((table: string) => {\n      switch (table) {\n        case \"sessions\":\n          return {\n            select: jest.fn(() => ({\n              eq: jest.fn(() => ({\n                order: jest.fn(() => ({\n                  order: jest.fn(() => Promise.resolve(sessionsData)),\n                })),\n              })),\n            })),\n          };\n        case \"project_statuses\":\n          return {\n            select: jest.fn(() => ({\n              eq: jest.fn(() => ({\n                ilike: jest.fn(() => ({ maybeSingle: jest.fn(() => Promise.resolve({ data: { id: \"status-archived\" }, error: null })) })),\n              })),\n            })),\n          };\n        default:\n          return {};\n      }\n    });\n\n    supabaseAuthGetUserMock.mockResolvedValue({ data: { user: { id: \"user-1\" } }, error: null });\n\n    const service = new SessionService();\n    (service as any).getOrganizationId = jest.fn().mockResolvedValue(\"org-1\");\n\n    const sessions = await service.fetchSessions();\n\n    expect(sessions).toHaveLength(1);\n    expect(sessions[0].id).toBe(\"session-1\");\n    expect(sessions[0].lead_name).toBe(\"Alice\");\n    expect(sessions[0].project_name).toBe(\"Main Project\");\n  });\n\n  it(\"returns empty array when organization missing\", async () => {\n    const service = new SessionService();\n    (service as any).getOrganizationId = jest.fn().mockResolvedValue(null);\n\n    const sessions = await service.fetchSessions();\n    expect(sessions).toEqual([]);\n    expect(supabaseFromMock).not.toHaveBeenCalled();\n  });\n});\n\ndescribe(\"SessionService.fetchFilteredSessions\", () => {\n  it(\"applies filters and sorts\", async () => {\n    const service = new SessionService();\n    jest.spyOn(service, \"fetchSessions\").mockResolvedValue([\n      {\n        id: \"session-1\",\n        lead_id: \"lead-1\",\n        project_id: \"project-1\",\n        session_date: \"2024-05-01\",\n        session_time: \"09:00\",\n        notes: \"Morning\",\n        status: \"planned\",\n        lead_name: \"Alice\",\n        project_name: \"Wedding\",\n        created_at: \"2024-04-01\",\n      },\n      {\n        id: \"session-2\",\n        lead_id: \"lead-2\",\n        project_id: \"project-2\",\n        session_date: \"2024-05-01\",\n        session_time: \"11:00\",\n        notes: \"Lunch\",\n        status: \"completed\",\n        lead_name: \"Bob\",\n        project_name: \"Portrait\",\n        created_at: \"2024-04-02\",\n      },\n    ] as any);\n\n    const filtered = await service.fetchFilteredSessions({ status: \"planned\", leadId: \"lead-1\" });\n    expect(filtered).toHaveLength(1);\n    expect(filtered[0].id).toBe(\"session-1\");\n\n    const sorted = await service.fetchFilteredSessions(undefined, { field: \"session_date\", direction: \"asc\" });\n    expect(sorted[0].session_time).toBe(\"09:00\");\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/setupTests.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/theme/settingsTokens.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/theme/tokens.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/types/leadFields.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/types/serviceLineItems.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/types/template.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[749,752],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[749,752],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1152,1155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1152,1155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Unified template interface for the entire application\nexport interface Template {\n  id: string;\n  name: string;\n  category: string;\n  master_content: string;\n  master_subject?: string;\n  placeholders?: string[];\n  is_active: boolean;\n  created_at: string;\n  updated_at: string;\n  user_id: string;\n  organization_id: string;\n  channels?: {\n    email?: {\n      subject?: string;\n      content?: string;\n      html_content?: string;\n    };\n    sms?: {\n      content?: string;\n    };\n    whatsapp?: {\n      content?: string;\n    };\n  };\n}\n\n// Template for template builder with additional UI fields\nexport interface TemplateBuilderData extends Omit<Template, 'channels'> {\n  description?: string;\n  subject?: string;\n  preheader?: string;\n  blocks?: any[]; // For UI editing only, not stored in DB\n  status: 'draft' | 'published';\n  published_at?: string | null;\n  last_saved_at?: string | null;\n  channels?: Template['channels'];\n}\n\n// Database template structure (what comes from Supabase)\nexport interface DatabaseTemplate {\n  id: string;\n  name: string;\n  category: string;\n  master_content: string;\n  master_subject: string | null;\n  placeholders: any; // Json type from Supabase\n  is_active: boolean;\n  created_at: string;\n  updated_at: string;\n  user_id: string;\n  organization_id: string;\n  template_channel_views?: Array<{\n    channel: string;\n    subject?: string;\n    content?: string;\n    html_content?: string;\n  }>;\n}\n\n// Template channel view structure\nexport interface TemplateChannelView {\n  id?: string;\n  template_id: string;\n  channel: 'email' | 'sms' | 'whatsapp';\n  subject?: string;\n  content?: string;\n  html_content?: string;\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/types/templateBuilder.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/types/workflow.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/types/xlsx.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/utils/authUtils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/utils/authUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/utils/entityUtils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/utils/entityUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/utils/onboardingCleanup.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/utils/onboardingCleanup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/utils/onboardingValidation.test.ts","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":47,"column":59,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":47,"endColumn":92},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":100,"column":25,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":100,"endColumn":58}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n  validateOnboardingSystem,\n  validateStageTransition,\n  getSystemHealthStatus,\n} from \"./onboardingValidation\";\n\ndescribe(\"validateOnboardingSystem\", () => {\n  afterEach(() => {\n    jest.resetModules();\n    jest.clearAllMocks();\n  });\n\n  it(\"returns healthy status when onboarding configuration is consistent\", () => {\n    const result = validateOnboardingSystem();\n\n    expect(result.isValid).toBe(true);\n    expect(result.errors).toHaveLength(0);\n    expect(result.warnings).toHaveLength(0);\n    expect(result.summary.systemHealth).toBe(\"healthy\");\n    expect(result.summary.totalSteps).toBe(result.summary.validSteps);\n  });\n\n  it(\"flags mismatched step metadata and totals\", () => {\n    jest.isolateModules(() => {\n      jest.doMock(\"@/constants/onboarding\", () => ({\n        ONBOARDING_STEPS: [\n          {\n            id: 3,\n            title: \"  \",\n            description: \"Broken config\",\n            route: \"\",\n            buttonText: \"\",\n            duration: \"0 min\",\n          },\n          {\n            id: 1,\n            title: \"Valid title\",\n            description: \"Missing button\",\n            route: \"/valid\",\n            buttonText: \"\",\n            duration: \"1 min\",\n          },\n        ],\n        TOTAL_STEPS: 5,\n      }));\n\n      const { validateOnboardingSystem: runValidation } = require(\"./onboardingValidation\");\n      const result = runValidation();\n\n      expect(result.isValid).toBe(false);\n      expect(result.errors).toEqual([\n        \"Step 0 has incorrect ID: expected 1, got 3\",\n        \"Step 3 missing title\",\n        \"Step 3 missing route\",\n        \"Step 1 has incorrect ID: expected 2, got 1\",\n        \"TOTAL_STEPS (5) doesn't match ONBOARDING_STEPS length (2)\",\n      ]);\n      expect(result.warnings).toEqual([\n        \"Step 3 missing button text\",\n        \"Step 1 missing button text\",\n      ]);\n      expect(result.summary.systemHealth).toBe(\"error\");\n      expect(result.summary.validSteps).toBe(0);\n    });\n  });\n});\n\ndescribe(\"validateStageTransition\", () => {\n  it(\"permits configured forward transitions\", () => {\n    expect(validateStageTransition(\"not_started\", \"modal_shown\")).toBe(true);\n    expect(validateStageTransition(\"modal_shown\", \"in_progress\")).toBe(true);\n    expect(validateStageTransition(\"in_progress\", \"completed\")).toBe(true);\n    expect(validateStageTransition(\"skipped\", \"in_progress\")).toBe(true);\n  });\n\n  it(\"rejects invalid or terminal transitions\", () => {\n    expect(validateStageTransition(\"completed\", \"in_progress\")).toBe(false);\n    expect(validateStageTransition(\"modal_shown\", \"completed\")).toBe(false);\n    expect(validateStageTransition(\"not_started\", \"completed\")).toBe(false);\n  });\n});\n\ndescribe(\"getSystemHealthStatus\", () => {\n  it(\"derives health status and metrics from onboarding validation\", () => {\n    jest.isolateModules(() => {\n      jest.doMock(\"@/constants/onboarding\", () => ({\n        ONBOARDING_STEPS: [\n          {\n            id: 2,\n            title: \"Misnumbered Step\",\n            description: \"Broken data\",\n            route: \"\",\n            buttonText: \"\",\n            duration: \"1 min\",\n          },\n        ],\n        TOTAL_STEPS: 3,\n      }));\n\n      const moduleRef = require(\"./onboardingValidation\");\n      const health = moduleRef.getSystemHealthStatus();\n\n      expect(health.status).toBe(\"error\");\n      expect(health.version).toBe(\"V3\");\n      expect(health.features.productionReady).toBe(false);\n      expect(health.metrics).toEqual({\n        totalSteps: 3,\n        validSteps: 0,\n        errorCount: 3,\n        warningCount: 1,\n      });\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/utils/onboardingValidation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/utils/performance.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/utils/performance.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1630,1633],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1630,1633],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1767,1770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1767,1770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2850,2853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2850,2853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect } from 'react';\n\n/**\n * Performance monitoring utilities\n */\n\nexport interface PerformanceMetric {\n  name: string;\n  value: number;\n  timestamp: number;\n}\n\nclass PerformanceMonitor {\n  private metrics: PerformanceMetric[] = [];\n  private startTimes: Map<string, number> = new Map();\n\n  startTiming(name: string): void {\n    this.startTimes.set(name, performance.now());\n  }\n\n  endTiming(name: string): number {\n    const startTime = this.startTimes.get(name);\n    if (!startTime) {\n      console.warn(`No start time found for metric: ${name}`);\n      return 0;\n    }\n\n    const endTime = performance.now();\n    const duration = endTime - startTime;\n    \n    this.metrics.push({\n      name,\n      value: duration,\n      timestamp: Date.now()\n    });\n\n    this.startTimes.delete(name);\n    \n    // Log slow operations in development\n    if (process.env.NODE_ENV === 'development' && duration > 100) {\n      console.warn(`Slow operation detected: ${name} took ${duration.toFixed(2)}ms`);\n    }\n\n    return duration;\n  }\n\n  getMetrics(): PerformanceMetric[] {\n    return [...this.metrics];\n  }\n\n  clearMetrics(): void {\n    this.metrics = [];\n  }\n\n  getAverageTime(name: string): number {\n    const relevantMetrics = this.metrics.filter(m => m.name === name);\n    if (relevantMetrics.length === 0) return 0;\n    \n    const total = relevantMetrics.reduce((sum, metric) => sum + metric.value, 0);\n    return total / relevantMetrics.length;\n  }\n}\n\nexport const performanceMonitor = new PerformanceMonitor();\n\n/**\n * Decorator for measuring function execution time\n */\nexport function measurePerformance(target: any, propertyName: string, descriptor: PropertyDescriptor) {\n  const method = descriptor.value;\n\n  descriptor.value = function (...args: any[]) {\n    const methodName = `${target.constructor.name}.${propertyName}`;\n    performanceMonitor.startTiming(methodName);\n    \n    try {\n      const result = method.apply(this, args);\n      \n      // Handle async functions\n      if (result instanceof Promise) {\n        return result.finally(() => {\n          performanceMonitor.endTiming(methodName);\n        });\n      }\n      \n      performanceMonitor.endTiming(methodName);\n      return result;\n    } catch (error) {\n      performanceMonitor.endTiming(methodName);\n      throw error;\n    }\n  };\n}\n\n/**\n * Hook for measuring component render performance\n */\nexport function useMeasureRender(componentName: string) {\n  useEffect(() => {\n    performanceMonitor.startTiming(`${componentName} render`);\n    \n    return () => {\n      performanceMonitor.endTiming(`${componentName} render`);\n    };\n  });\n}\n\n/**\n * Utility for detecting memory leaks\n */\nexport function checkMemoryUsage() {\n  if (typeof window !== 'undefined' && 'performance' in window && 'memory' in window.performance) {\n    const memory = (window.performance as any).memory;\n    return {\n      used: Math.round(memory.usedJSHeapSize / 1048576 * 100) / 100,\n      total: Math.round(memory.totalJSHeapSize / 1048576 * 100) / 100,\n      limit: Math.round(memory.jsHeapSizeLimit / 1048576 * 100) / 100\n    };\n  }\n  return null;\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/utils/testUtils.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your component(s) to a separate file.","line":8,"column":7,"nodeType":"Identifier","messageId":"localComponents","endLine":8,"endColumn":63},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"This rule can't verify that `export *` only exports components.","line":33,"column":1,"nodeType":"ExportAllDeclaration","messageId":"exportAll","endLine":33,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { render, RenderOptions } from '@testing-library/react';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { BrowserRouter } from 'react-router-dom';\nimport { ThemeProvider } from 'next-themes';\n\n// Custom render function for testing components with providers\nconst AllTheProviders: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const queryClient = new QueryClient({\n    defaultOptions: {\n      queries: {\n        retry: false,\n      },\n    },\n  });\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <BrowserRouter>\n        <ThemeProvider attribute=\"class\" defaultTheme=\"system\" enableSystem>\n          {children}\n        </ThemeProvider>\n      </BrowserRouter>\n    </QueryClientProvider>\n  );\n};\n\nconst customRender = (\n  ui: React.ReactElement,\n  options?: Omit<RenderOptions, 'wrapper'>\n) => render(ui, { wrapper: AllTheProviders, ...options });\n\nexport * from '@testing-library/react';\nexport { customRender as render };\n\n// Mock Supabase client for testing\nexport const mockSupabaseClient = {\n  from: jest.fn(() => ({\n    select: jest.fn().mockReturnThis(),\n    insert: jest.fn().mockReturnThis(),\n    update: jest.fn().mockReturnThis(),\n    delete: jest.fn().mockReturnThis(),\n    eq: jest.fn().mockReturnThis(),\n    in: jest.fn().mockReturnThis(),\n    order: jest.fn().mockReturnThis(),\n    limit: jest.fn().mockReturnThis(),\n    single: jest.fn(),\n  })),\n  auth: {\n    getUser: jest.fn(),\n    signIn: jest.fn(),\n    signOut: jest.fn(),\n  },\n  rpc: jest.fn(),\n};\n\n// Performance testing utilities\nexport const measureRenderTime = (component: React.ReactElement) => {\n  const start = performance.now();\n  const result = render(component);\n  const end = performance.now();\n  \n  return {\n    ...result,\n    renderTime: end - start\n  };\n};\n\n// Accessibility testing helpers\nexport const setupAxeMatchers = () => {\n  // This would integrate with @axe-core/react in a real implementation\n  // For now, we'll just export a placeholder\n  return {\n    toHaveNoViolations: () => true\n  };\n};\n\n// Component testing utilities\nexport const createMockProps = <T extends object>(overrides: Partial<T> = {}): T => {\n  const defaultProps = {\n    onClick: jest.fn(),\n    onSubmit: jest.fn(),\n    onChange: jest.fn(),\n    loading: false,\n    disabled: false,\n    ...overrides\n  };\n  \n  return defaultProps as T;\n};\n\n// Mock data generators\nexport const generateMockProject = (overrides = {}) => ({\n  id: 'project-1',\n  name: 'Test Project',\n  description: 'Test Description',\n  status_id: 'status-1',\n  lead_id: 'lead-1',\n  user_id: 'user-1',\n  created_at: new Date().toISOString(),\n  updated_at: new Date().toISOString(),\n  lead: {\n    id: 'lead-1',\n    name: 'Test Client',\n    status: 'active',\n    email: 'test@example.com',\n    phone: '+1234567890'\n  },\n  project_type: {\n    id: 'type-1',\n    name: 'Wedding'\n  },\n  session_count: 0,\n  todo_count: 0,\n  completed_todo_count: 0,\n  ...overrides\n});\n\nexport const generateMockLead = (overrides = {}) => ({\n  id: 'lead-1',\n  name: 'Test Lead',\n  email: 'test@example.com',\n  phone: '+1234567890',\n  status: 'active',\n  status_id: 'status-1',\n  user_id: 'user-1',\n  created_at: new Date().toISOString(),\n  updated_at: new Date().toISOString(),\n  ...overrides\n});\n\n// Performance test helpers\nexport const expectPerformantRender = (renderTime: number, threshold: number = 50) => {\n  if (renderTime >= threshold) {\n    throw new Error(`Render time ${renderTime}ms exceeded threshold ${threshold}ms`);\n  }\n};\n\n// Async test utilities\nexport const waitForLoadingToFinish = () => {\n  return new Promise(resolve => setTimeout(resolve, 0));\n};","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/src/vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/_shared/email-i18n.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/_shared/error-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/_shared/resend-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/get-users-email/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/notification-processor/_templates/enhanced-daily-summary-empty.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/notification-processor/_templates/enhanced-daily-summary-modern.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/notification-processor/_templates/enhanced-email-base.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/notification-processor/_templates/immediate-notifications.ts","messages":[{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":280,"column":7,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":280,"endColumn":66,"suggestions":[{"messageId":"addBrackets","fix":{"range":[8168,9627],"text":"{ const isCompleted = data.project.lifecycle === 'completed';\n      content += `\n        <div style=\"\n          background: white;\n          border-radius: 12px;\n          padding: 24px;\n          box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n          margin: 24px 0;\n        \">\n          <h3 style=\"\n            color: #1f2937;\n            font-size: 18px;\n            font-weight: 600;\n            margin: 0 0 16px 0;\n          \">${t('immediate.sections.projectUpdate')}</h3>\n          <div style=\"color: #374151; font-size: 16px; line-height: 1.6;\">\n            <strong>${t('common.labels.project')}:</strong> ${data.project.name}<br>\n            ${data.project.type ? `<strong>${t('common.labels.type')}:</strong> ${data.project.type}<br>` : ''}\n            ${data.project.leadName ? `<strong>${t('common.labels.client')}:</strong> ${data.project.leadName}<br>` : ''}\n            <div style=\"\n              background: ${isCompleted ? '#22c55e' : '#f59e0b'}15;\n              padding: 12px;\n              border-radius: 8px;\n              margin: 16px 0;\n              border-left: 4px solid ${isCompleted ? '#22c55e' : '#f59e0b'};\n            \">\n              <strong>${t('immediate.sections.statusUpdate')}:</strong> ${data.project.oldStatus} â†’ ${data.project.newStatus}\n            </div>\n            ${data.project.notes ? `<strong>${t('common.labels.notes')}:</strong> ${data.project.notes}` : ''}\n          </div>\n        </div>\n      `;\n      break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":342,"column":7,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":342,"endColumn":66,"suggestions":[{"messageId":"addBrackets","fix":{"range":[10432,10739],"text":"{ const isCompleted = data.project.lifecycle === 'completed';\n      return isCompleted\n        ? t('immediate.subject.projectMilestoneCompleted', {\n            name: data.project.name,\n          })\n        : t('immediate.subject.projectMilestoneCancelled', {\n            name: data.project.name,\n          }); }"},"desc":"Add {} brackets around the case block."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createEmailTemplate, EmailTemplateData } from './enhanced-email-base.ts';\nimport { createEmailLocalization } from '../../_shared/email-i18n.ts';\n\n// Base interface for all immediate notifications\ninterface BaseImmediateNotificationData {\n  organizationId: string;\n  triggeredByUser: {\n    name: string;\n    id: string;\n  };\n}\n\n// Project Assignment specific data\nexport interface ProjectAssignmentData extends BaseImmediateNotificationData {\n  type: 'project-assignment';\n  project: {\n    id: string;\n    name: string;\n    type?: string;\n    status?: string;\n    notes?: string;\n    leadName?: string;\n  };\n  assignee: {\n    name: string;\n    email: string;\n  };\n}\n\n// Lead Assignment specific data  \nexport interface LeadAssignmentData extends BaseImmediateNotificationData {\n  type: 'lead-assignment';\n  lead: {\n    id: string;\n    name: string;\n    status?: string;\n    notes?: string;\n  };\n  assignee: {\n    name: string;\n    email: string;\n  };\n}\n\n// Project Milestone specific data\nexport interface ProjectMilestoneData extends BaseImmediateNotificationData {\n  type: 'project-milestone';\n  project: {\n    id: string;\n    name: string;\n    type?: string;\n    oldStatus: string;\n    newStatus: string;\n    lifecycle: 'completed' | 'cancelled';\n    notes?: string;\n    leadName?: string;\n  };\n  assignee: {\n    name: string;\n    email: string;\n  };\n}\n\n// Union type for all notification data\nexport type ImmediateNotificationData = ProjectAssignmentData | LeadAssignmentData | ProjectMilestoneData;\n\n// Extended email template data\nexport interface ImmediateNotificationEmailData {\n  user: {\n    fullName: string;\n    email: string;\n  };\n  business: {\n    businessName: string;\n    brandColor?: string;\n  };\n  notificationData: ImmediateNotificationData;\n  language?: string;\n  localization?: ReturnType<typeof createEmailLocalization>;\n  baseUrl?: string;\n}\n\ntype TranslateFn = (key: string, variables?: Record<string, unknown>) => string;\n\n/**\n * Helper function to adjust color brightness\n */\nfunction adjustBrightness(hex: string, percent: number): string {\n  hex = hex.replace('#', '');\n  const num = parseInt(hex, 16);\n  const r = Math.min(255, Math.max(0, (num >> 16) + percent));\n  const g = Math.min(255, Math.max(0, (num >> 8 & 0x00FF) + percent));\n  const b = Math.min(255, Math.max(0, (num & 0x0000FF) + percent));\n  \n  return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;\n}\n\n/**\n * Generate the notification header with emoji and title\n */\nfunction generateNotificationHeader(\n  data: ImmediateNotificationData,\n  brandColor: string,\n  t: TranslateFn,\n): string {\n  let emoji = '';\n  let title = '';\n  let subtitle = '';\n  \n  switch (data.type) {\n    case 'project-assignment':\n      emoji = 'ðŸ“‹';\n      title = t('immediate.header.projectAssignment.title');\n      subtitle = t('immediate.header.projectAssignment.subtitle', {\n        name: data.triggeredByUser.name,\n      });\n      break;\n    case 'lead-assignment':\n      emoji = 'ðŸ‘¤';\n      title = t('immediate.header.leadAssignment.title');\n      subtitle = t('immediate.header.leadAssignment.subtitle', {\n        name: data.triggeredByUser.name,\n      });\n      break;\n    case 'project-milestone':\n      emoji = data.project.lifecycle === 'completed' ? 'ðŸŽ‰' : 'âš ï¸';\n      title = t('immediate.header.projectMilestone.title');\n      subtitle = data.project.lifecycle === 'completed'\n        ? t('immediate.header.projectMilestone.subtitleCompleted', {\n            name: data.triggeredByUser.name,\n          })\n        : t('immediate.header.projectMilestone.subtitleCancelled', {\n            name: data.triggeredByUser.name,\n          });\n      break;\n  }\n\n  const lighterBrandColor = adjustBrightness(brandColor, 20);\n\n  return `\n    <div style=\"\n      background: linear-gradient(135deg, ${brandColor}15, ${lighterBrandColor}10);\n      border-radius: 16px;\n      padding: 32px;\n      margin: 24px 0;\n      border-left: 4px solid ${brandColor};\n    \">\n      <div style=\"text-align: center; margin-bottom: 24px;\">\n        <div style=\"\n          font-size: 48px;\n          margin-bottom: 8px;\n          line-height: 1;\n        \">${emoji}</div>\n        <h2 style=\"\n          color: #1f2937;\n          font-size: 24px;\n          font-weight: 700;\n          margin: 0 0 8px 0;\n          line-height: 1.2;\n        \">${title}</h2>\n        <p style=\"\n          color: #6b7280;\n          font-size: 16px;\n          margin: 0;\n          line-height: 1.4;\n        \">${subtitle}</p>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Generate call-to-action button\n */\nfunction generateCallToAction(\n  data: ImmediateNotificationData,\n  brandColor: string,\n  t: TranslateFn,\n  baseUrl = 'https://my.lumiso.app',\n): string {\n  let buttonText = '';\n  let url = '';\n\n  switch (data.type) {\n    case 'project-assignment':\n    case 'project-milestone':\n      buttonText = t('immediate.callToAction.project');\n      url = `${baseUrl}/projects/${data.project.id}`;\n      break;\n    case 'lead-assignment':\n      buttonText = t('immediate.callToAction.lead');\n      url = `${baseUrl}/leads/${data.lead.id}`;\n      break;\n  }\n\n  return `\n    <div style=\"text-align: center; margin: 32px 0;\">\n      <a href=\"${url}\" style=\"\n        display: inline-block;\n        background: ${brandColor};\n        color: white;\n        padding: 12px 24px;\n        border-radius: 8px;\n        text-decoration: none;\n        font-weight: 600;\n        font-size: 14px;\n        transition: all 0.2s ease;\n      \">${buttonText}</a>\n    </div>\n  `;\n}\n\n/**\n * Generate unified immediate notification email\n */\nexport function generateImmediateNotificationEmail(emailData: ImmediateNotificationEmailData): string {\n  const localization =\n    emailData.localization ||\n    (emailData.localization = createEmailLocalization(emailData.language));\n  const t = localization.t;\n  const brandColor = emailData.business.brandColor || '#1EB29F';\n  const data = emailData.notificationData;\n  const baseUrl = emailData.baseUrl || 'https://my.lumiso.app';\n\n  let content = generateNotificationHeader(data, brandColor, t);\n  \n  // Add entity-specific details\n  switch (data.type) {\n    case 'project-assignment':\n      content += `\n        <div style=\"\n          background: white;\n          border-radius: 12px;\n          padding: 24px;\n          box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n          margin: 24px 0;\n        \">\n          <h3 style=\"\n            color: #1f2937;\n            font-size: 18px;\n            font-weight: 600;\n            margin: 0 0 16px 0;\n          \">${t('immediate.sections.projectDetails')}</h3>\n          <div style=\"color: #374151; font-size: 16px; line-height: 1.6;\">\n            <strong>${t('common.labels.project')}:</strong> ${data.project.name}<br>\n            ${data.project.type ? `<strong>${t('common.labels.type')}:</strong> ${data.project.type}<br>` : ''}\n            ${data.project.status ? `<strong>${t('immediate.cards.status')}:</strong> ${data.project.status}<br>` : ''}\n            ${data.project.leadName ? `<strong>${t('common.labels.client')}:</strong> ${data.project.leadName}<br>` : ''}\n            ${data.project.notes ? `<strong>${t('common.labels.notes')}:</strong> ${data.project.notes}` : ''}\n          </div>\n        </div>\n      `;\n      break;\n      \n    case 'lead-assignment':\n      content += `\n        <div style=\"\n          background: white;\n          border-radius: 12px;\n          padding: 24px;\n          box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n          margin: 24px 0;\n        \">\n          <h3 style=\"\n            color: #1f2937;\n            font-size: 18px;\n            font-weight: 600;\n            margin: 0 0 16px 0;\n          \">${t('immediate.sections.leadDetails')}</h3>\n          <div style=\"color: #374151; font-size: 16px; line-height: 1.6;\">\n            <strong>${t('immediate.cards.lead')}:</strong> ${data.lead.name}<br>\n            ${data.lead.status ? `<strong>${t('immediate.cards.status')}:</strong> ${data.lead.status}<br>` : ''}\n            ${data.lead.notes ? `<strong>${t('common.labels.notes')}:</strong> ${data.lead.notes}` : ''}\n          </div>\n        </div>\n      `;\n      break;\n      \n    case 'project-milestone':\n      const isCompleted = data.project.lifecycle === 'completed';\n      content += `\n        <div style=\"\n          background: white;\n          border-radius: 12px;\n          padding: 24px;\n          box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n          margin: 24px 0;\n        \">\n          <h3 style=\"\n            color: #1f2937;\n            font-size: 18px;\n            font-weight: 600;\n            margin: 0 0 16px 0;\n          \">${t('immediate.sections.projectUpdate')}</h3>\n          <div style=\"color: #374151; font-size: 16px; line-height: 1.6;\">\n            <strong>${t('common.labels.project')}:</strong> ${data.project.name}<br>\n            ${data.project.type ? `<strong>${t('common.labels.type')}:</strong> ${data.project.type}<br>` : ''}\n            ${data.project.leadName ? `<strong>${t('common.labels.client')}:</strong> ${data.project.leadName}<br>` : ''}\n            <div style=\"\n              background: ${isCompleted ? '#22c55e' : '#f59e0b'}15;\n              padding: 12px;\n              border-radius: 8px;\n              margin: 16px 0;\n              border-left: 4px solid ${isCompleted ? '#22c55e' : '#f59e0b'};\n            \">\n              <strong>${t('immediate.sections.statusUpdate')}:</strong> ${data.project.oldStatus} â†’ ${data.project.newStatus}\n            </div>\n            ${data.project.notes ? `<strong>${t('common.labels.notes')}:</strong> ${data.project.notes}` : ''}\n          </div>\n        </div>\n      `;\n      break;\n  }\n\n  content += generateCallToAction(data, brandColor, t, baseUrl);\n\n  const templateData: EmailTemplateData = {\n    userFullName: emailData.user.fullName,\n    businessName: emailData.business.businessName,\n    brandColor: brandColor,\n    baseUrl,\n    localization,\n  };\n\n  return createEmailTemplate(\n    generateSubject(data, t),\n    content,\n    templateData\n  );\n}\n\n/**\n * Generate email subject based on notification type\n */\nexport function generateSubject(data: ImmediateNotificationData, t: TranslateFn): string {\n  switch (data.type) {\n    case 'project-assignment':\n      return t('immediate.subject.projectAssignment', { name: data.project.name });\n    case 'lead-assignment':\n      return t('immediate.subject.leadAssignment', { name: data.lead.name });\n    case 'project-milestone':\n      const isCompleted = data.project.lifecycle === 'completed';\n      return isCompleted\n        ? t('immediate.subject.projectMilestoneCompleted', {\n            name: data.project.name,\n          })\n        : t('immediate.subject.projectMilestoneCancelled', {\n            name: data.project.name,\n          });\n    default:\n      return t('immediate.header.projectAssignment.title');\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/notification-processor/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/process-session-reminders/index.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1516,1519],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1516,1519],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { serve } from \"https://deno.land/std@0.190.0/http/server.ts\";\nimport { createClient } from \"https://esm.sh/@supabase/supabase-js@2.39.3\";\nimport {\n  getErrorMessage,\n  getErrorStack,\n} from \"../_shared/error-utils.ts\";\n\nexport const corsHeaders = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',\n};\n\nexport const handler = async (req: Request): Promise<Response> => {\n  console.log('Session reminders processor started');\n\n  if (req.method === 'OPTIONS') {\n    return new Response(null, { headers: corsHeaders });\n  }\n\n  const adminSupabase = createClient(\n    Deno.env.get('SUPABASE_URL') ?? '',\n    Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? ''\n  );\n\n  try {\n    const processedReminders = await processScheduledReminders(adminSupabase);\n\n    return new Response(JSON.stringify({\n      success: true,\n      processed_reminders: processedReminders,\n      processed_at: new Date().toISOString()\n    }), {\n      status: 200,\n      headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n    });\n\n  } catch (error: unknown) {\n    console.error('Error processing session reminders:', error);\n    return new Response(JSON.stringify({\n      error: getErrorMessage(error),\n      stack: getErrorStack(error),\n      timestamp: new Date().toISOString()\n    }), {\n      status: 500,\n      headers: { ...corsHeaders, 'Content-Type': 'application/json' },\n    });\n  }\n};\n\nexport async function processScheduledReminders(supabase: any) {\n  console.log('Processing scheduled session reminders');\n\n  // Get reminders that are due to be sent (exact timing, no early processing buffer)\n  const now = new Date();\n\n  console.log(`Processing reminders scheduled at or before: ${now.toISOString()}`);\n\n  const { data: dueReminders, error: fetchError } = await supabase\n    .from('scheduled_session_reminders')\n    .select(`\n      *,\n      sessions!fk_scheduled_session_reminders_session_id (\n        id,\n        session_date,\n        session_time,\n        session_type_id,\n        session_types:session_type_id (\n          id,\n          name,\n          duration_minutes\n        ),\n        location,\n        notes,\n        organization_id,\n        leads!inner (\n          id,\n          name,\n          email,\n          phone,\n          organization_id\n        )\n      ),\n      workflows!fk_scheduled_session_reminders_workflow_id (\n        id,\n        name,\n        organization_id\n      )\n    `)\n    .eq('status', 'pending')\n    .lte('scheduled_for', now.toISOString())\n    .order('scheduled_for');\n\n  if (fetchError) {\n    console.error('Error fetching due reminders:', fetchError);\n    throw fetchError;\n  }\n\n  if (!dueReminders || dueReminders.length === 0) {\n    console.log('No reminders due for processing');\n    return { processed: 0, triggered: 0, failed: 0 };\n  }\n\n  console.log(`Found ${dueReminders.length} reminders due for processing`);\n\n  let processed = 0;\n  let triggered = 0;\n  let failed = 0;\n\n  // Process each reminder\n  for (const reminder of dueReminders) {\n    try {\n      console.log(`Processing reminder ${reminder.id} for session ${reminder.session_id}, type: ${reminder.reminder_type}`);\n      \n      // Verify session data before processing\n      if (!reminder.sessions || !reminder.sessions.leads) {\n        console.error(`Invalid session or lead data for reminder ${reminder.id}`);\n        await supabase\n          .from('scheduled_session_reminders')\n          .update({ \n            status: 'failed',\n            error_message: 'Invalid session or lead data',\n            processed_at: new Date().toISOString()\n          })\n          .eq('id', reminder.id);\n        failed++;\n        processed++;\n        continue;\n      }\n\n      console.log(\n        `Session data: ${reminder.sessions.session_date} ${reminder.sessions.session_time}, Lead: ${reminder.sessions.leads.name}`,\n      );\n\n      // Mark reminder as being processed first to prevent duplicate processing\n      const { error: updateError } = await supabase\n        .from('scheduled_session_reminders')\n        .update({ \n          status: 'sent',\n          processed_at: new Date().toISOString()\n        })\n        .eq('id', reminder.id)\n        .eq('status', 'pending'); // Only update if still pending\n\n      if (updateError) {\n        console.error(`Error updating reminder ${reminder.id}:`, updateError);\n        failed++;\n        processed++;\n        continue;\n      }\n\n      // Trigger the workflow executor for this session reminder with explicit session validation\n      console.log(`Triggering workflow for session ${reminder.session_id} (${reminder.sessions.session_date} ${reminder.sessions.session_time})`);\n      console.log(`Processing reminder type: ${reminder.reminder_type} scheduled for: ${reminder.scheduled_for}`);\n      console.log(`Current time: ${now.toISOString()}, Reminder due: ${reminder.scheduled_for}`);\n      \n      const { error: triggerError } = await supabase.functions.invoke('workflow-executor', {\n        body: {\n          action: 'trigger',\n          trigger_type: 'session_reminder',\n          trigger_entity_type: 'session',\n          trigger_entity_id: reminder.session_id, // This MUST match the session in the reminder\n          organization_id: reminder.organization_id,\n          trigger_data: {\n            reminder_type: reminder.reminder_type,\n            // Pass the exact session data we retrieved to ensure consistency\n            session_data: {\n              id: reminder.sessions.id,\n              session_date: reminder.sessions.session_date,\n              session_time: reminder.sessions.session_time,\n              location: reminder.sessions.location,\n              notes: reminder.sessions.notes,\n              session_type_id: reminder.sessions.session_type_id,\n              session_type_name: reminder.sessions.session_types?.name ?? null,\n              session_type_duration_minutes: reminder.sessions.session_types?.duration_minutes ?? null\n            },\n            lead_data: {\n              id: reminder.sessions.leads.id,\n              name: reminder.sessions.leads.name,\n              email: reminder.sessions.leads.email,\n              phone: reminder.sessions.leads.phone\n            },\n            scheduled_reminder_id: reminder.id,\n            workflow_id: reminder.workflow_id,\n            // Add debug info to ensure correct session is used\n            debug_session_validation: {\n              expected_session_id: reminder.session_id,\n              actual_session_date: reminder.sessions.session_date,\n              actual_session_time: reminder.sessions.session_time,\n              lead_name: reminder.sessions.leads.name,\n              reminder_type: reminder.reminder_type,\n              scheduled_for: reminder.scheduled_for\n            }\n          }\n        }\n      });\n\n      if (triggerError) {\n        const triggerErrorMessage = getErrorMessage(triggerError);\n        console.error(`Error triggering workflow for reminder ${reminder.id}:`, triggerError);\n        \n        // Mark reminder as failed and record error\n        await supabase\n          .from('scheduled_session_reminders')\n          .update({ \n            status: 'failed',\n            error_message: triggerErrorMessage,\n            processed_at: new Date().toISOString()\n          })\n          .eq('id', reminder.id);\n        \n        failed++;\n      } else {\n        console.log(`Successfully triggered workflow for reminder ${reminder.id}`);\n        triggered++;\n      }\n\n      processed++;\n\n    } catch (error) {\n      console.error(`Error processing reminder ${reminder.id}:`, error);\n      \n      // Mark reminder as failed\n      try {\n        await supabase\n          .from('scheduled_session_reminders')\n          .update({ \n            status: 'failed',\n            error_message: getErrorMessage(error),\n            processed_at: new Date().toISOString()\n          })\n          .eq('id', reminder.id);\n      } catch (updateError) {\n        console.error(`Failed to update reminder ${reminder.id} status:`, updateError);\n      }\n      \n      failed++;\n      processed++;\n    }\n  }\n\n  // Clean up old reminders\n  try {\n    const { data: cleanupResult, error: cleanupError } = await supabase.rpc('cleanup_old_session_reminders');\n    if (cleanupError) {\n      console.error('Error during cleanup:', cleanupError);\n    } else {\n      console.log(`Cleaned up ${cleanupResult || 0} old reminders`);\n    }\n  } catch (cleanupError) {\n    console.error('Cleanup failed:', cleanupError);\n  }\n\n  console.log(`Processed ${processed} reminders: ${triggered} triggered, ${failed} failed`);\n  \n  return { processed, triggered, failed };\n}\n\nserve(handler);\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/schedule-daily-notifications/index.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[414,417],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[414,417],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { serve } from \"https://deno.land/std@0.190.0/http/server.ts\";\nimport { createClient } from \"https://esm.sh/@supabase/supabase-js@2.50.0\";\nimport { getErrorMessage } from \"../_shared/error-utils.ts\";\n\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',\n};\n\ninterface SupabaseClientLike {\n  from(table: string): any;\n  functions: {\n    invoke(name: string, options: { body: Record<string, unknown> }): Promise<{ data?: unknown; error?: Error | null }>;\n  };\n}\n\ninterface HandlerDependencies {\n  createClient?: () => SupabaseClientLike;\n  getNow?: () => Date;\n}\n\nfunction createSupabaseClient(): SupabaseClientLike {\n  return createClient(\n    Deno.env.get('SUPABASE_URL') ?? '',\n    Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? '',\n  ) as unknown as SupabaseClientLike;\n}\n\nexport const handler = async (\n  req: Request,\n  deps: HandlerDependencies = {},\n): Promise<Response> => {\n  if (req.method === 'OPTIONS') {\n    return new Response(null, { headers: corsHeaders });\n  }\n\n  console.log('Daily notification scheduler started');\n\n  const createClientFn = deps.createClient ?? createSupabaseClient;\n  const getNow = deps.getNow ?? (() => new Date());\n\n  try {\n    const supabase = createClientFn();\n\n    const now = getNow();\n    const currentTime = `${now.getUTCHours().toString().padStart(2, '0')}:${now.getUTCMinutes().toString().padStart(2, '0')}`;\n\n    console.log(`Current time: ${currentTime}`);\n\n    const { data: userSettings, error: userError } = await supabase\n      .from('user_settings')\n      .select(`\n        user_id,\n        active_organization_id,\n        notification_scheduled_time\n      `)\n      .eq('notification_global_enabled', true)\n      .eq('notification_daily_summary_enabled', true)\n      .eq('notification_scheduled_time', currentTime)\n      .not('active_organization_id', 'is', null);\n\n    if (userError) {\n      console.error('Error fetching user settings:', userError);\n      throw userError;\n    }\n\n    console.log(`Found ${userSettings?.length || 0} user settings to process`);\n\n    if (!userSettings || userSettings.length === 0) {\n      return new Response(JSON.stringify({\n        success: true,\n        message: `No users scheduled for ${currentTime}`,\n        processed: 0,\n      }), {\n        status: 200,\n        headers: { 'Content-Type': 'application/json', ...corsHeaders },\n      });\n    }\n\n    const userSettingsList = (userSettings ?? []) as Array<{\n      user_id: string;\n      active_organization_id: string;\n      notification_scheduled_time: string;\n    }>;\n\n    const orgIds = [...new Set(userSettingsList.map((u) => u.active_organization_id))];\n    const { data: orgs, error: orgDetailsError } = await supabase\n      .from('organizations')\n      .select('id, owner_id, name')\n      .in('id', orgIds);\n\n    if (orgDetailsError) {\n      console.error('Error fetching organization details:', orgDetailsError);\n      throw orgDetailsError;\n    }\n\n    console.log(`Found ${orgs?.length || 0} organizations to process`);\n\n    const today = now.toISOString().split('T')[0];\n    const scheduledFor = now.toISOString();\n    const notifications: Array<Record<string, unknown>> = [];\n\n    const orgsList = (orgs ?? []) as Array<{ id: string; owner_id: string; name: string }>;\n\n    for (const userSetting of userSettingsList) {\n      const org = orgsList.find((o) => o.id === userSetting.active_organization_id);\n      if (!org) {\n        console.log(`Organization ${userSetting.active_organization_id} not found`);\n        continue;\n      }\n\n      const { data: existingNotification } = await supabase\n        .from('notifications')\n        .select('id')\n        .eq('organization_id', org.id)\n        .eq('user_id', userSetting.user_id)\n        .eq('notification_type', 'daily-summary')\n        .gte('created_at', `${today}T00:00:00Z`)\n        .lt('created_at', `${today}T23:59:59Z`)\n        .maybeSingle();\n\n      if (existingNotification) {\n        console.log(`Daily summary already exists for user ${userSetting.user_id} in organization ${org.id}`);\n        continue;\n      }\n\n      notifications.push({\n        organization_id: org.id,\n        user_id: userSetting.user_id,\n        notification_type: 'daily-summary',\n        delivery_method: 'scheduled',\n        scheduled_for: scheduledFor,\n        metadata: {\n          date: today,\n          organization_name: org.name,\n        },\n        status: 'pending',\n      });\n    }\n\n    if (notifications.length > 0) {\n      const { error: insertError } = await supabase\n        .from('notifications')\n        .insert(notifications);\n\n      if (insertError) {\n        console.error('Error inserting notifications:', insertError);\n        throw insertError;\n      }\n\n      console.log(`Created ${notifications.length} daily summary notifications`);\n\n      try {\n        const { error: processorError } = await supabase.functions.invoke('notification-processor', {\n          body: { action: 'process-pending' },\n        });\n\n        if (processorError) {\n          console.error('Error triggering notification processor:', processorError);\n        } else {\n          console.log('Successfully triggered notification processor');\n        }\n      } catch (processorError) {\n        console.error('Failed to trigger notification processor:', processorError);\n      }\n    }\n\n    return new Response(JSON.stringify({\n      success: true,\n      processed: notifications.length,\n      users: userSettingsList.map((u) => u.user_id),\n    }), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json', ...corsHeaders },\n    });\n  } catch (error: unknown) {\n    console.error('Error in schedule-daily-notifications:', error);\n    return new Response(JSON.stringify({\n      error: getErrorMessage(error),\n      success: false,\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json', ...corsHeaders },\n    });\n  }\n};\n\nif (import.meta.main) {\n  serve((req: Request) => handler(req));\n}\n\nexport { corsHeaders };\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/daily-summary-template.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/delivery-template.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/email-base.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/enhanced-daily-summary-empty.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/enhanced-daily-summary-modern.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/enhanced-daily-summary-template.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/enhanced-email-base.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/enhanced-milestone-template.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/enhanced-overdue-template.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/enhanced-session-template.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/enhanced-task-nudge-template.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/immediate-notifications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/overdue-template.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/session-template.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/simplified-daily-summary-template.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/simplified-weekly-recap-template.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[233,236],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[233,236],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'sections' is never reassigned. Use 'const' instead.","line":16,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":16,"endColumn":15,"fix":{"range":[524,542],"text":"const sections = [];"}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { createEmailTemplate, EmailTemplateData } from './enhanced-email-base.ts';\nimport { WeeklyStats } from './weekly-recap-template.ts';\n\nexport function generateWeeklyRecapEmailSimplified(\n  stats: WeeklyStats,\n  agingProjects: any[],\n  templateData: EmailTemplateData\n): string {\n  const weekStart = new Date();\n  weekStart.setDate(weekStart.getDate() - 7);\n  const weekEnd = new Date();\n  \n  const weekRange = `${weekStart.toLocaleDateString()} - ${weekEnd.toLocaleDateString()}`;\n  \n  // Generate content sections\n  let sections = [];\n\n  // Key metrics section\n  sections.push(`\n    <div style=\"margin-bottom: 32px;\">\n      <h2 style=\"color: #1f2937; font-size: 20px; font-weight: 600; margin-bottom: 20px;\">\n        ðŸ“ˆ This Week's Performance\n      </h2>\n      \n      <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 24px;\">\n        <div style=\"background: #ecfdf5; border: 1px solid #d1fae5; border-radius: 8px; padding: 16px; text-align: center;\">\n          <div style=\"font-size: 24px; font-weight: bold; color: #059669;\">${stats.leadsAdded}</div>\n          <div style=\"color: #065f46; font-size: 14px;\">New Leads</div>\n        </div>\n        \n        <div style=\"background: ${stats.leadsLost > 0 ? '#fef2f2' : '#f3f4f6'}; border: 1px solid ${stats.leadsLost > 0 ? '#fecaca' : '#d1d5db'}; border-radius: 8px; padding: 16px; text-align: center;\">\n          <div style=\"font-size: 24px; font-weight: bold; color: ${stats.leadsLost > 0 ? '#dc2626' : '#6b7280'};\">${stats.leadsLost}</div>\n          <div style=\"color: ${stats.leadsLost > 0 ? '#7f1d1d' : '#4b5563'}; font-size: 14px;\">Leads Lost</div>\n        </div>\n        \n        <div style=\"background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; padding: 16px; text-align: center;\">\n          <div style=\"font-size: 24px; font-weight: bold; color: #2563eb;\">${stats.projectsCreated}</div>\n          <div style=\"color: #1e40af; font-size: 14px;\">Projects Started</div>\n        </div>\n        \n        <div style=\"background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 16px; text-align: center;\">\n          <div style=\"font-size: 24px; font-weight: bold; color: #0284c7;\">${stats.sessionsCompleted}</div>\n          <div style=\"color: #0c4a6e; font-size: 14px;\">Sessions Completed</div>\n        </div>\n      </div>\n    </div>\n  `);\n\n  // Lead conversion health\n  const conversionRate = stats.leadsAdded > 0 ? Math.round((stats.leadsConverted / stats.leadsAdded) * 100) : 0;\n  const lossRate = stats.leadsAdded > 0 ? Math.round((stats.leadsLost / stats.leadsAdded) * 100) : 0;\n  \n  sections.push(`\n    <div style=\"margin-bottom: 32px;\">\n      <h2 style=\"color: #1f2937; font-size: 18px; font-weight: 600; margin-bottom: 16px;\">\n        ðŸŽ¯ Lead Conversion Health\n      </h2>\n      \n      <div style=\"background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px;\">\n        <div style=\"margin-bottom: 16px;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;\">\n            <span style=\"color: #374151; font-weight: 500;\">Conversion Rate</span>\n            <span style=\"color: #059669; font-weight: 600;\">${conversionRate}%</span>\n          </div>\n          <div style=\"background: #e5e7eb; height: 6px; border-radius: 3px; overflow: hidden;\">\n            <div style=\"background: #10b981; height: 100%; width: ${conversionRate}%; transition: width 0.3s ease;\"></div>\n          </div>\n        </div>\n        \n        <div>\n          <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;\">\n            <span style=\"color: #374151; font-weight: 500;\">Loss Rate</span>\n            <span style=\"color: ${lossRate > 30 ? '#dc2626' : '#6b7280'}; font-weight: 600;\">${lossRate}%</span>\n          </div>\n          <div style=\"background: #e5e7eb; height: 6px; border-radius: 3px; overflow: hidden;\">\n            <div style=\"background: ${lossRate > 30 ? '#ef4444' : '#94a3b8'}; height: 100%; width: ${lossRate}%; transition: width 0.3s ease;\"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  `);\n\n  // Session activity\n  if (stats.sessionsCompleted > 0 || stats.sessionsScheduled > 0) {\n    sections.push(`\n      <div style=\"margin-bottom: 32px;\">\n        <h2 style=\"color: #1f2937; font-size: 18px; font-weight: 600; margin-bottom: 16px;\">\n          ðŸ“¸ Session Activity\n        </h2>\n        \n        <div style=\"background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px;\">\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px;\">\n            <span style=\"color: #374151;\">Sessions Completed:</span>\n            <span style=\"color: #059669; font-weight: 600;\">${stats.sessionsCompleted}</span>\n          </div>\n          <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px;\">\n            <span style=\"color: #374151;\">Sessions Scheduled (upcoming):</span>\n            <span style=\"color: #2563eb; font-weight: 600;\">${stats.sessionsScheduled}</span>\n          </div>\n          ${stats.sessionsCompleted > 0 ? `\n            <div style=\"margin-top: 16px; padding-top: 16px; border-top: 1px solid #e5e7eb;\">\n              <div style=\"color: #059669; font-size: 14px;\">\n                ðŸŽ‰ Great job completing ${stats.sessionsCompleted} session${stats.sessionsCompleted === 1 ? '' : 's'} this week!\n              </div>\n            </div>\n          ` : ''}\n        </div>\n      </div>\n    `);\n  }\n\n  // Aging projects alert\n  if (agingProjects.length > 0) {\n    sections.push(`\n      <div style=\"margin-bottom: 32px;\">\n        <h2 style=\"color: #dc2626; font-size: 18px; font-weight: 600; margin-bottom: 16px;\">\n          âš ï¸ Projects Needing Attention (${agingProjects.length})\n        </h2>\n        \n        <div style=\"background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 20px;\">\n          <p style=\"color: #7f1d1d; margin-bottom: 16px;\">\n            These projects have been in active status for over 30 days:\n          </p>\n          \n          ${agingProjects.slice(0, 5).map(project => {\n            const daysOld = Math.floor((Date.now() - new Date(project.created_at).getTime()) / (1000 * 60 * 60 * 24));\n            return `\n              <div style=\"background: white; border: 1px solid #fca5a5; border-radius: 6px; padding: 12px; margin-bottom: 8px;\">\n                <div style=\"font-weight: 600; color: #dc2626;\">${project.name}</div>\n                <div style=\"color: #7f1d1d; font-size: 14px;\">${daysOld} days in active status</div>\n              </div>\n            `;\n          }).join('')}\n          \n          ${agingProjects.length > 5 ? `\n            <div style=\"color: #7f1d1d; font-size: 14px; margin-top: 8px;\">\n              ... and ${agingProjects.length - 5} more aging projects\n            </div>\n          ` : ''}\n          \n          ${templateData.baseUrl ? `\n            <div style=\"margin-top: 16px;\">\n              <a href=\"${templateData.baseUrl}/projects\" style=\"color: #dc2626; text-decoration: underline; font-weight: 500;\">\n                Review and update project statuses â†’\n              </a>\n            </div>\n          ` : ''}\n        </div>\n      </div>\n    `);\n  }\n\n  // Revenue summary\n  if (stats.totalRevenue > 0) {\n    sections.push(`\n      <div style=\"margin-bottom: 32px;\">\n        <h2 style=\"color: #1f2937; font-size: 18px; font-weight: 600; margin-bottom: 16px;\">\n          ðŸ’° Revenue Summary\n        </h2>\n        \n        <div style=\"background: #ecfdf5; border: 1px solid #d1fae5; border-radius: 8px; padding: 20px; text-align: center;\">\n          <div style=\"font-size: 32px; font-weight: bold; color: #059669; margin-bottom: 8px;\">\n            $${stats.totalRevenue.toLocaleString()}\n          </div>\n          <div style=\"color: #065f46; font-size: 16px;\">\n            Total project value started this week\n          </div>\n        </div>\n      </div>\n    `);\n  }\n\n  // Quick actions\n  if (templateData.baseUrl) {\n    sections.push(`\n      <div style=\"margin-top: 32px; padding: 24px; background: #f3f4f6; border-radius: 12px;\">\n        <h3 style=\"color: #374151; font-size: 16px; font-weight: 600; margin-bottom: 16px;\">Owner Dashboard</h3>\n        <div style=\"display: flex; gap: 16px; flex-wrap: wrap;\">\n          <a href=\"${templateData.baseUrl}/analytics\" style=\"background: ${templateData.brandColor}; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-size: 14px; font-weight: 500;\">ðŸ“Š Analytics</a>\n          <a href=\"${templateData.baseUrl}/leads\" style=\"background: #6b7280; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-size: 14px; font-weight: 500;\">ðŸ‘¥ Leads</a>\n          <a href=\"${templateData.baseUrl}/projects\" style=\"background: #6b7280; color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-size: 14px; font-weight: 500;\">ðŸ“ Projects</a>\n        </div>\n      </div>\n    `);\n  }\n\n  const content = `\n    <div style=\"max-width: 600px; margin: 0 auto;\">\n      <h1 style=\"color: #1f2937; font-size: 24px; font-weight: bold; margin-bottom: 8px;\">\n        ðŸ“ˆ Weekly Business Recap\n      </h1>\n      <p style=\"color: #6b7280; font-size: 16px; margin-bottom: 32px;\">\n        ${weekRange}\n      </p>\n      \n      ${sections.join('')}\n      \n      <div style=\"margin-top: 40px; text-align: center; color: #6b7280; font-size: 14px;\">\n        <p>Keep up the excellent work! ðŸŒŸ</p>\n        <p style=\"margin-top: 8px;\">This recap is sent weekly to organization owners only.</p>\n      </div>\n    </div>\n  `;\n\n  return createEmailTemplate(\n    `Weekly Business Recap - ${weekRange}`,\n    content,\n    templateData\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/task-nudge-template.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/_templates/weekly-recap-template.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'insights' is never reassigned. Use 'const' instead.","line":186,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":186,"endColumn":15,"fix":{"range":[8144,8162],"text":"const insights = [];"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { createEmailTemplate, EmailTemplateData, Lead, Project, Session, formatDate, formatDateTime } from './enhanced-email-base.ts';\n\nexport interface WeeklyStats {\n  leadsAdded: number;\n  leadsConverted: number;\n  leadsLost: number;\n  projectsCreated: number;\n  projectsCompleted: number;\n  sessionsCompleted: number;\n  sessionsScheduled: number;\n  totalRevenue: number;\n  recentLeads: Lead[];\n  recentProjects: Project[];\n  upcomingSessions: Session[];\n}\n\nexport function generateWeeklyRecapEmail(stats: WeeklyStats, templateData: EmailTemplateData): string {\n  const weekStart = new Date();\n  weekStart.setDate(weekStart.getDate() - 7);\n  const weekStartFormatted = formatDate(weekStart.toISOString(), templateData.dateFormat);\n  const todayFormatted = formatDate(new Date().toISOString(), templateData.dateFormat);\n\n  let content = `\n    <div class=\"summary-stats\">\n      <div class=\"stat-item\">\n        <span class=\"stat-number\">${stats.leadsAdded}</span>\n        <div class=\"stat-label\">New Leads</div>\n      </div>\n      <div class=\"stat-item\">\n        <span class=\"stat-number\">${stats.projectsCreated}</span>\n        <div class=\"stat-label\">New Projects</div>\n      </div>\n      <div class=\"stat-item\">\n        <span class=\"stat-number\">${stats.sessionsCompleted}</span>\n        <div class=\"stat-label\">Sessions Completed</div>\n      </div>\n      <div class=\"stat-item\">\n        <span class=\"stat-number\">$${stats.totalRevenue.toLocaleString()}</span>\n        <div class=\"stat-label\">Revenue Generated</div>\n      </div>\n    </div>\n    \n    <p>Here's your weekly photography business recap from <strong>${weekStartFormatted}</strong> to <strong>${todayFormatted}</strong>:</p>\n  `;\n\n  // Lead Performance\n  content += `\n    <h3 class=\"section-title\">ðŸ“ˆ Lead Performance This Week</h3>\n    <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 20px;\">\n      <div style=\"background-color: #F0FDF4; padding: 16px; border-radius: 8px; text-align: center;\">\n        <div style=\"font-size: 24px; font-weight: bold; color: #22C55E;\">${stats.leadsAdded}</div>\n        <div style=\"font-size: 14px; color: #059669;\">New Leads Added</div>\n      </div>\n      <div style=\"background-color: #EFF6FF; padding: 16px; border-radius: 8px; text-align: center;\">\n        <div style=\"font-size: 24px; font-weight: bold; color: #3B82F6;\">${stats.leadsConverted}</div>\n        <div style=\"font-size: 14px; color: #1D4ED8;\">Leads Converted</div>\n      </div>\n      <div style=\"background-color: #FEF2F2; padding: 16px; border-radius: 8px; text-align: center;\">\n        <div style=\"font-size: 24px; font-weight: bold; color: #EF4444;\">${stats.leadsLost}</div>\n        <div style=\"font-size: 14px; color: #DC2626;\">Leads Lost</div>\n      </div>\n    </div>\n  `;\n\n  // Conversion Rate\n  const conversionRate = stats.leadsAdded > 0 ? ((stats.leadsConverted / stats.leadsAdded) * 100).toFixed(1) : '0';\n  content += `\n    <div style=\"background-color: #FFFBEB; padding: 16px; border-radius: 8px; margin-bottom: 20px;\">\n      <div style=\"font-size: 18px; font-weight: 600; color: #92400E; margin-bottom: 8px;\">\n        ðŸ“Š Conversion Rate: ${conversionRate}%\n      </div>\n      <div style=\"font-size: 14px; color: #B45309;\">\n        ${stats.leadsConverted} out of ${stats.leadsAdded} new leads converted to projects this week.\n      </div>\n    </div>\n  `;\n\n  // Recent Leads\n  if (stats.recentLeads.length > 0) {\n    content += `\n      <h3 class=\"section-title\">ðŸŽ¯ Recent Leads (${stats.recentLeads.length})</h3>\n    `;\n\n    stats.recentLeads.slice(0, 5).forEach(lead => {\n      content += `\n        <div class=\"item-card\">\n          <div class=\"item-title\">\n            <span>${lead.name}</span>\n            <span class=\"upcoming-badge\">${lead.status || 'New'}</span>\n          </div>\n          ${lead.email ? `<div class=\"item-meta\">ðŸ“§ ${lead.email}</div>` : ''}\n          ${lead.phone ? `<div class=\"item-meta\">ðŸ“ž ${lead.phone}</div>` : ''}\n          <div style=\"margin-top: 12px;\">\n            ${templateData.baseUrl ? `<a href=\"${templateData.baseUrl}/leads/${lead.id}\" class=\"item-action\">View Lead</a>` : ''}\n          </div>\n        </div>\n      `;\n    });\n  }\n\n  // Project Updates\n  content += `\n    <h3 class=\"section-title\">ðŸŽ¨ Project Updates</h3>\n    <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 20px;\">\n      <div style=\"background-color: #F0F9FF; padding: 16px; border-radius: 8px; text-align: center;\">\n        <div style=\"font-size: 24px; font-weight: bold; color: #0EA5E9;\">${stats.projectsCreated}</div>\n        <div style=\"font-size: 14px; color: #0284C7;\">New Projects</div>\n      </div>\n      <div style=\"background-color: #F0FDF4; padding: 16px; border-radius: 8px; text-align: center;\">\n        <div style=\"font-size: 24px; font-weight: bold; color: #22C55E;\">${stats.projectsCompleted}</div>\n        <div style=\"font-size: 14px; color: #059669;\">Projects Completed</div>\n      </div>\n    </div>\n  `;\n\n  // Session Activity\n  content += `\n    <h3 class=\"section-title\">ðŸ“¸ Session Activity</h3>\n    <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 20px;\">\n      <div style=\"background-color: #F3E8FF; padding: 16px; border-radius: 8px; text-align: center;\">\n        <div style=\"font-size: 24px; font-weight: bold; color: #9333EA;\">${stats.sessionsCompleted}</div>\n        <div style=\"font-size: 14px; color: #7C3AED;\">Sessions Completed</div>\n      </div>\n      <div style=\"background-color: #FEF3C7; padding: 16px; border-radius: 8px; text-align: center;\">\n        <div style=\"font-size: 24px; font-weight: bold; color: #F59E0B;\">${stats.sessionsScheduled}</div>\n        <div style=\"font-size: 14px; color: #D97706;\">Sessions Scheduled</div>\n      </div>\n    </div>\n  `;\n\n  // Upcoming Sessions Preview\n  if (stats.upcomingSessions.length > 0) {\n    content += `\n      <h3 class=\"section-title\">ðŸ“… Next Week's Sessions Preview (${stats.upcomingSessions.length})</h3>\n    `;\n\n    stats.upcomingSessions.slice(0, 3).forEach(session => {\n      const sessionTime = formatDateTime(session.session_date, session.session_time, templateData);\n      content += `\n        <div class=\"item-card\">\n          <div class=\"item-title\">\n            <span>Photography Session</span>\n            <span class=\"upcoming-badge\">Upcoming</span>\n          </div>\n          <div class=\"item-meta\">ðŸ“… ${sessionTime}</div>\n          ${session.leads ? `<div class=\"item-meta\">ðŸ‘¤ Client: ${session.leads.name}</div>` : ''}\n          ${session.projects ? `<div class=\"item-relationship\">Project: ${session.projects.name}</div>` : ''}\n        </div>\n      `;\n    });\n\n    if (stats.upcomingSessions.length > 3) {\n      content += `\n        <p style=\"font-style: italic; color: #6B7280;\">\n          ... and ${stats.upcomingSessions.length - 3} more sessions next week\n        </p>\n      `;\n    }\n  }\n\n  // Revenue Summary\n  if (stats.totalRevenue > 0) {\n    content += `\n      <div style=\"background-color: #F0FDF4; padding: 20px; border-radius: 8px; margin: 24px 0; border-left: 4px solid #22C55E;\">\n        <div style=\"font-size: 20px; font-weight: 600; color: #059669; margin-bottom: 8px;\">\n          ðŸ’° Revenue This Week: $${stats.totalRevenue.toLocaleString()}\n        </div>\n        <div style=\"font-size: 14px; color: #065F46;\">\n          Great work! Your photography business generated $${stats.totalRevenue.toLocaleString()} in revenue this week.\n        </div>\n      </div>\n    `;\n  }\n\n  // Action Items and Goals\n  content += `\n    <div class=\"inline-buttons\">\n      ${templateData.baseUrl ? `<a href=\"${templateData.baseUrl}/dashboard\" class=\"cta-button\">Dashboard</a>` : ''}\n      ${templateData.baseUrl ? `<a href=\"${templateData.baseUrl}/leads\" class=\"cta-button\">Manage Leads</a>` : ''}\n      ${templateData.baseUrl ? `<a href=\"${templateData.baseUrl}/projects\" class=\"cta-button\">View Projects</a>` : ''}\n      ${templateData.baseUrl ? `<a href=\"${templateData.baseUrl}/analytics\" class=\"cta-button\">Analytics</a>` : ''}\n    </div>\n  `;\n\n  // Weekly Insights\n  let insights = [];\n  if (stats.leadsAdded > stats.leadsConverted && stats.leadsConverted > 0) {\n    insights.push(\"Consider following up with unconverted leads - they might just need a little more nurturing.\");\n  }\n  if (stats.sessionsCompleted > 0) {\n    insights.push(\"Great job completing sessions this week! Don't forget to follow up with delivery timelines.\");\n  }\n  if (stats.projectsCreated > stats.projectsCompleted) {\n    insights.push(\"You have new projects in the pipeline - make sure to plan your workflow efficiently.\");\n  }\n  if (parseFloat(conversionRate) > 20) {\n    insights.push(\"Excellent conversion rate! Your lead qualification process is working well.\");\n  }\n\n  if (insights.length > 0) {\n    content += `\n      <div style=\"margin-top: 24px; padding: 20px; background-color: #EFF6FF; border-radius: 8px; border-left: 4px solid #3B82F6;\">\n        <div style=\"font-size: 16px; font-weight: 600; color: #1E40AF; margin-bottom: 12px;\">\n          ðŸ’¡ Weekly Insights\n        </div>\n        <ul style=\"margin: 0; padding-left: 20px; color: #1E3A8A;\">\n          ${insights.map(insight => `<li style=\"margin-bottom: 8px;\">${insight}</li>`).join('')}\n        </ul>\n      </div>\n    `;\n  }\n\n  // Motivational close\n  const motivationalMessages = [\n    \"Keep up the amazing work! Your dedication to your craft shows in these results. ðŸŒŸ\",\n    \"Another successful week in the books! Your photography business is thriving. ðŸ“¸\",\n    \"Progress is progress, no matter how small. Every week brings new opportunities! ðŸš€\",\n    \"Your passion for photography is building a successful business. Keep going! ðŸ’ª\",\n    \"Each client you serve and each photo you take is building your legacy. Amazing work! âœ¨\"\n  ];\n  const randomMessage = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];\n\n  content += `\n    <div style=\"margin-top: 24px; padding: 16px; background-color: #F8FAFC; border-radius: 8px; text-align: center;\">\n      <p style=\"margin: 0; font-style: italic; color: #475569; font-size: 16px;\">\n        ${randomMessage}\n      </p>\n    </div>\n  `;\n\n  return createEmailTemplate(\n    `Weekly Business Recap - ${weekStartFormatted} to ${todayFormatted}`,\n    content,\n    templateData\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-reminder-notifications/index.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":127,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4245,4248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4245,4248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":807,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":807,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26279,26282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26279,26282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":807,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":807,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26299,26302],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26299,26302],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1139,"column":103,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1139,"endColumn":106,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37380,37383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37380,37383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { serve } from \"https://deno.land/std@0.190.0/http/server.ts\";\nimport { createClient } from \"https://esm.sh/@supabase/supabase-js@2.39.3\";\nimport { generateModernDailySummaryEmail } from './_templates/enhanced-daily-summary-modern.ts';\nimport { generateEmptyDailySummaryEmail } from './_templates/enhanced-daily-summary-empty.ts';\nimport { formatDate, type Session } from './_templates/enhanced-email-base.ts';\nimport { \n  generateImmediateNotificationEmail, \n  generateSubject,\n  type ProjectAssignmentData,\n  type LeadAssignmentData,\n  type ProjectMilestoneData,\n  type ImmediateNotificationEmailData\n} from './_templates/immediate-notifications.ts';\nimport { createEmailLocalization } from '../_shared/email-i18n.ts';\nimport { getErrorMessage } from '../_shared/error-utils.ts';\nimport {\n  createResendClient,\n  type ResendClient,\n} from '../_shared/resend-utils.ts';\n\nconst corsHeaders = {\n  \"Access-Control-Allow-Origin\": \"*\",\n  \"Access-Control-Allow-Headers\": \"authorization, x-client-info, apikey, content-type\",\n};\n\nfunction normalizeFirst<T>(value: T | T[] | null | undefined): T | undefined {\n  if (Array.isArray(value)) {\n    return value.length > 0 ? value[0] : undefined;\n  }\n  return value ?? undefined;\n}\n\nfunction normalizeSessionProject(\n  project: Session['projects'],\n): Session['projects'] | undefined {\n  const resolvedProject = normalizeFirst(project);\n  if (!resolvedProject) {\n    return undefined;\n  }\n\n  const normalizedProjectTypes = normalizeFirst(resolvedProject.project_types);\n\n  return {\n    ...resolvedProject,\n    project_types: normalizedProjectTypes,\n  };\n}\n\nfunction normalizeSessionLead(\n  lead: Session['leads'],\n): Session['leads'] | undefined {\n  return normalizeFirst(lead);\n}\n\nconst defaultResendClient = createResendClient(Deno.env.get(\"RESEND_API_KEY\"));\nlet resend: ResendClient = defaultResendClient;\n\nexport type { ResendClient } from '../_shared/resend-utils.ts';\n\nexport function setResendClient(client: ResendClient) {\n  resend = client;\n}\n\nexport function getResendClient(): ResendClient {\n  return resend;\n}\n\ninterface ReminderRequest {\n  type: string;\n  isTest?: boolean;\n  organizationId?: string; // For batch processing\n  userId?: string; // For batch processing\n  // Project milestone specific fields\n  project_id?: string;\n  old_status?: string;\n  new_status?: string;\n  milestone_user_id?: string;\n  milestone_user_name?: string;\n  // Assignment notification specific fields\n  entity_type?: string;\n  entity_id?: string;\n  assignee_id?: string;\n  assignee_email?: string;\n  assignee_name?: string;\n  assigner_name?: string;\n  assigner_id?: string;\n}\n\nexport const handler = async (req: Request): Promise<Response> => {\n  if (req.method === \"OPTIONS\") {\n    return new Response(null, { headers: corsHeaders });\n  }\n\n  // Create admin client once at the beginning\n  const adminSupabase = createClient(\n    Deno.env.get(\"SUPABASE_URL\") ?? \"\",\n    Deno.env.get(\"SUPABASE_SERVICE_ROLE_KEY\") ?? \"\"\n  );\n\n  try {\n    const requestData: ReminderRequest = await req.json();\n    console.log(`Processing ${requestData.type}, test mode: ${requestData.isTest || false}`);\n    console.log('Available types: daily-summary, daily-summary-empty, project-milestone, new-assignment');\n\n    // Handle project-milestone notifications\n    if (requestData.type === 'project-milestone') {\n      return await handleProjectMilestoneNotification(requestData, adminSupabase);\n    }\n\n    // Handle assignment notifications\n    if (requestData.type === 'new-assignment') {\n      return await handleAssignmentNotification(requestData, adminSupabase);\n    }\n\n    // Handle daily-summary and daily-summary-empty notifications\n    if (!['daily-summary', 'daily-summary-empty'].includes(requestData.type)) {\n      console.log(`Unsupported type received: ${requestData.type}`);\n      return new Response(JSON.stringify({ message: 'Only daily-summary, daily-summary-empty, project-milestone, and new-assignment supported' }), {\n        status: 200,\n        headers: { \"Content-Type\": \"application/json\", ...corsHeaders },\n      });\n    }\n\n    console.log(`Proceeding with type: ${requestData.type}`);\n    const { type, isTest = false, organizationId: batchOrgId, userId: batchUserId } = requestData;\n\n    let user: any;\n    let organizationId: string;\n\n    // Check if this is batch processing mode (called from process-scheduled-notifications)\n    if (batchOrgId && batchUserId) {\n      console.log('Batch processing mode - using provided org and user IDs');\n      \n      // Get user data directly using admin client\n      const { data: userData, error: userError } = await adminSupabase.auth.admin.getUserById(batchUserId);\n      if (userError || !userData.user) {\n        throw new Error(`Failed to get batch user: ${userError?.message || 'User not found'}`);\n      }\n      user = userData.user;\n      organizationId = batchOrgId;\n      \n    } else {\n      // Regular auth mode - get authenticated user\n      const authHeader = req.headers.get('authorization');\n      console.log('Auth header present:', !!authHeader);\n      \n      if (!authHeader) {\n        throw new Error('Authorization header required');\n      }\n\n      // Extract token and get user directly with admin client\n      const token = authHeader.replace('Bearer ', '');\n      console.log('Token length:', token.length);\n      \n      const { data: { user: authUser }, error: userError } = await adminSupabase.auth.getUser(token);\n      console.log('User auth result:', { user: !!authUser, error: userError?.message });\n      \n      if (userError || !authUser) {\n        console.error('Auth error details:', userError);\n        throw new Error(`Failed to get authenticated user: ${userError?.message || 'Unknown error'}`);\n      }\n\n      user = authUser;\n\n      // Get user's active organization\n      const { data: userSettings } = await adminSupabase\n        .from('user_settings')\n        .select('active_organization_id')\n        .eq('user_id', user.id)\n        .maybeSingle();\n\n      organizationId = userSettings?.active_organization_id;\n\n      if (!organizationId) {\n        const { data: activeMembership } = await adminSupabase\n          .from('organization_members')\n          .select('organization_id')\n          .eq('user_id', user.id)\n          .eq('status', 'active')\n          .order('joined_at', { ascending: true })\n          .limit(1)\n          .maybeSingle();\n\n        organizationId = activeMembership?.organization_id ?? organizationId;\n      }\n\n      if (!organizationId) {\n        const { data: ownedOrganization } = await adminSupabase\n          .from('organizations')\n          .select('id')\n          .eq('owner_id', user.id)\n          .order('created_at', { ascending: true })\n          .limit(1)\n          .maybeSingle();\n\n        organizationId = ownedOrganization?.id ?? organizationId;\n      }\n\n      if (!organizationId) {\n        throw new Error('No active organization found for user');\n      }\n    }\n\n    console.log(`Authenticated user: ${user.email}`);\n    console.log('Organization ID:', organizationId);\n\n    // Get user profile for display name\n    const { data: userProfile } = await adminSupabase\n      .from('profiles')\n      .select('full_name')\n      .eq('user_id', user.id)\n      .maybeSingle();\n\n    // Extract user's full name - only use full_name since first_name/last_name don't exist\n    const userFullName = userProfile?.full_name || \n                         user.user_metadata?.full_name || \n                         user.email?.split('@')[0] || 'there';\n    console.log(`User full name: ${userFullName}`);\n\n    const { data: languagePreference } = await adminSupabase\n      .from('user_language_preferences')\n      .select('language_code')\n      .eq('user_id', user.id)\n      .maybeSingle();\n\n    const localization = createEmailLocalization(languagePreference?.language_code);\n    const t = localization.t;\n\n    const { data: orgSettings } = await adminSupabase\n      .from('organization_settings')\n      .select('photography_business_name, primary_brand_color, date_format, time_format, timezone')\n      .eq('organization_id', organizationId)\n      .maybeSingle();\n\n    if (isTest) {\n      if (type === 'daily-summary' || type === 'daily-summary-empty') {\n        const today = new Date();\n        const todayStr = today.toISOString().split('T')[0];\n        const sampleDaily =\n          (localization.raw('samples.dailySummary') as Record<string, string>) ||\n          {};\n\n        const templateData = {\n          userFullName,\n          businessName: orgSettings?.photography_business_name || 'Lumiso',\n          brandColor: orgSettings?.primary_brand_color || '#1EB29F',\n          dateFormat: orgSettings?.date_format || 'DD/MM/YYYY',\n          timeFormat: orgSettings?.time_format || '12-hour',\n          timezone: orgSettings?.timezone || 'UTC',\n          baseUrl: 'https://my.lumiso.app',\n          language: localization.language,\n          localization,\n        };\n\n        const sampleSessions =\n          type === 'daily-summary'\n            ? [\n                {\n                  id: 'sample-session',\n                  session_date: todayStr,\n                  session_time: '09:30',\n                  notes:\n                    sampleDaily.sessionNotes ||\n                    'Prepare warm-toned presets before the shoot.',\n                  location:\n                    sampleDaily.sessionLocation || 'Downtown studio',\n                  leads: { name: sampleDaily.clientName || 'Emily Carter' },\n                  projects: {\n                    name: sampleDaily.projectName || 'Sunset Wedding',\n                    project_types: {\n                      name: sampleDaily.projectType || 'Wedding',\n                    },\n                  },\n                },\n              ]\n            : [];\n\n        const sampleReminders =\n          type === 'daily-summary'\n            ? [\n                {\n                  id: 'sample-reminder',\n                  content:\n                    sampleDaily.reminderContent ||\n                    'Send the mood board to the couple.',\n                  reminder_date: todayStr,\n                  reminder_time: '13:00',\n                  leads: { name: sampleDaily.clientName || 'Emily Carter' },\n                  projects: {\n                    name: sampleDaily.projectName || 'Sunset Wedding',\n                  },\n                },\n              ]\n            : [];\n\n        const sampleOverdueActivities = sampleDaily.overdueContent\n          ? [\n              {\n                id: 'sample-overdue',\n                content: sampleDaily.overdueContent,\n                reminder_date: todayStr,\n                reminder_time: '10:00',\n                lead_id: null,\n                project_id: null,\n                leads: {\n                  name:\n                    sampleDaily.pastSessionClientName ||\n                    sampleDaily.clientName ||\n                    'Rivera Family',\n                },\n                projects: {\n                  name:\n                    sampleDaily.pastSessionProjectName ||\n                    sampleDaily.projectName ||\n                    'Rivera Family Session',\n                },\n              },\n            ]\n          : [];\n\n        const samplePastSessions = sampleDaily.pastSessionProjectName\n          ? [\n              {\n                id: 'sample-past-session',\n                session_date: todayStr,\n                session_time: '11:00',\n                notes: '',\n                location:\n                  sampleDaily.sessionLocation || 'Downtown studio',\n                leads: {\n                  name:\n                    sampleDaily.pastSessionClientName ||\n                    'Rivera Family',\n                },\n                projects: {\n                  name:\n                    sampleDaily.pastSessionProjectName ||\n                    'Rivera Family Session',\n                  project_types: {\n                    name: sampleDaily.projectType || 'Wedding',\n                  },\n                },\n              },\n            ]\n          : [];\n\n        const formattedSubjectDate = formatDate(\n          today.toISOString(),\n          templateData.dateFormat,\n          templateData.timezone,\n        );\n\n        const emailHtml =\n          type === 'daily-summary-empty'\n            ? generateEmptyDailySummaryEmail(\n                { leads: [], activities: sampleOverdueActivities },\n                samplePastSessions,\n                templateData,\n              )\n            : generateModernDailySummaryEmail(\n                sampleSessions,\n                sampleReminders,\n                { leads: [], activities: sampleOverdueActivities },\n                samplePastSessions,\n                templateData,\n              );\n\n        const subjectKey =\n          type === 'daily-summary-empty'\n            ? 'dailySummary.subject.brandedEmpty'\n            : 'dailySummary.subject.brandedWithData';\n\n        const emailSubject = t(subjectKey, {\n          date: formattedSubjectDate,\n        });\n\n        const emailResponse = await resend.emails.send({\n          from: 'Lumiso <hello@updates.lumiso.app>',\n          to: [user.email],\n          subject: emailSubject,\n          html: emailHtml,\n        });\n\n        if (emailResponse.error) {\n          throw new Error(emailResponse.error.message);\n        }\n\n        return new Response(\n          JSON.stringify({\n            message: 'Test daily summary email sent',\n            type,\n          }),\n          {\n            status: 200,\n            headers: { 'Content-Type': 'application/json', ...corsHeaders },\n          },\n        );\n      }\n\n      if (type === 'project-milestone') {\n        const sampleImmediate =\n          (localization.raw('samples.immediate') as Record<string, string>) ||\n          {};\n\n        const notificationData: ProjectMilestoneData = {\n          type: 'project-milestone',\n          organizationId,\n          triggeredByUser: {\n            name: sampleImmediate.triggeredByName || userFullName,\n            id: 'sample-user',\n          },\n          project: {\n            id: 'sample-project',\n            name: sampleImmediate.projectName || 'Spring Garden Wedding',\n            type: sampleImmediate.projectType || 'Wedding',\n            oldStatus: sampleImmediate.oldStatus || 'Editing',\n            newStatus:\n              sampleImmediate.newStatusCompleted || 'Completed',\n            lifecycle: 'completed',\n            notes:\n              sampleImmediate.projectNotes ||\n              'Plan golden hour portraits on the venue terrace.',\n            leadName: sampleImmediate.leadName || 'Elif Kaya',\n          },\n          assignee: {\n            name: userFullName,\n            email: user.email,\n          },\n        };\n\n        const emailData: ImmediateNotificationEmailData = {\n          user: {\n            fullName: userFullName,\n            email: user.email,\n          },\n          business: {\n            businessName: orgSettings?.photography_business_name || 'Lumiso',\n            brandColor: orgSettings?.primary_brand_color || '#1EB29F',\n          },\n          notificationData,\n          language: localization.language,\n          localization,\n          baseUrl: 'https://my.lumiso.app',\n        };\n\n        const emailHtml = generateImmediateNotificationEmail(emailData);\n        const emailSubject = generateSubject(notificationData, t);\n\n        const emailResponse = await resend.emails.send({\n          from: 'Lumiso <hello@updates.lumiso.app>',\n          to: [user.email],\n          subject: emailSubject,\n          html: emailHtml,\n        });\n\n        if (emailResponse.error) {\n          throw new Error(emailResponse.error.message);\n        }\n\n        return new Response(\n          JSON.stringify({\n            message: 'Test project milestone email sent',\n            type,\n          }),\n          {\n            status: 200,\n            headers: { 'Content-Type': 'application/json', ...corsHeaders },\n          },\n        );\n      }\n    }\n\n    // Get today's date\n    const today = new Date();\n    const todayStr = today.toISOString().split('T')[0];\n    console.log(`Today's date: ${todayStr}`);\n\n    // Get today's sessions\n    const { data: todaySessions, error: todaySessionsError } = await adminSupabase\n      .from('sessions')\n      .select(`\n        id,\n        session_date,\n        session_time,\n        session_type_id,\n        session_types:session_type_id (\n          id,\n          name,\n          duration_minutes\n        ),\n        notes,\n        location,\n        leads(id, name),\n        projects(id, name, project_types(name))\n      `)\n      .eq('session_date', todayStr)\n      .eq('organization_id', organizationId)\n      .order('session_time');\n\n    // Get past sessions that need action (simplified - just count them)\n    const { data: pastSessions, error: pastSessionsError } = await adminSupabase\n      .from('sessions')\n      .select(`\n        id,\n        session_date,\n        session_time,\n        session_type_id,\n        session_types:session_type_id (\n          id,\n          name,\n          duration_minutes\n        ),\n        notes,\n        location,\n        leads(id, name),\n        projects(id, name, project_types(name))\n      `)\n      .lt('session_date', todayStr)\n      .eq('organization_id', organizationId)\n      .order('session_date', { ascending: false });\n\n    if (todaySessionsError) {\n      console.error('Error fetching today sessions:', todaySessionsError);\n    }\n    if (pastSessionsError) {\n      console.error('Error fetching past sessions:', pastSessionsError);\n    }\n\n    // Get overdue reminders/activities (using date comparison)\n    const { data: overdueActivities, error: overdueError } = await adminSupabase\n      .from('activities')\n      .select(`\n        id,\n        content,\n        reminder_date,\n        reminder_time,\n        completed,\n        lead_id,\n        project_id\n      `)\n      .lt('reminder_date::date', todayStr)\n      .eq('completed', false)\n      .eq('organization_id', organizationId)\n      .order('reminder_date', { ascending: false });\n\n    if (overdueError) {\n      console.error('Error fetching overdue activities:', overdueError);\n    }\n\n    // Get today's reminders/activities - simplified query that MUST work\n    console.log(`Searching for today's reminders on date: ${todayStr}`);\n    \n    const { data: todayActivities, error: todayActivitiesError } = await adminSupabase\n      .from('activities')\n      .select(`\n        id,\n        user_id,\n        content,\n        reminder_date,\n        reminder_time,\n        type,\n        completed,\n        lead_id,\n        project_id\n      `)\n      .eq('organization_id', organizationId)\n      .eq('completed', false)\n      .gte('reminder_date', `${todayStr}T00:00:00`)\n      .lte('reminder_date', `${todayStr}T23:59:59`)\n      .order('reminder_time');\n\n    console.log(`Found ${todayActivities?.length || 0} today's activities:`, todayActivities);\n\n    if (todayActivitiesError) {\n      console.error('Error fetching today activities:', todayActivitiesError);\n    }\n\n    // Fetch lead and project names for today's activities\n    const todayActivitiesWithNames = [];\n    if (todayActivities && todayActivities.length > 0) {\n      for (const activity of todayActivities) {\n        let leadName = null;\n        let projectName = null;\n\n        // Fetch lead name if lead_id exists\n        if (activity.lead_id) {\n          const { data: lead } = await adminSupabase\n            .from('leads')\n            .select('name')\n            .eq('id', activity.lead_id)\n            .maybeSingle();\n          leadName = lead?.name || null;\n        }\n\n        // Fetch project name if project_id exists\n        if (activity.project_id) {\n          const { data: project } = await adminSupabase\n            .from('projects')\n            .select('name')\n            .eq('id', activity.project_id)\n            .maybeSingle();\n          projectName = project?.name || null;\n        }\n\n        todayActivitiesWithNames.push({\n          ...activity,\n          leads: leadName ? { name: leadName } : null,\n          projects: projectName ? { name: projectName } : null\n        });\n      }\n    }\n\n    console.log('Today activities with names:', todayActivitiesWithNames);\n\n    // Get pending todos - use admin client since todos are user-specific\n    const { data: pendingTodos, error: todosError } = await adminSupabase\n      .from('todos')\n      .select(`\n        id,\n        content,\n        created_at,\n        projects(id, name, leads(id, name))\n      `)\n      .eq('is_completed', false)\n      .eq('user_id', user.id)\n      .order('created_at', { ascending: false })\n      .limit(10);\n\n    if (todosError) {\n      console.error('Error fetching todos:', todosError);\n    }\n\n    console.log('Data fetched:', {\n      todaySessions: todaySessions?.length || 0,\n      pastSessions: pastSessions?.length || 0,\n      overdueActivities: overdueActivities?.length || 0,\n      todayActivities: todayActivities?.length || 0,\n      pendingTodos: pendingTodos?.length || 0\n    });\n\n    console.log('Today activities data:', todayActivities);\n    console.log('Past sessions data:', pastSessions);\n\n    // Prepare data for enhanced email template with timezone support\n    const templateData = {\n      userFullName,\n      businessName: orgSettings?.photography_business_name || 'Lumiso',\n      brandColor: orgSettings?.primary_brand_color || '#1EB29F',\n      dateFormat: orgSettings?.date_format || 'DD/MM/YYYY',\n      timeFormat: orgSettings?.time_format || '12-hour',\n      timezone: orgSettings?.timezone || 'UTC',\n      baseUrl: 'https://my.lumiso.app',\n      language: localization.language,\n      localization,\n    };\n\n    // Transform sessions data\n    const sessions = (todaySessions || []).map((session) => {\n      const lead = normalizeSessionLead(session.leads);\n      const project = normalizeSessionProject(session.projects);\n\n      return {\n        id: session.id,\n        session_date: session.session_date,\n        session_time: session.session_time,\n        notes: session.notes,\n        location: session.location,\n        leads: lead,\n        projects: project,\n      };\n    });\n\n    // Transform past sessions that need action\n    const pastSessionsNeedingAction = (pastSessions || []).map((session) => {\n      const lead = normalizeSessionLead(session.leads);\n      const project = normalizeSessionProject(session.projects);\n\n      return {\n        id: session.id,\n        session_date: session.session_date,\n        session_time: session.session_time,\n        notes: session.notes,\n        location: session.location,\n        leads: lead,\n        projects: project,\n      };\n    });\n\n    // Transform todos data\n    const todos = (pendingTodos || []).map(todo => ({\n      id: todo.id,\n      content: todo.content,\n      created_at: todo.created_at,\n      projects: todo.projects\n    }));\n\n    // Transform today's activities separately from overdue\n    const todayReminders = (todayActivitiesWithNames || []).map(activity => ({\n      id: activity.id,\n      content: activity.content,\n      reminder_date: activity.reminder_date,\n      reminder_time: activity.reminder_time,\n      lead_id: activity.lead_id,\n      project_id: activity.project_id,\n      leads: activity.leads,\n      projects: activity.projects\n    }));\n\n    // Transform overdue data (only overdue activities, not today's)\n    const overdueItems = {\n      leads: [], // No overdue leads for now, focus on activities\n      activities: (overdueActivities || []).map(activity => ({\n        id: activity.id,\n        content: activity.content,\n        reminder_date: activity.reminder_date,\n        reminder_time: activity.reminder_time,\n        lead_id: activity.lead_id,\n        project_id: activity.project_id\n      }))\n    };\n\n    // Generate enhanced email content using the appropriate template\n    let emailHtml: string;\n    let emailSubject: string;\n    const formattedSubjectDate = formatDate(\n      today.toISOString(),\n      templateData.dateFormat,\n      templateData.timezone,\n    );\n\n    if (type === 'daily-summary-empty') {\n      // Force empty state for testing\n      emailHtml = generateEmptyDailySummaryEmail(\n        overdueItems,\n        pastSessionsNeedingAction,\n        templateData\n      );\n      emailSubject = t('dailySummary.subject.brandedEmpty', {\n        date: formattedSubjectDate,\n      });\n    } else if (sessions.length === 0 && todayReminders.length === 0) {\n      // Automatically use empty template when no sessions or reminders\n      emailHtml = generateEmptyDailySummaryEmail(\n        overdueItems,\n        pastSessionsNeedingAction,\n        templateData\n      );\n      emailSubject = t('dailySummary.subject.brandedEmpty', {\n        date: formattedSubjectDate,\n      });\n    } else {\n      // Use regular daily summary template\n      emailHtml = generateModernDailySummaryEmail(\n        sessions,\n        todayReminders,\n        overdueItems,\n        pastSessionsNeedingAction,\n        templateData\n      );\n      emailSubject = t('dailySummary.subject.brandedWithData', {\n        date: formattedSubjectDate,\n      });\n    }\n\n    // Send email using Resend\n    const emailResult = await resend.emails.send({\n      from: 'Lumiso <hello@updates.lumiso.app>',\n      to: [user.email],\n      subject: emailSubject,\n      html: emailHtml\n    });\n\n    console.log('Email sent successfully:', emailResult);\n\n    return new Response(JSON.stringify({\n      message: `Daily summary sent to ${user.email}`,\n      successful: 1,\n      failed: 0,\n      total: 1,\n      organizationId,\n      dataCount: {\n        sessions: sessions.length,\n        pastSessions: pastSessionsNeedingAction.length,\n        todos: todos.length,\n        overdueActivities: overdueItems.activities.length\n      }\n    }), {\n      status: 200,\n      headers: { \"Content-Type\": \"application/json\", ...corsHeaders },\n    });\n\n  } catch (error: unknown) {\n    console.error('Error:', error);\n    return new Response(JSON.stringify({\n      error: getErrorMessage(error),\n      successful: 0,\n      failed: 1,\n      total: 1\n    }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\", ...corsHeaders },\n    });\n  }\n};\n\n// Handler for assignment notifications (lead or project assignments)\nexport async function handleAssignmentNotification(requestData: any, adminSupabase: any): Promise<Response> {\n  console.log('Handling assignment notification:', requestData);\n  \n  try {\n    const { \n      entity_type, \n      entity_id, \n      assignee_id, \n      assignee_email, \n      assignee_name,\n      assigner_name,\n      organizationId \n    } = requestData;\n\n    // Initialize variables for entity details\n    let entityName = '';\n    let notes = '';\n    let status = '';\n    let leadName = '';\n    let projectType = '';\n\n    // Fetch entity details based on type\n    if (entity_type === 'lead') {\n      console.log('Fetching lead details for ID:', entity_id);\n      \n      const { data: lead, error: leadError } = await adminSupabase\n        .from('leads')\n        .select('name, notes, status')\n        .eq('id', entity_id)\n        .maybeSingle();\n      \n      if (leadError) {\n        console.error('Error fetching lead:', leadError);\n      }\n      \n      if (lead) {\n        entityName = lead.name;\n        notes = lead.notes;\n        status = lead.status;\n      }\n    } else if (entity_type === 'project') {\n        console.log('Fetching project details for ID:', entity_id);\n        \n        // First get the project details with lead information\n        const { data: project, error: projectError } = await adminSupabase\n          .from('projects')\n          .select(`\n            name,\n            description,\n            project_type_id,\n            status_id,\n            lead_id,\n            leads!projects_lead_id_fkey(name)\n          `)\n          .eq('id', entity_id)\n          .maybeSingle();\n        \n        if (projectError) {\n          console.error('Error fetching project:', projectError);\n        }\n        \n        console.log('Project query result:', project);\n        \n        if (project) {\n          console.log('Found project:', project.name);\n          entityName = project.name || `Unnamed Project`;\n          notes = project.description;\n          leadName = project.leads?.name;\n          \n          console.log('Project details - Name:', entityName, 'Lead:', leadName);\n          \n          // Get project type name if available\n          if (project.project_type_id) {\n            const { data: projectTypeData } = await adminSupabase\n              .from('project_types')\n              .select('name')\n              .eq('id', project.project_type_id)\n              .maybeSingle();\n            \n            if (projectTypeData) {\n              projectType = projectTypeData.name;\n              console.log('Project type:', projectType);\n            }\n          }\n          \n          // Get project status name if available\n          if (project.status_id) {\n            const { data: statusData } = await adminSupabase\n              .from('project_statuses')\n              .select('name')\n              .eq('id', project.status_id)\n              .maybeSingle();\n            \n            if (statusData) {\n              status = statusData.name;\n              console.log('Project status:', status);\n            }\n          }\n        } else {\n          console.log('No project found for ID:', entity_id);\n          // Try to get just the basic project info without joins\n          const { data: basicProject } = await adminSupabase\n            .from('projects')\n            .select('name, description, lead_id')\n            .eq('id', entity_id)\n            .maybeSingle();\n          \n          if (basicProject) {\n            console.log('Found basic project:', basicProject);\n            entityName = basicProject.name || `Unnamed Project`;\n            notes = basicProject.description;\n            \n            // Fetch lead name separately if lead_id exists\n            if (basicProject.lead_id) {\n              const { data: leadData } = await adminSupabase\n                .from('leads')\n                .select('name')\n                .eq('id', basicProject.lead_id)\n                .maybeSingle();\n              \n              if (leadData) {\n                leadName = leadData.name;\n                console.log('Lead name fetched separately:', leadName);\n              }\n            }\n          } else {\n            console.error('Project not found with ID:', entity_id);\n            entityName = `Project ${entity_id}`;\n          }\n        }\n    }\n\n    // Get organization settings for branding AND notification preferences\n    const { data: orgSettings } = await adminSupabase\n      .from('organization_settings')\n      .select('photography_business_name, primary_brand_color, notification_new_assignment_enabled, notification_global_enabled')\n      .eq('organization_id', organizationId)\n      .maybeSingle();\n\n    // Get user-level notification settings (takes precedence over org settings)\n    const { data: userSettings } = await adminSupabase\n      .from('user_settings')\n      .select('notification_new_assignment_enabled, notification_global_enabled')\n      .eq('user_id', assignee_id)\n      .maybeSingle();\n\n    // Check if assignment notifications are disabled - user settings override org settings\n    const globalEnabled = (userSettings?.notification_global_enabled ?? orgSettings?.notification_global_enabled) ?? true;\n    const assignmentEnabled = (userSettings?.notification_new_assignment_enabled ?? orgSettings?.notification_new_assignment_enabled) ?? true;\n\n    if (!globalEnabled || !assignmentEnabled) {\n      console.log('Assignment notifications are disabled - Global:', globalEnabled, 'Assignment:', assignmentEnabled);\n      \n      // Still update the notification to processed status to avoid retries\n      if (assignee_id) {\n        await adminSupabase\n          .from('notifications')\n          .update({ status: 'skipped', updated_at: new Date().toISOString() })\n          .eq('user_id', assignee_id)\n          .eq('notification_type', 'new-assignment')\n          .eq('status', 'pending')\n          .order('created_at', { ascending: false })\n          .limit(1);\n      }\n\n      return new Response(JSON.stringify({\n        message: `Assignment notification skipped - notifications disabled`,\n        successful: 0,\n        failed: 0,\n        total: 1,\n        skipped: 1,\n        reason: globalEnabled ? 'Assignment notifications disabled' : 'All notifications disabled'\n      }), {\n        status: 200,\n        headers: { \"Content-Type\": \"application/json\", ...corsHeaders },\n      });\n    }\n\n    console.log('Assignment notifications are enabled - proceeding with email send');\n\n    // Prepare unified notification data\n    let notificationData: ProjectAssignmentData | LeadAssignmentData;\n    \n    if (entity_type === 'project') {\n      notificationData = {\n        type: 'project-assignment' as const,\n        organizationId: organizationId || '',\n        triggeredByUser: {\n          name: assigner_name || 'System',\n          id: requestData.assigner_id || ''\n        },\n        project: {\n          id: entity_id || '',\n          name: entityName || 'Unnamed Project',\n          type: projectType || undefined,\n          status: status || undefined,\n          notes: notes || undefined,\n          leadName: leadName || undefined\n        },\n        assignee: {\n          name: assignee_name || 'there',\n          email: assignee_email || ''\n        }\n      };\n    } else {\n      notificationData = {\n        type: 'lead-assignment' as const,\n        organizationId: organizationId || '',\n        triggeredByUser: {\n          name: assigner_name || 'System',\n          id: requestData.assigner_id || ''\n        },\n        lead: {\n          id: entity_id || '',\n          name: entityName || `Lead ${entity_id}`,\n          status: status || undefined,\n          notes: notes || undefined\n        },\n        assignee: {\n          name: assignee_name || 'there',\n          email: assignee_email || ''\n        }\n      };\n    }\n\n    const { data: assigneeLanguage } = assignee_id\n      ? await adminSupabase\n          .from('user_language_preferences')\n          .select('language_code')\n          .eq('user_id', assignee_id)\n          .maybeSingle()\n      : { data: null } as const;\n\n    const localization = createEmailLocalization(assigneeLanguage?.language_code);\n    const t = localization.t;\n\n    // Prepare template data\n    const templateData: ImmediateNotificationEmailData = {\n      user: {\n        fullName: assignee_name || 'there',\n        email: assignee_email || ''\n      },\n      business: {\n        businessName: orgSettings?.photography_business_name || 'Lumiso',\n        brandColor: orgSettings?.primary_brand_color || '#1EB29F'\n      },\n      notificationData,\n      language: localization.language,\n      localization,\n      baseUrl: 'https://my.lumiso.app'\n    };\n\n    // Generate email HTML and subject\n    const emailHtml = generateImmediateNotificationEmail(templateData);\n    const emailSubject = generateSubject(notificationData, t);\n\n    // Send email using Resend\n    const emailResult = await resend.emails.send({\n      from: 'Lumiso <hello@updates.lumiso.app>',\n      to: [assignee_email || ''],\n      subject: emailSubject,\n      html: emailHtml\n    });\n\n    console.log('Assignment notification sent successfully:', emailResult);\n\n    // Update notification status to sent\n    if (assignee_id) {\n      await adminSupabase\n        .from('notifications')\n        .update({ \n          status: 'sent', \n          updated_at: new Date().toISOString(),\n          email_id: emailResult.data?.id || null\n        })\n        .eq('user_id', assignee_id)\n        .eq('notification_type', 'new-assignment')\n        .eq('status', 'pending')\n        .order('created_at', { ascending: false })\n        .limit(1);\n    }\n\n    return new Response(JSON.stringify({\n      message: `Assignment notification sent to ${assignee_email}`,\n      successful: 1,\n      failed: 0,\n      total: 1,\n      entityType: entity_type,\n      entityName,\n      assigneeEmail: assignee_email\n    }), {\n      status: 200,\n      headers: { \"Content-Type\": \"application/json\", ...corsHeaders },\n    });\n\n  } catch (error: unknown) {\n    console.error('Error in assignment notification:', error);\n    \n    // Log error in notifications table if possible\n    if (requestData.assignee_id && requestData.organizationId) {\n      try {\n        await adminSupabase\n          .from('notifications')\n          .update({ \n            status: 'failed', \n            error_message: getErrorMessage(error),\n            updated_at: new Date().toISOString(),\n            retry_count: 1\n          })\n          .eq('user_id', requestData.assignee_id)\n          .eq('notification_type', 'new-assignment')\n          .eq('status', 'pending')\n          .order('created_at', { ascending: false })\n          .limit(1);\n      } catch (logError) {\n        console.error('Failed to update error log:', logError);\n      }\n    }\n\n    return new Response(JSON.stringify({\n      error: getErrorMessage(error),\n      successful: 0,\n      failed: 1,\n      total: 1\n    }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\", ...corsHeaders },\n    });\n  }\n}\n\n// Handler for project milestone notifications\nexport async function handleProjectMilestoneNotification(requestData: ReminderRequest, adminSupabase: any): Promise<Response> {\n  console.log('Handling project milestone notification:', requestData);\n  \n  try {\n    const { \n      project_id,\n      old_status,\n      new_status,\n      milestone_user_id,\n      milestone_user_name,\n      organizationId,\n      isTest = false\n    } = requestData;\n\n    // Validate required fields\n    if (!project_id || !organizationId) {\n      throw new Error('Missing required fields for milestone notification');\n    }\n\n    console.log('Processing milestone for project:', project_id, 'from', old_status, 'to', new_status);\n\n    // Get the name of the person who made the change\n    let changedByUserName = milestone_user_name || 'Someone';\n    if (milestone_user_id && !milestone_user_name) {\n      try {\n        const { data: changedByProfile } = await adminSupabase\n          .from('profiles')\n          .select('full_name')\n          .eq('user_id', milestone_user_id)\n          .maybeSingle();\n\n        const { data: changedByAuth } = await adminSupabase.auth.admin.getUserById(milestone_user_id);\n        \n        if (changedByProfile?.full_name) {\n          changedByUserName = changedByProfile.full_name;\n        } else if (changedByAuth?.user?.user_metadata?.full_name) {\n          changedByUserName = changedByAuth.user.user_metadata.full_name;\n        } else if (changedByAuth?.user?.email) {\n          changedByUserName = changedByAuth.user.email.split('@')[0];\n        }\n      } catch (error) {\n        console.error('Error fetching changed-by user details:', error);\n        // Keep default \"Someone\" if we can't fetch the user\n      }\n    }\n\n    // Get project details and assigned users\n    const { data: project, error: projectError } = await adminSupabase\n      .from('projects')\n      .select(`\n        id,\n        name,\n        description,\n        project_types(name),\n        status_id,\n        lead_id\n      `)\n      .eq('id', project_id)\n      .maybeSingle();\n\n    if (projectError || !project) {\n      console.error('Error fetching project:', projectError);\n      throw new Error('Project not found');\n    }\n\n    console.log('Found project for milestone:', project.name);\n\n    // Get lead name separately if lead_id exists\n    let leadName = '';\n    if (project.lead_id) {\n      const { data: leadData } = await adminSupabase\n        .from('leads')\n        .select('name')\n        .eq('id', project.lead_id)\n        .maybeSingle();\n      \n      leadName = leadData?.name || '';\n    }\n\n    // Get current status name\n    const { data: statusData } = await adminSupabase\n      .from('project_statuses')\n      .select('name, lifecycle')\n      .eq('id', project.status_id)\n      .maybeSingle();\n\n    const currentStatusName = statusData?.name || new_status || 'Unknown Status';\n    const lifecycle = statusData?.lifecycle || 'active';\n\n    // Only proceed if this is actually a milestone (completed or cancelled)\n    if (!['completed', 'cancelled'].includes(lifecycle)) {\n      console.log('Status change is not a milestone, skipping notification');\n      return new Response(JSON.stringify({\n        message: 'Not a milestone status change',\n        successful: 0,\n        failed: 0,\n        total: 0,\n        skipped: 1\n      }), {\n        status: 200,\n        headers: { \"Content-Type\": \"application/json\", ...corsHeaders },\n      });\n    }\n\n    console.log('Milestone notifications disabled in single photographer mode â€” skipping email delivery');\n\n    return new Response(JSON.stringify({\n      message: 'Milestone notifications disabled in single photographer mode',\n      successful: 0,\n      failed: 0,\n      skipped: 1,\n      total: 0\n    }), {\n      status: 200,\n      headers: { \"Content-Type\": \"application/json\", ...corsHeaders },\n    });\n\n  } catch (error: unknown) {\n    console.error('Error in project milestone notification:', error);\n    \n    return new Response(JSON.stringify({\n      error: getErrorMessage(error),\n      successful: 0,\n      failed: 1,\n      total: 1\n    }), {\n      status: 500,\n      headers: { \"Content-Type\": \"application/json\", ...corsHeaders },\n    });\n  }\n}\n\nserve(handler);\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/send-template-email/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/session-types-delete/index.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[807,810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[807,810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { serve } from \"https://deno.land/std@0.224.0/http/server.ts\";\nimport { createClient } from \"https://esm.sh/@supabase/supabase-js@2.53.0\";\n\nconst corsHeaders = {\n  \"Access-Control-Allow-Origin\": \"*\",\n  \"Access-Control-Allow-Headers\": \"authorization, x-client-info, apikey, content-type\",\n};\n\nconst supabaseUrl = Deno.env.get(\"SUPABASE_URL\");\nconst supabaseServiceKey = Deno.env.get(\"SUPABASE_SERVICE_ROLE_KEY\");\n\nif (!supabaseUrl || !supabaseServiceKey) {\n  console.error(\"Missing Supabase environment configuration for session-types-delete function.\");\n}\n\nexport const SESSION_TYPE_IN_USE_CODE = \"SESSION_TYPE_IN_USE\";\n\nexport interface DeleteSessionTypeResult {\n  status: number;\n  message?: string;\n}\n\nexport async function deleteSessionTypeWithClient(\n  client: ReturnType<typeof createClient> | any,\n  sessionTypeId: string | undefined\n): Promise<DeleteSessionTypeResult> {\n  if (!sessionTypeId || typeof sessionTypeId !== \"string\" || sessionTypeId.trim().length === 0) {\n    return { status: 400, message: \"invalid_session_type_id\" };\n  }\n\n  const { count, error: countError } = await client\n    .from(\"sessions\")\n    .select(\"id\", { count: \"exact\", head: true })\n    .eq(\"session_type_id\", sessionTypeId);\n\n  if (countError) {\n    const message = countError instanceof Error ? countError.message : String(countError);\n    return { status: 500, message };\n  }\n\n  if ((count ?? 0) > 0) {\n    return { status: 409, message: SESSION_TYPE_IN_USE_CODE };\n  }\n\n  const { error: deleteError } = await client\n    .from(\"session_types\")\n    .delete()\n    .eq(\"id\", sessionTypeId);\n\n  if (deleteError) {\n    const message = deleteError instanceof Error ? deleteError.message : String(deleteError);\n    return { status: 500, message };\n  }\n\n  return { status: 200 };\n}\n\nconst handler = async (req: Request): Promise<Response> => {\n  if (req.method === \"OPTIONS\") {\n    return new Response(\"ok\", { headers: corsHeaders });\n  }\n\n  try {\n    const { session_type_id: sessionTypeId } = await req.json();\n\n    const supabase = createClient(supabaseUrl!, supabaseServiceKey!, {\n      auth: { persistSession: false },\n    });\n\n    const result = await deleteSessionTypeWithClient(supabase, sessionTypeId);\n\n    if (result.status !== 200) {\n      return new Response(\n        JSON.stringify({ error: { message: result.message } }),\n        { status: result.status, headers: { \"Content-Type\": \"application/json\", ...corsHeaders } }\n      );\n    }\n\n    return new Response(JSON.stringify({ success: true }), {\n      status: 200,\n      headers: { \"Content-Type\": \"application/json\", ...corsHeaders },\n    });\n  } catch (error) {\n    console.error(\"session-types-delete error\", error);\n    const message = error instanceof Error ? error.message : String(error);\n    return new Response(\n      JSON.stringify({ error: { message } }),\n      { status: 500, headers: { \"Content-Type\": \"application/json\", ...corsHeaders } }\n    );\n  }\n};\n\nif (import.meta.main) {\n  serve(handler);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/simple-daily-notifications/_templates/enhanced-daily-summary-empty.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/simple-daily-notifications/_templates/enhanced-daily-summary-modern.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/simple-daily-notifications/_templates/enhanced-email-base.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/simple-daily-notifications/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/test-callback/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/tests/email-i18n.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/tests/get-users-email.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/tests/harness_smoke.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/tests/notification-processor.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/tests/process-session-reminders.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/tests/schedule-daily-notifications.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/tests/send-reminder-notifications.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/tests/send-template-email.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/tests/session-types-delete.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/tests/simple-daily-notifications.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1000,1003],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1000,1003],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1752,1755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1752,1755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { assertEquals } from \"std/testing/asserts.ts\";\nimport {\n  handler,\n  setSupabaseClientFactoryForTests,\n  resetSupabaseClientFactoryForTests,\n} from \"../simple-daily-notifications/index.ts\";\n\ntype UsersQueryResult = { data: unknown; error: unknown };\n\nclass UsersQuery {\n  #result: UsersQueryResult;\n\n  constructor(result: UsersQueryResult) {\n    this.#result = result;\n  }\n\n  select(_columns?: string) {\n    return this;\n  }\n\n  eq(_field: string, _value: unknown) {\n    return this;\n  }\n\n  then<TResult1 = UsersQueryResult, TResult2 = never>(\n    onfulfilled?: ((value: UsersQueryResult) => TResult1 | Promise<TResult1>) | undefined,\n    onrejected?: ((reason: unknown) => TResult2 | Promise<TResult2>) | undefined,\n  ): Promise<TResult1 | TResult2> {\n    return Promise.resolve(this.#result).then(onfulfilled, onrejected);\n  }\n}\n\nDeno.test(\"handler returns success payload when no users require processing\", async () => {\n  setSupabaseClientFactoryForTests(() => ({\n    from(table: string): any {\n      if (table === \"user_settings\") {\n        return new UsersQuery({ data: [], error: null });\n      }\n      throw new Error(`Unexpected table ${table}`);\n    },\n  }));\n\n  const response = await handler(new Request(\"https://example.com\", {\n    method: \"POST\",\n    body: JSON.stringify({ action: \"process\" }),\n  }));\n\n  const payload = await response.json();\n  assertEquals(response.status, 200);\n  assertEquals(payload.success, true);\n  assertEquals(payload.processed, 0);\n  assertEquals(payload.message, \"No users with daily summaries enabled\");\n\n  resetSupabaseClientFactoryForTests();\n});\n\nDeno.test(\"handler surfaces fetch errors from user settings query\", async () => {\n  setSupabaseClientFactoryForTests(() => ({\n    from(table: string): any {\n      if (table === \"user_settings\") {\n        return new UsersQuery({ data: null, error: { message: \"failed to fetch\" } });\n      }\n      throw new Error(`Unexpected table ${table}`);\n    },\n  }));\n\n  const response = await handler(new Request(\"https://example.com\", {\n    method: \"POST\",\n    body: JSON.stringify({ action: \"process\" }),\n  }));\n\n  const payload = await response.json();\n  assertEquals(response.status, 500);\n  assertEquals(payload.success, false);\n  assertEquals(payload.error, \"failed to fetch\");\n\n  resetSupabaseClientFactoryForTests();\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/tests/test-callback.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/tests/workflow-executor.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/supabase/functions/workflow-executor/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/tailwind.config.ts","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":151,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":151,"endColumn":42}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Config } from \"tailwindcss\";\n\nexport default {\n\tdarkMode: [\"class\"],\n\tcontent: [\n\t\t\"./pages/**/*.{ts,tsx}\",\n\t\t\"./components/**/*.{ts,tsx}\",\n\t\t\"./app/**/*.{ts,tsx}\",\n\t\t\"./src/**/*.{ts,tsx}\",\n\t],\n\tprefix: \"\",\n\ttheme: {\n\t\tcontainer: {\n\t\t\tcenter: true,\n\t\t\tpadding: '2rem',\n\t\t\tscreens: {\n\t\t\t\t'2xl': '1400px'\n\t\t\t}\n\t\t},\n\t\textend: {\n\t\t\tfontFamily: {\n\t\t\t\tsans: [\"Inter\", \"ui-sans-serif\", \"system-ui\", \"sans-serif\"],\n\t\t\t},\n\t\t\tcolors: {\n\t\t\t\tborder: 'hsl(var(--border))',\n\t\t\t\tinput: 'hsl(var(--input))',\n\t\t\t\tring: 'hsl(var(--ring))',\n\t\t\t\tbackground: 'hsl(var(--background))',\n\t\t\t\tforeground: 'hsl(var(--foreground))',\n\t\t\t\tprimary: {\n\t\t\t\t\tDEFAULT: 'hsl(var(--primary))',\n\t\t\t\t\tforeground: 'hsl(var(--primary-foreground))'\n\t\t\t\t},\n\t\t\t\tsecondary: {\n\t\t\t\t\tDEFAULT: 'hsl(var(--secondary))',\n\t\t\t\t\tforeground: 'hsl(var(--secondary-foreground))'\n\t\t\t\t},\n\t\t\t\tdestructive: {\n\t\t\t\t\tDEFAULT: 'hsl(var(--destructive))',\n\t\t\t\t\tforeground: 'hsl(var(--destructive-foreground))'\n\t\t\t\t},\n\t\t\t\tmuted: {\n\t\t\t\t\tDEFAULT: 'hsl(var(--muted))',\n\t\t\t\t\tforeground: 'hsl(var(--muted-foreground))'\n\t\t\t\t},\n\t\t\t\taccent: {\n\t\t\t\t\tDEFAULT: 'hsl(var(--accent))',\n\t\t\t\t\tforeground: 'hsl(var(--accent-foreground))'\n\t\t\t\t},\n\t\t\t\tpopover: {\n\t\t\t\t\tDEFAULT: 'hsl(var(--popover))',\n\t\t\t\t\tforeground: 'hsl(var(--popover-foreground))'\n\t\t\t\t},\n\t\t\t\tcard: {\n\t\t\t\t\tDEFAULT: 'hsl(var(--card))',\n\t\t\t\t\tforeground: 'hsl(var(--card-foreground))'\n\t\t\t\t},\n        sidebar: {\n          DEFAULT: 'hsl(var(--sidebar-background))',\n          foreground: 'hsl(var(--sidebar-foreground))',\n          primary: 'hsl(var(--sidebar-primary))',\n          'primary-foreground': 'hsl(var(--sidebar-primary-foreground))',\n          accent: 'hsl(var(--sidebar-accent))',\n          'accent-foreground': 'hsl(var(--sidebar-accent-foreground))',\n          active: 'hsl(var(--sidebar-active))',\n          'active-foreground': 'hsl(var(--sidebar-active-foreground))',\n          'active-icon': 'hsl(var(--sidebar-active-icon))',\n          border: 'hsl(var(--sidebar-border))',\n          ring: 'hsl(var(--sidebar-ring))'\n        },\n\t\t\t\t'status-new': {\n\t\t\t\t\tbg: 'hsl(var(--status-new-bg))',\n\t\t\t\t\ttext: 'hsl(var(--status-new-text))'\n\t\t\t\t},\n\t\t\t\t'status-contacted': {\n\t\t\t\t\tbg: 'hsl(var(--status-contacted-bg))',\n\t\t\t\t\ttext: 'hsl(var(--status-contacted-text))'\n\t\t\t\t},\n\t\t\t\t'status-qualified': {\n\t\t\t\t\tbg: 'hsl(var(--status-qualified-bg))',\n\t\t\t\t\ttext: 'hsl(var(--status-qualified-text))'\n\t\t\t\t},\n\t\t\t\t'status-proposal-sent': {\n\t\t\t\t\tbg: 'hsl(var(--status-proposal-sent-bg))',\n\t\t\t\t\ttext: 'hsl(var(--status-proposal-sent-text))'\n\t\t\t\t},\n\t\t\t\t'status-booked': {\n\t\t\t\t\tbg: 'hsl(var(--status-booked-bg))',\n\t\t\t\t\ttext: 'hsl(var(--status-booked-text))'\n\t\t\t\t},\n\t\t\t\t'status-lost': {\n\t\t\t\t\tbg: 'hsl(var(--status-lost-bg))',\n\t\t\t\t\ttext: 'hsl(var(--status-lost-text))'\n\t\t\t\t},\n\t\t\t\t'status-completed': {\n\t\t\t\t\tbg: 'hsl(var(--status-completed-bg))',\n\t\t\t\t\ttext: 'hsl(var(--status-completed-text))'\n\t\t\t\t}\n\t\t\t},\n\t\t\tborderRadius: {\n\t\t\t\tlg: 'var(--radius)',\n\t\t\t\tmd: 'calc(var(--radius) - 2px)',\n\t\t\t\tsm: 'calc(var(--radius) - 4px)'\n\t\t\t},\n\t\t\tkeyframes: {\n\t\t\t\t'accordion-down': {\n\t\t\t\t\tfrom: {\n\t\t\t\t\t\theight: '0'\n\t\t\t\t\t},\n\t\t\t\t\tto: {\n\t\t\t\t\t\theight: 'var(--radix-accordion-content-height)'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t'accordion-up': {\n\t\t\t\t\tfrom: {\n\t\t\t\t\t\theight: 'var(--radix-accordion-content-height)'\n\t\t\t\t\t},\n\t\t\t\t\tto: {\n\t\t\t\t\t\theight: '0'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t'slide-in-bottom': {\n\t\t\t\t\t'0%': {\n\t\t\t\t\t\ttransform: 'translateY(100%)',\n\t\t\t\t\t\topacity: '0'\n\t\t\t\t\t},\n\t\t\t\t\t'100%': {\n\t\t\t\t\t\ttransform: 'translateY(0)',\n\t\t\t\t\t\topacity: '1'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t'slide-up': {\n\t\t\t\t\t'0%': {\n\t\t\t\t\t\ttransform: 'translateY(100%)',\n\t\t\t\t\t\topacity: '0'\n\t\t\t\t\t}, \n\t\t\t\t\t'100%': {\n\t\t\t\t\t\ttransform: 'translateY(0)',\n\t\t\t\t\t\topacity: '1'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tanimation: {\n\t\t\t\t'accordion-down': 'accordion-down 0.2s ease-out',\n\t\t\t\t'accordion-up': 'accordion-up 0.2s ease-out',\n\t\t\t\t'slide-in-bottom': 'slide-in-bottom 0.3s ease-out',\n\t\t\t\t'slide-up': 'slide-up 0.4s ease-out'\n\t\t\t}\n\t\t}\n\t},\n\tplugins: [require(\"tailwindcss-animate\")],\n} satisfies Config;\n","usedDeprecatedRules":[]},{"filePath":"/Users/taytemiz/Desktop/Lumiso/vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
